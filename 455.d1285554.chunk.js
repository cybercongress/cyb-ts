!function(){var t,e,n,r,s={27188:function(t,e,n){"use strict";var r=n(99870),s=n(89546),a=n(91026),o=n(38161);const i=t=>o.k0.parse(t),c=t=>`/ipfs/${t}`,u="QmUgmRxoLtGERot7Y6G7UyF6fwvnusQZfGR15PuE6pY3aB",d=`/dns4/swarm.io.cybernode.ai/tcp/443/wss/p2p/${u}`,l=`/ip4/88.99.105.146/tcp/4001/p2p/${u}`,p="https://gateway.ipfs.cybernode.ai";var h=n(25108);var f=class{constructor(){this.nodeType="external",this._config={},this._isStarted=!1}get config(){return this._config}get isStarted(){return this._isStarted}async initConfig(){const t=await this.node.config.get("Addresses.Gateway");if(!t)return{gatewayUrl:p};const e=(0,a.HM)(t).nodeAddress();return{gatewayUrl:`http://${e.address}:${e.port}`}}async init(t){this.node=(0,s.Ue)(t),this._config=await this.initConfig(),"undefined"!=typeof window&&(window.node=this.node,window.toCid=i),h.log("IPFS - Kubo addrs",(await this.node.swarm.localAddrs()).map((t=>t.toString()))),this._isStarted=!0}async stat(t,e={}){return this.node.files.stat(c(t),{...e,withLocal:!0,size:!0}).then((t=>{const{type:e,size:n,sizeLocal:r,local:s,blocks:a}=t;return{type:e,size:n||-1,sizeLocal:r||-1,blocks:a}}))}cat(t,e={}){return this.node.cat(i(t),e)}async add(t,e={}){return(await this.node.add(t,e)).cid.toString()}async pin(t,e={}){return(await this.node.pin.add(i(t),e)).toString()}async getPeers(){return(await this.node.swarm.peers()).map((t=>t.peer.toString()))}async stop(){}async start(){}async connectPeer(t){const e=(0,a.HM)(t);return await this.node.bootstrap.add(e),await this.node.swarm.connect(e),!0}ls(){return this.node.pin.ls()}async info(){const{repoSize:t}=await this.node.stats.repo(),e=await this.node.id(),{agentVersion:n,id:r}=e;return{id:r.toString(),agentVersion:n,repoSize:t}}},y=n(21771),g=n(33634),m=n(55472),w=n(63718),b=n(99644),v=n(79071),x=n(69850),S=n(53184),P=n(44913),C=n(46177),T=n(57392),$=n(15624),E=n(21141),z=n(25108);const k={cidVersion:0,rawLeaves:!1};var A=class{constructor(){this.nodeType="helia",this._isStarted=!1}get config(){return{gatewayUrl:p}}get isStarted(){return this._isStarted}async init(){const t=new g.Y("helia-bs");await t.open();const e=new m.s("helia-ds");await e.open();const n=await(async(t,e=[])=>await(0,w.N)({datastore:t,transports:[(0,T.E)(),(0,$.d)(),(0,C.Z)({rtcConfiguration:{iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","STUN:freestun.net:3479","STUN:stun.bernardoprovenzano.net:3478","STUN:stun.aa.net.uk:3478"]},{credential:"free",username:"free",urls:["TURN:freestun.net:3479","TURNS:freestun.net:5350"]}]}}),(0,C.R)(),(0,x.f)({discoverRelays:1})],connectionEncryption:[(0,b.t)()],streamMuxers:[(0,v.P)()],connectionGater:{denyDialMultiaddr:()=>!1},peerDiscovery:[(0,P.U)({list:e})],services:{identify:(0,E.HA)()}}))(e,["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/swarm.io.cybernode.ai/tcp/443/wss/p2p/QmUgmRxoLtGERot7Y6G7UyF6fwvnusQZfGR15PuE6pY3aB"]);this.node=await(0,y.F)({blockstore:t,datastore:e,libp2p:n}),this.fs=(0,S.Y4)(this.node),"undefined"!=typeof window&&(window.libp2p=n,window.node=this.node,window.fs=this.fs,window.toCid=i),n.addEventListener("peer:connect",(t=>{const e=t.detail.toString(),r=n.getConnections(e)||[],s=Object.fromEntries(r.map((t=>[t.remoteAddr.toString(),t.remoteAddr.protoCodes().map((t=>(0,a.a_)(t)?.name))])));z.debug(`Connected to ${e}`,s)})),n.addEventListener("peer:disconnect",(t=>{z.debug(`Disconnected from ${t.detail.toString()}`)})),z.log("IPFS - Helia addrs",n.getMultiaddrs().map((t=>t.toString()))),this._isStarted=!0}async stat(t,e={}){return this.fs.stat(i(t),e).then((t=>{const{type:e,fileSize:n,localFileSize:r,blocks:s,dagSize:a,mtime:o}=t;return{type:e,size:n||-1,sizeLocal:r||-1,blocks:s}}))}cat(t,e={}){return this.fs.cat(i(t),e)}async add(t,e={}){const n={...e,...k};let r;if(t instanceof File){const e=t.name,s=await t.arrayBuffer(),a=new Uint8Array(s);r=await this.fs.addFile({path:e,content:a},n)}else{const e=(new TextEncoder).encode(t);r=await this.fs.addBytes(e,n)}return z.log("----added to helia",r.toString()),this.pin(r.toString(),e),r.toString()}async pin(t,e={}){const n=i(t);if(!await(this.node?.pins.isPinned(n,e))){(await(this.node?.pins.add(n,e)))?.cid.toString()}}async getPeers(){return this.node.libp2p.getConnections().map((t=>t.remotePeer.toString()))}async stop(){await(this.node?.stop())}async start(){await(this.node?.start())}async connectPeer(t){await this.node.libp2p.dial((0,a.HM)(t));return!0}async*mapToLsResult(t){for await(const e of t){const{cid:t,metadata:n}=e;yield{cid:t.toV0(),metadata:n,type:"recursive"}}}ls(){return this.mapToLsResult(this.node.pins.ls())}async info(){return{id:this.node.libp2p.peerId.toString(),agentVersion:this.node.libp2p.services.identify.host.agentVersion,repoSize:-1}}},O=n(27864),N=n(38134);var _=()=>({start:!0,repo:"ipfs-repo-cyber-v2",relay:{enabled:!1,hop:{enabled:!1}},preload:{enabled:!1},config:{API:{HTTPHeaders:{"Access-Control-Allow-Methods":["PUT","POST"],"Access-Control-Allow-Origin":["http://localhost:3000","http://127.0.0.1:5001","http://127.0.0.1:8888","http://localhost:8888"]}},Addresses:{Gateway:"/ip4/127.0.0.1/tcp/8080",Swarm:[],Delegates:[]},Discovery:{MDNS:{Enabled:!0,Interval:10},webRTCStar:{Enabled:!1}},Bootstrap:[],Pubsub:{Enabled:!1},Swarm:{ConnMgr:{HighWater:300,LowWater:50},DisableNatPortMap:!1},Routing:{Type:"dhtclient"}},libp2p:{transports:[(0,T.E)({filter:N.FR})],nat:{enabled:!1}},EXPERIMENTAL:{ipnsPubsub:!1}});var I=class{constructor(){this.nodeType="embedded",this._isStarted=!1}get config(){return{gatewayUrl:p}}get isStarted(){return this._isStarted}async init(){this.node=await(0,O.Ue)(_()),"undefined"!=typeof window&&(window.node=this.node,window.toCid=i),this._isStarted=!0}async stat(t,e={}){return this.node.files.stat(c(t),{...e,withLocal:!0,size:!0}).then((t=>{const{type:e,size:n,sizeLocal:r,local:s,blocks:a}=t;return{type:e,size:n||-1,sizeLocal:r||-1,blocks:a}}))}cat(t,e={}){return this.node.cat(i(t),e)}async add(t,e={}){return(await this.node.add(t,e)).cid.toString()}async pin(t,e={}){return(await this.node.pin.add(i(t),e)).toString()}async getPeers(){return(await this.node.swarm.peers()).map((t=>t.peer.toString()))}async stop(){}async start(){}async connectPeer(t){const e=(0,a.HM)(t);return await this.node.bootstrap.add(e),await this.node.swarm.connect(e),!0}ls(){return this.node.pin.ls()}async info(){const t=await this.node.stats.repo(),e=Number(t.repoSize),n=await this.node.id(),{agentVersion:r,id:s}=n;return{id:s.toString(),agentVersion:r,repoSize:e}}},D=n(49784),q=n(41487),M=n.n(q),L=n(95034),U=n(41690),j=n(25108);const R=async t=>{if(!t)return"unknown";const e=await(0,L.pM)(t);return e?.mime||"text/plain"};var B=n(23085).lW,F=n(25108);const Q=/^Qm[a-zA-Z0-9]{44}$/g,W=/^https:\/\/|^http:\/\//g;function G(t,e){return`data:${e};base64,${(0,D.B)(t,"base64")}`}const Z=/\s?<!doctype html>|(<html\b[^>]*>|<body\b[^>]*>|<x-[^>]+>)+/i;const V=async(t,e,n)=>{try{const r=t?.meta?.mime,s={link:`/ipfs/${e}`,gateway:!1,cid:e},a=(t=>{if(t){if(t.includes("video"))return"video";if(t.includes("audio"))return"audio"}return"other"})(r);if(["video","audio"].indexOf(a)>-1)return{...s,type:a};const o=t?.result?await(async(t,e)=>{let n=0;try{if(t instanceof Uint8Array)return e&&e(t.byteLength),t;const r=[];if(t instanceof ReadableStream){const s=t.getReader(),a=async({done:t,value:o})=>t?(0,U.z)(r):(r.push(o),n+=o.byteLength,e&&e(n),s.read().then(a));return await s.read().then(a)}const s=t[Symbol.asyncIterator]();for await(const t of s)t instanceof Uint8Array&&(r.push(t),n+=t.byteLength,e&&e(n));return(0,U.z)(r)}catch(t){return void j.error("Error reading stream/iterable.\r\n Probably Hot reload error!",t)}})(t.result,n):void 0;if(r)if(-1!==r.indexOf("text/plain")||-1!==r.indexOf("application/xml"))if(M()(B.from(o)))s.type="image",s.content=G(o,"image/svg+xml");else{const t=(0,D.B)(o);s.link=t.length>42?`/ipfs/${e}`:`/search/${t}`,t.match(Q)?(s.gateway=!0,s.type="other",s.content=t,s.link=`/ipfs/${e}`):t.match(W)?(s.type="link",s.gateway=!1,s.content=t,s.link=`/ipfs/${e}`):!function(t){const e=t.trim().slice(0,1e3);return Z.test(e)}(t)?(s.type="text",s.content=t,s.text=t.length>300?`${t.slice(0,300)}...`:t):(s.type="other",s.gateway=!0,s.content=e.toString())}else-1!==r.indexOf("image")?(s.content=G(o,r),s.type="image",s.gateway=!1):-1!==r.indexOf("application/pdf")&&(s.type="pdf",s.content=function(t,e){const n=new Blob([t],{type:e});return URL.createObjectURL(n)}(o,r),s.gateway=!0);else s.text=`Can't detect MIME for ${e.toString()}`,s.gateway=!0;return s}catch(t){return void F.log("----parseRawIpfsData",t,e)}},H=(t,e,n=150)=>t&&e&&"text/plain"===e?(0,D.B)(t).slice(0,n):void 0;const J=new(n(39387).ZP)("cyber-page-cash");J.version(3).stores({cid:"cid",following:"cid"});var Y=J;var X={add:async(t,e)=>{if(!await Y.table("cid").get({cid:t})){const n={cid:t,data:e};Y.table("cid").add(n)}},get:async t=>{const e=await Y.table("cid").get({cid:t});return e?.data||e?.content}},K=n(86107);var tt=(()=>{const t=new K.vu("https://io.cybernode.ai");return{add:async e=>{const n="string"==typeof e?new File([e],"file.txt"):e;return t.add(n,{cidVersion:0,rawLeaves:!1})},status:async e=>t.status(e)}})(),et=n(25108);const nt=async t=>{const e=await X.get(t);if(e&&e.length){const n=await R(e),r=H(e,n);return{result:e,cid:t,meta:{type:"file",size:e.length,sizeLocal:e.length,mime:n},source:"db",textPreview:r}}},rt={type:"file",size:void 0,local:void 0,sizeLocal:void 0},st=async(t,e,n)=>{if(e){return await e.stat(t,{signal:n})}return rt},at=async(t,e,n)=>{const r=n||new AbortController,{signal:s}=r;let a;if(e){n||(a=setTimeout((()=>{r.abort()}),6e4));try{const n=Date.now(),r=await st(t,e,s),o=Date.now();r.statsTime=o-n;const i=r.size<2e7;if(a&&clearTimeout(a),"directory"===r.type)return{cid:t,availableDownload:!0,source:"node",meta:r};{const{value:n,done:a}=await e.cat(t,{signal:s,length:2048,offset:0})[Symbol.asyncIterator]().next(),c=await R(n),u=r.size>-1&&n.length>=r.size,d=H(n,c),l=u?n:i?e.cat(t,{signal:s}):void 0;return r.catTime=Date.now()-o,!r.local&&i?(e.pin(t),r.pinTime=Date.now()-r.catTime):r.pinTime=-1,{result:l,textPreview:d,cid:t,meta:{...r,mime:c},source:"node"}}}catch(e){return et.log("error fetchIPFSContentFromNode",e),{cid:t,availableDownload:!0,source:"node",meta:rt}}}else et.log("--------fetchIPFSContentFromNode NO NODE INTIALIZED--------")},ot=async(t,e,n)=>{const r="external"===e?.nodeType,s=r?await st(t,e,n?.signal):rt,a=`${p}/ipfs/${t}`,o=await fetch(a,{method:"GET",signal:n?.signal});if(o&&o.body){const e=e=>r?Promise.resolve():X.add(t,(0,U.z)(e)),{mime:n,result:i,firstChunk:c}=await async function(t,e){const[n,r]=t.tee(),s=[],a=n.getReader(),{value:o}=await a.read(),i=o?await R(o):void 0,c=r.getReader(),u={async*[Symbol.asyncIterator](){for(;;){const{done:t,value:n}=await c.read();if(t)return void(e&&e(s,i));e&&s.push(n),yield n}}};return{mime:i,result:u,firstChunk:o}}(o.body,e),u=H(c,n);return{cid:t,textPreview:u,meta:{...s,mime:n},result:i,source:"gateway",contentUrl:a}}};const it=async(t,e,n,r)=>{const s=await nt(t);if(void 0!==s)return s;if(e){r&&r("trying to get with a node");return await at(t,e,n)}r&&r("trying to get with a gatway");return await ot(t,e,n)},ct=async(t,e)=>{let n;t&&(n=await t.add(e));const r=await tt.add(e);return n=n??r?.cid,n&&await X.add(n,await(async t=>new Uint8Array("string"==typeof t?B.from(t):await t.arrayBuffer()))(e)),n};var ut=n(25108);var dt=n(25108);const lt={helia:A,embedded:I,external:f};async function pt(t){const{ipfsNodeType:e,...n}=t,r=function(t,e){return class extends t{async fetchWithDetails(t,e){const n=await it(t,this),r=n?.result?await V(n,t):void 0;return e?r?.type===e?r:void 0:r}async addContent(t){return ct(this,t)}async isConnectedToSwarm(){return!!(await super.getPeers()).find((t=>t===e.swarmPeerId))}async reconnectToSwarm(t){await this.isConnectedToSwarm()||super.connectPeer(e.swarmPeerAddress).then((()=>(ut.log(`ðŸ connected to swarm - ${e.swarmPeerAddress}`),!0))).catch((t=>(ut.log(`Can't connect to swarm ${e.swarmPeerAddress}: ${t.message}`),!1)))}}}(lt[e],{swarmPeerId:u,swarmPeerAddress:"external"===e?l:d}),s=new r;return await s.init({url:n.urlOpts}),dt.log("----init",e),await s.reconnectToSwarm(),s}var ht=n(37386),ft=n(51706),yt=n(94975),gt=n(42965),mt=n(29127),wt=n(87877),bt=n(31751),vt=n(1545),xt=n(25211),St=n(28368),Pt=n(79878),Ct=n(32817),Tt=n(34243),$t=n(81480),Et=n(25108);class zt{constructor(t,e){this.settings=t,this.order=e}getNextSource(t){const e=this.order.indexOf(t);return e<this.order.length?this.order[e+1]:void 0}}class kt extends Error{constructor(t){super(`Timeout after ${t}`),Object.setPrototypeOf(this,kt.prototype)}}n(25108);function At(t){return(t.priority||0)+(t.viewPortPriority||0)}const Ot={external:new zt({db:{timeout:5e3,maxConcurrentExecutions:999},node:{timeout:6e4,maxConcurrentExecutions:21},gateway:{timeout:21e3,maxConcurrentExecutions:11}},["db","node","gateway"]),embedded:new zt({db:{timeout:5e3,maxConcurrentExecutions:999},node:{timeout:6e4,maxConcurrentExecutions:21},gateway:{timeout:21e3,maxConcurrentExecutions:11}},["db","gateway","node"]),helia:new zt({db:{timeout:5e3,maxConcurrentExecutions:999},node:{timeout:6e4,maxConcurrentExecutions:21},gateway:{timeout:21e3,maxConcurrentExecutions:11}},["db","node","gateway"])};var Nt=class{constructor(t=Ot.embedded,e=33){this.queue$=new ht.X(new Map),this.node=void 0,this.postProcessItem=void 0,this.lastNodeCallTime=Date.now(),this.executing={db:new Set,node:new Set,gateway:new Set},this.strategy=t,this.queueDebounceMs=e,(0,ft.F)(5e3).pipe((0,yt.h)((()=>this.queue$.value.size>0&&!!this.node))).subscribe((()=>this.node.reconnectToSwarm(this.lastNodeCallTime))),this.queue$.pipe((0,gt.b)(this.queueDebounceMs),(0,mt.U)((t=>this.cancelDeprioritizedItems(t))),(0,wt.z)((t=>{const e=this.getItemBySourceAndPriority(t);return e.length>0?(this.node?.reconnectToSwarm(this.lastNodeCallTime),(0,bt.T)(...e.map((t=>this.fetchData$(t))))):vt.E}))).subscribe((({item:t,status:e,source:n,result:r})=>{const{cid:s}=t,a=this.queue$.value.get(s)?.callbacks||[];if(a.map((t=>t(s,e,n,r))),"node"===n&&(this.lastNodeCallTime=Date.now()),this.executing[n].delete(s),"completed"===e||"cancelled"===e)this.removeAndNext(s);else{const e=this.strategy.getNextSource(n);e?this.switchSourceAndNext(t,e):(this.removeAndNext(s),a.map((t=>t(s,"not_found",n,r))))}}))}switchStrategy(t){this.strategy=t}setPostProcessor(t){this.postProcessItem=t}async setNode(t,e){this.node=t,this.switchStrategy(e||Ot[t.nodeType])}getItemBySourceAndPriority(t){const e=[...t.values()].filter((t=>"pending"===t.status)),n=Tt.vMG((t=>t.source),e),r=[];for(const[t,e]of Object.entries(n)){const n=this.strategy.settings[t].maxConcurrentExecutions-this.executing[t].size,s=e.sort(((t,e)=>At(e)-At(t))).slice(0,n);r.push(...s)}return r}fetchData$(t){const{cid:e,source:n,controller:r,callbacks:s}=t,a=this.strategy.settings[n];this.executing[n].add(e);const o=this.queue$.value.get(e);return this.queue$.value.set(e,{...o,status:"executing",executionTime:Date.now(),controller:new AbortController}),s.map((t=>t(e,"executing",n))),(i=async()=>async function(t,e,n){const{node:r,controller:s}=n;try{switch(e){case"db":return nt(t);case"node":return at(t,r,s);case"gateway":return ot(t,r,s);default:return}}catch(t){return void et.log("----fetchIpfsContent error",t)}}(e,n,{controller:r,node:this.node}).then((t=>this.postProcessItem?this?.postProcessItem(t):t)),new $t.y((t=>{i().then((e=>{t.next(e),t.complete()})).catch((e=>{Et.log("----promiseToObservable error",e),t.error(e)}))}))).pipe((0,xt.V)({each:a.timeout,with:()=>(0,St._)((()=>(r?.abort("timeout"),new kt(a.timeout))))}),(0,mt.U)((e=>({item:t,status:e?"completed":"error",source:n,result:e}))),(0,Pt.K)((e=>e instanceof kt?(0,Ct.of)({item:t,status:"timeout",source:n}):"AbortError"===e?.name?(0,Ct.of)({item:t,status:"cancelled",source:n}):(0,Ct.of)({item:t,status:"error",source:n}))));var i}mutateQueueItem(t,e){const n=this.queue$.value,r=n.get(t);return r&&n.set(t,{...r,...e}),this.queue$.next(n)}removeAndNext(t){const e=this.queue$.value;e.delete(t),this.queue$.next(e)}switchSourceAndNext(t,e){t.callbacks.map((n=>n(t.cid,"pending",e))),this.mutateQueueItem(t.cid,{status:"pending",source:e})}cancelDeprioritizedItems(t){return["node","gateway"].forEach((e=>{Array.from(this.executing[e]).forEach((n=>{const r=t.get(n);r&&At(r)<0&&r.controller&&(r.controller.abort("cancelled"),r.callbacks.map((t=>t(r.cid,"pending",r.source))),t.set(n,{...r,status:"pending"}),this.executing[e].delete(n))}))})),t}releaseExecution(t){Object.keys(this.executing).forEach((e=>this.executing[e].delete(t)))}enqueue(t,e,n={}){const r=this.queue$.value,s=r.get(t);if(s)this.mutateQueueItem(t,{callbacks:[...s.callbacks,e]});else{const s=n.initialSource||this.strategy.order[0],a={cid:t,callbacks:[e],source:s,status:"pending",postProcessing:!0,...n};e(t,"pending",s),r.set(t,a),this.queue$.next(r)}}enqueueAndWait(t,e={}){return new Promise((n=>{this.enqueue(t,((t,e,r,s)=>{"completed"!==e&&"not_found"!==e||n({status:e,source:r,result:s})}),e)}))}updateViewPortPriority(t,e){this.mutateQueueItem(t,{viewPortPriority:e})}cancel(t){const e=this.queue$.value.get(t);e&&(e.controller?e.controller.abort("cancelled"):this.removeAndNext(t))}cancelByParent(t){const e=this.queue$.value;e.forEach(((n,r)=>{n.parent===t&&(this.releaseExecution(r),n.controller?.abort("cancelled"),e.delete(r))})),this.queue$.next(e)}clear(){const t=this.queue$.value;t.forEach(((e,n)=>{this.releaseExecution(n),e.controller?.abort("cancelled"),t.delete(n)})),this.queue$.next(new Map)}getQueueMap(){return this.queue$.value}getQueueList(){return Array.from(this.queue$.value.values())}getStats(){return Tt.zGw(Tt.VFc(Tt.vgT("status")),Tt.Zpf,Tt.UID(Tt._Qy(["status","count"])))(this.getQueueList())}};const _t={indirect:-1,direct:0,recursive:1};var It=class{constructor(t){this.channel=new BroadcastChannel("cyb-broadcast-channel"),t&&(this.channel.onmessage=e=>t(e))}post(t){this.channel.postMessage(t)}};async function Dt(t,e,n=10){let r=[];for await(const s of t)r.push(s),r.length===n&&(await e(r),r=[]);r.length>0&&await e(r)}const qt=t=>{const{cid:e,result:n,meta:r,textPreview:s}=t,{size:a,mime:o,type:i,blocks:c,sizeLocal:u}=r;return{cid:e,size:a,mime:o||"unknown",type:i,text:s?.replace(/"/g,"'")||"",sizeLocal:u||-1,blocks:c||0}},Mt=t=>({cid:t.cid.toString(),type:_t[t.type]}),Lt=t=>{const{transaction_hash:e,transaction:n,type:r,value:s}=t;return{hash:e,type:r,timestamp:new Date(n.block.timestamp).getTime(),value:JSON.stringify(s),success:n.success}};var Ut=n(25108);const jt=async(t,e)=>{try{const n=qt(t);return(await e.executePutCommand("particle",[n])).ok}catch(t){return Ut.error("importParicleContent",t.toString(),!!e),!1}};var Rt=n(1707),Bt=n(31230),Ft=n(25108);const Qt=(0,Bt.ZP)('\n  query MyQuery($address: _text, $limit: bigint, $offset: bigint) {\n  messages_by_address(args: {addresses: $address, limit: $limit, offset: $offset, types: "{}"},\n    order_by: {transaction: {block: {height: desc}}}) {\n    transaction_hash\n    value\n    transaction {\n      success\n      block {\n        timestamp\n      }\n    }\n    type\n  }\n}\n'),Wt=async(t,e,n=0)=>(await(0,Rt.WY)(e,Qt,{address:`{${t}}`,limit:"100",offset:n})).messages_by_address;const Gt=async(t,e,n,r,s)=>{Ft.log("---importTransactions");let a=0;const o=async function*(t,e){let n=0;for(;;){const r=await Wt(t,e,n);if(0===r.length)break;const s=r.map((t=>Lt(t)));yield s,n+=s.length}}(e,n);for await(const e of o)a+=e.length,await t.executeBatchPutCommand("transaction",e,e.length),r&&r(a);s&&s(a)};var Zt=n(25108);function Vt(t){return{async*[Symbol.asyncIterator](){let e=!1;for(;!e;){const n=new Promise((n=>{t.onmessage=t=>{null===t.data?(e=!0,n(null)):n(t.data)}})),r=await n;null!==r&&(yield r)}}}}const Ht={canHandle:t=>t&&t.result&&"function"==typeof t.result[Symbol.asyncIterator],serialize(t){if(void 0===t)return[null,[]];const{result:e,...n}=t,{port1:r,port2:s}=new MessageChannel;return e&&(async()=>{for await(const t of e)r.postMessage(t);r.postMessage(null),r.close()})(),[{...n,port:s},[s]]},deserialize(t){if(!t)return;const{port:e,...n}=t;return{...n,result:Vt(e)}}};var Jt=n(34155),Yt=n(25108);"undefined"!=typeof SharedWorker&&Jt.env.IS_DEV;function Xt(){r.Y6.set("IPFSContent",Ht)}function Kt(t){const e={log:{original:Yt.log},error:{original:Yt.error},warn:{original:Yt.warn}},n=n=>{const{original:r}=e[n];e[n].original=Yt[n],Yt[n]=(...e)=>{r.apply(Yt,e);const s=e.map((t=>function(t){try{return JSON.stringify(t)}catch(e){return String(t)}}(t)));t.postMessage({type:"console",method:n,args:s})}};Object.keys(e).forEach((t=>n(t)))}var te=n(25108);const ee=(()=>{let t,e;const n=new Nt,s=new It;te.log("----backendApi worker constructor!");const a=(t,e)=>s.post({type:"worker_status",value:{status:t,lastError:e}}),o=(t,e)=>s.post({type:"sync_entry",value:{entry:t,state:e}}),i={importParicleContent:async t=>jt(t,e),importCyberlinks:async t=>(async(t,e)=>{try{await e.executeBatchPutCommand("link",t.map((t=>({...t,neuron_address:""}))),100)}catch(t){Zt.error("importCyberlinks",t)}})(t,e),importParticle:async n=>(async(t,e,n)=>it(t,e).then((t=>!!t&&jt(t,n))))(n,t,e)},c={start:async e=>{try{return t&&(te.log("Ipfs node already started!"),await t.stop()),t=await pt(e),n.setNode(t),(0,r.sj)(t)}catch(t){throw te.log("----ipfs node init error ",t),Error(t instanceof Error?t.message:t)}},stop:async()=>{t&&await t.stop()},config:async()=>t?.config,info:async()=>t?.info(),fetchWithDetails:async(e,n)=>t?.fetchWithDetails(e,n),enqueue:async(t,e,r)=>n.enqueue(t,e,r),enqueueAndWait:async(t,e)=>n.enqueueAndWait(t,e),dequeue:async t=>n.cancel(t),dequeueByParent:async t=>n.cancelByParent(t),clearQueue:async()=>n.clear()};return{installDbApi:async t=>{e=t,n.setPostProcessor((async t=>(t&&i.importParicleContent({...t,result:void 0}),t))),a("idle")},syncDrive:async(n,r)=>{try{if(!n)return void a("error","Wallet is not connected");if(!t)return void a("error","IPFS node is not initialized");if(!e)return void a("error","CozoDb is not initialized");a("syncing"),["transaction","pin","particle"].forEach((t=>o(t,{progress:0,done:!1,error:void 0})));const s=async()=>{te.log("-----import ipfs"),await(async(t,e,n,r)=>{let s=0;await Dt(t.ls(),(async t=>{const r=t.map(Mt);s+=t.length,await e.executeBatchPutCommand("pin",r,t.length),n&&n(s)}),10),r&&r(s)})(t,e,(async t=>o("pin",{progress:t})),(async()=>o("pin",{done:!0})));const n=await e.executeGetCommand("pin",[`type = ${_t.recursive}`],["cid"]);if(!1===n.ok)return void a("error",n.message);const r=n.rows.map((t=>t[0]));await(async(t,e,n,r,s)=>{let a=0;await Dt(async function*(t){for(const e of t)yield e}(e),(async e=>{const s=await Promise.all(e.map((e=>it(e,t)))),o=s.filter((t=>!!t)).map((t=>qt(t)));a+=o.length,await n.executeBatchPutCommand("particle",o,o.length),r&&r(a)}),10),s&&s(a)})(t,r,e,(async t=>o("particle",{progress:t})),(async()=>o("particle",{done:!0}))),te.log("-----import ipfs done")},i=Gt(e,n,r,(async t=>o("transaction",{progress:t})),(async t=>o("transaction",{done:!0}))),c=s();await Promise.all([i,c]),a("idle")}catch(t){te.error("syncDrive",t),a("error",t.toString())}},ipfsApi:(0,r.sj)(c),importApi:(0,r.sj)(i)}})();var ne,re;ne=self,re=ee,Xt(),void 0!==ne.onconnect?ne.onconnect=t=>{const e=t.ports[0];Kt(e),(0,r.Jj)(re,e)}:(0,r.Jj)(re)},67064:function(){},81949:function(){},95856:function(){},35883:function(){},66778:function(){},10465:function(){},52596:function(){},63897:function(){},85104:function(){},83886:function(){},52:function(){},25819:function(){},81265:function(){},35539:function(){},99283:function(){},43838:function(){}},a={};function o(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={exports:{}};return s[t].call(n.exports,n,n.exports,o),n.exports}o.m=s,o.x=function(){var t=o.O(void 0,[630,748,970,326],(function(){return o(27188)}));return t=o.O(t)},t=[],o.O=function(e,n,r,s){if(!n){var a=1/0;for(d=0;d<t.length;d++){n=t[d][0],r=t[d][1],s=t[d][2];for(var i=!0,c=0;c<n.length;c++)(!1&s||a>=s)&&Object.keys(o.O).every((function(t){return o.O[t](n[c])}))?n.splice(c--,1):(i=!1,s<a&&(a=s));if(i){t.splice(d--,1);var u=r();void 0!==u&&(e=u)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[n,r,s]},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,{a:e}),e},n=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__},o.t=function(t,r){if(1&r&&(t=this(t)),8&r)return t;if("object"==typeof t&&t){if(4&r&&t.__esModule)return t;if(16&r&&"function"==typeof t.then)return t}var s=Object.create(null);o.r(s);var a={};e=e||[null,n({}),n([]),n(n)];for(var i=2&r&&t;"object"==typeof i&&!~e.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach((function(e){a[e]=function(){return t[e]}}));return a.default=function(){return t},o.d(s,a),s},o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.f={},o.e=function(t){return Promise.all(Object.keys(o.f).reduce((function(e,n){return o.f[n](t,e),e}),[]))},o.u=function(t){return t+"."+{326:"9d5003e0",630:"0212b885",748:"d4ec4127",827:"89ce62da",970:"897c9db2"}[t]+".chunk.js"},o.miniCssF=function(t){},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.p="/",function(){var t={455:1};o.f.i=function(e,n){t[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunkcyb=self.webpackChunkcyb||[],n=e.push.bind(e);e.push=function(e){var r=e[0],s=e[1],a=e[2];for(var i in s)o.o(s,i)&&(o.m[i]=s[i]);for(a&&a(o);r.length;)t[r.pop()]=1;n(e)}}(),r=o.x,o.x=function(){return Promise.all([630,748,970,326].map(o.e,o)).then(r)};o.x()}();
//# sourceMappingURL=455.d1285554.chunk.js.map