/*! For license information please see 805.75ee7734.chunk.js.LICENSE.txt */
(self.webpackChunkcyb=self.webpackChunkcyb||[]).push([[805],{19824:function(e,t,r){"use strict";var n=r(25108);const i=-8,s=-4,o=0,a=1,c=1,u=2,h=5,l=1024,f=2048,d=8192,p=0,y=4,g=8,m=12,b=12,w=16,v="undefined"!=typeof BigUint64Array,_=Symbol(),E=1024;function k(e,t){const r=new Uint32Array(e),n=new Uint16Array(e);var i=r[t+s>>>2]>>>1,o=t>>>1;if(i<=E)return String.fromCharCode.apply(String,n.subarray(o,o+i));const a=[];do{const e=n[o+E-1],t=e>=55296&&e<56320?E-1:E;a.push(String.fromCharCode.apply(String,n.subarray(o,o+=t))),i-=t}while(i>E);return a.join("")+String.fromCharCode.apply(String,n.subarray(o,o+i))}function x(e){const t={};function r(e,t){return e?k(e.buffer,t):"<yet unknown>"}const i=e.env=e.env||{};return i.abort=i.abort||function(e,n,s,o){const a=t.memory||i.memory;throw Error("abort: "+r(a,e)+" at "+r(a,n)+":"+s+":"+o)},i.trace=i.trace||function(e,s){const o=t.memory||i.memory;n.log("trace: "+r(o,e)+(s?" ":"")+Array.prototype.slice.call(arguments,2,2+s).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function S(e,t){const r=t.exports,n=r.memory,_=r.table,E=r.__alloc,x=r.__retain,S=r.__rtti_base||-1;function A(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[S>>>2])throw Error("invalid id: "+e);return t[(S+4>>>2)+2*e]}function I(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[S>>>2])throw Error("invalid id: "+e);return t[(S+4>>>2)+2*e+1]}function C(e){return 31-Math.clz32(e>>>h&31)}function T(e,t,r){const i=n.buffer;if(r)switch(e){case 2:return new Float32Array(i);case 3:return new Float64Array(i)}else switch(e){case 0:return new(t?Int8Array:Uint8Array)(i);case 1:return new(t?Int16Array:Uint16Array)(i);case 2:return new(t?Int32Array:Uint32Array)(i);case 3:return new(t?BigInt64Array:BigUint64Array)(i)}throw Error("unsupported align: "+e)}function D(e){const t=new Uint32Array(n.buffer),r=t[e+i>>>2],o=A(r);if(!(o&c))throw Error("not an array: "+r);const a=C(o);var h=t[e+y>>>2];const d=o&u?t[e+b>>>2]:t[h+s>>>2]>>>a;return T(a,o&l,o&f).subarray(h>>>=a,h+d)}function R(e,t,r){return new e(B(e,t,r))}function B(e,t,r){const i=n.buffer,o=new Uint32Array(i),a=o[r+y>>>2];return new e(i,a,o[a+s>>>2]>>>t)}return e.__allocString=function(e){const t=e.length,r=E(t<<1,a),i=new Uint16Array(n.buffer);for(var s=0,o=r>>>1;s<t;++s)i[o+s]=e.charCodeAt(s);return r},e.__getString=function(e){const t=n.buffer;if(new Uint32Array(t)[e+i>>>2]!==a)throw Error("not a string: "+e);return k(t,e)},e.__allocArray=function(e,t){const r=A(e);if(!(r&(c|u)))throw Error("not an array: "+e+" @ "+r);const i=C(r),s=t.length,a=E(s<<i,o),h=E(r&u?w:m,e),v=new Uint32Array(n.buffer);v[h+p>>>2]=x(a),v[h+y>>>2]=a,v[h+g>>>2]=s<<i,r&u&&(v[h+b>>>2]=s);const _=T(i,r&l,r&f);if(r&d)for(let e=0;e<s;++e)_[(a>>>i)+e]=x(t[e]);else _.set(t,a>>>i);return h},e.__getArrayView=D,e.__getArray=function(e){const t=D(e),r=t.length,n=new Array(r);for(let e=0;e<r;e++)n[e]=t[e];return n},e.__getArrayBuffer=function(e){const t=n.buffer,r=new Uint32Array(t)[e+s>>>2];return t.slice(e,e+r)},e.__getInt8Array=R.bind(null,Int8Array,0),e.__getInt8ArrayView=B.bind(null,Int8Array,0),e.__getUint8Array=R.bind(null,Uint8Array,0),e.__getUint8ArrayView=B.bind(null,Uint8Array,0),e.__getUint8ClampedArray=R.bind(null,Uint8ClampedArray,0),e.__getUint8ClampedArrayView=B.bind(null,Uint8ClampedArray,0),e.__getInt16Array=R.bind(null,Int16Array,1),e.__getInt16ArrayView=B.bind(null,Int16Array,1),e.__getUint16Array=R.bind(null,Uint16Array,1),e.__getUint16ArrayView=B.bind(null,Uint16Array,1),e.__getInt32Array=R.bind(null,Int32Array,2),e.__getInt32ArrayView=B.bind(null,Int32Array,2),e.__getUint32Array=R.bind(null,Uint32Array,2),e.__getUint32ArrayView=B.bind(null,Uint32Array,2),v&&(e.__getInt64Array=R.bind(null,BigInt64Array,3),e.__getInt64ArrayView=B.bind(null,BigInt64Array,3),e.__getUint64Array=R.bind(null,BigUint64Array,3),e.__getUint64ArrayView=B.bind(null,BigUint64Array,3)),e.__getFloat32Array=R.bind(null,Float32Array,2),e.__getFloat32ArrayView=B.bind(null,Float32Array,2),e.__getFloat64Array=R.bind(null,Float64Array,3),e.__getFloat64ArrayView=B.bind(null,Float64Array,3),e.__instanceof=function(e,t){const r=new Uint32Array(n.buffer);var s=r[e+i>>>2];if(s<=r[S>>>2])do{if(s==t)return!0}while(s=I(s));return!1},e.memory=e.memory||n,e.table=e.table||_,P(r,e)}function A(e){return"undefined"!=typeof Response&&e instanceof Response}async function I(e,t){return A(e=await e)?C(e,t):S(x(t||(t={})),await WebAssembly.instantiate(e instanceof WebAssembly.Module?e:await WebAssembly.compile(e),t))}async function C(e,t){return WebAssembly.instantiateStreaming?S(x(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance):I(A(e=await e)?e.arrayBuffer():e,t)}function P(e,t){var r=t?Object.create(t):{},n=e.__argumentsLength?function(t){e.__argumentsLength.value=t}:e.__setArgumentsLength||e.__setargc||function(){};for(let t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const i=e[t];let s=t.split("."),o=r;for(;s.length>1;){let e=s.shift();Object.prototype.hasOwnProperty.call(o,e)||(o[e]={}),o=o[e]}let a=s[0],c=a.indexOf("#");if(c>=0){let r=a.substring(0,c),s=o[r];if(void 0===s||!s.prototype){let e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={valueOf:function(){return this[_]}},e.wrap=function(t){return Object.create(e.prototype,{[_]:{value:t,writable:!1}})},s&&Object.getOwnPropertyNames(s).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t)))),o[r]=e}if(a=a.substring(c+1),o=o[r].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let r=e[t.replace("set:","get:")],n=e[t.replace("get:","set:")];Object.defineProperty(o,a,{get:function(){return r(this[_])},set:function(e){n(this[_],e)},enumerable:!0})}}else"constructor"===a?(o[a]=(...e)=>(n(e.length),i(...e))).original=i:(o[a]=function(...e){return n(e.length),i(this[_],...e)}).original=i}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:e[t.replace("set:","get:")],set:e[t.replace("get:","set:")],enumerable:!0}):"function"==typeof i&&i!==n?(o[a]=(...e)=>(n(e.length),i(...e))).original=i:o[a]=i}return r}t.instantiate=I,t.instantiateSync=function(e,t){return S(x(t||(t={})),new WebAssembly.Instance(e instanceof WebAssembly.Module?e:new WebAssembly.Module(e),t))},t.instantiateStreaming=C,t.demangle=P},42450:function(e,t,r){"use strict";e.exports=r(10077)},10077:function(e,t,r){"use strict";var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(88482),n.BufferWriter=r(95628),n.Reader=r(29958),n.BufferReader=r(73055),n.util=r(61436),n.rpc=r(13971),n.roots=r(59149),n.configure=i,i()},29958:function(e,t,r){"use strict";e.exports=c;var n,i=r(61436),s=i.LongBits,o=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},l=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new n(e):h(e)})(e)}:h};function f(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=l(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=l(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},73055:function(e,t,r){"use strict";e.exports=s;var n=r(29958);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(61436);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},59149:function(e){"use strict";e.exports={}},13971:function(e,t,r){"use strict";t.Service=r(98295)},98295:function(e,t,r){"use strict";e.exports=i;var n=r(61436);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,r,i,s);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},19961:function(e,t,r){"use strict";e.exports=i;var n=r(61436);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===o?s:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},61436:function(e,t,r){"use strict";var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(34537),n.base64=r(97419),n.EventEmitter=r(19211),n.float=r(10945),n.inquire=r(67199),n.utf8=r(94997),n.pool=r(76662),n.LongBits=r(19961),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},88482:function(e,t,r){"use strict";e.exports=l;var n,i=r(61436),s=i.LongBits,o=i.base64,a=i.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function l(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return i.Buffer?function(){return(l.create=function(){return new n})()}:function(){return new l}};function d(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function g(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}l.create=f(),l.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(l.alloc=i.pool(l.alloc,i.Array.prototype.subarray)),l.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},p.prototype=Object.create(c.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(y,10,s.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=s.from(e);return this._push(y,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(y,t.length(),t)},l.prototype.bool=function(e){return this._push(d,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=s.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var m=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(i.isString(e)){var r=l.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(m,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(d,1,0)},l.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new c(u,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},l._configure=function(e){n=e,l.create=f(),n._configure()}},95628:function(e,t,r){"use strict";e.exports=s;var n=r(88482);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(61436);function s(){n.call(this)}function o(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},79562:function(e,t,r){"use strict";var n=r(99549);var i=r(13955);var s=r(59372);var o=r(53942);var a=r(616);var c=r(70568);var u=r(56649);var h=r(58222);var l=r(52387);var f=r(52081)},28972:function(e,t,r){"use strict";t.s3=t.Gh=t.Dp=void 0;var n=r(47768);Object.defineProperty(t,"Dp",{enumerable:!0,get:function(){return n.toAscii}});var i=r(93431);Object.defineProperty(t,"Gh",{enumerable:!0,get:function(){return i.fromBase64}}),Object.defineProperty(t,"s3",{enumerable:!0,get:function(){return i.toBase64}});var s=r(15438);var o=r(26135);var a=r(37310);var c=r(26081)},62949:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Uint64=t.Uint53=t.Uint32=t.Int53=t.Decimal=void 0;var n=r(38828);Object.defineProperty(t,"Decimal",{enumerable:!0,get:function(){return n.Decimal}});var i=r(40172);Object.defineProperty(t,"Int53",{enumerable:!0,get:function(){return i.Int53}}),Object.defineProperty(t,"Uint32",{enumerable:!0,get:function(){return i.Uint32}}),Object.defineProperty(t,"Uint53",{enumerable:!0,get:function(){return i.Uint53}}),Object.defineProperty(t,"Uint64",{enumerable:!0,get:function(){return i.Uint64}})},6970:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineDappWallet=t.SigningCyberClient=t.CyberClient=void 0;var s=r(86537);Object.defineProperty(t,"CyberClient",{enumerable:!0,get:function(){return s.CyberClient}});var o=r(80742);Object.defineProperty(t,"SigningCyberClient",{enumerable:!0,get:function(){return o.SigningCyberClient}}),Object.defineProperty(t,"OfflineDappWallet",{enumerable:!0,get:function(){return o.OfflineDappWallet}}),i(r(46778),t)},19464:function(e,t,r){"use strict";const{fromCallback:n}=r(16957),i=r(31648),{getCallback:s,getOptions:o}=r(92520),a=Symbol("promise"),c=Symbol("status"),u=Symbol("operations"),h=Symbol("finishClose"),l=Symbol("closeCallbacks");t.AbstractChainedBatch=class{constructor(e){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}this[u]=[],this[l]=[],this[c]="open",this[h]=this[h].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[u].length}put(e,t,r){if("open"!==this[c])throw new i("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;const s=r&&null!=r.sublevel?r.sublevel:this.db,o=r,a=s.keyEncoding(r&&r.keyEncoding),h=s.valueEncoding(r&&r.valueEncoding),l=a.format;r={...r,keyEncoding:l,valueEncoding:h.format},s!==this.db&&(r.sublevel=null);const f=s.prefixKey(a.encode(e),l),d=h.encode(t);return this._put(f,d,r),this[u].push({...o,type:"put",key:e,value:t}),this}_put(e,t,r){}del(e,t){if("open"!==this[c])throw new i("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(e);if(r)throw r;const n=t&&null!=t.sublevel?t.sublevel:this.db,s=t,o=n.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},n!==this.db&&(t.sublevel=null),this._del(n.prefixKey(o.encode(e),a),t),this[u].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[c])throw new i("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[u]=[],this}_clear(){}write(e,t){return t=s(e,t),t=n(t,a),e=o(e),"open"!==this[c]?this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[c]="writing",this._write(e,(e=>{this[c]="closing",this[l].push((()=>t(e))),e||this.db.emit("batch",this[u]),this._close(this[h])}))),t[a]}_write(e,t){}close(e){return e=n(e,a),"closing"===this[c]?this[l].push(e):"closed"===this[c]?this.nextTick(e):(this[l].push(e),"writing"!==this[c]&&(this[c]="closing",this._close(this[h]))),e[a]}_close(e){this.nextTick(e)}[h](){this[c]="closed",this.db.detachResource(this);const e=this[l];this[l]=[];for(const t of e)t()}}},33961:function(e,t,r){"use strict";var n=r(25108);const{fromCallback:i}=r(16957),s=r(31648),{getOptions:o,getCallback:a}=r(92520),c=Symbol("promise"),u=Symbol("callback"),h=Symbol("working"),l=Symbol("handleOne"),f=Symbol("handleMany"),d=Symbol("autoClose"),p=Symbol("finishWork"),y=Symbol("returnMany"),g=Symbol("closing"),m=Symbol("handleClose"),b=Symbol("closed"),w=Symbol("closeCallbacks"),v=Symbol("keyEncoding"),_=Symbol("valueEncoding"),E=Symbol("abortOnClose"),k=Symbol("legacy"),x=Symbol("keys"),S=Symbol("values"),A=Symbol("limit"),I=Symbol("count"),C=Object.freeze({}),P=()=>{};let T=!1;class D{constructor(e,t,r){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}if("object"!=typeof t||null===t)throw new TypeError("The second argument must be an options object");this[b]=!1,this[w]=[],this[h]=!1,this[g]=!1,this[d]=!1,this[u]=null,this[l]=this[l].bind(this),this[f]=this[f].bind(this),this[m]=this[m].bind(this),this[v]=t[v],this[_]=t[_],this[k]=r,this[A]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[I]=0,this[E]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[I]}get limit(){return this[A]}next(e){let t;if(void 0===e)t=new Promise(((t,r)=>{e=(e,n,i)=>{e?r(e):this[k]?void 0===n&&void 0===i?t():t([n,i]):t(n)}}));else if("function"!=typeof e)throw new TypeError("Callback must be a function");return this[g]?this.nextTick(e,new s("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(e,new s("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[h]=!0,this[u]=e,this[I]>=this[A]?this.nextTick(this[l],null):this._next(this[l])),t}_next(e){this.nextTick(e)}nextv(e,t,r){return r=a(t,r),r=i(r,c),t=o(t,C),Number.isInteger(e)?(this[g]?this.nextTick(r,new s("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(r,new s("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[A]<1/0&&(e=Math.min(e,this[A]-this[I])),this[h]=!0,this[u]=r,e<=0?this.nextTick(this[f],null,[]):this._nextv(e,t,this[f])),r[c]):(this.nextTick(r,new TypeError("The first argument 'size' must be an integer")),r[c])}_nextv(e,t,r){const n=[],i=(t,s,o)=>t?r(t):(this[k]?void 0===s&&void 0===o:void 0===s)?r(null,n):(n.push(this[k]?[s,o]:s),void(n.length===e?r(null,n):this._next(i)));this._next(i)}all(e,t){return t=a(e,t),t=i(t,c),e=o(e,C),this[g]?this.nextTick(t,new s("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(t,new s("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[h]=!0,this[u]=t,this[d]=!0,this[I]>=this[A]?this.nextTick(this[f],null,[]):this._all(e,this[f])),t[c]}_all(e,t){let r=this[I];const n=[],i=()=>{const e=this[A]<1/0?Math.min(1e3,this[A]-r):1e3;e<=0?this.nextTick(t,null,n):this._nextv(e,C,s)},s=(e,s)=>{e?t(e):0===s.length?t(null,n):(n.push.apply(n,s),r+=s.length,i())};i()}[p](){const e=this[u];return this[E]&&null===e?P:(this[h]=!1,this[u]=null,this[g]&&this._close(this[m]),e)}[y](e,t,r){this[d]?this.close(e.bind(null,t,r)):e(t,r)}seek(e,t){if(t=o(t,C),this[g]);else{if(this[h])throw new s("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const r=this.db.keyEncoding(t.keyEncoding||this[v]),n=r.format;t.keyEncoding!==n&&(t={...t,keyEncoding:n});const i=this.db.prefixKey(r.encode(e),n);this._seek(i,t)}}}_seek(e,t){throw new s("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){if(e=i(e,c),this[b])this.nextTick(e);else if(this[g])this[w].push(e);else if(this[g]=!0,this[w].push(e),this[h]){if(this[E]){this[p]()(new s("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))}}else this._close(this[m]);return e[c]}_close(e){this.nextTick(e)}[m](){this[b]=!0,this.db.detachResource(this);const e=this[w];this[w]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[b]||await this.close()}}}class R extends D{constructor(e,t){super(e,t,!0),this[x]=!1!==t.keys,this[S]=!1!==t.values}[l](e,t,r){const n=this[p]();if(e)return n(e);try{t=this[x]&&void 0!==t?this[v].decode(t):void 0,r=this[S]&&void 0!==r?this[_].decode(r):void 0}catch(e){return n(new B("entry",e))}void 0===t&&void 0===r||this[I]++,n(null,t,r)}[f](e,t){const r=this[p]();if(e)return this[y](r,e);try{for(const e of t){const t=e[0],r=e[1];e[0]=this[x]&&void 0!==t?this[v].decode(t):void 0,e[1]=this[S]&&void 0!==r?this[_].decode(r):void 0}}catch(e){return this[y](r,new B("entries",e))}this[I]+=t.length,this[y](r,null,t)}end(e){return T||void 0===n||(T=!0,n.warn(new s("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class B extends s{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const e of["_ended property","_nexting property","_end method"])Object.defineProperty(R.prototype,e.split(" ")[0],{get(){throw new s(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new s(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})}});R.keyEncoding=v,R.valueEncoding=_,t.AbstractIterator=R,t.AbstractKeyIterator=class extends D{constructor(e,t){super(e,t,!1)}[l](e,t){const r=this[p]();if(e)return r(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return r(new B("key",e))}void 0!==t&&this[I]++,r(null,t)}[f](e,t){const r=this[p]();if(e)return this[y](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[v].decode(r):void 0}}catch(e){return this[y](r,new B("keys",e))}this[I]+=t.length,this[y](r,null,t)}},t.AbstractValueIterator=class extends D{constructor(e,t){super(e,t,!1)}[l](e,t){const r=this[p]();if(e)return r(e);try{t=void 0!==t?this[_].decode(t):void 0}catch(e){return r(new B("value",e))}void 0!==t&&this[I]++,r(null,t)}[f](e,t){const r=this[p]();if(e)return this[y](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[_].decode(r):void 0}}catch(e){return this[y](r,new B("values",e))}this[I]+=t.length,this[y](r,null,t)}}},69071:function(e,t,r){"use strict";const{supports:n}=r(51675),{Transcoder:i}=r(58499),{EventEmitter:s}=r(17187),{fromCallback:o}=r(16957),a=r(31648),{AbstractIterator:c}=r(33961),{DefaultKeyIterator:u,DefaultValueIterator:h}=r(95429),{DeferredIterator:l,DeferredKeyIterator:f,DeferredValueIterator:d}=r(30593),{DefaultChainedBatch:p}=r(4765),{getCallback:y,getOptions:g}=r(92520),m=r(70056),b=Symbol("promise"),w=Symbol("landed"),v=Symbol("resources"),_=Symbol("closeResources"),E=Symbol("operations"),k=Symbol("undefer"),x=Symbol("deferOpen"),S=Symbol("options"),A=Symbol("status"),I=Symbol("defaultOptions"),C=Symbol("transcoder"),P=Symbol("keyEncoding"),T=Symbol("valueEncoding"),D=()=>{};class R extends s{constructor(e,t){if(super(),"object"!=typeof e||null===e)throw new TypeError("The first argument 'manifest' must be an object");t=g(t);const{keyEncoding:r,valueEncoding:s,passive:o,...a}=t;this[v]=new Set,this[E]=[],this[x]=!0,this[S]=a,this[A]="opening",this.supports=n(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[C]=new i(O(this)),this[P]=this[C].encoding(r||"utf8"),this[T]=this[C].encoding(s||"utf8");for(const e of this[C].encodings())this.supports.encodings[e.commonName]||(this.supports.encodings[e.commonName]=!0);this[I]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[P].commonName,valueEncoding:this[T].commonName}),key:Object.freeze({keyEncoding:this[P].commonName})},this.nextTick((()=>{this[x]&&this.open({passive:!1},D)}))}get status(){return this[A]}keyEncoding(e){return this[C].encoding(null!=e?e:this[P])}valueEncoding(e){return this[C].encoding(null!=e?e:this[T])}open(e,t){t=y(e,t),t=o(t,b),(e={...this[S],...g(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;const r=e=>{"closing"===this[A]||"opening"===this[A]?this.once(w,e?()=>r(e):r):"open"!==this[A]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[A]?this.once(w,r):this.nextTick(r):"closed"===this[A]||this[x]?(this[x]=!1,this[A]="opening",this.emit("opening"),this._open(e,(e=>{if(e)return this[A]="closed",this[_]((()=>{this.emit(w),r(e)})),void this[k]();this[A]="open",this[k](),this.emit(w),"open"===this[A]&&this.emit("open"),"open"===this[A]&&this.emit("ready"),r()}))):"open"===this[A]?this.nextTick(r):this.once(w,(()=>this.open(e,t))),t[b]}_open(e,t){this.nextTick(t)}close(e){e=o(e,b);const t=r=>{"opening"===this[A]||"closing"===this[A]?this.once(w,r?t(r):t):"closed"!==this[A]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):e()};if("open"===this[A]){this[A]="closing",this.emit("closing");const e=e=>{this[A]="open",this[k](),this.emit(w),t(e)};this[_]((()=>{this._close((r=>{if(r)return e(r);this[A]="closed",this[k](),this.emit(w),"closed"===this[A]&&this.emit("closed"),t()}))}))}else"closed"===this[A]?this.nextTick(t):this.once(w,(()=>this.close(e)));return e[b]}[_](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,r=!0;const n=()=>{0==--t&&(r?this.nextTick(e):e())};for(const e of this[v])e.close(n);r=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,r){if(r=y(t,r),r=o(r,b),t=g(t,this[I].entry),"opening"===this[A])return this.defer((()=>this.get(e,t,r))),r[b];if(M(this,r))return r[b];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];const i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),c=i.format,u=s.format;return t.keyEncoding===c&&t.valueEncoding===u||(t=Object.assign({},t,{keyEncoding:c,valueEncoding:u})),this._get(this.prefixKey(i.encode(e),c),t,((e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),r(e);try{t=s.decode(t)}catch(e){return r(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[b]}_get(e,t,r){this.nextTick(r,new Error("NotFound"))}getMany(e,t,r){if(r=y(t,r),r=o(r,b),t=g(t,this[I].entry),"opening"===this[A])return this.defer((()=>this.getMany(e,t,r))),r[b];if(M(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'keys' must be an array")),r[b];if(0===e.length)return this.nextTick(r,null,[]),r[b];const n=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),s=n.format,c=i.format;t.keyEncoding===s&&t.valueEncoding===c||(t=Object.assign({},t,{keyEncoding:s,valueEncoding:c}));const u=new Array(e.length);for(let t=0;t<e.length;t++){const i=e[t],o=this._checkKey(i);if(o)return this.nextTick(r,o),r[b];u[t]=this.prefixKey(n.encode(i),s)}return this._getMany(u,t,((e,t)=>{if(e)return r(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=i.decode(t[e]))}catch(e){return r(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[b]}_getMany(e,t,r){this.nextTick(r,null,new Array(e.length).fill(void 0))}put(e,t,r,n){if(n=y(r,n),n=o(n,b),r=g(r,this[I].entry),"opening"===this[A])return this.defer((()=>this.put(e,t,r,n))),n[b];if(M(this,n))return n[b];const i=this._checkKey(e)||this._checkValue(t);if(i)return this.nextTick(n,i),n[b];const s=this.keyEncoding(r.keyEncoding),a=this.valueEncoding(r.valueEncoding),c=s.format,u=a.format;r.keyEncoding===c&&r.valueEncoding===u||(r=Object.assign({},r,{keyEncoding:c,valueEncoding:u}));const h=this.prefixKey(s.encode(e),c),l=a.encode(t);return this._put(h,l,r,(r=>{if(r)return n(r);this.emit("put",e,t),n()})),n[b]}_put(e,t,r,n){this.nextTick(n)}del(e,t,r){if(r=y(t,r),r=o(r,b),t=g(t,this[I].key),"opening"===this[A])return this.defer((()=>this.del(e,t,r))),r[b];if(M(this,r))return r[b];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];const i=this.keyEncoding(t.keyEncoding),s=i.format;return t.keyEncoding!==s&&(t=Object.assign({},t,{keyEncoding:s})),this._del(this.prefixKey(i.encode(e),s),t,(t=>{if(t)return r(t);this.emit("del",e),r()})),r[b]}_del(e,t,r){this.nextTick(r)}batch(e,t,r){if(!arguments.length){if("opening"===this[A])return new p(this);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(r="function"==typeof e?e:y(t,r),r=o(r,b),t=g(t,this[I].empty),"opening"===this[A])return this.defer((()=>this.batch(e,t,r))),r[b];if(M(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'operations' must be an array")),r[b];if(0===e.length)return this.nextTick(r),r[b];const n=new Array(e.length),{keyEncoding:i,valueEncoding:s,...c}=t;for(let t=0;t<e.length;t++){if("object"!=typeof e[t]||null===e[t])return this.nextTick(r,new TypeError("A batch operation must be an object")),r[b];const o=Object.assign({},e[t]);if("put"!==o.type&&"del"!==o.type)return this.nextTick(r,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[b];const a=this._checkKey(o.key);if(a)return this.nextTick(r,a),r[b];const c=null!=o.sublevel?o.sublevel:this,u=c.keyEncoding(o.keyEncoding||i),h=u.format;if(o.key=c.prefixKey(u.encode(o.key),h),o.keyEncoding=h,"put"===o.type){const e=this._checkValue(o.value);if(e)return this.nextTick(r,e),r[b];const t=c.valueEncoding(o.valueEncoding||s);o.value=t.encode(o.value),o.valueEncoding=t.format}c!==this&&(o.sublevel=null),n[t]=o}return this._batch(n,c,(t=>{if(t)return r(t);this.emit("batch",e),r()})),r[b]}_batch(e,t,r){this.nextTick(r)}sublevel(e,t){return this._sublevel(e,B.defaults(t))}_sublevel(e,t){return new B(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=y(e,t),t=o(t,b),e=g(e,this[I].empty),"opening"===this[A])return this.defer((()=>this.clear(e,t))),t[b];if(M(this,t))return t[b];const r=e,n=this.keyEncoding(e.keyEncoding);return(e=m(e,n)).keyEncoding=n.format,0===e.limit?this.nextTick(t):this._clear(e,(e=>{if(e)return t(e);this.emit("clear",r),t()})),t[b]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[A])return new l(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new c(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[A])return new f(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new u(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[A])return new d(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new h(this,e)}defer(e){if("function"!=typeof e)throw new TypeError("The first argument must be a function");this[E].push(e)}[k](){if(0===this[E].length)return;const e=this[E];this[E]=[];for(const t of e)t()}attachResource(e){if("object"!=typeof e||null===e||"function"!=typeof e.close)throw new TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new p(this)}_checkKey(e){if(null==e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null==e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}R.prototype.nextTick=r(56909);const{AbstractSublevel:B}=r(59650)({AbstractLevel:R});t.AbstractLevel=R,t.AbstractSublevel=B;const M=function(e,t){return"open"!==e[A]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},O=function(e){return Object.keys(e.supports.encodings).filter((t=>!!e.supports.encodings[t]))}},50875:function(e,t,r){"use strict";t.AbstractLevel=r(69071).AbstractLevel,t.AbstractSublevel=r(69071).AbstractSublevel,t.AbstractIterator=r(33961).AbstractIterator,t.AbstractKeyIterator=r(33961).AbstractKeyIterator,t.AbstractValueIterator=r(33961).AbstractValueIterator,t.AbstractChainedBatch=r(19464).AbstractChainedBatch},82970:function(e,t,r){"use strict";const{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(33961),o=Symbol("unfix"),a=Symbol("iterator"),c=Symbol("handleOne"),u=Symbol("handleMany"),h=Symbol("callback");class l extends n{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[u]=this[u].bind(this),this[h]=null}[c](e,t,r){const n=this[h];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t,r)}[u](e,t){const r=this[h];if(e)return r(e);for(const e of t){const t=e[0];void 0!==t&&(e[0]=this[o](t))}r(e,t)}}class f extends i{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[u]=this[u].bind(this),this[h]=null}[c](e,t){const r=this[h];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t)}[u](e,t){const r=this[h];if(e)return r(e);for(let e=0;e<t.length;e++){const r=t[e];void 0!==r&&(t[e]=this[o](r))}r(e,t)}}class d extends s{constructor(e,t,r){super(e,t),this[a]=r}}for(const e of[l,f])e.prototype._next=function(e){this[h]=e,this[a].next(this[c])},e.prototype._nextv=function(e,t,r){this[h]=r,this[a].nextv(e,t,this[u])},e.prototype._all=function(e,t){this[h]=t,this[a].all(e,this[u])};for(const e of[d])e.prototype._next=function(e){this[a].next(e)},e.prototype._nextv=function(e,t,r){this[a].nextv(e,t,r)},e.prototype._all=function(e,t){this[a].all(e,t)};for(const e of[l,f,d])e.prototype._seek=function(e,t){this[a].seek(e,t)},e.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=l,t.AbstractSublevelKeyIterator=f,t.AbstractSublevelValueIterator=d},59650:function(e,t,r){"use strict";const n=r(31648),{Buffer:i}=r(96451)||{},{AbstractSublevelIterator:s,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=r(82970),c=Symbol("prefix"),u=Symbol("upperBound"),h=Symbol("prefixRange"),l=Symbol("parent"),f=Symbol("unfix"),d=new TextEncoder,p={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"==typeof e)throw new n("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new n("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?p:e.separator?e:{...e,separator:"!"}}constructor(e,r,i){const{separator:s,manifest:o,...a}=t.defaults(i);r=w(r,s);const h=s.charCodeAt(0)+1,p=e[l]||e;if(!d.encode(r).every((e=>e>h&&e<127)))throw new n(`Prefix must use bytes > ${h} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(y(p,o),a);const g=(e.prefix||"")+s+r+s,v=g.slice(0,-1)+String.fromCharCode(h);this[l]=p,this[c]=new m(g),this[u]=new m(v),this[f]=new b,this.nextTick=p.nextTick}prefixKey(e,t){if("utf8"===t)return this[c].utf8+e;if(0===e.byteLength)return this[c][t];if("view"===t){const t=this[c].view,r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r}{const t=this[c].buffer;return i.concat([t,e],t.byteLength+e.byteLength)}}[h](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[c][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[u][t]}get prefix(){return this[c].utf8}get db(){return this[l]}_open(e,t){this[l].open({passive:!0},t)}_put(e,t,r,n){this[l].put(e,t,r,n)}_get(e,t,r){this[l].get(e,t,r)}_getMany(e,t,r){this[l].getMany(e,t,r)}_del(e,t,r){this[l].del(e,t,r)}_batch(e,t,r){this[l].batch(e,t,r)}_clear(e,t){this[h](e,e.keyEncoding),this[l].clear(e,t)}_iterator(e){this[h](e,e.keyEncoding);const t=this[l].iterator(e),r=this[f].get(this[c].utf8.length,e.keyEncoding);return new s(this,e,t,r)}_keys(e){this[h](e,e.keyEncoding);const t=this[l].keys(e),r=this[f].get(this[c].utf8.length,e.keyEncoding);return new o(this,e,t,r)}_values(e){this[h](e,e.keyEncoding);const t=this[l].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};const y=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:g(e,"utf8"),buffer:g(e,"buffer"),view:g(e,"view")}}},g=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class m{constructor(e){this.utf8=e,this.view=d.encode(e),this.buffer=i?i.from(this.view.buffer,0,this.view.byteLength):{}}}class b{constructor(){this.cache=new Map}get(e,t){let r=this.cache.get(t);return void 0===r&&(r="view"===t?function(e,t){return t.subarray(e)}.bind(null,e):function(e,t){return t.slice(e)}.bind(null,e),this.cache.set(t,r)),r}}const w=function(e,t){let r=0,n=e.length;for(;r<n&&e[r]===t;)r++;for(;n>r&&e[n-1]===t;)n--;return e.slice(r,n)}},92520:function(e,t){"use strict";t.getCallback=function(e,t){return"function"==typeof e?e:t},t.getOptions=function(e,t){return"object"==typeof e&&null!==e?e:void 0!==t?t:{}}},4765:function(e,t,r){"use strict";const{AbstractChainedBatch:n}=r(19464),i=r(31648),s=Symbol("encoded");t.DefaultChainedBatch=class extends n{constructor(e){super(e),this[s]=[]}_put(e,t,r){this[s].push({...r,type:"put",key:e,value:t})}_del(e,t){this[s].push({...t,type:"del",key:e})}_clear(){this[s]=[]}_write(e,t){"opening"===this.db.status?this.db.defer((()=>this._write(e,t))):"open"===this.db.status?0===this[s].length?this.nextTick(t):this.db._batch(this[s],e,t):this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}},95429:function(e,t,r){"use strict";const{AbstractKeyIterator:n,AbstractValueIterator:i}=r(33961),s=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),c=Symbol("handleMany");class u extends n{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}class h extends i{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}for(const e of[u,h]){const t=e===u,r=t?e=>e[0]:e=>e[1];e.prototype._next=function(e){this[o]=e,this[s].next(this[a])},e.prototype[a]=function(e,r,n){const i=this[o];e?i(e):i(null,t?r:n)},e.prototype._nextv=function(e,t,r){this[o]=r,this[s].nextv(e,t,this[c])},e.prototype._all=function(e,t){this[o]=t,this[s].all(e,this[c])},e.prototype[c]=function(e,t){const n=this[o];e?n(e):n(null,t.map(r))},e.prototype._seek=function(e,t){this[s].seek(e,t)},e.prototype._close=function(e){this[s].close(e)}}t.DefaultKeyIterator=u,t.DefaultValueIterator=h},30593:function(e,t,r){"use strict";const{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(33961),o=r(31648),a=Symbol("nut"),c=Symbol("undefer"),u=Symbol("factory");class h extends n{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.iterator(t),this.db.defer((()=>this[c]()))}}class l extends i{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.keys(t),this.db.defer((()=>this[c]()))}}class f extends s{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.values(t),this.db.defer((()=>this[c]()))}}for(const e of[h,l,f])e.prototype[c]=function(){"open"===this.db.status&&(this[a]=this[u]())},e.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer((()=>this._next(e))):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._nextv=function(e,t,r){null!==this[a]?this[a].nextv(e,t,r):"opening"===this.db.status?this.db.defer((()=>this._nextv(e,t,r))):this.nextTick(r,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer((()=>this._all(e,t))):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer((()=>this._seek(e,t)))},e.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer((()=>this._close(e))):this.nextTick(e)};t.DeferredIterator=h,t.DeferredKeyIterator=l,t.DeferredValueIterator=f},56909:function(e,t,r){"use strict";const n=r(54375);e.exports=function(e,...t){0===t.length?n(e):n((()=>e(...t)))}},70056:function(e,t,r){"use strict";const n=r(31648),i=Object.prototype.hasOwnProperty,s=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){const r={};for(const o in e)if(i.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new n(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new n("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});s.has(o)?r[o]=t.encode(e[o]):r[o]=e[o]}return r.reverse=!!r.reverse,r.limit=Number.isInteger(r.limit)&&r.limit>=0?r.limit:-1,r}},96451:function(e,t,r){"use strict";var n=r(25108);const i=r(79742),s=r(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50;const a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return h(e,t,r)}function h(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|g(e,t);let n=c(r);const i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);const i=function(e){if(u.isBuffer(e)){const t=0|y(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||Z(e.length)?c(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return l(e),c(e<0?0:0|y(e))}function d(e){const t=e.length<0?0:0|y(e.length),r=c(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,u.prototype),n}function y(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function g(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(i)return n?-1:H(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return A(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Z(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){let s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(u(e,s)===u(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===c)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){let r=!0;for(let n=0;n<c;n++)if(u(e,s+n)!==u(t,n)){r=!1;break}if(r)return s}return-1}function _(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(Z(n))return o;e[r+o]=n}return o}function E(e,t,r,n){return J(H(t,e.length-r),e,r,n)}function k(e,t,r,n){return J(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function x(e,t,r,n){return J(G(t),e,r,n)}function S(e,t,r,n){return J(function(e,t){let r,n,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function A(e,t,r){return 0===t&&r===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[i+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(s=c));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(e){const t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=C));return r}(n)}t.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,r){return h(e,t,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},u.allocUnsafe=function(e){return f(e)},u.allocUnsafeSlow=function(e){return f(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(Y(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=u.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(Y(t,Uint8Array))i+t.length>n.length?(u.isBuffer(t)||(t=u.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!u.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},u.byteLength=g,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)b(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,r,n,i){if(Y(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(s,o),c=this.slice(n,i),h=e.slice(t,r);for(let e=0;e<a;++e)if(c[e]!==h[e]){s=c[e],o=h[e];break}return s<o?-1:o<s?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return w(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return w(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":case"latin1":case"binary":return k(this,e,t,r);case"base64":return x(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function P(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function D(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=X[e[n]];return i}function R(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function B(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,r,n,i,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n,i){$(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function N(e,t,r,n,i){$(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function L(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(e,t,r,n,i){return t=+t,r>>>=0,i||L(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function j(e,t,r,n,i){return t=+t,r>>>=0,i||L(e,0,r,8),s.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=Q((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||W(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),u.prototype.readBigUInt64BE=Q((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||W(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||B(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||B(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=Q((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||W(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),u.prototype.readBigInt64BE=Q((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||W(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||B(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||B(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||B(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||B(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){M(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){M(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=Q((function(e,t=0){return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=Q((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);M(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);M(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=Q((function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=Q((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(e,t,r){return U(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return U(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return j(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return j(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const s=u.isBuffer(e)?e:u.from(e,n),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%o]}return this};const z={};function F(e,t,r){z[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function K(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function $(e,t,r,n,i,s){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new z.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){V(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||W(t,e.length-(r+1))}(n,i,s)}function V(e,t){if("number"!=typeof e)throw new z.ERR_INVALID_ARG_TYPE(t,"number",e)}function W(e,t,r){if(Math.floor(e)!==e)throw V(e,r),new z.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new z.ERR_BUFFER_OUT_OF_BOUNDS;throw new z.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}F("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),F("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),F("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=K(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=K(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const q=/[^+/0-9A-Za-z-_]/g;function H(e,t){let r;t=t||1/0;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function G(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function J(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Z(e){return e!=e}const X=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function Q(e){return"undefined"==typeof BigInt?ee:e}function ee(){throw new Error("BigInt not supported")}},32044:function(e){function t(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e)if(t&&t.addEventListener){if(t.aborted){r();break}t.addEventListener("abort",r)}return t.signal}e.exports=t,e.exports.anySignal=t},92882:function(e){"use strict";for(var t="qpzry9x8gf2tvdw0s3jn54khce6mua7l",r={},n=0;n<t.length;n++){var i=t.charAt(n);if(void 0!==r[i])throw new TypeError(i+" is ambiguous");r[i]=n}function s(e){var t=e>>25;return(33554431&e)<<5^996825010&-(t>>0&1)^642813549&-(t>>1&1)^513874426&-(t>>2&1)^1027748829&-(t>>3&1)^705979059&-(t>>4&1)}function o(e){for(var t=1,r=0;r<e.length;++r){var n=e.charCodeAt(r);if(n<33||n>126)return"Invalid prefix ("+e+")";t=s(t)^n>>5}for(t=s(t),r=0;r<e.length;++r){var i=e.charCodeAt(r);t=s(t)^31&i}return t}function a(e,t){if(t=t||90,e.length<8)return e+" too short";if(e.length>t)return"Exceeds length limit";var n=e.toLowerCase(),i=e.toUpperCase();if(e!==n&&e!==i)return"Mixed-case string "+e;var a=(e=n).lastIndexOf("1");if(-1===a)return"No separator character for "+e;if(0===a)return"Missing prefix for "+e;var c=e.slice(0,a),u=e.slice(a+1);if(u.length<6)return"Data too short";var h=o(c);if("string"==typeof h)return h;for(var l=[],f=0;f<u.length;++f){var d=u.charAt(f),p=r[d];if(void 0===p)return"Unknown character "+d;h=s(h)^p,f+6>=u.length||l.push(p)}return 1!==h?"Invalid checksum for "+e:{prefix:c,words:l}}function c(e,t,r,n){for(var i=0,s=0,o=(1<<r)-1,a=[],c=0;c<e.length;++c)for(i=i<<t|e[c],s+=t;s>=r;)s-=r,a.push(i>>s&o);if(n)s>0&&a.push(i<<r-s&o);else{if(s>=t)return"Excess padding";if(i<<r-s&o)return"Non-zero padding"}return a}e.exports={decodeUnsafe:function(){var e=a.apply(null,arguments);if("object"==typeof e)return e},decode:function(e){var t=a.apply(null,arguments);if("object"==typeof t)return t;throw new Error(t)},encode:function(e,r,n){if(n=n||90,e.length+7+r.length>n)throw new TypeError("Exceeds length limit");var i=o(e=e.toLowerCase());if("string"==typeof i)throw new Error(i);for(var a=e+"1",c=0;c<r.length;++c){var u=r[c];if(u>>5!=0)throw new Error("Non 5-bit word");i=s(i)^u,a+=t.charAt(u)}for(c=0;c<6;++c)i=s(i);for(i^=1,c=0;c<6;++c){a+=t.charAt(i>>5*(5-c)&31)}return a},toWordsUnsafe:function(e){var t=c(e,8,5,!0);if(Array.isArray(t))return t},toWords:function(e){var t=c(e,8,5,!0);if(Array.isArray(t))return t;throw new Error(t)},fromWordsUnsafe:function(e){var t=c(e,5,8,!1);if(Array.isArray(t))return t},fromWords:function(e){var t=c(e,5,8,!1);if(Array.isArray(t))return t;throw new Error(t)}}},905:function(e,t,r){"use strict";var n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,s=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,h=9007199254740991,l=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e7,d=1e9;function p(e){var t=0|e;return e>0||e===t?t:t-1}function y(e){for(var t,r,n=1,i=e.length,s=e[0]+"";n<i;){for(t=e[n++]+"",r=u-t.length;r--;t="0"+t);s+=t}for(i=s.length;48===s.charCodeAt(--i););return s.slice(0,i+1||1)}function g(e,t){var r,n,i=e.c,s=t.c,o=e.s,a=t.s,c=e.e,u=t.e;if(!o||!a)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-a:o;if(o!=a)return o;if(r=o<0,n=c==u,!i||!s)return n?0:!i^r?1:-1;if(!n)return c>u^r?1:-1;for(a=(c=i.length)<(u=s.length)?c:u,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^r?1:-1;return c==u?0:c>u^r?1:-1}function m(e,t,r,n){if(e<t||e>r||e!==s(e))throw Error(o+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function b(e){var t=e.c.length-1;return p(e.e/u)==t&&e.c[t]%2!=0}function w(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(++t>(n=e.length)){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}(function e(t){var r,_,E,k,x,S,A,I,C,P,T=V.prototype={constructor:V,toString:null,valueOf:null},D=new V(1),R=20,B=4,M=-7,O=21,N=-1e7,L=1e7,U=!1,j=1,z=0,F={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},K="0123456789abcdefghijklmnopqrstuvwxyz",$=!0;function V(e,t){var r,i,o,c,l,f,d,p,y=this;if(!(y instanceof V))return new V(e,t);if(null==t){if(e&&!0===e._isBigNumber)return y.s=e.s,void(!e.c||e.e>L?y.c=y.e=null:e.e<N?y.c=[y.e=0]:(y.e=e.e,y.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(y.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,l=e;l>=10;l/=10,c++);return void(c>L?y.c=y.e=null:(y.e=c,y.c=[e]))}p=String(e)}else{if(!n.test(p=String(e)))return E(y,p,f);y.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(c=p.indexOf("."))>-1&&(p=p.replace(".","")),(l=p.search(/e/i))>0?(c<0&&(c=l),c+=+p.slice(l+1),p=p.substring(0,l)):c<0&&(c=p.length)}else{if(m(t,2,K.length,"Base"),10==t&&$)return G(y=new V(e),R+y.e+1,B);if(p=String(e),f="number"==typeof e){if(0*e!=0)return E(y,p,f,t);if(y.s=1/e<0?(p=p.slice(1),-1):1,V.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(a+e)}else y.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(r=K.slice(0,t),c=l=0,d=p.length;l<d;l++)if(r.indexOf(i=p.charAt(l))<0){if("."==i){if(l>c){c=d;continue}}else if(!o&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){o=!0,l=-1,c=0;continue}return E(y,String(e),f,t)}f=!1,(c=(p=_(p,t,10,y.s)).indexOf("."))>-1?p=p.replace(".",""):c=p.length}for(l=0;48===p.charCodeAt(l);l++);for(d=p.length;48===p.charCodeAt(--d););if(p=p.slice(l,++d)){if(d-=l,f&&V.DEBUG&&d>15&&(e>h||e!==s(e)))throw Error(a+y.s*e);if((c=c-l-1)>L)y.c=y.e=null;else if(c<N)y.c=[y.e=0];else{if(y.e=c,y.c=[],l=(c+1)%u,c<0&&(l+=u),l<d){for(l&&y.c.push(+p.slice(0,l)),d-=u;l<d;)y.c.push(+p.slice(l,l+=u));l=u-(p=p.slice(l)).length}else l-=d;for(;l--;p+="0");y.c.push(+p)}}else y.c=[y.e=0]}function W(e,t,r,n){var i,s,o,a,c;if(null==r?r=B:m(r,0,8),!e.c)return e.toString();if(i=e.c[0],o=e.e,null==t)c=y(e.c),c=1==n||2==n&&(o<=M||o>=O)?w(c,o):v(c,o,"0");else if(s=(e=G(new V(e),t,r)).e,a=(c=y(e.c)).length,1==n||2==n&&(t<=s||s<=M)){for(;a<t;c+="0",a++);c=w(c,s)}else if(t-=o,c=v(c,s,"0"),s+1>a){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=s-a)>0)for(s+1==a&&(c+=".");t--;c+="0");return e.s<0&&i?"-"+c:c}function q(e,t){for(var r,n=1,i=new V(e[0]);n<e.length;n++){if(!(r=new V(e[n])).s){i=r;break}t.call(i,r)&&(i=r)}return i}function H(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+r*u-1)>L?e.c=e.e=null:r<N?e.c=[e.e=0]:(e.e=r,e.c=t),e}function G(e,t,r,n){var o,a,h,f,d,p,y,g=e.c,m=l;if(g){e:{for(o=1,f=g[0];f>=10;f/=10,o++);if((a=t-o)<0)a+=u,h=t,y=(d=g[p=0])/m[o-h-1]%10|0;else if((p=i((a+1)/u))>=g.length){if(!n)break e;for(;g.length<=p;g.push(0));d=y=0,o=1,h=(a%=u)-u+1}else{for(d=f=g[p],o=1;f>=10;f/=10,o++);y=(h=(a%=u)-u+o)<0?0:d/m[o-h-1]%10|0}if(n=n||t<0||null!=g[p+1]||(h<0?d:d%m[o-h-1]),n=r<4?(y||n)&&(0==r||r==(e.s<0?3:2)):y>5||5==y&&(4==r||n||6==r&&(a>0?h>0?d/m[o-h]:0:g[p-1])%10&1||r==(e.s<0?8:7)),t<1||!g[0])return g.length=0,n?(t-=e.e+1,g[0]=m[(u-t%u)%u],e.e=-t||0):g[0]=e.e=0,e;if(0==a?(g.length=p,f=1,p--):(g.length=p+1,f=m[u-a],g[p]=h>0?s(d/m[o-h]%m[h])*f:0),n)for(;;){if(0==p){for(a=1,h=g[0];h>=10;h/=10,a++);for(h=g[0]+=f,f=1;h>=10;h/=10,f++);a!=f&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[p]+=f,g[p]!=c)break;g[p--]=0,f=1}for(a=g.length;0===g[--a];g.pop());}e.e>L?e.c=e.e=null:e.e<N&&(e.c=[e.e=0])}return e}function J(e){var t,r=e.e;return null===r?e.toString():(t=y(e.c),t=r<=M||r>=O?w(t,r):v(t,r,"0"),e.s<0?"-"+t:t)}return V.clone=e,V.ROUND_UP=0,V.ROUND_DOWN=1,V.ROUND_CEIL=2,V.ROUND_FLOOR=3,V.ROUND_HALF_UP=4,V.ROUND_HALF_DOWN=5,V.ROUND_HALF_EVEN=6,V.ROUND_HALF_CEIL=7,V.ROUND_HALF_FLOOR=8,V.EUCLID=9,V.config=V.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(o+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(m(r=e[t],0,d,t),R=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(m(r=e[t],0,8,t),B=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(m(r[0],-d,0,t),m(r[1],0,d,t),M=r[0],O=r[1]):(m(r,-d,d,t),M=-(O=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)m(r[0],-d,-1,t),m(r[1],1,d,t),N=r[0],L=r[1];else{if(m(r,-d,d,t),!r)throw Error(o+t+" cannot be zero: "+r);N=-(L=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(o+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw U=!r,Error(o+"crypto unavailable");U=r}else U=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(m(r=e[t],0,9,t),j=r),e.hasOwnProperty(t="POW_PRECISION")&&(m(r=e[t],0,d,t),z=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(o+t+" not an object: "+r);F=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(o+t+" invalid: "+r);$="0123456789"==r.slice(0,10),K=r}}return{DECIMAL_PLACES:R,ROUNDING_MODE:B,EXPONENTIAL_AT:[M,O],RANGE:[N,L],CRYPTO:U,MODULO_MODE:j,POW_PRECISION:z,FORMAT:F,ALPHABET:K}},V.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!V.DEBUG)return!0;var t,r,n=e.c,i=e.e,a=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===a||-1===a)&&i>=-d&&i<=d&&i===s(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%u)<1&&(t+=u),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=c||r!==s(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===a||1===a||-1===a))return!0;throw Error(o+"Invalid BigNumber: "+e)},V.maximum=V.max=function(){return q(arguments,T.lt)},V.minimum=V.min=function(){return q(arguments,T.gt)},V.random=(k=9007199254740992,x=Math.random()*k&2097151?function(){return s(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,a,c,h=0,f=[],p=new V(D);if(null==e?e=R:m(e,0,d),a=i(e/u),U)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(a*=2));h<a;)(c=131072*t[h]+(t[h+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[h]=r[0],t[h+1]=r[1]):(f.push(c%1e14),h+=2);h=a/2}else{if(!crypto.randomBytes)throw U=!1,Error(o+"crypto unavailable");for(t=crypto.randomBytes(a*=7);h<a;)(c=281474976710656*(31&t[h])+1099511627776*t[h+1]+4294967296*t[h+2]+16777216*t[h+3]+(t[h+4]<<16)+(t[h+5]<<8)+t[h+6])>=9e15?crypto.randomBytes(7).copy(t,h):(f.push(c%1e14),h+=7);h=a/7}if(!U)for(;h<a;)(c=x())<9e15&&(f[h++]=c%1e14);for(a=f[--h],e%=u,a&&e&&(c=l[u-e],f[h]=s(a/c)*c);0===f[h];f.pop(),h--);if(h<0)f=[n=0];else{for(n=-1;0===f[0];f.splice(0,1),n-=u);for(h=1,c=f[0];c>=10;c/=10,h++);h<u&&(n-=u-h)}return p.e=n,p.c=f,p}),V.sum=function(){for(var e=1,t=arguments,r=new V(t[0]);e<t.length;)r=r.plus(t[e++]);return r},_=function(){var e="0123456789";function t(e,t,r,n){for(var i,s,o=[0],a=0,c=e.length;a<c;){for(s=o.length;s--;o[s]*=t);for(o[0]+=n.indexOf(e.charAt(a++)),i=0;i<o.length;i++)o[i]>r-1&&(null==o[i+1]&&(o[i+1]=0),o[i+1]+=o[i]/r|0,o[i]%=r)}return o.reverse()}return function(n,i,s,o,a){var c,u,h,l,f,d,p,g,m=n.indexOf("."),b=R,w=B;for(m>=0&&(l=z,z=0,n=n.replace(".",""),d=(g=new V(i)).pow(n.length-m),z=l,g.c=t(v(y(d.c),d.e,"0"),10,s,e),g.e=g.c.length),h=l=(p=t(n,i,s,a?(c=K,e):(c=e,K))).length;0==p[--l];p.pop());if(!p[0])return c.charAt(0);if(m<0?--h:(d.c=p,d.e=h,d.s=o,p=(d=r(d,g,b,w,s)).c,f=d.r,h=d.e),m=p[u=h+b+1],l=s/2,f=f||u<0||null!=p[u+1],f=w<4?(null!=m||f)&&(0==w||w==(d.s<0?3:2)):m>l||m==l&&(4==w||f||6==w&&1&p[u-1]||w==(d.s<0?8:7)),u<1||!p[0])n=f?v(c.charAt(1),-b,c.charAt(0)):c.charAt(0);else{if(p.length=u,f)for(--s;++p[--u]>s;)p[u]=0,u||(++h,p=[1].concat(p));for(l=p.length;!p[--l];);for(m=0,n="";m<=l;n+=c.charAt(p[m++]));n=v(n,h,c.charAt(0))}return n}}(),r=function(){function e(e,t,r){var n,i,s,o,a=0,c=e.length,u=t%f,h=t/f|0;for(e=e.slice();c--;)a=((i=u*(s=e[c]%f)+(n=h*s+(o=e[c]/f|0)*u)%f*f+a)/r|0)+(n/f|0)+h*o,e[c]=i%r;return a&&(e=[a].concat(e)),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,o,a,h){var l,f,d,y,g,m,b,w,v,_,E,k,x,S,A,I,C,P=n.s==i.s?1:-1,T=n.c,D=i.c;if(!(T&&T[0]&&D&&D[0]))return new V(n.s&&i.s&&(T?!D||T[0]!=D[0]:D)?T&&0==T[0]||!D?0*P:P/0:NaN);for(v=(w=new V(P)).c=[],P=o+(f=n.e-i.e)+1,h||(h=c,f=p(n.e/u)-p(i.e/u),P=P/u|0),d=0;D[d]==(T[d]||0);d++);if(D[d]>(T[d]||0)&&f--,P<0)v.push(1),y=!0;else{for(S=T.length,I=D.length,d=0,P+=2,(g=s(h/(D[0]+1)))>1&&(D=e(D,g,h),T=e(T,g,h),I=D.length,S=T.length),x=I,E=(_=T.slice(0,I)).length;E<I;_[E++]=0);C=D.slice(),C=[0].concat(C),A=D[0],D[1]>=h/2&&A++;do{if(g=0,(l=t(D,_,I,E))<0){if(k=_[0],I!=E&&(k=k*h+(_[1]||0)),(g=s(k/A))>1)for(g>=h&&(g=h-1),b=(m=e(D,g,h)).length,E=_.length;1==t(m,_,b,E);)g--,r(m,I<b?C:D,b,h),b=m.length,l=1;else 0==g&&(l=g=1),b=(m=D.slice()).length;if(b<E&&(m=[0].concat(m)),r(_,m,E,h),E=_.length,-1==l)for(;t(D,_,I,E)<1;)g++,r(_,I<E?C:D,E,h),E=_.length}else 0===l&&(g++,_=[0]);v[d++]=g,_[0]?_[E++]=T[x]||0:(_=[T[x]],E=1)}while((x++<S||null!=_[0])&&P--);y=null!=_[0],v[0]||v.splice(0,1)}if(h==c){for(d=1,P=v[0];P>=10;P/=10,d++);G(w,o+(w.e=d+f*u-1)+1,a,y)}else w.e=f,w.r=+y;return w}}(),S=/^(-?)0([xbo])(?=\w[\w.]*$)/i,A=/^([^.]+)\.$/,I=/^\.([^.]+)$/,C=/^-?(Infinity|NaN)$/,P=/^\s*\+(?=[\w.])|^\s+|\s+$/g,E=function(e,t,r,n){var i,s=r?t:t.replace(P,"");if(C.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(S,(function(e,t,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?e:t})),n&&(i=n,s=s.replace(A,"$1").replace(I,"0.$1")),t!=s))return new V(s,i);if(V.DEBUG)throw Error(o+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},T.absoluteValue=T.abs=function(){var e=new V(this);return e.s<0&&(e.s=1),e},T.comparedTo=function(e,t){return g(this,new V(e,t))},T.decimalPlaces=T.dp=function(e,t){var r,n,i,s=this;if(null!=e)return m(e,0,d),null==t?t=B:m(t,0,8),G(new V(s),e+s.e+1,t);if(!(r=s.c))return null;if(n=((i=r.length-1)-p(this.e/u))*u,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},T.dividedBy=T.div=function(e,t){return r(this,new V(e,t),R,B)},T.dividedToIntegerBy=T.idiv=function(e,t){return r(this,new V(e,t),0,1)},T.exponentiatedBy=T.pow=function(e,t){var r,n,a,c,h,l,f,d,p=this;if((e=new V(e)).c&&!e.isInteger())throw Error(o+"Exponent not an integer: "+J(e));if(null!=t&&(t=new V(t)),h=e.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!e.c||!e.c[0])return d=new V(Math.pow(+J(p),h?e.s*(2-b(e)):+J(e))),t?d.mod(t):d;if(l=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new V(NaN);(n=!l&&p.isInteger()&&t.isInteger())&&(p=p.mod(t))}else{if(e.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||h&&p.c[1]>=24e7:p.c[0]<8e13||h&&p.c[0]<=9999975e7)))return c=p.s<0&&b(e)?-0:0,p.e>-1&&(c=1/c),new V(l?1/c:c);z&&(c=i(z/u+2))}for(h?(r=new V(.5),l&&(e.s=1),f=b(e)):f=(a=Math.abs(+J(e)))%2,d=new V(D);;){if(f){if(!(d=d.times(p)).c)break;c?d.c.length>c&&(d.c.length=c):n&&(d=d.mod(t))}if(a){if(0===(a=s(a/2)))break;f=a%2}else if(G(e=e.times(r),e.e+1,1),e.e>14)f=b(e);else{if(0===(a=+J(e)))break;f=a%2}p=p.times(p),c?p.c&&p.c.length>c&&(p.c.length=c):n&&(p=p.mod(t))}return n?d:(l&&(d=D.div(d)),t?d.mod(t):c?G(d,z,B,undefined):d)},T.integerValue=function(e){var t=new V(this);return null==e?e=B:m(e,0,8),G(t,t.e+1,e)},T.isEqualTo=T.eq=function(e,t){return 0===g(this,new V(e,t))},T.isFinite=function(){return!!this.c},T.isGreaterThan=T.gt=function(e,t){return g(this,new V(e,t))>0},T.isGreaterThanOrEqualTo=T.gte=function(e,t){return 1===(t=g(this,new V(e,t)))||0===t},T.isInteger=function(){return!!this.c&&p(this.e/u)>this.c.length-2},T.isLessThan=T.lt=function(e,t){return g(this,new V(e,t))<0},T.isLessThanOrEqualTo=T.lte=function(e,t){return-1===(t=g(this,new V(e,t)))||0===t},T.isNaN=function(){return!this.s},T.isNegative=function(){return this.s<0},T.isPositive=function(){return this.s>0},T.isZero=function(){return!!this.c&&0==this.c[0]},T.minus=function(e,t){var r,n,i,s,o=this,a=o.s;if(t=(e=new V(e,t)).s,!a||!t)return new V(NaN);if(a!=t)return e.s=-t,o.plus(e);var h=o.e/u,l=e.e/u,f=o.c,d=e.c;if(!h||!l){if(!f||!d)return f?(e.s=-t,e):new V(d?o:NaN);if(!f[0]||!d[0])return d[0]?(e.s=-t,e):new V(f[0]?o:3==B?-0:0)}if(h=p(h),l=p(l),f=f.slice(),a=h-l){for((s=a<0)?(a=-a,i=f):(l=h,i=d),i.reverse(),t=a;t--;i.push(0));i.reverse()}else for(n=(s=(a=f.length)<(t=d.length))?a:t,a=t=0;t<n;t++)if(f[t]!=d[t]){s=f[t]<d[t];break}if(s&&(i=f,f=d,d=i,e.s=-e.s),(t=(n=d.length)-(r=f.length))>0)for(;t--;f[r++]=0);for(t=c-1;n>a;){if(f[--n]<d[n]){for(r=n;r&&!f[--r];f[r]=t);--f[r],f[n]+=c}f[n]-=d[n]}for(;0==f[0];f.splice(0,1),--l);return f[0]?H(e,f,l):(e.s=3==B?-1:1,e.c=[e.e=0],e)},T.modulo=T.mod=function(e,t){var n,i,s=this;return e=new V(e,t),!s.c||!e.s||e.c&&!e.c[0]?new V(NaN):!e.c||s.c&&!s.c[0]?new V(s):(9==j?(i=e.s,e.s=1,n=r(s,e,0,3),e.s=i,n.s*=i):n=r(s,e,0,j),(e=s.minus(n.times(e))).c[0]||1!=j||(e.s=s.s),e)},T.multipliedBy=T.times=function(e,t){var r,n,i,s,o,a,h,l,d,y,g,m,b,w,v,_=this,E=_.c,k=(e=new V(e,t)).c;if(!(E&&k&&E[0]&&k[0]))return!_.s||!e.s||E&&!E[0]&&!k||k&&!k[0]&&!E?e.c=e.e=e.s=null:(e.s*=_.s,E&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=p(_.e/u)+p(e.e/u),e.s*=_.s,(h=E.length)<(y=k.length)&&(b=E,E=k,k=b,i=h,h=y,y=i),i=h+y,b=[];i--;b.push(0));for(w=c,v=f,i=y;--i>=0;){for(r=0,g=k[i]%v,m=k[i]/v|0,s=i+(o=h);s>i;)r=((l=g*(l=E[--o]%v)+(a=m*l+(d=E[o]/v|0)*g)%v*v+b[s]+r)/w|0)+(a/v|0)+m*d,b[s--]=l%w;b[s]=r}return r?++n:b.splice(0,1),H(e,b,n)},T.negated=function(){var e=new V(this);return e.s=-e.s||null,e},T.plus=function(e,t){var r,n=this,i=n.s;if(t=(e=new V(e,t)).s,!i||!t)return new V(NaN);if(i!=t)return e.s=-t,n.minus(e);var s=n.e/u,o=e.e/u,a=n.c,h=e.c;if(!s||!o){if(!a||!h)return new V(i/0);if(!a[0]||!h[0])return h[0]?e:new V(a[0]?n:0*i)}if(s=p(s),o=p(o),a=a.slice(),i=s-o){for(i>0?(o=s,r=h):(i=-i,r=a),r.reverse();i--;r.push(0));r.reverse()}for((i=a.length)-(t=h.length)<0&&(r=h,h=a,a=r,t=i),i=0;t;)i=(a[--t]=a[t]+h[t]+i)/c|0,a[t]=c===a[t]?0:a[t]%c;return i&&(a=[i].concat(a),++o),H(e,a,o)},T.precision=T.sd=function(e,t){var r,n,i,s=this;if(null!=e&&e!==!!e)return m(e,1,d),null==t?t=B:m(t,0,8),G(new V(s),e,t);if(!(r=s.c))return null;if(n=(i=r.length-1)*u+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&s.e+1>n&&(n=s.e+1),n},T.shiftedBy=function(e){return m(e,-9007199254740991,h),this.times("1e"+e)},T.squareRoot=T.sqrt=function(){var e,t,n,i,s,o=this,a=o.c,c=o.s,u=o.e,h=R+4,l=new V("0.5");if(1!==c||!a||!a[0])return new V(!c||c<0&&(!a||a[0])?NaN:a?o:1/0);if(0==(c=Math.sqrt(+J(o)))||c==1/0?(((t=y(a)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=p((u+1)/2)-(u<0||u%2),n=new V(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):n=new V(c+""),n.c[0])for((c=(u=n.e)+h)<3&&(c=0);;)if(s=n,n=l.times(s.plus(r(o,s,h,1))),y(s.c).slice(0,c)===(t=y(n.c)).slice(0,c)){if(n.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(G(n,n.e+R+2,1),e=!n.times(n).eq(o));break}if(!i&&(G(s,s.e+R+2,0),s.times(s).eq(o))){n=s;break}h+=4,c+=4,i=1}return G(n,n.e+R+1,B,e)},T.toExponential=function(e,t){return null!=e&&(m(e,0,d),e++),W(this,e,t,1)},T.toFixed=function(e,t){return null!=e&&(m(e,0,d),e=e+this.e+1),W(this,e,t)},T.toFormat=function(e,t,r){var n,i=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=F;else if("object"!=typeof r)throw Error(o+"Argument not an object: "+r);if(n=i.toFixed(e,t),i.c){var s,a=n.split("."),c=+r.groupSize,u=+r.secondaryGroupSize,h=r.groupSeparator||"",l=a[0],f=a[1],d=i.s<0,p=d?l.slice(1):l,y=p.length;if(u&&(s=c,c=u,u=s,y-=s),c>0&&y>0){for(s=y%c||c,l=p.substr(0,s);s<y;s+=c)l+=h+p.substr(s,c);u>0&&(l+=h+p.slice(s)),d&&(l="-"+l)}n=f?l+(r.decimalSeparator||"")+((u=+r.fractionGroupSize)?f.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):f):l}return(r.prefix||"")+n+(r.suffix||"")},T.toFraction=function(e){var t,n,i,s,a,c,h,f,d,p,g,m,b=this,w=b.c;if(null!=e&&(!(h=new V(e)).isInteger()&&(h.c||1!==h.s)||h.lt(D)))throw Error(o+"Argument "+(h.isInteger()?"out of range: ":"not an integer: ")+J(h));if(!w)return new V(b);for(t=new V(D),d=n=new V(D),i=f=new V(D),m=y(w),a=t.e=m.length-b.e-1,t.c[0]=l[(c=a%u)<0?u+c:c],e=!e||h.comparedTo(t)>0?a>0?t:d:h,c=L,L=1/0,h=new V(m),f.c[0]=0;p=r(h,t,0,1),1!=(s=n.plus(p.times(i))).comparedTo(e);)n=i,i=s,d=f.plus(p.times(s=d)),f=s,t=h.minus(p.times(s=t)),h=s;return s=r(e.minus(n),i,0,1),f=f.plus(s.times(d)),n=n.plus(s.times(i)),f.s=d.s=b.s,g=r(d,i,a*=2,B).minus(b).abs().comparedTo(r(f,n,a,B).minus(b).abs())<1?[d,i]:[f,n],L=c,g},T.toNumber=function(){return+J(this)},T.toPrecision=function(e,t){return null!=e&&m(e,1,d),W(this,e,t,2)},T.toString=function(e){var t,r=this,n=r.s,i=r.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=M||i>=O?w(y(r.c),i):v(y(r.c),i,"0"):10===e&&$?t=v(y((r=G(new V(r),R+i+1,B)).c),r.e,"0"):(m(e,2,K.length,"Base"),t=_(v(y(r.c),i,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},T.valueOf=T.toJSON=function(){return J(this)},T._isBigNumber=!0,T[Symbol.toStringTag]="BigNumber",T[Symbol.for("nodejs.util.inspect.custom")]=T.valueOf,null!=t&&V.set(t),V})()},11708:function(e,t,r){"use strict";const{AbstractLevel:n}=r(50875),i=r(31648),s=r(29967),{fromCallback:o}=r(16957),{Iterator:a}=r(8212),c=r(89687),u=r(89968),h=r(21217),l="level-js-",f=Symbol("idb"),d=Symbol("namePrefix"),p=Symbol("location"),y=Symbol("version"),g=Symbol("store"),m=Symbol("onComplete"),b=Symbol("promise");class w extends n{constructor(e,t,r){if("function"==typeof t||"function"==typeof r)throw new i("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:n,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof e)throw new Error("constructor requires a location string argument");this[p]=e,this[d]=null==n?l:n,this[y]=parseInt(s||1,10),this[f]=null}get location(){return this[p]}get namePrefix(){return this[d]}get version(){return this[y]}get db(){return this[f]}get type(){return"browser-level"}_open(e,t){const r=indexedDB.open(this[d]+this[p],this[y]);r.onerror=function(){t(r.error||new Error("unknown error"))},r.onsuccess=()=>{this[f]=r.result,t()},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this[p])||t.createObjectStore(this[p])}}[g](e){return this[f].transaction([this[p]],e).objectStore(this[p])}[m](e,t){const r=e.transaction;r.onabort=function(){t(r.error||new Error("aborted by user"))},r.oncomplete=function(){t(null,e.result)}}_get(e,t,r){const n=this[g]("readonly");let s;try{s=n.get(e)}catch(e){return this.nextTick(r,e)}this[m](s,(function(e,t){return e?r(e):void 0===t?r(new i("Entry not found",{code:"LEVEL_NOT_FOUND"})):void r(null,c(t))}))}_getMany(e,t,r){const n=this[g]("readonly"),i=e.map((e=>t=>{let r;try{r=n.get(e)}catch(e){return t(e)}r.onsuccess=()=>{const e=r.result;t(null,void 0===e?e:c(e))},r.onerror=e=>{e.stopPropagation(),t(r.error)}}));s(i,16,r)}_del(e,t,r){const n=this[g]("readwrite");let i;try{i=n.delete(e)}catch(e){return this.nextTick(r,e)}this[m](i,r)}_put(e,t,r,n){const i=this[g]("readwrite");let s;try{s=i.put(t,e)}catch(e){return this.nextTick(n,e)}this[m](s,n)}_iterator(e){return new a(this,this[p],e)}_batch(e,t,r){const n=this[g]("readwrite"),i=n.transaction;let s,o=0;i.onabort=function(){r(s||i.error||new Error("aborted by user"))},i.oncomplete=function(){r()},function t(){const r=e[o++],a=r.key;let c;try{c="del"===r.type?n.delete(a):n.put(r.value,a)}catch(e){return s=e,void i.abort()}o<e.length?c.onsuccess=t:"function"==typeof i.commit&&i.commit()}()}_clear(e,t){let r,n;try{r=h(e)}catch(e){return this.nextTick(t)}if(e.limit>=0)return u(this,this[p],r,e,t);try{const e=this[g]("readwrite");n=r?e.delete(r):e.clear()}catch(e){return this.nextTick(t,e)}this[m](n,t)}_close(e){this[f].close(),this.nextTick(e)}}w.destroy=function(e,t,r){"function"==typeof t&&(r=t,t=l),r=o(r,b);const n=indexedDB.deleteDatabase(t+e);return n.onsuccess=function(){r()},n.onerror=function(e){r(e)},r[b]},t.BrowserLevel=w},8212:function(e,t,r){"use strict";const{AbstractIterator:n}=r(50875),i=r(21217),s=r(89687),o=Symbol("cache"),a=Symbol("finished"),c=Symbol("options"),u=Symbol("currentOptions"),h=Symbol("position"),l=Symbol("location"),f=Symbol("first"),d={};function p(e){"function"==typeof e.commit&&e.commit()}t.Iterator=class extends n{constructor(e,t,r){super(e,r),this[o]=[],this[a]=0===this.limit,this[c]=r,this[u]={...r},this[h]=void 0,this[l]=t,this[f]=!0}_nextv(e,t,r){if(this[f]=!1,this[a])return this.nextTick(r,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(r,null,this[o].splice(0,e));let n;void 0!==this[h]&&(this[c].reverse?(this[u].lt=this[h],this[u].lte=void 0):(this[u].gt=this[h],this[u].gte=void 0));try{n=i(this[u])}catch(e){return this[a]=!0,this.nextTick(r,null,[])}const d=this.db.db.transaction([this[l]],"readonly"),y=d.objectStore(this[l]),g=[];if(this[c].reverse){y[!this[c].values&&y.openKeyCursor?"openKeyCursor":"openCursor"](n,"prev").onsuccess=t=>{const r=t.target.result;if(r){const{key:t,value:n}=r;this[h]=t,g.push([this[c].keys&&void 0!==t?s(t):void 0,this[c].values&&void 0!==n?s(n):void 0]),g.length<e?r.continue():p(d)}else this[a]=!0}}else{let t,r;const i=()=>{if(void 0===t||void 0===r)return;const n=Math.max(t.length,r.length);0===n||e===1/0?this[a]=!0:this[h]=t[n-1],g.length=n;for(let e=0;e<n;e++){const n=t[e],i=r[e];g[e]=[this[c].keys&&void 0!==n?s(n):void 0,this[c].values&&void 0!==i?s(i):void 0]}p(d)};this[c].keys||e<1/0?y.getAllKeys(n,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,i()}:(t=[],this.nextTick(i)),this[c].values?y.getAll(n,e<1/0?e:void 0).onsuccess=e=>{r=e.target.result,i()}:(r=[],this.nextTick(i))}d.onabort=()=>{r(d.error||new Error("aborted by user")),r=null},d.oncomplete=()=>{r(null,g),r=null}}_next(e){if(this[o].length>0){const[t,r]=this[o].shift();this.nextTick(e,null,t,r)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[f]&&(this[f]=!1,t=1),this._nextv(t,d,((t,r)=>{if(t)return e(t);this[o]=r,this._next(e)}))}}_all(e,t){this[f]=!1;const r=this[o].splice(0,this[o].length),n=this.limit-this.count-r.length;if(n<=0)return this.nextTick(t,null,r);this._nextv(n,d,((e,n)=>{if(e)return t(e);r.length>0&&(n=r.concat(n)),t(null,n)}))}_seek(e,t){let r;this[f]=!0,this[o]=[],this[a]=!1,this[h]=void 0,this[u]={...this[c]};try{r=i(this[c])}catch(e){return void(this[a]=!0)}null===r||r.includes(e)?this[c].reverse?this[u].lte=e:this[u].gte=e:this[a]=!0}}},89968:function(e){"use strict";e.exports=function(e,t,r,n,i){if(0===n.limit)return e.nextTick(i);const s=e.db.transaction([t],"readwrite"),o=s.objectStore(t);let a=0;s.oncomplete=function(){i()},s.onabort=function(){i(s.error||new Error("aborted by user"))};const c=o.openKeyCursor?"openKeyCursor":"openCursor",u=n.reverse?"prev":"next";o[c](r,u).onsuccess=function(e){const t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(n.limit<=0||++a<n.limit)&&t.continue()})}}},89687:function(e){"use strict";const t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},21217:function(e){"use strict";e.exports=function(e){const t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,r=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,n=void 0===e.gte,i=void 0===e.lte;return void 0!==t&&void 0!==r?IDBKeyRange.bound(t,r,n,i):void 0!==t?IDBKeyRange.lowerBound(t,n):void 0!==r?IDBKeyRange.upperBound(r,i):null}},48764:function(e,t,r){"use strict";var n=r(25108),i=r(79742),s=r(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50;var a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return h(e,t,r)}function h(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|g(e,t),n=c(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(K(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(K(e,ArrayBuffer)||e&&K(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(K(e,SharedArrayBuffer)||e&&K(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);var i=function(e){if(u.isBuffer(e)){var t=0|y(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||$(e.length)?c(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return l(e),c(e<0?0:0|y(e))}function d(e){for(var t=e.length<0?0:0|y(e.length),r=c(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,u.prototype),n}function y(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function g(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||K(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(i)return n?-1:j(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return A(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),$(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var h=-1;for(s=r;s<a;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(u(e,s+f)!==u(t,f)){l=!1;break}if(l)return s}return-1}function _(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if($(a))return o;e[r+o]=a}return o}function E(e,t,r,n){return F(j(t,e.length-r),e,r,n)}function k(e,t,r,n){return F(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function x(e,t,r,n){return F(z(t),e,r,n)}function S(e,t,r,n){return F(function(e,t){for(var r,n,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function A(e,t,r){return 0===t&&r===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,o,a,c,u=e[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=r)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=e[i+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=l}return function(e){var t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=C));return r}(n)}t.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,r){return h(e,t,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},u.allocUnsafe=function(e){return f(e)},u.allocUnsafeSlow=function(e){return f(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(K(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),K(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(K(s,Uint8Array))i+s.length>n.length?u.from(s).copy(n,i):Uint8Array.prototype.set.call(n,s,i);else{if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i)}i+=s.length}return n},u.byteLength=g,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,r,n,i){if(K(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(s,o),c=this.slice(n,i),h=e.slice(t,r),l=0;l<a;++l)if(c[l]!==h[l]){s=c[l],o=h[l];break}return s<o?-1:o<s?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return w(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return w(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":case"latin1":case"binary":return k(this,e,t,r);case"base64":return x(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function D(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=V[e[s]];return i}function R(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function B(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,r,n,i,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,i){return t=+t,r>>>=0,i||O(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,i){return t=+t,r>>>=0,i||O(e,0,r,8),s.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||B(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||B(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||B(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||B(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||B(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||B(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||B(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||M(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||M(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,e,t,r,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<r&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,e,t,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var o=u.isBuffer(e)?e:u.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=o[s%a]}return this};var U=/[^+/0-9A-Za-z-_]/g;function j(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function z(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function K(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function $(e){return e!=e}var V=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},79830:function(e){"use strict";e.exports=function(e,t){if("string"==typeof e)return o(e);if("number"==typeof e)return s(e,t);return null},e.exports.format=s,e.exports.parse=o;var t=/\B(?=(\d{3})+(?!\d))/g,r=/(?:\.0*|(\.[^0]+)0+)$/,n={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},i=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function s(e,i){if(!Number.isFinite(e))return null;var s=Math.abs(e),o=i&&i.thousandsSeparator||"",a=i&&i.unitSeparator||"",c=i&&void 0!==i.decimalPlaces?i.decimalPlaces:2,u=Boolean(i&&i.fixedDecimals),h=i&&i.unit||"";h&&n[h.toLowerCase()]||(h=s>=n.pb?"PB":s>=n.tb?"TB":s>=n.gb?"GB":s>=n.mb?"MB":s>=n.kb?"KB":"B");var l=(e/n[h.toLowerCase()]).toFixed(c);return u||(l=l.replace(r,"$1")),o&&(l=l.split(".").map((function(e,r){return 0===r?e.replace(t,o):e})).join(".")),l+a+h}function o(e){if("number"==typeof e&&!isNaN(e))return e;if("string"!=typeof e)return null;var t,r=i.exec(e),s="b";return r?(t=parseFloat(r[1]),s=r[4].toLowerCase()):(t=parseInt(e,10),s="b"),isNaN(t)?null:Math.floor(n[s]*t)}},16957:function(e,t,r){"use strict";var n=r(90886);t.fromCallback=function(e,t){if(void 0===e){var r=new Promise((function(t,r){e=function(e,n){e?r(e):t(n)}}));e[void 0!==t?t:"promise"]=r}else if("function"!=typeof e)throw new TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then((function(e){n((()=>t(null,e)))})).catch((function(e){n((()=>t(e)))}))}},90886:function(e){e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},99870:function(e,t,r){"use strict";r.d(t,{Jj:function(){return l},Y6:function(){return h},Yy:function(){return o},sj:function(){return v}});var n=r(25108);const i=Symbol("Comlink.proxy"),s=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),c=Symbol("Comlink.thrown"),u=e=>"object"==typeof e&&null!==e||"function"==typeof e,h=new Map([["proxy",{canHandle:e=>u(e)&&e[i],serialize(e){const{port1:t,port2:r}=new MessageChannel;return l(e,t),[r,[r]]},deserialize(e){return e.start(),m(e,[],t);var t}}],["throw",{canHandle:e=>u(e)&&c in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function l(e,t=globalThis,r=["*"]){t.addEventListener("message",(function i(s){if(!s||!s.data)return;if(!function(e,t){for(const r of e){if(t===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}return!1}(r,s.origin))return void n.warn(`Invalid origin '${s.origin}' for comlink proxy`);const{id:o,type:u,path:h}=Object.assign({path:[]},s.data),d=(s.data.argumentList||[]).map(E);let p;try{const t=h.slice(0,-1).reduce(((e,t)=>e[t]),e),r=h.reduce(((e,t)=>e[t]),e);switch(u){case"GET":p=r;break;case"SET":t[h.slice(-1)[0]]=E(s.data.value),p=!0;break;case"APPLY":p=r.apply(t,d);break;case"CONSTRUCT":p=v(new r(...d));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;l(e,r),p=function(e,t){return w.set(e,t),e}(t,[t])}break;case"RELEASE":p=void 0;break;default:return}}catch(e){p={value:e,[c]:0}}Promise.resolve(p).catch((e=>({value:e,[c]:0}))).then((r=>{const[n,s]=_(r);t.postMessage(Object.assign(Object.assign({},n),{id:o}),s),"RELEASE"===u&&(t.removeEventListener("message",i),f(t),a in e&&"function"==typeof e[a]&&e[a]())})).catch((e=>{const[r,n]=_({value:new TypeError("Unserializable return value"),[c]:0});t.postMessage(Object.assign(Object.assign({},r),{id:o}),n)}))})),t.start&&t.start()}function f(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function d(e){if(e)throw new Error("Proxy has been released and is not useable")}function p(e){return k(e,{type:"RELEASE"}).then((()=>{f(e)}))}const y=new WeakMap,g="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(y.get(e)||0)-1;y.set(e,t),0===t&&p(e)}));function m(e,t=[],r=function(){}){let n=!1;const i=new Proxy(r,{get(r,s){if(d(n),s===o)return()=>{!function(e){g&&g.unregister(e)}(i),p(e),n=!0};if("then"===s){if(0===t.length)return{then:()=>i};const r=k(e,{type:"GET",path:t.map((e=>e.toString()))}).then(E);return r.then.bind(r)}return m(e,[...t,s])},set(r,i,s){d(n);const[o,a]=_(s);return k(e,{type:"SET",path:[...t,i].map((e=>e.toString())),value:o},a).then(E)},apply(r,i,o){d(n);const a=t[t.length-1];if(a===s)return k(e,{type:"ENDPOINT"}).then(E);if("bind"===a)return m(e,t.slice(0,-1));const[c,u]=b(o);return k(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:c},u).then(E)},construct(r,i){d(n);const[s,o]=b(i);return k(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},o).then(E)}});return function(e,t){const r=(y.get(t)||0)+1;y.set(t,r),g&&g.register(e,t,e)}(i,e),i}function b(e){const t=e.map(_);return[t.map((e=>e[0])),(r=t.map((e=>e[1])),Array.prototype.concat.apply([],r))];var r}const w=new WeakMap;function v(e){return Object.assign(e,{[i]:!0})}function _(e){for(const[t,r]of h)if(r.canHandle(e)){const[n,i]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},i]}return[{type:"RAW",value:e},w.get(e)||[]]}function E(e){switch(e.type){case"HANDLER":return h.get(e.name).deserialize(e.value);case"RAW":return e.value}}function k(e,t,r){return new Promise((n=>{const i=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(r){r.data&&r.data.id&&r.data.id===i&&(e.removeEventListener("message",t),n(r.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:i},t),r)}))}},98994:function(e,t,r){"use strict";t.MsgSetSendEnabledResponse=t.MsgSetSendEnabled=t.MsgUpdateParamsResponse=t.MsgUpdateParams=t.MsgMultiSendResponse=t.MsgMultiSend=t.MsgSendResponse=t.MsgSend=void 0;const n=r(10891),i=r(74343),s=r(93841),o=r(81457);function a(){return{authority:"",params:i.Params.fromPartial({})}}t.MsgSend={typeUrl:"/cosmos.bank.v1beta1.MsgSend",encode(e,t=s.BinaryWriter.create()){""!==e.fromAddress&&t.uint32(10).string(e.fromAddress),""!==e.toAddress&&t.uint32(18).string(e.toAddress);for(const r of e.amount)n.Coin.encode(r,t.uint32(26).fork()).ldelim();return t},decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let i=void 0===t?r.len:r.pos+t;const o={fromAddress:"",toAddress:"",amount:[]};for(;r.pos<i;){const e=r.uint32();switch(e>>>3){case 1:o.fromAddress=r.string();break;case 2:o.toAddress=r.string();break;case 3:o.amount.push(n.Coin.decode(r,r.uint32()));break;default:r.skipType(7&e)}}return o},fromJSON(e){const t={fromAddress:"",toAddress:"",amount:[]};return(0,o.isSet)(e.fromAddress)&&(t.fromAddress=String(e.fromAddress)),(0,o.isSet)(e.toAddress)&&(t.toAddress=String(e.toAddress)),Array.isArray(e?.amount)&&(t.amount=e.amount.map((e=>n.Coin.fromJSON(e)))),t},toJSON(e){const t={};return void 0!==e.fromAddress&&(t.fromAddress=e.fromAddress),void 0!==e.toAddress&&(t.toAddress=e.toAddress),e.amount?t.amount=e.amount.map((e=>e?n.Coin.toJSON(e):void 0)):t.amount=[],t},fromPartial(e){const t={fromAddress:"",toAddress:"",amount:[]};return t.fromAddress=e.fromAddress??"",t.toAddress=e.toAddress??"",t.amount=e.amount?.map((e=>n.Coin.fromPartial(e)))||[],t}},t.MsgSendResponse={typeUrl:"/cosmos.bank.v1beta1.MsgSendResponse",encode:(e,t=s.BinaryWriter.create())=>t,decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const i={};for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i},fromJSON:e=>({}),toJSON:e=>({}),fromPartial:e=>({})},t.MsgMultiSend={typeUrl:"/cosmos.bank.v1beta1.MsgMultiSend",encode(e,t=s.BinaryWriter.create()){for(const r of e.inputs)i.Input.encode(r,t.uint32(10).fork()).ldelim();for(const r of e.outputs)i.Output.encode(r,t.uint32(18).fork()).ldelim();return t},decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const o={inputs:[],outputs:[]};for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:o.inputs.push(i.Input.decode(r,r.uint32()));break;case 2:o.outputs.push(i.Output.decode(r,r.uint32()));break;default:r.skipType(7&e)}}return o},fromJSON(e){const t={inputs:[],outputs:[]};return Array.isArray(e?.inputs)&&(t.inputs=e.inputs.map((e=>i.Input.fromJSON(e)))),Array.isArray(e?.outputs)&&(t.outputs=e.outputs.map((e=>i.Output.fromJSON(e)))),t},toJSON(e){const t={};return e.inputs?t.inputs=e.inputs.map((e=>e?i.Input.toJSON(e):void 0)):t.inputs=[],e.outputs?t.outputs=e.outputs.map((e=>e?i.Output.toJSON(e):void 0)):t.outputs=[],t},fromPartial(e){const t={inputs:[],outputs:[]};return t.inputs=e.inputs?.map((e=>i.Input.fromPartial(e)))||[],t.outputs=e.outputs?.map((e=>i.Output.fromPartial(e)))||[],t}},t.MsgMultiSendResponse={typeUrl:"/cosmos.bank.v1beta1.MsgMultiSendResponse",encode:(e,t=s.BinaryWriter.create())=>t,decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const i={};for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i},fromJSON:e=>({}),toJSON:e=>({}),fromPartial:e=>({})},t.MsgUpdateParams={typeUrl:"/cosmos.bank.v1beta1.MsgUpdateParams",encode:(e,t=s.BinaryWriter.create())=>(""!==e.authority&&t.uint32(10).string(e.authority),void 0!==e.params&&i.Params.encode(e.params,t.uint32(18).fork()).ldelim(),t),decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const o=a();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:o.authority=r.string();break;case 2:o.params=i.Params.decode(r,r.uint32());break;default:r.skipType(7&e)}}return o},fromJSON(e){const t=a();return(0,o.isSet)(e.authority)&&(t.authority=String(e.authority)),(0,o.isSet)(e.params)&&(t.params=i.Params.fromJSON(e.params)),t},toJSON(e){const t={};return void 0!==e.authority&&(t.authority=e.authority),void 0!==e.params&&(t.params=e.params?i.Params.toJSON(e.params):void 0),t},fromPartial(e){const t=a();return t.authority=e.authority??"",void 0!==e.params&&null!==e.params&&(t.params=i.Params.fromPartial(e.params)),t}},t.MsgUpdateParamsResponse={typeUrl:"/cosmos.bank.v1beta1.MsgUpdateParamsResponse",encode:(e,t=s.BinaryWriter.create())=>t,decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const i={};for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i},fromJSON:e=>({}),toJSON:e=>({}),fromPartial:e=>({})},t.MsgSetSendEnabled={typeUrl:"/cosmos.bank.v1beta1.MsgSetSendEnabled",encode(e,t=s.BinaryWriter.create()){""!==e.authority&&t.uint32(10).string(e.authority);for(const r of e.sendEnabled)i.SendEnabled.encode(r,t.uint32(18).fork()).ldelim();for(const r of e.useDefaultFor)t.uint32(26).string(r);return t},decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const o={authority:"",sendEnabled:[],useDefaultFor:[]};for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:o.authority=r.string();break;case 2:o.sendEnabled.push(i.SendEnabled.decode(r,r.uint32()));break;case 3:o.useDefaultFor.push(r.string());break;default:r.skipType(7&e)}}return o},fromJSON(e){const t={authority:"",sendEnabled:[],useDefaultFor:[]};return(0,o.isSet)(e.authority)&&(t.authority=String(e.authority)),Array.isArray(e?.sendEnabled)&&(t.sendEnabled=e.sendEnabled.map((e=>i.SendEnabled.fromJSON(e)))),Array.isArray(e?.useDefaultFor)&&(t.useDefaultFor=e.useDefaultFor.map((e=>String(e)))),t},toJSON(e){const t={};return void 0!==e.authority&&(t.authority=e.authority),e.sendEnabled?t.sendEnabled=e.sendEnabled.map((e=>e?i.SendEnabled.toJSON(e):void 0)):t.sendEnabled=[],e.useDefaultFor?t.useDefaultFor=e.useDefaultFor.map((e=>e)):t.useDefaultFor=[],t},fromPartial(e){const t={authority:"",sendEnabled:[],useDefaultFor:[]};return t.authority=e.authority??"",t.sendEnabled=e.sendEnabled?.map((e=>i.SendEnabled.fromPartial(e)))||[],t.useDefaultFor=e.useDefaultFor?.map((e=>e))||[],t}},t.MsgSetSendEnabledResponse={typeUrl:"/cosmos.bank.v1beta1.MsgSetSendEnabledResponse",encode:(e,t=s.BinaryWriter.create())=>t,decode(e,t){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const i={};for(;r.pos<n;){const e=r.uint32();r.skipType(7&e)}return i},fromJSON:e=>({}),toJSON:e=>({}),fromPartial:e=>({})}},29639:function(e,t,r){"use strict";t.Tip=t.Fee=t.ModeInfo_Multi=t.ModeInfo_Single=t.ModeInfo=t.SignerInfo=t.AuthInfo=t.TxBody=t.SignDocDirectAux=t.Tx=void 0;const n=r(53862),i=r(72574),s=r(77381),o=r(10891),a=r(93841),c=r(81457);function u(){return{bodyBytes:new Uint8Array,authInfoBytes:new Uint8Array,signatures:[]}}function h(){return{bodyBytes:new Uint8Array,authInfoBytes:new Uint8Array,chainId:"",accountNumber:BigInt(0)}}function l(){return{bodyBytes:new Uint8Array,publicKey:void 0,chainId:"",accountNumber:BigInt(0),sequence:BigInt(0),tip:void 0}}function f(){return{messages:[],memo:"",timeoutHeight:BigInt(0),extensionOptions:[],nonCriticalExtensionOptions:[]}}function d(){return{publicKey:void 0,modeInfo:void 0,sequence:BigInt(0)}}function p(){return{amount:[],gasLimit:BigInt(0),payer:"",granter:""}}function y(){return{address:"",signDoc:void 0,mode:0,sig:new Uint8Array}}t.Tx={typeUrl:"/cosmos.tx.v1beta1.Tx",encode(e,r=a.BinaryWriter.create()){void 0!==e.body&&t.TxBody.encode(e.body,r.uint32(10).fork()).ldelim(),void 0!==e.authInfo&&t.AuthInfo.encode(e.authInfo,r.uint32(18).fork()).ldelim();for(const t of e.signatures)r.uint32(26).bytes(t);return r},decode(e,r){const n=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let i=void 0===r?n.len:n.pos+r;const s={body:void 0,authInfo:void 0,signatures:[]};for(;n.pos<i;){const e=n.uint32();switch(e>>>3){case 1:s.body=t.TxBody.decode(n,n.uint32());break;case 2:s.authInfo=t.AuthInfo.decode(n,n.uint32());break;case 3:s.signatures.push(n.bytes());break;default:n.skipType(7&e)}}return s},fromJSON(e){const r={body:void 0,authInfo:void 0,signatures:[]};return(0,c.isSet)(e.body)&&(r.body=t.TxBody.fromJSON(e.body)),(0,c.isSet)(e.authInfo)&&(r.authInfo=t.AuthInfo.fromJSON(e.authInfo)),Array.isArray(e?.signatures)&&(r.signatures=e.signatures.map((e=>(0,c.bytesFromBase64)(e)))),r},toJSON(e){const r={};return void 0!==e.body&&(r.body=e.body?t.TxBody.toJSON(e.body):void 0),void 0!==e.authInfo&&(r.authInfo=e.authInfo?t.AuthInfo.toJSON(e.authInfo):void 0),e.signatures?r.signatures=e.signatures.map((e=>(0,c.base64FromBytes)(void 0!==e?e:new Uint8Array))):r.signatures=[],r},fromPartial(e){const r={body:void 0,authInfo:void 0,signatures:[]};return void 0!==e.body&&null!==e.body&&(r.body=t.TxBody.fromPartial(e.body)),void 0!==e.authInfo&&null!==e.authInfo&&(r.authInfo=t.AuthInfo.fromPartial(e.authInfo)),r.signatures=e.signatures?.map((e=>e))||[],r}},t.SignDocDirectAux={typeUrl:"/cosmos.tx.v1beta1.SignDocDirectAux",encode:(e,r=a.BinaryWriter.create())=>(0!==e.bodyBytes.length&&r.uint32(10).bytes(e.bodyBytes),void 0!==e.publicKey&&n.Any.encode(e.publicKey,r.uint32(18).fork()).ldelim(),""!==e.chainId&&r.uint32(26).string(e.chainId),e.accountNumber!==BigInt(0)&&r.uint32(32).uint64(e.accountNumber),e.sequence!==BigInt(0)&&r.uint32(40).uint64(e.sequence),void 0!==e.tip&&t.Tip.encode(e.tip,r.uint32(50).fork()).ldelim(),r),decode(e,r){const i=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let s=void 0===r?i.len:i.pos+r;const o=l();for(;i.pos<s;){const e=i.uint32();switch(e>>>3){case 1:o.bodyBytes=i.bytes();break;case 2:o.publicKey=n.Any.decode(i,i.uint32());break;case 3:o.chainId=i.string();break;case 4:o.accountNumber=i.uint64();break;case 5:o.sequence=i.uint64();break;case 6:o.tip=t.Tip.decode(i,i.uint32());break;default:i.skipType(7&e)}}return o},fromJSON(e){const r=l();return(0,c.isSet)(e.bodyBytes)&&(r.bodyBytes=(0,c.bytesFromBase64)(e.bodyBytes)),(0,c.isSet)(e.publicKey)&&(r.publicKey=n.Any.fromJSON(e.publicKey)),(0,c.isSet)(e.chainId)&&(r.chainId=String(e.chainId)),(0,c.isSet)(e.accountNumber)&&(r.accountNumber=BigInt(e.accountNumber.toString())),(0,c.isSet)(e.sequence)&&(r.sequence=BigInt(e.sequence.toString())),(0,c.isSet)(e.tip)&&(r.tip=t.Tip.fromJSON(e.tip)),r},toJSON(e){const r={};return void 0!==e.bodyBytes&&(r.bodyBytes=(0,c.base64FromBytes)(void 0!==e.bodyBytes?e.bodyBytes:new Uint8Array)),void 0!==e.publicKey&&(r.publicKey=e.publicKey?n.Any.toJSON(e.publicKey):void 0),void 0!==e.chainId&&(r.chainId=e.chainId),void 0!==e.accountNumber&&(r.accountNumber=(e.accountNumber||BigInt(0)).toString()),void 0!==e.sequence&&(r.sequence=(e.sequence||BigInt(0)).toString()),void 0!==e.tip&&(r.tip=e.tip?t.Tip.toJSON(e.tip):void 0),r},fromPartial(e){const r=l();return r.bodyBytes=e.bodyBytes??new Uint8Array,void 0!==e.publicKey&&null!==e.publicKey&&(r.publicKey=n.Any.fromPartial(e.publicKey)),r.chainId=e.chainId??"",void 0!==e.accountNumber&&null!==e.accountNumber&&(r.accountNumber=BigInt(e.accountNumber.toString())),void 0!==e.sequence&&null!==e.sequence&&(r.sequence=BigInt(e.sequence.toString())),void 0!==e.tip&&null!==e.tip&&(r.tip=t.Tip.fromPartial(e.tip)),r}},t.TxBody={typeUrl:"/cosmos.tx.v1beta1.TxBody",encode(e,t=a.BinaryWriter.create()){for(const r of e.messages)n.Any.encode(r,t.uint32(10).fork()).ldelim();""!==e.memo&&t.uint32(18).string(e.memo),e.timeoutHeight!==BigInt(0)&&t.uint32(24).uint64(e.timeoutHeight);for(const r of e.extensionOptions)n.Any.encode(r,t.uint32(8186).fork()).ldelim();for(const r of e.nonCriticalExtensionOptions)n.Any.encode(r,t.uint32(16378).fork()).ldelim();return t},decode(e,t){const r=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let i=void 0===t?r.len:r.pos+t;const s=f();for(;r.pos<i;){const e=r.uint32();switch(e>>>3){case 1:s.messages.push(n.Any.decode(r,r.uint32()));break;case 2:s.memo=r.string();break;case 3:s.timeoutHeight=r.uint64();break;case 1023:s.extensionOptions.push(n.Any.decode(r,r.uint32()));break;case 2047:s.nonCriticalExtensionOptions.push(n.Any.decode(r,r.uint32()));break;default:r.skipType(7&e)}}return s},fromJSON(e){const t=f();return Array.isArray(e?.messages)&&(t.messages=e.messages.map((e=>n.Any.fromJSON(e)))),(0,c.isSet)(e.memo)&&(t.memo=String(e.memo)),(0,c.isSet)(e.timeoutHeight)&&(t.timeoutHeight=BigInt(e.timeoutHeight.toString())),Array.isArray(e?.extensionOptions)&&(t.extensionOptions=e.extensionOptions.map((e=>n.Any.fromJSON(e)))),Array.isArray(e?.nonCriticalExtensionOptions)&&(t.nonCriticalExtensionOptions=e.nonCriticalExtensionOptions.map((e=>n.Any.fromJSON(e)))),t},toJSON(e){const t={};return e.messages?t.messages=e.messages.map((e=>e?n.Any.toJSON(e):void 0)):t.messages=[],void 0!==e.memo&&(t.memo=e.memo),void 0!==e.timeoutHeight&&(t.timeoutHeight=(e.timeoutHeight||BigInt(0)).toString()),e.extensionOptions?t.extensionOptions=e.extensionOptions.map((e=>e?n.Any.toJSON(e):void 0)):t.extensionOptions=[],e.nonCriticalExtensionOptions?t.nonCriticalExtensionOptions=e.nonCriticalExtensionOptions.map((e=>e?n.Any.toJSON(e):void 0)):t.nonCriticalExtensionOptions=[],t},fromPartial(e){const t=f();return t.messages=e.messages?.map((e=>n.Any.fromPartial(e)))||[],t.memo=e.memo??"",void 0!==e.timeoutHeight&&null!==e.timeoutHeight&&(t.timeoutHeight=BigInt(e.timeoutHeight.toString())),t.extensionOptions=e.extensionOptions?.map((e=>n.Any.fromPartial(e)))||[],t.nonCriticalExtensionOptions=e.nonCriticalExtensionOptions?.map((e=>n.Any.fromPartial(e)))||[],t}},t.AuthInfo={typeUrl:"/cosmos.tx.v1beta1.AuthInfo",encode(e,r=a.BinaryWriter.create()){for(const n of e.signerInfos)t.SignerInfo.encode(n,r.uint32(10).fork()).ldelim();return void 0!==e.fee&&t.Fee.encode(e.fee,r.uint32(18).fork()).ldelim(),void 0!==e.tip&&t.Tip.encode(e.tip,r.uint32(26).fork()).ldelim(),r},decode(e,r){const n=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let i=void 0===r?n.len:n.pos+r;const s={signerInfos:[],fee:void 0,tip:void 0};for(;n.pos<i;){const e=n.uint32();switch(e>>>3){case 1:s.signerInfos.push(t.SignerInfo.decode(n,n.uint32()));break;case 2:s.fee=t.Fee.decode(n,n.uint32());break;case 3:s.tip=t.Tip.decode(n,n.uint32());break;default:n.skipType(7&e)}}return s},fromJSON(e){const r={signerInfos:[],fee:void 0,tip:void 0};return Array.isArray(e?.signerInfos)&&(r.signerInfos=e.signerInfos.map((e=>t.SignerInfo.fromJSON(e)))),(0,c.isSet)(e.fee)&&(r.fee=t.Fee.fromJSON(e.fee)),(0,c.isSet)(e.tip)&&(r.tip=t.Tip.fromJSON(e.tip)),r},toJSON(e){const r={};return e.signerInfos?r.signerInfos=e.signerInfos.map((e=>e?t.SignerInfo.toJSON(e):void 0)):r.signerInfos=[],void 0!==e.fee&&(r.fee=e.fee?t.Fee.toJSON(e.fee):void 0),void 0!==e.tip&&(r.tip=e.tip?t.Tip.toJSON(e.tip):void 0),r},fromPartial(e){const r={signerInfos:[],fee:void 0,tip:void 0};return r.signerInfos=e.signerInfos?.map((e=>t.SignerInfo.fromPartial(e)))||[],void 0!==e.fee&&null!==e.fee&&(r.fee=t.Fee.fromPartial(e.fee)),void 0!==e.tip&&null!==e.tip&&(r.tip=t.Tip.fromPartial(e.tip)),r}},t.SignerInfo={typeUrl:"/cosmos.tx.v1beta1.SignerInfo",encode:(e,r=a.BinaryWriter.create())=>(void 0!==e.publicKey&&n.Any.encode(e.publicKey,r.uint32(10).fork()).ldelim(),void 0!==e.modeInfo&&t.ModeInfo.encode(e.modeInfo,r.uint32(18).fork()).ldelim(),e.sequence!==BigInt(0)&&r.uint32(24).uint64(e.sequence),r),decode(e,r){const i=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let s=void 0===r?i.len:i.pos+r;const o=d();for(;i.pos<s;){const e=i.uint32();switch(e>>>3){case 1:o.publicKey=n.Any.decode(i,i.uint32());break;case 2:o.modeInfo=t.ModeInfo.decode(i,i.uint32());break;case 3:o.sequence=i.uint64();break;default:i.skipType(7&e)}}return o},fromJSON(e){const r=d();return(0,c.isSet)(e.publicKey)&&(r.publicKey=n.Any.fromJSON(e.publicKey)),(0,c.isSet)(e.modeInfo)&&(r.modeInfo=t.ModeInfo.fromJSON(e.modeInfo)),(0,c.isSet)(e.sequence)&&(r.sequence=BigInt(e.sequence.toString())),r},toJSON(e){const r={};return void 0!==e.publicKey&&(r.publicKey=e.publicKey?n.Any.toJSON(e.publicKey):void 0),void 0!==e.modeInfo&&(r.modeInfo=e.modeInfo?t.ModeInfo.toJSON(e.modeInfo):void 0),void 0!==e.sequence&&(r.sequence=(e.sequence||BigInt(0)).toString()),r},fromPartial(e){const r=d();return void 0!==e.publicKey&&null!==e.publicKey&&(r.publicKey=n.Any.fromPartial(e.publicKey)),void 0!==e.modeInfo&&null!==e.modeInfo&&(r.modeInfo=t.ModeInfo.fromPartial(e.modeInfo)),void 0!==e.sequence&&null!==e.sequence&&(r.sequence=BigInt(e.sequence.toString())),r}},t.ModeInfo={typeUrl:"/cosmos.tx.v1beta1.ModeInfo",encode:(e,r=a.BinaryWriter.create())=>(void 0!==e.single&&t.ModeInfo_Single.encode(e.single,r.uint32(10).fork()).ldelim(),void 0!==e.multi&&t.ModeInfo_Multi.encode(e.multi,r.uint32(18).fork()).ldelim(),r),decode(e,r){const n=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let i=void 0===r?n.len:n.pos+r;const s={single:void 0,multi:void 0};for(;n.pos<i;){const e=n.uint32();switch(e>>>3){case 1:s.single=t.ModeInfo_Single.decode(n,n.uint32());break;case 2:s.multi=t.ModeInfo_Multi.decode(n,n.uint32());break;default:n.skipType(7&e)}}return s},fromJSON(e){const r={single:void 0,multi:void 0};return(0,c.isSet)(e.single)&&(r.single=t.ModeInfo_Single.fromJSON(e.single)),(0,c.isSet)(e.multi)&&(r.multi=t.ModeInfo_Multi.fromJSON(e.multi)),r},toJSON(e){const r={};return void 0!==e.single&&(r.single=e.single?t.ModeInfo_Single.toJSON(e.single):void 0),void 0!==e.multi&&(r.multi=e.multi?t.ModeInfo_Multi.toJSON(e.multi):void 0),r},fromPartial(e){const r={single:void 0,multi:void 0};return void 0!==e.single&&null!==e.single&&(r.single=t.ModeInfo_Single.fromPartial(e.single)),void 0!==e.multi&&null!==e.multi&&(r.multi=t.ModeInfo_Multi.fromPartial(e.multi)),r}},t.ModeInfo_Single={typeUrl:"/cosmos.tx.v1beta1.Single",encode:(e,t=a.BinaryWriter.create())=>(0!==e.mode&&t.uint32(8).int32(e.mode),t),decode(e,t){const r=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const i={mode:0};for(;r.pos<n;){const e=r.uint32();if(e>>>3==1)i.mode=r.int32();else r.skipType(7&e)}return i},fromJSON(e){const t={mode:0};return(0,c.isSet)(e.mode)&&(t.mode=(0,i.signModeFromJSON)(e.mode)),t},toJSON(e){const t={};return void 0!==e.mode&&(t.mode=(0,i.signModeToJSON)(e.mode)),t},fromPartial(e){const t={mode:0};return t.mode=e.mode??0,t}},t.ModeInfo_Multi={typeUrl:"/cosmos.tx.v1beta1.Multi",encode(e,r=a.BinaryWriter.create()){void 0!==e.bitarray&&s.CompactBitArray.encode(e.bitarray,r.uint32(10).fork()).ldelim();for(const n of e.modeInfos)t.ModeInfo.encode(n,r.uint32(18).fork()).ldelim();return r},decode(e,r){const n=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let i=void 0===r?n.len:n.pos+r;const o={bitarray:void 0,modeInfos:[]};for(;n.pos<i;){const e=n.uint32();switch(e>>>3){case 1:o.bitarray=s.CompactBitArray.decode(n,n.uint32());break;case 2:o.modeInfos.push(t.ModeInfo.decode(n,n.uint32()));break;default:n.skipType(7&e)}}return o},fromJSON(e){const r={bitarray:void 0,modeInfos:[]};return(0,c.isSet)(e.bitarray)&&(r.bitarray=s.CompactBitArray.fromJSON(e.bitarray)),Array.isArray(e?.modeInfos)&&(r.modeInfos=e.modeInfos.map((e=>t.ModeInfo.fromJSON(e)))),r},toJSON(e){const r={};return void 0!==e.bitarray&&(r.bitarray=e.bitarray?s.CompactBitArray.toJSON(e.bitarray):void 0),e.modeInfos?r.modeInfos=e.modeInfos.map((e=>e?t.ModeInfo.toJSON(e):void 0)):r.modeInfos=[],r},fromPartial(e){const r={bitarray:void 0,modeInfos:[]};return void 0!==e.bitarray&&null!==e.bitarray&&(r.bitarray=s.CompactBitArray.fromPartial(e.bitarray)),r.modeInfos=e.modeInfos?.map((e=>t.ModeInfo.fromPartial(e)))||[],r}},t.Fee={typeUrl:"/cosmos.tx.v1beta1.Fee",encode(e,t=a.BinaryWriter.create()){for(const r of e.amount)o.Coin.encode(r,t.uint32(10).fork()).ldelim();return e.gasLimit!==BigInt(0)&&t.uint32(16).uint64(e.gasLimit),""!==e.payer&&t.uint32(26).string(e.payer),""!==e.granter&&t.uint32(34).string(e.granter),t},decode(e,t){const r=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const i=p();for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.amount.push(o.Coin.decode(r,r.uint32()));break;case 2:i.gasLimit=r.uint64();break;case 3:i.payer=r.string();break;case 4:i.granter=r.string();break;default:r.skipType(7&e)}}return i},fromJSON(e){const t=p();return Array.isArray(e?.amount)&&(t.amount=e.amount.map((e=>o.Coin.fromJSON(e)))),(0,c.isSet)(e.gasLimit)&&(t.gasLimit=BigInt(e.gasLimit.toString())),(0,c.isSet)(e.payer)&&(t.payer=String(e.payer)),(0,c.isSet)(e.granter)&&(t.granter=String(e.granter)),t},toJSON(e){const t={};return e.amount?t.amount=e.amount.map((e=>e?o.Coin.toJSON(e):void 0)):t.amount=[],void 0!==e.gasLimit&&(t.gasLimit=(e.gasLimit||BigInt(0)).toString()),void 0!==e.payer&&(t.payer=e.payer),void 0!==e.granter&&(t.granter=e.granter),t},fromPartial(e){const t=p();return t.amount=e.amount?.map((e=>o.Coin.fromPartial(e)))||[],void 0!==e.gasLimit&&null!==e.gasLimit&&(t.gasLimit=BigInt(e.gasLimit.toString())),t.payer=e.payer??"",t.granter=e.granter??"",t}},t.Tip={typeUrl:"/cosmos.tx.v1beta1.Tip",encode(e,t=a.BinaryWriter.create()){for(const r of e.amount)o.Coin.encode(r,t.uint32(10).fork()).ldelim();return""!==e.tipper&&t.uint32(18).string(e.tipper),t},decode(e,t){const r=e instanceof a.BinaryReader?e:new a.BinaryReader(e);let n=void 0===t?r.len:r.pos+t;const i={amount:[],tipper:""};for(;r.pos<n;){const e=r.uint32();switch(e>>>3){case 1:i.amount.push(o.Coin.decode(r,r.uint32()));break;case 2:i.tipper=r.string();break;default:r.skipType(7&e)}}return i},fromJSON(e){const t={amount:[],tipper:""};return Array.isArray(e?.amount)&&(t.amount=e.amount.map((e=>o.Coin.fromJSON(e)))),(0,c.isSet)(e.tipper)&&(t.tipper=String(e.tipper)),t},toJSON(e){const t={};return e.amount?t.amount=e.amount.map((e=>e?o.Coin.toJSON(e):void 0)):t.amount=[],void 0!==e.tipper&&(t.tipper=e.tipper),t},fromPartial(e){const t={amount:[],tipper:""};return t.amount=e.amount?.map((e=>o.Coin.fromPartial(e)))||[],t.tipper=e.tipper??"",t}}},74077:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(r.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function o(e){return"string"!=typeof e&&(e=String(e)),e}function a(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r.iterable&&(t[Symbol.iterator]=function(){return t}),t}function c(e){this.map={},e instanceof c?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function u(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function l(e){var t=new FileReader,r=h(t);return t.readAsArrayBuffer(e),r}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function d(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:r.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():r.arrayBuffer&&r.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||i(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?u(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(l)}),this.text=function(){var e,t,r,n=u(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=h(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}c.prototype.append=function(e,t){e=s(e),t=o(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},c.prototype.delete=function(e){delete this.map[s(e)]},c.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},c.prototype.set=function(e,t){this.map[s(e)]=o(t)},c.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},c.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),a(e)},c.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),a(e)},c.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),a(e)},r.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(e,t){var r,n,i=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),p.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function g(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function m(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},d.call(y.prototype),d.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},m.error=function(){var e=new m(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];m.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new m(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function w(e,n){return new Promise((function(i,s){var o=new y(e,n);if(o.signal&&o.signal.aborted)return s(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new c,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var n="response"in a?a.response:a.responseText;i(new m(n,r))},a.onerror=function(){s(new TypeError("Network request failed"))},a.ontimeout=function(){s(new TypeError("Network request failed"))},a.onabort=function(){s(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r.blob&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",u)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}w.polyfill=!0,e.fetch||(e.fetch=w,e.Headers=c,e.Request=y,e.Response=m),t.Headers=c,t.Request=y,t.Response=m,t.fetch=w,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=n;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t},49734:function(e,t,r){"use strict";r.d(t,{MY:function(){return A}});var n=r(81286);e=r.hmd(e);var i=r(25108);let s;const o=new Array(128).fill(void 0);function a(e){return o[e]}o.push(void 0,null,!0,!1);let c=0,u=null;function h(){return null!==u&&0!==u.byteLength||(u=new Uint8Array(s.memory.buffer)),u}const l="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},f="function"==typeof l.encodeInto?function(e,t){return l.encodeInto(e,t)}:function(e,t){const r=l.encode(e);return t.set(r),{read:e.length,written:r.length}};function d(e,t,r){if(void 0===r){const r=l.encode(e),n=t(r.length)>>>0;return h().subarray(n,n+r.length).set(r),c=r.length,n}let n=e.length,i=t(n)>>>0;const s=h();let o=0;for(;o<n;o++){const t=e.charCodeAt(o);if(t>127)break;s[i+o]=t}if(o!==n){0!==o&&(e=e.slice(o)),i=r(i,n,n=o+3*e.length)>>>0;const t=h().subarray(i+o,i+n);o+=f(e,t).written}return c=o,i}function p(e){return null==e}let y=null;function g(){return null!==y&&0!==y.byteLength||(y=new Int32Array(s.memory.buffer)),y}const m="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};function b(e,t){return e>>>=0,m.decode(h().subarray(e,e+t))}"undefined"!=typeof TextDecoder&&m.decode();let w=o.length;function v(e){w===o.length&&o.push(o.length+1);const t=w;return w=o[t],o[t]=e,t}function _(e){const t=a(e);return function(e){e<132||(o[e]=w,w=e)}(e),t}let E=null;let k=null;function x(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=x(e[0]));for(let n=1;n<t;n++)r+=", "+x(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function S(e,t,r){s._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__hf4bfcc5d39f18e99(e,t,v(r))}function A(e,t,r,n){const i=d(e,s.__wbindgen_malloc,s.__wbindgen_realloc),o=c,a=d(t,s.__wbindgen_malloc,s.__wbindgen_realloc),u=c;return _(s.compile(i,o,a,u,v(r),v(n)))}function I(e,t){try{return e.apply(this,t)}catch(e){s.__wbindgen_exn_store(v(e))}}function C(){const t={wbg:{}};return t.wbg.__wbg_log_d6d3928c15a332b3=function(e,t){i.log(b(e,t))},t.wbg.__wbindgen_is_undefined=function(e){return void 0===a(e)},t.wbg.__wbindgen_string_get=function(e,t){const r=a(t),n="string"==typeof r?r:void 0;var i=p(n)?0:d(n,s.__wbindgen_malloc,s.__wbindgen_realloc),o=c;g()[e/4+1]=o,g()[e/4+0]=i},t.wbg.__wbindgen_error_new=function(e,t){return v(new Error(b(e,t)))},t.wbg.__wbindgen_jsval_eq=function(e,t){return a(e)===a(t)},t.wbg.__wbindgen_object_drop_ref=function(e){_(e)},t.wbg.__wbindgen_boolean_get=function(e){const t=a(e);return"boolean"==typeof t?t?1:0:2},t.wbg.__wbindgen_is_bigint=function(e){return"bigint"==typeof a(e)},t.wbg.__wbindgen_number_get=function(e,t){const r=a(t),n="number"==typeof r?r:void 0;(null!==E&&0!==E.byteLength||(E=new Float64Array(s.memory.buffer)),E)[e/8+1]=p(n)?0:n,g()[e/4+0]=!p(n)},t.wbg.__wbindgen_bigint_from_i64=function(e){return v(e)},t.wbg.__wbindgen_is_object=function(e){const t=a(e);return"object"==typeof t&&null!==t},t.wbg.__wbindgen_in=function(e,t){return a(e)in a(t)},t.wbg.__wbindgen_bigint_from_u64=function(e){return v(BigInt.asUintN(64,e))},t.wbg.__wbg_jsCyberSearch_7e27339aa5f7a989=function(e,t){return v((0,n.rB)(b(e,t)))},t.wbg.__wbg_jsCyberLink_6b02b912deb23510=function(e,t,r,i){return v((0,n.yF)(b(e,t),b(r,i)))},t.wbg.__wbg_jsGetPassportByNickname_fbf1750b6fa955a5=function(e,t){return v((0,n.Mv)(b(e,t)))},t.wbg.__wbg_jsGetIpfsTextContent_4bffb8096b9cedb0=function(e,t){return v((0,n.YQ)(b(e,t)))},t.wbg.__wbg_jsAddContenToIpfs_128045b04a01a2f2=function(e,t){return v((0,n.ZT)(b(e,t)))},t.wbg.__wbg_jsEvalScriptFromIpfs_34870c7360a3ac3c=function(e,t,r,i,s){return v((0,n.gd)(b(e,t),b(r,i),a(s)))},t.wbg.__wbg_jsPromptToOpenAI_269d5645cd0e4b0d=function(e,t,r,i,s){return v((0,n.n1)(b(e,t),b(r,i),a(s)))},t.wbg.__wbg_jsSearchByEmbedding_c53029ec2c16d0e3=function(e,t,r){return v((0,n.v$)(b(e,t),r>>>0))},t.wbg.__wbg_jsCyberLinksFrom_e4e1629f31736c22=function(e,t){return v((0,n.D_)(b(e,t)))},t.wbg.__wbg_jsCyberLinksTo_61c41f322fe1b63c=function(e,t){return v((0,n.eU)(b(e,t)))},t.wbg.__wbindgen_object_clone_ref=function(e){return v(a(e))},t.wbg.__wbindgen_string_new=function(e,t){return v(b(e,t))},t.wbg.__wbg_fetch_57429b87be3dcc33=function(e){return v(fetch(a(e)))},t.wbg.__wbg_randomFillSync_e950366c42764a07=function(){return I((function(e,t){a(e).randomFillSync(_(t))}),arguments)},t.wbg.__wbg_getRandomValues_3774744e221a22ad=function(){return I((function(e,t){a(e).getRandomValues(a(t))}),arguments)},t.wbg.__wbg_crypto_70a96de3b6b73dac=function(e){return v(a(e).crypto)},t.wbg.__wbg_process_dd1577445152112e=function(e){return v(a(e).process)},t.wbg.__wbg_versions_58036bec3add9e6f=function(e){return v(a(e).versions)},t.wbg.__wbg_node_6a9d28205ed5b0d8=function(e){return v(a(e).node)},t.wbg.__wbindgen_is_string=function(e){return"string"==typeof a(e)},t.wbg.__wbg_require_f05d779769764e82=function(){return I((function(){return v(e.require)}),arguments)},t.wbg.__wbg_msCrypto_adbc770ec9eca9c7=function(e){return v(a(e).msCrypto)},t.wbg.__wbindgen_jsval_loose_eq=function(e,t){return a(e)==a(t)},t.wbg.__wbindgen_cb_drop=function(e){const t=_(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},t.wbg.__wbg_signal_bcb55e86063f8860=function(e){return v(a(e).signal)},t.wbg.__wbg_new_668956ac1089f8cf=function(){return I((function(){return v(new AbortController)}),arguments)},t.wbg.__wbg_abort_de75e4ab5136bcee=function(e){a(e).abort()},t.wbg.__wbg_new_143b41b4342650bb=function(){return I((function(){return v(new Headers)}),arguments)},t.wbg.__wbg_append_fac652007989b765=function(){return I((function(e,t,r,n,i){a(e).append(b(t,r),b(n,i))}),arguments)},t.wbg.__wbg_newwithstrandinit_a4cd16dfaafcf625=function(){return I((function(e,t,r){return v(new Request(b(e,t),a(r)))}),arguments)},t.wbg.__wbg_instanceof_Response_7ade9a5a066d1a55=function(e){let t;try{t=a(e)instanceof Response}catch{t=!1}return t},t.wbg.__wbg_url_59cb32ef6a837521=function(e,t){const r=d(a(t).url,s.__wbindgen_malloc,s.__wbindgen_realloc),n=c;g()[e/4+1]=n,g()[e/4+0]=r},t.wbg.__wbg_status_d2b2d0889f7e970f=function(e){return a(e).status},t.wbg.__wbg_headers_2de03c88f895093b=function(e){return v(a(e).headers)},t.wbg.__wbg_arrayBuffer_2693673868da65b7=function(){return I((function(e){return v(a(e).arrayBuffer())}),arguments)},t.wbg.__wbg_text_65fa1887e8f7b4ac=function(){return I((function(e){return v(a(e).text())}),arguments)},t.wbg.__wbg_fetch_621998933558ad27=function(e,t){return v(a(e).fetch(a(t)))},t.wbg.__wbindgen_is_function=function(e){return"function"==typeof a(e)},t.wbg.__wbg_self_742dd6eab3e9211e=function(){return I((function(){return v(self.self)}),arguments)},t.wbg.__wbg_window_c409e731db53a0e2=function(){return I((function(){return v(window.window)}),arguments)},t.wbg.__wbg_globalThis_b70c095388441f2d=function(){return I((function(){return v(globalThis.globalThis)}),arguments)},t.wbg.__wbg_global_1c72617491ed7194=function(){return I((function(){return v(r.g.global)}),arguments)},t.wbg.__wbg_newnoargs_c9e6043b8ad84109=function(e,t){return v(new Function(b(e,t)))},t.wbg.__wbg_next_f4bc0e96ea67da68=function(e){return v(a(e).next)},t.wbg.__wbg_value_2f4ef2036bfad28e=function(e){return v(a(e).value)},t.wbg.__wbg_iterator_7c7e58f62eb84700=function(){return v(Symbol.iterator)},t.wbg.__wbg_new_2b6fea4ea03b1b95=function(){return v(new Object)},t.wbg.__wbg_get_7303ed2ef026b2f5=function(e,t){return v(a(e)[t>>>0])},t.wbg.__wbg_isArray_04e59fb73f78ab5b=function(e){return Array.isArray(a(e))},t.wbg.__wbg_length_820c786973abdd8a=function(e){return a(e).length},t.wbg.__wbg_instanceof_ArrayBuffer_ef2632aa0d4bfff8=function(e){let t;try{t=a(e)instanceof ArrayBuffer}catch{t=!1}return t},t.wbg.__wbg_call_557a2f2deacc4912=function(){return I((function(e,t){return v(a(e).call(a(t)))}),arguments)},t.wbg.__wbg_call_587b30eea3e09332=function(){return I((function(e,t,r){return v(a(e).call(a(t),a(r)))}),arguments)},t.wbg.__wbg_next_ec061e48a0e72a96=function(){return I((function(e){return v(a(e).next())}),arguments)},t.wbg.__wbg_done_b6abb27d42b63867=function(e){return a(e).done},t.wbg.__wbg_isSafeInteger_2088b01008075470=function(e){return Number.isSafeInteger(a(e))},t.wbg.__wbg_entries_13e011453776468f=function(e){return v(Object.entries(a(e)))},t.wbg.__wbg_get_f53c921291c381bd=function(){return I((function(e,t){return v(Reflect.get(a(e),a(t)))}),arguments)},t.wbg.__wbg_has_40b8c976775c8ead=function(){return I((function(e,t){return Reflect.has(a(e),a(t))}),arguments)},t.wbg.__wbg_set_07da13cc24b69217=function(){return I((function(e,t,r){return Reflect.set(a(e),a(t),a(r))}),arguments)},t.wbg.__wbg_buffer_55ba7a6b1b92e2ac=function(e){return v(a(e).buffer)},t.wbg.__wbg_parse_76a8a18ca3f8730b=function(){return I((function(e,t){return v(JSON.parse(b(e,t)))}),arguments)},t.wbg.__wbg_stringify_d06ad2addc54d51e=function(){return I((function(e){return v(JSON.stringify(a(e)))}),arguments)},t.wbg.__wbg_new_2b55e405e4af4986=function(e,t){try{var r={a:e,b:t};const n=new Promise(((e,t)=>{const n=r.a;r.a=0;try{return function(e,t,r,n){s.wasm_bindgen__convert__closures__invoke2_mut__ha6faf1932adab3a4(e,t,v(r),v(n))}(n,r.b,e,t)}finally{r.a=n}}));return v(n)}finally{r.a=r.b=0}},t.wbg.__wbg_resolve_ae38ad63c43ff98b=function(e){return v(Promise.resolve(a(e)))},t.wbg.__wbg_then_8df675b8bb5d5e3c=function(e,t){return v(a(e).then(a(t)))},t.wbg.__wbg_then_835b073a479138e5=function(e,t,r){return v(a(e).then(a(t),a(r)))},t.wbg.__wbg_newwithbyteoffsetandlength_88d1d8be5df94b9b=function(e,t,r){return v(new Uint8Array(a(e),t>>>0,r>>>0))},t.wbg.__wbg_new_09938a7d020f049b=function(e){return v(new Uint8Array(a(e)))},t.wbg.__wbg_instanceof_Uint8Array_1349640af2da2e88=function(e){let t;try{t=a(e)instanceof Uint8Array}catch{t=!1}return t},t.wbg.__wbg_newwithlength_89eeca401d8918c2=function(e){return v(new Uint8Array(e>>>0))},t.wbg.__wbg_subarray_d82be056deb4ad27=function(e,t,r){return v(a(e).subarray(t>>>0,r>>>0))},t.wbg.__wbg_length_0aab7ffd65ad19ed=function(e){return a(e).length},t.wbg.__wbg_set_3698e3ca519b3c3c=function(e,t,r){a(e).set(a(t),r>>>0)},t.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const r=a(t),n="bigint"==typeof r?r:void 0;(null!==k&&0!==k.byteLength||(k=new BigInt64Array(s.memory.buffer)),k)[e/8+1]=p(n)?BigInt(0):n,g()[e/4+0]=!p(n)},t.wbg.__wbindgen_debug_string=function(e,t){const r=d(x(a(t)),s.__wbindgen_malloc,s.__wbindgen_realloc),n=c;g()[e/4+1]=n,g()[e/4+0]=r},t.wbg.__wbindgen_throw=function(e,t){throw new Error(b(e,t))},t.wbg.__wbindgen_memory=function(){return v(s.memory)},t.wbg.__wbindgen_closure_wrapper3525=function(e,t,r){const n=function(e,t,r,n){const i={a:e,b:t,cnt:1,dtor:r},o=(...e)=>{i.cnt++;const t=i.a;i.a=0;try{return n(t,i.b,...e)}finally{0==--i.cnt?s.__wbindgen_export_2.get(i.dtor)(t,i.b):i.a=t}};return o.original=i,o}(e,t,717,S);return v(n)},t}function P(e,t){return s=e.exports,T.__wbindgen_wasm_module=t,k=null,E=null,y=null,u=null,s}async function T(e){if(void 0!==s)return s;void 0===e&&(e=new URL(r(56915),r.b));const t=C();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:o}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;i.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,t);return P(n,o)}t.ZP=T},48116:function(e,t,r){var n;!function(i){"use strict";var s,o,a,c=(s=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,o=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,function(e,t,r,n){if(1!==arguments.length||"string"!==(null===(i=e)?"null":void 0===i?"undefined":"object"!=typeof i?typeof i:Array.isArray(i)?"array":{}.toString.call(i).slice(8,-1).toLowerCase())||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var i,h=(t=String(c.masks[t]||t||c.masks.default)).slice(0,4);"UTC:"!==h&&"GMT:"!==h||(t=t.slice(4),r=!0,"GMT:"===h&&(n=!0));var l=r?"getUTC":"get",f=e[l+"Date"](),d=e[l+"Day"](),p=e[l+"Month"](),y=e[l+"FullYear"](),g=e[l+"Hours"](),m=e[l+"Minutes"](),b=e[l+"Seconds"](),w=e[l+"Milliseconds"](),v=r?0:e.getTimezoneOffset(),_=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var r=new Date(t.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=t.getTimezoneOffset()-r.getTimezoneOffset();t.setHours(t.getHours()-n);var i=(t-r)/6048e5;return 1+Math.floor(i)}(e),E=function(e){var t=e.getDay();return 0===t&&(t=7),t}(e),k={d:f,dd:u(f),ddd:c.i18n.dayNames[d],dddd:c.i18n.dayNames[d+7],m:p+1,mm:u(p+1),mmm:c.i18n.monthNames[p],mmmm:c.i18n.monthNames[p+12],yy:String(y).slice(2),yyyy:y,h:g%12||12,hh:u(g%12||12),H:g,HH:u(g),M:m,MM:u(m),s:b,ss:u(b),l:u(w,3),L:u(Math.round(w/10)),t:g<12?c.i18n.timeNames[0]:c.i18n.timeNames[1],tt:g<12?c.i18n.timeNames[2]:c.i18n.timeNames[3],T:g<12?c.i18n.timeNames[4]:c.i18n.timeNames[5],TT:g<12?c.i18n.timeNames[6]:c.i18n.timeNames[7],Z:n?"GMT":r?"UTC":(String(e).match(o)||[""]).pop().replace(a,""),o:(v>0?"-":"+")+u(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10],W:_,N:E};return t.replace(s,(function(e){return e in k?k[e]:e.slice(1,e.length-1)}))});function u(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}c.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},c.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0===(n=function(){return c}.call(t,r,t,e))||(e.exports=n)}()},59435:function(e){var t=1e3,r=60*t,n=60*r,i=24*n,s=7*i,o=365.25*i;function a(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,c){c=c||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&isFinite(e))return c.long?function(e){var s=Math.abs(e);if(s>=i)return a(e,s,i,"day");if(s>=n)return a(e,s,n,"hour");if(s>=r)return a(e,s,r,"minute");if(s>=t)return a(e,s,t,"second");return e+" ms"}(e):function(e){var s=Math.abs(e);if(s>=i)return Math.round(e/i)+"d";if(s>=n)return Math.round(e/n)+"h";if(s>=r)return Math.round(e/r)+"m";if(s>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},11227:function(e,t,r){var n=r(25108),i=r(34155);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,n.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=n.debug||n.log||(()=>{}),e.exports=r(82447)(t);const{formatters:s}=e.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},82447:function(e,t,r){var n=r(25108);e.exports=function(e){function t(e){let r,n,s,o=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];r=s.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(59435),t.destroy=function(){n.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},65780:function(e){"use strict";const t=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},r=({clearTimeout:e,setTimeout:r,willResolve:n})=>(i,{value:s,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(t());let a,c,u;const h=e||clearTimeout,l=()=>{h(a),u(t())},f=new Promise(((e,t)=>{c=()=>{o&&o.removeEventListener("abort",l),n?e(s):t(s)},u=t,a=(r||setTimeout)(c,i)}));return o&&o.addEventListener("abort",l,{once:!0}),f.clear=()=>{h(a),a=null,c()},f},n=e=>{const t=r({...e,willResolve:!0});return t.reject=r({...e,willResolve:!1}),t.range=(e,r,n)=>t(((e,t)=>Math.floor(Math.random()*(t-e+1)+e))(e,r),n),t},i=n();i.createWithTimers=n,e.exports=i,e.exports.default=i},45001:function(e){"use strict";function t(e,t){t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=new Array(4))}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r||t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(0===arguments.length)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(0===arguments.length)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},t.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var r=this.size(),n=this._list.length;if(!(t>=r||t<-r)){t<0&&(t+=r),t=this._head+t&this._capacityMask;var i,s=this._list[t];if(e<r/2){for(i=e;i>0;i--)this._list[t]=this._list[t=t-1+n&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(i=r-1-e;i>0;i--)this._list[t]=this._list[t=t+1+n&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+n&this._capacityMask}return s}}},t.prototype.remove=function(e,t){var r,n=e,i=t;if(n===(0|n)&&this._head!==this._tail){var s=this.size(),o=this._list.length;if(!(n>=s||n<-s||t<1)){if(n<0&&(n+=s),1===t||!t)return(r=new Array(1))[0]=this.removeOne(n),r;if(0===n&&n+t>=s)return r=this.toArray(),this.clear(),r;var a;for(n+t>s&&(t=s-n),r=new Array(t),a=0;a<t;a++)r[a]=this._list[this._head+n+a&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===s){for(this._tail=this._tail-t+o&this._capacityMask,a=t;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+o&this._capacityMask,a=t-1;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(n<s/2){for(this._head=this._head+e+t+o&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[n=n-1+o&this._capacityMask]);for(n=this._head-1+o&this._capacityMask;i>0;)this._list[n=n-1+o&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+o&this._capacityMask,a=s-(t+e);a>0;a--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+o&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),r}}},t.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n)){if(arguments.length>2){var i,s,o,a=arguments.length,c=this._list.length,u=2;if(!n||r<n/2){for(s=new Array(r),i=0;i<r;i++)s[i]=this._list[this._head+i&this._capacityMask];for(0===t?(o=[],r>0&&(this._head=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._head=this._head+r+c&this._capacityMask);a>u;)this.unshift(arguments[--a]);for(i=r;i>0;i--)this.unshift(s[i-1])}else{var h=(s=new Array(n-(r+t))).length;for(i=0;i<h;i++)s[i]=this._list[this._head+r+t+i&this._capacityMask];for(0===t?(o=[],r!=n&&(this._tail=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._tail=this._tail-h+c&this._capacityMask);u<a;)this.push(arguments[u++]);for(i=0;i<h;i++)this.push(s[i])}return o}return this.remove(r,t)}}},t.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){var t=e.length,r=this._nextPowerOf2(t);this._list=new Array(r),this._capacityMask=r-1,this._tail=t;for(var n=0;n<t;n++)this._list[n]=e[n]},t.prototype._copyArray=function(e,t){var r=this._list,n=r.length,i=this.length;if((t|=i)==i&&this._head<this._tail)return this._list.slice(this._head,this._tail);var s,o=new Array(t),a=0;if(e||this._head>this._tail){for(s=this._head;s<n;s++)o[a++]=r[s];for(s=0;s<this._tail;s++)o[a++]=r[s]}else for(s=this._head;s<this._tail;s++)o[a++]=r[s];return o},t.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.prototype._nextPowerOf2=function(e){var t=1<<Math.log(e)/Math.log(2)+1;return Math.max(t,4)},e.exports=t},43631:function(e,t,r){"use strict";r.d(t,{qY:function(){return p}});var n=r(34155),i=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},s=function(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"},o=function(e){this.version=e,this.type="node",this.name="node",this.os=n.platform},a=function(e,t,r,n){this.name=e,this.version=t,this.os=r,this.bot=n,this.type="bot-device"},c=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},u=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},h=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,l=3,f=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],d=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function p(e){return e?g(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new u:"undefined"!=typeof navigator?g(navigator.userAgent):void 0!==n&&n.version?new o(n.version.slice(1)):null}function y(e){return""!==e&&f.reduce((function(t,r){var n=r[0],i=r[1];if(t)return t;var s=i.exec(e);return!!s&&[n,s]}),!1)}function g(e){var t=y(e);if(!t)return null;var r=t[0],n=t[1];if("searchbot"===r)return new c;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<l&&(o=i(i([],o,!0),function(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}(l-o.length),!0)):o=[];var u=o.join("."),f=function(e){for(var t=0,r=d.length;t<r;t++){var n=d[t],i=n[0];if(n[1].exec(e))return i}return null}(e),p=h.exec(e);return p&&p[1]?new a(r,u,f,p[1]):new s(r,u,f)}},26905:function(e){e.exports=function(e,t,r,n,i){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:i;return e===i?r:e}},32114:function(e){"use strict";function t(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}e.exports=function(e,r,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof r&&(n=r,r=""),r&&(n.code=r);try{return t(e,n)}catch(r){n.message=e.message,n.stack=e.stack;const i=function(){};i.prototype=Object.create(Object.getPrototypeOf(e));return t(new i,n)}}},90507:function(e,t,r){"use strict";const n=r(8231);t.zN=n.EventIterator,n.EventIterator},8231:function(e,t,r){"use strict";var n=r(25108);Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():n&&n.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch((()=>{})),this.pushQueue.push(t)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((e,t)=>{this.pullQueue.push({resolve:e,reject:t})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class s{constructor(e,{highWaterMark:t=100,lowWaterMark:r=1}={}){const n=new i;n.highWaterMark=t,n.lowWaterMark=r,n.removeCallback=e({push:e=>n.push(e),stop:()=>n.stop(),fail:e=>n.fail(e),on:(e,t)=>{n.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>n[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=s,t.default=s},17187:function(e,t,r){"use strict";var n,i=r(25108),s="object"==typeof Reflect?Reflect:null,o=s&&"function"==typeof s.apply?s.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}b(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&b(e,"error",t,r)}(e,i,{once:!0})}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function h(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function f(e,t,r,n){var s,o,a,c;if(h(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(s=l(e))>0&&a.length>s&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,c=u,i&&i.warn&&i.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=d.bind(n);return i.listener=r,n.wrapFn=i,i}function y(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):m(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function b(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){n.once&&e.removeEventListener(t,i),r(s)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return l(this)},c.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,h=m(c,u);for(r=0;r<u;++r)o(h[r],this,t)}return!0},c.prototype.addListener=function(e,t){return f(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return f(this,e,t,!0)},c.prototype.once=function(e,t){return h(t),this.on(e,p(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return h(t),this.prependListener(e,p(this,e,t)),this},c.prototype.removeListener=function(e,t){var r,n,i,s,o;if(h(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},c.prototype.listeners=function(e){return y(this,e,!0)},c.prototype.rawListeners=function(e){return y(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},c.prototype.listenerCount=g,c.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},72445:function(e){"use strict";e.exports=function(e){var t=e.uri,r=e.name,n=e.type;this.uri=t,this.name=r,this.type=n}},40804:function(e,t,r){"use strict";var n=r(51268);e.exports=function e(t,r,i){var s;void 0===r&&(r=""),void 0===i&&(i=n);var o=new Map;function a(e,t){var r=o.get(t);r?r.push.apply(r,e):o.set(t,e)}if(i(t))s=null,a([r],t);else{var c=r?r+".":"";if("undefined"!=typeof FileList&&t instanceof FileList)s=Array.prototype.map.call(t,(function(e,t){return a([""+c+t],e),null}));else if(Array.isArray(t))s=t.map((function(t,r){var n=e(t,""+c+r,i);return n.files.forEach(a),n.clone}));else if(t&&t.constructor===Object)for(var u in s={},t){var h=e(t[u],""+c+u,i);h.files.forEach(a),s[u]=h.clone}else s=t}return{clone:s,files:o}}},51268:function(e,t,r){"use strict";var n=r(72445);e.exports=function(e){return"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Blob&&e instanceof Blob||e instanceof n}},3975:function(e){e.exports=class{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},91607:function(e,t,r){const n=r(3975);e.exports=class{constructor(e){this.hwm=e||16,this.head=new n(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},96132:function(e,t){"use strict";function r(e,t=r.BASE){const n=e.length;for(let r=0;r<n;r++)t^=e.charCodeAt(r),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}Object.defineProperty(t,"__esModule",{value:!0}),r.BASE=2166136261,t.default=r,e.exports=r},53458:function(e){e.exports="object"==typeof self?self.FormData:window.FormData},70248:function(e){e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},85923:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,h=this._events[a],l=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,i),!0;case 5:return h.fn.call(h.context,t,n,i,s),!0;case 6:return h.fn.call(h.context,t,n,i,s,o),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];h.fn.apply(h.context,c)}else{var f,d=h.length;for(u=0;u<d;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),l){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,n);break;case 4:h[u].fn.call(h[u].context,t,n,i);break;default:if(!c)for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];h[u].fn.apply(h[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,u=[],h=a.length;c<h;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},28050:function(e,t,r){const n=r(62800),i=r(8786),s=r(97391),o=r(51385),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:u}=r(8746),h=r(69559),l=r(12566),f=r(52034),d=r(35946),p=r(36596),y=r(42527),g=r(72621);e.exports={RateLimiterRedis:n,RateLimiterMongo:i,RateLimiterMySQL:s,RateLimiterPostgres:o,RateLimiterMemory:h,RateLimiterMemcache:l,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:u,RLWrapperBlackAndWhite:f,RateLimiterUnion:d,RateLimiterQueue:p,BurstyRateLimiter:y,RateLimiterRes:g}},42527:function(e,t,r){const n=r(72621);e.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return e?new n(e.remainingPoints,Math.min(e.msBeforeNext,t?t.msBeforeNext:0),e.consumedPoints,e.isFirstInDuration):null}consume(e,t=1,r={}){return this._rateLimiter.consume(e,t,r).catch((i=>i instanceof n?this._burstLimiter.consume(e,t,r).then((e=>Promise.resolve(this._combineRes(i,e)))).catch((e=>e instanceof n?Promise.reject(this._combineRes(i,e)):Promise.reject(e))):Promise.reject(i)))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then((([e,t])=>this._combineRes(e,t)))}get points(){return this._rateLimiter.points}}},52034:function(e,t,r){const n=r(72621);e.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(void 0===e)throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=void 0!==e&&e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new n(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new n(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.rejectBlack()),void 0===r?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch((()=>{})),r)}block(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch((()=>{})),r)}penalty(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch((()=>{})),r)}reward(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch((()=>{})),r)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),void 0===t||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}},41599:function(e){e.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=void 0===e?1:e}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=void 0===e?0:e}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=void 0!==e&&Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=void 0===e?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(void 0===e&&(e="rlflx"),"string"!=typeof e)throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}},8746:function(e,t,r){var n=r(34155),i=r(25108);const s=r(66778),o=r(10465),a=r(41599),c=r(69559),u=r(72621),h="rate_limiter_flexible";let l=null;const f=function(e,t,r,n){let i;i=null===n||!0===n||!1===n?n:{remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},e.send({channel:h,keyPrefix:t.keyPrefix,promiseId:t.promiseId,type:r,data:i})},d=function(e){setTimeout((()=>{this._initiated?n.send(e):void 0!==this._promises[e.promiseId]&&d.call(this,e)}),30)},p=function(e,t,r,i,s){const o={channel:h,keyPrefix:this.keyPrefix,func:e,promiseId:t,data:{key:r,arg:i,opts:s}};this._initiated?n.send(o):d.call(this,o)},y=function(e,t){if(!t||t.channel!==h||void 0===this._rateLimiters[t.keyPrefix])return!1;let r;switch(t.func){case"consume":r=this._rateLimiters[t.keyPrefix].consume(t.data.key,t.data.arg,t.data.opts);break;case"penalty":r=this._rateLimiters[t.keyPrefix].penalty(t.data.key,t.data.arg,t.data.opts);break;case"reward":r=this._rateLimiters[t.keyPrefix].reward(t.data.key,t.data.arg,t.data.opts);break;case"block":r=this._rateLimiters[t.keyPrefix].block(t.data.key,t.data.arg,t.data.opts);break;case"get":r=this._rateLimiters[t.keyPrefix].get(t.data.key,t.data.opts);break;case"delete":r=this._rateLimiters[t.keyPrefix].delete(t.data.key,t.data.opts);break;default:return!1}r&&r.then((r=>{f(e,t,"resolve",r)})).catch((r=>{f(e,t,"reject",r)}))},g=function(e){if(!e||e.channel!==h||e.keyPrefix!==this.keyPrefix)return!1;if(this._promises[e.promiseId]){let t;switch(clearTimeout(this._promises[e.promiseId].timeoutId),t=null===e.data||!0===e.data||!1===e.data?e.data:new u(e.data.remainingPoints,e.data.msBeforeNext,e.data.consumedPoints,e.data.isFirstInDuration),e.type){case"resolve":this._promises[e.promiseId].resolve(t);break;case"reject":this._promises[e.promiseId].reject(t);break;default:throw new Error(`RateLimiterCluster: no such message type '${e.type}'`)}delete this._promises[e.promiseId]}},m=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},b=function(e,t){const r=n.hrtime();let i=r[0].toString()+r[1].toString();return void 0!==this._promises[i]&&(i+=o.randomBytes(12).toString("base64")),this._promises[i]={resolve:e,reject:t,timeoutId:setTimeout((()=>{delete this._promises[i],t(new Error("RateLimiterCluster timeout: no answer from master in time"))}),this.timeoutMs)},i};e.exports={RateLimiterClusterMaster:class{constructor(){if(l)return l;this._rateLimiters={},s.setMaxListeners(0),s.on("message",((e,t)=>{t&&t.channel===h&&"init"===t.type?(void 0===this._rateLimiters[t.opts.keyPrefix]&&(this._rateLimiters[t.opts.keyPrefix]=new c(t.opts)),e.send({channel:h,type:"init",keyPrefix:t.opts.keyPrefix})):y.call(this,e,t)})),l=this}},RateLimiterClusterMasterPM2:class{constructor(e){if(l)return l;this._rateLimiters={},e.launchBus(((t,r)=>{r.on("process:msg",(t=>{const r=t.raw;if(r&&r.channel===h&&"init"===r.type)void 0===this._rateLimiters[r.opts.keyPrefix]&&(this._rateLimiters[r.opts.keyPrefix]=new c(r.opts)),e.sendDataToProcessId(t.process.pm_id,{data:{},topic:h,channel:h,type:"init",keyPrefix:r.opts.keyPrefix},((e,t)=>{e&&i.log(e,t)}));else{y.call(this,{send:r=>{const n=r;n.topic=h,void 0===n.data&&(n.data={}),e.sendDataToProcessId(t.process.pm_id,n,((e,t)=>{e&&i.log(e,t)}))}},r)}}))})),l=this}},RateLimiterCluster:class extends a{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=void 0===e?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),n.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,n.on("message",(e=>{e&&e.channel===h&&"init"===e.type&&e.keyPrefix===this.keyPrefix?this._initiated=!0:g.call(this,e)})),n.send({channel:h,type:"init",opts:m.call(this)}),this._promises={}}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"consume",s,e,t,r)}))}penalty(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"penalty",s,e,t,r)}))}reward(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"reward",s,e,t,r)}))}block(e,t,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"block",s,e,t,r)}))}get(e,t={}){return new Promise(((r,n)=>{const i=b.call(this,r,n);p.call(this,"get",i,e,t)}))}delete(e,t={}){return new Promise(((r,n)=>{const i=b.call(this,r,n);p.call(this,"delete",i,e,t)}))}}}},12566:function(e,t,r){const n=r(97636),i=r(72621);e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,r){const n=new i;return n.consumedPoints=parseInt(r.consumedPoints),n.isFirstInDuration=r.consumedPoints===t,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=r.msBeforeNext,n}_upsert(e,t,r,n=!1,i={}){return new Promise(((s,o)=>{const a=Date.now(),c=Math.floor(r/1e3);n?this.client.set(e,t,c,(r=>{r?o(r):this.client.set(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.incr(e,t,((u,h)=>{u||!1===h?this.client.add(e,t,c,((u,h)=>{if(u||!h)if(void 0===i.attemptNumber||i.attemptNumber<3){const a=Object.assign({},i);a.attemptNumber=a.attemptNumber?a.attemptNumber+1:1,this._upsert(e,t,r,n,a).then((e=>s(e))).catch((e=>o(e)))}else o(new Error("Can not add key"));else this.client.add(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.get(`${e}_expire`,((e,t)=>{if(e)o(e);else{const e=!1===t?0:t,r={consumedPoints:h,msBeforeNext:e>=0?Math.max(e-a,0):-1};s(r)}}))}))}))}_get(e){return new Promise(((t,r)=>{const n=Date.now();this.client.get(e,((i,s)=>{s?this.client.get(`${e}_expire`,((e,i)=>{if(e)r(e);else{const e=!1===i?0:i,r={consumedPoints:s,msBeforeNext:e>=0?Math.max(e-n,0):-1};t(r)}})):t(null)}))}))}_delete(e){return new Promise(((t,r)=>{this.client.del(e,((n,i)=>{n?r(n):!1===i?t(i):this.client.del(`${e}_expire`,(e=>{e?r(e):t(i)}))}))}))}}},69559:function(e,t,r){const n=r(41599),i=r(72053),s=r(72621);e.exports=class extends n{constructor(e={}){super(e),this._memoryStorage=new i}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=this.getKey(e),o=this._getKeySecDuration(r);let a=this._memoryStorage.incrby(s,t,o);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this._memoryStorage.set(s,a.consumedPoints,this.blockDuration)),i(a);else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let e=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(n,e,a)}else n(a)}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,-t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}block(e,t){const r=1e3*t,n=this.points+1;return this._memoryStorage.set(this.getKey(e),n,t),Promise.resolve(new s(0,0===r?-1:r,n))}set(e,t,r){const n=1e3*(r>=0?r:this.duration);return this._memoryStorage.set(this.getKey(e),t,r),Promise.resolve(new s(0,0===n?-1:n,t))}get(e){const t=this._memoryStorage.get(this.getKey(e));return null!==t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}}},8786:function(e,t,r){const n=r(97636),i=r(72621);function s(e){try{const t=e.client?e.client:e,{version:r}=t.topology.s.options.metadata.driver,n=r.split(".").map((e=>parseInt(e)));return{major:n[0],feature:n[1],patch:n[2]}}catch(e){return{major:0,feature:0,patch:0}}}class o extends n{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,"function"==typeof this.client.then?this.client.then((e=>{this.client=e,this._initCollection(),this._driverVersion=s(this.client)})):(this._initCollection(),this._driverVersion=s(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?o.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get client(){return this._client}set client(e){if(void 0===e)throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const e=("function"==typeof this.client.db?this.client.db(this.dbName):this.client).collection(this.tableName);e.createIndex({expire:-1},{expireAfterSeconds:0}),e.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=e}_getRateLimiterRes(e,t,r){const n=new i;let s;return s=void 0===r.value?r:r.value,n.isFirstInDuration=s.points===t,n.consumedPoints=s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=null!==s.expire?Math.max(new Date(s.expire).getTime()-Date.now(),0):-1,n}_upsert(e,t,r,n=!1,i={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const s=i.attrs||{};let o,a;n?(o={key:e},o=Object.assign(o,s),a={$set:{key:e,points:t,expire:r>0?new Date(Date.now()+r):null}},a.$set=Object.assign(a.$set,s)):(o={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},o=Object.assign(o,s),a={$setOnInsert:{key:e,expire:r>0?new Date(Date.now()+r):null},$inc:{points:t}},a.$setOnInsert=Object.assign(a.$setOnInsert,s));const c={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?c.returnDocument="after":c.returnOriginal=!1,new Promise(((i,u)=>{this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((o=>{if(o&&11e3===o.code){const o=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},s),a={$set:Object.assign({key:e,points:t,expire:r>0?new Date(Date.now()+r):null},s)};this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((s=>{s&&11e3===s.code?this._upsert(e,t,r,n).then((e=>i(e))).catch((e=>u(e))):u(s)}))}else u(o)}))}))}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},r);return this._collection.findOne(n)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e},r);return this._collection.deleteOne(n).then((e=>e.deletedCount>0))}}e.exports=o},97391:function(e,t,r){const n=r(97636),i=r(72621);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()):this._createDbAndTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{this._getConnection().then((r=>{r.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],(()=>{this._releaseConnection(r),t()}))})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise(((e,t)=>{this.client.getConnection(((r,n)=>{if(r)return t(r);e(n)}))}));case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise(((e,t)=>{this._getConnection().then((r=>{r.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,(n=>{if(n)return this._releaseConnection(r),t(n);r.query(this._getCreateTableStmt(),(n=>{if(n)return this._releaseConnection(r),t(n);this._releaseConnection(r),e()}))}))})).catch((e=>{t(e)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(void 0===e)if("Connection"===this.client.constructor.name)e="connection";else if("Pool"===this.client.constructor.name)e="pool";else{if("Sequelize"!==this.client.constructor.name)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,[s]=r;return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_upsertTransaction(e,t,r,n,i){return new Promise(((s,o)=>{e.query("BEGIN",(a=>{if(a)return e.rollback(),o(a);const c=Date.now(),u=n>0?c+n:null;let h,l;i?(h="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = ?, \n            expire = ?;",l=[this.dbName,this.tableName,t,r,u,r,u]):(h="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = IF(expire <= ?, ?, points + (?)), \n            expire = IF(expire <= ?, ?, expire);",l=[this.dbName,this.tableName,t,r,u,c,r,r,c,u]),e.query(h,l,(r=>{if(r)return e.rollback(),o(r);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],((t,r)=>{if(t)return e.rollback(),o(t);e.query("COMMIT",(t=>{if(t)return e.rollback(),o(t);s(r)}))}))}))}))}))}_upsert(e,t,r,n=!1){return this.tableCreated?new Promise(((i,s)=>{this._getConnection().then((o=>{this._upsertTransaction(o,e,t,r,n).then((e=>{i(e),this._releaseConnection(o)})).catch((e=>{s(e),this._releaseConnection(o)}))})).catch((e=>{s(e)}))})):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],((e,i)=>{e?r(e):0===i.length?t(null):t(i),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],((e,i)=>{e?r(e):t(i.affectedRows>0),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}}},51385:function(e,t,r){const n=r(97636),i=r(72621);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?"function"==typeof t&&t():this._createTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{const r={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(r).then((()=>{t()})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":default:return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master)}}_releaseConnection(e){switch(this.clientType){case"pool":case"typeorm":default:return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e)}}_createTable(){return new Promise(((e,t)=>{this._query({text:this._getCreateTableStmt()}).then((()=>{e()})).catch((r=>{"23505"===r.code?e():t(r)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( \n      key varchar(255) PRIMARY KEY,\n      points integer NOT NULL DEFAULT 0,\n      expire bigint\n    );`}get clientType(){return this._clientType}set clientType(e){const t=this.client.constructor.name;if(void 0===e)if("Client"===t)e="client";else if("Pool"===t||"BoundPool"===t)e="pool";else{if("Sequelize"!==t)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,s=r.rows[0];return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_query(e){const t={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise(((e,r)=>{this._getConnection().then((n=>{n.query(t).then((t=>{e(t),this._releaseConnection(n)})).catch((e=>{r(e),this._releaseConnection(n)}))})).catch((e=>{r(e)}))}))}_upsert(e,t,r,n=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const i=r>0?Date.now()+r:null,s=n?" $3 ":` CASE\n             WHEN ${this.tableName}.expire <= $4 THEN $3\n             ELSE ${this.tableName}.expire\n            END `;return this._query({name:n?"rlflx-upsert-force":"rlflx-upsert",text:`\n            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)\n              ON CONFLICT(key) DO UPDATE SET\n                points = CASE\n                          WHEN (${this.tableName}.expire <= $4 OR 1=${n?1:0}) THEN $2\n                          ELSE ${this.tableName}.points + ($2)\n                         END,\n                expire = ${s}\n            RETURNING points, expire;`,values:[e,t,i,Date.now()]})}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._query({name:"rlflx-get",text:`\n            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then((e=>{0===e.rowCount&&(e=null),t(e)})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then((e=>e.rowCount>0)):Promise.reject(Error("Table is not created yet"))}}},36596:function(e,t,r){const n=r(99061),i=4294967295,s="limiter";e.exports=class{constructor(e,t={maxQueueSize:i}){this._queueLimiters={KEY_DEFAULT:new o(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=s){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=s){return this._queueLimiters[t]||(this._queueLimiters[t]=new o(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};class o{constructor(e,t={maxQueueSize:i,key:s}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then((e=>null!==e?e.remainingPoints:this._limiterFlexible.points))}removeTokens(e){const t=this;return new Promise(((r,i)=>{e>t._limiterFlexible.points?i(new n(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`)):t._queue.length>0?t._queueRequest.call(t,r,i,e):t._limiterFlexible.consume(t._key,e).then((e=>{r(e.remainingPoints)})).catch((n=>{n instanceof Error?i(n):(t._queueRequest.call(t,r,i,e),null===t._waitTimeout&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),n.msBeforeNext)))}))}))}_queueRequest(e,t,r){const i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:r}):t(new n(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){const e=this;if(null!==e._waitTimeout&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),0===e._queue.length)return;const t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then((r=>{t.resolve(r.remainingPoints),e._processFIFO.call(e)})).catch((r=>{r instanceof Error?(t.reject(r),e._processFIFO.call(e)):(e._queue.unshift(t),null===e._waitTimeout&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),r.msBeforeNext)))}))}}},62800:function(e,t,r){const n=r(97636),i=r(72621),s="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,this.useRedisPackage=e.useRedisPackage,this.useRedis3AndLowerPackage=e.useRedis3AndLowerPackage,"function"==typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:s})}_isRedisReady(){return!this._rejectIfRedisNotReady||(!this.client.status||"ready"===this.client.status)&&!("function"==typeof this.client.isReady&&!this.client.isReady())}_getRateLimiterRes(e,t,r){let[n,s]=r;Array.isArray(n)&&([,n]=n,[,s]=s);const o=new i;return o.consumedPoints=parseInt(n),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=s,o}async _upsert(e,t,r,n=!1){if(!this._isRedisReady())throw new Error("Redis connection is not ready");const i=Math.floor(r/1e3),o=this.client.multi();return n?(i>0?this.useRedisPackage||this.useRedis3AndLowerPackage?o.set(e,t,{EX:i}):o.set(e,t,"EX",i):o.set(e,t),this.useRedisPackage||this.useRedis3AndLowerPackage?o.pTTL(e).exec(!0):o.pttl(e).exec(!0)):i>0?this.useRedisPackage||this.useRedis3AndLowerPackage?this.useRedis3AndLowerPackage?new Promise(((r,n)=>{const o=function(e,t){return e?n(e):r(t)};"function"==typeof this.client.rlflxIncr?this.client.rlflxIncr(e,t,i,o):this.client.eval(s,1,e,t,i,o)})):this.client.eval(s,{keys:[e],arguments:[String(t),String(i)]}):this.client.rlflxIncr([e].concat([String(t),String(i)])):this.useRedisPackage||this.useRedis3AndLowerPackage?o.incrBy(e,t).pTTL(e).exec(!0):o.incrby(e,t).pttl(e).exec(!0)}async _get(e){if(!this._isRedisReady())throw new Error("Redis connection is not ready");return this.useRedisPackage||this.useRedis3AndLowerPackage?this.client.multi().get(e).pTTL(e).exec(!0).then((e=>{const[t]=e;return null===t?null:e})):this.client.multi().get(e).pttl(e).exec().then((e=>{const[[,t]]=e;return null===t?null:e}))}_delete(e){return this.client.del(e).then((e=>e>0))}}},72621:function(e){e.exports=class{constructor(e,t,r,n){this.remainingPoints=void 0===e?0:e,this.msBeforeNext=void 0===t?0:t,this.consumedPoints=void 0===r?0:r,this.isFirstInDuration=void 0!==n&&n}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},97636:function(e,t,r){const n=r(41599),i=r(88521),s=r(72621);e.exports=class extends n{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new i}get client(){return this._client}set client(e){if(void 0===e)throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,r,n,i,s={}){const o=this._getRateLimiterRes(r,n,i);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&o.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(r,o.msBeforeNext),o.consumedPoints>this.points?t(o):e(o);if(o.consumedPoints>this.points){let e=Promise.resolve();this.blockDuration>0&&o.consumedPoints<=this.points+n&&(o.msBeforeNext=this.msBlockDuration,e=this._block(r,o.consumedPoints,this.msBlockDuration,s)),this.inMemoryBlockOnConsumed>0&&o.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(r,this.inMemoryBlockDuration),o.msBeforeNext=this.msInMemoryBlockDuration),e.then((()=>{t(o)})).catch((e=>{t(e)}))}else if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let t=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=o.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,t,o)}else e(o)}_handleError(e,t,r,i,s,o=!1,a={}){this.insuranceLimiter instanceof n?this.insuranceLimiter[t](s,o,a).then((e=>{r(e)})).catch((e=>{i(e)})):i(e)}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(void 0!==e&&!(e instanceof n))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,r={}){const n=1e3*t;return this._block(this.getKey(e),this.points+1,n,r)}set(e,t,r,n={}){const i=1e3*(r>=0?r:this.duration);return this._block(this.getKey(e),t,i,n)}consume(e,t=1,r={}){return new Promise(((n,i)=>{const o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return i(new s(0,a));this._upsert(o,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{this._afterConsume(n,i,o,t,e)})).catch((s=>{this._handleError(s,"consume",n,i,e,t,r)}))}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,t,e))})).catch((n=>{this._handleError(n,"penalty",i,s,e,t,r)}))}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,-t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,-t,e))})).catch((n=>{this._handleError(n,"reward",i,s,e,t,r)}))}))}get(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._get(r,t).then((e=>{n(null==e?null:this._getRateLimiterRes(r,0,e))})).catch((r=>{this._handleError(r,"get",n,i,e,t)}))}))}delete(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._delete(r,t).then((e=>{this._inMemoryBlockedKeys.delete(r),n(e)})).catch((r=>{this._handleError(r,"delete",n,i,e,t)}))}))}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,r){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,r,n={}){return new Promise(((i,o)=>{this._upsert(e,t,r,!0,n).then((()=>{i(new s(0,r>0?r:-1,t))})).catch((t=>{this._handleError(t,"block",i,o,this.parseKey(e),r/1e3,n)}))}))}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,r,n=!1,i={}){throw new Error("You have to implement the method '_upsert'!")}}},35946:function(e,t,r){const n=r(41599);e.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach((e=>{if(!(e instanceof n))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")})),this._limiters=e}consume(e,t=1){return new Promise(((r,n)=>{const i=[];this._limiters.forEach((r=>{i.push(r.consume(e,t).catch((e=>({rejected:!0,rej:e}))))})),Promise.all(i).then((e=>{const t={};let i=!1;e.forEach((e=>{!0===e.rejected&&(i=!0)}));for(let r=0;r<e.length;r++)i&&!0===e[r].rejected?t[this._limiters[r].keyPrefix]=e[r].rej:i||(t[this._limiters[r].keyPrefix]=e[r]);i?n(t):r(t)}))}))}}},91117:function(e){e.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach((t=>{this._keys[t]<=e&&delete this._keys[t]})),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,1e3*t)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();const e=Date.now();return t>=e?t-e:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach((e=>{delete this._keys[e]}))}}},88521:function(e,t,r){const n=r(91117);e.exports=n},72053:function(e,t,r){const n=r(71433),i=r(72621);e.exports=class{constructor(){this._storage={}}incrby(e,t,r){if(this._storage[e]){const n=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return 0!==n?(this._storage[e].value=this._storage[e].value+t,new i(0,n,this._storage[e].value,!1)):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const s=1e3*r;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new n(t,s>0?new Date(Date.now()+s):null),s>0&&(this._storage[e].timeoutId=setTimeout((()=>{delete this._storage[e]}),s),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new i(0,0===s?-1:s,this._storage[e].value,!0)}get(e){if(this._storage[e]){const t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return new i(0,t,this._storage[e].value,!1)}return null}delete(e){return!!this._storage[e]&&(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0)}}},71433:function(e){e.exports=class{constructor(e,t,r=null){this.value=e,this.expiresAt=t,this.timeoutId=r}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){e instanceof Date||!Number.isInteger(e)||(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}},99061:function(e){e.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}},56915:function(e,t,r){"use strict";e.exports=r.p+"cyb_rune_wasm_bg.eebb9da894.wasm"},64482:function(e,t,r){var n,i,s;i=[r(42450)],void 0===(s="function"==typeof(n=function(e){"use strict";var t=e.Reader,r=e.Writer,n=e.util,i=e.roots.default||(e.roots.default={});return i.RPC=function(){function s(e){if(this.subscriptions=[],this.messages=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.subscriptions=n.emptyArray,s.prototype.messages=n.emptyArray,s.prototype.control=null,Object.defineProperty(s.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){if(t||(t=r.create()),null!=e.subscriptions&&e.subscriptions.length)for(var n=0;n<e.subscriptions.length;++n)i.RPC.SubOpts.encode(e.subscriptions[n],t.uint32(10).fork()).ldelim();if(null!=e.messages&&e.messages.length)for(n=0;n<e.messages.length;++n)i.RPC.Message.encode(e.messages[n],t.uint32(18).fork()).ldelim();return null!=e.control&&Object.hasOwnProperty.call(e,"control")&&i.RPC.ControlMessage.encode(e.control,t.uint32(26).fork()).ldelim(),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.subscriptions&&s.subscriptions.length||(s.subscriptions=[]),s.subscriptions.push(i.RPC.SubOpts.decode(e,e.uint32()));break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.push(i.RPC.Message.decode(e,e.uint32()));break;case 3:s.control=i.RPC.ControlMessage.decode(e,e.uint32());break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC)return e;var t=new i.RPC;if(e.subscriptions){if(!Array.isArray(e.subscriptions))throw TypeError(".RPC.subscriptions: array expected");t.subscriptions=[];for(var r=0;r<e.subscriptions.length;++r){if("object"!=typeof e.subscriptions[r])throw TypeError(".RPC.subscriptions: object expected");t.subscriptions[r]=i.RPC.SubOpts.fromObject(e.subscriptions[r])}}if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".RPC.messages: array expected");for(t.messages=[],r=0;r<e.messages.length;++r){if("object"!=typeof e.messages[r])throw TypeError(".RPC.messages: object expected");t.messages[r]=i.RPC.Message.fromObject(e.messages[r])}}if(null!=e.control){if("object"!=typeof e.control)throw TypeError(".RPC.control: object expected");t.control=i.RPC.ControlMessage.fromObject(e.control)}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.subscriptions=[],r.messages=[]),e.subscriptions&&e.subscriptions.length){r.subscriptions=[];for(var n=0;n<e.subscriptions.length;++n)r.subscriptions[n]=i.RPC.SubOpts.toObject(e.subscriptions[n],t)}if(e.messages&&e.messages.length)for(r.messages=[],n=0;n<e.messages.length;++n)r.messages[n]=i.RPC.Message.toObject(e.messages[n],t);return null!=e.control&&e.hasOwnProperty("control")&&(r.control=i.RPC.ControlMessage.toObject(e.control,t),t.oneofs&&(r._control="control")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s.SubOpts=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.subscribe=null,s.prototype.topic=null,Object.defineProperty(s.prototype,"_subscribe",{get:n.oneOfGetter(o=["subscribe"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_topic",{get:n.oneOfGetter(o=["topic"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.subscribe&&Object.hasOwnProperty.call(e,"subscribe")&&t.uint32(8).bool(e.subscribe),null!=e.topic&&Object.hasOwnProperty.call(e,"topic")&&t.uint32(18).string(e.topic),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.SubOpts;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.subscribe=e.bool();break;case 2:s.topic=e.string();break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.SubOpts)return e;var t=new i.RPC.SubOpts;return null!=e.subscribe&&(t.subscribe=Boolean(e.subscribe)),null!=e.topic&&(t.topic=String(e.topic)),t},s.toObject=function(e,t){t||(t={});var r={};return null!=e.subscribe&&e.hasOwnProperty("subscribe")&&(r.subscribe=e.subscribe,t.oneofs&&(r._subscribe="subscribe")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic,t.oneofs&&(r._topic="topic")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.Message=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.from=null,s.prototype.data=null,s.prototype.seqno=null,s.prototype.topic="",s.prototype.signature=null,s.prototype.key=null,Object.defineProperty(s.prototype,"_from",{get:n.oneOfGetter(o=["from"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_data",{get:n.oneOfGetter(o=["data"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_seqno",{get:n.oneOfGetter(o=["seqno"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_signature",{get:n.oneOfGetter(o=["signature"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_key",{get:n.oneOfGetter(o=["key"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.from&&Object.hasOwnProperty.call(e,"from")&&t.uint32(10).bytes(e.from),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.seqno&&Object.hasOwnProperty.call(e,"seqno")&&t.uint32(26).bytes(e.seqno),t.uint32(34).string(e.topic),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(50).bytes(e.key),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var s=void 0===r?e.len:e.pos+r,o=new i.RPC.Message;e.pos<s;){var a=e.uint32();switch(a>>>3){case 1:o.from=e.bytes();break;case 2:o.data=e.bytes();break;case 3:o.seqno=e.bytes();break;case 4:o.topic=e.string();break;case 5:o.signature=e.bytes();break;case 6:o.key=e.bytes();break;default:e.skipType(7&a)}}if(!o.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:o});return o},s.fromObject=function(e){if(e instanceof i.RPC.Message)return e;var t=new i.RPC.Message;return null!=e.from&&("string"==typeof e.from?n.base64.decode(e.from,t.from=n.newBuffer(n.base64.length(e.from)),0):e.from.length&&(t.from=e.from)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.seqno&&("string"==typeof e.seqno?n.base64.decode(e.seqno,t.seqno=n.newBuffer(n.base64.length(e.seqno)),0):e.seqno.length&&(t.seqno=e.seqno)),null!=e.topic&&(t.topic=String(e.topic)),null!=e.signature&&("string"==typeof e.signature?n.base64.decode(e.signature,t.signature=n.newBuffer(n.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.key&&("string"==typeof e.key?n.base64.decode(e.key,t.key=n.newBuffer(n.base64.length(e.key)),0):e.key.length&&(t.key=e.key)),t},s.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.topic=""),null!=e.from&&e.hasOwnProperty("from")&&(r.from=t.bytes===String?n.base64.encode(e.from,0,e.from.length):t.bytes===Array?Array.prototype.slice.call(e.from):e.from,t.oneofs&&(r._from="from")),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data,t.oneofs&&(r._data="data")),null!=e.seqno&&e.hasOwnProperty("seqno")&&(r.seqno=t.bytes===String?n.base64.encode(e.seqno,0,e.seqno.length):t.bytes===Array?Array.prototype.slice.call(e.seqno):e.seqno,t.oneofs&&(r._seqno="seqno")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic),null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?n.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature,t.oneofs&&(r._signature="signature")),null!=e.key&&e.hasOwnProperty("key")&&(r.key=t.bytes===String?n.base64.encode(e.key,0,e.key.length):t.bytes===Array?Array.prototype.slice.call(e.key):e.key,t.oneofs&&(r._key="key")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlMessage=function(){function s(e){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return s.prototype.ihave=n.emptyArray,s.prototype.iwant=n.emptyArray,s.prototype.graft=n.emptyArray,s.prototype.prune=n.emptyArray,s.encode=function(e,t){if(t||(t=r.create()),null!=e.ihave&&e.ihave.length)for(var n=0;n<e.ihave.length;++n)i.RPC.ControlIHave.encode(e.ihave[n],t.uint32(10).fork()).ldelim();if(null!=e.iwant&&e.iwant.length)for(n=0;n<e.iwant.length;++n)i.RPC.ControlIWant.encode(e.iwant[n],t.uint32(18).fork()).ldelim();if(null!=e.graft&&e.graft.length)for(n=0;n<e.graft.length;++n)i.RPC.ControlGraft.encode(e.graft[n],t.uint32(26).fork()).ldelim();if(null!=e.prune&&e.prune.length)for(n=0;n<e.prune.length;++n)i.RPC.ControlPrune.encode(e.prune[n],t.uint32(34).fork()).ldelim();return t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlMessage;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.push(i.RPC.ControlIHave.decode(e,e.uint32()));break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.push(i.RPC.ControlIWant.decode(e,e.uint32()));break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.push(i.RPC.ControlGraft.decode(e,e.uint32()));break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.push(i.RPC.ControlPrune.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlMessage)return e;var t=new i.RPC.ControlMessage;if(e.ihave){if(!Array.isArray(e.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");t.ihave=[];for(var r=0;r<e.ihave.length;++r){if("object"!=typeof e.ihave[r])throw TypeError(".RPC.ControlMessage.ihave: object expected");t.ihave[r]=i.RPC.ControlIHave.fromObject(e.ihave[r])}}if(e.iwant){if(!Array.isArray(e.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");for(t.iwant=[],r=0;r<e.iwant.length;++r){if("object"!=typeof e.iwant[r])throw TypeError(".RPC.ControlMessage.iwant: object expected");t.iwant[r]=i.RPC.ControlIWant.fromObject(e.iwant[r])}}if(e.graft){if(!Array.isArray(e.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");for(t.graft=[],r=0;r<e.graft.length;++r){if("object"!=typeof e.graft[r])throw TypeError(".RPC.ControlMessage.graft: object expected");t.graft[r]=i.RPC.ControlGraft.fromObject(e.graft[r])}}if(e.prune){if(!Array.isArray(e.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");for(t.prune=[],r=0;r<e.prune.length;++r){if("object"!=typeof e.prune[r])throw TypeError(".RPC.ControlMessage.prune: object expected");t.prune[r]=i.RPC.ControlPrune.fromObject(e.prune[r])}}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.ihave=[],r.iwant=[],r.graft=[],r.prune=[]),e.ihave&&e.ihave.length){r.ihave=[];for(var n=0;n<e.ihave.length;++n)r.ihave[n]=i.RPC.ControlIHave.toObject(e.ihave[n],t)}if(e.iwant&&e.iwant.length)for(r.iwant=[],n=0;n<e.iwant.length;++n)r.iwant[n]=i.RPC.ControlIWant.toObject(e.iwant[n],t);if(e.graft&&e.graft.length)for(r.graft=[],n=0;n<e.graft.length;++n)r.graft[n]=i.RPC.ControlGraft.toObject(e.graft[n],t);if(e.prune&&e.prune.length)for(r.prune=[],n=0;n<e.prune.length;++n)r.prune[n]=i.RPC.ControlPrune.toObject(e.prune[n],t);return r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlIHave=function(){function s(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.topicID=null,s.prototype.messageIDs=n.emptyArray,Object.defineProperty(s.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(18).bytes(e.messageIDs[n]);return t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlIHave;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.topicID=e.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),s.messageIDs.push(e.bytes());break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlIHave)return e;var t=new i.RPC.ControlIHave;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var i=0;i<e.messageIDs.length;++i)r.messageIDs[i]=t.bytes===String?n.base64.encode(e.messageIDs[i],0,e.messageIDs[i].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[i]):e.messageIDs[i]}return r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlIWant=function(){function s(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return s.prototype.messageIDs=n.emptyArray,s.encode=function(e,t){if(t||(t=r.create()),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(10).bytes(e.messageIDs[n]);return t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlIWant;e.pos<n;){var o=e.uint32();o>>>3==1?(s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),s.messageIDs.push(e.bytes())):e.skipType(7&o)}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlIWant)return e;var t=new i.RPC.ControlIWant;if(e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var i=0;i<e.messageIDs.length;++i)r.messageIDs[i]=t.bytes===String?n.base64.encode(e.messageIDs[i],0,e.messageIDs[i].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[i]):e.messageIDs[i]}return r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlGraft=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.topicID=null,Object.defineProperty(s.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlGraft;e.pos<n;){var o=e.uint32();o>>>3==1?s.topicID=e.string():e.skipType(7&o)}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlGraft)return e;var t=new i.RPC.ControlGraft;return null!=e.topicID&&(t.topicID=String(e.topicID)),t},s.toObject=function(e,t){t||(t={});var r={};return null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlPrune=function(){function s(e){if(this.peers=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.topicID=null,s.prototype.peers=n.emptyArray,s.prototype.backoff=null,Object.defineProperty(s.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_backoff",{get:n.oneOfGetter(o=["backoff"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.peers&&e.peers.length)for(var n=0;n<e.peers.length;++n)i.RPC.PeerInfo.encode(e.peers[n],t.uint32(18).fork()).ldelim();return null!=e.backoff&&Object.hasOwnProperty.call(e,"backoff")&&t.uint32(24).uint64(e.backoff),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlPrune;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.topicID=e.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),s.peers.push(i.RPC.PeerInfo.decode(e,e.uint32()));break;case 3:s.backoff=e.uint64();break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlPrune)return e;var t=new i.RPC.ControlPrune;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.peers){if(!Array.isArray(e.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");t.peers=[];for(var r=0;r<e.peers.length;++r){if("object"!=typeof e.peers[r])throw TypeError(".RPC.ControlPrune.peers: object expected");t.peers[r]=i.RPC.PeerInfo.fromObject(e.peers[r])}}return null!=e.backoff&&(n.Long?(t.backoff=n.Long.fromValue(e.backoff)).unsigned=!0:"string"==typeof e.backoff?t.backoff=parseInt(e.backoff,10):"number"==typeof e.backoff?t.backoff=e.backoff:"object"==typeof e.backoff&&(t.backoff=new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0))),t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.peers=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.peers&&e.peers.length){r.peers=[];for(var s=0;s<e.peers.length;++s)r.peers[s]=i.RPC.PeerInfo.toObject(e.peers[s],t)}return null!=e.backoff&&e.hasOwnProperty("backoff")&&("number"==typeof e.backoff?r.backoff=t.longs===String?String(e.backoff):e.backoff:r.backoff=t.longs===String?n.Long.prototype.toString.call(e.backoff):t.longs===Number?new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0):e.backoff,t.oneofs&&(r._backoff="backoff")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.PeerInfo=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.peerID=null,s.prototype.signedPeerRecord=null,Object.defineProperty(s.prototype,"_peerID",{get:n.oneOfGetter(o=["peerID"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_signedPeerRecord",{get:n.oneOfGetter(o=["signedPeerRecord"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.peerID&&Object.hasOwnProperty.call(e,"peerID")&&t.uint32(10).bytes(e.peerID),null!=e.signedPeerRecord&&Object.hasOwnProperty.call(e,"signedPeerRecord")&&t.uint32(18).bytes(e.signedPeerRecord),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.PeerInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.peerID=e.bytes();break;case 2:s.signedPeerRecord=e.bytes();break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.PeerInfo)return e;var t=new i.RPC.PeerInfo;return null!=e.peerID&&("string"==typeof e.peerID?n.base64.decode(e.peerID,t.peerID=n.newBuffer(n.base64.length(e.peerID)),0):e.peerID.length&&(t.peerID=e.peerID)),null!=e.signedPeerRecord&&("string"==typeof e.signedPeerRecord?n.base64.decode(e.signedPeerRecord,t.signedPeerRecord=n.newBuffer(n.base64.length(e.signedPeerRecord)),0):e.signedPeerRecord.length&&(t.signedPeerRecord=e.signedPeerRecord)),t},s.toObject=function(e,t){t||(t={});var r={};return null!=e.peerID&&e.hasOwnProperty("peerID")&&(r.peerID=t.bytes===String?n.base64.encode(e.peerID,0,e.peerID.length):t.bytes===Array?Array.prototype.slice.call(e.peerID):e.peerID,t.oneofs&&(r._peerID="peerID")),null!=e.signedPeerRecord&&e.hasOwnProperty("signedPeerRecord")&&(r.signedPeerRecord=t.bytes===String?n.base64.encode(e.signedPeerRecord,0,e.signedPeerRecord.length):t.bytes===Array?Array.prototype.slice.call(e.signedPeerRecord):e.signedPeerRecord,t.oneofs&&(r._signedPeerRecord="signedPeerRecord")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s}(),i})?n.apply(t,i):n)||(e.exports=s)},30320:function(e,t,r){"use strict";r.d(t,{DN:function(){return a},aS:function(){return o},mr:function(){return i},sy:function(){return s}});var n=r(19045),i="function"==typeof WeakMap&&!(0,n.wY)((function(){return"ReactNative"==navigator.product&&!global.HermesInternal})),s="function"==typeof WeakSet,o="function"==typeof Symbol&&"function"==typeof Symbol.for,a=o&&Symbol.asyncIterator;(0,n.wY)((function(){return window.document.createElement})),(0,n.wY)((function(){return navigator.userAgent.indexOf("jsdom")>=0}))},56970:function(e,t,r){"use strict";function n(e){try{return e()}catch(e){}}r.d(t,{w:function(){return n}})},49736:function(e,t,r){"use strict";r.d(t,{C:function(){return i},aY:function(){return s},h6:function(){return o}});var n=r(1262);function i(e){return Boolean((0,n.cs)(e))}function s(e){return Boolean((0,n.XK)(e))}function o(e){return Boolean((0,n.yb)(e))}},1262:function(e,t,r){"use strict";r.d(t,{yb:function(){return c},cs:function(){return o},XK:function(){return a}});const n=45,i=15,s=new class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically((()=>{const t=this.readChar();if(t===e)return t}))}readSeparator(e,t,r){return this.readAtomically((()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return r()}))}readNumber(e,t,r,n){return this.readAtomically((()=>{let i=0,s=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*n)-1;for(;;){const r=this.readAtomically((()=>{const t=this.readChar();if(void 0===t)return;const r=Number.parseInt(t,e);return Number.isNaN(r)?void 0:r}));if(void 0===r)break;if(i*=e,i+=r,i>c)return;if(s+=1,void 0!==t&&s>t)return}return 0===s||!r&&a&&s>1?void 0:i}))}readIPv4Addr(){return this.readAtomically((()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,(()=>this.readNumber(10,3,!1,1)));if(void 0===r)return;e[t]=r}return e}))}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const r=2*t;if(t<e.length-3){const n=this.readSeparator(":",t,(()=>this.readIPv4Addr()));if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}const n=this.readSeparator(":",t,(()=>this.readNumber(16,4,!0,2)));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically((()=>{const t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const i=new Uint8Array(14),s=16-(r+2),[o]=e(i.subarray(0,s));return t.set(i.subarray(0,o),16-o),t}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function o(e){if(!(e.length>i))return s.new(e).parseWith((()=>s.readIPv4Addr()))}function a(e){if(!(e.length>n))return s.new(e).parseWith((()=>s.readIPv6Addr()))}function c(e){if(!(e.length>n))return s.new(e).parseWith((()=>s.readIPAddr()))}},99644:function(e,t,r){"use strict";r.d(t,{t:function(){return wn}});var n={};r.r(n),r.d(n,{base10:function(){return we}});var i={};r.r(i),r.d(i,{base16:function(){return ve},base16upper:function(){return _e}});var s={};r.r(s),r.d(s,{base2:function(){return Ee}});var o={};r.r(o),r.d(o,{base256emoji:function(){return Ae}});var a={};r.r(a),r.d(a,{base32:function(){return Ie},base32hex:function(){return De},base32hexpad:function(){return Be},base32hexpadupper:function(){return Me},base32hexupper:function(){return Re},base32pad:function(){return Pe},base32padupper:function(){return Te},base32upper:function(){return Ce},base32z:function(){return Oe}});var c={};r.r(c),r.d(c,{base36:function(){return Ne},base36upper:function(){return Le}});var u={};r.r(u),r.d(u,{base58btc:function(){return Ue},base58flickr:function(){return je}});var h={};r.r(h),r.d(h,{base64:function(){return ze},base64pad:function(){return Fe},base64url:function(){return Ke},base64urlpad:function(){return $e}});var l={};r.r(l),r.d(l,{base8:function(){return Ve}});var f={};r.r(f),r.d(f,{identity:function(){return We}});var d={};r.r(d),r.d(d,{code:function(){return Je},decode:function(){return Ze},encode:function(){return Ye},name:function(){return Ge}});var p={};r.r(p),r.d(p,{code:function(){return Qe},decode:function(){return tt},encode:function(){return et},name:function(){return Xe}});var y={};r.r(y),r.d(y,{identity:function(){return At}});var g={};r.r(g),r.d(g,{sha256:function(){return Tt},sha512:function(){return Dt}});var m={};r.r(m),r.d(m,{Ed25519PrivateKey:function(){return ur},Ed25519PublicKey:function(){return cr},generateKeyPair:function(){return fr},generateKeyPairFromSeed:function(){return dr},unmarshalEd25519PrivateKey:function(){return hr},unmarshalEd25519PublicKey:function(){return lr}});var b={};r.r(b),r.d(b,{MAX_KEY_SIZE:function(){return Ar},RsaPrivateKey:function(){return Cr},RsaPublicKey:function(){return Ir},fromJwk:function(){return Dr},generateKeyPair:function(){return Rr},unmarshalRsaPrivateKey:function(){return Pr},unmarshalRsaPublicKey:function(){return Tr}});var w={};r.r(w),r.d(w,{Secp256k1PrivateKey:function(){return Nr},Secp256k1PublicKey:function(){return Or},generateKeyPair:function(){return jr},unmarshalSecp256k1PrivateKey:function(){return Lr},unmarshalSecp256k1PublicKey:function(){return Ur}});var v=r(9202),_=r(20375),E=r(85275);function k(){const e=(0,E.Z)();let t=!1;return{sink:async r=>{if(t)throw new Error("already piped");t=!0,e.resolve(r)},source:async function*(){const t=await e.promise;yield*t}()}}var x=r(32629);const S=65535,A=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var I=r(33869),C=r(4101);function P(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function T(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function D(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");P(e.outputLen),P(e.blockLen)}function R(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function B(e,t){T(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const M="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,O=e=>e instanceof Uint8Array,N=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),L=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function U(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!O(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class j{clone(){return this._cloneInto()}}function z(e){const t=t=>e().update(U(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}class F extends j{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,D(e);const r=U(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return R(this),this.iHash.update(e),this}digestInto(e){R(this),T(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const K=(e,t,r)=>new F(e,t).update(r).digest();function $(e,t,r){return D(e),void 0===r&&(r=new Uint8Array(e.outputLen)),K(e,U(r),U(t))}K.create=(e,t)=>new F(e,t);const V=new Uint8Array([0]),W=new Uint8Array;function q(e,t,r,n=32){if(D(e),P(n),n>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/e.outputLen);void 0===r&&(r=W);const s=new Uint8Array(i*e.outputLen),o=K.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let t=0;t<i;t++)V[0]=t+1,a.update(0===t?W:c).update(r).update(V).digestInto(c),s.set(c,e.outputLen*t),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),V.fill(0),s.slice(0,n)}class H extends j{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=N(this.buffer)}update(e){R(this);const{view:t,buffer:r,blockLen:n}=this,i=(e=U(e)).length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o!==n)r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0);else{const t=N(e);for(;n<=i-s;s+=n)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){R(this),B(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:i}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,a,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);const o=N(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.length=n,e.pos=o,e.finished=i,e.destroyed=s,n%t&&e.buffer.set(r),e}}const G=(e,t,r)=>e&t^e&r^t&r,J=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Y=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Z=new Uint32Array(64);class X extends H{constructor(){super(64,32,8,!1),this.A=0|Y[0],this.B=0|Y[1],this.C=0|Y[2],this.D=0|Y[3],this.E=0|Y[4],this.F=0|Y[5],this.G=0|Y[6],this.H=0|Y[7]}get(){const{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)Z[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Z[e-15],r=Z[e-2],n=L(t,7)^L(t,18)^t>>>3,i=L(r,17)^L(r,19)^r>>>10;Z[e]=i+Z[e-7]+n+Z[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let e=0;e<64;e++){const t=u+(L(o,6)^L(o,11)^L(o,25))+((h=o)&a^~h&c)+J[e]+Z[e]|0,l=(L(r,2)^L(r,13)^L(r,22))+G(r,n,i)|0;u=c,c=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+l|0}var h;r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,n,i,s,o,a,c,u)}roundClean(){Z.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Q=z((()=>new X)),ee={hashSHA256:e=>Q(e),getHKDF(e,t){const r=$(Q,t,e),n=q(Q,r,void 0,96);return[n.subarray(0,32),n.subarray(32,64),n.subarray(64,96)]},generateX25519KeyPair(){const e=C.Sg.utils.randomPrivateKey();return{publicKey:C.Sg.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:C.Sg.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>C.Sg.getSharedSecret(e,t),chaCha20Poly1305Encrypt:(e,t,r,n)=>(0,I.CK)(n,t,r).encrypt(e),chaCha20Poly1305Decrypt:(e,t,r,n,i)=>(0,I.CK)(n,t,r).decrypt(e,i)};function te(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function re(e=0){return null!=globalThis.Buffer?.allocUnsafe?te(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function ne(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=re(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return te(r)}const ie=e=>{const t=(r=2,globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r));var r;return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};ie.bytes=2;const se=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};se.bytes=2;var oe=r(49541),ae=(r(3068),r(97450),r(3832));var ce=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},ue=ce;new Uint8Array(0);const he=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class le{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class fe{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return pe(this,e)}}class de{constructor(e){this.decoders=e}or(e){return pe(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const pe=(e,t)=>new de({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class ye{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new le(e,t,r),this.decoder=new fe(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ge=({name:e,prefix:t,encode:r,decode:n})=>new ye(e,t,r,n),me=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=ue(r,t);return ge({prefix:e,name:t,encode:n,decode:e=>he(i(e))})},be=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>ge({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),we=me({prefix:"9",name:"base10",alphabet:"0123456789"}),ve=be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_e=be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ee=be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ke=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),xe=ke.reduce(((e,t,r)=>(e[r]=t,e)),[]),Se=ke.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Ae=ge({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=xe[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Se[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),Ie=be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ce=be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Pe=be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Te=be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),De=be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Re=be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Be=be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Me=be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Oe=be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Ne=me({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Le=me({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ue=me({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),je=me({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ze=be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fe=be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ke=be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$e=be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Ve=be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),We=ge({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),qe=new TextEncoder,He=new TextDecoder,Ge="json",Je=512,Ye=e=>qe.encode(JSON.stringify(e)),Ze=e=>JSON.parse(He.decode(e)),Xe="raw",Qe=85,et=e=>he(e),tt=e=>he(e);var rt=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=st;)r[n++]=255&t|nt,t/=128;for(;t&it;)r[n++]=255&t|nt,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},nt=128,it=-128,st=Math.pow(2,31);var ot=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&ct)<<s:(n&ct)*Math.pow(2,s),s+=7}while(n>=at);return e.bytes=o-r,i},at=128,ct=127;var ut=Math.pow(2,7),ht=Math.pow(2,14),lt=Math.pow(2,21),ft=Math.pow(2,28),dt=Math.pow(2,35),pt=Math.pow(2,42),yt=Math.pow(2,49),gt=Math.pow(2,56),mt=Math.pow(2,63),bt={encode:rt,decode:ot,encodingLength:function(e){return e<ut?1:e<ht?2:e<lt?3:e<ft?4:e<dt?5:e<pt?6:e<yt?7:e<gt?8:e<mt?9:10}};const wt=(e,t=0)=>[bt.decode(e,t),bt.decode.bytes],vt=(e,t,r=0)=>(bt.encode(e,t,r),t),_t=e=>bt.encodingLength(e),Et=(e,t)=>{const r=t.byteLength,n=_t(e),i=n+_t(r),s=new Uint8Array(i+r);return vt(e,s,0),vt(r,s,n),s.set(t,i),new xt(e,r,t,s)},kt=e=>{const t=he(e),[r,n]=wt(t),[i,s]=wt(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new xt(r,i,o,t)};class xt{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const St=he,At={code:0,name:"identity",encode:St,digest:e=>Et(0,St(e))},It=({name:e,code:t,encode:r})=>new Ct(e,t,r);class Ct{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Et(this.code,t):t.then((e=>Et(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Pt=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Tt=It({name:"sha2-256",code:18,encode:Pt("SHA-256")}),Dt=It({name:"sha2-512",code:19,encode:Pt("SHA-512")}),Rt=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Lt(r,Mt(e),t||Ue.encoder):Ut(r,Mt(e),t||Ie.encoder)},Bt=new WeakMap,Mt=e=>{const t=Bt.get(e);if(null==t){const t=new Map;return Bt.set(e,t),t}return t};class Ot{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==jt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==zt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ot.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Et(e,t);return Ot.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ot.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return Rt(this,e)}toJSON(){return{"/":Rt(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Ot)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Ot(e,r,n,i||Ft(e,r,n.bytes))}if(!0===t[Kt]){const{version:e,multihash:r,code:n}=t,i=kt(r);return Ot.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==jt)throw new Error(`Version 0 CID must use dag-pb (code: ${jt}) block encoding`);return new Ot(e,t,r,r.bytes);case 1:{const n=Ft(e,t,r.bytes);return new Ot(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Ot.create(0,jt,e)}static createV1(e,t){return Ot.create(1,e,t)}static decode(e){const[t,r]=Ot.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ot.inspectBytes(e),r=t.size-t.multihashSize,n=he(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new xt(t.multihashCode,t.digestSize,i,n);return[0===t.version?Ot.createV0(s):Ot.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=wt(e.subarray(t));return t+=n,r};let n=r(),i=jt;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Nt(e,t),i=Ot.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Mt(i).set(r,e),i}}const Nt=(e,t)=>{switch(e[0]){case"Q":{const r=t||Ue;return[Ue.prefix,r.decode(`${Ue.prefix}${e}`)]}case Ue.prefix:{const r=t||Ue;return[Ue.prefix,r.decode(e)]}case Ie.prefix:{const r=t||Ie;return[Ie.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Lt=(e,t,r)=>{const{prefix:n}=r;if(n!==Ue.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Ut=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},jt=112,zt=18,Ft=(e,t,r)=>{const n=_t(e),i=n+_t(t),s=new Uint8Array(i+r.byteLength);return vt(e,s,0),vt(t,s,n),s.set(r,i),s},Kt=Symbol.for("@ipld/js-cid/CID"),$t={...f,...s,...l,...n,...i,...a,...c,...u,...h,...o};function Vt(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Wt=Vt("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),qt=Vt("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=re((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Ht={utf8:Wt,"utf-8":Wt,hex:$t.base16,latin1:qt,ascii:qt,binary:qt,...$t};function Gt(e,t="utf8"){const r=Ht[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):te(globalThis.Buffer.from(e,"utf-8"))}function Jt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const Yt=32,Zt=64,Xt=32;function Qt(e,t){const r=new Uint8Array(Zt);for(let n=0;n<Xt;n++)r[n]=e[n],r[Xt+n]=t[n];return r}var er={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const tr={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function rr(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=er.get();return r*=8,{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),h=a.getRandomValues(new Uint8Array(n)),l={name:t,iv:h};let f;if("string"==typeof c&&(c=Gt(c)),0===c.length){f=await a.subtle.importKey("jwk",tr,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{f=await a.subtle.importKey("jwk",tr,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const d=await a.subtle.encrypt(l,f,e);return ne([u,l.iv,new Uint8Array(d)])},decrypt:async function(e,c){const u=e.subarray(0,s),h=e.subarray(s,s+n),l=e.subarray(s+n),f={name:t,iv:h};let d;if("string"==typeof c&&(c=Gt(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{d=await a.subtle.importKey("jwk",tr,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(f,d,l);return new Uint8Array(p)}}}(),n=await r.encrypt(e,t);return ze.encode(n)}var nr,ir,sr,or,ar=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(nr||(nr={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(ir||(ir={})),function(e){e.codec=()=>(0,ar.Ji)(ir)}(nr||(nr={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),nr.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=nr.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(sr||(sr={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),nr.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=nr.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(or||(or={}));class cr{_key;constructor(e){this._key=pr(e,Yt)}async verify(e,t){return async function(e,t,r){return C.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return sr.encode({Type:nr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Jt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Tt.digest(this.bytes);return e}}class ur{_key;_publicKey;constructor(e,t){this._key=pr(e,Zt),this._publicKey=pr(t,Yt)}async sign(e){return async function(e,t){const r=e.subarray(0,Xt);return C.UN.sign(t,r)}(this._key,e)}get public(){return new cr(this._publicKey)}marshal(){return this._key}get bytes(){return or.encode({Type:nr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Jt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Tt.digest(this.bytes);return e}async id(){const e=At.digest(this.public.bytes);return Ue.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return rr(this.bytes,e);throw new oe.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function hr(e){if(e.length>Zt){const t=(e=pr(e,Zt+Yt)).subarray(0,Zt),r=e.subarray(Zt,e.length);return new ur(t,r)}const t=(e=pr(e,Zt)).subarray(0,Zt),r=e.subarray(Yt);return new ur(t,r)}function lr(e){return e=pr(e,Yt),new cr(e)}async function fr(){const{privateKey:e,publicKey:t}=await async function(){const e=C.UN.utils.randomPrivateKey(),t=C.UN.getPublicKey(e);return{privateKey:Qt(e,t),publicKey:t}}();return new ur(e,t)}async function dr(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==Xt)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=C.UN.getPublicKey(t);return{privateKey:Qt(t,r),publicKey:r}}(e);return new ur(t,r)}function pr(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new oe.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}function yr(e,t="utf8"){const r=Ht[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}r(97116),r(15764);function gr(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=ne([new Uint8Array(t-r.length),r])}return yr(r,"base64url")}function mr(e){const t=function(e,t){let r=Gt(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=ne([new Uint8Array(t-r.length),r])}return r}(e);return new ae.jsbn.BigInteger(yr(t,"base16"),16)}const br={"P-256":256,"P-384":384,"P-521":521};Object.keys(br).join(" / ");r(63219);function wr(e){if(isNaN(e)||e<=0)throw new oe.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(M&&"function"==typeof M.getRandomValues)return M.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}r(28095);function vr(e,t){return t.map((t=>mr(e[t])))}async function _r(e){const t=[await er.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await kr(e)],r=await Er({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function Er(e){if(null==e.privateKey||null==e.publicKey)throw new oe.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([er.get().subtle.exportKey("jwk",e.privateKey),er.get().subtle.exportKey("jwk",e.publicKey)])}async function kr(e){return er.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function xr(e,t,r,n){const i=t?function(e){return ae.pki.setRsaPublicKey(...vr(e,["n","e"]))}(e):function(e){return ae.pki.setRsaPrivateKey(...vr(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Gt(n(yr(Uint8Array.from(r),"ascii"),i),"ascii")}function Sr(e){if("RSA"!==e.kty)throw new oe.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new oe.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*Gt(e.n,"base64url").length}const Ar=8192;class Ir{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await er.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return er.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new oe.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=ae.pki.publicKeyToAsn1({n:mr(e.n),e:mr(e.e)});return Gt(ae.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return sr.encode({Type:nr.RSA,Data:this.marshal()}).subarray()}encrypt(e){return xr(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Jt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Tt.digest(this.bytes);return e}}class Cr{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return wr(16)}async sign(e){return async function(e,t){const r=await er.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await er.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new oe.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Ir(this._publicKey)}decrypt(e){return xr(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new oe.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=ae.pki.privateKeyToAsn1({n:mr(e.n),e:mr(e.e),d:mr(e.d),p:mr(e.p),q:mr(e.q),dP:mr(e.dp),dQ:mr(e.dq),qInv:mr(e.qi)});return Gt(ae.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return or.encode({Type:nr.RSA,Data:this.marshal()}).subarray()}equals(e){return Jt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Tt.digest(this.bytes);return e}async id(){return yr(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new ae.util.ByteBuffer(this.marshal()),r=ae.asn1.fromDer(t),n=ae.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return ae.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return rr(this.bytes,e);throw new oe.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Pr(e){const t=function(e){const t=ae.asn1.fromDer(yr(e,"ascii")),r=ae.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:gr(r.n),e:gr(r.e),d:gr(r.d),p:gr(r.p),q:gr(r.q),dp:gr(r.dP),dq:gr(r.dQ),qi:gr(r.qInv),alg:"RS256"}}(e);if(Sr(t)>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await _r(t);return new Cr(r.privateKey,r.publicKey)}function Tr(e){const t=function(e){const t=ae.asn1.fromDer(yr(e,"ascii")),r=ae.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:gr(r.n),e:gr(r.e)}}(e);if(Sr(t)>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Ir(t)}async function Dr(e){if(Sr(e)>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await _r(e);return new Cr(t.privateKey,t.publicKey)}async function Rr(e){if(e>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await er.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await Er(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Cr(t.privateKey,t.publicKey)}var Br=r(60533);function Mr(e){try{Br.kA.ProjectivePoint.fromHex(e)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Or{_key;constructor(e){Mr(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await Tt.digest(r);return Br.kA.verify(t,n,e)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Br.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return sr.encode({Type:nr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Jt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Tt.digest(this.bytes);return e}}class Nr{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return Br.kA.getPublicKey(e,!0)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Br.kA.getPublicKey(e,!0)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Mr(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await Tt.digest(t);try{return Br.kA.sign(r,e).toDERRawBytes()}catch(e){throw new oe.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Or(this._publicKey)}marshal(){return this._key}get bytes(){return or.encode({Type:nr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Jt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Tt.digest(this.bytes);return e}async id(){return yr(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return rr(this.bytes,e);throw new oe.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Lr(e){return new Nr(e)}function Ur(e){return new Or(e)}async function jr(){const e=Br.kA.utils.randomPrivateKey();return new Nr(e)}const zr={rsa:b,ed25519:m,secp256k1:w};function Fr(e){const t=Object.keys(zr).join(" / ");return new oe.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}async function Kr(e){const t=or.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case nr.RSA:return zr.rsa.unmarshalRsaPrivateKey(r);case nr.Ed25519:return zr.ed25519.unmarshalEd25519PrivateKey(r);case nr.Secp256k1:return zr.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Fr(t.Type??"RSA")}}var $r=r(5681);const Vr=Symbol.for("nodejs.util.inspect.custom"),Wr=Object.values($t).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),$t.identity.decoder),qr=114,Hr=36,Gr=37;class Jr{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[$r.N]=!0;toString(){return null==this.string&&(this.string=Ue.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Ot.createV1(qr,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Jt(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??Wr,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=kt(Ue.decode(`z${e}`));return e.startsWith("12D")?new Zr({multihash:t}):e.startsWith("16U")?new Xr({multihash:t}):new Yr({multihash:t})}return function(e){try{const t=kt(e);if(t.code===At.code){if(t.digest.length===Hr)return new Zr({multihash:t});if(t.digest.length===Gr)return new Xr({multihash:t})}if(t.code===Tt.code)return new Yr({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==qr)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Tt.code)return new Yr({multihash:e.multihash});if(t.code===At.code){if(t.digest.length===Hr)return new Zr({multihash:e.multihash});if(t.digest.length===Gr)return new Xr({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Ot.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(Wr.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return Jt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Vr](){return`PeerId(${this.toString()})`}}class Yr extends Jr{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Zr extends Jr{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class Xr extends Jr{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}async function Qr(e,t){return e.length===Hr?new Zr({multihash:Et(At.code,e),privateKey:t}):e.length===Gr?new Xr({multihash:Et(At.code,e),privateKey:t}):new Yr({multihash:await Tt.digest(e),publicKey:e,privateKey:t})}var en,tn;async function rn(e,t,r){const n=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");return(await Kr(e.privateKey)).sign(t)}(e,on(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,r){return tn.encode({identityKey:e,identitySig:t,extensions:r??{webtransportCerthashes:[]}}).subarray()}(e.publicKey,n,r)}async function nn(e){return Qr(e.identityKey)}function sn(e){return tn.decode(e)}function on(e){const t=Gt("noise-libp2p-static-key:");return ne([t,e],t.length+e.length)}async function an(e,t,r){const n=await Qr(t.identityKey);if(!n.equals(r))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${r.toString()}`);const i=on(e);if(null==n.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const s=function(e){const t=sr.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case nr.RSA:return zr.rsa.unmarshalRsaPublicKey(r);case nr.Ed25519:return zr.ed25519.unmarshalEd25519PublicKey(r);case nr.Secp256k1:return zr.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Fr(t.Type??"unknown")}}(n.publicKey);if(!await s.verify(i,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function cn(e){return e instanceof Uint8Array&&32===e.length}!function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={webtransportCerthashes:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.webtransportCerthashes.push(e.bytes());else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(en||(en={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.identityKey&&e.identityKey.byteLength>0)&&(t.uint32(10),t.bytes(e.identityKey??new Uint8Array(0))),(!0===r.writeDefaults||null!=e.identitySig&&e.identitySig.byteLength>0)&&(t.uint32(18),t.bytes(e.identitySig??new Uint8Array(0))),null!=e.extensions&&(t.uint32(34),en.codec().encode(e.extensions,t,{writeDefaults:!1})),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.identityKey=e.bytes();break;case 2:r.identitySig=e.bytes();break;case 4:r.extensions=en.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(tn||(tn={}));var un=r(11227);un.formatters.b=e=>null==e?"undefined":Ue.baseEncode(e),un.formatters.t=e=>null==e?"undefined":Ie.baseEncode(e),un.formatters.m=e=>null==e?"undefined":ze.baseEncode(e),un.formatters.p=e=>null==e?"undefined":e.toString(),un.formatters.c=e=>null==e?"undefined":e.toString(),un.formatters.k=e=>null==e?"undefined":e.toString(),un.formatters.a=e=>null==e?"undefined":e.toString();const hn=function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return un.enabled(`${e}:trace`)&&null!=un.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=un(`${e}:trace`)),Object.assign(un(e),{error:un(`${e}:error`),trace:t})}("libp2p:noise");let ln;function fn(e){e?(ln(`LOCAL_PUBLIC_EPHEMERAL_KEY ${yr(e.publicKey,"hex")}`),ln(`LOCAL_PRIVATE_EPHEMERAL_KEY ${yr(e.privateKey,"hex")}`)):ln("Missing local ephemeral keys.")}function dn(e){ln(`REMOTE_EPHEMERAL_PUBLIC_KEY ${yr(e,"hex")}`)}ln=A?hn:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});class pn{n;bytes;view;constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}class yn{crypto;constructor(e){this.crypto=e}encryptWithAd(e,t,r){const n=this.encrypt(e.k,e.n,t,r);return e.n.increment(),n}decryptWithAd(e,t,r,n){const{plaintext:i,valid:s}=this.decrypt(e.k,e.n,t,r,n);return s&&e.n.increment(),{plaintext:i,valid:s}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){return Jt(this.createEmptyKey(),e)}encrypt(e,t,r,n){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(n,t.getBytes(),r,e)}encryptAndHash(e,t){let r;return r=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,r),r}decrypt(e,t,r,n,i){t.assertValue();const s=this.crypto.chaCha20Poly1305Decrypt(n,t.getBytes(),r,e,i);return s?{plaintext:s,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let r,n=!0;return this.hasKey(e.cs)?({plaintext:r,valid:n}=this.decryptWithAd(e.cs,e.h,t)):r=t,this.mixHash(e,t),{plaintext:r,valid:n}}dh(e,t){try{const r=this.crypto.generateX25519SharedKey(e,t);return 32===r.length?r:r.subarray(0,32)}catch(e){const t=e;return hn.error(t),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(ne([e,t],e.length+t.length))}mixKey(e,t){const[r,n]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(n),e.ck=r}initializeKey(e){return{k:e,n:new pn}}initializeSymmetric(e){const t=Gt(e,"utf-8"),r=this.hashProtocolName(t),n=r,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:n,h:r}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}return this.getHash(e,new Uint8Array(0))}split(e){const[t,r]=this.crypto.getHKDF(e.ck,new Uint8Array(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(r)}}writeMessageRegular(e,t){const r=this.encryptWithAd(e,new Uint8Array(0),t);return{ne:this.createEmptyKey(),ns:new Uint8Array(0),ciphertext:r}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class gn extends yn{initializeInitiator(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:r,psk:n,re:new Uint8Array(32)}}initializeResponder(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:r,psk:n,re:new Uint8Array(32)}}writeMessageA(e,t,r){const n=new Uint8Array(0);e.e=void 0!==r?r:this.crypto.generateX25519KeyPair();const i=e.e.publicKey;this.mixHash(e.ss,i);return{ne:i,ns:n,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const n=e.s.publicKey,i=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));return{ne:r,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const r=e.s.publicKey,n=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t),s={ne:this.createEmptyKey(),ns:n,ciphertext:i},{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:s,cs1:o,cs2:a}}readMessageA(e,t){return cn(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(cn(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);n&&cn(r)&&(e.rs=r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:n&&s}}readMessageC(e,t){const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);if(n&&cn(r)&&(e.rs=r),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:n&&s,cs1:o,cs2:a}}initSession(e,t,r){const n=this.createEmptyKey(),i=new Uint8Array(32);let s;return s=e?this.initializeInitiator(t,r,i,n):this.initializeResponder(t,r,i,n),{hs:s,i:e,mc:0}}sendMessage(e,t,r){let n;if(0===e.mc)n=this.writeMessageA(e.hs,t,r);else if(1===e.mc)n=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:r,messageBuffer:i,cs1:s,cs2:o}=this.writeMessageC(e.hs,t);n=i,e.h=r,e.cs1=s,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");n=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");n=this.writeMessageRegular(e.cs2,t)}}return e.mc++,n}recvMessage(e,t){let r=new Uint8Array(0),n=!1;if(0===e.mc)({plaintext:r,valid:n}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:r,valid:n}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:i,plaintext:s,valid:o,cs1:a,cs2:c}=this.readMessageC(e.hs,t);r=s,n=o,e.h=i,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:r,valid:n}}}class mn{isInitiator;session;remotePeer;remoteExtensions={webtransportCerthashes:[]};payload;connection;xx;staticKeypair;prologue;constructor(e,t,r,n,i,s,o,a){this.isInitiator=e,this.payload=t,this.prologue=r,this.staticKeypair=i,this.connection=s,o&&(this.remotePeer=o),this.xx=a??new gn(n),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){var e,t;if(e=this.session.hs.s,ln(`LOCAL_STATIC_PUBLIC_KEY ${yr(e.publicKey,"hex")}`),ln(`LOCAL_STATIC_PRIVATE_KEY ${yr(e.privateKey,"hex")}`),this.isInitiator){hn.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));await this.connection.write((t=e,ne([t.ne,t.ciphertext],t.ne.length+t.ciphertext.length))),hn.trace("Stage 0 - Initiator finished sending first message."),fn(this.session.hs.e)}else{hn.trace("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:new Uint8Array(0)}}((await this.connection.read()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new oe.kz("xx handshake stage 0 validation fail");hn.trace("Stage 0 - Responder received first message."),dn(this.session.hs.re)}}async exchange(){if(this.isInitiator){hn.trace("Stage 1 - Initiator waiting to receive first message from responder...");const e=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.read()).subarray()),{plaintext:r,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new oe.kz("xx handshake stage 1 validation fail");hn.trace("Stage 1 - Initiator received the message."),dn(this.session.hs.re),t=this.session.hs.rs,ln(`REMOTE_STATIC_PUBLIC_KEY ${yr(t,"hex")}`),hn.trace("Initiator going to check remote's signature...");try{const e=sn(r);this.remotePeer=this.remotePeer||await nn(e),await an(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new oe.kT(`Error occurred while verifying signed payload: ${t.message}`)}hn.trace("All good with the signature!")}else{hn.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const t=this.xx.sendMessage(this.session,this.payload);await this.connection.write((e=t,ne([e.ne,e.ns,e.ciphertext],e.ne.length+e.ns.length+e.ciphertext.length))),hn.trace("Stage 1 - Responder sent the second handshake message with signed payload."),fn(this.session.hs.e)}var e,t}async finish(){if(this.isInitiator){hn.trace("Stage 2 - Initiator sending third handshake message.");const t=this.xx.sendMessage(this.session,this.payload);await this.connection.write((e=t,ne([e.ns,e.ciphertext],e.ns.length+e.ciphertext.length))),hn.trace("Stage 2 - Initiator sent message with signed payload.")}else{hn.trace("Stage 2 - Responder waiting for third handshake message...");const e=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.read()).subarray()),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new oe.kz("xx handshake stage 2 validation fail");hn.trace("Stage 2 - Responder received the message, finished handshake.");try{const e=sn(t);this.remotePeer=this.remotePeer||await nn(e),await an(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new oe.kT(`Error occurred while verifying signed payload: ${t.message}`)}}var e,t;(t=this.session).cs1&&t.cs2?(ln(`CIPHER_STATE_1 ${t.cs1.n.getUint64()} ${yr(t.cs1.k,"hex")}`),ln(`CIPHER_STATE_2 ${t.cs2.n.getUint64()} ${yr(t.cs2.k,"hex")}`)):ln("Missing cipher state.")}encrypt(e,t){const r=this.getCS(t);return this.xx.encryptWithAd(r,new Uint8Array(0),e)}decrypt(e,t,r){const n=this.getCS(t,!1);return this.xx.decryptWithAd(n,new Uint8Array(0),e,r)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new oe.kz("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}class bn{protocol="/noise";crypto;prologue;staticKeys;extensions;metrics;constructor(e={}){const{staticNoiseKey:t,extensions:r,crypto:n,prologueBytes:i,metrics:s}=e;this.crypto=n??ee,this.extensions=r,this.metrics=s?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(s):void 0,this.staticKeys=t?this.crypto.generateX25519KeyPairFromSeed(t):this.crypto.generateX25519KeyPair(),this.prologue=i??new Uint8Array(0)}async secureOutbound(e,t,r){const n=(0,_.p)(t,{lengthEncoder:ie,lengthDecoder:se,maxDataLength:S}),i=await this.performHandshake({connection:n,isInitiator:!0,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,r){const n=(0,_.p)(t,{lengthEncoder:ie,lengthDecoder:se,maxDataLength:S}),i=await this.performHandshake({connection:n,isInitiator:!1,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){const t=await rn(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:r,remotePeer:n,connection:i}=e,s=new mn(r,t,this.prologue,this.crypto,this.staticKeys,i,n);try{await s.propose(),await s.exchange(),await s.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){if(this.metrics?.xxHandshakeErrors.increment(),e instanceof Error)throw e.message=`Error occurred during XX handshake: ${e.message}`,e}return s}async createSecureConnection(e,t){const[r,n]=function(){const e=k(),t=k();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),i=e.unwrap();return await(0,x.z)(r,function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=65519){let i=r+65519;i>n.length&&(i=n.length);const s=e.encrypt(n.subarray(r,i),e.session);t?.encryptedPackets.increment(),yield ie(s.byteLength),yield s}}}(t,this.metrics),i,(e=>(0,v.J)(e,{lengthDecoder:se})),function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=S){let i=r+S;if(i>n.length&&(i=n.length),i-16<r)throw new Error("Invalid chunk");const s=n.subarray(r,i),o=n.subarray(r,i-16),{plaintext:a,valid:c}=e.decrypt(s,e.session,o);if(!c)throw t?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");t?.decryptedPackets.increment(),yield a}}}(t,this.metrics),r),n}}function wn(e={}){return()=>new bn(e)}},79071:function(e,t,r){"use strict";r.d(t,{P:function(){return re}});var n=r(49541),i=r(11227);var s=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);class o{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class a{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return u(this,e)}}class c{constructor(e){this.decoders=e}or(e){return u(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const u=(e,t)=>new c({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class h{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new o(e,t,r),this.decoder=new a(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const l=({name:e,prefix:t,encode:r,decode:n})=>new h(e,t,r,n),f=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=s(r,t);return l({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},d=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>l({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),p=d({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),y=(d({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),d({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),d({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),d({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),d({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),d({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),d({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),f({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"})),g=(f({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),d({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}));d({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),d({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),d({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function m(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return i.enabled(`${e}:trace`)&&null!=i.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=i(`${e}:trace`)),Object.assign(i(e),{error:i(`${e}:error`),trace:t})}i.formatters.b=e=>null==e?"undefined":y.baseEncode(e),i.formatters.t=e=>null==e?"undefined":p.baseEncode(e),i.formatters.m=e=>null==e?"undefined":g.baseEncode(e),i.formatters.p=e=>null==e?"undefined":e.toString(),i.formatters.c=e=>null==e?"undefined":e.toString(),i.formatters.k=e=>null==e?"undefined":e.toString(),i.formatters.a=e=>null==e?"undefined":e.toString();class b extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function w(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new b(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new b(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}var v=r(32629),_=r(85275);class E{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class k{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new E(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new E(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class x extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function S(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new k,a=(0,_.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>i?r:(i=!0,null!=e?(e=>(o=new k,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,_.Z)()}))}},return:()=>(o=new k,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new x)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(l.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return l.readableLength}},r}const A="ERR_INVALID_FRAME",I="ERR_UNREQUESTED_PING",C="ERR_NOT_MATCHING_PING",P="ERR_STREAM_ALREADY_EXISTS",T="ERR_DECODE_INVALID_VERSION",D="ERR_BOTH_CLIENTS",R="ERR_RECV_WINDOW_EXCEEDED",B=new Set([A,I,C,P,T,D,R]),M="ERR_INVALID_CONFIG",O="ERR_MUXER_LOCAL_CLOSED",N="ERR_MUXER_REMOTE_CLOSED",L=262144,U={log:m("libp2p:yamux"),enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:L,maxStreamWindowSize:16777216,maxMessageSize:65536};var j,z,F=r(62308);!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(j||(j={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(z||(z={}));const K=Object.values(z).filter((e=>"string"!=typeof e));var $;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}($||($={}));function V(e){const t=K.filter((t=>(e.flag&t)===t)).map((e=>z[e])).join("|");return`streamID=${e.streamID} type=${j[e.type]} flag=${t} length=${e.length}`}const W=2**24;class q{source;buffer;frameInProgress;constructor(e){this.source=function(e){if(void 0!==e[Symbol.iterator]){const t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw new Error("a source must be either an iterable or an async iterable")}(e),this.buffer=new F.H,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const e=this.readHeader();if(void 0===e)break;const{type:t,length:r}=e;t===j.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,r)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new n.sv("decoding frame already in progress","ERR_DECODE_IN_PROGRESS");if(this.buffer.length<12)return;const e=function(e){if(0!==e[0])throw new n.sv("Invalid frame version",T);return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*W+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*W+(e[9]<<16)+(e[10]<<8)+e[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),e}async readBytes(e){if(this.buffer.length<e)for await(const t of this.source)if(this.buffer.append(t),this.buffer.length>=e)break;const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function H(e){const t=new Uint8Array(12);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}var G=r(77399),J=r(75671);var Y,Z=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r),yield r}();const r=(0,J.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s?.then)return async function*(){yield n;for await(const e of r)await t(e),yield e}();const o=t;return function*(){yield n;for(const e of r)o(e),yield e}()};!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(Y||(Y={}));class X extends G.b{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super({...e,onEnd:t=>{this.state=Y.Finished,e.onEnd?.(t)}}),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=L,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=Z(this.source,(()=>{this.sendWindowUpdate()}))}async sendNewStream(){}async sendData(e,t={}){for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&await this.waitForSendWindowCapacity(t),"open"!==this.status)return;const r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,e.length),n=this.getSendFlags();this.sendFrame({type:j.Data,flag:n,streamID:this._id,length:r},e.subarray(0,r)),this.sendWindowCapacity-=r,e.consume(r)}}async sendReset(){this.sendFrame({type:j.WindowUpdate,flag:z.RST,streamID:this._id,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|z.FIN;this.sendFrame({type:j.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(e={}){if(this.sendWindowCapacity>0)return;let t,r;const i=()=>{"open"===this.status?r(new n.sv("stream aborted","ERR_STREAM_ABORT")):t()};e.signal?.addEventListener("abort",i);try{await new Promise(((e,n)=>{this.sendWindowCapacityUpdate=()=>{e()},r=n,t=e}))}finally{e.signal?.removeEventListener("abort",i)}}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);const t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,0===t&&e.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(e,t){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new n.sv("receive window exceeded",R,{available:this.recvWindowCapacity,recv:e.length});const r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&z.ACK)===z.ACK&&this.state===Y.SYNSent&&(this.state=Y.Established),(e&z.FIN)===z.FIN&&this.remoteCloseWrite(),(e&z.RST)===z.RST&&this.reset()}getSendFlags(){switch(this.state){case Y.Init:return this.state=Y.SYNSent,z.SYN;case Y.SYNReceived:return this.state=Y.Established,z.ACK;default:return 0}}sendWindowUpdate(){const e=this.getSendFlags(),t=Date.now(),r=this.getRTT();if(0===e&&r>0&&t-this.epochStart<4*r&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;const n=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:j.WindowUpdate,flag:e,streamID:this._id,length:n})}}const Q="/yamux/1.0.0";class ee{protocol=Q;_init;constructor(e={}){this._init=e}createStreamMuxer(e){return new te({...this._init,...e})}}class te{protocol=Q;source;sink;config;log;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e){this.client="outbound"===e.direction,this.config={...U,...e},this.log=this.config.log,function(e){if(e.keepAliveInterval<=0)throw new n.sv("keep-alive interval must be positive",M);if(e.maxInboundStreams<0)throw new n.sv("max inbound streams must be larger or equal 0",M);if(e.maxOutboundStreams<0)throw new n.sv("max outbound streams must be larger or equal 0",M);if(e.initialStreamWindowSize<L)throw new n.sv("InitialStreamWindowSize must be larger or equal 256 kB",M);if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new n.sv("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",M);if(e.maxStreamWindowSize>2**32-1)throw new n.sv("MaxStreamWindowSize must be less than equal MAX_UINT32",M);if(e.maxMessageSize<1024)throw new n.sv("MaxMessageSize must be greater than a kilobyte",M)}(this.config),this.closeController=new AbortController,this.onIncomingStream=e.onIncomingStream,this.onStreamEnd=e.onStreamEnd,this._streams=new Map,this.source=function(e={}){return S((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach((e=>{e.destroy()}))}}),this.sink=async e=>{let t,r;e=w(e,this.closeController.signal,{returnOnAbort:!0});try{const r=new q(e);await(0,v.z)(r.emitFrames.bind(r),(async e=>{for await(const{header:t,readData:r}of e)await this.handleFrame(t,r)})),t=$.NormalTermination}catch(e){const n=e.code;B.has(n)?(this.log?.error("protocol error in sink",e),t=$.ProtocolError):(this.log?.error("internal error in sink",e),t=$.InternalError),r=e}this.log?.trace("muxer sink ended"),null!=r?this.abort(r,t):await this.close({reason:t})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=0,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch((e=>this.log?.error("keepalive error: %s",e)))}get streams(){return Array.from(this._streams.values())}newStream(e){if(void 0!==this.remoteGoAway)throw new n.sv("muxer closed remotely",N);if(void 0!==this.localGoAway)throw new n.sv("muxer closed locally",O);const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new n.sv("max outbound streams exceeded","ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED");this.log?.trace("new outgoing stream id=%s",t);const r=this._newStream(t,e,Y.Init,"outbound");return this._streams.set(t,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new n.sv("muxer closed remotely",N);if(void 0!==this.localGoAway)throw new n.sv("muxer closed locally",O);if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise(((t,r)=>{const i=()=>{r(new n.sv("muxer closed locally",O))};this.closeController.signal.addEventListener("abort",i,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",i),t()}})),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const r=Date.now();this.rtt=r-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.closeController.signal.aborted)return;const t=e?.reason??$.NormalTermination;this.log?.trace("muxer close reason=%s",t),e.signal=e.signal??AbortSignal.timeout(500);try{await Promise.all([...this._streams.values()].map((async t=>t.close(e)))),this.sendGoAway(t),this._closeMuxer()}catch(e){this.abort(e)}}abort(e,t){if(!this.closeController.signal.aborted){t=t??$.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e);for(const t of this._streams.values())t.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,r,i){if(null!=this._streams.get(e))throw new n.sv("Stream already exists",P,{id:e});const s=new X({id:e.toString(),name:t,state:r,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(s)},log:m(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){const e=new Promise(((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})}));for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise((e=>{t=setTimeout(e,this.config.keepAliveInterval)}))]),this.ping().catch((e=>this.log?.error("ping error: %s",e)))}catch(e){return void clearInterval(t)}}}async handleFrame(e,t){const{streamID:r,type:i,length:s}=e;if(this.log?.trace("received frame %s",V(e)),0===r)switch(i){case j.Ping:return void this.handlePing(e);case j.GoAway:return void this.handleGoAway(s);default:throw new n.sv("Invalid frame type",A,{header:e})}else switch(e.type){case j.Data:case j.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new n.sv("Invalid frame type",A,{header:e})}}handlePing(e){if(e.flag===z.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,z.ACK);else{if(e.flag!==z.ACK)throw new n.sv("Invalid frame flag",A,{header:e});this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length)}}handlePingResponse(e){if(void 0===this.activePing)throw new n.sv("ping not requested",I);if(this.activePing.id!==e)throw new n.sv("ping doesn't match our id",C);this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",$[e]??"unknown"),this.remoteGoAway=e;for(const e of this._streams.values())e.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:r,flag:n,type:i}=e;(n&z.SYN)===z.SYN&&this.incomingStream(r);const s=this._streams.get(r);if(void 0!==s)switch(i){case j.WindowUpdate:return void s.handleWindowUpdate(e);case j.Data:if(void 0===t)throw new Error("unreachable");return void await s.handleData(e,t);default:throw new Error("unreachable")}else if(i===j.Data){if(this.log?.("discarding data for stream id=%s",r),void 0===t)throw new Error("unreachable");await t()}else this.log?.("frame for missing stream id=%s",r)}incomingStream(e){if(this.client!==(e%2==0))throw new n.sv("both endpoints are clients",D);if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:j.WindowUpdate,flag:z.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return this.log?.("maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:j.WindowUpdate,flag:z.RST,streamID:e,length:0});const t=this._newStream(e,void 0,Y.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %s",V(e)),e.type===j.Data){if(void 0===t)throw new n.sv("invalid frame",A);this.source.push(H(e)),this.source.push(t)}else this.source.push(H(e))}sendPing(e,t=z.SYN){t===z.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:j.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=$.NormalTermination){this.log?.("sending GoAway reason=%s",$[e]),this.localGoAway=e,this.sendFrame({type:j.GoAway,flag:0,streamID:0,length:e})}}function re(e={}){return()=>new ee(e)}},9839:function(e,t,r){"use strict";r(1262);parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255])},53184:function(e,t,r){"use strict";r.d(t,{Y4:function(){return xi}});var n={};r.r(n),r.d(n,{code:function(){return x},decode:function(){return A},encode:function(){return S},name:function(){return k}});var i=r(32114);var s=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t};var o=function(e,t=1){return t=Number(t),null!=e[Symbol.asyncIterator]?async function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for await(const n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}():function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for(const n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}()};async function*a(e,t=1){for await(const r of o(e,t)){const e=r.map((async e=>e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const r=await e[t];if(!r.ok)throw r.err;yield r.value}}}var c=r(62308);const u=(e={})=>{const t=e.chunkSize??262144;return async function*(e){let r=new c.H,n=0,i=!1;for await(const s of e)for(r.append(s),n+=s.length;n>=t;)if(yield r.slice(0,t),i=!0,t===r.length)r=new c.H,n=0;else{const e=new c.H;e.append(r.sublist(t)),r=e,n-=t}(!i||n>0)&&(yield r.subarray(0,n))}};var h,l,f,d=r(33808),p=r(46888);!function(e){let t,r,n;!function(e){e.Raw="Raw",e.Directory="Directory",e.File="File",e.Metadata="Metadata",e.Symlink="Symlink",e.HAMTShard="HAMTShard"}(t=e.DataType||(e.DataType={})),function(e){e[e.Raw=0]="Raw",e[e.Directory=1]="Directory",e[e.File=2]="File",e[e.Metadata=3]="Metadata",e[e.Symlink=4]="Symlink",e[e.HAMTShard=5]="HAMTShard"}(r||(r={})),function(e){e.codec=()=>(0,p.Ji)(r)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==n&&(n=(0,p.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.Type&&(r.uint32(8),e.DataType.codec().encode(t.Type,r)),null!=t.Data&&(r.uint32(18),r.bytes(t.Data)),null!=t.filesize&&(r.uint32(24),r.uint64(t.filesize)),null!=t.blocksizes)for(const e of t.blocksizes)r.uint32(32),r.uint64(e);null!=t.hashType&&(r.uint32(40),r.uint64(t.hashType)),null!=t.fanout&&(r.uint32(48),r.uint64(t.fanout)),null!=t.mode&&(r.uint32(56),r.uint32(t.mode)),null!=t.mtime&&(r.uint32(66),l.codec().encode(t.mtime,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={blocksizes:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.Type=e.DataType.codec().decode(t);break;case 2:n.Data=t.bytes();break;case 3:n.filesize=t.uint64();break;case 4:n.blocksizes.push(t.uint64());break;case 5:n.hashType=t.uint64();break;case 6:n.fanout=t.uint64();break;case 7:n.mode=t.uint32();break;case 8:n.mtime=l.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(h||(h={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,p.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(l||(l={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,p.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.MimeType=e.string();else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(f||(f={}));const y={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},g=["directory","hamt-sharded-directory"],m=parseInt("0644",8),b=parseInt("0755",8);class w{static unmarshal(e){const t=h.decode(e),r=new w({type:y[null!=t.Type?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:null!=t.mtime?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return r._originalMode=t.mode??0,r}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){const{type:t,data:r,blockSizes:n,hashType:s,fanout:o,mtime:a,mode:c}=e;if(null!=t&&!Object.values(y).includes(t))throw i(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t??"file",this.data=r,this.hashType=s,this.fanout=o,this.blockSizes=n??[],this._originalMode=0,this.mode=c,this.mtime=a}set mode(e){this._mode=null==e?this.isDirectory()?b:m:4095&e}get mode(){return this._mode}isDirectory(){return g.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach((t=>{e+=t})),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=h.DataType.Raw;break;case"directory":e=h.DataType.Directory;break;case"file":e=h.DataType.File;break;case"metadata":e=h.DataType.Metadata;break;case"symlink":e=h.DataType.Symlink;break;case"hamt-sharded-directory":e=h.DataType.HAMTShard;break;default:throw i(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let t,r,n=this.data;return null!=this.data&&0!==this.data.length||(n=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(this.mode??0),t!==m||this.isDirectory()||(t=void 0),t===b&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(r={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),h.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r})}}const v=new Uint8Array(0),_=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):v},E=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},k="raw",x=85,S=e=>E(e),A=e=>E(e);var I=r(43905);var C=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class P{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class T{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return R(this,e)}}class D{constructor(e){this.decoders=e}or(e){return R(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const R=(e,t)=>new D({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class B{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new P(e,t,r),this.decoder=new T(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const M=({name:e,prefix:t,encode:r,decode:n})=>new B(e,t,r,n),O=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=C(r,t);return M({prefix:e,name:t,encode:n,decode:e=>E(i(e))})},N=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>M({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),L=N({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),U=(N({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),N({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),N({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),N({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),N({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),N({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),N({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),N({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),O({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));O({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var j=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=K;)r[n++]=255&t|z,t/=128;for(;t&F;)r[n++]=255&t|z,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},z=128,F=-128,K=Math.pow(2,31);var $=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&W)<<s:(n&W)*Math.pow(2,s),s+=7}while(n>=V);return e.bytes=o-r,i},V=128,W=127;var q=Math.pow(2,7),H=Math.pow(2,14),G=Math.pow(2,21),J=Math.pow(2,28),Y=Math.pow(2,35),Z=Math.pow(2,42),X=Math.pow(2,49),Q=Math.pow(2,56),ee=Math.pow(2,63),te={encode:j,decode:$,encodingLength:function(e){return e<q?1:e<H?2:e<G?3:e<J?4:e<Y?5:e<Z?6:e<X?7:e<Q?8:e<ee?9:10}};const re=(e,t=0)=>[te.decode(e,t),te.decode.bytes],ne=(e,t,r=0)=>(te.encode(e,t,r),t),ie=e=>te.encodingLength(e),se=(e,t)=>{const r=t.byteLength,n=ie(e),i=n+ie(r),s=new Uint8Array(i+r);return ne(e,s,0),ne(r,s,n),s.set(t,i),new ae(e,r,t,s)},oe=e=>{const t=E(e),[r,n]=re(t),[i,s]=re(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new ae(r,i,o,t)};class ae{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const ce=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?de(r,he(e),t||U.encoder):pe(r,he(e),t||L.encoder)},ue=new WeakMap,he=e=>{const t=ue.get(e);if(null==t){const t=new Map;return ue.set(e,t),t}return t};class le{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ye)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ge)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return le.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=se(e,t);return le.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return le.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return ce(this,e)}toJSON(){return{"/":ce(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof le)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new le(e,r,n,i||me(e,r,n.bytes))}if(!0===t[be]){const{version:e,multihash:r,code:n}=t,i=oe(r);return le.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ye)throw new Error(`Version 0 CID must use dag-pb (code: ${ye}) block encoding`);return new le(e,t,r,r.bytes);case 1:{const n=me(e,t,r.bytes);return new le(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return le.create(0,ye,e)}static createV1(e,t){return le.create(1,e,t)}static decode(e){const[t,r]=le.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=le.inspectBytes(e),r=t.size-t.multihashSize,n=E(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new ae(t.multihashCode,t.digestSize,i,n);return[0===t.version?le.createV0(s):le.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=re(e.subarray(t));return t+=n,r};let n=r(),i=ye;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=fe(e,t),i=le.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return he(i).set(r,e),i}}const fe=(e,t)=>{switch(e[0]){case"Q":{const r=t||U;return[U.prefix,r.decode(`${U.prefix}${e}`)]}case U.prefix:{const r=t||U;return[U.prefix,r.decode(e)]}case L.prefix:{const r=t||L;return[L.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},de=(e,t,r)=>{const{prefix:n}=r;if(n!==U.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},pe=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},ye=112,ge=18,me=(e,t,r)=>{const n=ie(e),i=n+ie(t),s=new Uint8Array(i+r.byteLength);return ne(e,s,0),ne(t,s,n),s.set(r,i),s},be=Symbol.for("@ipld/js-cid/CID"),we=({name:e,code:t,encode:r})=>new ve(e,t,r);class ve{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?se(this.code,t):t.then((e=>se(this.code,e)))}throw Error("Unknown type, must be binary type")}}const _e=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ee=we({name:"sha2-256",code:18,encode:_e("SHA-256")}),ke=(we({name:"sha2-512",code:19,encode:_e("SHA-512")}),async(e,t,r)=>{null==r.codec&&(r.codec=d);const n=await Ee.digest(e),i=le.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,r),i});function xe(e){return async function*(t,r){let i=0n;for await(let s of t.content)yield async()=>{let o;const a={codec:d,cidVersion:e.cidVersion,onProgress:e.onProgress};e.rawLeaves?(a.codec=n,a.cidVersion=1):(o=new w({type:e.leafType,data:s}),s=d.encode({Data:o.marshal(),Links:[]}));const c=await ke(s,r,a);return i+=BigInt(s.byteLength),e.onProgress?.(new I.V("unixfs:importer:progress:file:write",{bytesWritten:i,cid:c,path:t.path})),{cid:c,unixfs:o,size:BigInt(s.length),block:s}}}}const Se=async(e,t,r)=>{const n=new w({type:"directory",mtime:e.mtime,mode:e.mode}),i=(0,d.encode)((0,d.prepare)({Data:n.marshal()}));return{cid:await ke(i,t,r),path:e.path,unixfs:n,size:BigInt(i.length),originalPath:e.originalPath,block:i}};function Ae(e){return!0===e.single}const Ie=async(e,t,r)=>r.layout(async function*(e,t,r){let n,i=-1;for await(const s of a(r.bufferImporter(e,t),r.blockWriteConcurrency))i++,0!==i?(1===i&&null!=n&&(yield{...n,block:void 0,single:void 0},n=void 0),yield{...s,block:void 0}):n={...s,single:!0};null!=n&&(yield n)}(e,t,r),((e,t,r)=>async function(n){if(1===n.length&&Ae(n[0])&&r.reduceSingleLeafToSelf){const i=n[0];let s=i.block;return!Ae(i)||void 0===e.mtime&&void 0===e.mode||(i.unixfs=new w({type:"file",mtime:e.mtime,mode:e.mode,data:i.block}),s={Data:i.unixfs.marshal(),Links:[]},i.block=(0,d.encode)((0,d.prepare)(s)),i.cid=await ke(i.block,t,{...r,cidVersion:r.cidVersion}),i.size=BigInt(i.block.length)),r.onProgress?.(new I.V("unixfs:importer:progress:file:layout",{cid:i.cid,path:i.originalPath})),{cid:i.cid,path:e.path,unixfs:i.unixfs,size:i.size,originalPath:i.originalPath}}const i=new w({type:"file",mtime:e.mtime,mode:e.mode}),s=n.filter((e=>e.cid.code===x&&e.size>0||null!=e.unixfs&&null==e.unixfs.data&&e.unixfs.fileSize()>0n||Boolean(e.unixfs?.data?.length))).map((e=>e.cid.code===x?(i.addBlockSize(e.size),{Name:"",Tsize:Number(e.size),Hash:e.cid}):(null==e.unixfs||null==e.unixfs.data?i.addBlockSize(e.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(e.unixfs.data.length)),{Name:"",Tsize:Number(e.size),Hash:e.cid}))),o={Data:i.marshal(),Links:s},a=(0,d.encode)((0,d.prepare)(o)),c=await ke(a,t,r);return r.onProgress?.(new I.V("unixfs:importer:progress:file:layout",{cid:c,path:e.originalPath})),{cid:c,path:e.path,unixfs:i,size:BigInt(a.length+o.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),originalPath:e.originalPath,block:a}})(e,t,r));function Ce(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(t=e,Symbol.iterator in t)return async function*(){yield*e}();if(function(e){return Symbol.asyncIterator in e}(e))return e}catch{throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}var t;throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function Pe(e){return null!=e.content}var Te=r(77408);const De=()=>async function*(e){for await(const t of e){if(void 0===t.length)throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"==typeof t||t instanceof String)yield(0,Te.m)(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}},Re=174;function Be(e){const t=e?.maxChildrenPerNode??Re;return async function e(r,n){const i=[];for await(const e of o(r,t))i.push(await n(e));return i.length>1?e(i,n):i[0]}}class Me{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}const Oe=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Ne=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class Le extends Me{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(void 0!==this.nodeSize)return this.nodeSize;this.nodeSize=0;for(const[e,t]of this._children.entries())null!=t.size&&null!=t.cid&&(this.nodeSize+=e.length+(1===this.options.cidVersion?Ne.bytes.byteLength:Oe.bytes.byteLength));return this.nodeSize}async*flush(e){const t=[];for(const[r,n]of this._children.entries()){let i=n;if(n instanceof Me)for await(const t of n.flush(e))i=t,yield t;null!=i.size&&null!=i.cid&&t.push({Name:r,Tsize:Number(i.size),Hash:i.cid})}const r=new w({type:"directory",mtime:this.mtime,mode:this.mode}),n={Data:r.marshal(),Links:t},i=(0,d.encode)((0,d.prepare)(n)),s=await ke(i,e,this.options),o=i.length+n.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=s,this.size=o,yield{cid:s,unixfs:r,path:this.path,size:BigInt(o)}}}const Ue=new Uint8Array(0),je=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):Ue};var ze=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=$e;)r[n++]=255&t|Fe,t/=128;for(;t&Ke;)r[n++]=255&t|Fe,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Fe=128,Ke=-128,$e=Math.pow(2,31);var Ve=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&qe)<<s:(n&qe)*Math.pow(2,s),s+=7}while(n>=We);return e.bytes=o-r,i},We=128,qe=127;var He=Math.pow(2,7),Ge=Math.pow(2,14),Je=Math.pow(2,21),Ye=Math.pow(2,28),Ze=Math.pow(2,35),Xe=Math.pow(2,42),Qe=Math.pow(2,49),et=Math.pow(2,56),tt=Math.pow(2,63),rt={encode:ze,decode:Ve,encodingLength:function(e){return e<He?1:e<Ge?2:e<Je?3:e<Ye?4:e<Ze?5:e<Xe?6:e<Qe?7:e<et?8:e<tt?9:10}};const nt=(e,t,r=0)=>(rt.encode(e,t,r),t),it=e=>rt.encodingLength(e),st=(e,t)=>{const r=t.byteLength,n=it(e),i=n+it(r),s=new Uint8Array(i+r);return nt(e,s,0),nt(r,s,n),s.set(t,i),new ot(e,r,t,s)};class ot{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const at=({name:e,code:t,encode:r})=>new ct(e,t,r);class ct{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?st(this.code,t):t.then((e=>st(this.code,e)))}throw Error("Unknown type, must be binary type")}}var ut=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class ht{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class lt{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return dt(this,e)}}class ft{constructor(e){this.decoders=e}or(e){return dt(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const dt=(e,t)=>new ft({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class pt{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new ht(e,t,r),this.decoder=new lt(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const yt=({name:e,prefix:t,encode:r,decode:n})=>new pt(e,t,r,n),gt=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=ut(r,t);return yt({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},mt=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>yt({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)});gt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),mt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),mt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),mt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),new WeakMap;class bt{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return bt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return bt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return bt.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return cid_format(this,e)}toJSON(){return{"/":cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof bt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new bt(e,r,n,i||cid_encodeCID(e,r,n.bytes))}if(!0===t[cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return bt.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new bt(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new bt(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return bt.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return bt.create(1,e,t)}static decode(e){const[t,r]=bt.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=bt.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?bt.createV0(s):bt.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),i=bt.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");var wt=r(40469);at({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const vt=at({name:"murmur3-128",code:34,encode:e=>je(wt.x64.hash128(e))});at({name:"murmur3-x64-64",code:34,encode:e=>je(wt.x64.hash128(e)).subarray(0,8)});var _t=r(96991);async function Et(e){return(await vt.encode(e)).slice(0,8).reverse()}const kt=BigInt(34);var xt=class extends Me{_bucket;constructor(e,t){super(e,t),this._bucket=(0,_t.$)({hashFn:Et,bits:t.shardFanoutBits??8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=At(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of St(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*St(e,t,r,n){const i=e._children,s=(e.tableSize()-1).toString(16).length,o=[];let a=0n;for(let e=0;e<i.length;e++){const r=i.get(e);if(null==r)continue;const c=e.toString(16).toUpperCase().padStart(s,"0");if(r instanceof _t.r){let e;for await(const i of St(r,t,null,n))e=i;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:c,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;if(null==n)throw new Error("Did not flush dir");const i=c+r.key;o.push({Name:i,Tsize:Number(n.size),Hash:n.cid}),a+=n.size}else{const e=r.value;if(null==e.cid)continue;const t=c+r.key,n=e.size;o.push({Name:t,Tsize:Number(n),Hash:e.cid}),a+=BigInt(n??0)}}const c=Uint8Array.from(i.bitField().reverse()),u=new w({type:"hamt-sharded-directory",data:c,fanout:BigInt(e.tableSize()),hashType:kt,mtime:r?.mtime,mode:r?.mode}),h={Data:u.marshal(),Links:o},l=(0,d.encode)((0,d.prepare)(h)),f=await ke(l,t,n),p=BigInt(l.byteLength)+a;yield{cid:f,unixfs:u,size:p}}function At(e,t,r){const n=e._children,i=(e.tableSize()-1).toString(16).length,s=[];for(let e=0;e<n.length;e++){const t=n.get(e);if(null==t)continue;const o=e.toString(16).toUpperCase().padStart(i,"0");if(t instanceof _t.r){const e=At(t,null,r);s.push({Name:o,Tsize:Number(e),Hash:0===r.cidVersion?Oe:Ne})}else if("function"==typeof t.value.flush){const e=t.value.nodeSize();s.push({Name:o+t.key,Tsize:Number(e),Hash:0===r.cidVersion?Oe:Ne})}else{const e=t.value;if(null==e.cid)continue;const r=o+t.key,n=e.size;s.push({Name:r,Tsize:Number(n),Hash:e.cid})}}const o=Uint8Array.from(n.bitField().reverse()),a=new w({type:"hamt-sharded-directory",data:o,fanout:BigInt(e.tableSize()),hashType:kt,mtime:t?.mtime,mode:t?.mode});return(0,d.encode)((0,d.prepare)({Data:a.marshal(),Links:s})).length}async function It(e,t,r,n){let i=t;t instanceof Le&&t.estimateNodeSize()>r&&(i=await async function(e,t){const r=new xt({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(const{key:t,child:n}of e.eachChildSeries())await r.put(t,n);return r}(t,n));const s=i.parent;if(null!=s){if(i!==t){if(null!=e&&(e.parent=i),null==i.parentKey)throw new Error("No parent key found");await s.put(i.parentKey,i)}return It(i,s,r,n)}return i}const Ct=(e="")=>e.split(/(?<!\\)\//).filter(Boolean);async function Pt(e,t,r){const n=Ct(e.path??""),i=n.length-1;let s=t,o="";for(let a=0;a<n.length;a++){const c=n[a];o+=`${""!==o?"/":""}${c}`;const u=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,u)await s.put(c,e),t=await It(null,s,r.shardSplitThresholdBytes,r);else{let e=await s.get(c);null!=e&&e instanceof Me||(e=new Le({root:!1,dir:!0,parent:s,parentKey:c,path:o,dirty:!0,flat:!0,mtime:e?.unixfs?.mtime,mode:e?.unixfs?.mode},r)),await s.put(c,e),s=e}}return t}async function*Tt(e,t){e instanceof Me?yield*e.flush(t):!0===e.unixfs?.isDirectory()&&(yield e)}async function*Dt(e,t,r={}){let n;n=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];const i=r.wrapWithDirectory??!1,s=r.shardSplitThresholdBytes??262144,o=r.shardFanoutBits??8,c=r.cidVersion??1,h=r.rawLeaves??!0,l=r.leafType??"file",f=r.fileImportConcurrency??50,d=r.blockWriteConcurrency??10,p=r.reduceSingleLeafToSelf??!0,y=r.chunker??u(),g=r.chunkValidator??De(),m=r.dagBuilder??function(e){return async function*(t,r){for await(const n of t){let t;if(null!=n.path&&(t=n.path,n.path=n.path.split("/").filter((e=>null!=e&&"."!==e)).join("/")),Pe(n)){const i={path:n.path,mtime:n.mtime,mode:n.mode,content:async function*(){let t=0n;for await(const r of e.chunker(e.chunkValidator(Ce(n.content)))){const i=BigInt(r.byteLength);t+=i,e.onProgress?.(new I.V("unixfs:importer:progress:file:read",{bytesRead:t,chunkSize:i,path:n.path})),yield r}}(),originalPath:t};yield async()=>Ie(i,r,e)}else{if(null==n.path)throw new Error("Import candidate must have content or path or both");{const i={path:n.path,mtime:n.mtime,mode:n.mode,originalPath:t};yield async()=>Se(i,r,e)}}}}}({chunker:y,chunkValidator:g,wrapWithDirectory:i,layout:r.layout??Be(),bufferImporter:r.bufferImporter??xe({cidVersion:c,rawLeaves:h,leafType:l,onProgress:r.onProgress}),blockWriteConcurrency:d,reduceSingleLeafToSelf:p,cidVersion:c,onProgress:r.onProgress}),b=r.treeBuilder??function(e){return async function*(t,r){let n,i=new Le({root:!0,dir:!0,path:"",dirty:!0,flat:!0},e),s=!1;for await(const r of t){if(null==r)continue;const t=`${r.originalPath??""}`.split("/")[0];null!=t&&""!==t&&(null==n?(n=t,s=!0):n!==t&&(s=!1)),i=await Pt(r,i,e),null!=r.unixfs&&r.unixfs.isDirectory()||(yield r)}if(e.wrapWithDirectory||s&&i.childCount()>1)yield*Tt(i,r);else for await(const e of i.eachChildSeries())null!=e&&(yield*Tt(e.child,r))}}({wrapWithDirectory:i,shardSplitThresholdBytes:s,shardFanoutBits:o,cidVersion:c,onProgress:r.onProgress});for await(const e of b(a(m(n,t),f),t))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}async function Rt(e,t,r={}){const n=await s(Dt([e],t,r));if(null==n)throw i(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return n}r(63060);const Bt={cidVersion:1,rawLeaves:!0,layout:Be({maxChildrenPerNode:1024}),chunker:u({chunkSize:1048576})};async function Mt(e,t,r={}){const{cid:n}=await async function(e,t,r={}){return Rt({content:e},t,r)}(e,t,{...Bt,...r});return n}async function Ot(e,t,r={}){const{cid:n}=await async function(e,t,r={}){return Rt({content:e},t,r)}(e,t,{...Bt,...r});return n}async function Nt(e,t,r={}){const{cid:n}=await async function(e,t,r={}){const n=await s(Dt([e],t,r));if(null==n)throw i(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return n}({...e,path:e.path??"-"},t,{...Bt,...r});return n}var Lt=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t;for await(const r of e)t=r;return t})();let t;for(const r of e)t=r;return t},Ut=r(90560);const jt=0;var zt=async(e,t,r,n,s,o,a,c)=>{const u=await a.get(e,c),h=Ut.decode(u);let l=h,f=r;for(;n.length>0;){const s=n[0];if(!(s in l))throw i(new Error(`No property named ${s} found in cbor node ${e}`),"ERR_NO_PROP");{n.shift(),f=`${f}/${s}`;const i=le.asCID(l[s]);if(null!=i)return{entry:{type:"object",name:t,path:r,cid:e,node:u,depth:o,size:BigInt(u.length),content:async function*(){yield h}},next:{cid:i,name:s,path:f,toResolve:n}};l=l[s]}}return{entry:{type:"object",name:t,path:r,cid:e,node:u,depth:o,size:BigInt(u.length),content:async function*(){yield h}}}};var Ft=function(e,t,r,n){const i=BigInt(e.length),s=BigInt(t+i);return r>=s||n<t?new Uint8Array(0):(n>=t&&n<s&&(e=e.subarray(0,Number(n-t))),r>=t&&r<s&&(e=e.subarray(Number(r-t))),e)};var Kt=(e,t=0,r=e)=>{const n=BigInt(e),s=BigInt(t??0);let o=BigInt(r);if(o!==n&&(o=s+o),o>n&&(o=n),s<0n)throw i(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(s>n)throw i(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(o<0n)throw i(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(o>n)throw i(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:s,end:o}};var $t=async(e,t,r,n,s,o,a,c)=>{if(n.length>0)throw i(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const u=oe(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:(h=u.digest,async function*(e={}){const{start:t,end:r}=Kt(h.length,e.offset,e.length),n=Ft(h,0n,t,r);e.onProgress?.(new I.V("unixfs:exporter:progress:identity",{bytesRead:BigInt(n.byteLength),totalBytes:r-t,fileSize:BigInt(h.byteLength)})),yield n}),depth:o,size:BigInt(u.digest.length),node:u.digest}};var h};var Vt=async(e,t,r,n,s,o,a,c)=>{if(n.length>0)throw i(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const u=await a.get(e,c);return{entry:{type:"raw",name:t,path:r,cid:e,content:(h=u,async function*(e={}){const{start:t,end:r}=Kt(h.length,e.offset,e.length),n=Ft(h,0n,t,r);e.onProgress?.(new I.V("unixfs:exporter:progress:raw",{bytesRead:BigInt(n.byteLength),totalBytes:r-t,fileSize:BigInt(h.byteLength)})),yield n}),depth:o,size:BigInt(u.length),node:u}};var h};const Wt=new Uint8Array(0),qt=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):Wt};var Ht=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Yt;)r[n++]=255&t|Gt,t/=128;for(;t&Jt;)r[n++]=255&t|Gt,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Gt=128,Jt=-128,Yt=Math.pow(2,31);var Zt=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Qt)<<s:(n&Qt)*Math.pow(2,s),s+=7}while(n>=Xt);return e.bytes=o-r,i},Xt=128,Qt=127;var er=Math.pow(2,7),tr=Math.pow(2,14),rr=Math.pow(2,21),nr=Math.pow(2,28),ir=Math.pow(2,35),sr=Math.pow(2,42),or=Math.pow(2,49),ar=Math.pow(2,56),cr=Math.pow(2,63),ur={encode:Ht,decode:Zt,encodingLength:function(e){return e<er?1:e<tr?2:e<rr?3:e<nr?4:e<ir?5:e<sr?6:e<or?7:e<ar?8:e<cr?9:10}};const hr=(e,t,r=0)=>(ur.encode(e,t,r),t),lr=e=>ur.encodingLength(e),fr=(e,t)=>{const r=t.byteLength,n=lr(e),i=n+lr(r),s=new Uint8Array(i+r);return hr(e,s,0),hr(r,s,n),s.set(t,i),new dr(e,r,t,s)};class dr{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const pr=({name:e,code:t,encode:r})=>new yr(e,t,r);class yr{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?fr(this.code,t):t.then((e=>fr(this.code,e)))}throw Error("Unknown type, must be binary type")}}var gr=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class mr{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class br{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return vr(this,e)}}class wr{constructor(e){this.decoders=e}or(e){return vr(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const vr=(e,t)=>new wr({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class _r{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new mr(e,t,r),this.decoder=new br(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Er=({name:e,prefix:t,encode:r,decode:n})=>new _r(e,t,r,n),kr=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=gr(r,t);return Er({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},xr=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Er({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)});kr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),xr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),xr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),new WeakMap;class Sr{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Sr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return Sr.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Sr.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return src_cid_format(this,e)}toJSON(){return{"/":src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Sr)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Sr(e,r,n,i||src_cid_encodeCID(e,r,n.bytes))}if(!0===t[src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return Sr.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new Sr(e,t,r,r.bytes);case 1:{const n=src_cid_encodeCID(e,t,r.bytes);return new Sr(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Sr.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return Sr.create(1,e,t)}static decode(e){const[t,r]=Sr.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Sr.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?Sr.createV0(s):Sr.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=src_cid_parseCIDtoBytes(e,t),i=Sr.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");pr({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const Ar=pr({name:"murmur3-128",code:34,encode:e=>qt(wt.x64.hash128(e))}),Ir=(pr({name:"murmur3-x64-64",code:34,encode:e=>qt(wt.x64.hash128(e)).subarray(0,8)}),async function(e){return(await Ar.encode(e)).slice(0,8).reverse()}),Cr=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),Pr=async(e,t,r,n,s)=>{if(null==n){if(null==e.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let t;try{t=w.unmarshal(e.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if("hamt-sharded-directory"!==t.type)throw i(new Error("not a HAMT"),"ERR_NOT_UNIXFS");if(null==t.fanout)throw i(new Error("missing fanout"),"ERR_NOT_UNIXFS");const r=(0,_t.$)({hashFn:Ir,bits:Math.log2(Number(t.fanout))});n={rootBucket:r,hamtDepth:1,lastBucket:r}}const o=(n.lastBucket.tableSize()-1).toString(16).length;await(async(e,t,r)=>{const n=(t.tableSize()-1).toString(16).length;await Promise.all(e.map((async e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(e.Name.length!==n)await r.put(e.Name.substring(2),!0);else{const n=parseInt(e.Name,16);t._putObjectAt(n,new _t.r({hash:r._options.hash,bits:r._options.bits},t,n))}})))})(e.Links,n.lastBucket,n.rootBucket);const a=await n.rootBucket._findNewBucketAndPos(t);let c=Cr(a.pos,o);const u=(e=>{let t=e.bucket;const r=[];for(;null!=t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()})(a);u.length>n.hamtDepth&&(n.lastBucket=u[n.hamtDepth],c=Cr(n.lastBucket._posAtParent,o));const h=e.Links.find((e=>{if(null==e.Name)return!1;const r=e.Name.substring(0,o),n=e.Name.substring(o);return r===c&&(""===n||n===t)}));if(null==h)return;if(null!=h.Name&&h.Name.substring(o)===t)return h.Hash;n.hamtDepth++;const l=await r.get(h.Hash,s);return e=(0,d.decode)(l),Pr(e,t,r,n,s)};var Tr=Pr,Dr=r(75671);var Rr=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,Dr.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){await s&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===s&&(yield n);for(const e of r)o(e)&&(yield e)}()};var Br=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)yield t(r)}();const r=(0,Dr.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){yield await s;for await(const e of r)yield t(e)}();const o=t;return function*(){yield s;for(const e of r)yield o(e)}()},Mr=r(69849),Or=r(32629);var Nr=(e,t,r,n,i,s,o)=>async function*(r={}){const a=r.offset??0,c=r.length??t.Links.length,u=t.Links.slice(a,c);r.onProgress?.(new I.V("unixfs:exporter:walk:directory",{cid:e})),yield*(0,Or.z)(u,(e=>Br(e,(e=>async()=>{const t=e.Name??"",a=`${n}/${t}`;return(await i(e.Hash,t,a,[],s+1,o,r)).entry}))),(e=>(0,Mr.Z)(e,{ordered:!0})),(e=>Rr(e,(e=>null!=e))))},Lr=r(37430),Ur=r(28364);async function jr(e,t,r,n,s,o,a){if(t instanceof Uint8Array){const e=Ft(t,n,s,o);return void r.push(e)}if(null==t.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=w.unmarshal(t.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if(null!=c.data){const e=c.data,t=Ft(e,n,s,o);r.push(t),n+=BigInt(t.byteLength)}const u=[];if(t.Links.length!==c.blockSizes.length)throw i(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let e=0;e<t.Links.length;e++){const r=t.Links[e],i=n,a=i+c.blockSizes[e];if((s>=i&&s<a||o>=i&&o<=a||s<i&&o>a)&&u.push({link:r,blockStart:n}),(n=a)>o)break}await(0,Or.z)(u,(t=>Br(t,(t=>async()=>{const r=await e.get(t.link.Hash,a);return{...t,block:r}}))),(e=>(0,Mr.Z)(e,{ordered:!0})),(async t=>{for await(const{link:n,block:c,blockStart:u}of t){let t;switch(n.Hash.code){case d.code:t=d.decode(c);break;case x:t=c;break;default:return void r.end(i(new Error(`Unsupported codec: ${n.Hash.code}`),"ERR_NOT_UNIXFS"))}const h=new Ur.Z({concurrency:1});h.on("error",(e=>{r.end(e)})),h.add((async()=>{a.onProgress?.(new I.V("unixfs:exporter:walk:file",{cid:n.Hash})),await jr(e,t,r,u,s,o,a)})),await h.onIdle()}})),n>=o&&r.end()}var zr=(e,t,r,n,s,o,a)=>async function*(n={}){const s=r.fileSize();if(void 0===s)throw new Error("File was a directory");const{start:o,end:c}=Kt(s,n.offset,n.length);if(0n===c)return;let u=0n;const h=c-o,l=(0,Lr.d)();n.onProgress?.(new I.V("unixfs:exporter:walk:file",{cid:e})),jr(a,t,l,0n,o,c,n).catch((e=>{l.end(e)}));for await(const e of l)if(null!=e){if(u+=BigInt(e.byteLength),u>h)throw l.end(),i(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");u===h&&l.end(),n.onProgress?.(new I.V("unixfs:exporter:progress:unixfs:file",{bytesRead:u,totalBytes:h,fileSize:s})),yield e}if(u<h)throw i(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")};async function*Fr(e,t,r,n,s,o){const a=e.Links;if(null==e.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=w.unmarshal(e.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if(null==c.fanout)throw i(new Error("missing fanout"),"ERR_NOT_UNIXFS");const u=(c.fanout-1n).toString(16).length,h=(0,Or.z)(a,(i=>Br(i,(i=>async()=>{const a=null!=i.Name?i.Name.substring(u):null;if(null!=a&&""!==a){const e=await r(i.Hash,a,`${t}/${a}`,[],n+1,s,o);return{entries:null==e.entry?[]:[e.entry]}}{const a=await s.get(i.Hash,o);return e=(0,d.decode)(a),o.onProgress?.(new I.V("unixfs:exporter:walk:hamt-sharded-directory",{cid:i.Hash})),{entries:Fr(e,t,r,n,s,o)}}}))),(e=>(0,Mr.Z)(e,{ordered:!0})));for await(const{entries:e}of h)yield*e}var Kr=(e,t,r,n,i,s,o)=>function(r={}){return r.onProgress?.(new I.V("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),Fr(t,n,i,s,o,r)};const $r={raw:zr,file:zr,directory:Nr,"hamt-sharded-directory":Kr,metadata:(e,t,r,n,i,s,o)=>()=>[],symlink:(e,t,r,n,i,s,o)=>()=>[]};var Vr=async(e,t,r,n,s,o,a,c)=>{const u=await a.get(e,c),h=(0,d.decode)(u);let l,f;if(null==t&&(t=e.toString()),null==h.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=w.unmarshal(h.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if(null==r&&(r=t),n.length>0){let e;if(e="hamt-sharded-directory"===l?.type?await Tr(h,n[0],a):((e,t)=>{const r=e.Links.find((e=>e.Name===t));return r?.Hash})(h,n[0]),null==e)throw i(new Error("file does not exist"),"ERR_NOT_FOUND");const t=n.shift();f={cid:e,toResolve:n,name:t??"",path:`${r}/${t}`}}const p=$r[l.type](e,h,l,r,s,o,a);if(null==p)throw i(new Error("could not find content exporter"),"ERR_NOT_FOUND");return l.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:p,unixfs:l,depth:o,node:h,size:l.fileSize()},next:f}:{entry:{type:"file",name:t,path:r,cid:e,content:p,unixfs:l,depth:o,node:h,size:l.fileSize()},next:f}};const Wr={[d.code]:Vr,[x]:Vt,[Ut.code]:zt,[jt]:$t},qr=async(e,t,r,n,s,o,a)=>{const c=Wr[e.code];if(null==c)throw i(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return c(e,t,r,n,qr,s,o,a)};var Hr=qr;const Gr=e=>{if(e instanceof Uint8Array)return{cid:le.decode(e),toResolve:[]};const t=le.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=((e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean))(e);return{cid:le.parse(t[0]),toResolve:t.slice(1)}}throw i(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function Jr(e,t,r={}){const n=await Lt(async function*(e,t,r={}){let{cid:n,toResolve:s}=Gr(e),o=n.toString(),a=o;const c=s.length;for(;;){const u=await Hr(n,o,a,s,c,t,r);if(null==u.entry&&null==u.next)throw i(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(null!=u.entry&&(yield u.entry),null==u.next)return;s=u.next.toResolve,n=u.next.cid,o=u.next.name,a=u.next.path}}(e,t,r));if(null==n)throw i(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}async function*Yr(e,t,r={}){const n=await Jr(e,t,r);if(null!=n&&(yield n,"directory"===n.type))for await(const e of async function*e(t,r){for await(const n of t.content(r))yield n,n instanceof Uint8Array||"directory"===n.type&&(yield*e(n,r))}(n,r))yield e}var Zr=r(79221);class Xr extends Error{name;code;constructor(e,t,r){super(e),this.name=t,this.code=r}}class Qr extends Xr{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}}class en extends Xr{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PBNODE")}}class tn extends Xr{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class rn extends Xr{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}}class nn extends Xr{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}class sn extends Xr{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}}class on extends Xr{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}}class an extends Xr{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}}class cn extends Xr{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}}var un=r(11227);const hn=N({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});N({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),N({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),N({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function ln(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return un.enabled(`${e}:trace`)&&null!=un.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=un(`${e}:trace`)),Object.assign(un(e),{error:un(`${e}:error`),trace:t})}un.formatters.b=e=>null==e?"undefined":U.baseEncode(e),un.formatters.t=e=>null==e?"undefined":L.baseEncode(e),un.formatters.m=e=>null==e?"undefined":hn.baseEncode(e),un.formatters.p=e=>null==e?"undefined":e.toString(),un.formatters.c=e=>null==e?"undefined":e.toString(),un.formatters.k=e=>null==e?"undefined":e.toString(),un.formatters.a=e=>null==e?"undefined":e.toString();var fn=r(20544),dn=r(41690);function pn(e){return function(t){return t instanceof yn?t:new yn(t,e)}}class yn{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?(0,dn.z)([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new bn(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}const gn=[255,254,252,248,240,224,192,128],mn=[1,3,7,15,31,63,127,255];class bn{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t);r=(r<<i)+wn(e,n-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function wn(e,t,r){const n=function(e,t){return gn[e]&mn[Math.min(t+e-1,7)]}(t,r);return(e&n)>>>t}we({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const vn=we({name:"murmur3-128",code:34,encode:e=>_(wt.x64.hash128(e))}),_n=(we({name:"murmur3-x64-64",code:34,encode:e=>_(wt.x64.hash128(e)).subarray(0,8)}),BigInt(vn.code));async function En(e){return(await vn.encode(e)).subarray(0,8).reverse()}const kn=async(e,t,r)=>{null==r.codec&&(r.codec=d);const n=await Ee.digest(e),i=le.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,{...r,signal:r.signal}),i};class xn{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}class Sn extends xn{_bucket;constructor(e,t){super(e,t),this._bucket=(0,_t.$)({hashFn:En,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=In(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of An(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*An(e,t,r,n){const i=e._children,s=[];let o=0n;for(let e=0;e<i.length;e++){const r=i.get(e);if(null==r)continue;const a=e.toString(16).toUpperCase().padStart(2,"0");if(r instanceof _t.r){let e;for await(const i of An(r,t,null,n))e=i;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:a,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;if(null==n)throw new Error("Did not flush dir");const i=a+r.key;s.push({Name:i,Tsize:Number(n.size),Hash:n.cid}),o+=n.size}else{const e=r.value;if(null==e.cid)continue;const t=a+r.key,n=e.size;s.push({Name:t,Tsize:Number(n),Hash:e.cid}),o+=BigInt(n??0)}}const a=Uint8Array.from(i.bitField().reverse()),c=new w({type:"hamt-sharded-directory",data:a,fanout:BigInt(e.tableSize()),hashType:_n,mtime:r?.mtime,mode:r?.mode}),u={Data:c.marshal(),Links:s},h=(0,d.encode)((0,d.prepare)(u)),l=await kn(h,t,n),f=BigInt(h.byteLength)+o;yield{cid:l,unixfs:c,size:f}}function In(e,t,r){const n=e._children,i=[];for(let e=0;e<n.length;e++){const t=n.get(e);if(null==t)continue;const s=e.toString(16).toUpperCase().padStart(2,"0");if(t instanceof _t.r){const e=In(t,null,r);i.push({Name:s,Tsize:Number(e),Hash:0===r.cidVersion?Cn:Pn})}else if("function"==typeof t.value.flush){const e=t.value.nodeSize();i.push({Name:s+t.key,Tsize:Number(e),Hash:0===r.cidVersion?Cn:Pn})}else{const e=t.value;if(null==e.cid)continue;const r=s+t.key,n=e.size;i.push({Name:r,Tsize:Number(n),Hash:e.cid})}}const s=Uint8Array.from(n.bitField().reverse()),o=new w({type:"hamt-sharded-directory",data:s,fanout:BigInt(e.tableSize()),hashType:_n,mtime:t?.mtime,mode:t?.mode});return(0,d.encode)((0,d.prepare)({Data:o.marshal(),Links:i})).length}const Cn=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Pn=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),Tn=ln("helia:unixfs:commands:utils:hamt-utils"),Dn=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Rn=async(e,t,r)=>{const n=w.unmarshal(e[0].node.Data??new Uint8Array(0)),i=BigInt(Math.pow(2,8));let s,o;e.reverse();for(let a=0;a<e.length;a++){const c=a===e.length-1,u=e[a],h=Uint8Array.from(u.children.bitField().reverse()),l=new w({type:"hamt-sharded-directory",data:h,fanout:i,hashType:_n});c&&(l.mtime=n.mtime,l.mode=n.mode),o={Data:l.marshal(),Links:u.node.Links};const f=d.encode(d.prepare(o));if(s=await kn(f,t,r),!c){const t=e[a+1];if(null==t)throw new Error("Was not operating on shard root but also had no parent?");Tn("updating link in parent sub-shard with prefix %s",t.prefix),t.node.Links=t.node.Links.filter((e=>e.Name!==t.prefix)),t.node.Links.push({Name:t.prefix,Hash:s,Tsize:u.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),f.byteLength)})}}if(null==s||null==o)throw new Error("Noting persisted");return{cid:s,node:o}},Bn=async(e,t,r,n)=>{const i=pn(En)((0,Te.m)(t)),s=[];for(;;){const o=await r.get(e,n),a=d.decode(o),c=new fn,u=await i.take(8),h=Dn(u);let l;s.push({prefix:h,children:c,node:a});for(const e of a.Links){const t=e.Name??"";if(t.length<2)throw new Error("Invalid HAMT - link name was too short");const r=parseInt(t.substring(0,2),16);c.set(r,!0),t.startsWith(h)&&(l=e)}if(null==l){Tn("no link found with prefix %s for %s",h,t);break}const f=l.Name??"";if(f.length<2)throw new Error("Invalid HAMT - link name was too short");if(2!==f.length)break;e=l.Hash,Tn("descend into sub-shard with prefix %s",f)}return{path:s,hash:i}};async function Mn(e,t,r,n){if(null==e.Data)throw new Error("DagPB node had no data");const i=w.unmarshal(e.Data);let s;if("directory"===i.type)s=function(e){let t=0;for(const r of e.Links)t+=(r.Name??"").length,t+=1===r.Hash.version?Pn.bytes.byteLength:Cn.bytes.byteLength;return t}(e);else{if("hamt-sharded-directory"!==i.type)throw new Error("Can only estimate the size of directories or shards");s=await On(e,0,r,t,n)}return s>r}async function On(e,t,r,n,i){if(t>r)return r;if(null==e.Data)return t;if(!w.unmarshal(e.Data).isDirectory())return t;for(const s of e.Links){let e=s.Name??"";if(e=e.substring(2),t+=e.length,t+=s.Hash.bytes.byteLength,s.Hash.code===d.code){const e=await n.get(s.Hash,i),o=d.decode(e);t+=await On(o,t,r,n,i)}}return t}const Nn=ln("helia:unixfs:components:utils:add-link");async function Ln(e,t,r,n){if(null==e.node.Data)throw new cn("Invalid parent passed to addLink");if("hamt-sharded-directory"===w.unmarshal(e.node.Data).type)return Nn("adding link to sharded directory"),zn(e,t,r,n);Nn(`adding ${t.Name} (${t.Hash}) to regular directory`);const i=await jn(e,t,r,n);if(await Mn(i.node,r,n.shardSplitThresholdBytes,n)){Nn("converting directory to sharded directory");const e=await Un(i,r);i.cid=e.cid,i.node=d.decode(await r.get(e.cid,n))}return i}const Un=async(e,t)=>{if(null==e.node.Data)throw new cn("Invalid parent passed to convertToShardedDirectory");const r=w.unmarshal(e.node.Data),n=await(async(e,t,r)=>{const n=new Sn({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:r.mtime,mode:r.mode},r);for(let e=0;e<t.length;e++)await n._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});const i=await Lt(n.flush(e));if(null==i)throw new Error("Flushing shard yielded no result");return i})(t,e.node.Links.map((e=>({name:e.Name??"",size:BigInt(e.Tsize??0),cid:e.Hash}))),{mode:r.mode,mtime:r.mtime,cidVersion:e.cid.version});return Nn(`converted directory to sharded directory ${n.cid}`),n},jn=async(e,t,r,n)=>{const i=e.node.Links.filter((e=>{const r=e.Name===t.Name;if(r&&!n.allowOverwriting)throw new rn;return!r}));if(i.push(t),null==e.node.Data)throw new en("Parent node with no data passed to addToDirectory");const s=w.unmarshal(e.node.Data);let o;if(null!=s.mtime){const e=Date.now(),t=Math.floor(e/1e3);s.mtime={secs:BigInt(t),nsecs:1e3*(e-1e3*t)},o=s.marshal()}else o=e.node.Data;e.node=d.prepare({Data:o,Links:i});const a=d.encode(e.node),c=await Ee.digest(a),u=le.create(e.cid.version,d.code,c);return await r.put(u,a),{node:e.node,cid:u}},zn=async(e,t,r,n)=>{const{path:i,hash:s}=await Bn(e.cid,t.Name,r,n),o=i[i.length-1];if(null==o)throw new Error("Invalid HAMT, could not generate path");const a=o.prefix,c=parseInt(a,16);Nn("next prefix for %s is %s",t.Name,a);const u=`${a}${t.Name}`,h=o.node.Links.find((e=>(e.Name??"").startsWith(a)));if(null!=h)if(Nn("link %s was present in shard",u),h.Name===u){if(!n.allowOverwriting)throw new rn;Nn("overwriting %s in subshard",t.Name),o.node.Links=o.node.Links.filter((e=>e.Name!==u)),o.node.Links.push({Name:u,Hash:t.Hash,Tsize:t.Tsize})}else{if(2===h.Name?.length)throw new Error("Existing link was subshard?!");{Nn("prefix %s already exists, creating new subshard",a);const e=o.node.Links.findIndex((e=>e.Name?.startsWith(a))),r=o.node.Links.splice(e,1)[0],n=(r.Name??"").substring(2),c=pn(En)((0,Te.m)(n));for(let e=0;e<i.length;e++)await c.take(8);for(;;){const e=await c.take(8),o=Dn(e);r.Name=`${o}${n}`;const u=await s.take(8),h=Dn(u);if(o===h){const e=new fn;e.set(u,!0),i.push({prefix:h,children:e,node:{Links:[]}});continue}const l=new fn;l.set(u,!0),l.set(e,!0),i.push({prefix:a,children:l,node:{Links:[r,{Name:`${h}${t.Name}`,Hash:t.Hash,Tsize:t.Tsize}]}});break}}}else Nn("link %s was not present in sub-shard",u),t.Name=u,o.node.Links.push(t),o.children.set(c,!0),Nn("adding %s to existing sub-shard",u);return Rn(i,r,n)};async function Fn(e,t,r={}){const n=await Jr(e,t,r);if("directory"!==n.type)throw new an(`${e.toString()} was not a UnixFS directory`);return{cid:e,node:n.node}}async function Kn(e,t,r,n){const i=await Jr(e,r,n);if("directory"!==i.type&&"file"!==i.type&&"raw"!==i.type)throw new Qr(`${e.toString()} was not a UnixFS node`);return{Name:t,Tsize:i.node instanceof Uint8Array?i.node.byteLength:$n(i.node),Hash:e}}function $n(e){const t=e.Links.reduce(((e,t)=>e+(t.Tsize??0)),0);return d.encode(e).byteLength+t}const Vn=ln("helia:unixfs:components:utils:resolve");async function Wn(e,t,r,n){if(null==t||""===t)return{cid:e};Vn('resolve "%s" under %c',t,e);const i=t.split("/").filter(Boolean),s=[{name:"",cid:e,size:0n}];for(let t=0;t<i.length;t++){const o=i[t],a=await Jr(e,r,n);if(Vn('resolving "%s"',o,a),"file"===a.type){if(t<i.length-1)throw new cn("Path was invalid");e=a.cid}else{if("directory"!==a.type)throw new cn("Could not resolve path");{let t;for await(const e of a.content())if(e.name===o){t=e.cid;break}if(null==t)throw new nn("Could not find path in directory");e=t,s.push({name:o,cid:e,size:a.size})}}}return Vn("resolved %s to %c",t,e),{cid:e,path:t,segments:s}}async function qn(e,t,r,n){if(null==t.segments||0===t.segments.length)return e;let i=t.segments.pop();if(null==i)throw new Error("Insufficient segments");i.cid=e,t.segments.reverse();for(const s of t.segments){const[t,o]=await Promise.all([Fn(s.cid,r,n),Kn(i.cid,i.name,r,n)]);e=(await Ln(t,o,r,{...n,allowOverwriting:!0,cidVersion:e.version})).cid,s.cid=e,i=s}return e}const Hn=Zr.Z.bind({ignoreUndefined:!0}),Gn={};const Jn=262144,Yn=Zr.Z.bind({ignoreUndefined:!0}),Zn=ln("helia:unixfs:chmod"),Xn={recursive:!1,shardSplitThresholdBytes:Jn};const Qn=Zr.Z.bind({ignoreUndefined:!0}),ei=ln("helia:unixfs:cp"),ti={force:!1,shardSplitThresholdBytes:Jn};const ri=Zr.Z.bind({ignoreUndefined:!0}),ni={};const ii=Zr.Z.bind({ignoreUndefined:!0}),si=ln("helia:unixfs:mkdir"),oi={cidVersion:1,force:!1,shardSplitThresholdBytes:Jn};const ai=ln("helia:unixfs:utils:remove-link");const ci=async(e,t,r,n)=>{e.node.Links=e.node.Links.filter((e=>e.Name!==t));const i=d.encode(e.node),s=await kn(i,r,{...n,cidVersion:e.cid.version});return ai(`Updated regular directory ${s}`),{node:e.node,cid:s}},ui=async(e,t,r,n)=>{const{path:i}=await Bn(e.cid,t,r,n),s=i[i.length-1];if(null==s)throw new Error("Invalid HAMT, could not generate path");const o=s.node.Links.filter((e=>(e.Name??"").substring(2)===t)).map((e=>e.Name)).pop();if(null==o)throw new Error("File not found");const a=o.substring(0,2),c=parseInt(a,16);if(s.node.Links=s.node.Links.filter((e=>e.Name!==o)),s.children.unset(c),1===s.node.Links.length)for(;1!==i.length;){const e=i[i.length-1];if(null==e||e.node.Links.length>1)break;i.pop();const t=i[i.length-1];if(null==t)break;const r=e.node.Links[0];t.node.Links=t.node.Links.filter((e=>!(e.Name??"").startsWith(t.prefix))),t.node.Links.push({Hash:r.Hash,Name:`${t.prefix}${(r.Name??"").substring(2)}`,Tsize:r.Tsize})}return Rn(i,r,n)},hi=async(e,t,r)=>{if(null==e.node.Data)throw new cn("Invalid parent passed to convertToFlatDirectory");const n={Links:[]},i=await Jr(e.cid,t);if("directory"!==i.type)throw new Error("Unexpected node type");for await(const e of i.content()){let t=0;t=e.node instanceof Uint8Array?e.node.byteLength:d.encode(e.node).length,n.Links.push({Hash:e.cid,Name:e.name,Tsize:t})}const s=w.unmarshal(e.node.Data);n.Data=new w({type:"directory",mode:s.mode,mtime:s.mtime}).marshal();const o=d.encode(d.prepare(n));return{cid:await kn(o,t,{codec:d,cidVersion:e.cid.version,signal:r.signal}),node:n}},li=Zr.Z.bind({ignoreUndefined:!0}),fi=ln("helia:unixfs:rm"),di={shardSplitThresholdBytes:Jn};async function pi(e,t,r,n={}){const i=li(di,n);if(t.includes("/"))throw new cn("Name must not have slashes");const s=await Fn(e,r,i);fi("Removing %s from %c",t,e);const o=await async function(e,t,r,n){if(null==e.node.Data)throw new en("Parent node had no data");if("hamt-sharded-directory"===w.unmarshal(e.node.Data).type){ai(`removing ${t} from sharded directory`);const i=await ui(e,t,r,n);return await Mn(i.node,r,n.shardSplitThresholdBytes,n)?i:(ai("converting shard to flat directory %c",e.cid),hi(i,r,n))}return ai(`removing link ${t} regular directory`),ci(e,t,r,n)}(s,t,r,{...i,cidVersion:e.version});return o.cid}const yi=Zr.Z.bind({ignoreUndefined:!0}),gi=ln("helia:unixfs:stat"),mi={};async function bi(e,t,r={}){const n=yi(mi,r),i=await Wn(e,r.path,t,n);gi("stat %c",i.cid);const s=await Jr(i.cid,t,n);if("file"!==s.type&&"directory"!==s.type&&"raw"!==s.type)throw new Qr;let o,a,c=0n,u=0n,h=0n,l=0n,f=0;const d=s.type;let p;if("raw"===s.type&&(c=BigInt(s.node.byteLength),u=BigInt(s.node.byteLength),h=BigInt(s.node.byteLength),l=BigInt(s.node.byteLength),f=1),"directory"===s.type&&(c=0n,u=BigInt(s.unixfs.marshal().byteLength),h=0n,l=u,f=1,o=s.unixfs.mode,a=s.unixfs.mtime,p=s.unixfs),"file"===s.type){const e=await wi(i.cid,t,n);c=s.unixfs.fileSize(),u=BigInt((s.node.Data?.byteLength??0)+s.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),h=BigInt(e.localFileSize),l=BigInt(e.localDagSize),f=e.blocks,o=s.unixfs.mode,a=s.unixfs.mtime,p=s.unixfs}return{cid:i.cid,mode:o,mtime:a,fileSize:c,dagSize:u,localFileSize:h,localDagSize:l,blocks:f,type:d,unixfs:p}}async function wi(e,t,r){const n={localFileSize:0,localDagSize:0,blocks:0};if(await t.has(e,r)){const i=await t.get(e,r);if(n.blocks++,n.localDagSize+=i.byteLength,e.code===x)n.localFileSize+=i.byteLength;else{if(e.code!==d.code)throw new tn(`${e.toString()} was neither DAG_PB nor RAW`);{const s=d.decode(i);if(s.Links.length>0)for(const e of s.Links){const i=await wi(e.Hash,t,r);n.localFileSize+=i.localFileSize,n.localDagSize+=i.localDagSize,n.blocks+=i.blocks}else{if(null==s.Data)throw new en(`PBNode ${e.toString()} had no data`);const t=w.unmarshal(s.Data);if(null==t.data)throw new en(`UnixFS node ${e.toString()} had no data`);n.localFileSize+=t.data.byteLength??0}}}}return n}const vi=Zr.Z.bind({ignoreUndefined:!0}),_i=ln("helia:unixfs:touch"),Ei={recursive:!1,shardSplitThresholdBytes:Jn};r(67064);class ki{components;constructor(e){this.components=e}async*addAll(e,t={}){yield*async function*(e,t,r={}){yield*Dt(e,t,{...Bt,...r})}(e,this.components.blockstore,t)}async addBytes(e,t={}){return Mt(e,this.components.blockstore,t)}async addByteStream(e,t={}){return Ot(e,this.components.blockstore,t)}async addFile(e,t={}){return async function(e,t,r={}){const{cid:n}=await Rt(e,t,{...Bt,...r});return n}(e,this.components.blockstore,t)}async addDirectory(e={},t={}){return Nt(e,this.components.blockstore,t)}async*cat(e,t={}){yield*async function*(e,t,r={}){const n=Hn(Gn,r),i=await Wn(e,n.path,t,n),s=await Jr(i.cid,t,n);if("file"!==s.type&&"raw"!==s.type)throw new on;if(null==s.content)throw new sn;yield*s.content(n)}(e,this.components.blockstore,t)}async chmod(e,t,r={}){return async function(e,t,r,n={}){const i=Yn(Xn,n),s=await Wn(e,i.path,r,n);if(Zn("chmod %c %d",s.cid,t),i.recursive){const o=await(0,Or.z)((async function*(){for await(const e of Yr(s.cid,r,n)){let r,n=[];if("raw"===e.type)r=new w({type:"file",data:e.node});else{if("file"!==e.type&&"directory"!==e.type)throw new Qr;r=e.unixfs,n=e.node.Links}r.mode=t;const i={Data:r.marshal(),Links:n};yield{path:e.path,content:i}}}),(t=>Dt(t,r,{...i,dagBuilder:async function*(t,r){for await(const n of t)yield async function(){const t=n.content,s=d.encode(t),o=await kn(s,r,{...i,cidVersion:e.version});if(null==t.Data)throw new en(`${o} had no data`);const a=w.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:n.path,unixfs:a}}}})),(async e=>Lt(e)));if(null==o)throw new tn(`Could not chmod ${s.cid.toString()}`);return qn(o.cid,s,r,i)}const o=await r.get(s.cid,n);let a,c=[];if(s.cid.code===x)a=new w({type:"file",data:o});else{const e=d.decode(o);if(null==e.Data)throw new en(`${s.cid.toString()} had no data`);c=e.Links,a=w.unmarshal(e.Data)}a.mode=t;const u=d.encode({Data:a.marshal(),Links:c}),h=await Ee.digest(u),l=le.create(s.cid.version,d.code,h);return await r.put(l,u),qn(l,s,r,i)}(e,t,this.components.blockstore,r)}async cp(e,t,r,n={}){return async function(e,t,r,n,i={}){const s=Qn(ti,i);if(r.includes("/"))throw new cn("Name must not have slashes");const[o,a]=await Promise.all([Fn(t,n,s),Kn(e,r,n,s)]);return ei('Adding %c as "%s" to %c',e,r,t),(await Ln(o,a,n,{allowOverwriting:s.force,cidVersion:t.version,...s})).cid}(e,t,r,this.components.blockstore,n)}async*ls(e,t={}){yield*async function*(e,t,r={}){const n=ri(ni,r),i=await Wn(e,n.path,t,n),s=await Jr(i.cid,t);if("file"!==s.type&&"raw"!==s.type){if(null==s.content)throw new sn;if("directory"!==s.type)throw new an;yield*s.content({offset:r.offset,length:r.length})}else yield s}(e,this.components.blockstore,t)}async mkdir(e,t,r={}){return async function(e,t,r,n={}){const i=ii(oi,n);if(t.includes("/"))throw new cn("Path must not have slashes");if("directory"!==(await Jr(e,r,n)).type)throw new an(`${e.toString()} was not a UnixFS directory`);si("creating %s",t);const s={Data:new w({type:"directory",mode:i.mode,mtime:i.mtime}).marshal(),Links:[]},o=d.encode(s),a=await Ee.digest(o),c=le.create(i.cidVersion,d.code,a);await r.put(c,o);const[u,h]=await Promise.all([Fn(e,r,i),Kn(c,t,r,i)]);return si("adding empty dir called %s to %c",t,e),(await Ln(u,h,r,{...i,allowOverwriting:i.force})).cid}(e,t,this.components.blockstore,r)}async rm(e,t,r={}){return pi(e,t,this.components.blockstore,r)}async stat(e,t={}){return bi(e,this.components.blockstore,t)}async touch(e,t={}){return async function(e,t,r={}){const n=vi(Ei,r),i=await Wn(e,n.path,t,n),s=n.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(_i("touch %c %o",i.cid,s),n.recursive){const r=await(0,Or.z)((async function*(){for await(const e of Yr(i.cid,t)){let t,r;if("raw"===e.type)t=new w({data:e.node}),r=[];else{if("file"!==e.type&&"directory"!==e.type)throw new Qr;t=e.unixfs,r=e.node.Links}t.mtime=s;const n={Data:t.marshal(),Links:r};yield{path:e.path,content:n}}}),(r=>Dt(r,t,{...n,dagBuilder:async function*(t,r){for await(const i of t)yield async function(){const t=i.content,s=d.encode(t),o=await kn(s,r,{...n,cidVersion:e.version});if(null==t.Data)throw new en(`${o} had no data`);const a=w.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:i.path,unixfs:a}}}})),(async e=>Lt(e)));if(null==r)throw new tn(`Could not chmod ${i.cid.toString()}`);return qn(r.cid,i,t,n)}const o=await t.get(i.cid,r);let a,c=[];if(i.cid.code===x)a=new w({data:o});else{const e=d.decode(o);if(c=e.Links,null==e.Data)throw new en(`${i.cid.toString()} had no data`);a=w.unmarshal(e.Data)}a.mtime=s;const u=d.encode({Data:a.marshal(),Links:c}),h=await Ee.digest(u),l=le.create(i.cid.version,d.code,h);return await t.put(l,u),qn(l,i,t,n)}(e,this.components.blockstore,t)}}function xi(e){return new ki(e)}},10853:function(e,t,r){"use strict";r.d(t,{YS:function(){return G}});var n=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"}),i=Object.freeze({set:n.Set,for:n.For,in:n.In,is:n.Is,if:n.If,else:n.Else,endif:n.EndIf,elif:n.ElseIf,endfor:n.EndFor,and:n.And,or:n.Or,not:n.Not,"not in":n.NotIn,true:n.BooleanLiteral,false:n.BooleanLiteral}),s=class{constructor(e,t){this.value=e,this.type=t}};function o(e){return/\w/.test(e)}function a(e){return/[0-9]/.test(e)}var c=[["{%",n.OpenStatement],["%}",n.CloseStatement],["{{",n.OpenExpression],["}}",n.CloseExpression],["(",n.OpenParen],[")",n.CloseParen],["{",n.OpenCurlyBracket],["}",n.CloseCurlyBracket],["[",n.OpenSquareBracket],["]",n.CloseSquareBracket],[",",n.Comma],[".",n.Dot],[":",n.Colon],["|",n.Pipe],["<=",n.ComparisonBinaryOperator],[">=",n.ComparisonBinaryOperator],["==",n.ComparisonBinaryOperator],["!=",n.ComparisonBinaryOperator],["<",n.ComparisonBinaryOperator],[">",n.ComparisonBinaryOperator],["+",n.AdditiveBinaryOperator],["-",n.AdditiveBinaryOperator],["*",n.MultiplicativeBinaryOperator],["/",n.MultiplicativeBinaryOperator],["%",n.MultiplicativeBinaryOperator],["=",n.Equals]],u=new Map([["n","\n"],["t","\t"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);var h=class{type="Statement"},l=class extends h{constructor(e){super(),this.body=e}type="Program"},f=class extends h{constructor(e,t,r){super(),this.test=e,this.body=t,this.alternate=r}type="If"},d=class extends h{constructor(e,t,r){super(),this.loopvar=e,this.iterable=t,this.body=r}type="For"},p=class extends h{constructor(e,t){super(),this.assignee=e,this.value=t}type="Set"},y=class extends h{type="Expression"},g=class extends y{constructor(e,t,r){super(),this.object=e,this.property=t,this.computed=r}type="MemberExpression"},m=class extends y{constructor(e,t){super(),this.callee=e,this.args=t}type="CallExpression"},b=class extends y{constructor(e){super(),this.value=e}type="Identifier"},w=class extends y{constructor(e){super(),this.value=e}type="Literal"},v=class extends w{type="NumericLiteral"},_=class extends w{type="StringLiteral"},E=class extends w{type="BooleanLiteral"},k=class extends w{type="ArrayLiteral"},x=class extends w{type="TupleLiteral"},S=class extends w{type="ObjectLiteral"},A=class extends y{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}type="BinaryExpression"},I=class extends y{constructor(e,t){super(),this.operand=e,this.filter=t}type="FilterExpression"},C=class extends y{constructor(e,t,r){super(),this.operand=e,this.negate=t,this.test=r}type="TestExpression"},P=class extends y{constructor(e,t){super(),this.operator=e,this.argument=t}type="UnaryExpression"},T=class extends y{constructor(e=undefined,t=undefined,r=undefined){super(),this.start=e,this.stop=t,this.step=r}type="SliceExpression"},D=class extends y{constructor(e,t){super(),this.key=e,this.value=t}type="KeywordArgumentExpression"};function R(e){const t=new l([]);let r=0;function i(t,n){const i=e[r++];if(!i||i.type!==t)throw new Error(`Parser Error: ${n}. ${i.type} !== ${t}.`);return i}function s(){switch(e[r].type){case n.Text:return new _(i(n.Text,"Expected text token").value);case n.OpenStatement:return function(){let t;switch(i(n.OpenStatement,"Expected opening statement token"),e[r].type){case n.Set:++r,t=c(),i(n.CloseStatement,"Expected closing statement token");break;case n.If:++r,t=u(),i(n.OpenStatement,"Expected {% token"),i(n.EndIf,"Expected endif token"),i(n.CloseStatement,"Expected %} token");break;case n.For:++r,t=function(){const e=h(!0);if(!(e instanceof b||e instanceof x))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${e.type} instead`);i(n.In,"Expected `in` keyword following loop variable");const t=y();i(n.CloseStatement,"Expected closing statement token");const r=[];for(;o(n.OpenStatement,n.EndFor);)r.push(s());return new d(e,t,r)}(),i(n.OpenStatement,"Expected {% token"),i(n.EndFor,"Expected endfor token"),i(n.CloseStatement,"Expected %} token");break;default:throw new SyntaxError(`Unknown statement type: ${e[r].type}`)}return t}();case n.OpenExpression:return function(){i(n.OpenExpression,"Expected opening expression token");const e=y();return i(n.CloseExpression,"Expected closing expression token"),e}();default:throw new SyntaxError(`Unexpected token type: ${e[r].type}`)}}function o(...t){return r+t.length<=e.length&&t.some(((t,n)=>t!==e[r+n].type))}function a(...t){return r+t.length<=e.length&&t.every(((t,n)=>t===e[r+n].type))}function c(){const e=y();if(a(n.Equals)){++r;const t=c();return new p(e,t)}return e}function u(){const t=y();i(n.CloseStatement,"Expected closing statement token");const o=[],c=[];for(;e[r]?.type!==n.OpenStatement||e[r+1]?.type!==n.ElseIf&&e[r+1]?.type!==n.Else&&e[r+1]?.type!==n.EndIf;)o.push(s());if(e[r]?.type===n.OpenStatement&&e[r+1]?.type!==n.EndIf)if(++r,a(n.ElseIf))i(n.ElseIf,"Expected elseif token"),c.push(u());else for(i(n.Else,"Expected else token"),i(n.CloseStatement,"Expected closing statement token");e[r]?.type!==n.OpenStatement||e[r+1]?.type!==n.EndIf;)c.push(s());return new f(t,o,c)}function h(e=!1){const t=e?z:y,i=[t()],s=a(n.Comma);for(;s&&(++r,i.push(t()),a(n.Comma)););return s?new x(i):i[0]}function y(){return function(){const e=w();if(a(n.If)){++r;const t=w();i(n.Else,"Expected else token");const s=w();return new f(t,[e],[s])}return e}()}function w(){let t=R();for(;a(n.Or);){const n=e[r];++r;const i=R();t=new A(n,t,i)}return t}function R(){let t=B();for(;a(n.And);){const n=e[r];++r;const i=B();t=new A(n,t,i)}return t}function B(){let t;for(;a(n.Not);){const n=e[r];++r;const i=B();t=new P(n,i)}return t??function(){let t=M();for(;a(n.ComparisonBinaryOperator)||a(n.In)||a(n.NotIn);){const n=e[r];++r;const i=M();t=new A(n,t,i)}return t}()}function M(){let t=U();for(;a(n.AdditiveBinaryOperator);){const n=e[r];++r;const i=U();t=new A(n,t,i)}return t}function O(){const t=function(){let t=z();for(;a(n.Dot)||a(n.OpenSquareBracket);){const s=e[r];let o;++r;const a=s.type!==n.Dot;if(a)o=L(),i(n.CloseSquareBracket,"Expected closing square bracket");else if(o=z(),"Identifier"!==o.type)throw new SyntaxError("Expected identifier following dot operator");t=new g(t,o,a)}return t}();return a(n.OpenParen)?N(t):t}function N(e){let t=new m(e,function(){i(n.OpenParen,"Expected opening parenthesis for arguments list");const e=function(){const e=[];for(;!a(n.CloseParen);){let t=y();if(a(n.Equals)){if(++r,!(t instanceof b))throw new SyntaxError("Expected identifier for keyword argument");const e=y();t=new D(t,e)}e.push(t),a(n.Comma)&&++r}return e}();return i(n.CloseParen,"Expected closing parenthesis for arguments list"),e}());return a(n.OpenParen)&&(t=N(t)),t}function L(){const e=[];let t=!1;for(;!a(n.CloseSquareBracket);)a(n.Colon)?(e.push(void 0),++r,t=!0):(e.push(y()),a(n.Colon)&&(++r,t=!0));if(0===e.length)throw new SyntaxError("Expected at least one argument for member/slice expression");if(t){if(e.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new T(...e)}return e[0]}function U(){let t=j();for(;a(n.MultiplicativeBinaryOperator);){const n=e[r];++r;const i=j();t=new A(n,t,i)}return t}function j(){let e=function(){let e=O();for(;a(n.Pipe);){++r;let t=z();if(!(t instanceof b))throw new SyntaxError("Expected identifier for the filter");a(n.OpenParen)&&(t=N(t)),e=new I(e,t)}return e}();for(;a(n.Is);){++r;const t=a(n.Not);t&&++r;let i=z();if(i instanceof E&&(i=new b(i.value.toString())),!(i instanceof b))throw new SyntaxError("Expected identifier for the test");e=new C(e,t,i)}return e}function z(){const t=e[r];switch(t.type){case n.NumericLiteral:return++r,new v(Number(t.value));case n.StringLiteral:return++r,new _(t.value);case n.BooleanLiteral:return++r,new E("true"===t.value);case n.Identifier:return++r,new b(t.value);case n.OpenParen:{++r;const t=h();if(e[r].type!==n.CloseParen)throw new SyntaxError(`Expected closing parenthesis, got ${e[r].type} instead`);return++r,t}case n.OpenSquareBracket:{++r;const e=[];for(;!a(n.CloseSquareBracket);)e.push(y()),a(n.Comma)&&++r;return++r,new k(e)}case n.OpenCurlyBracket:{++r;const e=new Map;for(;!a(n.CloseCurlyBracket);){const t=y();i(n.Colon,"Expected colon between key and value in object literal");const s=y();e.set(t,s),a(n.Comma)&&++r}return++r,new S(e)}default:throw new SyntaxError(`Unexpected token: ${t.type}`)}}for(;r<e.length;)t.body.push(s());return t}function B(e,t,r=1){void 0===t&&(t=e,e=0);const n=[];for(let i=e;i<t;i+=r)n.push(i);return n}function M(e,t,r,n=1){const i=Math.sign(n);i>=0?(t=(t??=0)<0?Math.max(e.length+t,0):Math.min(t,e.length),r=(r??=e.length)<0?Math.max(e.length+r,0):Math.min(r,e.length)):(t=(t??=e.length-1)<0?Math.max(e.length+t,-1):Math.min(t,e.length-1),r=(r??=-1)<-1?Math.max(e.length+r,-1):Math.min(r,e.length-1));const s=[];for(let o=t;i*o<i*r;o+=n)s.push(e[o]);return s}function O(e){return e.replace(/\b\w/g,(e=>e.toUpperCase()))}var N=class{type="RuntimeValue";value;builtins=new Map;constructor(e=undefined){this.value=e}__bool__(){return new j(!!this.value)}},L=class extends N{type="NumericValue"},U=class extends N{type="StringValue";builtins=new Map([["upper",new $((()=>new U(this.value.toUpperCase())))],["lower",new $((()=>new U(this.value.toLowerCase())))],["strip",new $((()=>new U(this.value.trim())))],["title",new $((()=>new U(O(this.value))))],["length",new L(this.value.length)]])},j=class extends N{type="BooleanValue"},z=class extends N{type="ObjectValue";__bool__(){return new j(this.value.size>0)}builtins=new Map([["get",new $((([e,t])=>{if(!(e instanceof U))throw new Error(`Object key must be a string: got ${e.type}`);return this.value.get(e.value)??t??new V}))],["items",new $((()=>new F(Array.from(this.value.entries()).map((([e,t])=>new F([new U(e),t]))))))]])},F=class extends N{type="ArrayValue";builtins=new Map([["length",new L(this.value.length)]]);__bool__(){return new j(this.value.length>0)}},K=class extends F{type="TupleValue"},$=class extends N{type="FunctionValue"},V=class extends N{type="NullValue"},W=class extends N{type="UndefinedValue"},q=class{constructor(e){this.parent=e}variables=new Map([["namespace",new $((e=>{if(0===e.length)return new z(new Map);if(1!==e.length||!(e[0]instanceof z))throw new Error("`namespace` expects either zero arguments or a single object argument");return e[0]}))]]);tests=new Map([["boolean",e=>"BooleanValue"===e.type],["callable",e=>e instanceof $],["odd",e=>{if("NumericValue"!==e.type)throw new Error(`Cannot apply test "odd" to type: ${e.type}`);return e.value%2!=0}],["even",e=>{if("NumericValue"!==e.type)throw new Error(`Cannot apply test "even" to type: ${e.type}`);return e.value%2==0}],["false",e=>"BooleanValue"===e.type&&!e.value],["true",e=>"BooleanValue"===e.type&&e.value],["number",e=>"NumericValue"===e.type],["integer",e=>"NumericValue"===e.type&&Number.isInteger(e.value)],["iterable",e=>e instanceof F||e instanceof U],["lower",e=>{const t=e.value;return"StringValue"===e.type&&t===t.toLowerCase()}],["upper",e=>{const t=e.value;return"StringValue"===e.type&&t===t.toUpperCase()}],["none",e=>"NullValue"===e.type],["defined",e=>"UndefinedValue"!==e.type],["undefined",e=>"UndefinedValue"===e.type],["equalto",(e,t)=>e.value===t.value]]);set(e,t){return this.declareVariable(e,H(t))}declareVariable(e,t){if(this.variables.has(e))throw new SyntaxError(`Variable already declared: ${e}`);return this.variables.set(e,t),t}setVariable(e,t){return this.variables.set(e,t),t}resolve(e){if(this.variables.has(e))return this;if(this.parent)return this.parent.resolve(e);throw new Error(`Unknown variable: ${e}`)}lookupVariable(e){try{return this.resolve(e).variables.get(e)??new W}catch{return new W}}};function H(e){switch(typeof e){case"number":return new L(e);case"string":return new U(e);case"boolean":return new j(e);case"object":return null===e?new V:Array.isArray(e)?new F(e.map(H)):new z(new Map(Object.entries(e).map((([e,t])=>[e,H(t)]))));case"function":return new $(((t,r)=>H(e(...t.map((e=>e.value)))??null)));default:throw new Error(`Cannot convert to runtime value: ${e}`)}}var G=class{parsed;constructor(e){const t=function(e,t={}){const r=[],h=function(e,t={}){return e.endsWith("\n")&&(e=e.slice(0,-1)),e=e.replace(/{#.*?#}/gs,"{##}"),t.lstrip_blocks&&(e=e.replace(/^[ \t]*({[#%])/gm,"$1")),t.trim_blocks&&(e=e.replace(/([#%]})\n/g,"$1")),e.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}(e,t);let l=0;const f=e=>{let t="";for(;e(h[l]);)if("\\"!==h[l]){if(t+=h[l++],l>=h.length)throw new SyntaxError("Unexpected end of input")}else{if(++l,l>=h.length)throw new SyntaxError("Unexpected end of input");const e=h[l++],r=u.get(e);if(void 0===r)throw new SyntaxError(`Unexpected escaped character: ${e}`);t+=r}return t};e:for(;l<h.length;){const e=r.at(-1)?.type;if(void 0===e||e===n.CloseStatement||e===n.CloseExpression){let e="";for(;l<h.length&&("{"!==h[l]||"%"!==h[l+1]&&"{"!==h[l+1]);)e+=h[l++];if(e.length>0){r.push(new s(e,n.Text));continue}}f((e=>/\s/.test(e)));const t=h[l];if("-"===t||"+"===t){const e=r.at(-1)?.type;if(e===n.Text||void 0===e)throw new SyntaxError(`Unexpected character: ${t}`);switch(e){case n.Identifier:case n.NumericLiteral:case n.BooleanLiteral:case n.StringLiteral:case n.CloseParen:case n.CloseSquareBracket:break;default:{++l;const e=f(a);r.push(new s(`${t}${e}`,e.length>0?n.NumericLiteral:n.UnaryOperator));continue}}}for(const[e,t]of c)if(h.slice(l,l+e.length)===e){r.push(new s(e,t)),l+=e.length;continue e}if("'"!==t&&'"'!==t)if(a(t)){const e=f(a);r.push(new s(e,n.NumericLiteral))}else{if(!o(t))throw new SyntaxError(`Unexpected character: ${t}`);{const e=f(o),t=Object.hasOwn(i,e)?i[e]:n.Identifier;t===n.In&&r.at(-1)?.type===n.Not?(r.pop(),r.push(new s("not in",n.NotIn))):r.push(new s(e,t))}}else{++l;const e=f((e=>e!==t));r.push(new s(e,n.StringLiteral)),++l}}return r}(e,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=R(t)}render(e){const t=new q;t.set("false",!1),t.set("true",!0),t.set("raise_exception",(e=>{throw new Error(e)})),t.set("range",B);for(const[r,n]of Object.entries(e))t.set(r,n);const r=new class{global;constructor(e){this.global=e??new q}run(e){return this.evaluate(e,this.global)}evaluateBinaryExpression(e,t){const r=this.evaluate(e.left,t);switch(e.operator.value){case"and":return r.__bool__().value?this.evaluate(e.right,t):r;case"or":return r.__bool__().value?r:this.evaluate(e.right,t)}const n=this.evaluate(e.right,t);switch(e.operator.value){case"==":return new j(r.value==n.value);case"!=":return new j(r.value!=n.value)}if(r instanceof W||n instanceof W)throw new Error("Cannot perform operation on undefined values");if(r instanceof V||n instanceof V)throw new Error("Cannot perform operation on null values");if(r instanceof L&&n instanceof L)switch(e.operator.value){case"+":return new L(r.value+n.value);case"-":return new L(r.value-n.value);case"*":return new L(r.value*n.value);case"/":return new L(r.value/n.value);case"%":return new L(r.value%n.value);case"<":return new j(r.value<n.value);case">":return new j(r.value>n.value);case">=":return new j(r.value>=n.value);case"<=":return new j(r.value<=n.value)}else if(r instanceof F&&n instanceof F){if("+"===e.operator.value)return new F(r.value.concat(n.value))}else if(n instanceof F){const t=void 0!==n.value.find((e=>e.value===r.value));switch(e.operator.value){case"in":return new j(t);case"not in":return new j(!t)}}if((r instanceof U||n instanceof U)&&"+"===e.operator.value)return new U(r.value.toString()+n.value.toString());if(r instanceof U&&n instanceof U)switch(e.operator.value){case"in":return new j(n.value.includes(r.value));case"not in":return new j(!n.value.includes(r.value))}if(r instanceof U&&n instanceof z)switch(e.operator.value){case"in":return new j(n.value.has(r.value));case"not in":return new j(!n.value.has(r.value))}throw new SyntaxError(`Unknown operator "${e.operator.value}" between ${r.type} and ${n.type}`)}evaluateFilterExpression(e,t){const r=this.evaluate(e.operand,t);if("Identifier"===e.filter.type){const t=e.filter;if(r instanceof F)switch(t.value){case"list":return r;case"first":return r.value[0];case"last":return r.value[r.value.length-1];case"length":return new L(r.value.length);case"reverse":return new F(r.value.reverse());case"sort":return new F(r.value.sort(((e,t)=>{if(e.type!==t.type)throw new Error(`Cannot compare different types: ${e.type} and ${t.type}`);switch(e.type){case"NumericValue":return e.value-t.value;case"StringValue":return e.value.localeCompare(t.value);default:throw new Error(`Cannot compare type: ${e.type}`)}})));default:throw new Error(`Unknown ArrayValue filter: ${t.value}`)}else if(r instanceof U)switch(t.value){case"length":return new L(r.value.length);case"upper":return new U(r.value.toUpperCase());case"lower":return new U(r.value.toLowerCase());case"title":return new U(O(r.value));case"capitalize":return new U(r.value.charAt(0).toUpperCase()+r.value.slice(1));case"trim":return new U(r.value.trim());default:throw new Error(`Unknown StringValue filter: ${t.value}`)}else{if(r instanceof L){if("abs"===t.value)return new L(Math.abs(r.value));throw new Error(`Unknown NumericValue filter: ${t.value}`)}if(r instanceof z)switch(t.value){case"items":return new F(Array.from(r.value.entries()).map((([e,t])=>new F([new U(e),t]))));case"length":return new L(r.value.size);default:throw new Error(`Unknown ObjectValue filter: ${t.value}`)}}throw new Error(`Cannot apply filter "${t.value}" to type: ${r.type}`)}if("CallExpression"===e.filter.type){const n=e.filter;if("Identifier"!==n.callee.type)throw new Error(`Unknown filter: ${n.callee.type}`);const i=n.callee.value;if(r instanceof F){if("selectattr"===i){if(r.value.some((e=>!(e instanceof z))))throw new Error("`selectattr` can only be applied to array of objects");if(n.args.some((e=>"StringLiteral"!==e.type)))throw new Error("arguments of `selectattr` must be strings");const[e,i,s]=n.args.map((e=>this.evaluate(e,t)));let o;if(i){const e=t.tests.get(i.value);if(!e)throw new Error(`Unknown test: ${i.value}`);o=e}else o=(...e)=>e[0].__bool__().value;const a=r.value.filter((t=>{const r=t.value.get(e.value);return!!r&&o(r,s)}));return new F(a)}throw new Error(`Unknown ArrayValue filter: ${i}`)}throw new Error(`Cannot apply filter "${i}" to type: ${r.type}`)}throw new Error(`Unknown filter: ${e.filter.type}`)}evaluateTestExpression(e,t){const r=this.evaluate(e.operand,t),n=t.tests.get(e.test.value);if(!n)throw new Error(`Unknown test: ${e.test.value}`);const i=n(r);return new j(e.negate?!i:i)}evaluateUnaryExpression(e,t){const r=this.evaluate(e.argument,t);if("not"===e.operator.value)return new j(!r.value);throw new SyntaxError(`Unknown operator: ${e.operator.value}`)}evalProgram(e,t){return this.evaluateBlock(e.body,t)}evaluateBlock(e,t){let r="";for(const n of e){const e=this.evaluate(n,t);"NullValue"!==e.type&&"UndefinedValue"!==e.type&&(r+=e.value)}return new U(r)}evaluateIdentifier(e,t){return t.lookupVariable(e.value)}evaluateCallExpression(e,t){const r=[],n=new Map;for(const i of e.args)if("KeywordArgumentExpression"===i.type){const e=i;n.set(e.key.value,this.evaluate(e.value,t))}else r.push(this.evaluate(i,t));n.size>0&&r.push(new z(n));const i=this.evaluate(e.callee,t);if("FunctionValue"!==i.type)throw new Error(`Cannot call something that is not a function: got ${i.type}`);return i.value(r,t)}evaluateSliceExpression(e,t,r){if(!(e instanceof F||e instanceof U))throw new Error("Slice object must be an array or string");const n=this.evaluate(t.start,r),i=this.evaluate(t.stop,r),s=this.evaluate(t.step,r);if(!(n instanceof L||n instanceof W))throw new Error("Slice start must be numeric or undefined");if(!(i instanceof L||i instanceof W))throw new Error("Slice stop must be numeric or undefined");if(!(s instanceof L||s instanceof W))throw new Error("Slice step must be numeric or undefined");return e instanceof F?new F(M(e.value,n.value,i.value,s.value)):new U(M(Array.from(e.value),n.value,i.value,s.value).join(""))}evaluateMemberExpression(e,t){const r=this.evaluate(e.object,t);let n,i;if(e.computed){if("SliceExpression"===e.property.type)return this.evaluateSliceExpression(r,e.property,t);n=this.evaluate(e.property,t)}else n=new U(e.property.value);if(r instanceof z){if(!(n instanceof U))throw new Error(`Cannot access property with non-string: got ${n.type}`);i=r.value.get(n.value)??r.builtins.get(n.value)}else if(r instanceof F||r instanceof U)if(n instanceof L)i=r.value.at(n.value),r instanceof U&&(i=new U(r.value.at(n.value)));else{if(!(n instanceof U))throw new Error(`Cannot access property with non-string/non-number: got ${n.type}`);i=r.builtins.get(n.value)}else{if(!(n instanceof U))throw new Error(`Cannot access property with non-string: got ${n.type}`);i=r.builtins.get(n.value)}return i instanceof N?i:new W}evaluateSet(e,t){const r=this.evaluate(e.value,t);if("Identifier"===e.assignee.type){const n=e.assignee.value;t.setVariable(n,r)}else{if("MemberExpression"!==e.assignee.type)throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(e.assignee)}`);{const n=e.assignee,i=this.evaluate(n.object,t);if(!(i instanceof z))throw new Error("Cannot assign to member of non-object");if("Identifier"!==n.property.type)throw new Error("Cannot assign to member with non-identifier property");i.value.set(n.property.value,r)}}return new V}evaluateIf(e,t){const r=this.evaluate(e.test,t);return this.evaluateBlock(r.__bool__().value?e.body:e.alternate,t)}evaluateFor(e,t){const r=new q(t),n=this.evaluate(e.iterable,r);if(!(n instanceof F))throw new Error(`Expected iterable type in for loop: got ${n.type}`);let i="";for(let t=0;t<n.value.length;++t){const s=new Map([["index",new L(t+1)],["index0",new L(t)],["revindex",new L(n.value.length-t)],["revindex0",new L(n.value.length-t-1)],["first",new j(0===t)],["last",new j(t===n.value.length-1)],["length",new L(n.value.length)],["previtem",t>0?n.value[t-1]:new W],["nextitem",t<n.value.length-1?n.value[t+1]:new W]]);r.setVariable("loop",new z(s));const o=n.value[t];if("Identifier"===e.loopvar.type)r.setVariable(e.loopvar.value,o);else if("TupleLiteral"===e.loopvar.type){const t=e.loopvar;if("ArrayValue"!==o.type)throw new Error(`Cannot unpack non-iterable type: ${o.type}`);const n=o;if(t.value.length!==n.value.length)throw new Error(`Too ${t.value.length>n.value.length?"few":"many"} items to unpack`);for(let e=0;e<t.value.length;++e){if("Identifier"!==t.value[e].type)throw new Error(`Cannot unpack non-identifier type: ${t.value[e].type}`);r.setVariable(t.value[e].value,n.value[e])}}i+=this.evaluateBlock(e.body,r).value}return new U(i)}evaluate(e,t){if(void 0===e)return new W;switch(e.type){case"Program":return this.evalProgram(e,t);case"Set":return this.evaluateSet(e,t);case"If":return this.evaluateIf(e,t);case"For":return this.evaluateFor(e,t);case"NumericLiteral":return new L(Number(e.value));case"StringLiteral":return new U(e.value);case"BooleanLiteral":return new j(e.value);case"ArrayLiteral":return new F(e.value.map((e=>this.evaluate(e,t))));case"TupleLiteral":return new K(e.value.map((e=>this.evaluate(e,t))));case"ObjectLiteral":{const r=new Map;for(const[n,i]of e.value){const e=this.evaluate(n,t);if(!(e instanceof U))throw new Error(`Object keys must be strings: got ${e.type}`);r.set(e.value,this.evaluate(i,t))}return new z(r)}case"Identifier":return this.evaluateIdentifier(e,t);case"CallExpression":return this.evaluateCallExpression(e,t);case"MemberExpression":return this.evaluateMemberExpression(e,t);case"UnaryExpression":return this.evaluateUnaryExpression(e,t);case"BinaryExpression":return this.evaluateBinaryExpression(e,t);case"FilterExpression":return this.evaluateFilterExpression(e,t);case"TestExpression":return this.evaluateTestExpression(e,t);default:throw new SyntaxError(`Unknown node type: ${e.type}`)}}}(t);return r.run(this.parsed).value}}},28391:function(e,t,r){"use strict";r.d(t,{_L:function(){return n},D7:function(){return o},wJ:function(){return i}});class n extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function i(e,t,r){const i=r??{},s=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const o=()=>{null!=r&&r()};for(t.addEventListener("abort",o);;){let a;try{if(t.aborted){const{abortMessage:e,abortCode:t}=i;throw new n(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=i;t(new n(e,r))}}));a=await Promise.race([e,s.next()]),r=null}catch(r){t.removeEventListener("abort",o);const n="aborted"===r.type&&t.aborted;if(n&&null!=i.onAbort&&await i.onAbort(e),"function"==typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=i.onReturnError&&i.onReturnError(e)}))}catch(e){null!=i.onReturnError&&i.onReturnError(e)}if(n&&!0===i.returnOnAbort)return;throw r}if(!0===a.done)break;yield a.value}t.removeEventListener("abort",o)}()}function s(e,t,r){return n=>e(i(n,t,r))}function o(e,t,r){return{sink:s(e.sink,t,{...r,onAbort:void 0}),source:i(e.source,t,r)}}},7688:function(e,t,r){"use strict";function n(e){if(!Array.isArray(e))throw new TypeError("Expected an array, got "+typeof e);for(let t=(e=[...e]).length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}r.d(t,{Z:function(){return n}})},40619:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(53597);function i(e){return"function"==typeof e.stream?(0,n.Z)(e.stream()):(0,n.Z)(new Response(e).body)}},98724:function(e,t,r){"use strict";r.d(t,{Ed:function(){return d},D1:function(){return ue},DA:function(){return se}});var n={};r.r(n),r.d(n,{abortedError:function(){return f},closeFailedError:function(){return o},deleteFailedError:function(){return u},getFailedError:function(){return c},hasFailedError:function(){return h},notFoundError:function(){return l},openFailedError:function(){return s},putFailedError:function(){return a}});var i=r(32114);function s(e){return e=e??new Error("Open failed"),i(e,"ERR_OPEN_FAILED")}function o(e){return e=e??new Error("Close failed"),i(e,"ERR_CLOSE_FAILED")}function a(e){return e=e??new Error("Put failed"),i(e,"ERR_PUT_FAILED")}function c(e){return e=e??new Error("Get failed"),i(e,"ERR_GET_FAILED")}function u(e){return e=e??new Error("Delete failed"),i(e,"ERR_DELETE_FAILED")}function h(e){return e=e??new Error("Has failed"),i(e,"ERR_HAS_FAILED")}function l(e){return e=e??new Error("Not Found"),i(e,"ERR_NOT_FOUND")}function f(e){return e=e??new Error("Aborted"),i(e,"ERR_ABORTED")}class d{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:r,block:n}of e)await this.put(r,n,t),yield r}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const r of e)yield{cid:r,block:await this.get(r,t)}}async delete(e,t){await Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const r of e)await this.delete(r,t),yield r}async*getAll(e){throw new Error(".getAll is not implemented")}}var p=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const y=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class g{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class m{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return w(this,e)}}class b{constructor(e){this.decoders=e}or(e){return w(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const w=(e,t)=>new b({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class v{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new g(e,t,r),this.decoder=new m(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const _=({name:e,prefix:t,encode:r,decode:n})=>new v(e,t,r,n),E=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=p(r,t);return _({prefix:e,name:t,encode:n,decode:e=>y(i(e))})},k=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>_({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),x=k({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),S=(k({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),k({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),k({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),k({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),k({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),k({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),k({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),k({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),E({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));E({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var A=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=P;)r[n++]=255&t|I,t/=128;for(;t&C;)r[n++]=255&t|I,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},I=128,C=-128,P=Math.pow(2,31);var T=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&R)<<s:(n&R)*Math.pow(2,s),s+=7}while(n>=D);return e.bytes=o-r,i},D=128,R=127;var B=Math.pow(2,7),M=Math.pow(2,14),O=Math.pow(2,21),N=Math.pow(2,28),L=Math.pow(2,35),U=Math.pow(2,42),j=Math.pow(2,49),z=Math.pow(2,56),F=Math.pow(2,63),K={encode:A,decode:T,encodingLength:function(e){return e<B?1:e<M?2:e<O?3:e<N?4:e<L?5:e<U?6:e<j?7:e<z?8:e<F?9:10}};const $=(e,t=0)=>[K.decode(e,t),K.decode.bytes],V=(e,t,r=0)=>(K.encode(e,t,r),t),W=e=>K.encodingLength(e),q=e=>{const t=y(e),[r,n]=$(t),[i,s]=$(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new H(r,i,o,t)};class H{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const G=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Q(r,Y(e),t||S.encoder):ee(r,Y(e),t||x.encoder)},J=new WeakMap,Y=e=>{const t=J.get(e);if(null==t){const t=new Map;return J.set(e,t),t}return t};class Z{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==te)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==re)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Z.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=((e,t)=>{const r=t.byteLength,n=W(e),i=n+W(r),s=new Uint8Array(i+r);return V(e,s,0),V(r,s,n),s.set(t,i),new H(e,r,t,s)})(e,t);return Z.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Z.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return G(this,e)}toJSON(){return{"/":G(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Z)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Z(e,r,n,i||ne(e,r,n.bytes))}if(!0===t[ie]){const{version:e,multihash:r,code:n}=t,i=q(r);return Z.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==te)throw new Error(`Version 0 CID must use dag-pb (code: ${te}) block encoding`);return new Z(e,t,r,r.bytes);case 1:{const n=ne(e,t,r.bytes);return new Z(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Z.create(0,te,e)}static createV1(e,t){return Z.create(1,e,t)}static decode(e){const[t,r]=Z.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Z.inspectBytes(e),r=t.size-t.multihashSize,n=y(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new H(t.multihashCode,t.digestSize,i,n);return[0===t.version?Z.createV0(s):Z.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=$(e.subarray(t));return t+=n,r};let n=r(),i=te;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=X(e,t),i=Z.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Y(i).set(r,e),i}}const X=(e,t)=>{switch(e[0]){case"Q":{const r=t||S;return[S.prefix,r.decode(`${S.prefix}${e}`)]}case S.prefix:{const r=t||S;return[S.prefix,r.decode(e)]}case x.prefix:{const r=t||x;return[x.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Q=(e,t,r)=>{const{prefix:n}=r;if(n!==S.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},ee=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},te=112,re=18,ne=(e,t,r)=>{const n=W(e),i=n+W(t),s=new Uint8Array(i+r.byteLength);return V(e,s,0),V(t,s,n),s.set(r,i),s},ie=Symbol.for("@ipld/js-cid/CID");class se extends d{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(x.encode(e.multihash.bytes),t),e}get(e){const t=this.data.get(x.encode(e.multihash.bytes));if(null==t)throw l();return t}has(e){return this.data.has(x.encode(e.multihash.bytes))}async delete(e){this.data.delete(x.encode(e.multihash.bytes))}async*getAll(){for(const[e,t]of this.data.entries())yield{cid:Z.createV1(85,q(x.decode(e))),block:t}}}var oe=r(11227);const ae=k({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});k({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),k({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),k({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});oe.formatters.b=e=>null==e?"undefined":S.baseEncode(e),oe.formatters.t=e=>null==e?"undefined":x.baseEncode(e),oe.formatters.m=e=>null==e?"undefined":ae.baseEncode(e),oe.formatters.p=e=>null==e?"undefined":e.toString(),oe.formatters.c=e=>null==e?"undefined":e.toString(),oe.formatters.k=e=>null==e?"undefined":e.toString(),oe.formatters.a=e=>null==e?"undefined":e.toString();class ce extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}!function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);oe.enabled(`${e}:trace`)&&null!=oe.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=oe(`${e}:trace`)),Object.assign(oe(e),{error:oe(`${e}:error`),trace:t})}("blockstore:core:tiered");const ue={...n}},58733:function(e,t,r){"use strict";r.d(t,{x:function(){return w}});var n=r(93361),i=r(37430),s=r(66699),o=r(38161),a=r(53137),c=r(29094),u=r(14249),h=r(81653),l=r(32114),f=r(44752),d=r(56635);const p=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();class y{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,n.Z)(this.putMany(e,r)),e=[],await(0,n.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,f.Z)(r,(t=>t.key.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,f.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>p(e,t)),r)),null!=e.offset){let t=0;r=(0,f.Z)(r,(()=>t++>=(e.offset||0)))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,f.Z)(r,(t=>t.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,f.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>p(e,t)),r)),null!=e.offset){let t=0;r=(0,f.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}}function g(e){const t=o.k0.asCID(e);if(!t)throw l(new Error("Not a valid cid"),"ERR_INVALID_CID");return new s.s("/"+u.base32.encode(t.multihash.bytes).slice(1).toUpperCase(),!1)}function m(e){return o.k0.createV1(a.code,c.Jx(u.base32.decode("b"+e.toString().slice(1).toLowerCase())))}function b(e){const t=e.substring(0,1);if("/"===t)return b(e.substring(1));let r,n;r="b"===t.toLowerCase()?e=>u.base32.decode(e.toLowerCase()).subarray(2):"c"===t.toLowerCase()?e=>u.base32pad.decode(e.toLowerCase()).subarray(2):"z"===t?e=>h.base58btc.decode(e).subarray(2):"Q"===t?e=>h.base58btc.decode("z"+e):e=>u.base32.decode("b"+e.toLowerCase()).subarray(2);for(let t=1;t<e.length;t++)try{n=r(e.substring(0,t))}catch(e){if("Unexpected end of data"!==e.message)throw e}let i="/C";return n&&(i=`/${u.base32.encode(n).slice(1,-1).toUpperCase()||"C"}`),i}class w extends y{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:r,value:n}of this.child.query(function(e){return{...e,prefix:e.prefix?b(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e({key:m(t.key),value:t.value}))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e({key:m(t.key),value:t.value},{key:m(r.key),value:r.value}))):void 0}}(e),t))yield{key:m(r),value:n}}async*queryKeys(e,t){for await(const r of this.child.queryKeys(function(e){return{...e,prefix:e.prefix?b(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e(m(t)))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e(m(t),m(r)))):void 0}}(e),t))yield m(r)}async get(e,t){return this.child.get(g(e),t)}async*getMany(e,t){for await(const r of e)yield this.get(r,t)}async put(e,t,r){await this.child.put(g(e),t,r)}async*putMany(e,t){const r=(0,i.d)({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)((async()=>{try{const i=this.child;await(0,n.Z)(this.child.putMany(async function*(){for await(const n of e){const e=g(n.key);await i.has(e,t)||(yield{key:e,value:n.value}),r.push(n)}}())),r.end()}catch(e){r.end(e)}})),yield*r}has(e,t){return this.child.has(g(e),t)}delete(e,t){return this.child.delete(g(e),t)}deleteMany(e,t){const r=(0,i.d)({objectMode:!0});return(0,n.Z)(this.child.deleteMany(async function*(){for await(const t of e)yield g(t),r.push(t);r.end()}(),t)).catch((e=>{r.end(e)})),r}}},33634:function(e,t,r){"use strict";r.d(t,{Y:function(){return Z}});var n=r(98724),i=r(4424);var s=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const o=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class a{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class c{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return h(this,e)}}class u{constructor(e){this.decoders=e}or(e){return h(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const h=(e,t)=>new u({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class l{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new a(e,t,r),this.decoder=new c(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const f=({name:e,prefix:t,encode:r,decode:n})=>new l(e,t,r,n),d=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=s(r,t);return f({prefix:e,name:t,encode:n,decode:e=>o(i(e))})},p=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>f({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),y=p({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),g=p({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),m=(p({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),p({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),p({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),p({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),p({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),p({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),d({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));d({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var b=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=_;)r[n++]=255&t|w,t/=128;for(;t&v;)r[n++]=255&t|w,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},w=128,v=-128,_=Math.pow(2,31);var E=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&x)<<s:(n&x)*Math.pow(2,s),s+=7}while(n>=k);return e.bytes=o-r,i},k=128,x=127;var S=Math.pow(2,7),A=Math.pow(2,14),I=Math.pow(2,21),C=Math.pow(2,28),P=Math.pow(2,35),T=Math.pow(2,42),D=Math.pow(2,49),R=Math.pow(2,56),B=Math.pow(2,63),M={encode:b,decode:E,encodingLength:function(e){return e<S?1:e<A?2:e<I?3:e<C?4:e<P?5:e<T?6:e<D?7:e<R?8:e<B?9:10}};const O=(e,t=0)=>[M.decode(e,t),M.decode.bytes],N=(e,t,r=0)=>(M.encode(e,t,r),t),L=e=>M.encodingLength(e),U=e=>{const t=o(e),[r,n]=O(t),[i,s]=O(t.subarray(n)),a=t.subarray(n+s);if(a.byteLength!==i)throw new Error("Incorrect length");return new j(r,i,a,t)};class j{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const z=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?W(r,K(e),t||m.encoder):q(r,K(e),t||y.encoder)},F=new WeakMap,K=e=>{const t=F.get(e);if(null==t){const t=new Map;return F.set(e,t),t}return t};class ${constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==H)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==G)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=((e,t)=>{const r=t.byteLength,n=L(e),i=n+L(r),s=new Uint8Array(i+r);return N(e,s,0),N(r,s,n),s.set(t,i),new j(e,r,t,s)})(e,t);return $.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return z(this,e)}toJSON(){return{"/":z(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof $)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new $(e,r,n,i||J(e,r,n.bytes))}if(!0===t[Y]){const{version:e,multihash:r,code:n}=t,i=U(r);return $.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==H)throw new Error(`Version 0 CID must use dag-pb (code: ${H}) block encoding`);return new $(e,t,r,r.bytes);case 1:{const n=J(e,t,r.bytes);return new $(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return $.create(0,H,e)}static createV1(e,t){return $.create(1,e,t)}static decode(e){const[t,r]=$.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$.inspectBytes(e),r=t.size-t.multihashSize,n=o(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new j(t.multihashCode,t.digestSize,i,n);return[0===t.version?$.createV0(s):$.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=O(e.subarray(t));return t+=n,r};let n=r(),i=H;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=V(e,t),i=$.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return K(i).set(r,e),i}}const V=(e,t)=>{switch(e[0]){case"Q":{const r=t||m;return[m.prefix,r.decode(`${m.prefix}${e}`)]}case m.prefix:{const r=t||m;return[m.prefix,r.decode(e)]}case y.prefix:{const r=t||y;return[y.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},W=(e,t,r)=>{const{prefix:n}=r;if(n!==m.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},q=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},H=112,G=18,J=(e,t,r)=>{const n=L(e),i=n+L(t),s=new Uint8Array(i+r.byteLength);return N(e,s,0),N(t,s,n),s.set(r,i),s},Y=Symbol.for("@ipld/js-cid/CID");class Z extends n.Ed{location;version;db;base;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1,this.base=t.base??g}#e(e){return`/${this.base.encoder.encode(e.multihash.bytes)}`}#t(e){return $.createV1(85,U(this.base.decoder.decode(e.substring(1))))}async open(){try{const e=this.location;this.db=await(0,i.X3)(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw n.D1.openFailedError(e)}}async close(){this.db?.close()}async put(e,t){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return await this.db.put(this.location,t,this.#e(e)),e}catch(e){throw n.D1.putFailedError(e)}}async get(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");let t;try{t=await this.db.get(this.location,this.#e(e))}catch(e){throw n.D1.putFailedError(e)}if(void 0===t)throw n.D1.notFoundError();return t}async delete(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{await this.db.delete(this.location,this.#e(e))}catch(e){throw n.D1.putFailedError(e)}}async has(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return Boolean(await this.db.getKey(this.location,this.#e(e)))}catch(e){throw n.D1.putFailedError(e)}}async*getAll(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");for(const e of await this.db.getAllKeys(this.location)){const t=this.#t(e.toString()),r=await this.get(t);yield{cid:t,block:r}}}async destroy(){await(0,i.Lj)(this.location)}}},53597:function(e,t,r){"use strict";async function*n(e,t={}){const r=e.getReader();try{for(;;){const e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}r.d(t,{Z:function(){return n}})},11067:function(e,t,r){"use strict";function n(e){return e instanceof Uint8Array?{get:t=>e[t],set(t,r){e[t]=r}}:{get:t=>e.get(t),set(t,r){e.set(t,r)}}}r.d(t,{Z:function(){return n}})},64936:function(e,t,r){"use strict";r.d(t,{Dy:function(){return s.D},Jx:function(){return i.Jx},WU:function(){return s.W},cv:function(){return n.cv}});var n=r(72696),i=r(61287),s=r(59787)},55580:function(e,t,r){"use strict";r.d(t,{Fh:function(){return p},Jl:function(){return c},Km:function(){return h},Tp:function(){return y},X0:function(){return a},YX:function(){return u},Zh:function(){return l},cs:function(){return f},kj:function(){return o},or:function(){return s},uN:function(){return d}});var n=r(59787),i=r(85590);const s=[24,256,65536,4294967296,BigInt("18446744073709551616")];function o(e,t,r){(0,i.DO)(e,t,1);const n=e[t];if(!0===r.strict&&n<s[0])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);return n}function a(e,t,r){(0,i.DO)(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<s[1])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);return n}function c(e,t,r){(0,i.DO)(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<s[2])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);return n}function u(e,t,r){(0,i.DO)(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],a=(BigInt(n)<<BigInt(32))+BigInt(o);if(!0===r.strict&&a<s[3])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);if(a<=Number.MAX_SAFE_INTEGER)return Number(a);if(!0===r.allowBigInt)return a;throw new Error(`${i.IR} integers outside of the safe integer range are not supported`)}function h(e,t,r,i){return new n.W(n.D.uint,o(e,t+1,i),2)}function l(e,t,r,i){return new n.W(n.D.uint,a(e,t+1,i),3)}function f(e,t,r,i){return new n.W(n.D.uint,c(e,t+1,i),5)}function d(e,t,r,i){return new n.W(n.D.uint,u(e,t+1,i),9)}function p(e,t){return y(e,0,t.value)}function y(e,t,r){if(r<s[0]){const n=Number(r);e.push([t|n])}else if(r<s[1]){const n=Number(r);e.push([24|t,n])}else if(r<s[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<s[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<s[4]))throw new Error(`${i.IR} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&i,i>>=8,r[7]=255&i,i>>=8,r[6]=255&i,i>>=8,r[5]=255&i,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,e.push(r)}}}p.encodedSize=function(e){return y.encodedSize(e.value)},y.encodedSize=function(e){return e<s[0]?1:e<s[1]?2:e<s[2]?3:e<s[3]?5:9},p.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}},53929:function(e,t,r){"use strict";r.d(t,{UT:function(){return f},ec:function(){return l},r0:function(){return a},wy:function(){return c},yr:function(){return o}});var n=r(59787),i=r(55580),s=r(85590);function o(e,t,r,s){return new n.W(n.D.negint,-1-i.kj(e,t+1,s),2)}function a(e,t,r,s){return new n.W(n.D.negint,-1-i.X0(e,t+1,s),3)}function c(e,t,r,s){return new n.W(n.D.negint,-1-i.Jl(e,t+1,s),5)}const u=BigInt(-1),h=BigInt(1);function l(e,t,r,o){const a=i.YX(e,t+1,o);if("bigint"!=typeof a){const e=-1-a;if(e>=Number.MIN_SAFE_INTEGER)return new n.W(n.D.negint,e,9)}if(!0!==o.allowBigInt)throw new Error(`${s.IR} integers outside of the safe integer range are not supported`);return new n.W(n.D.negint,u-BigInt(a),9)}function f(e,t){const r=t.value,n="bigint"==typeof r?r*u-h:-1*r-1;i.Tp(e,t.type.majorEncoded,n)}f.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*u-h:-1*t-1;return r<i.or[0]?1:r<i.or[1]?2:r<i.or[2]?3:r<i.or[3]?5:9},f.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0}},11560:function(e,t,r){"use strict";r.d(t,{BS:function(){return h},Ii:function(){return c},ME:function(){return f},UQ:function(){return u},hg:function(){return p},zU:function(){return l}});var n=r(59787),i=r(85590),s=r(55580),o=r(22042);function a(e,t,r,s){(0,i.DO)(e,t,r+s);const a=(0,o.tP)(e,t+r,t+r+s);return new n.W(n.D.bytes,a,r+s)}function c(e,t,r,n){return a(e,t,1,r)}function u(e,t,r,n){return a(e,t,2,s.kj(e,t+1,n))}function h(e,t,r,n){return a(e,t,3,s.X0(e,t+1,n))}function l(e,t,r,n){return a(e,t,5,s.Jl(e,t+1,n))}function f(e,t,r,n){const o=s.YX(e,t+1,n);if("bigint"==typeof o)throw new Error(`${i.IR} 64-bit integer bytes lengths not supported`);return a(e,t,9,o)}function d(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===n.D.string?(0,o.mL)(e.value):e.value),e.encodedBytes}function p(e,t){const r=d(t);s.Tp(e,t.type.majorEncoded,r.length),e.push(r)}p.encodedSize=function(e){const t=d(e);return s.Tp.encodedSize(t.length)+t.length},p.compareTokens=function(e,t){return r=d(e),n=d(t),r.length<n.length?-1:r.length>n.length?1:(0,o.qu)(r,n);var r,n}},50768:function(e,t,r){"use strict";r.d(t,{Bq:function(){return h},YW:function(){return p},bc:function(){return d},h:function(){return l},nt:function(){return u},q0:function(){return f}});var n=r(59787),i=r(85590),s=r(55580),o=r(11560),a=r(22042);function c(e,t,r,s,o){const c=r+s;(0,i.DO)(e,t,c);const u=new n.W(n.D.string,(0,a.BB)(e,t+r,t+c),c);return!0===o.retainStringBytes&&(u.byteValue=(0,a.tP)(e,t+r,t+c)),u}function u(e,t,r,n){return c(e,t,1,r,n)}function h(e,t,r,n){return c(e,t,2,s.kj(e,t+1,n),n)}function l(e,t,r,n){return c(e,t,3,s.X0(e,t+1,n),n)}function f(e,t,r,n){return c(e,t,5,s.Jl(e,t+1,n),n)}function d(e,t,r,n){const o=s.YX(e,t+1,n);if("bigint"==typeof o)throw new Error(`${i.IR} 64-bit integer string lengths not supported`);return c(e,t,9,o,n)}const p=o.hg},8278:function(e,t,r){"use strict";r.d(t,{HF:function(){return d},Ju:function(){return a},OC:function(){return u},a8:function(){return l},h7:function(){return c},lY:function(){return h},s5:function(){return f}});var n=r(59787),i=r(55580),s=r(85590);function o(e,t,r,i){return new n.W(n.D.array,i,r)}function a(e,t,r,n){return o(0,0,1,r)}function c(e,t,r,n){return o(0,0,2,i.kj(e,t+1,n))}function u(e,t,r,n){return o(0,0,3,i.X0(e,t+1,n))}function h(e,t,r,n){return o(0,0,5,i.Jl(e,t+1,n))}function l(e,t,r,n){const a=i.YX(e,t+1,n);if("bigint"==typeof a)throw new Error(`${s.IR} 64-bit integer array lengths not supported`);return o(0,0,9,a)}function f(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${s.IR} indefinite length items not allowed`);return o(0,0,1,1/0)}function d(e,t){i.Tp(e,n.D.array.majorEncoded,t.value)}d.compareTokens=i.Fh.compareTokens,d.encodedSize=function(e){return i.Tp.encodedSize(e.value)}},59283:function(e,t,r){"use strict";r.d(t,{F2:function(){return l},G:function(){return c},IY:function(){return h},KI:function(){return d},_K:function(){return a},ng:function(){return f},qe:function(){return u}});var n=r(59787),i=r(55580),s=r(85590);function o(e,t,r,i){return new n.W(n.D.map,i,r)}function a(e,t,r,n){return o(0,0,1,r)}function c(e,t,r,n){return o(0,0,2,i.kj(e,t+1,n))}function u(e,t,r,n){return o(0,0,3,i.X0(e,t+1,n))}function h(e,t,r,n){return o(0,0,5,i.Jl(e,t+1,n))}function l(e,t,r,n){const a=i.YX(e,t+1,n);if("bigint"==typeof a)throw new Error(`${s.IR} 64-bit integer map lengths not supported`);return o(0,0,9,a)}function f(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${s.IR} indefinite length items not allowed`);return o(0,0,1,1/0)}function d(e,t){i.Tp(e,n.D.map.majorEncoded,t.value)}d.compareTokens=i.Fh.compareTokens,d.encodedSize=function(e){return i.Tp.encodedSize(e.value)}},82428:function(e,t,r){"use strict";r.d(t,{CF:function(){return a},MV:function(){return u},ZR:function(){return o},qJ:function(){return s},vP:function(){return c},xy:function(){return h}});var n=r(59787),i=r(55580);function s(e,t,r,i){return new n.W(n.D.tag,r,1)}function o(e,t,r,s){return new n.W(n.D.tag,i.kj(e,t+1,s),2)}function a(e,t,r,s){return new n.W(n.D.tag,i.X0(e,t+1,s),3)}function c(e,t,r,s){return new n.W(n.D.tag,i.Jl(e,t+1,s),5)}function u(e,t,r,s){return new n.W(n.D.tag,i.YX(e,t+1,s),9)}function h(e,t){i.Tp(e,n.D.tag.majorEncoded,t.value)}h.compareTokens=i.Fh.compareTokens,h.encodedSize=function(e){return i.Tp.encodedSize(e.value)}},73851:function(e,t,r){"use strict";r.d(t,{GI:function(){return p},h1:function(){return h},mW:function(){return d},tA:function(){return g},vV:function(){return y},y7:function(){return l}});var n=r(59787),i=r(85590),s=r(55580);const o=20,a=21,c=22,u=23;function h(e,t,r,s){if(!1===s.allowUndefined)throw new Error(`${i.IR} undefined values are not supported`);return!0===s.coerceUndefinedToNull?new n.W(n.D.null,null,1):new n.W(n.D.undefined,void 0,1)}function l(e,t,r,s){if(!1===s.allowIndefinite)throw new Error(`${i.IR} indefinite length items not allowed`);return new n.W(n.D.break,void 0,1)}function f(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${i.IR} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${i.IR} Infinity values are not supported`)}return new n.W(n.D.float,e,t)}function d(e,t,r,n){return f(_(e,t+1),3,n)}function p(e,t,r,n){return f(k(e,t+1),5,n)}function y(e,t,r,n){return f(x(e,t+1),9,n)}function g(e,t,r){const i=t.value;if(!1===i)e.push([n.D.float.majorEncoded|o]);else if(!0===i)e.push([n.D.float.majorEncoded|a]);else if(null===i)e.push([n.D.float.majorEncoded|c]);else if(void 0===i)e.push([n.D.float.majorEncoded|u]);else{let t,n=!1;r&&!0===r.float64||(v(i),t=_(w,1),i===t||Number.isNaN(i)?(w[0]=249,e.push(w.slice(0,3)),n=!0):(E(i),t=k(w,1),i===t&&(w[0]=250,e.push(w.slice(0,5)),n=!0))),n||(s=i,b.setFloat64(0,s,!1),t=x(w,1),w[0]=251,e.push(w.slice(0,9)))}var s}g.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){v(r);let e=_(w,1);if(r===e||Number.isNaN(r))return 3;if(E(r),e=k(w,1),r===e)return 5}return 9};const m=new ArrayBuffer(9),b=new DataView(m,1),w=new Uint8Array(m,0);function v(e){if(e===1/0)b.setUint16(0,31744,!1);else if(e===-1/0)b.setUint16(0,64512,!1);else if(Number.isNaN(e))b.setUint16(0,32256,!1);else{b.setFloat32(0,e);const t=b.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)b.setUint16(0,31744,!1);else if(0===r)b.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?b.setUint16(0,0):e<-14?b.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):b.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function _(e,t){if(e.length-t<2)throw new Error(`${i.IR} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,s=1023&r;let o;return o=0===n?s*2**-24:31!==n?(s+1024)*2**(n-25):0===s?1/0:NaN,32768&r?-o:o}function E(e){b.setFloat32(0,e,!1)}function k(e,t){if(e.length-t<4)throw new Error(`${i.IR} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function x(e,t){if(e.length-t<8)throw new Error(`${i.IR} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}g.compareTokens=s.Fh.compareTokens},22042:function(e,t,r){"use strict";r.d(t,{BB:function(){return c},Dz:function(){return a},Pu:function(){return b},mL:function(){return u},nI:function(){return h},qu:function(){return p},tP:function(){return l},un:function(){return d},zo:function(){return f}});const n=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,i=new TextDecoder,s=new TextEncoder;function o(e){return n&&globalThis.Buffer.isBuffer(e)}function a(e){return e instanceof Uint8Array?o(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const c=n?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):g(e,t,r):(e,t,r)=>r-t>64?i.decode(e.subarray(t,r)):g(e,t,r),u=n?e=>e.length>64?globalThis.Buffer.from(e):y(e):e=>e.length>64?s.encode(e):y(e),h=e=>Uint8Array.from(e),l=n?(e,t,r)=>o(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),f=n?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),a(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},d=n?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function p(e,t){if(o(e)&&o(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function y(e,t=1/0){let r;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function g(e,t,r){const n=[];for(;t<r;){const i=e[t];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:i<128&&(s=i);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&i)<<6|63&r,c>127&&(s=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&i)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),t+=o}return b(n)}const m=4096;function b(e){const t=e.length;if(t<=m)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=m));return r}},85590:function(e,t,r){"use strict";r.d(t,{DO:function(){return o},IR:function(){return n},OO:function(){return i}});const n="CBOR decode error:",i="CBOR encode error:",s=[];function o(e,t,r){if(e.length-t<r)throw new Error(`${n} not enough data for type`)}s[23]=1,s[24]=2,s[25]=3,s[26]=5,s[27]=9},61287:function(e,t,r){"use strict";r.d(t,{Jx:function(){return l}});var n=r(85590),i=r(59787),s=r(25643);const o={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class a{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=s.PS[e];if(void 0===t){const r=s.cW[e];if(!r)throw new Error(`${n.IR} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=31&e;t=r(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}}const c=Symbol.for("DONE"),u=Symbol.for("BREAK");function h(e,t){if(e.done())return c;const r=e.next();if(r.type===i.D.break)return u;if(r.type.terminal)return r.value;if(r.type===i.D.array)return function(e,t,r){const i=[];for(let s=0;s<e.value;s++){const o=h(t,r);if(o===u){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed array`)}if(o===c)throw new Error(`${n.IR} found array but not enough entries (got ${s}, expected ${e.value})`);i[s]=o}return i}(r,e,t);if(r.type===i.D.map)return function(e,t,r){const i=!0===r.useMaps,s=i?void 0:{},o=i?new Map:void 0;for(let a=0;a<e.value;a++){const l=h(t,r);if(l===u){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed map`)}if(l===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(!0!==i&&"string"!=typeof l)throw new Error(`${n.IR} non-string keys not supported (got ${typeof l})`);if(!0===r.rejectDuplicateMapKeys&&(i&&o.has(l)||!i&&l in s))throw new Error(`${n.IR} found repeat map key "${l}"`);const f=h(t,r);if(f===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no value], expected ${e.value})`);i?o.set(l,f):s[l]=f}return i?o:s}(r,e,t);if(r.type===i.D.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=h(e,t);return t.tags[r.value](n)}throw new Error(`${n.IR} tag not supported (${r.value})`)}throw new Error("unsupported")}function l(e,t){if(!(e instanceof Uint8Array))throw new Error(`${n.IR} data to decode must be a Uint8Array`);const r=(t=Object.assign({},o,t)).tokenizer||new a(e,t),i=h(r,t);if(i===c)throw new Error(`${n.IR} did not find any content to decode`);if(i===u)throw new Error(`${n.IR} got unexpected break`);if(!r.done())throw new Error(`${n.IR} too many terminals, data makes no sense`);return i}},72696:function(e,t,r){"use strict";r.d(t,{cv:function(){return P},w$:function(){return C}});const n=["string","number","bigint","symbol"],i=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function s(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(n.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const r=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(i.includes(t))return t;return}(e);return r||"Object"}var o=r(59787),a=r(22042);class c{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=(0,a.un)(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=(0,a.tP)(r,0,this.cursor)}else t=(0,a.zo)(this.chunks,this.cursor);return e&&this.reset(),t}}var u=r(85590),h=r(25643),l=r(55580),f=r(53929),d=r(11560),p=r(50768),y=r(8278),g=r(59283),m=r(82428),b=r(73851),w=r(25108);const v={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const i=r.type.major,s=_[i].compareTokens(r,n);0===s&&w.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return s},quickEncodeToken:h.JN};const _=function(){const e=[];return e[o.D.uint.major]=l.Fh,e[o.D.negint.major]=f.UT,e[o.D.bytes.major]=d.hg,e[o.D.string.major]=p.YW,e[o.D.array.major]=y.HF,e[o.D.map.major]=g.KI,e[o.D.tag.major]=m.xy,e[o.D.float.major]=b.tA,e}(),E=new c;class k{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${u.OO} object contains circular references`);return new k(t,e)}}const x={null:new o.W(o.D.null,null),undefined:new o.W(o.D.undefined,void 0),true:new o.W(o.D.true,!0),false:new o.W(o.D.false,!1),emptyArray:new o.W(o.D.array,0),emptyMap:new o.W(o.D.map,0)},S={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new o.W(o.D.uint,e):new o.W(o.D.negint,e):new o.W(o.D.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new o.W(o.D.uint,e):new o.W(o.D.negint,e),Uint8Array:(e,t,r,n)=>new o.W(o.D.bytes,e),string:(e,t,r,n)=>new o.W(o.D.string,e),boolean:(e,t,r,n)=>e?x.true:x.false,null:(e,t,r,n)=>x.null,undefined:(e,t,r,n)=>x.undefined,ArrayBuffer:(e,t,r,n)=>new o.W(o.D.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new o.W(o.D.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[x.emptyArray,new o.W(o.D.break)]:x.emptyArray;n=k.createCheck(n,e);const i=[];let s=0;for(const t of e)i[s++]=A(t,r,n);return r.addBreakTokens?[new o.W(o.D.array,e.length),i,new o.W(o.D.break)]:[new o.W(o.D.array,e.length),i]},Object(e,t,r,n){const i="Object"!==t,s=i?e.keys():Object.keys(e),a=i?e.size:s.length;if(!a)return!0===r.addBreakTokens?[x.emptyMap,new o.W(o.D.break)]:x.emptyMap;n=k.createCheck(n,e);const c=[];let u=0;for(const t of s)c[u++]=[A(t,r,n),A(i?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(c,r),r.addBreakTokens?[new o.W(o.D.map,a),c,new o.W(o.D.break)]:[new o.W(o.D.map,a),c]}};S.Map=S.Object,S.Buffer=S.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))S[`${e}Array`]=S.DataView;function A(e,t={},r){const n=s(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||S[n];if("function"==typeof i){const s=i(e,n,t,r);if(null!=s)return s}const o=S[n];if(!o)throw new Error(`${u.OO} unsupported type: ${n}`);return o(e,n,t,r)}function I(e,t,r,n){if(Array.isArray(t))for(const i of t)I(e,i,r,n);else r[t.type.major](e,t,n)}function C(e,t,r){const n=A(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const i=t[n.type.major];if(i.encodedSize){const e=i.encodedSize(n,r),t=new c(e);if(i(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return(0,a.Dz)(t.chunks[0])}}return E.reset(),I(E,n,t,r),E.toBytes(!0)}function P(e,t){return t=Object.assign({},v,t),C(e,_,t)}},97223:function(e,t,r){"use strict";r.d(t,{d2:function(){return l},Jx:function(){return f},cv:function(){return u}});var n=r(59787),i=r(72696),s=r(85590),o=r(22042);class a extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===n.D.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===n.D.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[n.D.uint.major](e,t){this.prefix(e);const r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[n.D.negint.major](e,t){this[n.D.uint.major](e,t)}[n.D.bytes.major](e,t){throw new Error(`${s.OO} unsupported type: Uint8Array`)}[n.D.string.major](e,t){this.prefix(e);const r=(0,o.mL)(JSON.stringify(t.value));e.push(r.length>32?(0,o.Dz)(r):r)}[n.D.array.major](e,t){this.prefix(e),this.inRecursive.push({type:n.D.array,elements:0}),e.push([91])}[n.D.map.major](e,t){this.prefix(e),this.inRecursive.push({type:n.D.map,elements:0}),e.push([123])}[n.D.tag.major](e,t){}[n.D.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===n.D.array)e.push([93]);else{if(t.type!==n.D.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${s.OO} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const r=String(t.value),i=[];let o=!1;for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e),o||46!==i[e]&&101!==i[e]&&69!==i[e]||(o=!0);o||(i.push(46),i.push(48)),e.push(i)}}const c={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${s.OO} complex map keys are not supported`);const r=e[0],i=t[0];if(r.type!==n.D.string||i.type!==n.D.string)throw new Error(`${s.OO} non-string map keys are not supported`);if(r<i)return-1;if(r>i)return 1;throw new Error(`${s.OO} unexpected duplicate map keys, this is not supported`)}};function u(e,t){return t=Object.assign({},c,t),(0,i.w$)(e,new a,t)}var h=r(61287);class l{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${s.IR} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${s.IR} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,r=!1;const i=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this.pos++}};if(45===this.ch()&&(t=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new n.W(n.D.uint,0,this.pos-e);this.pos++,r=!0}if(i([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${s.IR} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(r)throw new Error(`${s.IR} unexpected token at position ${this.pos}`);r=!0,this.pos++,i([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,i([48,49,50,51,52,53,54,55,56,57]));const o=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),a=parseFloat(o);return r?new n.W(n.D.float,a,this.pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(a)?new n.W(a>=0?n.D.uint:n.D.negint,a,this.pos-e):new n.W(a>=0?n.D.uint:n.D.negint,BigInt(o),this.pos-e)}parseString(){if(34!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let e=this.pos,t=0;e<this.data.length&&t<65536;e++,t++){const r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){const r=String.fromCharCode.apply(null,this.data.subarray(this.pos,e));return this.pos=e+1,new n.W(n.D.string,r,t)}}const e=this.pos,t=[],r=()=>{if(this.pos+4>=this.data.length)throw new Error(`${s.IR} unexpected end of unicode escape sequence at position ${this.pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${s.IR} unexpected unicode escape character at position ${this.pos}`);t=t-65+10}e=16*e+t,this.pos++}return e},i=()=>{const e=this.ch();let r,n,i,o,a=null,c=e>239?4:e>223?3:e>191?2:1;if(this.pos+c>this.data.length)throw new Error(`${s.IR} unexpected unicode sequence at position ${this.pos}`);switch(c){case 1:e<128&&(a=e);break;case 2:r=this.data[this.pos+1],128==(192&r)&&(o=(31&e)<<6|63&r,o>127&&(a=o));break;case 3:r=this.data[this.pos+1],n=this.data[this.pos+2],128==(192&r)&&128==(192&n)&&(o=(15&e)<<12|(63&r)<<6|63&n,o>2047&&(o<55296||o>57343)&&(a=o));break;case 4:r=this.data[this.pos+1],n=this.data[this.pos+2],i=this.data[this.pos+3],128==(192&r)&&128==(192&n)&&128==(192&i)&&(o=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&i,o>65535&&o<1114112&&(a=o))}null===a?(a=65533,c=1):a>65535&&(a-=65536,t.push(a>>>10&1023|55296),a=56320|1023&a),t.push(a),this.pos+=c};for(;!this.done();){const a=this.ch();let c;switch(a){case 92:if(this.pos++,this.done())throw new Error(`${s.IR} unexpected string termination at position ${this.pos}`);switch(c=this.ch(),this.pos++,c){case 34:case 39:case 92:case 47:t.push(c);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${s.IR} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new n.W(n.D.string,(0,o.Pu)(t),this.pos-e);default:if(a<32)throw new Error(`${s.IR} invalid control character at position ${this.pos}`);a<128?(t.push(a),this.pos++):i()}}throw new Error(`${s.IR} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new n.W(n.D.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new n.W(n.D.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new n.W(n.D.null,null,4);case 102:return this.expect([102,97,108,115,101]),new n.W(n.D.false,!1,5);case 116:return this.expect([116,114,117,101]),new n.W(n.D.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${s.IR} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);if(44!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);if(44!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${s.IR} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function f(e,t){return t=Object.assign({tokenizer:new l(e,t)},t),(0,h.Jx)(e,t)}},25643:function(e,t,r){"use strict";r.d(t,{JN:function(){return b},PS:function(){return m},cW:function(){return g}});var n=r(59787),i=r(55580),s=r(53929),o=r(11560),a=r(50768),c=r(8278),u=r(59283),h=r(82428),l=r(73851),f=r(85590),d=r(22042);function p(e,t,r){throw new Error(`${f.IR} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function y(e){return()=>{throw new Error(`${f.IR} ${e}`)}}const g=[];for(let e=0;e<=23;e++)g[e]=p;g[24]=i.Km,g[25]=i.Zh,g[26]=i.cs,g[27]=i.uN,g[28]=p,g[29]=p,g[30]=p,g[31]=p;for(let e=32;e<=55;e++)g[e]=p;g[56]=s.yr,g[57]=s.r0,g[58]=s.wy,g[59]=s.ec,g[60]=p,g[61]=p,g[62]=p,g[63]=p;for(let e=64;e<=87;e++)g[e]=o.Ii;g[88]=o.UQ,g[89]=o.BS,g[90]=o.zU,g[91]=o.ME,g[92]=p,g[93]=p,g[94]=p,g[95]=y("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)g[e]=a.nt;g[120]=a.Bq,g[121]=a.h,g[122]=a.q0,g[123]=a.bc,g[124]=p,g[125]=p,g[126]=p,g[127]=y("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)g[e]=c.Ju;g[152]=c.h7,g[153]=c.OC,g[154]=c.lY,g[155]=c.a8,g[156]=p,g[157]=p,g[158]=p,g[159]=c.s5;for(let e=160;e<=183;e++)g[e]=u._K;g[184]=u.G,g[185]=u.qe,g[186]=u.IY,g[187]=u.F2,g[188]=p,g[189]=p,g[190]=p,g[191]=u.ng;for(let e=192;e<=215;e++)g[e]=h.qJ;g[216]=h.ZR,g[217]=h.CF,g[218]=h.vP,g[219]=h.MV,g[220]=p,g[221]=p,g[222]=p,g[223]=p;for(let e=224;e<=243;e++)g[e]=y("simple values are not supported");g[244]=p,g[245]=p,g[246]=p,g[247]=l.h1,g[248]=y("simple values are not supported"),g[249]=l.mW,g[250]=l.GI,g[251]=l.vV,g[252]=p,g[253]=p,g[254]=p,g[255]=l.y7;const m=[];for(let e=0;e<24;e++)m[e]=new n.W(n.D.uint,e,1);for(let e=-1;e>=-24;e--)m[31-e]=new n.W(n.D.negint,e,1);function b(e){switch(e.type){case n.D.false:return(0,d.nI)([244]);case n.D.true:return(0,d.nI)([245]);case n.D.null:return(0,d.nI)([246]);case n.D.bytes:return e.value.length?void 0:(0,d.nI)([64]);case n.D.string:return""===e.value?(0,d.nI)([96]):void 0;case n.D.array:return 0===e.value?(0,d.nI)([128]):void 0;case n.D.map:return 0===e.value?(0,d.nI)([160]):void 0;case n.D.uint:return e.value<24?(0,d.nI)([Number(e.value)]):void 0;case n.D.negint:if(e.value>=-24)return(0,d.nI)([31-Number(e.value)])}}m[64]=new n.W(n.D.bytes,new Uint8Array(0),1),m[96]=new n.W(n.D.string,"",1),m[128]=new n.W(n.D.array,0,1),m[160]=new n.W(n.D.map,0,1),m[244]=new n.W(n.D.false,!1,1),m[245]=new n.W(n.D.true,!0,1),m[246]=new n.W(n.D.null,null,1)},59787:function(e,t,r){"use strict";r.d(t,{D:function(){return n},W:function(){return i}});class n{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}n.uint=new n(0,"uint",!0),n.negint=new n(1,"negint",!0),n.bytes=new n(2,"bytes",!0),n.string=new n(3,"string",!0),n.array=new n(4,"array",!1),n.map=new n(5,"map",!1),n.tag=new n(6,"tag",!1),n.float=new n(7,"float",!0),n.false=new n(7,"false",!0),n.true=new n(7,"true",!0),n.null=new n(7,"null",!0),n.undefined=new n(7,"undefined",!0),n.break=new n(7,"break",!0);class i{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}},84296:function(e,t,r){"use strict";r.r(t),r.d(t,{code:function(){return d},decode:function(){return b},encode:function(){return m},name:function(){return f},toGeneral:function(){return g}});var n=r(99382);function i(e){return n.base64url.encode(e).slice(1)}function s(e){return n.base64url.decode(`u${e}`)}var o=r(38161);function a(e){const t={signature:s(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=s(e.protected)),t}function c(e){const t={signature:i(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=i(e.protected)),t}function u(e){const t={};return e.encrypted_key&&(t.encrypted_key=s(e.encrypted_key)),e.header&&(t.header=e.header),t}function h(e){const t={};return e.encrypted_key&&(t.encrypted_key=i(e.encrypted_key)),e.header&&(t.header=e.header),t}var l=r(90560);const f="dag-jose",d=133;function p(e){return"payload"in e&&"string"==typeof e.payload&&"signatures"in e&&Array.isArray(e.signatures)}function y(e){return"ciphertext"in e&&"string"==typeof e.ciphertext&&"iv"in e&&"string"==typeof e.iv&&"protected"in e&&"string"==typeof e.protected&&"tag"in e&&"string"==typeof e.tag}function g(e){if("string"==typeof e){const t=e.split(".");if(3===t.length)return function(e){const[t,r,n]=e;return{payload:r,signatures:[{protected:t,signature:n}],link:o.k0.decode(s(r))}}(t);if(5===t.length)return function(e){const[t,r,n,i,s]=e,o={ciphertext:i,iv:n,protected:t,tag:s};return r&&(o.recipients=[{encrypted_key:r}]),o}(t);throw new Error("Not a valid JOSE string")}if(p(e)||y(e))return e;throw new Error("Not a valid unencoded JOSE object")}function m(e){let t;if("string"==typeof e&&(e=g(e)),p(e))t=function(e){const t=s(e.payload);try{o.k0.decode(t)}catch(e){throw new Error("Not a valid DagJWS")}return{payload:t,signatures:e.signatures.map(a)}}(e);else{if(!y(e))throw new Error("Not a valid JOSE object");t=function(e){const t={ciphertext:s(e.ciphertext),protected:s(e.protected),iv:s(e.iv),tag:s(e.tag)};return e.aad&&(t.aad=s(e.aad)),e.recipients&&(t.recipients=e.recipients.map(u)),e.unprotected&&(t.unprotected=e.unprotected),t}(e)}return new Uint8Array(l.encode(t))}function b(e){let t;try{t=l.decode(e)}catch(e){throw new Error("Not a valid DAG-JOSE object")}if("payload"in(r=t)&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures))return function(e){const t={payload:i(e.payload),signatures:e.signatures.map(c)};return t.link=o.k0.decode(new Uint8Array(e.payload)),t}(t);if(function(e){return"ciphertext"in e&&e.ciphertext instanceof Uint8Array&&"iv"in e&&e.iv instanceof Uint8Array&&"protected"in e&&e.protected instanceof Uint8Array&&"tag"in e&&e.tag instanceof Uint8Array}(t))return function(e){const t={ciphertext:i(e.ciphertext),protected:i(e.protected),iv:i(e.iv),tag:i(e.tag)};return e.aad&&(t.aad=i(e.aad)),e.recipients&&(t.recipients=e.recipients.map(h)),e.unprotected&&(t.unprotected=e.unprotected),t}(t);throw new Error("Not a valid DAG-JOSE object");var r}},54589:function(e,t,r){"use strict";r.d(t,{e:function(){return u}});var n=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);},i=r(75671);var s=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,i.Z)(e),{value:n,done:s}=r.next();if(!0===s)return function*(){}();const o=t(n);if("function"==typeof o.then)return async function*(){await o&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const a=t;return function*(){!0===o&&(yield n);for(const e of r)a(e)&&(yield e)}()};var o=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t};var a=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const r=await o(e);yield*r.sort(t)}():function*(){const r=o(e);yield*r.sort(t)}()};var c=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}():function*(){let r=0;if(!(t<1))for(const n of e)if(yield n,r++,r===t)return}()};class u{put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield r}async*getMany(e,t={}){for await(const r of e)yield{key:r,value:await this.get(r,t)}}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await n(this.putMany(e,r)),e=[],await n(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix){const t=e.prefix;r=s(r,(e=>e.key.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>s(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){let t=0;const n=e.offset;r=s(r,(()=>t++>=n))}return null!=e.limit&&(r=c(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix){const t=e.prefix;r=s(r,(e=>e.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>s(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){const t=e.offset;let n=0;r=s(r,(()=>n++>=t))}return null!=e.limit&&(r=c(r,e.limit)),r}}},66801:function(e,t,r){"use strict";r.r(t),r.d(t,{abortedError:function(){return u},dbDeleteFailedError:function(){return s},dbOpenFailedError:function(){return i},dbReadFailedError:function(){return a},dbWriteFailedError:function(){return o},notFoundError:function(){return c}});var n=r(32114);function i(e){return e=e??new Error("Cannot open database"),n(e,"ERR_DB_OPEN_FAILED")}function s(e){return e=e??new Error("Delete failed"),n(e,"ERR_DB_DELETE_FAILED")}function o(e){return e=e??new Error("Write failed"),n(e,"ERR_DB_WRITE_FAILED")}function a(e){return e=e??new Error("Read failed"),n(e,"ERR_DB_READ_FAILED")}function c(e){return e=e??new Error("Not Found"),n(e,"ERR_NOT_FOUND")}function u(e){return e=e??new Error("Aborted"),n(e,"ERR_ABORTED")}},32651:function(e,t,r){"use strict";r.d(t,{eF:function(){return o.e},D1:function(){return n},ar:function(){return a.a}});var n=r(66801),i=r(88309);const s="SHARDING";var o=r(54589),a=r(92291);r(32629);new i.s(s);class c extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}var u=r(11227);var h=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);class l{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class f{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return p(this,e)}}class d{constructor(e){this.decoders=e}or(e){return p(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const p=(e,t)=>new d({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class y{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new l(e,t,r),this.decoder=new f(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const g=({name:e,prefix:t,encode:r,decode:n})=>new y(e,t,r,n),m=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=h(r,t);return g({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},b=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>g({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),w=b({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),v=(b({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),b({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),b({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),b({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),b({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),b({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),b({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),b({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),m({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"})),_=(m({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),b({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}));b({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),b({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});u.formatters.b=e=>null==e?"undefined":v.baseEncode(e),u.formatters.t=e=>null==e?"undefined":w.baseEncode(e),u.formatters.m=e=>null==e?"undefined":_.baseEncode(e),u.formatters.p=e=>null==e?"undefined":e.toString(),u.formatters.c=e=>null==e?"undefined":e.toString(),u.formatters.k=e=>null==e?"undefined":e.toString(),u.formatters.a=e=>null==e?"undefined":e.toString();!function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);u.enabled(`${e}:trace`)&&null!=u.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=u(`${e}:trace`)),Object.assign(u(e),{error:u(`${e}:error`),trace:t})}("datastore:core:tiered")},92291:function(e,t,r){"use strict";r.d(t,{a:function(){return o}});var n=r(88309),i=r(54589),s=r(66801);class o extends i.e{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){const t=this.data.get(e.toString());if(null==t)throw s.notFoundError();return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(const[e,t]of this.data.entries())yield{key:new n.s(e),value:t}}*_allKeys(){for(const e of this.data.keys())yield new n.s(e)}}},88309:function(e,t,r){"use strict";r.d(t,{s:function(){return u}});var n=r(53416),i=r(77408),s=r(49784);const o="/",a=(new TextEncoder).encode(o),c=a[0];class u{_buf;constructor(e,t){if("string"==typeof e)this._buf=(0,i.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==c)throw new Error("Invalid key")}toString(e="utf8"){return(0,s.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new u(e.join(o))}static random(){return new u((0,n.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new u(e):"function"==typeof e.uint8Array?new u(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=a),this._buf[0]!==c){const e=new Uint8Array(this._buf.byteLength+1);e.fill(c,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===c;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return u.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(o).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new u(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(o)||(e+=o),e+=this.type(),new u(e)}parent(){const e=this.list();return 1===e.length?new u(o):new u(e.slice(0,-1).join(o))}child(e){return this.toString()===o?e:e.toString()===o?this:new u(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return u.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}},55472:function(e,t,r){"use strict";r.d(t,{s:function(){return g}});var n=r(32651),i=r(4424),s=r(53416),o=r(49784),a=r(77408);const c="/",u=(new TextEncoder).encode(c),h=u[0];class l{constructor(e,t){if("string"==typeof e)this._buf=(0,a.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==h)throw new Error("Invalid key")}toString(e="utf8"){return(0,o.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new l(e.join(c))}static random(){return new l((0,s.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new l(e):"function"==typeof e.uint8Array?new l(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=u),this._buf[0]!==h){const e=new Uint8Array(this._buf.byteLength+1);e.fill(h,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===h;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return l.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(c).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new l(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(c)||(e+=c),e+=this.type(),new l(e)}parent(){const e=this.list();return 1===e.length?new l(c):new l(e.slice(0,-1).join(c))}child(e){return this.toString()===c?e:e.toString()===c?this:new l(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return l.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}var f=r(75671);var d=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,f.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){await s&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===s&&(yield n);for(const e of r)o(e)&&(yield e)}()};var p=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t};var y=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const r=await p(e);yield*r.sort(t)}():function*(){const r=p(e);yield*r.sort(t)}()};class g extends n.eF{location;version;db;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1}async open(){try{const e=this.location;this.db=await(0,i.X3)(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw n.D1.dbOpenFailedError(e)}}async close(){this.db?.close()}async put(e,t){if(null==this.db)throw new Error("Datastore needs to be opened.");try{return await this.db.put(this.location,t,e.toString()),e}catch(e){throw n.D1.dbWriteFailedError(e)}}async get(e){if(null==this.db)throw new Error("Datastore needs to be opened.");let t;try{t=await this.db.get(this.location,e.toString())}catch(e){throw n.D1.dbReadFailedError(e)}if(void 0===t)throw n.D1.notFoundError();return t}async has(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return Boolean(await this.db.getKey(this.location,e.toString()))}catch(e){throw n.D1.dbReadFailedError(e)}}async delete(e){if(null==this.db)throw new Error("Datastore needs to be opened.");try{await this.db.delete(this.location,e.toString())}catch(e){throw n.D1.dbWriteFailedError(e)}}batch(){const e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async()=>{if(null==this.db)throw new Error("Datastore needs to be opened.");const r=this.db.transaction(this.location,"readwrite");try{const n=e.filter((({key:e})=>null==t.find((t=>t.toString()===e.toString())))).map((e=>async()=>{await r.store.put(e.value,e.key.toString())})).concat(t.map((e=>async()=>{await r.store.delete(e.toString())}))).concat((async()=>{await r.done}));await Promise.all(n.map((async e=>{await e()})))}catch{r.abort()}}}}async*query(e){let t=this.#r(e,((e,t)=>({key:e,value:t})));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>d(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>y(e,t)),t)),yield*t}async*queryKeys(e){let t=this.#r(e,(e=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>d(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>y(e,t)),t)),yield*t}async*#r(e,t){if(null==this.db)throw new Error("Datastore needs to be opened.");let r=0,n=-1;for(const i of await this.db.getAllKeys(this.location)){if(null!=e.prefix&&!i.toString().startsWith(e.prefix))continue;if(null!=e.limit&&r===e.limit)return;if(n++,null!=e.offset&&n<e.offset)continue;const s=new l(i.toString());let o;try{o=await this.get(s)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e;continue}null!=o&&(yield t(s,o),r++)}}async destroy(){await(0,i.Lj)(this.location)}}},12460:function(e,t,r){"use strict";r.d(t,{k:function(){return y}});var n=r(64348),i=r(32114);function s(e){return e=e||new Error("Write failed"),i(e,"ERR_DB_WRITE_FAILED")}r(66699);const o="SHARDING";const a=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();var c=r(93361),u=r(44752),h=r(56635);class l{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,c.Z)(this.putMany(e,r)),e=[],await(0,c.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,u.Z)(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){let t=0;r=(0,u.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,h.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,u.Z)(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){let t=0;r=(0,u.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,h.Z)(r,e.limit)),r}}new n.s(o),new n.s("_README");(0,r(69860).kg)("datastore:core:tiered");var f=r(21007),d=r(34751),p=r(21301);class y extends l{constructor(e,t={}){super(),this.db="string"==typeof e?new p.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw function(e){return e=e||new Error("Cannot open database"),i(e,"ERR_DB_OPEN_FAILED")}(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(e){throw s(e)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(e){if(e.notFound)throw function(e){return e=e||new Error("Not Found"),i(e,"ERR_NOT_FOUND")}(e);throw s(e)}return t}async has(e){try{await this.db.get(e.toString())}catch(e){if(e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(e.toString())}catch(e){throw function(e){return e=e||new Error("Delete failed"),i(e,"ERR_DB_DELETE_FAILED")}(e)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,r)=>{e.push({type:"put",key:t.toString(),value:r})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,d.Z)(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=(0,u.Z)(t,(()=>e++>=r))}return n&&(t=(0,h.Z)(t,n)),t}queryKeys(e){let t=(0,f.Z)(this._query({values:!1,prefix:e.prefix}),(({key:e})=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,d.Z)(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=(0,u.Z)(t,(()=>e++>=r))}return n&&(t=(0,h.Z)(t,n)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const r=e.prefix.toString();t.gte=r,t.lt=r+"ÿ"}const r=this.db.iterator(t);if(r[Symbol.asyncIterator])return async function*(e){for await(const[t,r]of e)yield{key:new n.s(t,!1),value:r};await e.close()}(r);if(null!=r.next&&null!=r.end)return i=r,{[Symbol.asyncIterator]:()=>({next:()=>new Promise(((e,t)=>{i.next(((r,s,o)=>r?t(r):null==s?i.end((r=>{if(r)return t(r);e({done:!0,value:void 0})})):void e({done:!1,value:{key:new n.s(s,!1),value:o}})))})),return:()=>new Promise(((e,t)=>{i.end((r=>{if(r)return t(r);e({done:!0,value:void 0})}))}))})};var i;throw new Error("Level returned incompatible iterator")}}},61711:function(e,t,r){"use strict";r.d(t,{R:function(){return w}});var n=r(64348);r(32114);r(66699);const i="SHARDING";const s=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();var o=r(93361),a=r(44752),c=r(56635);class u{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,o.Z)(this.putMany(e,r)),e=[],await(0,o.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,a.Z)(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,a.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>s(e,t)),r)),null!=e.offset){let t=0;r=(0,a.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,c.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,a.Z)(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,a.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>s(e,t)),r)),null!=e.offset){let t=0;r=(0,a.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,c.Z)(r,e.limit)),r}}new n.s(i),new n.s("_README");var h=r(69860);(0,h.kg)("datastore:core:tiered");var l=r(52770),f=r(49784),d=r(77408);const p="/record/";function y(e){return(0,f.B)(e,"base32")}function g(e){("string"==typeof e||e instanceof String)&&(e=(0,d.m)(e.toString()));const t=(0,f.B)(e,"base64url");return`${p}${t}`}var m=r(73062);const b=(0,h.kg)("datastore-pubsub:publisher");class w extends u{constructor(e,t,r,n,i,s){if(super(),!n)throw new l.s("missing validator","ERR_INVALID_PARAMETERS");if("function"!=typeof n)throw new l.s("missing validate function","ERR_INVALID_PARAMETERS");if("function"!=typeof i)throw new l.s("missing select function","ERR_INVALID_PARAMETERS");if(s&&"function"!=typeof s)throw new l.s("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=r,this._validator=n,this._selector=i,this._handleSubscriptionKeyFn=s,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,r){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw b.error(e),new l.s(e,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){const e="received value is not a Uint8Array";throw b.error(e),new l.s(e,"ERR_INVALID_VALUE_RECEIVED")}const n=g(e);b(`publish value for topic ${n}`),await this._pubsub.publish(n,t)}async get(e,t){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw b.error(e),new l.s(e,"ERR_INVALID_DATASTORE_KEY")}const r=g(e),n=await this._pubsub.getTopics();if(n&&Array.isArray(n)&&n.indexOf(r)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(r)}catch(e){const t=`cannot subscribe topic ${r}`;throw b.error(t),new l.s(t,"ERR_SUBSCRIBING_TOPIC")}return b(`subscribed values for key ${r}`),this._getLocal(e)}unsubscribe(e){const t=g(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){const r=new n.s("/"+y(e),!1);let i;try{i=await this._datastore.get(r,t)}catch(e){if("ERR_NOT_FOUND"!==e.code){const e=`unexpected error getting the ipns record for ${r.toString()}`;throw b.error(e),new l.s(e,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const t=`local record requested was not found for ${r.toString()}`;throw b.error(t),new l.s(t,"ERR_NOT_FOUND")}if(!(i instanceof Uint8Array)){const e="found record that we couldn't convert to a value";throw b.error(e),new l.s(e,"ERR_INVALID_RECORD_RECEIVED")}return i}async _onMessage(e){const t=e.detail;if("signed"!==t.type)return void b.error("unsigned message received, this module can only work with signed messages");const{data:r,from:n,topic:i}=t;let s;try{s=function(e){if(e.substring(0,p.length)!==p)throw new l.s("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");const t=e.substring(p.length);return(0,d.m)(t,"base64url")}(i)}catch(e){return void b.error(e)}if(b(`message received for topic ${i}`),this._peerId.equals(n))b("message discarded as it is from the same peer");else{if(this._handleSubscriptionKeyFn){let e;try{e=await this._handleSubscriptionKeyFn(s)}catch(e){return void b.error("message discarded by the subscriptionKeyFn")}s=e}try{await this._storeIfSubscriptionIsBetter(s,r)}catch(e){b.error(e)}}}async _storeIfSubscriptionIsBetter(e,t,r){let n=!1;try{n=await this._isBetter(e,t)}catch(e){if("ERR_NOT_VALID_RECORD"!==e.code)throw e}n&&await this._storeRecord(e,t,r)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return 0===await this._selector(e,t)}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch(e){const t="record received through pubsub is not valid";throw b.error(t),new l.s(t,"ERR_NOT_VALID_RECORD")}const r=new n.s(e);let i;try{i=await this._getLocal(r.uint8Array())}catch(e){return!0}return!(0,m.f)(i,t)&&this._selectRecord(e,[i,t])}async _storeRecord(e,t,r){const i=new n.s("/"+y(e),!1);await this._datastore.put(i,t,r),b(`record for ${g(e)} was stored in the datastore`)}}},41309:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(11227),i=r(73692);const s=globalThis.fetch,o=globalThis.Headers;globalThis.Request,globalThis.Response;function a(e,t,r){return`${e}?name=${t}&type=${r}`}async function c(e,t){const r=await s(e,{headers:new o({accept:"application/dns-json"}),signal:t});return await r.json()}function u(e,t){return`${t}_${e}`}const h=Object.assign(n("dns-over-http-resolver"),{error:n("dns-over-http-resolver:error")});var l=class{constructor(e={}){this._cache=new i({max:e?.maxCache??100}),this._TXTcache=new i({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??c,this._abortControllers=[]}cancel(){this._abortControllers.forEach((e=>e.abort()))}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*t),n=e[t];e[t]=e[r],e[r]=n}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",r=this._cache.get(u(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(a(r,e,t),i.signal),s=n.Answer.map((e=>e.data)),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._cache.set(u(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),h.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",r=this._cache.get(u(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(a(r,e,t),i.signal),s=n.Answer.map((e=>e.data)),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._cache.set(u(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),h.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",r=this._TXTcache.get(u(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(a(r,e,t),i.signal),s=n.Answer.map((e=>[e.data.replace(/['"]+/g,"")])),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._TXTcache.set(u(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),h.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}},85965:function(e,t,r){"use strict";r.d(t,{sk:function(){return G},Vq:function(){return E},Y3:function(){return F},Qc:function(){return H}});const n=Object.create(null);n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const i=Object.create(null);Object.keys(n).forEach((e=>{i[n[e]]=e}));const s={type:"error",data:"parser error"},o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,c=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};var u=({type:e,data:t},r,i)=>{return o&&t instanceof Blob?r?i(t):c(t,i):a&&(t instanceof ArrayBuffer||(s=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer))?r?i(t):c(new Blob([t]),i):i(n[e]+(t||""));var s};const h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<h.length;e++)l[h.charCodeAt(e)]=e;const f="function"==typeof ArrayBuffer,d=(e,t)=>{if(f){const r=(e=>{let t,r,n,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const u=new ArrayBuffer(o),h=new Uint8Array(u);for(t=0;t<a;t+=4)r=l[e.charCodeAt(t)],n=l[e.charCodeAt(t+1)],i=l[e.charCodeAt(t+2)],s=l[e.charCodeAt(t+3)],h[c++]=r<<2|n>>4,h[c++]=(15&n)<<4|i>>2,h[c++]=(3&i)<<6|63&s;return u})(e);return p(r,t)}return{base64:!0,data:e}},p=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e;var y=(e,t)=>{if("string"!=typeof e)return{type:"message",data:p(e,t)};const r=e.charAt(0);if("b"===r)return{type:"message",data:d(e.substring(1),t)};return i[r]?e.length>1?{type:i[r],data:e.substring(1)}:{type:i[r]}:s};const g=String.fromCharCode(30);var m=r(99748);const b="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function w(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const v=b.setTimeout,_=b.clearTimeout;function E(e,t){t.useNativeTimers?(e.setTimeoutFn=v.bind(b),e.clearTimeoutFn=_.bind(b)):(e.setTimeoutFn=b.setTimeout.bind(b),e.clearTimeoutFn=b.clearTimeout.bind(b))}class k extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class x extends m.Q{constructor(e){super(),this.writable=!1,E(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new k(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=y(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const S="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),A=64,I={};let C,P=0,T=0;function D(e){let t="";do{t=S[e%A]+t,e=Math.floor(e/A)}while(e>0);return t}function R(){const e=D(+new Date);return e!==C?(P=0,C=e):e+"."+D(P++)}for(;T<A;T++)I[S[T]]=T;function B(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}let M=!1;try{M="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const O=M;function N(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||O))return new XMLHttpRequest}catch(e){}if(!t)try{return new(b[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function L(){}const U=null!=new N({xdomain:!1}).responseType;class j extends m.Q{constructor(e,t){super(),E(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=w(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new N(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=j.requestsCount++,j.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=L,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete j.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(j.requestsCount=0,j.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",z);else if("function"==typeof addEventListener){addEventListener("onpagehide"in b?"pagehide":"unload",z,!1)}function z(){for(let e in j.requests)j.requests.hasOwnProperty(e)&&j.requests[e].abort()}const F="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),K=b.WebSocket||b.MozWebSocket;r(23085).lW;const $="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const V={websocket:class extends x{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=$?{}:w(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=$?new K(e,t,r):t?new K(e,t):new K(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;u(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&F((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=R()),this.supportsBinary||(e.b64=1);const n=B(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!K}},polling:class extends x{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=U&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(g),n=[];for(let e=0;e<r.length;e++){const i=y(r[e],t);if(n.push(i),"error"===i.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let i=0;e.forEach(((e,s)=>{u(e,!1,(e=>{n[s]=e,++i===r&&t(n.join(g))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=R()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=B(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new j(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},W=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,q=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function H(e){const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let i=W.exec(e||""),s={},o=14;for(;o--;)s[q[o]]=i[o]||"";return-1!=r&&-1!=n&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,s.path),s.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,s.query),s}class G extends m.Q{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=H(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=H(t.host).host),E(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new V[e](r)}open(){let e;if(this.opts.rememberUpgrade&&G.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;G.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;G.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){r||(r=!0,u(),t.close(),t=null)}const s=e=>{const r=new Error("probe error: "+e);r.transport=t.name,i(),this.emitReserved("upgradeError",r)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){t&&e.name!==t.name&&i()}const u=()=>{t.removeListener("open",n),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",G.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){G.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}G.protocol=4;G.protocol},50145:function(e,t,r){"use strict";r.d(t,{pM:function(){return c}});r(58090);var n=r(48764),i=r(33606),s=r(4850);const o={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4};var a=r(1900);async function c(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(t?.length>1)return h(s.FY(t))}function u(e,t,r){r={offset:0,...r};for(const[n,i]of t.entries())if(r.mask){if(i!==(r.mask[n]&e[n+r.offset]))return!1}else if(i!==e[n+r.offset])return!1;return!0}async function h(e){try{return(new l).parse(e)}catch(e){if(!(e instanceof s.dL))throw e}}class l{check(e,t){return u(this.buffer,e,t)}checkString(e,t){return this.check((r=e,[...r].map((e=>e.charCodeAt(0)))),t);var r}async parse(e){if(this.buffer=n.Buffer.alloc(4100),void 0===e.fileInfo.size&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.parse(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const t=await e.readToken(o);return e.position+t>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(t),h(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===this.buffer[0]||70===this.buffer[0])&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(this.buffer,{length:30});const r={compressedSize:this.buffer.readUInt32LE(18),uncompressedSize:this.buffer.readUInt32LE(22),filenameLength:this.buffer.readUInt16LE(26),extraFieldLength:this.buffer.readUInt16LE(28)};if(r.filename=await e.readToken(new i.uW(r.filenameLength,"utf-8")),await e.ignore(r.extraFieldLength),"META-INF/mozilla.rsa"===r.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(r.filename.endsWith(".rels")||r.filename.endsWith(".xml")){switch(r.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}}if(r.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(r.filename.startsWith("3D/")&&r.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===r.filename&&r.compressedSize===r.uncompressedSize){let a=await e.readToken(new i.uW(r.compressedSize,"utf-8"));switch(a=a.trim(),a){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}}if(0===r.compressedSize){let c=-1;for(;c<0&&e.position<e.fileInfo.size;)await e.peekBuffer(this.buffer,{mayBeLess:!0}),c=this.buffer.indexOf("504B0304",0,"hex"),await e.ignore(c>=0?c:this.buffer.length)}else await e.ignore(r.compressedSize)}}catch(l){if(!(l instanceof s.dL))throw l}return{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const f=n.Buffer.alloc(8);return await e.readBuffer(f),u(f,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:u(f,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:u(f,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:u(f,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:u(f,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:u(f,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(3===this.buffer[2]||5===this.buffer[2]||7===this.buffer[2])&&(4===this.buffer[3]||6===this.buffer[3]||8===this.buffer[3]))return{ext:"zip",mime:"application/zip"};if(this.checkString("ftyp",{offset:4})&&0!=(96&this.buffer[8])){const d=this.buffer.toString("binary",8,12).replace("\0"," ").trim();switch(d){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return d.startsWith("3g")?d.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF")){try{await e.ignore(1350);const p=10485760,y=n.Buffer.alloc(Math.min(p,e.fileInfo.size));if(await e.readBuffer(y,{mayBeLess:!0}),y.includes(n.Buffer.from("AIPrivateData")))return{ext:"ai",mime:"application/postscript"}}catch(g){if(!(g instanceof s.dL))throw g}return{ext:"pdf",mime:"application/pdf"}}if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const m=await this.readTiffHeader(!1);if(m)return m}if(this.check([77,77])){const b=await this.readTiffHeader(!0);if(b)return b}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function w(){const t=await e.peekNumber(i.fB);let r=128,s=0;for(;0==(t&r)&&0!==r;)++s,r>>=1;const o=n.Buffer.alloc(s+1);return await e.readBuffer(o),o}async function v(){const e=await w(),t=await w();t[0]^=128>>t.length-1;const r=Math.min(6,t.length);return{id:e.readUIntBE(0,e.length),len:t.readUIntBE(t.length-r,r)}}async function _(t){for(;t>0;){const r=await v();if(17026===r.id){return(await e.readToken(new i.uW(r.len,"utf-8"))).replace(/\00.*$/g,"")}await e.ignore(r.len),--t}}const E=await v();switch(await _(E.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(this.check([82,73,70,70])){if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1"))return{ext:"parquet",mime:"application/x-parquet"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(0===this.buffer[6]||1===this.buffer[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const k=this.buffer.toString("binary",2,6);if(k.match("^d*")&&k>=1e3&&k<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>")){await e.ignore(8);return"debian-binary"===await e.readToken(new i.uW(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"}}if(this.checkString("**ACE",{offset:7})&&(await e.peekBuffer(this.buffer,{length:14,mayBeLess:!0}),this.checkString("**",{offset:12})))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.check([137,80,78,71,13,10,26,10])){async function x(){return{length:await e.readToken(i.ZW),type:await e.readToken(new i.uW(4,"binary"))}}await e.ignore(8);do{const S=await x();if(S.length<0)return;switch(S.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(S.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function A(){const t=n.Buffer.alloc(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(i.zR))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const I=await A();let C=I.size-24;if(u(I.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const P=n.Buffer.alloc(16);if(C-=await e.readBuffer(P),u(P,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(u(P,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(C)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10])){await e.ignore(20);switch(await e.readToken(new i.uW(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const T=this.buffer.readUInt32LE(12);if(T>12&&this.buffer.length>=T+16)try{const D=this.buffer.slice(16,T+16).toString();if(JSON.parse(D).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),function(e,t=0){const r=Number.parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(r))return!1;let n=256;for(let r=t;r<t+148;r++)n+=e[r];for(let r=t+156;r<t+512;r++)n+=e[r];return r===n}(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(this.buffer.length>=2&&this.check([255,224],{offset:0,mask:[255,224]})){if(this.check([16],{offset:1,mask:[22]}))return this.check([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}async readTiffTag(e){const t=await this.tokenizer.readToken(e?i.US:i.p);switch(this.tokenizer.ignore(10),t){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?i.US:i.p);for(let r=0;r<t;++r){const t=await this.readTiffTag(e);if(t)return t}}async readTiffHeader(e){const t=(e?i.US:i.p).get(this.buffer,2),r=(e?i.jj:i.xW).get(this.buffer,4);if(42===t){if(r>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r>=8&&(this.check([28,0,254,0],{offset:8})||this.check([31,0,11,0],{offset:8})))return{ext:"nef",mime:"image/x-nikon-nef"}}await this.tokenizer.ignore(r);return await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(43===t)return{ext:"tif",mime:"image/tiff"}}}new Set(a.R),new Set(a.a)},78699:function(e,t,r){"use strict";r.d(t,{g6:function(){return w}});const n={parse:JSON.parse,stringify:JSON.stringify};var i=r(51268),s=r(40804),o=r(53458);const a=e=>i(e)||null!==e&&"object"==typeof e&&"function"==typeof e.pipe;var c=(e,t,r,i=n)=>{const{clone:c,files:u}=s({query:e,variables:t,operationName:r},"",a);if(0===u.size){if(!Array.isArray(e))return i.stringify(c);if(void 0!==t&&!Array.isArray(t))throw new Error("Cannot create request body with given variable type, array expected");const r=e.reduce(((e,r,n)=>(e.push({query:r,variables:t?t[n]:void 0}),e)),[]);return i.stringify(r)}const h=new("undefined"==typeof FormData?o:FormData);h.append("operations",i.stringify(c));const l={};let f=0;return u.forEach((e=>{l[++f]=e})),h.append("map",i.stringify(l)),f=0,u.forEach(((e,t)=>{h.append(""+ ++f,t)})),h};var u=r(25202),h=r(77404);const l=e=>{let t;const r=e.definitions.filter((e=>"OperationDefinition"===e.kind));return 1===r.length&&(t=r[0]?.name?.value),t},f=e=>{if("string"==typeof e){let t;try{const r=(0,u.Qc)(e);t=l(r)}catch(e){}return{query:e,operationName:t}}const t=l(e);return{query:(0,h.S)(e),operationName:t}};class d extends Error{constructor(e,t){super(`${d.extractMessage(e)}: ${JSON.stringify({response:e,request:t})}`),Object.setPrototypeOf(this,d.prototype),this.response=e,this.request=t,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,d)}static extractMessage(e){return e.errors?.[0]?.message??`GraphQL Error (Code: ${e.status})`}}var p=r(74077),y=r.t(p,2);r(25108);const g=e=>{let t={};return e&&("undefined"!=typeof Headers&&e instanceof Headers||y&&p.Headers&&e instanceof p.Headers?t=(e=>{const t={};return e.forEach(((e,r)=>{t[r]=e})),t})(e):Array.isArray(e)?e.forEach((([e,r])=>{e&&void 0!==r&&(t[e]=r)})):t=e),t},m=e=>e.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),b=e=>async t=>{const{url:r,query:i,variables:s,operationName:o,fetch:a,fetchOptions:u,middleware:h}=t,l={...t.headers};let f,d="";"POST"===e?(f=c(i,s,o,u.jsonSerializer),"string"==typeof f&&(l["Content-Type"]="application/json")):d=(e=>{if(!Array.isArray(e.query)){const t=e,r=[`query=${encodeURIComponent(m(t.query))}`];return e.variables&&r.push(`variables=${encodeURIComponent(t.jsonSerializer.stringify(t.variables))}`),t.operationName&&r.push(`operationName=${encodeURIComponent(t.operationName)}`),r.join("&")}if(void 0!==e.variables&&!Array.isArray(e.variables))throw new Error("Cannot create query with given variable type, array expected");const t=e,r=e.query.reduce(((e,r,n)=>(e.push({query:m(r),variables:t.variables?t.jsonSerializer.stringify(t.variables[n]):void 0}),e)),[]);return`query=${encodeURIComponent(t.jsonSerializer.stringify(r))}`})({query:i,variables:s,operationName:o,jsonSerializer:u.jsonSerializer??n});const p={method:e,headers:l,body:f,...u};let y=r,g=p;if(h){const e=await Promise.resolve(h({...p,url:r,operationName:o,variables:s})),{url:t,...n}=e;y=t,g=n}return d&&(y=`${y}?${d}`),await a(y,g)};class w{constructor(e,t={}){this.url=e,this.requestConfig=t,this.rawRequest=async(...e)=>{const[t,r,n]=e,i=((e,t,r)=>e.query?e:{query:e,variables:t,requestHeaders:r,signal:void 0})(t,r,n),{headers:s,fetch:o=p,method:a="POST",requestMiddleware:c,responseMiddleware:u,...h}=this.requestConfig,{url:l}=this;void 0!==i.signal&&(h.signal=i.signal);const{operationName:d}=f(i.query);return v({url:l,query:i.query,variables:i.variables,headers:{...g(E(s)),...g(i.requestHeaders)},operationName:d,fetch:o,method:a,fetchOptions:h,middleware:c}).then((e=>(u&&u(e),e))).catch((e=>{throw u&&u(e),e}))}}async request(e,...t){const[r,n]=t,i=((e,t,r)=>e.document?e:{document:e,variables:t,requestHeaders:r,signal:void 0})(e,r,n),{headers:s,fetch:o=p,method:a="POST",requestMiddleware:c,responseMiddleware:u,...h}=this.requestConfig,{url:l}=this;void 0!==i.signal&&(h.signal=i.signal);const{query:d,operationName:y}=f(i.document);return v({url:l,query:d,variables:i.variables,headers:{...g(E(s)),...g(i.requestHeaders)},operationName:y,fetch:o,method:a,fetchOptions:h,middleware:c}).then((e=>(u&&u(e),e.data))).catch((e=>{throw u&&u(e),e}))}batchRequests(e,t){const r=((e,t)=>e.documents?e:{documents:e,requestHeaders:t,signal:void 0})(e,t),{headers:n,...i}=this.requestConfig;void 0!==r.signal&&(i.signal=r.signal);const s=r.documents.map((({document:e})=>f(e).query)),o=r.documents.map((({variables:e})=>e));return v({url:this.url,query:s,variables:o,headers:{...g(E(n)),...g(r.requestHeaders)},operationName:void 0,fetch:this.requestConfig.fetch??p,method:this.requestConfig.method||"POST",fetchOptions:i,middleware:this.requestConfig.requestMiddleware}).then((e=>(this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e.data))).catch((e=>{throw this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e}))}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,t){const{headers:r}=this.requestConfig;return r?r[e]=t:this.requestConfig.headers={[e]:t},this}setEndpoint(e){return this.url=e,this}}const v=async e=>{const{query:t,variables:r,fetchOptions:i}=e,s=b((e.method??"post").toUpperCase());const o=Array.isArray(e.query),a=await s(e),c=await _(a,i.jsonSerializer??n),u=Array.isArray(c)?!c.some((({data:e})=>!e)):Boolean(c.data),h=Array.isArray(c)||!c.errors||Array.isArray(c.errors)&&!c.errors.length||"all"===i.errorPolicy||"ignore"===i.errorPolicy;if(a.ok&&h&&u){const{errors:e,...t}=(Array.isArray(c),c),r="ignore"===i.errorPolicy?t:c;return{...o?{data:r}:r,headers:a.headers,status:a.status}}throw new d({..."string"==typeof c?{error:c}:c,status:a.status,headers:a.headers},{query:t,variables:r})};const _=async(e,t)=>{let r;return e.headers.forEach(((e,t)=>{"content-type"===t.toLowerCase()&&(r=e)})),r&&(r.toLowerCase().startsWith("application/json")||r.toLowerCase().startsWith("application/graphql+json")||r.toLowerCase().startsWith("application/graphql-response+json"))?t.parse(await e.text()):e.text()},E=e=>"function"==typeof e?e():e},96991:function(e,t,r){"use strict";r.d(t,{r:function(){return s},$:function(){return g}});var n=r(20544),i=r(77408);class s{constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new n,this.key=null}async put(e,t){const r=await this._findNewBucketAndPos(e);await r.bucket._putAt(r,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((e,t)=>t instanceof s?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof s?yield*t.eachLeafSeries():yield t}serialize(e,t){return t(this._children.reduce(((r,n,i)=>(null!=n&&(n instanceof s?r.push(n.serialize(e,t)):r.push(e(n,i))),r)),[]))}async asyncTransform(e,t){return await u(this,e,t)}toJSON(){return this.serialize(a,c)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);if(!(r instanceof s))return null!=r&&r.key===e?r:void 0}async _findPlace(e){const t=this._options.hash("string"==typeof e?(0,i.m)(e):e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof s?await n._findPlace(t):{bucket:this,pos:r,hash:t,existingChild:n}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){const e=new s(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const r=await e._findPlace(t.existingChild.hash);return r.bucket._putAt(r,t.existingChild.key,t.existingChild.value),await e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(o);if(null!=e&&!(e instanceof s)){const t=e.hash;t.untake(this._options.bits);const r={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function o(e){return Boolean(e)}function a(e,t){return e.key}function c(e){return e}async function u(e,t,r){const n=[];for(const i of e._children.compactArray())if(i instanceof s)await u(i,t,r);else{const r=await t(i);n.push({bitField:e._children.bitField(),children:r})}return await r(n)}const h=[255,254,252,248,240,224,192,128],l=[1,3,7,15,31,63,127,255];class f{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t);r=(r<<i)+d(e,n-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function d(e,t,r){const n=function(e,t){return h[e]&l[Math.min(t+e-1,7)]}(t,r);return(e&n)>>>t}var p=r(41690);class y{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?(0,p.z)([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new f(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}function g(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const t={bits:e.bits??8,hash:(r=e.hashFn,function(e){return e instanceof y?e:new y(e,r)})};var r;return new s(t)}},21771:function(e,t,r){"use strict";r.d(t,{F:function(){return Dd}});var n={};r.r(n),r.d(n,{base32:function(){return ue},base32hex:function(){return de},base32hexpad:function(){return ye},base32hexpadupper:function(){return ge},base32hexupper:function(){return pe},base32pad:function(){return le},base32padupper:function(){return fe},base32upper:function(){return he},base32z:function(){return me}});var i={};r.r(i),r.d(i,{base58btc:function(){return be},base58flickr:function(){return we}});var s={};r.r(s),r.d(s,{base64:function(){return ve},base64pad:function(){return _e},base64url:function(){return Ee},base64urlpad:function(){return ke}});var o={};r.r(o),r.d(o,{identity:function(){return Qe}});var a={};r.r(a),r.d(a,{sha256:function(){return nt},sha512:function(){return it}});var c={};r.r(c),r.d(c,{base36:function(){return Vr},base36upper:function(){return Wr}});var u={};r.r(u),r.d(u,{code:function(){return ri},decode:function(){return ii},encode:function(){return ni},name:function(){return ti}});var h={};r.r(h),r.d(h,{code:function(){return oi},decode:function(){return ci},encode:function(){return ai},name:function(){return si}});var l={};r.r(l),r.d(l,{base58btc:function(){return Vi},base58flickr:function(){return Wi}});var f={};r.r(f),r.d(f,{base10:function(){return qi}});var d={};r.r(d),r.d(d,{base16:function(){return Hi},base16upper:function(){return Gi}});var p={};r.r(p),r.d(p,{base2:function(){return Ji}});var y={};r.r(y),r.d(y,{base256emoji:function(){return Qi}});var g={};r.r(g),r.d(g,{base32:function(){return es},base32hex:function(){return is},base32hexpad:function(){return os},base32hexpadupper:function(){return as},base32hexupper:function(){return ss},base32pad:function(){return rs},base32padupper:function(){return ns},base32upper:function(){return ts},base32z:function(){return cs}});var m={};r.r(m),r.d(m,{base36:function(){return us},base36upper:function(){return hs}});var b={};r.r(b),r.d(b,{base64:function(){return ls},base64pad:function(){return fs},base64url:function(){return ds},base64urlpad:function(){return ps}});var w={};r.r(w),r.d(w,{base8:function(){return ys}});var v={};r.r(v),r.d(v,{identity:function(){return gs}});var _={};r.r(_),r.d(_,{code:function(){return vs},decode:function(){return Es},encode:function(){return _s},name:function(){return ws}});var E={};r.r(E),r.d(E,{code:function(){return xs},decode:function(){return As},encode:function(){return Ss},name:function(){return ks}});var k={};r.r(k),r.d(k,{identity:function(){return Zs}});var x={};r.r(x),r.d(x,{sha256:function(){return to},sha512:function(){return ro}});var S={};r.r(S),r.d(S,{Ed25519PrivateKey:function(){return ua},Ed25519PublicKey:function(){return ca},generateKeyPair:function(){return fa},generateKeyPairFromSeed:function(){return da},unmarshalEd25519PrivateKey:function(){return ha},unmarshalEd25519PublicKey:function(){return la}});var A={};r.r(A),r.d(A,{MAX_KEY_SIZE:function(){return Aa},RsaPrivateKey:function(){return Ca},RsaPublicKey:function(){return Ia},fromJwk:function(){return Da},generateKeyPair:function(){return Ra},unmarshalRsaPrivateKey:function(){return Pa},unmarshalRsaPublicKey:function(){return Ta}});var I={};r.r(I),r.d(I,{Secp256k1PrivateKey:function(){return Na},Secp256k1PublicKey:function(){return Oa},generateKeyPair:function(){return ja},unmarshalSecp256k1PrivateKey:function(){return La},unmarshalSecp256k1PublicKey:function(){return Ua}});var C={};r.r(C),r.d(C,{identity:function(){return iu}});var P={};r.r(P),r.d(P,{base2:function(){return su}});var T={};r.r(T),r.d(T,{base8:function(){return ou}});var D={};r.r(D),r.d(D,{base10:function(){return au}});var R={};r.r(R),r.d(R,{base16:function(){return cu},base16upper:function(){return uu}});var B={};r.r(B),r.d(B,{base32:function(){return hu},base32hex:function(){return pu},base32hexpad:function(){return gu},base32hexpadupper:function(){return mu},base32hexupper:function(){return yu},base32pad:function(){return fu},base32padupper:function(){return du},base32upper:function(){return lu},base32z:function(){return bu}});var M={};r.r(M),r.d(M,{base36:function(){return wu},base36upper:function(){return vu}});var O={};r.r(O),r.d(O,{base58btc:function(){return _u},base58flickr:function(){return Eu}});var N={};r.r(N),r.d(N,{base64:function(){return ku},base64pad:function(){return xu},base64url:function(){return Su},base64urlpad:function(){return Au}});var L={};r.r(L),r.d(L,{base256emoji:function(){return Tu}});var U={};r.r(U),r.d(U,{sha256:function(){return th},sha512:function(){return rh}});var j={};r.r(j),r.d(j,{identity:function(){return ih}});var z={};r.r(z),r.d(z,{code:function(){return oh},decode:function(){return ch},encode:function(){return ah},name:function(){return sh}});var F={};r.r(F),r.d(F,{code:function(){return fh},decode:function(){return ph},encode:function(){return dh},name:function(){return lh}});var K={};r.r(K),r.d(K,{base10:function(){return Zh}});var $={};r.r($),r.d($,{base16:function(){return Xh},base16upper:function(){return Qh}});var V={};r.r(V),r.d(V,{base2:function(){return el}});var W={};r.r(W),r.d(W,{base256emoji:function(){return il}});var q={};r.r(q),r.d(q,{base8:function(){return sl}});var H={};r.r(H),r.d(H,{identity:function(){return ol}});var G={};r.r(G),r.d(G,{Ed25519PrivateKey:function(){return cf},Ed25519PublicKey:function(){return af},generateKeyPair:function(){return lf},generateKeyPairFromSeed:function(){return ff},unmarshalEd25519PrivateKey:function(){return uf},unmarshalEd25519PublicKey:function(){return hf}});var J={};r.r(J),r.d(J,{MAX_KEY_SIZE:function(){return Af},RsaPrivateKey:function(){return Cf},RsaPublicKey:function(){return If},fromJwk:function(){return Df},generateKeyPair:function(){return Rf},unmarshalRsaPrivateKey:function(){return Pf},unmarshalRsaPublicKey:function(){return Tf}});var Y={};r.r(Y),r.d(Y,{Secp256k1PrivateKey:function(){return Of},Secp256k1PublicKey:function(){return Mf},generateKeyPair:function(){return Uf},unmarshalSecp256k1PrivateKey:function(){return Nf},unmarshalSecp256k1PublicKey:function(){return Lf}});var Z=r(11227);var X=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Q=X;new Uint8Array(0);const ee=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class te{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class re{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ie(this,e)}}class ne{constructor(e){this.decoders=e}or(e){return ie(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ie=(e,t)=>new ne({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class se{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new te(e,t,r),this.decoder=new re(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const oe=({name:e,prefix:t,encode:r,decode:n})=>new se(e,t,r,n),ae=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Q(r,t);return oe({prefix:e,name:t,encode:n,decode:e=>ee(i(e))})},ce=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>oe({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),ue=ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),he=ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),le=ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),fe=ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),de=ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pe=ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ye=ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ge=ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),me=ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),be=ae({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),we=ae({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ve=ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),_e=ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ee=ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ke=ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function xe(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return Z.enabled(`${e}:trace`)&&null!=Z.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=Z(`${e}:trace`)),Object.assign(Z(e),{error:Z(`${e}:error`),trace:t})}Z.formatters.b=e=>null==e?"undefined":be.baseEncode(e),Z.formatters.t=e=>null==e?"undefined":ue.baseEncode(e),Z.formatters.m=e=>null==e?"undefined":ve.baseEncode(e),Z.formatters.p=e=>null==e?"undefined":e.toString(),Z.formatters.c=e=>null==e?"undefined":e.toString(),Z.formatters.k=e=>null==e?"undefined":e.toString(),Z.formatters.a=e=>null==e?"undefined":e.toString();var Se=r(98724),Ae=r(32651),Ie=r(44837);var Ce=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);},Pe=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Re;)r[n++]=255&t|Te,t/=128;for(;t&De;)r[n++]=255&t|Te,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Te=128,De=-128,Re=Math.pow(2,31);var Be=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Oe)<<s:(n&Oe)*Math.pow(2,s),s+=7}while(n>=Me);return e.bytes=o-r,i},Me=128,Oe=127;var Ne=Math.pow(2,7),Le=Math.pow(2,14),Ue=Math.pow(2,21),je=Math.pow(2,28),ze=Math.pow(2,35),Fe=Math.pow(2,42),Ke=Math.pow(2,49),$e=Math.pow(2,56),Ve=Math.pow(2,63),We={encode:Pe,decode:Be,encodingLength:function(e){return e<Ne?1:e<Le?2:e<Ue?3:e<je?4:e<ze?5:e<Fe?6:e<Ke?7:e<$e?8:e<Ve?9:10}};const qe=(e,t=0)=>[We.decode(e,t),We.decode.bytes],He=(e,t,r=0)=>(We.encode(e,t,r),t),Ge=e=>We.encodingLength(e),Je=(e,t)=>{const r=t.byteLength,n=Ge(e),i=n+Ge(r),s=new Uint8Array(i+r);return He(e,s,0),He(r,s,n),s.set(t,i),new Ze(e,r,t,s)},Ye=e=>{const t=ee(e),[r,n]=qe(t),[i,s]=qe(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ze(r,i,o,t)};class Ze{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Xe=ee,Qe={code:0,name:"identity",encode:Xe,digest:e=>Je(0,Xe(e))},et=({name:e,code:t,encode:r})=>new tt(e,t,r);class tt{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Je(this.code,t):t.then((e=>Je(this.code,e)))}throw Error("Unknown type, must be binary type")}}const rt=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),nt=et({name:"sha2-256",code:18,encode:rt("SHA-256")}),it=et({name:"sha2-512",code:19,encode:rt("SHA-512")});var st=r(43905);const ot=["string","number","bigint","symbol"],at=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function ct(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(ot.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const r=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(at.includes(t))return t;return}(e);return r||"Object"}class ut{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}ut.uint=new ut(0,"uint",!0),ut.negint=new ut(1,"negint",!0),ut.bytes=new ut(2,"bytes",!0),ut.string=new ut(3,"string",!0),ut.array=new ut(4,"array",!1),ut.map=new ut(5,"map",!1),ut.tag=new ut(6,"tag",!1),ut.float=new ut(7,"float",!0),ut.false=new ut(7,"false",!0),ut.true=new ut(7,"true",!0),ut.null=new ut(7,"null",!0),ut.undefined=new ut(7,"undefined",!0),ut.break=new ut(7,"break",!0);class ht{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const lt=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,ft=new TextDecoder,dt=new TextEncoder;function pt(e){return lt&&globalThis.Buffer.isBuffer(e)}function yt(e){return e instanceof Uint8Array?pt(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const gt=lt?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):kt(e,t,r):(e,t,r)=>r-t>64?ft.decode(e.subarray(t,r)):kt(e,t,r),mt=lt?e=>e.length>64?globalThis.Buffer.from(e):Et(e):e=>e.length>64?dt.encode(e):Et(e),bt=e=>Uint8Array.from(e),wt=lt?(e,t,r)=>pt(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),vt=lt?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),yt(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},_t=lt?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function Et(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return t}function kt(e,t,r){const n=[];for(;t<r;){const i=e[t];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:i<128&&(s=i);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&i)<<6|63&r,c>127&&(s=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&i)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),t+=o}return St(n)}const xt=4096;function St(e){const t=e.length;if(t<=xt)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=xt));return r}class At{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=_t(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=wt(r,0,this.cursor)}else t=vt(this.chunks,this.cursor);return e&&this.reset(),t}}const It="CBOR decode error:",Ct="CBOR encode error:",Pt=[];function Tt(e,t,r){if(e.length-t<r)throw new Error(`${It} not enough data for type`)}Pt[23]=1,Pt[24]=2,Pt[25]=3,Pt[26]=5,Pt[27]=9;const Dt=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Rt(e,t,r){Tt(e,t,1);const n=e[t];if(!0===r.strict&&n<Dt[0])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);return n}function Bt(e,t,r){Tt(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<Dt[1])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);return n}function Mt(e,t,r){Tt(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<Dt[2])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);return n}function Ot(e,t,r){Tt(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(!0===r.strict&&s<Dt[3])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===r.allowBigInt)return s;throw new Error(`${It} integers outside of the safe integer range are not supported`)}function Nt(e,t){return Lt(e,0,t.value)}function Lt(e,t,r){if(r<Dt[0]){const n=Number(r);e.push([t|n])}else if(r<Dt[1]){const n=Number(r);e.push([24|t,n])}else if(r<Dt[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<Dt[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<Dt[4]))throw new Error(`${It} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&i,i>>=8,r[7]=255&i,i>>=8,r[6]=255&i,i>>=8,r[5]=255&i,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,e.push(r)}}}Nt.encodedSize=function(e){return Lt.encodedSize(e.value)},Lt.encodedSize=function(e){return e<Dt[0]?1:e<Dt[1]?2:e<Dt[2]?3:e<Dt[3]?5:9},Nt.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const Ut=BigInt(-1),jt=BigInt(1);function zt(e,t){const r=t.value,n="bigint"==typeof r?r*Ut-jt:-1*r-1;Lt(e,t.type.majorEncoded,n)}function Ft(e,t,r,n){Tt(e,t,r+n);const i=wt(e,t+r,t+r+n);return new ht(ut.bytes,i,r+n)}function Kt(e,t,r,n){return Ft(e,t,1,r)}function $t(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===ut.string?mt(e.value):e.value),e.encodedBytes}function Vt(e,t){const r=$t(t);Lt(e,t.type.majorEncoded,r.length),e.push(r)}function Wt(e,t,r,n,i){const s=r+n;Tt(e,t,s);const o=new ht(ut.string,gt(e,t+r,t+s),s);return!0===i.retainStringBytes&&(o.byteValue=wt(e,t+r,t+s)),o}function qt(e,t,r,n){return Wt(e,t,1,r,n)}zt.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*Ut-jt:-1*t-1;return r<Dt[0]?1:r<Dt[1]?2:r<Dt[2]?3:r<Dt[3]?5:9},zt.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Vt.encodedSize=function(e){const t=$t(e);return Lt.encodedSize(t.length)+t.length},Vt.compareTokens=function(e,t){return r=$t(e),n=$t(t),r.length<n.length?-1:r.length>n.length?1:function(e,t){if(pt(e)&&pt(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}(r,n);var r,n};const Ht=Vt;function Gt(e,t,r,n){return new ht(ut.array,n,r)}function Jt(e,t,r,n){return Gt(0,0,1,r)}function Yt(e,t){Lt(e,ut.array.majorEncoded,t.value)}function Zt(e,t,r,n){return new ht(ut.map,n,r)}function Xt(e,t,r,n){return Zt(0,0,1,r)}function Qt(e,t){Lt(e,ut.map.majorEncoded,t.value)}function er(e,t,r,n){return new ht(ut.tag,r,1)}function tr(e,t){Lt(e,ut.tag.majorEncoded,t.value)}Yt.compareTokens=Nt.compareTokens,Yt.encodedSize=function(e){return Lt.encodedSize(e.value)},Qt.compareTokens=Nt.compareTokens,Qt.encodedSize=function(e){return Lt.encodedSize(e.value)},tr.compareTokens=Nt.compareTokens,tr.encodedSize=function(e){return Lt.encodedSize(e.value)};const rr=20,nr=21,ir=22,sr=23;function or(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${It} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${It} Infinity values are not supported`)}return new ht(ut.float,e,t)}function ar(e,t,r){const n=t.value;if(!1===n)e.push([ut.float.majorEncoded|rr]);else if(!0===n)e.push([ut.float.majorEncoded|nr]);else if(null===n)e.push([ut.float.majorEncoded|ir]);else if(void 0===n)e.push([ut.float.majorEncoded|sr]);else{let t,s=!1;r&&!0===r.float64||(lr(n),t=fr(hr,1),n===t||Number.isNaN(n)?(hr[0]=249,e.push(hr.slice(0,3)),s=!0):(dr(n),t=pr(hr,1),n===t&&(hr[0]=250,e.push(hr.slice(0,5)),s=!0))),s||(i=n,ur.setFloat64(0,i,!1),t=yr(hr,1),hr[0]=251,e.push(hr.slice(0,9)))}var i}ar.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){lr(r);let e=fr(hr,1);if(r===e||Number.isNaN(r))return 3;if(dr(r),e=pr(hr,1),r===e)return 5}return 9};const cr=new ArrayBuffer(9),ur=new DataView(cr,1),hr=new Uint8Array(cr,0);function lr(e){if(e===1/0)ur.setUint16(0,31744,!1);else if(e===-1/0)ur.setUint16(0,64512,!1);else if(Number.isNaN(e))ur.setUint16(0,32256,!1);else{ur.setFloat32(0,e);const t=ur.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)ur.setUint16(0,31744,!1);else if(0===r)ur.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?ur.setUint16(0,0):e<-14?ur.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):ur.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function fr(e,t){if(e.length-t<2)throw new Error(`${It} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,i=1023&r;let s;return s=0===n?i*2**-24:31!==n?(i+1024)*2**(n-25):0===i?1/0:NaN,32768&r?-s:s}function dr(e){ur.setFloat32(0,e,!1)}function pr(e,t){if(e.length-t<4)throw new Error(`${It} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function yr(e,t){if(e.length-t<8)throw new Error(`${It} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function gr(e,t,r){throw new Error(`${It} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function mr(e){return()=>{throw new Error(`${It} ${e}`)}}ar.compareTokens=Nt.compareTokens;const br=[];for(let e=0;e<=23;e++)br[e]=gr;br[24]=function(e,t,r,n){return new ht(ut.uint,Rt(e,t+1,n),2)},br[25]=function(e,t,r,n){return new ht(ut.uint,Bt(e,t+1,n),3)},br[26]=function(e,t,r,n){return new ht(ut.uint,Mt(e,t+1,n),5)},br[27]=function(e,t,r,n){return new ht(ut.uint,Ot(e,t+1,n),9)},br[28]=gr,br[29]=gr,br[30]=gr,br[31]=gr;for(let e=32;e<=55;e++)br[e]=gr;br[56]=function(e,t,r,n){return new ht(ut.negint,-1-Rt(e,t+1,n),2)},br[57]=function(e,t,r,n){return new ht(ut.negint,-1-Bt(e,t+1,n),3)},br[58]=function(e,t,r,n){return new ht(ut.negint,-1-Mt(e,t+1,n),5)},br[59]=function(e,t,r,n){const i=Ot(e,t+1,n);if("bigint"!=typeof i){const e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new ht(ut.negint,e,9)}if(!0!==n.allowBigInt)throw new Error(`${It} integers outside of the safe integer range are not supported`);return new ht(ut.negint,Ut-BigInt(i),9)},br[60]=gr,br[61]=gr,br[62]=gr,br[63]=gr;for(let e=64;e<=87;e++)br[e]=Kt;br[88]=function(e,t,r,n){return Ft(e,t,2,Rt(e,t+1,n))},br[89]=function(e,t,r,n){return Ft(e,t,3,Bt(e,t+1,n))},br[90]=function(e,t,r,n){return Ft(e,t,5,Mt(e,t+1,n))},br[91]=function(e,t,r,n){const i=Ot(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer bytes lengths not supported`);return Ft(e,t,9,i)},br[92]=gr,br[93]=gr,br[94]=gr,br[95]=mr("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)br[e]=qt;br[120]=function(e,t,r,n){return Wt(e,t,2,Rt(e,t+1,n),n)},br[121]=function(e,t,r,n){return Wt(e,t,3,Bt(e,t+1,n),n)},br[122]=function(e,t,r,n){return Wt(e,t,5,Mt(e,t+1,n),n)},br[123]=function(e,t,r,n){const i=Ot(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer string lengths not supported`);return Wt(e,t,9,i,n)},br[124]=gr,br[125]=gr,br[126]=gr,br[127]=mr("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)br[e]=Jt;br[152]=function(e,t,r,n){return Gt(0,0,2,Rt(e,t+1,n))},br[153]=function(e,t,r,n){return Gt(0,0,3,Bt(e,t+1,n))},br[154]=function(e,t,r,n){return Gt(0,0,5,Mt(e,t+1,n))},br[155]=function(e,t,r,n){const i=Ot(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer array lengths not supported`);return Gt(0,0,9,i)},br[156]=gr,br[157]=gr,br[158]=gr,br[159]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${It} indefinite length items not allowed`);return Gt(0,0,1,1/0)};for(let e=160;e<=183;e++)br[e]=Xt;br[184]=function(e,t,r,n){return Zt(0,0,2,Rt(e,t+1,n))},br[185]=function(e,t,r,n){return Zt(0,0,3,Bt(e,t+1,n))},br[186]=function(e,t,r,n){return Zt(0,0,5,Mt(e,t+1,n))},br[187]=function(e,t,r,n){const i=Ot(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer map lengths not supported`);return Zt(0,0,9,i)},br[188]=gr,br[189]=gr,br[190]=gr,br[191]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${It} indefinite length items not allowed`);return Zt(0,0,1,1/0)};for(let e=192;e<=215;e++)br[e]=er;br[216]=function(e,t,r,n){return new ht(ut.tag,Rt(e,t+1,n),2)},br[217]=function(e,t,r,n){return new ht(ut.tag,Bt(e,t+1,n),3)},br[218]=function(e,t,r,n){return new ht(ut.tag,Mt(e,t+1,n),5)},br[219]=function(e,t,r,n){return new ht(ut.tag,Ot(e,t+1,n),9)},br[220]=gr,br[221]=gr,br[222]=gr,br[223]=gr;for(let e=224;e<=243;e++)br[e]=mr("simple values are not supported");br[244]=gr,br[245]=gr,br[246]=gr,br[247]=function(e,t,r,n){if(!1===n.allowUndefined)throw new Error(`${It} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new ht(ut.null,null,1):new ht(ut.undefined,void 0,1)},br[248]=mr("simple values are not supported"),br[249]=function(e,t,r,n){return or(fr(e,t+1),3,n)},br[250]=function(e,t,r,n){return or(pr(e,t+1),5,n)},br[251]=function(e,t,r,n){return or(yr(e,t+1),9,n)},br[252]=gr,br[253]=gr,br[254]=gr,br[255]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${It} indefinite length items not allowed`);return new ht(ut.break,void 0,1)};const wr=[];for(let e=0;e<24;e++)wr[e]=new ht(ut.uint,e,1);for(let e=-1;e>=-24;e--)wr[31-e]=new ht(ut.negint,e,1);wr[64]=new ht(ut.bytes,new Uint8Array(0),1),wr[96]=new ht(ut.string,"",1),wr[128]=new ht(ut.array,0,1),wr[160]=new ht(ut.map,0,1),wr[244]=new ht(ut.false,!1,1),wr[245]=new ht(ut.true,!0,1),wr[246]=new ht(ut.null,null,1);var vr=r(25108);const _r={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const i=r.type.major,s=Er[i].compareTokens(r,n);0===s&&vr.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return s},quickEncodeToken:function(e){switch(e.type){case ut.false:return bt([244]);case ut.true:return bt([245]);case ut.null:return bt([246]);case ut.bytes:return e.value.length?void 0:bt([64]);case ut.string:return""===e.value?bt([96]):void 0;case ut.array:return 0===e.value?bt([128]):void 0;case ut.map:return 0===e.value?bt([160]):void 0;case ut.uint:return e.value<24?bt([Number(e.value)]):void 0;case ut.negint:if(e.value>=-24)return bt([31-Number(e.value)])}}};const Er=function(){const e=[];return e[ut.uint.major]=Nt,e[ut.negint.major]=zt,e[ut.bytes.major]=Vt,e[ut.string.major]=Ht,e[ut.array.major]=Yt,e[ut.map.major]=Qt,e[ut.tag.major]=tr,e[ut.float.major]=ar,e}(),kr=new At;class xr{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Ct} object contains circular references`);return new xr(t,e)}}const Sr={null:new ht(ut.null,null),undefined:new ht(ut.undefined,void 0),true:new ht(ut.true,!0),false:new ht(ut.false,!1),emptyArray:new ht(ut.array,0),emptyMap:new ht(ut.map,0)},Ar={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new ht(e>=0?ut.uint:ut.negint,e):new ht(ut.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new ht(ut.uint,e):new ht(ut.negint,e),Uint8Array:(e,t,r,n)=>new ht(ut.bytes,e),string:(e,t,r,n)=>new ht(ut.string,e),boolean:(e,t,r,n)=>e?Sr.true:Sr.false,null:(e,t,r,n)=>Sr.null,undefined:(e,t,r,n)=>Sr.undefined,ArrayBuffer:(e,t,r,n)=>new ht(ut.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new ht(ut.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[Sr.emptyArray,new ht(ut.break)]:Sr.emptyArray;n=xr.createCheck(n,e);const i=[];let s=0;for(const t of e)i[s++]=Ir(t,r,n);return r.addBreakTokens?[new ht(ut.array,e.length),i,new ht(ut.break)]:[new ht(ut.array,e.length),i]},Object(e,t,r,n){const i="Object"!==t,s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return!0===r.addBreakTokens?[Sr.emptyMap,new ht(ut.break)]:Sr.emptyMap;n=xr.createCheck(n,e);const a=[];let c=0;for(const t of s)a[c++]=[Ir(t,r,n),Ir(i?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,r),r.addBreakTokens?[new ht(ut.map,o),a,new ht(ut.break)]:[new ht(ut.map,o),a]}};Ar.Map=Ar.Object,Ar.Buffer=Ar.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Ar[`${e}Array`]=Ar.DataView;function Ir(e,t={},r){const n=ct(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||Ar[n];if("function"==typeof i){const s=i(e,n,t,r);if(null!=s)return s}const s=Ar[n];if(!s)throw new Error(`${Ct} unsupported type: ${n}`);return s(e,n,t,r)}function Cr(e,t,r,n){if(Array.isArray(t))for(const i of t)Cr(e,i,r,n);else r[t.type.major](e,t,n)}function Pr(e,t,r){const n=Ir(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const i=t[n.type.major];if(i.encodedSize){const e=i.encodedSize(n,r),t=new At(e);if(i(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return yt(t.chunks[0])}}return kr.reset(),Cr(kr,n,t,r),kr.toBytes(!0)}function Tr(e,t){return t=Object.assign({},_r,t),Pr(e,Er,t)}const Dr={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Rr{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=wr[e];if(void 0===t){const r=br[e];if(!r)throw new Error(`${It} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const n=31&e;t=r(this.data,this._pos,n,this.options)}return this._pos+=t.encodedLength,t}}const Br=Symbol.for("DONE"),Mr=Symbol.for("BREAK");function Or(e,t){if(e.done())return Br;const r=e.next();if(r.type===ut.break)return Mr;if(r.type.terminal)return r.value;if(r.type===ut.array)return function(e,t,r){const n=[];for(let i=0;i<e.value;i++){const s=Or(t,r);if(s===Mr){if(e.value===1/0)break;throw new Error(`${It} got unexpected break to lengthed array`)}if(s===Br)throw new Error(`${It} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=s}return n}(r,e,t);if(r.type===ut.map)return function(e,t,r){const n=!0===r.useMaps,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<e.value;o++){const a=Or(t,r);if(a===Mr){if(e.value===1/0)break;throw new Error(`${It} got unexpected break to lengthed map`)}if(a===Br)throw new Error(`${It} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof a)throw new Error(`${It} non-string keys not supported (got ${typeof a})`);if(!0===r.rejectDuplicateMapKeys&&(n&&s.has(a)||!n&&a in i))throw new Error(`${It} found repeat map key "${a}"`);const c=Or(t,r);if(c===Br)throw new Error(`${It} found map but not enough entries (got ${o} [no value], expected ${e.value})`);n?s.set(a,c):i[a]=c}return n?s:i}(r,e,t);if(r.type===ut.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=Or(e,t);return t.tags[r.value](n)}throw new Error(`${It} tag not supported (${r.value})`)}throw new Error("unsupported")}function Nr(e,t){const[r,n]=function(e,t){if(!(e instanceof Uint8Array))throw new Error(`${It} data to decode must be a Uint8Array`);const r=(t=Object.assign({},Dr,t)).tokenizer||new Rr(e,t),n=Or(r,t);if(n===Br)throw new Error(`${It} did not find any content to decode`);if(n===Mr)throw new Error(`${It} got unexpected break`);return[n,e.subarray(r.pos())]}(e,t);if(n.length>0)throw new Error(`${It} too many terminals, data makes no sense`);return r}var Lr=r(53416),Ur=r(49784),jr=r(77408);const zr="/",Fr=(new TextEncoder).encode(zr),Kr=Fr[0];class $r{constructor(e,t){if("string"==typeof e)this._buf=(0,jr.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==Kr)throw new Error("Invalid key")}toString(e="utf8"){return(0,Ur.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new $r(e.join(zr))}static random(){return new $r((0,Lr.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new $r(e):"function"==typeof e.uint8Array?new $r(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Fr),this._buf[0]!==Kr){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Kr,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Kr;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return $r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(zr).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new $r(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(zr)||(e+=zr),e+=this.type(),new $r(e)}parent(){const e=this.list();return 1===e.length?new $r(zr):new $r(e.slice(0,-1).join(zr))}child(e){return this.toString()===zr?e:e.toString()===zr?this:new $r(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return $r.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}const Vr=ae({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Wr=ae({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),qr=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Zr(r,Gr(e),t||be.encoder):Xr(r,Gr(e),t||ue.encoder)},Hr=new WeakMap,Gr=e=>{const t=Hr.get(e);if(null==t){const t=new Map;return Hr.set(e,t),t}return t};class Jr{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Qr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==en)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Jr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Je(e,t);return Jr.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Jr.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return qr(this,e)}toJSON(){return{"/":qr(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Jr)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Jr(e,r,n,i||tn(e,r,n.bytes))}if(!0===t[rn]){const{version:e,multihash:r,code:n}=t,i=Ye(r);return Jr.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Qr)throw new Error(`Version 0 CID must use dag-pb (code: ${Qr}) block encoding`);return new Jr(e,t,r,r.bytes);case 1:{const n=tn(e,t,r.bytes);return new Jr(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Jr.create(0,Qr,e)}static createV1(e,t){return Jr.create(1,e,t)}static decode(e){const[t,r]=Jr.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Jr.inspectBytes(e),r=t.size-t.multihashSize,n=ee(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Ze(t.multihashCode,t.digestSize,i,n);return[0===t.version?Jr.createV0(s):Jr.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=qe(e.subarray(t));return t+=n,r};let n=r(),i=Qr;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Yr(e,t),i=Jr.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Gr(i).set(r,e),i}}const Yr=(e,t)=>{switch(e[0]){case"Q":{const r=t||be;return[be.prefix,r.decode(`${be.prefix}${e}`)]}case be.prefix:{const r=t||be;return[be.prefix,r.decode(e)]}case ue.prefix:{const r=t||ue;return[ue.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Zr=(e,t,r)=>{const{prefix:n}=r;if(n!==be.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Xr=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},Qr=112,en=18,tn=(e,t,r)=>{const n=Ge(e),i=n+Ge(t),s=new Uint8Array(i+r.byteLength);return He(e,s,0),He(t,s,n),s.set(r,i),s},rn=Symbol.for("@ipld/js-cid/CID");var nn=r(85275),sn=r(85923),on=r.n(sn),an=r(71198);var cn,un=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};cn=new WeakMap;var hn,ln,fn,dn,pn,yn,gn,mn,bn,wn,vn,_n,En,kn,xn,Sn,An,In,Cn,Pn,Tn,Dn,Rn,Bn,Mn,On,Nn=class{constructor(){cn.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&un(this,cn,"f")[this.size-1].priority>=t.priority)return void un(this,cn,"f").push(r);const n=function(e,t,r){let n=0,i=e.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}(un(this,cn,"f"),r,((e,t)=>t.priority-e.priority));un(this,cn,"f").splice(n,0,r)}dequeue(){const e=un(this,cn,"f").shift();return null==e?void 0:e.run}filter(e){return un(this,cn,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return un(this,cn,"f").length}},Ln=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},Un=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class jn extends Error{}class zn extends(on()){constructor(e){var t,r,n,i;if(super(),hn.add(this),ln.set(this,void 0),fn.set(this,void 0),dn.set(this,0),pn.set(this,void 0),yn.set(this,void 0),gn.set(this,0),mn.set(this,void 0),bn.set(this,void 0),wn.set(this,void 0),vn.set(this,void 0),_n.set(this,0),En.set(this,void 0),kn.set(this,void 0),xn.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Nn,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);Ln(this,ln,e.carryoverConcurrencyCount,"f"),Ln(this,fn,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),Ln(this,pn,e.intervalCap,"f"),Ln(this,yn,e.interval,"f"),Ln(this,wn,new e.queueClass,"f"),Ln(this,vn,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Ln(this,xn,!0===e.throwOnTimeout,"f"),Ln(this,kn,!1===e.autoStart,"f")}get concurrency(){return Un(this,En,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Ln(this,En,e,"f"),Un(this,hn,"m",Bn).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:Un(this,xn,"f"),...t},new Promise(((r,n)=>{Un(this,wn,"f").enqueue((async()=>{var i,s,o;Ln(this,_n,(s=Un(this,_n,"f"),++s),"f"),Ln(this,dn,(o=Un(this,dn,"f"),++o),"f");try{if(null===(i=t.signal)||void 0===i?void 0:i.aborted)throw new jn("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=(0,an.ZP)(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,Un(this,hn,"m",Mn).call(this,t.signal)]));const s=await n;r(s),this.emit("completed",s)}catch(e){if(e instanceof an.W5&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{Un(this,hn,"m",In).call(this)}}),t),this.emit("add"),Un(this,hn,"m",Tn).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return Un(this,kn,"f")?(Ln(this,kn,!1,"f"),Un(this,hn,"m",Bn).call(this),this):this}pause(){Ln(this,kn,!0,"f")}clear(){Ln(this,wn,new(Un(this,vn,"f")),"f")}async onEmpty(){0!==Un(this,wn,"f").size&&await Un(this,hn,"m",On).call(this,"empty")}async onSizeLessThan(e){Un(this,wn,"f").size<e||await Un(this,hn,"m",On).call(this,"next",(()=>Un(this,wn,"f").size<e))}async onIdle(){0===Un(this,_n,"f")&&0===Un(this,wn,"f").size||await Un(this,hn,"m",On).call(this,"idle")}get size(){return Un(this,wn,"f").size}sizeBy(e){return Un(this,wn,"f").filter(e).length}get pending(){return Un(this,_n,"f")}get isPaused(){return Un(this,kn,"f")}}ln=new WeakMap,fn=new WeakMap,dn=new WeakMap,pn=new WeakMap,yn=new WeakMap,gn=new WeakMap,mn=new WeakMap,bn=new WeakMap,wn=new WeakMap,vn=new WeakMap,_n=new WeakMap,En=new WeakMap,kn=new WeakMap,xn=new WeakMap,hn=new WeakSet,Sn=function(){return Un(this,fn,"f")||Un(this,dn,"f")<Un(this,pn,"f")},An=function(){return Un(this,_n,"f")<Un(this,En,"f")},In=function(){var e;Ln(this,_n,(e=Un(this,_n,"f"),--e),"f"),Un(this,hn,"m",Tn).call(this),this.emit("next")},Cn=function(){Un(this,hn,"m",Rn).call(this),Un(this,hn,"m",Dn).call(this),Ln(this,bn,void 0,"f")},Pn=function(){const e=Date.now();if(void 0===Un(this,mn,"f")){const t=Un(this,gn,"f")-e;if(!(t<0))return void 0===Un(this,bn,"f")&&Ln(this,bn,setTimeout((()=>{Un(this,hn,"m",Cn).call(this)}),t),"f"),!0;Ln(this,dn,Un(this,ln,"f")?Un(this,_n,"f"):0,"f")}return!1},Tn=function(){if(0===Un(this,wn,"f").size)return Un(this,mn,"f")&&clearInterval(Un(this,mn,"f")),Ln(this,mn,void 0,"f"),this.emit("empty"),0===Un(this,_n,"f")&&this.emit("idle"),!1;if(!Un(this,kn,"f")){const e=!Un(this,hn,"a",Pn);if(Un(this,hn,"a",Sn)&&Un(this,hn,"a",An)){const t=Un(this,wn,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&Un(this,hn,"m",Dn).call(this),!0)}}return!1},Dn=function(){Un(this,fn,"f")||void 0!==Un(this,mn,"f")||(Ln(this,mn,setInterval((()=>{Un(this,hn,"m",Rn).call(this)}),Un(this,yn,"f")),"f"),Ln(this,gn,Date.now()+Un(this,yn,"f"),"f"))},Rn=function(){0===Un(this,dn,"f")&&0===Un(this,_n,"f")&&Un(this,mn,"f")&&(clearInterval(Un(this,mn,"f")),Ln(this,mn,void 0,"f")),Ln(this,dn,Un(this,ln,"f")?Un(this,_n,"f"):0,"f"),Un(this,hn,"m",Bn).call(this)},Bn=function(){for(;Un(this,hn,"m",Tn).call(this););},Mn=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new jn("The task was aborted."))}),{once:!0})}))},On=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var Fn=zn,Kn=r(73062),$n=r(90560);class Vn extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===Type.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===Type.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[ut.uint.major](e,t){this.prefix(e);const r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[ut.negint.major](e,t){this[Type.uint.major](e,t)}[ut.bytes.major](e,t){throw new Error(`${encodeErrPrefix} unsupported type: Uint8Array`)}[ut.string.major](e,t){this.prefix(e);const r=fromString(JSON.stringify(t.value));e.push(r.length>32?asU8A(r):r)}[ut.array.major](e,t){this.prefix(e),this.inRecursive.push({type:Type.array,elements:0}),e.push([91])}[ut.map.major](e,t){this.prefix(e),this.inRecursive.push({type:Type.map,elements:0}),e.push([123])}[ut.tag.major](e,t){}[ut.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===Type.array)e.push([93]);else{if(t.type!==Type.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${encodeErrPrefix} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const r=String(t.value),n=[];let i=!1;for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e),i||46!==n[e]&&101!==n[e]&&69!==n[e]||(i=!0);i||(n.push(46),n.push(48)),e.push(n)}}class Wn{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${It} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${It} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,r=!1;const n=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this._pos++}};if(45===this.ch()&&(t=!0,this._pos++),48===this.ch()){if(this._pos++,46!==this.ch())return new ht(ut.uint,0,this._pos-e);this._pos++,r=!0}if(n([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${It} unexpected token at position ${this._pos}`);if(!this.done()&&46===this.ch()){if(r)throw new Error(`${It} unexpected token at position ${this._pos}`);r=!0,this._pos++,n([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this._pos++,this.done()||43!==this.ch()&&45!==this.ch()||this._pos++,n([48,49,50,51,52,53,54,55,56,57]));const i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return r?new ht(ut.float,s,this._pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(s)?new ht(s>=0?ut.uint:ut.negint,s,this._pos-e):new ht(s>=0?ut.uint:ut.negint,BigInt(i),this._pos-e)}parseString(){if(34!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let e=this._pos,t=0;e<this.data.length&&t<65536;e++,t++){const r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){const r=String.fromCharCode.apply(null,this.data.subarray(this._pos,e));return this._pos=e+1,new ht(ut.string,r,t)}}const e=this._pos,t=[],r=()=>{if(this._pos+4>=this.data.length)throw new Error(`${It} unexpected end of unicode escape sequence at position ${this._pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${It} unexpected unicode escape character at position ${this._pos}`);t=t-65+10}e=16*e+t,this._pos++}return e},n=()=>{const e=this.ch();let r,n,i,s,o=null,a=e>239?4:e>223?3:e>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${It} unexpected unicode sequence at position ${this._pos}`);switch(a){case 1:e<128&&(o=e);break;case 2:r=this.data[this._pos+1],128==(192&r)&&(s=(31&e)<<6|63&r,s>127&&(o=s));break;case 3:r=this.data[this._pos+1],n=this.data[this._pos+2],128==(192&r)&&128==(192&n)&&(s=(15&e)<<12|(63&r)<<6|63&n,s>2047&&(s<55296||s>57343)&&(o=s));break;case 4:r=this.data[this._pos+1],n=this.data[this._pos+2],i=this.data[this._pos+3],128==(192&r)&&128==(192&n)&&128==(192&i)&&(s=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&i,s>65535&&s<1114112&&(o=s))}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this._pos+=a};for(;!this.done();){const i=this.ch();let s;switch(i){case 92:if(this._pos++,this.done())throw new Error(`${It} unexpected string termination at position ${this._pos}`);switch(s=this.ch(),this._pos++,s){case 34:case 39:case 92:case 47:t.push(s);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${It} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ht(ut.string,St(t),this._pos-e);default:if(i<32)throw new Error(`${It} invalid control character at position ${this._pos}`);i<128?(t.push(i),this._pos++):n()}}throw new Error(`${It} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ht(ut.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ht(ut.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ht(ut.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ht(ut.false,!1,5);case 116:return this.expect([116,114,117,101]),new ht(ut.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${It} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1);if(44!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1);if(44!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${It} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}const qn={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};qn.tags[42]=Jr.parse;new TextDecoder,new TextEncoder;const Hn=new TextDecoder;function Gn(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const i=e[t++];if(r+=n<28?(127&i)<<n:(127&i)*2**n,i<128)break}return[r,t]}function Jn(e,t){let r;[r,t]=Gn(e,t);const n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function Yn(e,t){let r;return[r,t]=Gn(e,t),[7&r,r>>3,t]}function Zn(e){const t={},r=e.length;let n=0;for(;n<r;){let r,i;if([r,i,n]=Yn(e,n),1===i){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=Jn(e,n)}else if(2===i){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,n]=Jn(e,n),t.Name=Hn.decode(i)}else{if(3!==i)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=Gn(e,n)}}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}new TextEncoder;new TextEncoder;function Xn(e){const t=function(e){const t=e.length;let r,n,i=0,s=!1;for(;i<t;){let t,o;if([t,o,i]=Yn(e,i),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===o){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,i]=Jn(e,i),r&&(s=!0)}else{if(2!==o)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`);{if(s)throw new Error("protobuf: (PBNode) duplicate Links section");let t;r||(r=[]),[t,i]=Jn(e,i),r.push(Zn(t))}}}if(i>t)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return n&&(o.Data=n),o.Links=r||[],o}(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map((e=>{const t={};try{t.Hash=Jr.decode(e.Hash)}catch(e){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),r}const Qn=new TextEncoder,ei=new TextDecoder,ti="json",ri=512,ni=e=>Qn.encode(JSON.stringify(e)),ii=e=>JSON.parse(ei.decode(e)),si="raw",oi=85,ai=e=>ee(e),ci=e=>ee(e),ui={codec:112,async*walk(e){const t=Xn(e);yield*t.Links.map((e=>e.Hash))}},hi={codec:oi,async*walk(){}},li={codec:$n.code,async*walk(e){const t=[],r=[];r[42]=e=>{if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");const r=Jr.decode(e.subarray(1));return t.push(r),r},Nr(e,{tags:r}),yield*t}};class fi extends Wn{tokenBuffer;constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===ut.map){const e=this._next();if(e.type===ut.string&&"/"===e.value){const e=this._next();if(e.type===ut.string){if(this._next().type!==ut.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new ht(ut.tag,42,0)}if(e.type===ut.map){const e=this._next();if(e.type===ut.string&&"bytes"===e.value){const e=this._next();if(e.type===ut.string){for(let e=0;e<2;e++){if(this._next().type!==ut.break)throw new Error("Invalid encoded Bytes form")}const t=ve.decode(`m${e.value}`);return new ht(ut.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}const di={codec:297,async*walk(e){const t=[],r=[];var n,i;r[42]=e=>{const r=Jr.parse(e);return t.push(r),r},n=e,i={tags:r,tokenizer:new fi(e,{tags:r,allowIndefinite:!0,allowUndefined:!0,allowNaN:!0,allowInfinity:!0,allowBigInt:!0,strict:!1,rejectDuplicateMapKeys:!1})},Nr(n,i=Object.assign({tokenizer:new Wn(n,i)},i)),yield*t}},pi=[hi,ui,li,di,{codec:ri,async*walk(){}}],yi="/pin/",gi="/pinned-block/",mi=Vr;function bi(e){return 0===e.version&&(e=e.toV1()),new $r(`${yi}${e.toString(mi)}`)}class wi{datastore;blockstore;dagWalkers;constructor(e,t,r){this.datastore=e,this.blockstore=t,this.dagWalkers={},[...pi,...r].forEach((e=>{this.dagWalkers[e.codec]=e}))}async add(e,t={}){const r=bi(e);if(await this.datastore.has(r))throw new Error("Already pinned");const n=Math.round(t.depth??1/0);if(n<0)throw new Error("Depth must be greater than or equal to 0");const i=new Fn({concurrency:1});i.add((async()=>{await this.#n(e,i,(t=>{null==t.pinnedBy.find((t=>(0,Kn.f)(t,e.bytes)))&&(t.pinCount++,t.pinnedBy.push(e.bytes))}),{...t,depth:n})}));const s=(0,nn.Z)();i.on("error",(e=>{i.clear(),s.reject(e)})),await Promise.race([i.onIdle(),s.promise]);const o={depth:n,metadata:t.metadata??{}};return await this.datastore.put(r,Tr(o),t),{cid:e,...o}}async#n(e,t,r,n){if(-1===n.depth)return;const i=this.dagWalkers[e.code];if(null==i)throw new Error(`No dag walker found for cid codec ${e.code}`);const s=await this.blockstore.get(e,n);await this.#i(e,r,n);for await(const e of i.walk(s))t.add((async()=>{await this.#n(e,t,r,{...n,depth:n.depth-1})}))}async#i(e,t,r){const n=new $r(`${gi}${mi.encode(e.multihash.bytes)}`);let i={pinCount:0,pinnedBy:[]};try{i=Nr(await this.datastore.get(n,r))}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}t(i),0===i.pinCount&&await this.datastore.has(n)?await this.datastore.delete(n):(await this.datastore.put(n,Tr(i),r),r.onProgress?.(new st.V("helia:pin:add",{detail:e})))}async rm(e,t={}){const r=bi(e),n=Nr(await this.datastore.get(r,t));await this.datastore.delete(r,t);const i=new Fn({concurrency:1});return i.add((async()=>{await this.#n(e,i,(t=>{t.pinCount--,t.pinnedBy=t.pinnedBy.filter((t=>(0,Kn.f)(t,e.bytes)))}),{...t,depth:n.depth})})),await i.onIdle(),{cid:e,...n}}async*ls(e={}){for await(const{key:t,value:r}of this.datastore.query({prefix:yi+(null!=e.cid?`${e.cid.toString(Vr)}`:"")},e)){const e=Jr.parse(t.toString().substring(5),Vr),n=Nr(r);yield{cid:e,...n}}}async isPinned(e,t={}){const r=new $r(`${gi}${mi.encode(e.multihash.bytes)}`);return this.datastore.has(r,t)}}var vi=r(95155);class _i{lock;child;pins;constructor(e,t,r={}){this.child=e,this.pins=t,this.lock=(0,vi.Z)({singleProcess:r.holdGcLock})}unwrap(){return this.child}async put(e,t,r={}){const n=await this.lock.readLock();try{return await this.child.put(e,t,r)}finally{n()}}async*putMany(e,t={}){const r=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{r()}}async get(e,t={}){const r=await this.lock.readLock();try{return await this.child.get(e,t)}finally{r()}}async*getMany(e,t={}){const r=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{r()}}async delete(e,t={}){const r=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{r()}}async*deleteMany(e,t={}){const r=await this.lock.writeLock();try{const r=this;yield*this.child.deleteMany(async function*(){for await(const t of e){if(await r.pins.isPinned(t))throw new Error("CID was pinned");yield t}}(),t)}finally{r()}}async has(e,t={}){const r=await this.lock.readLock();try{return await this.child.has(e,t)}finally{r()}}async*getAll(e={}){const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}}const Ei=new $r("/version");var ki=r(75671);var xi=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,ki.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){await s&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===s&&(yield n);for(const e of r)o(e)&&(yield e)}()};var Si=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r),yield r}();const r=(0,ki.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s?.then)return async function*(){yield n;for await(const e of r)await t(e),yield e}();const o=t;return function*(){yield n;for(const e of r)o(e),yield e}()};class Ai{child;bitswap;constructor(e,t={}){this.child=e,this.bitswap=t.bitswap}unwrap(){return this.child}async put(e,t,r={}){return await this.child.has(e)?(r.onProgress?.(new st.V("blocks:put:duplicate",e)),e):(!0===this.bitswap?.isStarted()&&(r.onProgress?.(new st.V("blocks:put:bitswap:notify",e)),this.bitswap.notify(e,t,r)),r.onProgress?.(new st.V("blocks:put:blockstore:put",e)),this.child.put(e,t,r))}async*putMany(e,t={}){const r=xi(e,(async({cid:e})=>{const r=await this.child.has(e);return r&&t.onProgress?.(new st.V("blocks:put-many:duplicate",e)),!r})),n=Si(r,(({cid:e,block:r})=>{t.onProgress?.(new st.V("blocks:put-many:bitswap:notify",e)),this.bitswap?.notify(e,r,t)}));t.onProgress?.(new st.V("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(n,t)}async get(e,t={}){if(!0!==t.offline&&null!=this.bitswap?.isStarted()&&!await this.child.has(e)){t.onProgress?.(new st.V("blocks:get:bitswap:get",e));const r=await this.bitswap.want(e,t);return t.onProgress?.(new st.V("blocks:get:blockstore:put",e)),await this.child.put(e,r,t),r}return t.onProgress?.(new st.V("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){t.onProgress?.(new st.V("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(Si(e,(async e=>{if(!0!==t.offline&&!0===this.bitswap?.isStarted()&&!await this.child.has(e)){t.onProgress?.(new st.V("blocks:get-many:bitswap:get",e));const r=await this.bitswap.want(e,t);t.onProgress?.(new st.V("blocks:get-many:blockstore:put",e)),await this.child.put(e,r,t)}})))}async delete(e,t={}){t.onProgress?.(new st.V("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){t.onProgress?.(new st.V("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const t of e)yield t}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){e.onProgress?.(new st.V("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}const Ii=xe("helia");class Ci{libp2p;blockstore;datastore;pins;#s;constructor(e){const t=[nt,it,Qe,...e.hashers??[]];this.#s=(0,Ie.n)(e.libp2p,e.blockstore,{hashLoader:{getHasher:async e=>{const r=t.find((t=>t.code===e||t.name===e));if(null!=r)return r;throw new Error(`Could not load hasher for code/name "${e}"`)}}});const r=new Ai(e.blockstore,{bitswap:this.#s});this.pins=new wi(e.datastore,r,e.dagWalkers??[]),this.libp2p=e.libp2p,this.blockstore=new _i(r,this.pins,{holdGcLock:e.holdGcLock}),this.datastore=e.datastore}async start(){await async function(e){if(!await e.has(Ei))return void await e.put(Ei,(0,jr.m)("1"));const t=await e.get(Ei),r=(0,Ur.B)(t);if(1!==parseInt(r,10))throw new Error("Unknown datastore version, a datastore migration may be required")}(this.datastore),await(this.#s?.start()),await this.libp2p.start()}async stop(){await this.libp2p.stop(),await(this.#s?.stop())}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const t=this,r=this.blockstore.unwrap();Ii("gc start"),await Ce(r.deleteMany(async function*(){for await(const{cid:n}of r.getAll())try{if(await t.pins.isPinned(n,e))continue;yield n,e.onProgress?.(new st.V("helia:gc:deleted",n))}catch(t){Ii.error("Error during gc",t),e.onProgress?.(new st.V("helia:gc:error",t))}}()))}finally{t()}Ii("gc finished")}}var Pi=r(63718),Ti=r(32629),Di=r(49541),Ri=r(5681);var Bi=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Mi=Bi;new Uint8Array(0);const Oi=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Ni{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Li{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ji(this,e)}}class Ui{constructor(e){this.decoders=e}or(e){return ji(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ji=(e,t)=>new Ui({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class zi{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Ni(e,t,r),this.decoder=new Li(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Fi=({name:e,prefix:t,encode:r,decode:n})=>new zi(e,t,r,n),Ki=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Mi(r,t);return Fi({prefix:e,name:t,encode:n,decode:e=>Oi(i(e))})},$i=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Fi({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Vi=Ki({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Wi=Ki({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),qi=Ki({prefix:"9",name:"base10",alphabet:"0123456789"}),Hi=$i({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gi=$i({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ji=$i({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Yi=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Zi=Yi.reduce(((e,t,r)=>(e[r]=t,e)),[]),Xi=Yi.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Qi=Fi({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Zi[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Xi[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),es=$i({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ts=$i({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rs=$i({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ns=$i({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),is=$i({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ss=$i({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),os=$i({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),as=$i({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),cs=$i({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),us=Ki({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hs=Ki({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ls=$i({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),fs=$i({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ds=$i({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ps=$i({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ys=$i({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),gs=Fi({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),ms=new TextEncoder,bs=new TextDecoder,ws="json",vs=512,_s=e=>ms.encode(JSON.stringify(e)),Es=e=>JSON.parse(bs.decode(e)),ks="raw",xs=85,Ss=e=>Oi(e),As=e=>Oi(e);var Is=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Ts;)r[n++]=255&t|Cs,t/=128;for(;t&Ps;)r[n++]=255&t|Cs,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Cs=128,Ps=-128,Ts=Math.pow(2,31);var Ds=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Bs)<<s:(n&Bs)*Math.pow(2,s),s+=7}while(n>=Rs);return e.bytes=o-r,i},Rs=128,Bs=127;var Ms=Math.pow(2,7),Os=Math.pow(2,14),Ns=Math.pow(2,21),Ls=Math.pow(2,28),Us=Math.pow(2,35),js=Math.pow(2,42),zs=Math.pow(2,49),Fs=Math.pow(2,56),Ks=Math.pow(2,63),$s={encode:Is,decode:Ds,encodingLength:function(e){return e<Ms?1:e<Os?2:e<Ns?3:e<Ls?4:e<Us?5:e<js?6:e<zs?7:e<Fs?8:e<Ks?9:10}};const Vs=(e,t=0)=>[$s.decode(e,t),$s.decode.bytes],Ws=(e,t,r=0)=>($s.encode(e,t,r),t),qs=e=>$s.encodingLength(e),Hs=(e,t)=>{const r=t.byteLength,n=qs(e),i=n+qs(r),s=new Uint8Array(i+r);return Ws(e,s,0),Ws(r,s,n),s.set(t,i),new Js(e,r,t,s)},Gs=e=>{const t=Oi(e),[r,n]=Vs(t),[i,s]=Vs(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Js(r,i,o,t)};class Js{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Ys=Oi,Zs={code:0,name:"identity",encode:Ys,digest:e=>Hs(0,Ys(e))},Xs=({name:e,code:t,encode:r})=>new Qs(e,t,r);class Qs{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Hs(this.code,t):t.then((e=>Hs(this.code,e)))}throw Error("Unknown type, must be binary type")}}const eo=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),to=Xs({name:"sha2-256",code:18,encode:eo("SHA-256")}),ro=Xs({name:"sha2-512",code:19,encode:eo("SHA-512")}),no=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?co(r,so(e),t||Vi.encoder):uo(r,so(e),t||es.encoder)},io=new WeakMap,so=e=>{const t=io.get(e);if(null==t){const t=new Map;return io.set(e,t),t}return t};class oo{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ho)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==lo)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return oo.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Hs(e,t);return oo.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return oo.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return no(this,e)}toJSON(){return{"/":no(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof oo)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new oo(e,r,n,i||fo(e,r,n.bytes))}if(!0===t[po]){const{version:e,multihash:r,code:n}=t,i=Gs(r);return oo.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ho)throw new Error(`Version 0 CID must use dag-pb (code: ${ho}) block encoding`);return new oo(e,t,r,r.bytes);case 1:{const n=fo(e,t,r.bytes);return new oo(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return oo.create(0,ho,e)}static createV1(e,t){return oo.create(1,e,t)}static decode(e){const[t,r]=oo.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=oo.inspectBytes(e),r=t.size-t.multihashSize,n=Oi(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Js(t.multihashCode,t.digestSize,i,n);return[0===t.version?oo.createV0(s):oo.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Vs(e.subarray(t));return t+=n,r};let n=r(),i=ho;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=ao(e,t),i=oo.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return so(i).set(r,e),i}}const ao=(e,t)=>{switch(e[0]){case"Q":{const r=t||Vi;return[Vi.prefix,r.decode(`${Vi.prefix}${e}`)]}case Vi.prefix:{const r=t||Vi;return[Vi.prefix,r.decode(e)]}case es.prefix:{const r=t||es;return[es.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},co=(e,t,r)=>{const{prefix:n}=r;if(n!==Vi.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},uo=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},ho=112,lo=18,fo=(e,t,r)=>{const n=qs(e),i=n+qs(t),s=new Uint8Array(i+r.byteLength);return Ws(e,s,0),Ws(t,s,n),s.set(r,i),s},po=Symbol.for("@ipld/js-cid/CID"),yo={...v,...p,...w,...f,...d,...g,...m,...l,...b,...y};function go(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const mo=Symbol.for("nodejs.util.inspect.custom"),bo=Object.values(yo).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),yo.identity.decoder),wo=114,vo=36,_o=37;class Eo{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Ri.N]=!0;toString(){return null==this.string&&(this.string=Vi.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return oo.createV1(wo,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return go(this.multihash.bytes,e);if("string"==typeof e)return Ao(e).equals(this);if(null!=e?.multihash?.bytes)return go(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[mo](){return`PeerId(${this.toString()})`}}class ko extends Eo{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class xo extends Eo{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class So extends Eo{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function Ao(e,t){if(t=t??bo,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Gs(Vi.decode(`z${e}`));return e.startsWith("12D")?new xo({multihash:t}):e.startsWith("16U")?new So({multihash:t}):new ko({multihash:t})}return Io(bo.decode(e))}function Io(e){try{const t=Gs(e);if(t.code===Zs.code){if(t.digest.length===vo)return new xo({multihash:t});if(t.digest.length===_o)return new So({multihash:t})}if(t.code===to.code)return new ko({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==wo)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===to.code)return new ko({multihash:e.multihash});if(t.code===Zs.code){if(t.digest.length===vo)return new xo({multihash:e.multihash});if(t.digest.length===_o)return new So({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(oo.decode(e))}throw new Error("Supplied PeerID CID is invalid")}function Co(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return Z.enabled(`${e}:trace`)&&null!=Z.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=Z(`${e}:trace`)),Object.assign(Z(e),{error:Z(`${e}:error`),trace:t})}Z.formatters.b=e=>null==e?"undefined":Vi.baseEncode(e),Z.formatters.t=e=>null==e?"undefined":es.baseEncode(e),Z.formatters.m=e=>null==e?"undefined":ls.baseEncode(e),Z.formatters.p=e=>null==e?"undefined":e.toString(),Z.formatters.c=e=>null==e?"undefined":e.toString(),Z.formatters.k=e=>null==e?"undefined":e.toString(),Z.formatters.a=e=>null==e?"undefined":e.toString();var Po=r(23247);class To{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(e,t,r){this.gossip=e,this.msgIdToStrFn=r;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,r=!1){const{msgIdStr:n}=e;return!this.msgs.has(n)&&(this.msgs.set(n,{message:t,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),r||this.notValidatedCount++,!0)}observeDuplicate(e,t){const r=this.msgs.get(e);r&&!r.validated&&r.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const r=this.msgs.get(e);if(!r)return null;const n=(r.iwantCounts.get(t)??0)+1;return r.iwantCounts.set(t,n),{msg:r.message,count:n}}getGossipIDs(e){const t=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach((r=>{const n=this.msgs.get(r.msgIdStr);if(n&&n.validated&&e.has(r.topic)){let e=t.get(r.topic);e||(e=[],t.set(r.topic,e)),e.push(r.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;const{message:r,originatingPeers:n}=t;return t.validated=!0,t.originatingPeers=new Set,{message:r,originatingPeers:n}}shift(){this.history[this.history.length-1].forEach((e=>{const t=this.msgs.get(e.msgIdStr);t&&(this.msgs.delete(e.msgIdStr),t.validated||this.notValidatedCount--)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}var Do=r(64482);const{RPC:Ro}=Do,Bo="/floodsub/1.0.0",Mo="/meshsub/1.0.0",Oo="/meshsub/1.1.0",No=5e3;function Lo(e){if(e.length<=1)return e;for(let t=0;t<e.length;t++){const r=Math.floor(Math.random()*Math.floor(e.length)),n=e[t];e[t]=e[r],e[r]=n}return e}function Uo(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function jo(e=0){return null!=globalThis.Buffer?.allocUnsafe?Uo(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function zo(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Fo=zo("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Ko=zo("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=jo((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var $o={utf8:Fo,"utf-8":Fo,hex:yo.base16,latin1:Ko,ascii:Ko,binary:Ko,...yo};function Vo(e,t="utf8"){const r=$o[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function Wo(e){return Vo(e,"base64")}r(3068),r(97450);var qo=r(3832);function Ho(e,t="utf8"){const r=$o[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Uo(globalThis.Buffer.from(e,"utf-8"))}var Go=r(4101);const Jo=32,Yo=64,Zo=32;function Xo(e,t){const r=new Uint8Array(Yo);for(let n=0;n<Zo;n++)r[n]=e[n],r[Zo+n]=t[n];return r}function Qo(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=jo(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return Uo(r)}var ea={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const ta={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function ra(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=ea.get();return r*=8,{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),h=a.getRandomValues(new Uint8Array(n)),l={name:t,iv:h};let f;if("string"==typeof c&&(c=Ho(c)),0===c.length){f=await a.subtle.importKey("jwk",ta,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{f=await a.subtle.importKey("jwk",ta,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const d=await a.subtle.encrypt(l,f,e);return Qo([u,l.iv,new Uint8Array(d)])},decrypt:async function(e,c){const u=e.subarray(0,s),h=e.subarray(s,s+n),l=e.subarray(s+n),f={name:t,iv:h};let d;if("string"==typeof c&&(c=Ho(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{d=await a.subtle.importKey("jwk",ta,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(f,d,l);return new Uint8Array(p)}}}(),n=await r.encrypt(e,t);return ls.encode(n)}var na,ia,sa,oa,aa=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(na||(na={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(ia||(ia={})),function(e){e.codec=()=>(0,aa.Ji)(ia)}(na||(na={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),na.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=na.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(sa||(sa={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),na.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=na.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(oa||(oa={}));class ca{_key;constructor(e){this._key=pa(e,Jo)}async verify(e,t){return async function(e,t,r){return Go.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return sa.encode({Type:na.Ed25519,Data:this.marshal()}).subarray()}equals(e){return go(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}}class ua{_key;_publicKey;constructor(e,t){this._key=pa(e,Yo),this._publicKey=pa(t,Jo)}async sign(e){return async function(e,t){const r=e.subarray(0,Zo);return Go.UN.sign(t,r)}(this._key,e)}get public(){return new ca(this._publicKey)}marshal(){return this._key}get bytes(){return oa.encode({Type:na.Ed25519,Data:this.marshal()}).subarray()}equals(e){return go(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}async id(){const e=Zs.digest(this.public.bytes);return Vi.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return ra(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function ha(e){if(e.length>Yo){const t=(e=pa(e,Yo+Jo)).subarray(0,Yo),r=e.subarray(Yo,e.length);return new ua(t,r)}const t=(e=pa(e,Yo)).subarray(0,Yo),r=e.subarray(Jo);return new ua(t,r)}function la(e){return e=pa(e,Jo),new ca(e)}async function fa(){const{privateKey:e,publicKey:t}=await async function(){const e=Go.UN.utils.randomPrivateKey(),t=Go.UN.getPublicKey(e);return{privateKey:Xo(e,t),publicKey:t}}();return new ua(e,t)}async function da(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==Zo)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=Go.UN.getPublicKey(t);return{privateKey:Xo(t,r),publicKey:r}}(e);return new ua(t,r)}function pa(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new Di.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}r(97116),r(15764);function ya(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Qo([new Uint8Array(t-r.length),r])}return Vo(r,"base64url")}function ga(e){const t=function(e,t){let r=Ho(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Qo([new Uint8Array(t-r.length),r])}return r}(e);return new qo.jsbn.BigInteger(Vo(t,"base16"),16)}const ma={"P-256":256,"P-384":384,"P-521":521};Object.keys(ma).join(" / ");r(63219);const ba="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function wa(e){if(isNaN(e)||e<=0)throw new Di.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(ba&&"function"==typeof ba.getRandomValues)return ba.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}r(28095);function va(e,t){return t.map((t=>ga(e[t])))}async function _a(e){const t=[await ea.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await ka(e)],r=await Ea({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function Ea(e){if(null==e.privateKey||null==e.publicKey)throw new Di.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([ea.get().subtle.exportKey("jwk",e.privateKey),ea.get().subtle.exportKey("jwk",e.publicKey)])}async function ka(e){return ea.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function xa(e,t,r,n){const i=t?function(e){return qo.pki.setRsaPublicKey(...va(e,["n","e"]))}(e):function(e){return qo.pki.setRsaPrivateKey(...va(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Ho(n(Vo(Uint8Array.from(r),"ascii"),i),"ascii")}function Sa(e){if("RSA"!==e.kty)throw new Di.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new Di.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*Ho(e.n,"base64url").length}const Aa=8192;class Ia{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await ea.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return ea.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=qo.pki.publicKeyToAsn1({n:ga(e.n),e:ga(e.e)});return Ho(qo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return sa.encode({Type:na.RSA,Data:this.marshal()}).subarray()}encrypt(e){return xa(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return go(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}}class Ca{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return wa(16)}async sign(e){return async function(e,t){const r=await ea.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await ea.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new Di.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Ia(this._publicKey)}decrypt(e){return xa(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=qo.pki.privateKeyToAsn1({n:ga(e.n),e:ga(e.e),d:ga(e.d),p:ga(e.p),q:ga(e.q),dP:ga(e.dp),dQ:ga(e.dq),qInv:ga(e.qi)});return Ho(qo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return oa.encode({Type:na.RSA,Data:this.marshal()}).subarray()}equals(e){return go(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}async id(){return Vo(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new qo.util.ByteBuffer(this.marshal()),r=qo.asn1.fromDer(t),n=qo.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return qo.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return ra(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Pa(e){const t=function(e){const t=qo.asn1.fromDer(Vo(e,"ascii")),r=qo.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:ya(r.n),e:ya(r.e),d:ya(r.d),p:ya(r.p),q:ya(r.q),dp:ya(r.dP),dq:ya(r.dQ),qi:ya(r.qInv),alg:"RS256"}}(e);if(Sa(t)>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await _a(t);return new Ca(r.privateKey,r.publicKey)}function Ta(e){const t=function(e){const t=qo.asn1.fromDer(Vo(e,"ascii")),r=qo.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:ya(r.n),e:ya(r.e)}}(e);if(Sa(t)>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Ia(t)}async function Da(e){if(Sa(e)>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await _a(e);return new Ca(t.privateKey,t.publicKey)}async function Ra(e){if(e>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await ea.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await Ea(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Ca(t.privateKey,t.publicKey)}var Ba=r(60533);function Ma(e){try{Ba.kA.ProjectivePoint.fromHex(e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Oa{_key;constructor(e){Ma(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await to.digest(r);return Ba.kA.verify(t,n,e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Ba.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return sa.encode({Type:na.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return go(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}}class Na{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return Ba.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Ba.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Ma(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await to.digest(t);try{return Ba.kA.sign(r,e).toDERRawBytes()}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Oa(this._publicKey)}marshal(){return this._key}get bytes(){return oa.encode({Type:na.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return go(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}async id(){return Vo(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return ra(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function La(e){return new Na(e)}function Ua(e){return new Oa(e)}async function ja(){const e=Ba.kA.utils.randomPrivateKey();return new Na(e)}const za={rsa:A,ed25519:S,secp256k1:I};function Fa(e){const t=Object.keys(za).join(" / ");return new Di.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function Ka(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return za[e];throw Fa(e)}function $a(e){const t=sa.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case na.RSA:return za.rsa.unmarshalRsaPublicKey(r);case na.Ed25519:return za.ed25519.unmarshalEd25519PublicKey(r);case na.Secp256k1:return za.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Fa(t.Type??"unknown")}}async function Va(e){const t=oa.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case na.RSA:return za.rsa.unmarshalRsaPrivateKey(r);case na.Ed25519:return za.ed25519.unmarshalEd25519PrivateKey(r);case na.Secp256k1:return za.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Fa(t.Type??"RSA")}}var Wa,qa,Ha,Ga,Ja,Ya=r(92679);function Za(e){switch(e){case Ya.Ct.Ignore:return Ha.Ignore;case Ya.Ct.Reject:return Ha.Reject}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(Wa||(Wa={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(qa||(qa={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(Ha||(Ha={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(Ga||(Ga={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(Ja||(Ja={}));const Xa="ERR_INVALID_PEER_SCORE_PARAMS",Qa={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},ec={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function tc(e={}){return{...Qa,...e,topics:e.topics?Object.entries(e.topics).reduce(((e,[t,r])=>(e[t]=function(e={}){return{...ec,...e}}(r),e)),{}):{}}}function rc(e){if(e.topicWeight<0)throw new Di.sv("invalid topic weight; must be >= 0",Xa);if(0===e.timeInMeshQuantum)throw new Di.sv("invalid TimeInMeshQuantum; must be non zero",Xa);if(e.timeInMeshWeight<0)throw new Di.sv("invalid TimeInMeshWeight; must be positive (or 0 to disable)",Xa);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new Di.sv("invalid TimeInMeshQuantum; must be positive",Xa);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new Di.sv("invalid TimeInMeshCap; must be positive",Xa);if(e.firstMessageDeliveriesWeight<0)throw new Di.sv("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",Xa);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new Di.sv("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",Xa);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new Di.sv("invalid FirstMessageDeliveriesCap; must be positive",Xa);if(e.meshMessageDeliveriesWeight>0)throw new Di.sv("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",Xa);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new Di.sv("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",Xa);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new Di.sv("invalid MeshMessageDeliveriesCap; must be positive",Xa);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new Di.sv("invalid MeshMessageDeliveriesThreshold; must be positive",Xa);if(e.meshMessageDeliveriesWindow<0)throw new Di.sv("invalid MeshMessageDeliveriesWindow; must be non-negative",Xa);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new Di.sv("invalid MeshMessageDeliveriesActivation; must be at least 1s",Xa);if(e.meshFailurePenaltyWeight>0)throw new Di.sv("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",Xa);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new Di.sv("invalid MeshFailurePenaltyDecay; must be between 0 and 1",Xa);if(e.invalidMessageDeliveriesWeight>0)throw new Di.sv("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",Xa);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new Di.sv("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",Xa)}const nc={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function ic(e={}){return{...nc,...e}}function sc(e,t,r,n){let i=0;Object.entries(t.topics).forEach((([e,t])=>{const n=r.topics[e];if(void 0===n)return;let s=0;if(t.inMesh){let e=t.meshTime/n.timeInMeshQuantum;e>n.timeInMeshCap&&(e=n.timeInMeshCap),s+=e*n.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>n.firstMessageDeliveriesCap&&(o=n.firstMessageDeliveriesCap),s+=o*n.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n.meshMessageDeliveriesThreshold){const e=n.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;s+=e*e*n.meshMessageDeliveriesWeight}s+=t.meshFailurePenalty*n.meshFailurePenaltyWeight;s+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*n.invalidMessageDeliveriesWeight,i+=s*n.topicWeight})),r.topicScoreCap>0&&i>r.topicScoreCap&&(i=r.topicScoreCap);const s=r.appSpecificScore(e);if(i+=s*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),s=t?t.size:0;if(s>r.IPColocationFactorThreshold){const e=s-r.IPColocationFactorThreshold;i+=e*e*r.IPColocationFactorWeight}})),t.behaviourPenalty>r.behaviourPenaltyThreshold){const e=t.behaviourPenalty-r.behaviourPenaltyThreshold;i+=e*e*r.behaviourPenaltyWeight}return i}var oc,ac=r(45001);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(oc||(oc={}));class cc{records;queue;constructor(){this.records=new Map,this.queue=new ac}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:oc.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const r={msgId:e,expire:Date.now()+12e4};return this.queue.push(r),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function uc(e,t,r=(()=>!0)){const n=new Set;if(t<=0)return n;for(const i of e){if(n.size>=t)break;r(i)&&(n.add(i),e.delete(i))}return n}class hc extends Map{getDefault;constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}const lc=Co("libp2p:gossipsub:score");class fc{params;metrics;peerStats=new Map;peerIPs=new hc((()=>new Set));scoreCache=new Map;deliveryRecords=new cc;_backgroundInterval;scoreCacheValidityMs;computeScore;constructor(e,t,r){this.params=e,this.metrics=t,function(e){for(const[t,r]of Object.entries(e.topics))try{rc(r)}catch(e){throw new Di.sv(`invalid score parameters for topic ${t}: ${e.message}`,Xa)}if(e.topicScoreCap<0)throw new Di.sv("invalid topic score cap; must be positive (or 0 for no cap)",Xa);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new Di.sv("missing application specific score function",Xa);if(e.IPColocationFactorWeight>0)throw new Di.sv("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",Xa);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new Di.sv("invalid IPColocationFactorThreshold; must be at least 1",Xa);if(e.behaviourPenaltyWeight>0)throw new Di.sv("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",Xa);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new Di.sv("invalid BehaviourPenaltyDecay; must be between 0 and 1",Xa);if(e.decayInterval<1e3)throw new Di.sv("invalid DecayInterval; must be at least 1s",Xa);if(e.decayToZero<=0||e.decayToZero>=1)throw new Di.sv("invalid DecayToZero; must be between 0 and 1",Xa)}(e),this.scoreCacheValidityMs=r.scoreCacheValidityMs,this.computeScore=r.computeScore??sc}get size(){return this.peerStats.size}start(){this._backgroundInterval?lc("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),lc("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),lc("stopped")):lc("Peer score already stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([e,t])=>[e,t])))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((r,n)=>{r.connected?(Object.entries(r.topics).forEach((([r,n])=>{const i=this.params.topics[r];void 0!==i&&(n.firstMessageDeliveries*=i.firstMessageDeliveriesDecay,n.firstMessageDeliveries<t&&(n.firstMessageDeliveries=0),n.meshMessageDeliveries*=i.meshMessageDeliveriesDecay,n.meshMessageDeliveries<t&&(n.meshMessageDeliveries=0),n.meshFailurePenalty*=i.meshFailurePenaltyDecay,n.meshFailurePenalty<t&&(n.meshFailurePenalty=0),n.invalidMessageDeliveries*=i.invalidMessageDeliveriesDecay,n.invalidMessageDeliveries<t&&(n.invalidMessageDeliveries=0),n.inMesh&&(n.meshTime=e-n.graftTime,n.meshTime>i.meshMessageDeliveriesActivation&&(n.meshMessageDeliveriesActive=!0)))})),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<t&&(r.behaviourPenalty=0)):e>r.expire&&(this.removeIPsForPeer(n,r.knownIPs),this.peerStats.delete(n),this.scoreCache.delete(n))}))}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const r=Date.now(),n=this.scoreCache.get(e);if(n&&n.cacheUntil>r)return n.score;this.metrics?.scoreFnRuns.inc();const i=this.computeScore(e,t,this.params,this.peerIPs),s=r+this.scoreCacheValidityMs;return n?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-n.score)),n.score=i,n.cacheUntil=s):this.scoreCache.set(e,{score:i,cacheUntil:s}),i}addPenalty(e,t,r){const n=this.peerStats.get(e);n&&(n.behaviourPenalty+=t,this.metrics?.onScorePenalty(r))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.delete(t);const n=this.peerIPs.get(t);n&&(n.delete(e),0===n.size&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0)return this.removeIPsForPeer(e,t.knownIPs),void this.peerStats.delete(e);Object.entries(t.topics).forEach((([e,t])=>{t.firstMessageDeliveries=0;const r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){const e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){const r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){const t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,r){this.markFirstMessageDelivery(e,r);const n=this.deliveryRecords.ensureRecord(t),i=Date.now();n.status===oc.unknown?(n.status=oc.valid,n.validated=i,n.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,r)}))):lc("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-n.firstSeenTsMs,oc[n.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,r,n){switch(n){case Ha.Error:return void this.markInvalidMessageDelivery(e,r);case Ha.Blacklisted:return}const i=this.deliveryRecords.ensureRecord(t);if(i.status===oc.unknown){if(n===Ha.Ignore)return i.status=oc.ignored,void i.peers.clear();i.status=oc.invalid,this.markInvalidMessageDelivery(e,r),i.peers.forEach((e=>{this.markInvalidMessageDelivery(e,r)})),i.peers.clear()}else lc("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeenTsMs,oc[i.status])}duplicateMessage(e,t,r){const n=this.deliveryRecords.ensureRecord(t);if(!n.peers.has(e))switch(n.status){case oc.unknown:n.peers.add(e);break;case oc.valid:n.peers.add(e),this.markDuplicateMessageDelivery(e,r,n.validated);break;case oc.invalid:this.markInvalidMessageDelivery(e,r);case oc.ignored:}}markInvalidMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){let r=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(r,e.firstMessageDeliveries+1),e.inMesh&&(r=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(r,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,r){const n=this.peerStats.get(e);if(n){const e=void 0!==r?Date.now():0,i=this.getPtopicStats(n,t);if(i&&i.inMesh){const n=this.params.topics[t];if(void 0!==r){const i=e-r,s=i>n.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,i,s),s)return}const s=n.meshMessageDeliveriesCap;i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const r of t){const t=this.peerIPs.get(r);t&&(t.delete(e),0===t.size&&this.peerIPs.delete(r))}}getPtopicStats(e,t){let r=e.topics[t];return void 0!==r?r:void 0!==this.params.topics[t]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=r,r):null}}class dc{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(e,t,r){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=r,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const r=t[Math.floor(Math.random()*t.length)],n=this.msgIdToStrFn(r);let i=this.promises.get(n);i||(i=new Map,this.promises.set(n,i));const s=Date.now();i.has(e)||(i.set(e,s+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(n)||this.requestMsByMsg.set(n,s)))}getBrokenPromises(){const e=Date.now(),t=new Map;let r=0;return this.promises.forEach(((n,i)=>{n.forEach(((i,s)=>{i<e&&(t.set(s,(t.get(s)??0)+1),n.delete(s),r++)})),n.size||this.promises.delete(i)})),this.metrics?.iwantPromiseBroken.inc(r),t}deliverMessage(e,t=!1){this.trackMessage(e);const r=this.promises.get(e);r&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,t){this.trackMessage(e),t!==Ha.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[r,n]of this.requestMsByMsg.entries()){if(!(n<e))break;this.requestMsByMsg.delete(r),t++}this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}class pc{entries=new Map;validityMs;constructor(e){this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,r]of this.entries.entries()){if(!(r.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var yc,gc,mc,bc,wc,vc;!function(e){e.forward="forward",e.publish="publish"}(yc||(yc={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(gc||(gc={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Excess="excess"}(mc||(mc={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(bc||(bc={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(wc||(wc={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(vc||(vc={}));r(8925);r(98960);const _c=Ho("libp2p-pubsub:");function Ec(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return((e,t)=>{const r=Ho(t.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(e.length+r.length);return n.set(e,0),n.set(r,e.length),n})(e.from.toBytes(),e.sequenceNumber)}async function kc(e){return await to.encode(e.data)}function xc(e,t,r,n,i){let s=0;const o=new Map;if(Object.entries(t.topics).forEach((([e,t])=>{const n=i.get(e)??"unknown",a=r.topics[e];if(void 0===a)return;let c=o.get(n);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(n,c));let u=0,h=0,l=0,f=0,d=0;if(t.inMesh){u+=Math.max(t.meshTime/a.timeInMeshQuantum,a.timeInMeshCap)*a.timeInMeshWeight}let p=t.firstMessageDeliveries;if(p>a.firstMessageDeliveriesCap&&(p=a.firstMessageDeliveriesCap),h+=p*a.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const e=a.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;l+=e*e*a.meshMessageDeliveriesWeight}f+=t.meshFailurePenalty*a.meshFailurePenaltyWeight;d+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*a.invalidMessageDeliveriesWeight,s+=(u+h+l+f+d)*a.topicWeight,c.p1w+=u,c.p2w+=h,c.p3w+=l,c.p3bw+=f,c.p4w+=d})),r.topicScoreCap>0&&s>r.topicScoreCap){s=r.topicScoreCap;const e=r.topicScoreCap/s;for(const t of o.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,c=0,u=0;a+=r.appSpecificScore(e)*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),i=t?t.size:0;if(i>r.IPColocationFactorThreshold){const e=i-r.IPColocationFactorThreshold;c+=e*e*r.IPColocationFactorWeight}}));return u+=t.behaviourPenalty*t.behaviourPenalty*r.behaviourPenaltyWeight,s+=a+c+u,{byTopic:o,p5w:a,p6w:c,p7w:u,score:s}}class Sc{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Ac{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Sc(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Sc(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class Ic extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Cc(e={}){return Pc((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function Pc(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new Ac,a=(0,nn.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>i?r:(i=!0,null!=e?(e=>(o=new Ac,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,nn.Z)()}))}},return:()=>(o=new Ac,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new Ic)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(l.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return l.readableLength}},r}class Tc extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Dc(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new Tc(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new Tc(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}var Rc=r(9202);class Bc{rawStream;pushable;closeController;maxBufferSize;constructor(e,t,r){this.rawStream=e,this.pushable=Cc({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,(0,Ti.z)(Dc(this.pushable,this.closeController.signal,{returnOnAbort:!0}),(e=>(0,Rc.c)(e)),this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class Mc{source;rawStream;closeController;constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=Dc((0,Ti.z)(this.rawStream,(e=>(0,Rc.J)(e,t))),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var Oc=r(42450);const Nc={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function Lc(e,t){t={...t};const r=Oc.Reader.create(e),n=e.length,i=void 0===n?r.len:r.pos+n,s={};for(;r.pos<i;){const e=r.uint32();switch(e>>>3){case 1:s.subscriptions&&s.subscriptions.length||(s.subscriptions=[]),s.subscriptions.length<t.maxSubscriptions?s.subscriptions.push(Uc(r,r.uint32())):r.skipType(7&e);break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.length<t.maxMessages?s.messages.push(jc(r,r.uint32())):r.skipType(7&e);break;case 3:s.control=zc(r,r.uint32(),t);break;default:r.skipType(7&e)}}return s}function Uc(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topic=e.string();break;default:e.skipType(7&t)}}return n}function jc(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topic=e.string();break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&t)}}if(!n.topic)throw Error("missing required 'topic'");return n}function zc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.length<r.maxControlMessages?i.ihave.push(Fc(e,e.uint32(),r)):e.skipType(7&t);break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.length<r.maxControlMessages?i.iwant.push(Kc(e,e.uint32(),r)):e.skipType(7&t);break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.length<r.maxControlMessages?i.graft.push($c(e,e.uint32())):e.skipType(7&t);break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.length<r.maxControlMessages?i.prune.push(Vc(e,e.uint32(),r)):e.skipType(7&t);break;default:e.skipType(7&t)}}return i}function Fc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:i.topicID=e.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),r.maxIhaveMessageIDs-- >0?i.messageIDs.push(e.bytes()):e.skipType(7&t);break;default:e.skipType(7&t)}}return i}function Kc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),r.maxIwantMessageIDs-- >0?i.messageIDs.push(e.bytes()):e.skipType(7&t);else e.skipType(7&t)}return i}function $c(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();if(t>>>3==1)n.topicID=e.string();else e.skipType(7&t)}return n}function Vc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:i.topicID=e.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),r.maxPeerInfos-- >0?i.peers.push(Wc(e,e.uint32())):e.skipType(7&t);break;case 3:i.backoff=e.uint64();break;default:e.skipType(7&t)}}return i}function Wc(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.peerID=e.bytes();break;case 2:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n}r(9839);var qc=r(57050);var Hc=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Gc=Hc;new Uint8Array(0);const Jc=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Yc{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Zc{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Qc(this,e)}}class Xc{constructor(e){this.decoders=e}or(e){return Qc(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Qc=(e,t)=>new Xc({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class eu{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Yc(e,t,r),this.decoder=new Zc(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const tu=({name:e,prefix:t,encode:r,decode:n})=>new eu(e,t,r,n),ru=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Gc(r,t);return tu({prefix:e,name:t,encode:n,decode:e=>Jc(i(e))})},nu=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>tu({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),iu=tu({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),su=nu({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ou=nu({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),au=ru({prefix:"9",name:"base10",alphabet:"0123456789"}),cu=nu({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uu=nu({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),hu=nu({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lu=nu({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fu=nu({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),du=nu({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pu=nu({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yu=nu({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),gu=nu({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mu=nu({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bu=nu({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),wu=ru({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vu=ru({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),_u=ru({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Eu=ru({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ku=nu({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xu=nu({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Su=nu({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Au=nu({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Iu=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Cu=Iu.reduce(((e,t,r)=>(e[r]=t,e)),[]),Pu=Iu.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Tu=tu({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Cu[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Pu[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var Du=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Mu;)r[n++]=255&t|Ru,t/=128;for(;t&Bu;)r[n++]=255&t|Ru,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Ru=128,Bu=-128,Mu=Math.pow(2,31);var Ou=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Lu)<<s:(n&Lu)*Math.pow(2,s),s+=7}while(n>=Nu);return e.bytes=o-r,i},Nu=128,Lu=127;var Uu=Math.pow(2,7),ju=Math.pow(2,14),zu=Math.pow(2,21),Fu=Math.pow(2,28),Ku=Math.pow(2,35),$u=Math.pow(2,42),Vu=Math.pow(2,49),Wu=Math.pow(2,56),qu=Math.pow(2,63),Hu={encode:Du,decode:Ou,encodingLength:function(e){return e<Uu?1:e<ju?2:e<zu?3:e<Fu?4:e<Ku?5:e<$u?6:e<Vu?7:e<Wu?8:e<qu?9:10}};const Gu=(e,t,r=0)=>(Hu.encode(e,t,r),t),Ju=e=>Hu.encodingLength(e),Yu=(e,t)=>{const r=t.byteLength,n=Ju(e),i=n+Ju(r),s=new Uint8Array(i+r);return Gu(e,s,0),Gu(r,s,n),s.set(t,i),new Zu(e,r,t,s)};class Zu{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Xu=({name:e,code:t,encode:r})=>new Qu(e,t,r);class Qu{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Yu(this.code,t):t.then((e=>Yu(this.code,e)))}throw Error("Unknown type, must be binary type")}}const eh=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),th=Xu({name:"sha2-256",code:18,encode:eh("SHA-256")}),rh=Xu({name:"sha2-512",code:19,encode:eh("SHA-512")}),nh=Jc,ih={code:0,name:"identity",encode:nh,digest:e=>Yu(0,nh(e))},sh="raw",oh=85,ah=e=>Jc(e),ch=e=>Jc(e),uh=new TextEncoder,hh=new TextDecoder,lh="json",fh=512,dh=e=>uh.encode(JSON.stringify(e)),ph=e=>JSON.parse(hh.decode(e));new WeakMap;class yh{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return yh.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return yh.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return yh.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return src_cid_format(this,e)}toJSON(){return{"/":src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof yh)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new yh(e,r,n,i||src_cid_encodeCID(e,r,n.bytes))}if(!0===t[src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return yh.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new yh(e,t,r,r.bytes);case 1:{const n=src_cid_encodeCID(e,t,r.bytes);return new yh(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return yh.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return yh.create(1,e,t)}static decode(e){const[t,r]=yh.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=yh.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?yh.createV0(s):yh.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=src_cid_parseCIDtoBytes(e,t),i=yh.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const gh={...C,...P,...T,...D,...R,...B,...M,...O,...N,...L};function mh(e=0){return null!=globalThis.Buffer?.allocUnsafe?function(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function bh(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const wh=bh("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),vh=bh("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=mh((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var _h={utf8:wh,"utf-8":wh,hex:gh.base16,latin1:vh,ascii:vh,binary:vh,...gh};function Eh(e,t="utf8"){const r=_h[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var kh=r(49736);const xh=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Sh=-1,Ah={},Ih={};function Ch(e){if("number"==typeof e){if(null!=Ih[e])return Ih[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=Ah[e])return Ah[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Sh,"ip6zone"],[43,8,"ipcidr"],[53,Sh,"dns",!0],[54,Sh,"dns4",!0],[55,Sh,"dns6",!0],[56,Sh,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Sh,"unix",!1,!0],[421,Sh,"ipfs"],[421,Sh,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Sh,"garlic64"],[448,0,"tls"],[449,Sh,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Sh,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Sh,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);Ih[t.code]=t,Ah[t.name]=t}));Ch("ip4"),Ch("ip6"),Ch("ipcidr");function Ph(e,t){switch(Ch(e).code){case 4:case 41:return function(e){const t=xh(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!kh.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Rh(t);case 6:case 273:case 33:case 132:return Dh(t).toString();case 421:return function(e){const t=qc.Jx(e),r=e.slice(qc.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return Eh(r,"base58btc")}(t);case 444:case 445:return Bh(t);case 466:return function(e){const t=qc.Jx(e),r=e.slice(qc.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+Eh(r,"base64url")}(t);default:return Eh(t,"base16")}}const Th=Object.values(yo).map((e=>e.decoder));!function(){let e=Th[0].or(Th[1]);Th.slice(2).forEach((t=>e=e.or(t)))}();function Dh(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Rh(e){const t=qc.Jx(e);if((e=e.slice(qc.P$(t))).length!==t)throw new Error("inconsistent lengths");return Eh(e)}function Bh(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${Eh(t,"base32")}:${Dh(r)}`}var Mh;!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(Mh||(Mh={}));var Oh;!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(Oh||(Oh={}));class Nh extends Po.v{globalSignaturePolicy;multicodecs=[Oo,Mo];publishConfig;dataTransform;peers=new Set;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=Cc({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;components;directPeerInitial=null;static multicodec=Oo;opts;decodeRpcLimits;metrics;status={code:Oh.stopped};maxInboundStreams;maxOutboundStreams;allowedTopics;heartbeatTimer=null;constructor(e,t={}){super();const r={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,unsubcribeBackoff:1e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:tc(t.scoreParams),scoreThresholds:ic(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=r.decodeRpcLimits??Nc,this.globalSignaturePolicy=r.globalSignaturePolicy??Ya.xq,r.fallbackToFloodsub&&this.multicodecs.push(Bo),this.log=Co(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map((e=>e.id.toString()))),this.seenCache=new pc({validityMs:r.seenTTL}),this.publishedMessageIds=new pc({validityMs:r.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Ya.xq:this.msgIdFn=Ec;break;case Ya.Q_:this.msgIdFn=kc}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new pc({validityMs:r.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??Wo,this.mcache=t.messageCache||new To(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const e=Math.max(...Object.values(r.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),1e3),n=function(e,t,r){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:e.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:e.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:e.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:e.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:e.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:e.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:e.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:e.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:e.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:e.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",labelNames:["topic"],buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:e.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:e.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:e.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:e.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:e.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:e.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:e.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:e.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:e.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:e.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:e.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:e.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:e.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:e.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:e.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),iwantPromiseUntracked:e.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:e.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,r){const n=this.toTopic(e);switch(t){case gc.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:n},r);break;case gc.Random:this.meshPeerInclusionEventsRandom.inc({topic:n},r);break;case gc.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:n},r);break;case gc.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:n},r);break;case gc.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:n},r);break;case gc.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:n},r);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:n},r)}},onRemoveFromMesh(e,t,r){const n=this.toTopic(e);switch(t){case mc.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:n},r);break;case mc.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:n},r);break;case mc.Prune:this.meshPeerChurnEventsPrune.inc({topic:n},r);break;case mc.Excess:this.meshPeerChurnEventsExcess.inc({topic:n},r);break;default:this.meshPeerChurnEventsUnknown.inc({topic:n},r)}},onReportValidation(e,t,r){if(this.asyncValidationMcacheHit.inc({hit:null!=e?"hit":"miss"}),null!=e){const r=this.toTopic(e.message.topic);switch(t){case Ya.Ct.Accept:this.acceptedMessagesTotal.inc({topic:r});break;case Ya.Ct.Ignore:this.ignoredMessagesTotal.inc({topic:r});break;case Ya.Ct.Reject:this.rejectedMessagesTotal.inc({topic:r});break;default:this.unknownValidationResultsTotal.inc({topic:r})}}null!=r?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-r)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,r){const n=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:n},t),this.ihaveRcvNotSeenMsgids.inc({topic:n},r)},onIwantRcv(e,t){for(const[t,r]of e){const e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const r=this.toTopic(e);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},t)},onPublishMsg(e,t,r,n,i){const s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},r*n),this.msgPublishPeersByTopic.inc({topic:s},r),this.directPeersPublishedTotal.inc({topic:s},t.direct),this.floodsubPeersPublishedTotal.inc({topic:s},t.floodsub),this.meshPeersPublishedTotal.inc({topic:s},t.mesh),this.fanoutPeersPublishedTotal.inc({topic:s},t.fanout),this.msgPublishTime.observe({topic:s},i/1e3)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvError(e){const t=this.toTopic(e);this.msgReceivedError.inc({topic:t},1)},onPrevalidationResult(e,t){const r=this.toTopic(e);switch(t){case Ja.duplicate:this.prevalidationDuplicateTotal.inc({topic:r});break;case Ja.invalid:this.prevalidationInvalidTotal.inc({topic:r});break;case Ja.valid:this.prevalidationValidTotal.inc({topic:r});break;default:this.prevalidationUnknownTotal.inc({topic:r})}},onMsgRecvInvalid(e,t){const r=this.toTopic(e),n=t.reason===Ha.Error?t.error:t.reason;this.msgReceivedInvalid.inc({error:n},1),this.msgReceivedInvalidByTopic.inc({topic:r},1)},onDuplicateMsgDelivery(e,t,r){if(this.duplicateMsgDeliveryDelay.observe(t/1e3),r){const t=this.toTopic(e);this.duplicateMsgLateDelivery.inc({topic:t},1)}},onPublishDuplicateMsg(e){const t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),e.messages&&this.rpcRecvMessage.inc(e.messages.length),e.control&&(this.rpcRecvControl.inc(1),e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),e.messages&&this.rpcSentMessage.inc(e.messages.length),e.control){const t=e.control.ihave?.length??0,r=e.control.iwant?.length??0,n=e.control.graft?.length??0,i=e.control.prune?.length??0;t>0&&this.rpcSentIHave.inc(t),r>0&&this.rpcSentIWant.inc(r),n>0&&this.rpcSentGraft.inc(n),i>0&&this.rpcSentPrune.inc(i),(t>0||r>0||n>0||i>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let r=0,n=0,i=0,s=0;for(const o of e)o>=t.graylistThreshold&&r++,o>=t.publishThreshold&&n++,o>=t.gossipThreshold&&i++,o>=0&&s++;this.peersByScoreThreshold.set({threshold:vc.graylist},r),this.peersByScoreThreshold.set({threshold:vc.publish},n),this.peersByScoreThreshold.set({threshold:vc.gossip},i),this.peersByScoreThreshold.set({threshold:vc.mesh},s),this.score.set(e)},registerScoreWeights(e){for(const[t,r]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},r.p1w),this.scoreWeights.set({topic:t,p:"p2"},r.p2w),this.scoreWeights.set({topic:t,p:"p3"},r.p3w),this.scoreWeights.set({topic:t,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:t,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const r=new Map;e.forEach(((e,t)=>{const n=this.topicStrToLabel.get(t)??"unknown";let i=r.get(n);i||(i=new Set,r.set(n,i)),e.forEach((e=>i?.add(e)))}));for(const[e,n]of r){const r=[];n.forEach((e=>{r.push(t.get(e)??0)})),this.scorePerMesh.set({topic:e},r)}}}}(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});n.mcacheSize.addCollect((()=>this.onScrapeMetrics(n)));for(const e of this.multicodecs)n.protocolsEnabled.set({protocol:e},1);this.metrics=n}else this.metrics=null;this.gossipTracer=new dc(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new fc(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=r.allowedTopics?new Set(r.allowedTopics):null}getPeers(){return[...this.peers.keys()].map((e=>Ao(e)))}isStarted(){return this.status.code===Oh.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await async function(e,t){switch(e){case Ya.xq:{if(!t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await Va(t.privateKey);return{type:qa.Signing,author:t,key:t.publicKey,privateKey:e}}case Ya.Q_:return{type:qa.Anonymous};default:throw new Error(`Unknown signature policy "${e}"`)}}(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=Cc({objectMode:!0}),(0,Ti.z)(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:r}of e)await this.createOutboundStream(t,r)})).catch((e=>this.log.error("outbound inflight queue error",e))),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.peerStore.merge(e.id,{multiaddrs:e.addrs})})));const e=this.components.registrar;await Promise.all(this.multicodecs.map((t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const t={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)},r=await Promise.all(this.multicodecs.map((r=>e.register(r,t)))),n=setTimeout(this.runHeartbeat,100);this.status={code:Oh.started,registrarTopologyIds:r,heartbeatTimeout:n,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>await this.connect(e))))})).catch((e=>{this.log(e)}))}),1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Oh.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:Oh.stopped};const t=this.components.registrar;await Promise.all(this.multicodecs.map((e=>t.unhandle(e)))),e.forEach((e=>t.unregister(e))),this.outboundInflightQueue.end();for(const e of this.streamsOutbound.values())e.close();this.streamsOutbound.clear();for(const e of this.streamsInbound.values())e.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const r=t.remotePeer;this.addPeer(r,t.direction,t.remoteAddr),this.createInboundStream(r,e),this.outboundInflightQueue.push({peerId:r,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.status}),this.isStarted()&&"open"===t.status&&(this.addPeer(e,t.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{const n=new Bc(await t.newStream(this.multicodecs),(e=>this.log.error("outbound pipe error",e)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(r,n);const i=n.protocol;i===Bo&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}async createInboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(!this.peers.has(r))return;const n=this.streamsInbound.get(r);void 0!==n&&(this.log("replacing existing inbound steam %s",r),n.close()),this.log("create inbound stream %s",r);const i=new Mc(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,i),this.pipePeerReadStream(e,i.source).catch((e=>this.log(e)))}addPeer(e,t,r){const n=e.toString();if(!this.peers.has(n)){this.log("new peer %p",e),this.peers.add(n),this.score.addPeer(n);const i=function(e){for(const t of e.tuples())switch(t[0]){case Mh.ip4:case Mh.ip6:return Ph(t[0],t[1])}return null}(r);null!==i?this.score.addIP(n,i):this.log("Added peer has no IP in current address %s %s",n,r.toString()),this.outbound.has(n)||this.outbound.set(n,"outbound"===t)}}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const r=this.streamsOutbound.get(t),n=this.streamsInbound.get(t);r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close(),n?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const e of this.topics.values())e.delete(t);for(const[e,r]of this.mesh)!0===r.delete(t)&&this.metrics?.onRemoveFromMesh(e,mc.Dc,1);for(const e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===Oh.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map((e=>Ao(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await(0,Ti.z)(t,(async t=>{for await(const r of t)try{const t=r.subarray(),n=Lc(t,this.decodeRpcLimits);if(this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,n)}catch(e){this.metrics?.onRpcRecvError(),this.log(e)}else this.handleReceivedRpc(e,n).catch((e=>{this.metrics?.onRpcRecvError(),this.log(e)}))}catch(e){this.metrics?.onRpcDataError(),this.log(e)}}))}catch(t){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(t,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void this.metrics?.rpcRecvNotAccepted.inc();const r=t.subscriptions?t.subscriptions.length:0,n=t.messages?t.messages.length:0;let i=0,s=0,o=0,a=0;if(t.control&&(t.control.ihave&&(i=t.control.ihave.length),t.control.iwant&&(s=t.control.iwant.length),t.control.graft&&(o=t.control.graft.length),t.control.prune&&(a=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${r} messages ${n} ihave ${i} iwant ${s} graft ${o} prune ${a}`),t.subscriptions&&t.subscriptions.length>0){const r=[];t.subscriptions.forEach((t=>{const n=t.topic,i=!0===t.subscribe;if(null!=n){if(this.allowedTopics&&!this.allowedTopics.has(n))return;this.handleReceivedSubscription(e,n,i),r.push({topic:n,subscribe:i})}})),this.dispatchEvent(new Po.A("subscription-change",{detail:{peerId:e,subscriptions:r}}))}if(t.messages)for(const r of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(r.topic))continue;const t=this.handleReceivedMessage(e,r).catch((e=>{this.metrics?.onMsgRecvError(r.topic),this.log(e)}));this.opts.awaitRpcMessageHandler&&await t}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,r){this.log("subscription update from %p topic %s",e,t);let n=this.topics.get(t);null==n&&(n=new Set,this.topics.set(t,n)),r?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const r=await this.validateReceivedMessage(e,t);switch(this.metrics?.onPrevalidationResult(t.topic,r.code),r.code){case Ja.duplicate:return this.score.duplicateMessage(e.toString(),r.msgIdStr,t.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),void this.mcache.observeDuplicate(r.msgIdStr,e.toString());case Ja.invalid:if(r.msgIdStr){const n=r.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,r.reason),this.gossipTracer.rejectMessage(n,r.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void this.metrics?.onMsgRecvInvalid(t.topic,r);case Ja.valid:if(this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)){this.components.peerId.equals(e)&&!this.opts.emitSelf||(super.dispatchEvent(new Po.A("gossipsub:message",{detail:{propagationSource:e,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new Po.A("message",{detail:r.msg})))}this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const r=this.fastMsgIdFn?.(t),n=void 0!==r?this.fastMsgIdCache?.get(r):void 0;if(n)return{code:Ja.duplicate,msgIdStr:n};const i=await async function(e,t){switch(e){case Ya.Q_:return null!=t.signature?{valid:!1,error:Ga.SignaturePresent}:null!=t.seqno?{valid:!1,error:Ga.SeqnoPresent}:null!=t.key?{valid:!1,error:Ga.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case Ya.xq:{if(null==t.seqno)return{valid:!1,error:Ga.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:Ga.InvalidSeqno};if(null==t.signature)return{valid:!1,error:Ga.InvalidSignature};if(null==t.from)return{valid:!1,error:Ga.InvalidPeerId};let e,i;try{e=Io(t.from)}catch(e){return{valid:!1,error:Ga.InvalidPeerId}}if(t.key){if(i=$a(t.key),void 0!==e.publicKey&&!go(i.bytes,e.publicKey))return{valid:!1,error:Ga.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:Ga.InvalidPeerId};i=$a(e.publicKey)}const s={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},o=Qo([_c,Ro.Message.encode(s).finish()]);return await i.verify(o,t.signature)?{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${Vo(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:t.key??(r=i,Ka(n=(n??"rsa").toLowerCase()),r.bytes)}}:{valid:!1,error:Ga.InvalidSignature}}}var r,n}(this.globalSignaturePolicy,t);if(!i.valid)return{code:Ja.invalid,reason:Ha.Error,error:i.error};const s=i.message;try{this.dataTransform&&(s.data=this.dataTransform.inboundTransform(t.topic,s.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:Ja.invalid,reason:Ha.Error,error:Ga.TransformFailed}}const o=await this.msgIdFn(s),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(void 0!==r&&this.fastMsgIdCache){this.fastMsgIdCache.put(r,a)&&this.metrics?.fastMsgIdCacheCollision.inc()}if(this.seenCache.has(a))return{code:Ja.duplicate,msgIdStr:a};this.seenCache.put(a);const u=this.topicValidators.get(t.topic);if(null!=u){let t;try{t=await u(e,s)}catch(e){const r=e.code;"ERR_TOPIC_VALIDATOR_IGNORE"===r&&(t=Ya.Ct.Ignore),t="ERR_TOPIC_VALIDATOR_REJECT"===r?Ya.Ct.Reject:Ya.Ct.Ignore}if(t!==Ya.Ct.Accept)return{code:Ja.invalid,reason:Za(t),msgIdStr:a}}return{code:Ja.valid,messageId:c,msg:s}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,r){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:r})))})}async handleControlMessage(e,t){if(void 0===t)return;const r=t.ihave?this.handleIHave(e,t.ihave):[],n=t.iwant?this.handleIWant(e,t.iwant):[],i=t.graft?await this.handleGraft(e,t.graft):[];if(t.prune&&await this.handlePrune(e,t.prune),!r.length&&!n.length&&!i.length)return;const s=this.sendRpc(e,{messages:n,control:{iwant:r,prune:i}}),o=r[0]?.messageIDs;o&&(s?this.gossipTracer.addPromise(e,o):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),r=this.acceptFromWhitelist.get(e);if(r&&r.messagesAccepted<128&&r.acceptUntil>=t)return r.messagesAccepted+=1,!0;const n=this.score.score(e);return n>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),n>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:wc.LowScore}),[];const n=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,n),n>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:wc.MaxIhave}),[];const i=this.iasked.get(e)??0;if(i>=No)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:wc.MaxIasked}),[];const s=new Map;if(t.forEach((({topicID:e,messageIDs:t})=>{if(!e||!t||!this.mesh.has(e))return;let r=0;t.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(s.set(t,e),r++)})),this.metrics?.onIhaveRcv(e,t.length,r)})),!s.size)return[];let o=s.size;o+i>No&&(o=No-i),this.log("IHAVE: Asking for %d out of %d messages from %s",o,s.size,e);let a=Array.from(s.values());return Lo(a),a=a.slice(0,o),this.iasked.set(e,i+o),[{messageIDs:a}]}handleIWant(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];const n=new Map,i=new Map;let s=0;return t.forEach((({messageIDs:t})=>{t&&t.forEach((t=>{const r=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(r,e);null!=o?(i.set(o.msg.topic,1+(i.get(o.msg.topic)??0)),o.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):n.set(r,o.msg)):s++}))})),this.metrics?.onIwantRcv(i,s),n.size?(this.log("IWANT: Sending %d messages to %s",n.size,e),Array.from(n.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const r=[],n=this.score.score(e),i=Date.now();let s=this.opts.doPX;if(t.forEach((({topicID:t})=>{if(!t)return;const o=this.mesh.get(t);if(!o)return void(s=!1);if(o.has(e))return;if(this.direct.has(e))return this.log("GRAFT: ignoring request from direct peer %s",e),r.push(t),void(s=!1);const a=this.backoff.get(t)?.get(e);if("number"==typeof a&&i<a){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,bc.GraftBackoff),s=!1;const n=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return i<n&&this.score.addPenalty(e,1,bc.GraftBackoff),this.addBackoff(e,t),void r.push(t)}return n<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,n,t),r.push(t),s=!1,void this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(r.push(t),void this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),void this.metrics?.onAddToMesh(t,gc.Subscribed,1))})),!r.length)return[];return await Promise.all(r.map((t=>this.makePrune(e,t,s,false))))}async handlePrune(e,t){const r=this.score.score(e);for(const{topicID:n,backoff:i,peers:s}of t){if(null==n)continue;const t=this.mesh.get(n);if(!t)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,n),this.score.prune(e,n),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(n,mc.Prune,1)),"number"==typeof i&&i>0?this.doAddBackoff(e,n,1e3*i):this.addBackoff(e,n),s&&s.length){if(r<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,r,n);continue}await this.pxConnect(s)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,r){let n=this.backoff.get(t);n||(n=new Map,this.backoff.set(t,n));const i=Date.now()+r;(n.get(e)??0)<i&&n.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,bc.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!=0)return;const e=Date.now();this.backoff.forEach(((t,r)=>{t.forEach(((r,n)=>{r+1*this.opts.heartbeatInterval<e&&t.delete(n)})),0===t.size&&this.backoff.delete(r)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>await this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&(Lo(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(!e.peerID)return;const r=Io(e.peerID),n=r.toString();if(!this.peers.has(n))if(e.signedPeerRecord)try{if(!await this.components.peerStore.consumePeerRecord(e.signedPeerRecord,r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(n)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(n)}))),t.length&&await Promise.all(t.map((async e=>await this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=Ao(e),r=await this.components.connectionManager.openConnection(t);for(const e of this.multicodecs)for(const n of this.components.registrar.getTopologies(e))n.onConnect?.(t,r)}subscribe(e){if(this.status.code!==Oh.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Oh.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e)}join(e){if(this.status.code!==Oh.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,r=this.backoff.get(e),n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach((e=>{this.direct.has(e)||!(this.score.score(e)>=0)||r&&r.has(e)||t.add(e)})),this.metrics?.onAddToMesh(e,gc.Fanout,t.size)),t.size<this.opts.D){const n=t.size;this.getRandomGossipPeers(e,this.opts.D,(e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0&&(!r||!r.has(e)))).forEach((e=>{t.add(e)})),this.metrics?.onAddToMesh(e,gc.Random,t.size-n)}this.mesh.set(e,t),t.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}leave(e){if(this.status.code!==Oh.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map((async t=>(this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e))))).catch((e=>{this.log("Error sending prunes to mesh peers",e)})),this.mesh.delete(e))}selectPeersToForward(e,t,r){const n=new Set,i=this.topics.get(e);i&&(this.direct.forEach((e=>{i.has(e)&&t!==e&&!r?.has(e)&&n.add(e)})),this.floodsubPeers.forEach((e=>{i.has(e)&&t!==e&&!r?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&n.add(e)})));const s=this.mesh.get(e);return s&&s.size>0&&s.forEach((e=>{t===e||r?.has(e)||n.add(e)})),n}selectPeersToPublish(e){const t=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},n=this.topics.get(e);if(n)if(this.opts.floodPublish)n.forEach((e=>{this.direct.has(e)?(t.add(e),r.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));else{this.direct.forEach((e=>{n.has(e)&&(t.add(e),r.direct++)})),this.floodsubPeers.forEach((e=>{n.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));const i=this.mesh.get(e);if(i&&i.size>0)i.forEach((e=>{t.add(e),r.mesh++}));else{const n=this.fanout.get(e);if(n&&n.size>0)n.forEach((e=>{t.add(e),r.fanout++}));else{const n=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));n.size>0&&(this.fanout.set(e,n),n.forEach((e=>{t.add(e),r.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:r}}forwardMessage(e,t,r,n){r&&this.score.deliverMessage(r,e,t.topic);const i=this.selectPeersToForward(t.topic,r,n);i.forEach((e=>{this.sendRpc(e,{messages:[t]})})),this.metrics?.onForwardMsg(t.topic,i.size)}async publish(e,t,r){const n=Date.now(),i=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:s,msg:o}=await async function(e,t,r,n){switch(e.type){case qa.Signing:{const i={from:e.author.toBytes(),data:n,seqno:wa(8),topic:t,signature:void 0,key:void 0},s=Qo([_c,Ro.Message.encode(i).finish()]);return i.signature=await e.privateKey.sign(s),i.key=e.key,{raw:i,msg:{type:"signed",from:e.author,data:r,sequenceNumber:BigInt(`0x${Vo(i.seqno,"base16")}`),topic:t,signature:i.signature,key:i.key}}}case qa.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:t}}}}(this.publishConfig,e,t,i),a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(u)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:h,tosendCount:l}=this.selectPeersToPublish(e),f=!0===this.opts.emitSelf&&this.subscriptions.has(e),d=r?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(0===h.size&&!d&&!f)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},s,!0),this.publishedMessageIds.put(c);for(const e of h){this.sendRpc(e,{messages:[s]})||h.delete(e)}const p=Date.now()-n;return this.metrics?.onPublishMsg(e,l,h.size,null!=s.data?s.data.length:0,p),f&&(h.add(this.components.peerId.toString()),super.dispatchEvent(new Po.A("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:o}})),super.dispatchEvent(new Po.A("message",{detail:o}))),{recipients:Array.from(h.values()).map((e=>Ao(e)))}}reportMessageValidationResult(e,t,r){let n;if(r===Ya.Ct.Accept){if(n=this.mcache.validate(e),null!=n){const{message:r,originatingPeers:i}=n;this.score.deliverMessage(t,e,r.topic),this.forwardMessage(e,n.message,t,i)}}else if(n=this.mcache.remove(e),n){const i=Za(r),{message:s,originatingPeers:o}=n;this.score.rejectMessage(t,e,s.topic,i);for(const t of o)this.score.rejectMessage(t,e,s.topic,i)}const i=this.score.messageFirstSeenTimestampMs(e);this.metrics?.onReportValidation(n,r,i)}sendGraft(e,t){const r=[{topicID:t}];this.sendRpc(e,{control:{graft:r}})}async sendPrune(e,t){const r=[await this.makePrune(e,t,this.opts.doPX,!0)];this.sendRpc(e,{control:{prune:r}})}sendRpc(e,t){const r=this.streamsOutbound.get(e);if(!r)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const n=this.control.get(e);n&&(this.piggybackControl(e,t,n),this.control.delete(e));const i=this.gossip.get(e);i&&(this.piggybackGossip(e,t,i),this.gossip.delete(e));const s=Ro.encode(t).finish();try{r.push(s)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),n&&this.control.set(e,n),i&&this.gossip.set(e,i),!1}return this.metrics?.onRpcSent(t,s.length),!0}piggybackControl(e,t,r){if(r.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(const n of r.graft)n.topicID&&this.mesh.get(n.topicID)?.has(e)&&t.control.graft.push(n)}if(r.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(const n of r.prune)n.topicID&&!this.mesh.get(n.topicID)?.has(e)&&t.control.prune.push(n)}}piggybackGossip(e,t,r){t.control||(t.control={}),t.control.ihave=r}async sendGraftPrune(e,t,r){const n=this.opts.doPX;for(const[i,s]of e){const e=s.map((e=>({topicID:e})));let o=[];const a=t.get(i);a&&(o=await Promise.all(a.map((async e=>await this.makePrune(i,e,n&&!r.get(i),false)))),t.delete(i)),this.sendRpc(i,{control:{graft:e,prune:o}})}for(const[e,i]of t){const t=await Promise.all(i.map((async t=>await this.makePrune(e,t,n&&!r.get(e),false))));this.sendRpc(e,{control:{prune:t}})}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[r,n]of e)this.doEmitGossip(r,n,t.get(r)??[])}doEmitGossip(e,t,r){if(!r.length)return;if(Lo(r),r.length>No&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),!t.size)return;let n=this.opts.Dlazy;const i=.25*t.size;let s=t;i>n&&(n=i),n>s.size?n=s.size:s=Lo(Array.from(s)).slice(0,n),s.forEach((t=>{let n=r;r.length>No&&(n=Lo(n.slice()).slice(0,No)),this.pushGossip(t,{topicID:e,messageIDs:n})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);const r=this.gossip.get(e)||[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,r,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===Mo)return{topicID:t,peers:[]};const i=n?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,s=i/1e3;if(this.doAddBackoff(e,t,i),!r)return{topicID:t,peers:[],backoff:s};const o=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),a=await Promise.all(Array.from(o).map((async e=>{const t=Ao(e);let r;try{r=await this.components.peerStore.get(t)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return{peerID:t.toBytes(),signedPeerRecord:r?.peerRecordEnvelope}})));return{topicID:t,peers:a,backoff:s}}runHeartbeat=()=>{const e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=e&&e(),this.status.code===Oh.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}}))};async heartbeat(){const{D:e,Dlo:t,Dhi:r,Dscore:n,Dout:i,fanoutTTL:s}=this.opts;this.heartbeatTicks++;const o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},c=new Map,u=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const l=new Map;this.mesh.forEach(((s,o)=>{const f=this.topics.get(o),d=new Set,p=new Set;if(l.set(o,p),f){const e=Lo(Array.from(f)),t=this.backoff.get(o);for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!s.has(r)&&!this.direct.has(r)){const e=a(r);t&&t.has(r)||!(e>=0)||d.add(r),e>=this.opts.scoreThresholds.gossipThreshold&&p.add(r)}}}const y=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),s.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&p.add(e),this.metrics?.onRemoveFromMesh(o,t,1);const r=u.get(e);r?r.push(o):u.set(e,[o])},g=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),s.add(e),p.delete(e),this.metrics?.onAddToMesh(o,t,1);const r=c.get(e);r?r.push(o):c.set(e,[o])};if(s.forEach((e=>{const t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),y(e,mc.BadScore),h.set(e,!0))})),s.size<t){const t=function(e,t){return uc(e,t,(()=>!0))}(d,e-s.size);t.forEach((e=>{g(e,gc.NotEnough)}))}if(s.size>r){let t=Array.from(s);t.sort(((e,t)=>a(t)-a(e))),t=t.slice(0,n).concat(Lo(t.slice(n)));let r=0;if(t.slice(0,e).forEach((e=>{this.outbound.get(e)&&r++})),r<i){const n=e=>{const r=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=r};if(r>0){let i=r;for(let r=1;r<e&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}let i=e-r;for(let r=e;r<t.length&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}t.slice(e).forEach((e=>{y(e,mc.Excess)}))}if(s.size>=t){let e=0;if(s.forEach((t=>{this.outbound.get(t)&&e++})),e<i){uc(d,i-e,(e=>!0===this.outbound.get(e))).forEach((e=>{g(e,gc.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&s.size>1){const e=Array.from(s).sort(((e,t)=>a(e)-a(t))),t=Math.floor(s.size/2),r=a(e[t]);if(r<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=uc(d,this.opts.opportunisticGraftPeers,(e=>a(e)>r));for(const t of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,o),g(t,gc.Opportunistic)}}}));const f=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+s<f&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((t,r)=>{const n=this.topics.get(r);t.forEach((e=>{(!n.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)}));const i=this.topics.get(r),s=[],o=new Set;if(l.set(r,o),i){const e=Lo(Array.from(i));for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!t.has(r)&&!this.direct.has(r)){const e=a(r);e>=this.opts.scoreThresholds.publishThreshold&&s.push(r),e>=this.opts.scoreThresholds.gossipThreshold&&o.add(r)}}}if(t.size<e){const r=e-t.size;s.slice(0,r).forEach((e=>{t.add(e),o?.delete(e)}))}})),this.emitGossip(l),await this.sendGraftPrune(c,u,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new Po.A("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,r=(()=>!0)){const n=this.topics.get(e);if(!n)return new Set;let i=[];return n.forEach((e=>{const t=this.streamsOutbound.get(e);t&&this.multicodecs.includes(t.protocol)&&r(e)&&i.push(e)})),i=Lo(i),t>0&&i.length>t&&(i=i.slice(0,t)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;const r=Date.now();e.connectedPeersBackoffSec.reset();for(const n of this.backoff.values()){t+=n.size;for(const[t,i]of n.entries())this.peers.has(t)&&e.connectedPeersBackoffSec.observe(Math.max(0,i-r)/1e3)}e.cacheSize.set({cache:"backoff"},t);for(const[t,r]of this.topics)e.topicPeersCount.set({topicStr:t},r.size);for(const[t,r]of this.mesh)e.meshPeerCounts.set({topicStr:t},r.size);const n=[],i=new Map;e.behaviourPenalty.reset();for(const t of this.peers.keys()){const r=this.score.score(t);n.push(r),i.set(t,r),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);const s=function(e,t,r,n,i){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of e){const e=t.get(o);if(e){const t=xc(o,e,r,n,i);for(const[e,r]of t.byTopic){let t=s.byTopic.get(e);t||(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(e,t)),t.p1w.push(r.p1w),t.p2w.push(r.p2w),t.p3w.push(r.p3w),t.p3bw.push(r.p3bw),t.p4w.push(r.p4w)}s.p5w.push(t.p5w),s.p6w.push(t.p6w),s.p7w.push(t.p7w),s.score.push(t.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}}function Lh(e={}){return t=>new Nh(t,e)}var Uh=r(99644),jh=r(79071),zh=r(44913),Fh=r(18135),Kh=r(62298);class $h extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Vh(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new $h(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new $h(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}class Wh{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class qh{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Wh(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Wh(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class Hh extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Gh(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new qh,a=(0,nn.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>i?r:(i=!0,null!=e?(e=>(o=new qh,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,nn.Z)()}))}},return:()=>(o=new qh,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new Hh)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(l.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return l.readableLength}},r}var Jh=r(28050);function Yh(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}const Zh=ae({prefix:"9",name:"base10",alphabet:"0123456789"}),Xh=ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Qh=ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),el=ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),tl=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),rl=tl.reduce(((e,t,r)=>(e[r]=t,e)),[]),nl=tl.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const il=oe({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=rl[t]),"")},decode:function(e){const t=[];for(const r of e){const e=nl[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),sl=ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ol=oe({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),al={...H,...V,...q,...K,...$,...n,...c,...i,...s,...W};function cl(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const ul=cl("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),hl=cl("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer?.allocUnsafe?Yh(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var ll={utf8:ul,"utf-8":ul,hex:al.base16,latin1:hl,ascii:hl,binary:hl,...al};function fl(e,t="utf8"){const r=ll[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Yh(globalThis.Buffer.from(e,"utf-8"))}function dl(e,t="utf8"){const r=ll[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var pl,yl=r(62308);!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(pl||(pl={}));const gl=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),ml=Object.freeze({NEW_STREAM:pl.NEW_STREAM,MESSAGE:pl.MESSAGE_INITIATOR,CLOSE:pl.CLOSE_INITIATOR,RESET:pl.RESET_INITIATOR}),bl=Object.freeze({MESSAGE:pl.MESSAGE_RECEIVER,CLOSE:pl.CLOSE_RECEIVER,RESET:pl.RESET_RECEIVER}),wl=1<<20;class vl{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=wl,t=4194304){this._buffer=new yl.H,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){if("ERR_MSG_TOO_BIG"===e.code)throw e;break}const{id:e,type:r,length:n,offset:i}=this._headerInfo;if(this._buffer.length-i<n)break;const s={id:e,type:r};r!==pl.NEW_STREAM&&r!==pl.MESSAGE_INITIATOR&&r!==pl.MESSAGE_RECEIVER||(s.data=this._buffer.sublist(i,i+n)),t.push(s),this._buffer.consume(i+n),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:r}=kl(e),{value:n,offset:i}=kl(e,r),s=7&t;if(null==gl[s])throw new Error(`Invalid type received: ${s}`);if(n>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:s,offset:r+i,length:n}}}const _l=128,El=127;function kl(e,t=0){let r,n=0,i=0,s=t;const o=e.length;do{if(s>=o||i>49)throw t=0,new RangeError("Could not decode varint");r=e.get(s++),n+=i<28?(r&El)<<i:(r&El)*Math.pow(2,i),i+=7}while(r>=_l);return{value:n,offset:t=s-t}}const xl=1048576,Sl=(e,t)=>{t.append(e)};var Al=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=new yl.H,n=!1,i=(0,nn.Z)(),s=Number(t?.size??xl);if((isNaN(s)||0===s||s<0)&&(s=xl),s!==Math.round(s))throw new Error("Batch size must be an integer");const o=t?.yieldAfter??0,a=t?.serialize??Sl;for(Promise.resolve().then((async()=>{try{let t;for await(const n of e)a(n,r),r.byteLength>=s?(clearTimeout(t),i.resolve()):t=setTimeout((()=>{i.resolve()}),o);clearTimeout(t),i.resolve()}catch(e){i.reject(e)}finally{n=!0}}));!n;)if(await i.promise,i=(0,nn.Z)(),r.byteLength>0){const e=r;r=new yl.H,yield e.subarray()}}():function*(){const r=new yl.H;let n=Number(t?.size??xl);if((isNaN(n)||0===n||n<0)&&(n=xl),n!==Math.round(n))throw new Error("Batch size must be an integer");const i=t?.serialize??Sl;for(const t of e)i(t,r),r.byteLength>=n&&(yield r.subarray(0,n),r.consume(n));r.byteLength>0&&(yield r.subarray())}()};function Il(e){return new Uint8Array(e)}const Cl=10240;const Pl=new class{_pool;_poolOffset;constructor(){this._pool=Il(Cl),this._poolOffset=0}write(e,t){const r=this._pool;let n=this._poolOffset;qc.cv(e.id<<3|e.type,r,n),n+=qc.P$(e.id<<3|e.type),e.type!==pl.NEW_STREAM&&e.type!==pl.MESSAGE_INITIATOR&&e.type!==pl.MESSAGE_RECEIVER||null==e.data?(qc.cv(0,r,n),n+=qc.P$(0)):(qc.cv(e.data.length,r,n),n+=qc.P$(e.data.length));const i=r.subarray(this._poolOffset,n);Cl-n<100?(this._pool=Il(Cl),this._poolOffset=0):this._poolOffset=n,t.append(i),e.type!==pl.NEW_STREAM&&e.type!==pl.MESSAGE_INITIATOR&&e.type!==pl.MESSAGE_RECEIVER||null==e.data||t.append(e.data)}};var Tl=r(77399);class Dl extends Tl.b{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types="outbound"===e.direction?ml:bl,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:ml.NEW_STREAM,data:new yl.H(fl(this.name))})}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}const Rl=xe("libp2p:mplex");function Bl(e){const t={...e,type:`${gl[e.type]} (${e.type})`};return e.type===pl.NEW_STREAM&&(t.data=dl(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==pl.MESSAGE_INITIATOR&&e.type!==pl.MESSAGE_RECEIVER||(t.data=dl(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class Ml{protocol="/mplex/6.7.0";sink;source;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;constructor(e){e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.closeTimeout=e.closeTimeout??500,this.sink=this._createSink(),this._source=function(e={}){return Gh((e=>{let t;const r=[];for(;!e.isEmpty()&&(t=e.shift(),null!=t);){if(null!=t.error)throw t.error;!1===t.done&&r.push(t.value)}return null==t?{done:!0}:{done:!0===t.done,value:r}}),e)}({objectMode:!0,onEnd:()=>{for(const e of this._streams.initiators.values())e.destroy();for(const e of this._streams.receivers.values())e.destroy()}}),this.source=(0,Ti.z)(this._source,(e=>async function*(e,t=0){if(null!=t&&0!==t)yield*Al(e,{size:t,serialize:(e,t)=>{for(const r of e)Pl.write(r,t)}});else for await(const t of e){const e=new yl.H;for(const r of t)Pl.write(r,e);yield e.subarray()}}(e,this._init.minSendBytes))),this.closeController=new AbortController,this.rateLimiter=new Jh.RateLimiterMemory({points:e.disconnectThreshold??5,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}async close(e){if(this.closeController.signal.aborted)return;const t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map((async e=>e.close({signal:t})))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(e){this.abort(e)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach((t=>{t.abort(e)})),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){const{id:t,name:r,type:n,registry:i}=e;if(Rl("new %s stream %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??1024))throw new Di.sv("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(i.has(t))throw new Error(`${n} stream ${t} already exists!`);const s=function(e){const{id:t,name:r,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=wl}=e;return new Dl({id:"initiator"===s?`i${t}`:`r${t}`,streamId:t,name:`${null==r?t:r}`,direction:"initiator"===s?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:xe(`libp2p:mplex:stream:${s}:${t}`)})}({id:t,name:r,send:async e=>{Rl.enabled&&Rl.trace("%s stream %s send",n,t,Bl(e)),this._source.push(e)},type:n,onEnd:()=>{Rl("%s stream with id %s and protocol %s ended",n,t,s.protocol),i.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(s)},maxMsgSize:this._init.maxMsgSize});return i.set(t,s),s}_createSink(){return async e=>{try{e=Vh(e,this.closeController.signal,{returnOnAbort:!0});const t=new vl(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const r of e)for(const e of t.write(r))await this._handleIncoming(e);this._source.end()}catch(e){Rl("error in sink",e),this._source.end(e)}}}async _handleIncoming(e){const{id:t,type:r}=e;if(Rl.enabled&&Rl.trace("incoming message",Bl(e)),e.type===pl.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??1024)){Rl("too many inbound streams open"),this._source.push({id:t,type:pl.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return Rl("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this.abort(new Error("Too many open streams"))}return}const r=this._newReceiverStream({id:t,name:dl(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(r))}const n=(1==(1&r)?this._streams.initiators:this._streams.receivers).get(t);if(null==n){Rl("missing stream %s for message type %s",t,gl[r]);try{await this.rateLimiter.consume("missing-stream",1)}catch{return Rl("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),void this.abort(new Error("Too many messages for missing streams"))}return}const i=this._init.maxStreamBufferSize??4194304;try{switch(r){case pl.MESSAGE_INITIATOR:case pl.MESSAGE_RECEIVER:if(n.sourceReadableLength()>i)throw this._source.push({id:e.id,type:r===pl.MESSAGE_INITIATOR?pl.RESET_RECEIVER:pl.RESET_INITIATOR}),new Di.sv("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");n.sourcePush(e.data);break;case pl.CLOSE_INITIATOR:case pl.CLOSE_RECEIVER:n.remoteCloseWrite();break;case pl.RESET_INITIATOR:case pl.RESET_RECEIVER:n.reset();break;default:Rl("unknown message type %s",r)}}catch(e){Rl.error("error while processing message",e),n.abort(e)}}}class Ol{protocol="/mplex/6.7.0";_init;constructor(e={}){this._init=e}createStreamMuxer(e={}){return new Ml({...e,...this._init})}}function Nl(e={}){return()=>new Ol(e)}var Ll=r(46177),Ul=r(57392),jl=r(15624);function zl(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Fl(e=0){return null!=globalThis.Buffer?.allocUnsafe?zl(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Kl(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const $l=Kl("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Vl=Kl("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Fl((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Wl={utf8:$l,"utf-8":$l,hex:al.base16,latin1:Vl,ascii:Vl,binary:Vl,...al};function ql(e,t="utf8"){const r=Wl[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):zl(globalThis.Buffer.from(e,"utf-8"))}function Hl(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const Gl=32,Jl=64,Yl=32;function Zl(e,t){const r=new Uint8Array(Jl);for(let n=0;n<Yl;n++)r[n]=e[n],r[Yl+n]=t[n];return r}function Xl(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Fl(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return zl(r)}var Ql={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const ef={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function tf(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=Ql.get();return r*=8,{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),h=a.getRandomValues(new Uint8Array(n)),l={name:t,iv:h};let f;if("string"==typeof c&&(c=ql(c)),0===c.length){f=await a.subtle.importKey("jwk",ef,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{f=await a.subtle.importKey("jwk",ef,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const d=await a.subtle.encrypt(l,f,e);return Xl([u,l.iv,new Uint8Array(d)])},decrypt:async function(e,c){const u=e.subarray(0,s),h=e.subarray(s,s+n),l=e.subarray(s+n),f={name:t,iv:h};let d;if("string"==typeof c&&(c=ql(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{d=await a.subtle.importKey("jwk",ef,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(f,d,l);return new Uint8Array(p)}}}(),n=await r.encrypt(e,t);return ve.encode(n)}var rf,nf,sf,of;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(rf||(rf={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(nf||(nf={})),function(e){e.codec=()=>(0,aa.Ji)(nf)}(rf||(rf={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),rf.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=rf.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(sf||(sf={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),rf.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=rf.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(of||(of={}));class af{_key;constructor(e){this._key=df(e,Gl)}async verify(e,t){return async function(e,t,r){return Go.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return sf.encode({Type:rf.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}}class cf{_key;_publicKey;constructor(e,t){this._key=df(e,Jl),this._publicKey=df(t,Gl)}async sign(e){return async function(e,t){const r=e.subarray(0,Yl);return Go.UN.sign(t,r)}(this._key,e)}get public(){return new af(this._publicKey)}marshal(){return this._key}get bytes(){return of.encode({Type:rf.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}async id(){const e=Qe.digest(this.public.bytes);return be.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return tf(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function uf(e){if(e.length>Jl){const t=(e=df(e,Jl+Gl)).subarray(0,Jl),r=e.subarray(Jl,e.length);return new cf(t,r)}const t=(e=df(e,Jl)).subarray(0,Jl),r=e.subarray(Gl);return new cf(t,r)}function hf(e){return e=df(e,Gl),new af(e)}async function lf(){const{privateKey:e,publicKey:t}=await async function(){const e=Go.UN.utils.randomPrivateKey(),t=Go.UN.getPublicKey(e);return{privateKey:Zl(e,t),publicKey:t}}();return new cf(e,t)}async function ff(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==Yl)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=Go.UN.getPublicKey(t);return{privateKey:Zl(t,r),publicKey:r}}(e);return new cf(t,r)}function df(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new Di.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}function pf(e,t="utf8"){const r=Wl[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function yf(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Xl([new Uint8Array(t-r.length),r])}return pf(r,"base64url")}function gf(e){const t=function(e,t){let r=ql(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Xl([new Uint8Array(t-r.length),r])}return r}(e);return new qo.jsbn.BigInteger(pf(t,"base16"),16)}const mf={"P-256":256,"P-384":384,"P-521":521};Object.keys(mf).join(" / ");const bf="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function wf(e){if(isNaN(e)||e<=0)throw new Di.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(bf&&"function"==typeof bf.getRandomValues)return bf.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}function vf(e,t){return t.map((t=>gf(e[t])))}async function _f(e){const t=[await Ql.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await kf(e)],r=await Ef({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function Ef(e){if(null==e.privateKey||null==e.publicKey)throw new Di.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Ql.get().subtle.exportKey("jwk",e.privateKey),Ql.get().subtle.exportKey("jwk",e.publicKey)])}async function kf(e){return Ql.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function xf(e,t,r,n){const i=t?function(e){return qo.pki.setRsaPublicKey(...vf(e,["n","e"]))}(e):function(e){return qo.pki.setRsaPrivateKey(...vf(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return ql(n(pf(Uint8Array.from(r),"ascii"),i),"ascii")}function Sf(e){if("RSA"!==e.kty)throw new Di.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new Di.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*ql(e.n,"base64url").length}const Af=8192;class If{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await Ql.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Ql.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=qo.pki.publicKeyToAsn1({n:gf(e.n),e:gf(e.e)});return ql(qo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return sf.encode({Type:rf.RSA,Data:this.marshal()}).subarray()}encrypt(e){return xf(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}}class Cf{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return wf(16)}async sign(e){return async function(e,t){const r=await Ql.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Ql.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new Di.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new If(this._publicKey)}decrypt(e){return xf(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=qo.pki.privateKeyToAsn1({n:gf(e.n),e:gf(e.e),d:gf(e.d),p:gf(e.p),q:gf(e.q),dP:gf(e.dp),dQ:gf(e.dq),qInv:gf(e.qi)});return ql(qo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return of.encode({Type:rf.RSA,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}async id(){return pf(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new qo.util.ByteBuffer(this.marshal()),r=qo.asn1.fromDer(t),n=qo.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return qo.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return tf(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Pf(e){const t=function(e){const t=qo.asn1.fromDer(pf(e,"ascii")),r=qo.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:yf(r.n),e:yf(r.e),d:yf(r.d),p:yf(r.p),q:yf(r.q),dp:yf(r.dP),dq:yf(r.dQ),qi:yf(r.qInv),alg:"RS256"}}(e);if(Sf(t)>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await _f(t);return new Cf(r.privateKey,r.publicKey)}function Tf(e){const t=function(e){const t=qo.asn1.fromDer(pf(e,"ascii")),r=qo.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:yf(r.n),e:yf(r.e)}}(e);if(Sf(t)>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new If(t)}async function Df(e){if(Sf(e)>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await _f(e);return new Cf(t.privateKey,t.publicKey)}async function Rf(e){if(e>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Ql.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await Ef(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Cf(t.privateKey,t.publicKey)}function Bf(e){try{Ba.kA.ProjectivePoint.fromHex(e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Mf{_key;constructor(e){Bf(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await nt.digest(r);return Ba.kA.verify(t,n,e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Ba.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return sf.encode({Type:rf.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}}class Of{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return Ba.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Ba.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Bf(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await nt.digest(t);try{return Ba.kA.sign(r,e).toDERRawBytes()}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Mf(this._publicKey)}marshal(){return this._key}get bytes(){return of.encode({Type:rf.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}async id(){return pf(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return tf(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Nf(e){return new Of(e)}function Lf(e){return new Mf(e)}async function Uf(){const e=Ba.kA.utils.randomPrivateKey();return new Of(e)}const jf={rsa:J,ed25519:G,secp256k1:Y};function zf(e){const t=Object.keys(jf).join(" / ");return new Di.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function Ff(e){const t=sf.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case rf.RSA:return jf.rsa.unmarshalRsaPublicKey(r);case rf.Ed25519:return jf.ed25519.unmarshalEd25519PublicKey(r);case rf.Secp256k1:return jf.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw zf(t.Type??"unknown")}}function Kf(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const $f=Symbol.for("nodejs.util.inspect.custom"),Vf=Object.values(al).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),al.identity.decoder),Wf=114,qf=36,Hf=37;class Gf{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Ri.N]=!0;toString(){return null==this.string&&(this.string=be.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Jr.createV1(Wf,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Kf(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??Vf,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Ye(be.decode(`z${e}`));return e.startsWith("12D")?new Yf({multihash:t}):e.startsWith("16U")?new Zf({multihash:t}):new Jf({multihash:t})}return Xf(Vf.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return Kf(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[$f](){return`PeerId(${this.toString()})`}}class Jf extends Gf{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Yf extends Gf{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class Zf extends Gf{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function Xf(e){try{const t=Ye(e);if(t.code===Qe.code){if(t.digest.length===qf)return new Yf({multihash:t});if(t.digest.length===Hf)return new Zf({multihash:t})}if(t.code===nt.code)return new Jf({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Wf)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===nt.code)return new Jf({multihash:e.multihash});if(t.code===Qe.code){if(t.digest.length===qf)return new Yf({multihash:e.multihash});if(t.digest.length===Hf)return new Zf({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Jr.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var Qf=r(32114),ed=r(79297),td=r(41690);const rd="ERR_UNRECOGNIZED_VALIDITY",nd="ERR_SIGNATURE_VERIFICATION",id="ERR_UNRECOGNIZED_FORMAT",sd="ERR_UNDEFINED_PARAMETER",od="ERR_RECORD_TOO_LARGE";var ad;!function(e){let t,r,n;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(r||(r={})),function(e){e.codec=()=>(0,aa.Ji)(r)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==n&&(n=(0,aa.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.value&&(r.uint32(10),r.bytes(t.value)),null!=t.signatureV1&&(r.uint32(18),r.bytes(t.signatureV1)),null!=t.validityType&&(r.uint32(24),e.ValidityType.codec().encode(t.validityType,r)),null!=t.validity&&(r.uint32(34),r.bytes(t.validity)),null!=t.sequence&&(r.uint32(40),r.uint64(t.sequence)),null!=t.ttl&&(r.uint32(48),r.uint64(t.ttl)),null!=t.pubKey&&(r.uint32(58),r.bytes(t.pubKey)),null!=t.signatureV2&&(r.uint32(66),r.bytes(t.signatureV2)),null!=t.data&&(r.uint32(74),r.bytes(t.data)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.value=t.bytes();break;case 2:n.signatureV1=t.bytes();break;case 3:n.validityType=e.ValidityType.codec().decode(t);break;case 4:n.validity=t.bytes();break;case 5:n.sequence=t.uint64();break;case 6:n.ttl=t.uint64();break;case 7:n.pubKey=t.bytes();break;case 8:n.signatureV2=t.bytes();break;case 9:n.data=t.bytes();break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(ad||(ad={}));const cd=xe("ipns:utils"),ud=(0,jr.m)("/ipns/");const hd=async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw cd.error(e),Qf(e,sd)}let r;if(null!=t.pubKey){try{r=Ff(t.pubKey)}catch(e){throw cd.error(e),e}if(!(await async function(e,t){return e.length===qf?new Yf({multihash:Je(Qe.code,e),privateKey:t}):e.length===Hf?new Zf({multihash:Je(Qe.code,e),privateKey:t}):new Jf({multihash:await nt.digest(e),publicKey:e,privateKey:t})}(t.pubKey)).equals(e))throw Qf(new Error("Embedded public key did not match PeerID"),"ERR_INVALID_EMBEDDED_KEY")}else null!=e.publicKey&&(r=Ff(e.publicKey));if(null!=r)return r;throw Qf(new Error("no public key is available"),sd)};function ld(e){const t=ad.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw Qf(new Error("missing data or signatureV2"),nd);const r=dd(t.data),n=pd(r.Value);let i;try{i=ed.fromDate(function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw new Error("Invalid format");const n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),u=parseInt(r[7].padEnd(6,"0").slice(0,3),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}((0,Ur.B)(r.Validity)))}catch(e){throw cd.error("unrecognized validity format (not an rfc3339 format)"),Qf(new Error("unrecognized validity format (not an rfc3339 format)"),id)}if(null!=t.value&&null!=t.signatureV1)return yd(t),{value:n,validityType:ad.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:n,validityType:ad.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}const fd=e=>Xf(e.slice(ud.length)),dd=e=>{const t=Nr(e);if(0!==t.ValidityType)throw Qf(new Error("Unknown validity type"),rd);return t.ValidityType=ad.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t},pd=e=>{if(null!=e){if((0,Ri.I)(e))return`/ipns/${e.toCID().toString(Vr)}`;if(e instanceof Uint8Array){const t=(0,Ur.B)(e);t.startsWith("/")&&(e=t)}const t=e.toString().trim();if(t.startsWith("/")&&t.length>1)return t;const r=Jr.asCID(e);if(null!=r)return 114===r.code?`/ipns/${r.toString(Vr)}`:`/ipfs/${r.toV1().toString()}`;try{return e instanceof Uint8Array?`/ipfs/${Jr.decode(e).toV1().toString()}`:`/ipfs/${Jr.parse(t).toV1().toString()}`}catch{}}throw Qf(new Error("Value must be a valid content path starting with /"),"ERR_INVALID_VALUE")},yd=e=>{if(null==e.data)throw Qf(new Error("Record data is missing"),"ERR_INVALID_RECORD_DATA");const t=dd(e.data);if(!(0,Kn.f)(t.Value,e.value??new Uint8Array(0)))throw Qf(new Error('Field "value" did not match between protobuf and CBOR'),nd);if(!(0,Kn.f)(t.Validity,e.validity??new Uint8Array(0)))throw Qf(new Error('Field "validity" did not match between protobuf and CBOR'),nd);if(t.ValidityType!==e.validityType)throw Qf(new Error('Field "validityType" did not match between protobuf and CBOR'),nd);if(t.Sequence!==e.sequence)throw Qf(new Error('Field "sequence" did not match between protobuf and CBOR'),nd);if(t.TTL!==e.ttl)throw Qf(new Error('Field "ttl" did not match between protobuf and CBOR'),nd)};function gd(e,t){const r=t.map(((e,t)=>({record:ld(e),index:t})));return r.sort(((e,t)=>{const r=e.record.sequence,n=t.record.sequence;if(r>n)return-1;if(r<n)return 1;const i=e.record.validity.toDate(),s=t.record.validity.toDate();return i.getTime()>s.getTime()?-1:i.getTime()<s.getTime()?1:0})),r[0].index}const md=xe("ipns:validator"),bd=10240,wd=async(e,t)=>{const r=ld(t);let n;try{const t=(e=>{const t=(0,jr.m)("ipns-signature:");return(0,td.z)([t,e])})(r.data);n=await e.verify(t,r.signatureV2)}catch(e){n=!1}if(!n)throw md.error("record signature verification failed"),Qf(new Error("record signature verification failed"),nd);if(r.validityType===ad.ValidityType.EOL){if(r.validity.toDate().getTime()<Date.now())throw md.error("record has expired"),Qf(new Error("record has expired"),"ERR_IPNS_EXPIRED_RECORD")}else if(null!=r.validityType)throw md.error("unrecognized validity type"),Qf(new Error("unrecognized validity type"),rd);md("ipns record for %b is valid",r.value)};async function vd(e,t){if(t.byteLength>bd)throw Qf(new Error("record too large"),od);const r=fd(e),n=ld(t),i=await hd(r,n);await wd(i,t)}var _d=r(76805),Ed=r(69850),kd=r(90704),xd=r(35092),Sd=r(70036);const Ad={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};async function Id(e,t){const r={addresses:{listen:["/webrtc"]},transports:[(0,Ed.f)({discoverRelays:1}),(0,Ll.Z)(),(0,Ll.R)(),(0,jl.d)(),(0,Ul.E)()],connectionEncryption:[(0,Uh.t)()],streamMuxers:[(0,jh.P)(),Nl()],peerDiscovery:[(0,zh.U)(Ad)],contentRouters:[(0,Fh.$)("https://cid.contact")],services:{identify:(0,xd.HA)(),autoNAT:(0,_d.D)(),pubsub:Lh(),dcutr:(0,kd.P)(),dht:(0,Kh.p7)({clientMode:!0,validators:{ipns:vd},selectors:{ipns:gd}}),ping:(0,Sd.J)()}};return t=t??{},(0,Pi.N)({datastore:e,...r,...t,start:!1})}const Cd="2.0.3",Pd="helia",Td=xe("helia");async function Dd(e={}){const t=e.datastore??new Ae.ar,r=e.blockstore??new Se.DA;let n;n=function(e){if(null==e)return!1;return["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every((t=>"function"==typeof e[t]))}(e.libp2p)?e.libp2p:await Id(t,e.libp2p);const i=new Ci({...e,datastore:t,blockstore:r,libp2p:n});return!1!==e.start&&await i.start(),function(e){try{if(null==e.libp2p.services.identify.host.agentVersion.match(/js-libp2p\/\d+\.\d+\.\d+\sUserAgent=/))return;e.libp2p.services.identify.host.agentVersion=`${Pd}/${Cd} ${e.libp2p.services.identify.host.agentVersion}`}catch(e){Td.error("could not add Helia to agent version",e)}}(i),i}},4424:function(e,t,r){"use strict";r.d(t,{Lj:function(){return m},X3:function(){return g}});const n=(e,t)=>t.some((t=>e instanceof t));let i,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap;let l={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return p(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(y(this),t),p(o.get(this))}:function(...t){return p(e.apply(y(this),t))}:function(t,...r){const n=e.call(y(this),t,...r);return c.set(n,t.sort?t.sort():[t]),p(n)}}function d(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));a.set(e,t)}(e),n(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,l):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(p(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),h.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=d(e);return t!==e&&(u.set(e,t),h.set(t,e)),t}const y=e=>h.get(e);function g(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=p(o);return n&&o.addEventListener("upgradeneeded",(e=>{n(p(o.result),e.oldVersion,e.newVersion,p(o.transaction),e)})),r&&o.addEventListener("blocked",(e=>r(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}function m(e,{blocked:t}={}){const r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",(e=>t(e.oldVersion,e))),p(r).then((()=>{}))}const b=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],v=new Map;function _(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(v.get(t))return v.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=w.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!b.includes(r))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),i&&s.done]))[0]};return v.set(t,s),s}l=(e=>({...e,get:(t,r,n)=>_(t,r)||e.get(t,r,n),has:(t,r)=>!!_(t,r)||e.has(t,r)}))(l)}}]);
//# sourceMappingURL=805.75ee7734.chunk.js.map