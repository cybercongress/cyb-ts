/*! For license information please see 630.8687bc8c.chunk.js.LICENSE.txt */
(self.webpackChunkcyb=self.webpackChunkcyb||[]).push([[630],{19824:function(e,t,r){"use strict";var n=r(25108);const i=-8,s=-4,o=0,a=1,c=1,u=2,h=5,l=1024,f=2048,d=8192,p=0,y=4,m=8,g=12,b=12,w=16,v="undefined"!=typeof BigUint64Array,E=Symbol(),_=1024;function x(e,t){const r=new Uint32Array(e),n=new Uint16Array(e);var i=r[t+s>>>2]>>>1,o=t>>>1;if(i<=_)return String.fromCharCode.apply(String,n.subarray(o,o+i));const a=[];do{const e=n[o+_-1],t=e>=55296&&e<56320?_-1:_;a.push(String.fromCharCode.apply(String,n.subarray(o,o+=t))),i-=t}while(i>_);return a.join("")+String.fromCharCode.apply(String,n.subarray(o,o+i))}function k(e){const t={};function r(e,t){return e?x(e.buffer,t):"<yet unknown>"}const i=e.env=e.env||{};return i.abort=i.abort||function(e,n,s,o){const a=t.memory||i.memory;throw Error("abort: "+r(a,e)+" at "+r(a,n)+":"+s+":"+o)},i.trace=i.trace||function(e,s){const o=t.memory||i.memory;n.log("trace: "+r(o,e)+(s?" ":"")+Array.prototype.slice.call(arguments,2,2+s).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function S(e,t){const r=t.exports,n=r.memory,E=r.table,_=r.__alloc,k=r.__retain,S=r.__rtti_base||-1;function A(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[S>>>2])throw Error("invalid id: "+e);return t[(S+4>>>2)+2*e]}function I(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[S>>>2])throw Error("invalid id: "+e);return t[(S+4>>>2)+2*e+1]}function T(e){return 31-Math.clz32(e>>>h&31)}function C(e,t,r){const i=n.buffer;if(r)switch(e){case 2:return new Float32Array(i);case 3:return new Float64Array(i)}else switch(e){case 0:return new(t?Int8Array:Uint8Array)(i);case 1:return new(t?Int16Array:Uint16Array)(i);case 2:return new(t?Int32Array:Uint32Array)(i);case 3:return new(t?BigInt64Array:BigUint64Array)(i)}throw Error("unsupported align: "+e)}function D(e){const t=new Uint32Array(n.buffer),r=t[e+i>>>2],o=A(r);if(!(o&c))throw Error("not an array: "+r);const a=T(o);var h=t[e+y>>>2];const d=o&u?t[e+b>>>2]:t[h+s>>>2]>>>a;return C(a,o&l,o&f).subarray(h>>>=a,h+d)}function R(e,t,r){return new e(O(e,t,r))}function O(e,t,r){const i=n.buffer,o=new Uint32Array(i),a=o[r+y>>>2];return new e(i,a,o[a+s>>>2]>>>t)}return e.__allocString=function(e){const t=e.length,r=_(t<<1,a),i=new Uint16Array(n.buffer);for(var s=0,o=r>>>1;s<t;++s)i[o+s]=e.charCodeAt(s);return r},e.__getString=function(e){const t=n.buffer;if(new Uint32Array(t)[e+i>>>2]!==a)throw Error("not a string: "+e);return x(t,e)},e.__allocArray=function(e,t){const r=A(e);if(!(r&(c|u)))throw Error("not an array: "+e+" @ "+r);const i=T(r),s=t.length,a=_(s<<i,o),h=_(r&u?w:g,e),v=new Uint32Array(n.buffer);v[h+p>>>2]=k(a),v[h+y>>>2]=a,v[h+m>>>2]=s<<i,r&u&&(v[h+b>>>2]=s);const E=C(i,r&l,r&f);if(r&d)for(let e=0;e<s;++e)E[(a>>>i)+e]=k(t[e]);else E.set(t,a>>>i);return h},e.__getArrayView=D,e.__getArray=function(e){const t=D(e),r=t.length,n=new Array(r);for(let e=0;e<r;e++)n[e]=t[e];return n},e.__getArrayBuffer=function(e){const t=n.buffer,r=new Uint32Array(t)[e+s>>>2];return t.slice(e,e+r)},e.__getInt8Array=R.bind(null,Int8Array,0),e.__getInt8ArrayView=O.bind(null,Int8Array,0),e.__getUint8Array=R.bind(null,Uint8Array,0),e.__getUint8ArrayView=O.bind(null,Uint8Array,0),e.__getUint8ClampedArray=R.bind(null,Uint8ClampedArray,0),e.__getUint8ClampedArrayView=O.bind(null,Uint8ClampedArray,0),e.__getInt16Array=R.bind(null,Int16Array,1),e.__getInt16ArrayView=O.bind(null,Int16Array,1),e.__getUint16Array=R.bind(null,Uint16Array,1),e.__getUint16ArrayView=O.bind(null,Uint16Array,1),e.__getInt32Array=R.bind(null,Int32Array,2),e.__getInt32ArrayView=O.bind(null,Int32Array,2),e.__getUint32Array=R.bind(null,Uint32Array,2),e.__getUint32ArrayView=O.bind(null,Uint32Array,2),v&&(e.__getInt64Array=R.bind(null,BigInt64Array,3),e.__getInt64ArrayView=O.bind(null,BigInt64Array,3),e.__getUint64Array=R.bind(null,BigUint64Array,3),e.__getUint64ArrayView=O.bind(null,BigUint64Array,3)),e.__getFloat32Array=R.bind(null,Float32Array,2),e.__getFloat32ArrayView=O.bind(null,Float32Array,2),e.__getFloat64Array=R.bind(null,Float64Array,3),e.__getFloat64ArrayView=O.bind(null,Float64Array,3),e.__instanceof=function(e,t){const r=new Uint32Array(n.buffer);var s=r[e+i>>>2];if(s<=r[S>>>2])do{if(s==t)return!0}while(s=I(s));return!1},e.memory=e.memory||n,e.table=e.table||E,P(r,e)}function A(e){return"undefined"!=typeof Response&&e instanceof Response}async function I(e,t){return A(e=await e)?T(e,t):S(k(t||(t={})),await WebAssembly.instantiate(e instanceof WebAssembly.Module?e:await WebAssembly.compile(e),t))}async function T(e,t){return WebAssembly.instantiateStreaming?S(k(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance):I(A(e=await e)?e.arrayBuffer():e,t)}function P(e,t){var r=t?Object.create(t):{},n=e.__argumentsLength?function(t){e.__argumentsLength.value=t}:e.__setArgumentsLength||e.__setargc||function(){};for(let t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const i=e[t];let s=t.split("."),o=r;for(;s.length>1;){let e=s.shift();Object.prototype.hasOwnProperty.call(o,e)||(o[e]={}),o=o[e]}let a=s[0],c=a.indexOf("#");if(c>=0){let r=a.substring(0,c),s=o[r];if(void 0===s||!s.prototype){let e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={valueOf:function(){return this[E]}},e.wrap=function(t){return Object.create(e.prototype,{[E]:{value:t,writable:!1}})},s&&Object.getOwnPropertyNames(s).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t)))),o[r]=e}if(a=a.substring(c+1),o=o[r].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let r=e[t.replace("set:","get:")],n=e[t.replace("get:","set:")];Object.defineProperty(o,a,{get:function(){return r(this[E])},set:function(e){n(this[E],e)},enumerable:!0})}}else"constructor"===a?(o[a]=(...e)=>(n(e.length),i(...e))).original=i:(o[a]=function(...e){return n(e.length),i(this[E],...e)}).original=i}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:e[t.replace("set:","get:")],set:e[t.replace("get:","set:")],enumerable:!0}):"function"==typeof i&&i!==n?(o[a]=(...e)=>(n(e.length),i(...e))).original=i:o[a]=i}return r}t.instantiate=I,t.instantiateSync=function(e,t){return S(k(t||(t={})),new WebAssembly.Instance(e instanceof WebAssembly.Module?e:new WebAssembly.Module(e),t))},t.instantiateStreaming=T,t.demangle=P},42450:function(e,t,r){"use strict";e.exports=r(10077)},10077:function(e,t,r){"use strict";var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(88482),n.BufferWriter=r(95628),n.Reader=r(29958),n.BufferReader=r(73055),n.util=r(61436),n.rpc=r(13971),n.roots=r(59149),n.configure=i,i()},29958:function(e,t,r){"use strict";e.exports=c;var n,i=r(61436),s=i.LongBits,o=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},l=function(){return i.Buffer?function(e){return(c.create=function(e){return i.Buffer.isBuffer(e)?new n(e):h(e)})(e)}:h};function f(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=l(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=l(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},73055:function(e,t,r){"use strict";e.exports=s;var n=r(29958);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(61436);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},59149:function(e){"use strict";e.exports={}},13971:function(e,t,r){"use strict";t.Service=r(98295)},98295:function(e,t,r){"use strict";e.exports=i;var n=r(61436);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,r,i,s);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},19961:function(e,t,r){"use strict";e.exports=i;var n=r(61436);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===o?s:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},61436:function(e,t,r){"use strict";var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(34537),n.base64=r(97419),n.EventEmitter=r(19211),n.float=r(10945),n.inquire=r(67199),n.utf8=r(94997),n.pool=r(76662),n.LongBits=r(19961),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},88482:function(e,t,r){"use strict";e.exports=l;var n,i=r(61436),s=i.LongBits,o=i.base64,a=i.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function l(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return i.Buffer?function(){return(l.create=function(){return new n})()}:function(){return new l}};function d(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}l.create=f(),l.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(l.alloc=i.pool(l.alloc,i.Array.prototype.subarray)),l.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},p.prototype=Object.create(c.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(y,10,s.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=s.from(e);return this._push(y,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(y,t.length(),t)},l.prototype.bool=function(e){return this._push(d,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=s.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var g=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(i.isString(e)){var r=l.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(g,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(d,1,0)},l.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new c(u,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},l._configure=function(e){n=e,l.create=f(),n._configure()}},95628:function(e,t,r){"use strict";e.exports=s;var n=r(88482);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(61436);function s(){n.call(this)}function o(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},s._configure()},19464:function(e,t,r){"use strict";const{fromCallback:n}=r(16957),i=r(31648),{getCallback:s,getOptions:o}=r(92520),a=Symbol("promise"),c=Symbol("status"),u=Symbol("operations"),h=Symbol("finishClose"),l=Symbol("closeCallbacks");t.AbstractChainedBatch=class{constructor(e){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}this[u]=[],this[l]=[],this[c]="open",this[h]=this[h].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[u].length}put(e,t,r){if("open"!==this[c])throw new i("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;const s=r&&null!=r.sublevel?r.sublevel:this.db,o=r,a=s.keyEncoding(r&&r.keyEncoding),h=s.valueEncoding(r&&r.valueEncoding),l=a.format;r={...r,keyEncoding:l,valueEncoding:h.format},s!==this.db&&(r.sublevel=null);const f=s.prefixKey(a.encode(e),l),d=h.encode(t);return this._put(f,d,r),this[u].push({...o,type:"put",key:e,value:t}),this}_put(e,t,r){}del(e,t){if("open"!==this[c])throw new i("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(e);if(r)throw r;const n=t&&null!=t.sublevel?t.sublevel:this.db,s=t,o=n.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},n!==this.db&&(t.sublevel=null),this._del(n.prefixKey(o.encode(e),a),t),this[u].push({...s,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[c])throw new i("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[u]=[],this}_clear(){}write(e,t){return t=s(e,t),t=n(t,a),e=o(e),"open"!==this[c]?this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[c]="writing",this._write(e,(e=>{this[c]="closing",this[l].push((()=>t(e))),e||this.db.emit("batch",this[u]),this._close(this[h])}))),t[a]}_write(e,t){}close(e){return e=n(e,a),"closing"===this[c]?this[l].push(e):"closed"===this[c]?this.nextTick(e):(this[l].push(e),"writing"!==this[c]&&(this[c]="closing",this._close(this[h]))),e[a]}_close(e){this.nextTick(e)}[h](){this[c]="closed",this.db.detachResource(this);const e=this[l];this[l]=[];for(const t of e)t()}}},33961:function(e,t,r){"use strict";var n=r(25108);const{fromCallback:i}=r(16957),s=r(31648),{getOptions:o,getCallback:a}=r(92520),c=Symbol("promise"),u=Symbol("callback"),h=Symbol("working"),l=Symbol("handleOne"),f=Symbol("handleMany"),d=Symbol("autoClose"),p=Symbol("finishWork"),y=Symbol("returnMany"),m=Symbol("closing"),g=Symbol("handleClose"),b=Symbol("closed"),w=Symbol("closeCallbacks"),v=Symbol("keyEncoding"),E=Symbol("valueEncoding"),_=Symbol("abortOnClose"),x=Symbol("legacy"),k=Symbol("keys"),S=Symbol("values"),A=Symbol("limit"),I=Symbol("count"),T=Object.freeze({}),P=()=>{};let C=!1;class D{constructor(e,t,r){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}if("object"!=typeof t||null===t)throw new TypeError("The second argument must be an options object");this[b]=!1,this[w]=[],this[h]=!1,this[m]=!1,this[d]=!1,this[u]=null,this[l]=this[l].bind(this),this[f]=this[f].bind(this),this[g]=this[g].bind(this),this[v]=t[v],this[E]=t[E],this[x]=r,this[A]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[I]=0,this[_]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[I]}get limit(){return this[A]}next(e){let t;if(void 0===e)t=new Promise(((t,r)=>{e=(e,n,i)=>{e?r(e):this[x]?void 0===n&&void 0===i?t():t([n,i]):t(n)}}));else if("function"!=typeof e)throw new TypeError("Callback must be a function");return this[m]?this.nextTick(e,new s("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(e,new s("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[h]=!0,this[u]=e,this[I]>=this[A]?this.nextTick(this[l],null):this._next(this[l])),t}_next(e){this.nextTick(e)}nextv(e,t,r){return r=a(t,r),r=i(r,c),t=o(t,T),Number.isInteger(e)?(this[m]?this.nextTick(r,new s("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(r,new s("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[A]<1/0&&(e=Math.min(e,this[A]-this[I])),this[h]=!0,this[u]=r,e<=0?this.nextTick(this[f],null,[]):this._nextv(e,t,this[f])),r[c]):(this.nextTick(r,new TypeError("The first argument 'size' must be an integer")),r[c])}_nextv(e,t,r){const n=[],i=(t,s,o)=>t?r(t):(this[x]?void 0===s&&void 0===o:void 0===s)?r(null,n):(n.push(this[x]?[s,o]:s),void(n.length===e?r(null,n):this._next(i)));this._next(i)}all(e,t){return t=a(e,t),t=i(t,c),e=o(e,T),this[m]?this.nextTick(t,new s("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[h]?this.nextTick(t,new s("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[h]=!0,this[u]=t,this[d]=!0,this[I]>=this[A]?this.nextTick(this[f],null,[]):this._all(e,this[f])),t[c]}_all(e,t){let r=this[I];const n=[],i=()=>{const e=this[A]<1/0?Math.min(1e3,this[A]-r):1e3;e<=0?this.nextTick(t,null,n):this._nextv(e,T,s)},s=(e,s)=>{e?t(e):0===s.length?t(null,n):(n.push.apply(n,s),r+=s.length,i())};i()}[p](){const e=this[u];return this[_]&&null===e?P:(this[h]=!1,this[u]=null,this[m]&&this._close(this[g]),e)}[y](e,t,r){this[d]?this.close(e.bind(null,t,r)):e(t,r)}seek(e,t){if(t=o(t,T),this[m]);else{if(this[h])throw new s("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const r=this.db.keyEncoding(t.keyEncoding||this[v]),n=r.format;t.keyEncoding!==n&&(t={...t,keyEncoding:n});const i=this.db.prefixKey(r.encode(e),n);this._seek(i,t)}}}_seek(e,t){throw new s("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){if(e=i(e,c),this[b])this.nextTick(e);else if(this[m])this[w].push(e);else if(this[m]=!0,this[w].push(e),this[h]){if(this[_]){this[p]()(new s("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))}}else this._close(this[g]);return e[c]}_close(e){this.nextTick(e)}[g](){this[b]=!0,this.db.detachResource(this);const e=this[w];this[w]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[b]||await this.close()}}}class R extends D{constructor(e,t){super(e,t,!0),this[k]=!1!==t.keys,this[S]=!1!==t.values}[l](e,t,r){const n=this[p]();if(e)return n(e);try{t=this[k]&&void 0!==t?this[v].decode(t):void 0,r=this[S]&&void 0!==r?this[E].decode(r):void 0}catch(e){return n(new O("entry",e))}void 0===t&&void 0===r||this[I]++,n(null,t,r)}[f](e,t){const r=this[p]();if(e)return this[y](r,e);try{for(const e of t){const t=e[0],r=e[1];e[0]=this[k]&&void 0!==t?this[v].decode(t):void 0,e[1]=this[S]&&void 0!==r?this[E].decode(r):void 0}}catch(e){return this[y](r,new O("entries",e))}this[I]+=t.length,this[y](r,null,t)}end(e){return C||void 0===n||(C=!0,n.warn(new s("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class O extends s{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const e of["_ended property","_nexting property","_end method"])Object.defineProperty(R.prototype,e.split(" ")[0],{get(){throw new s(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new s(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})}});R.keyEncoding=v,R.valueEncoding=E,t.AbstractIterator=R,t.AbstractKeyIterator=class extends D{constructor(e,t){super(e,t,!1)}[l](e,t){const r=this[p]();if(e)return r(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return r(new O("key",e))}void 0!==t&&this[I]++,r(null,t)}[f](e,t){const r=this[p]();if(e)return this[y](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[v].decode(r):void 0}}catch(e){return this[y](r,new O("keys",e))}this[I]+=t.length,this[y](r,null,t)}},t.AbstractValueIterator=class extends D{constructor(e,t){super(e,t,!1)}[l](e,t){const r=this[p]();if(e)return r(e);try{t=void 0!==t?this[E].decode(t):void 0}catch(e){return r(new O("value",e))}void 0!==t&&this[I]++,r(null,t)}[f](e,t){const r=this[p]();if(e)return this[y](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[E].decode(r):void 0}}catch(e){return this[y](r,new O("values",e))}this[I]+=t.length,this[y](r,null,t)}}},69071:function(e,t,r){"use strict";const{supports:n}=r(80724),{Transcoder:i}=r(58499),{EventEmitter:s}=r(17187),{fromCallback:o}=r(16957),a=r(31648),{AbstractIterator:c}=r(33961),{DefaultKeyIterator:u,DefaultValueIterator:h}=r(95429),{DeferredIterator:l,DeferredKeyIterator:f,DeferredValueIterator:d}=r(30593),{DefaultChainedBatch:p}=r(4765),{getCallback:y,getOptions:m}=r(92520),g=r(70056),b=Symbol("promise"),w=Symbol("landed"),v=Symbol("resources"),E=Symbol("closeResources"),_=Symbol("operations"),x=Symbol("undefer"),k=Symbol("deferOpen"),S=Symbol("options"),A=Symbol("status"),I=Symbol("defaultOptions"),T=Symbol("transcoder"),P=Symbol("keyEncoding"),C=Symbol("valueEncoding"),D=()=>{};class R extends s{constructor(e,t){if(super(),"object"!=typeof e||null===e)throw new TypeError("The first argument 'manifest' must be an object");t=m(t);const{keyEncoding:r,valueEncoding:s,passive:o,...a}=t;this[v]=new Set,this[_]=[],this[k]=!0,this[S]=a,this[A]="opening",this.supports=n(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[T]=new i(B(this)),this[P]=this[T].encoding(r||"utf8"),this[C]=this[T].encoding(s||"utf8");for(const e of this[T].encodings())this.supports.encodings[e.commonName]||(this.supports.encodings[e.commonName]=!0);this[I]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[P].commonName,valueEncoding:this[C].commonName}),key:Object.freeze({keyEncoding:this[P].commonName})},this.nextTick((()=>{this[k]&&this.open({passive:!1},D)}))}get status(){return this[A]}keyEncoding(e){return this[T].encoding(null!=e?e:this[P])}valueEncoding(e){return this[T].encoding(null!=e?e:this[C])}open(e,t){t=y(e,t),t=o(t,b),(e={...this[S],...m(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;const r=e=>{"closing"===this[A]||"opening"===this[A]?this.once(w,e?()=>r(e):r):"open"!==this[A]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[A]?this.once(w,r):this.nextTick(r):"closed"===this[A]||this[k]?(this[k]=!1,this[A]="opening",this.emit("opening"),this._open(e,(e=>{if(e)return this[A]="closed",this[E]((()=>{this.emit(w),r(e)})),void this[x]();this[A]="open",this[x](),this.emit(w),"open"===this[A]&&this.emit("open"),"open"===this[A]&&this.emit("ready"),r()}))):"open"===this[A]?this.nextTick(r):this.once(w,(()=>this.open(e,t))),t[b]}_open(e,t){this.nextTick(t)}close(e){e=o(e,b);const t=r=>{"opening"===this[A]||"closing"===this[A]?this.once(w,r?t(r):t):"closed"!==this[A]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):e()};if("open"===this[A]){this[A]="closing",this.emit("closing");const e=e=>{this[A]="open",this[x](),this.emit(w),t(e)};this[E]((()=>{this._close((r=>{if(r)return e(r);this[A]="closed",this[x](),this.emit(w),"closed"===this[A]&&this.emit("closed"),t()}))}))}else"closed"===this[A]?this.nextTick(t):this.once(w,(()=>this.close(e)));return e[b]}[E](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,r=!0;const n=()=>{0==--t&&(r?this.nextTick(e):e())};for(const e of this[v])e.close(n);r=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,r){if(r=y(t,r),r=o(r,b),t=m(t,this[I].entry),"opening"===this[A])return this.defer((()=>this.get(e,t,r))),r[b];if(N(this,r))return r[b];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];const i=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),c=i.format,u=s.format;return t.keyEncoding===c&&t.valueEncoding===u||(t=Object.assign({},t,{keyEncoding:c,valueEncoding:u})),this._get(this.prefixKey(i.encode(e),c),t,((e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),r(e);try{t=s.decode(t)}catch(e){return r(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[b]}_get(e,t,r){this.nextTick(r,new Error("NotFound"))}getMany(e,t,r){if(r=y(t,r),r=o(r,b),t=m(t,this[I].entry),"opening"===this[A])return this.defer((()=>this.getMany(e,t,r))),r[b];if(N(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'keys' must be an array")),r[b];if(0===e.length)return this.nextTick(r,null,[]),r[b];const n=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),s=n.format,c=i.format;t.keyEncoding===s&&t.valueEncoding===c||(t=Object.assign({},t,{keyEncoding:s,valueEncoding:c}));const u=new Array(e.length);for(let t=0;t<e.length;t++){const i=e[t],o=this._checkKey(i);if(o)return this.nextTick(r,o),r[b];u[t]=this.prefixKey(n.encode(i),s)}return this._getMany(u,t,((e,t)=>{if(e)return r(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=i.decode(t[e]))}catch(e){return r(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[b]}_getMany(e,t,r){this.nextTick(r,null,new Array(e.length).fill(void 0))}put(e,t,r,n){if(n=y(r,n),n=o(n,b),r=m(r,this[I].entry),"opening"===this[A])return this.defer((()=>this.put(e,t,r,n))),n[b];if(N(this,n))return n[b];const i=this._checkKey(e)||this._checkValue(t);if(i)return this.nextTick(n,i),n[b];const s=this.keyEncoding(r.keyEncoding),a=this.valueEncoding(r.valueEncoding),c=s.format,u=a.format;r.keyEncoding===c&&r.valueEncoding===u||(r=Object.assign({},r,{keyEncoding:c,valueEncoding:u}));const h=this.prefixKey(s.encode(e),c),l=a.encode(t);return this._put(h,l,r,(r=>{if(r)return n(r);this.emit("put",e,t),n()})),n[b]}_put(e,t,r,n){this.nextTick(n)}del(e,t,r){if(r=y(t,r),r=o(r,b),t=m(t,this[I].key),"opening"===this[A])return this.defer((()=>this.del(e,t,r))),r[b];if(N(this,r))return r[b];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];const i=this.keyEncoding(t.keyEncoding),s=i.format;return t.keyEncoding!==s&&(t=Object.assign({},t,{keyEncoding:s})),this._del(this.prefixKey(i.encode(e),s),t,(t=>{if(t)return r(t);this.emit("del",e),r()})),r[b]}_del(e,t,r){this.nextTick(r)}batch(e,t,r){if(!arguments.length){if("opening"===this[A])return new p(this);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(r="function"==typeof e?e:y(t,r),r=o(r,b),t=m(t,this[I].empty),"opening"===this[A])return this.defer((()=>this.batch(e,t,r))),r[b];if(N(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'operations' must be an array")),r[b];if(0===e.length)return this.nextTick(r),r[b];const n=new Array(e.length),{keyEncoding:i,valueEncoding:s,...c}=t;for(let t=0;t<e.length;t++){if("object"!=typeof e[t]||null===e[t])return this.nextTick(r,new TypeError("A batch operation must be an object")),r[b];const o=Object.assign({},e[t]);if("put"!==o.type&&"del"!==o.type)return this.nextTick(r,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[b];const a=this._checkKey(o.key);if(a)return this.nextTick(r,a),r[b];const c=null!=o.sublevel?o.sublevel:this,u=c.keyEncoding(o.keyEncoding||i),h=u.format;if(o.key=c.prefixKey(u.encode(o.key),h),o.keyEncoding=h,"put"===o.type){const e=this._checkValue(o.value);if(e)return this.nextTick(r,e),r[b];const t=c.valueEncoding(o.valueEncoding||s);o.value=t.encode(o.value),o.valueEncoding=t.format}c!==this&&(o.sublevel=null),n[t]=o}return this._batch(n,c,(t=>{if(t)return r(t);this.emit("batch",e),r()})),r[b]}_batch(e,t,r){this.nextTick(r)}sublevel(e,t){return this._sublevel(e,O.defaults(t))}_sublevel(e,t){return new O(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=y(e,t),t=o(t,b),e=m(e,this[I].empty),"opening"===this[A])return this.defer((()=>this.clear(e,t))),t[b];if(N(this,t))return t[b];const r=e,n=this.keyEncoding(e.keyEncoding);return(e=g(e,n)).keyEncoding=n.format,0===e.limit?this.nextTick(t):this._clear(e,(e=>{if(e)return t(e);this.emit("clear",r),t()})),t[b]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=g(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[A])return new l(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new c(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=g(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[A])return new f(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new u(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=g(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[A])return new d(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new h(this,e)}defer(e){if("function"!=typeof e)throw new TypeError("The first argument must be a function");this[_].push(e)}[x](){if(0===this[_].length)return;const e=this[_];this[_]=[];for(const t of e)t()}attachResource(e){if("object"!=typeof e||null===e||"function"!=typeof e.close)throw new TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new p(this)}_checkKey(e){if(null==e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null==e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}R.prototype.nextTick=r(56909);const{AbstractSublevel:O}=r(59650)({AbstractLevel:R});t.AbstractLevel=R,t.AbstractSublevel=O;const N=function(e,t){return"open"!==e[A]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},B=function(e){return Object.keys(e.supports.encodings).filter((t=>!!e.supports.encodings[t]))}},50875:function(e,t,r){"use strict";t.AbstractLevel=r(69071).AbstractLevel,t.AbstractSublevel=r(69071).AbstractSublevel,t.AbstractIterator=r(33961).AbstractIterator,t.AbstractKeyIterator=r(33961).AbstractKeyIterator,t.AbstractValueIterator=r(33961).AbstractValueIterator,t.AbstractChainedBatch=r(19464).AbstractChainedBatch},82970:function(e,t,r){"use strict";const{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(33961),o=Symbol("unfix"),a=Symbol("iterator"),c=Symbol("handleOne"),u=Symbol("handleMany"),h=Symbol("callback");class l extends n{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[u]=this[u].bind(this),this[h]=null}[c](e,t,r){const n=this[h];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t,r)}[u](e,t){const r=this[h];if(e)return r(e);for(const e of t){const t=e[0];void 0!==t&&(e[0]=this[o](t))}r(e,t)}}class f extends i{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[u]=this[u].bind(this),this[h]=null}[c](e,t){const r=this[h];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t)}[u](e,t){const r=this[h];if(e)return r(e);for(let e=0;e<t.length;e++){const r=t[e];void 0!==r&&(t[e]=this[o](r))}r(e,t)}}class d extends s{constructor(e,t,r){super(e,t),this[a]=r}}for(const e of[l,f])e.prototype._next=function(e){this[h]=e,this[a].next(this[c])},e.prototype._nextv=function(e,t,r){this[h]=r,this[a].nextv(e,t,this[u])},e.prototype._all=function(e,t){this[h]=t,this[a].all(e,this[u])};for(const e of[d])e.prototype._next=function(e){this[a].next(e)},e.prototype._nextv=function(e,t,r){this[a].nextv(e,t,r)},e.prototype._all=function(e,t){this[a].all(e,t)};for(const e of[l,f,d])e.prototype._seek=function(e,t){this[a].seek(e,t)},e.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=l,t.AbstractSublevelKeyIterator=f,t.AbstractSublevelValueIterator=d},59650:function(e,t,r){"use strict";const n=r(31648),{Buffer:i}=r(96451)||{},{AbstractSublevelIterator:s,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=r(82970),c=Symbol("prefix"),u=Symbol("upperBound"),h=Symbol("prefixRange"),l=Symbol("parent"),f=Symbol("unfix"),d=new TextEncoder,p={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"==typeof e)throw new n("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new n("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?p:e.separator?e:{...e,separator:"!"}}constructor(e,r,i){const{separator:s,manifest:o,...a}=t.defaults(i);r=w(r,s);const h=s.charCodeAt(0)+1,p=e[l]||e;if(!d.encode(r).every((e=>e>h&&e<127)))throw new n(`Prefix must use bytes > ${h} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(y(p,o),a);const m=(e.prefix||"")+s+r+s,v=m.slice(0,-1)+String.fromCharCode(h);this[l]=p,this[c]=new g(m),this[u]=new g(v),this[f]=new b,this.nextTick=p.nextTick}prefixKey(e,t){if("utf8"===t)return this[c].utf8+e;if(0===e.byteLength)return this[c][t];if("view"===t){const t=this[c].view,r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r}{const t=this[c].buffer;return i.concat([t,e],t.byteLength+e.byteLength)}}[h](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[c][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[u][t]}get prefix(){return this[c].utf8}get db(){return this[l]}_open(e,t){this[l].open({passive:!0},t)}_put(e,t,r,n){this[l].put(e,t,r,n)}_get(e,t,r){this[l].get(e,t,r)}_getMany(e,t,r){this[l].getMany(e,t,r)}_del(e,t,r){this[l].del(e,t,r)}_batch(e,t,r){this[l].batch(e,t,r)}_clear(e,t){this[h](e,e.keyEncoding),this[l].clear(e,t)}_iterator(e){this[h](e,e.keyEncoding);const t=this[l].iterator(e),r=this[f].get(this[c].utf8.length,e.keyEncoding);return new s(this,e,t,r)}_keys(e){this[h](e,e.keyEncoding);const t=this[l].keys(e),r=this[f].get(this[c].utf8.length,e.keyEncoding);return new o(this,e,t,r)}_values(e){this[h](e,e.keyEncoding);const t=this[l].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};const y=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:m(e,"utf8"),buffer:m(e,"buffer"),view:m(e,"view")}}},m=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class g{constructor(e){this.utf8=e,this.view=d.encode(e),this.buffer=i?i.from(this.view.buffer,0,this.view.byteLength):{}}}class b{constructor(){this.cache=new Map}get(e,t){let r=this.cache.get(t);return void 0===r&&(r="view"===t?function(e,t){return t.subarray(e)}.bind(null,e):function(e,t){return t.slice(e)}.bind(null,e),this.cache.set(t,r)),r}}const w=function(e,t){let r=0,n=e.length;for(;r<n&&e[r]===t;)r++;for(;n>r&&e[n-1]===t;)n--;return e.slice(r,n)}},92520:function(e,t){"use strict";t.getCallback=function(e,t){return"function"==typeof e?e:t},t.getOptions=function(e,t){return"object"==typeof e&&null!==e?e:void 0!==t?t:{}}},4765:function(e,t,r){"use strict";const{AbstractChainedBatch:n}=r(19464),i=r(31648),s=Symbol("encoded");t.DefaultChainedBatch=class extends n{constructor(e){super(e),this[s]=[]}_put(e,t,r){this[s].push({...r,type:"put",key:e,value:t})}_del(e,t){this[s].push({...t,type:"del",key:e})}_clear(){this[s]=[]}_write(e,t){"opening"===this.db.status?this.db.defer((()=>this._write(e,t))):"open"===this.db.status?0===this[s].length?this.nextTick(t):this.db._batch(this[s],e,t):this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}},95429:function(e,t,r){"use strict";const{AbstractKeyIterator:n,AbstractValueIterator:i}=r(33961),s=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),c=Symbol("handleMany");class u extends n{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}class h extends i{constructor(e,t){super(e,t),this[s]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}for(const e of[u,h]){const t=e===u,r=t?e=>e[0]:e=>e[1];e.prototype._next=function(e){this[o]=e,this[s].next(this[a])},e.prototype[a]=function(e,r,n){const i=this[o];e?i(e):i(null,t?r:n)},e.prototype._nextv=function(e,t,r){this[o]=r,this[s].nextv(e,t,this[c])},e.prototype._all=function(e,t){this[o]=t,this[s].all(e,this[c])},e.prototype[c]=function(e,t){const n=this[o];e?n(e):n(null,t.map(r))},e.prototype._seek=function(e,t){this[s].seek(e,t)},e.prototype._close=function(e){this[s].close(e)}}t.DefaultKeyIterator=u,t.DefaultValueIterator=h},30593:function(e,t,r){"use strict";const{AbstractIterator:n,AbstractKeyIterator:i,AbstractValueIterator:s}=r(33961),o=r(31648),a=Symbol("nut"),c=Symbol("undefer"),u=Symbol("factory");class h extends n{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.iterator(t),this.db.defer((()=>this[c]()))}}class l extends i{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.keys(t),this.db.defer((()=>this[c]()))}}class f extends s{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.values(t),this.db.defer((()=>this[c]()))}}for(const e of[h,l,f])e.prototype[c]=function(){"open"===this.db.status&&(this[a]=this[u]())},e.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer((()=>this._next(e))):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._nextv=function(e,t,r){null!==this[a]?this[a].nextv(e,t,r):"opening"===this.db.status?this.db.defer((()=>this._nextv(e,t,r))):this.nextTick(r,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer((()=>this._all(e,t))):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer((()=>this._seek(e,t)))},e.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer((()=>this._close(e))):this.nextTick(e)};t.DeferredIterator=h,t.DeferredKeyIterator=l,t.DeferredValueIterator=f},56909:function(e,t,r){"use strict";const n=r(54375);e.exports=function(e,...t){0===t.length?n(e):n((()=>e(...t)))}},70056:function(e,t,r){"use strict";const n=r(31648),i=Object.prototype.hasOwnProperty,s=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){const r={};for(const o in e)if(i.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new n(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new n("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});s.has(o)?r[o]=t.encode(e[o]):r[o]=e[o]}return r.reverse=!!r.reverse,r.limit=Number.isInteger(r.limit)&&r.limit>=0?r.limit:-1,r}},96451:function(e,t,r){"use strict";var n=r(25108);const i=r(79742),s=r(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50;const a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return h(e,t,r)}function h(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|m(e,t);let n=c(r);const i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(J(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(J(e,ArrayBuffer)||e&&J(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(J(e,SharedArrayBuffer)||e&&J(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);const i=function(e){if(u.isBuffer(e)){const t=0|y(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||X(e.length)?c(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return l(e),c(e<0?0:0|y(e))}function d(e){const t=e.length<0?0:0|y(e.length),r=c(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,u.prototype),n}function y(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||J(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(i)return n?-1:H(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return C(this,t,r);case"base64":return A(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),X(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){let s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(u(e,s)===u(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===c)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){let r=!0;for(let n=0;n<c;n++)if(u(e,s+n)!==u(t,n)){r=!1;break}if(r)return s}return-1}function E(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(X(n))return o;e[r+o]=n}return o}function _(e,t,r,n){return Y(H(t,e.length-r),e,r,n)}function x(e,t,r,n){return Y(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function k(e,t,r,n){return Y(G(t),e,r,n)}function S(e,t,r,n){return Y(function(e,t){let r,n,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function A(e,t,r){return 0===t&&r===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[i+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(s=c));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(e){const t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=T));return r}(n)}t.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,r){return h(e,t,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},u.allocUnsafe=function(e){return f(e)},u.allocUnsafeSlow=function(e){return f(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(J(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),J(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=u.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(J(t,Uint8Array))i+t.length>n.length?(u.isBuffer(t)||(t=u.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!u.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)b(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,r,n,i){if(J(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(s,o),c=this.slice(n,i),h=e.slice(t,r);for(let e=0;e<a;++e)if(c[e]!==h[e]){s=c[e],o=h[e];break}return s<o?-1:o<s?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return w(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return w(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return x(this,e,t,r);case"base64":return k(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const T=4096;function P(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function C(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function D(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=Q[e[n]];return i}function R(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,n,i,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function B(e,t,r,n,i){$(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function M(e,t,r,n,i){$(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function L(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(e,t,r,n,i){return t=+t,r>>>=0,i||L(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function j(e,t,r,n,i){return t=+t,r>>>=0,i||L(e,0,r,8),s.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=Z((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),u.prototype.readBigUInt64BE=Z((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=Z((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),u.prototype.readBigInt64BE=Z((function(e){V(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){N(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){N(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=Z((function(e,t=0){return B(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=Z((function(e,t=0){return M(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);N(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);N(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=Z((function(e,t=0){return B(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=Z((function(e,t=0){return M(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(e,t,r){return U(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return U(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return j(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return j(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const s=u.isBuffer(e)?e:u.from(e,n),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%o]}return this};const F={};function K(e,t,r){F[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function z(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function $(e,t,r,n,i,s){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new F.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){V(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||q(t,e.length-(r+1))}(n,i,s)}function V(e,t){if("number"!=typeof e)throw new F.ERR_INVALID_ARG_TYPE(t,"number",e)}function q(e,t,r){if(Math.floor(e)!==e)throw V(e,r),new F.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}K("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),K("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),K("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=z(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=z(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const W=/[^+/0-9A-Za-z-_]/g;function H(e,t){let r;t=t||1/0;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function G(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function J(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const Q=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function Z(e){return"undefined"==typeof BigInt?ee:e}function ee(){throw new Error("BigInt not supported")}},32044:function(e){function t(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e)if(t&&t.addEventListener){if(t.aborted){r();break}t.addEventListener("abort",r)}return t.signal}e.exports=t,e.exports.anySignal=t},69282:function(e,t,r){"use strict";var n=r(34155),i=r(25108);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}var o,a,c=r(62136).codes,u=c.ERR_AMBIGUOUS_ARGUMENT,h=c.ERR_INVALID_ARG_TYPE,l=c.ERR_INVALID_ARG_VALUE,f=c.ERR_INVALID_RETURN_VALUE,d=c.ERR_MISSING_ARGS,p=r(25961),y=r(89539).inspect,m=r(89539).types,g=m.isPromise,b=m.isRegExp,w=Object.assign?Object.assign:r(8091).assign,v=Object.is?Object.is:r(20609);new Map;function E(){var e=r(19158);o=e.isDeepEqual,a=e.isDeepStrictEqual}var _=!1,x=e.exports=I,k={};function S(e){if(e.message instanceof Error)throw e.message;throw new p(e)}function A(e,t,r,n){if(!r){var i=!1;if(0===t)i=!0,n="No value argument passed to `assert.ok()`";else if(n instanceof Error)throw n;var s=new p({actual:r,expected:!0,message:n,operator:"==",stackStartFn:e});throw s.generatedMessage=i,s}}function I(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];A.apply(void 0,[I,t.length].concat(t))}x.fail=function e(t,r,s,o,a){var c,u=arguments.length;if(0===u)c="Failed";else if(1===u)s=t,t=void 0;else{if(!1===_)_=!0,(n.emitWarning?n.emitWarning:i.warn.bind(i))("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094");2===u&&(o="!=")}if(s instanceof Error)throw s;var h={actual:t,expected:r,operator:void 0===o?"fail":o,stackStartFn:a||e};void 0!==s&&(h.message=s);var l=new p(h);throw c&&(l.message=c,l.generatedMessage=!0),l},x.AssertionError=p,x.ok=I,x.equal=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");t!=r&&S({actual:t,expected:r,message:n,operator:"==",stackStartFn:e})},x.notEqual=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");t==r&&S({actual:t,expected:r,message:n,operator:"!=",stackStartFn:e})},x.deepEqual=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");void 0===o&&E(),o(t,r)||S({actual:t,expected:r,message:n,operator:"deepEqual",stackStartFn:e})},x.notDeepEqual=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");void 0===o&&E(),o(t,r)&&S({actual:t,expected:r,message:n,operator:"notDeepEqual",stackStartFn:e})},x.deepStrictEqual=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");void 0===o&&E(),a(t,r)||S({actual:t,expected:r,message:n,operator:"deepStrictEqual",stackStartFn:e})},x.notDeepStrictEqual=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");void 0===o&&E();a(t,r)&&S({actual:t,expected:r,message:n,operator:"notDeepStrictEqual",stackStartFn:e})},x.strictEqual=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");v(t,r)||S({actual:t,expected:r,message:n,operator:"strictEqual",stackStartFn:e})},x.notStrictEqual=function e(t,r,n){if(arguments.length<2)throw new d("actual","expected");v(t,r)&&S({actual:t,expected:r,message:n,operator:"notStrictEqual",stackStartFn:e})};var T=function e(t,r,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r.forEach((function(e){e in t&&(void 0!==n&&"string"==typeof n[e]&&b(t[e])&&t[e].test(n[e])?i[e]=n[e]:i[e]=t[e])}))};function P(e,t,r,n){if("function"!=typeof t){if(b(t))return t.test(e);if(2===arguments.length)throw new h("expected",["Function","RegExp"],t);if("object"!==s(e)||null===e){var i=new p({actual:e,expected:t,message:r,operator:"deepStrictEqual",stackStartFn:n});throw i.operator=n.name,i}var c=Object.keys(t);if(t instanceof Error)c.push("name","message");else if(0===c.length)throw new l("error",t,"may not be an empty object");return void 0===o&&E(),c.forEach((function(i){"string"==typeof e[i]&&b(t[i])&&t[i].test(e[i])||function(e,t,r,n,i,s){if(!(r in e)||!a(e[r],t[r])){if(!n){var o=new T(e,i),c=new T(t,i,e),u=new p({actual:o,expected:c,operator:"deepStrictEqual",stackStartFn:s});throw u.actual=e,u.expected=t,u.operator=s.name,u}S({actual:e,expected:t,message:n,operator:s.name,stackStartFn:s})}}(e,t,i,r,c,n)})),!0}return void 0!==t.prototype&&e instanceof t||!Error.isPrototypeOf(t)&&!0===t.call({},e)}function C(e){if("function"!=typeof e)throw new h("fn","Function",e);try{e()}catch(e){return e}return k}function D(e){return g(e)||null!==e&&"object"===s(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function R(e){return Promise.resolve().then((function(){var t;if("function"==typeof e){if(!D(t=e()))throw new f("instance of Promise","promiseFn",t)}else{if(!D(e))throw new h("promiseFn",["Function","Promise"],e);t=e}return Promise.resolve().then((function(){return t})).then((function(){return k})).catch((function(e){return e}))}))}function O(e,t,r,n){if("string"==typeof r){if(4===arguments.length)throw new h("error",["Object","Error","Function","RegExp"],r);if("object"===s(t)&&null!==t){if(t.message===r)throw new u("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===r)throw new u("error/message",'The error "'.concat(t,'" is identical to the message.'));n=r,r=void 0}else if(null!=r&&"object"!==s(r)&&"function"!=typeof r)throw new h("error",["Object","Error","Function","RegExp"],r);if(t===k){var i="";r&&r.name&&(i+=" (".concat(r.name,")")),i+=n?": ".concat(n):".";var o="rejects"===e.name?"rejection":"exception";S({actual:void 0,expected:r,operator:e.name,message:"Missing expected ".concat(o).concat(i),stackStartFn:e})}if(r&&!P(t,r,n,e))throw t}function N(e,t,r,n){if(t!==k){if("string"==typeof r&&(n=r,r=void 0),!r||P(t,r)){var i=n?": ".concat(n):".",s="doesNotReject"===e.name?"rejection":"exception";S({actual:t,expected:r,operator:e.name,message:"Got unwanted ".concat(s).concat(i,"\n")+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}function B(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];A.apply(void 0,[B,t.length].concat(t))}x.throws=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];O.apply(void 0,[e,C(t)].concat(n))},x.rejects=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return R(t).then((function(t){return O.apply(void 0,[e,t].concat(n))}))},x.doesNotThrow=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];N.apply(void 0,[e,C(t)].concat(n))},x.doesNotReject=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return R(t).then((function(t){return N.apply(void 0,[e,t].concat(n))}))},x.ifError=function e(t){if(null!=t){var r="ifError got unwanted exception: ";"object"===s(t)&&"string"==typeof t.message?0===t.message.length&&t.constructor?r+=t.constructor.name:r+=t.message:r+=y(t);var n=new p({actual:t,expected:null,operator:"ifError",message:r,stackStartFn:e}),i=t.stack;if("string"==typeof i){var o=i.split("\n");o.shift();for(var a=n.stack.split("\n"),c=0;c<o.length;c++){var u=a.indexOf(o[c]);if(-1!==u){a=a.slice(0,u);break}}n.stack="".concat(a.join("\n"),"\n").concat(o.join("\n"))}throw n}},x.strict=w(B,x,{equal:x.strictEqual,deepEqual:x.deepStrictEqual,notEqual:x.notStrictEqual,notDeepEqual:x.notDeepStrictEqual}),x.strict.strict=x.strict},25961:function(e,t,r){"use strict";var n=r(34155);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?a(e):t}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){var t="function"==typeof Map?new Map:void 0;return c=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h(n,e)},c(e)}function u(e,t,r){return u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&h(i,r.prototype),i},u.apply(null,arguments)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}var d=r(89539).inspect,p=r(62136).codes.ERR_INVALID_ARG_TYPE;function y(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}var m="",g="",b="",w="",v={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"};function E(e){var t=Object.keys(e),r=Object.create(Object.getPrototypeOf(e));return t.forEach((function(t){r[t]=e[t]})),Object.defineProperty(r,"message",{value:e.message}),r}function _(e){return d(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function x(e,t,r){var i="",s="",o=0,a="",c=!1,u=_(e),h=u.split("\n"),l=_(t).split("\n"),d=0,p="";if("strictEqual"===r&&"object"===f(e)&&"object"===f(t)&&null!==e&&null!==t&&(r="strictEqualObject"),1===h.length&&1===l.length&&h[0]!==l[0]){var E=h[0].length+l[0].length;if(E<=10){if(!("object"===f(e)&&null!==e||"object"===f(t)&&null!==t||0===e&&0===t))return"".concat(v[r],"\n\n")+"".concat(h[0]," !== ").concat(l[0],"\n")}else if("strictEqualObject"!==r){if(E<(n.stderr&&n.stderr.isTTY?n.stderr.columns:80)){for(;h[0][d]===l[0][d];)d++;d>2&&(p="\n  ".concat(function(e,t){if(t=Math.floor(t),0==e.length||0==t)return"";var r=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+e.substring(0,r-e.length)}(" ",d),"^"),d=0)}}}for(var x=h[h.length-1],k=l[l.length-1];x===k&&(d++<2?a="\n  ".concat(x).concat(a):i=x,h.pop(),l.pop(),0!==h.length&&0!==l.length);)x=h[h.length-1],k=l[l.length-1];var S=Math.max(h.length,l.length);if(0===S){var A=u.split("\n");if(A.length>30)for(A[26]="".concat(m,"...").concat(w);A.length>27;)A.pop();return"".concat(v.notIdentical,"\n\n").concat(A.join("\n"),"\n")}d>3&&(a="\n".concat(m,"...").concat(w).concat(a),c=!0),""!==i&&(a="\n  ".concat(i).concat(a),i="");var I=0,T=v[r]+"\n".concat(g,"+ actual").concat(w," ").concat(b,"- expected").concat(w),P=" ".concat(m,"...").concat(w," Lines skipped");for(d=0;d<S;d++){var C=d-o;if(h.length<d+1)C>1&&d>2&&(C>4?(s+="\n".concat(m,"...").concat(w),c=!0):C>3&&(s+="\n  ".concat(l[d-2]),I++),s+="\n  ".concat(l[d-1]),I++),o=d,i+="\n".concat(b,"-").concat(w," ").concat(l[d]),I++;else if(l.length<d+1)C>1&&d>2&&(C>4?(s+="\n".concat(m,"...").concat(w),c=!0):C>3&&(s+="\n  ".concat(h[d-2]),I++),s+="\n  ".concat(h[d-1]),I++),o=d,s+="\n".concat(g,"+").concat(w," ").concat(h[d]),I++;else{var D=l[d],R=h[d],O=R!==D&&(!y(R,",")||R.slice(0,-1)!==D);O&&y(D,",")&&D.slice(0,-1)===R&&(O=!1,R+=","),O?(C>1&&d>2&&(C>4?(s+="\n".concat(m,"...").concat(w),c=!0):C>3&&(s+="\n  ".concat(h[d-2]),I++),s+="\n  ".concat(h[d-1]),I++),o=d,s+="\n".concat(g,"+").concat(w," ").concat(R),i+="\n".concat(b,"-").concat(w," ").concat(D),I+=2):(s+=i,i="",1!==C&&0!==d||(s+="\n  ".concat(R),I++))}if(I>20&&d<S-2)return"".concat(T).concat(P,"\n").concat(s,"\n").concat(m,"...").concat(w).concat(i,"\n")+"".concat(m,"...").concat(w)}return"".concat(T).concat(c?P:"","\n").concat(s).concat(i).concat(a).concat(p)}var k=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==f(e)||null===e)throw new p("options","Object",e);var i=e.message,s=e.operator,c=e.stackStartFn,u=e.actual,h=e.expected,d=Error.stackTraceLimit;if(Error.stackTraceLimit=0,null!=i)r=o(this,l(t).call(this,String(i)));else if(n.stderr&&n.stderr.isTTY&&(n.stderr&&n.stderr.getColorDepth&&1!==n.stderr.getColorDepth()?(m="[34m",g="[32m",w="[39m",b="[31m"):(m="",g="",w="",b="")),"object"===f(u)&&null!==u&&"object"===f(h)&&null!==h&&"stack"in u&&u instanceof Error&&"stack"in h&&h instanceof Error&&(u=E(u),h=E(h)),"deepStrictEqual"===s||"strictEqual"===s)r=o(this,l(t).call(this,x(u,h,s)));else if("notDeepStrictEqual"===s||"notStrictEqual"===s){var y=v[s],k=_(u).split("\n");if("notStrictEqual"===s&&"object"===f(u)&&null!==u&&(y=v.notStrictEqualObject),k.length>30)for(k[26]="".concat(m,"...").concat(w);k.length>27;)k.pop();r=1===k.length?o(this,l(t).call(this,"".concat(y," ").concat(k[0]))):o(this,l(t).call(this,"".concat(y,"\n\n").concat(k.join("\n"),"\n")))}else{var S=_(u),A="",I=v[s];"notDeepEqual"===s||"notEqual"===s?(S="".concat(v[s],"\n\n").concat(S)).length>1024&&(S="".concat(S.slice(0,1021),"...")):(A="".concat(_(h)),S.length>512&&(S="".concat(S.slice(0,509),"...")),A.length>512&&(A="".concat(A.slice(0,509),"...")),"deepEqual"===s||"equal"===s?S="".concat(I,"\n\n").concat(S,"\n\nshould equal\n\n"):A=" ".concat(s," ").concat(A)),r=o(this,l(t).call(this,"".concat(S).concat(A)))}return Error.stackTraceLimit=d,r.generatedMessage=!i,Object.defineProperty(a(r),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),r.code="ERR_ASSERTION",r.actual=u,r.expected=h,r.operator=s,Error.captureStackTrace&&Error.captureStackTrace(a(r),c),r.stack,r.name="AssertionError",o(r)}var r,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,e),r=t,c=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:d.custom,value:function(e,t){return d(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){i(e,t,r[t])}))}return e}({},t,{customInspect:!1,depth:0}))}}],c&&s(r.prototype,c),u&&s(r,u),t}(c(Error));e.exports=k},62136:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}var a,c,u={};function h(e,t,r){r||(r=Error);var n=function(r){function n(r,o,a){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),c=i(this,s(n).call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,o,a))),c.code=e,c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,r),n}(r);u[e]=n}function l(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}h("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),h("ERR_INVALID_ARG_TYPE",(function(e,t,i){var s,o,c,u;if(void 0===a&&(a=r(69282)),a("string"==typeof e,"'name' must be a string"),"string"==typeof t&&(o="not ",t.substr(!c||c<0?0:+c,o.length)===o)?(s="must not be",t=t.replace(/^not /,"")):s="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))u="The ".concat(e," ").concat(s," ").concat(l(t,"type"));else{var h=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";u='The "'.concat(e,'" ').concat(h," ").concat(s," ").concat(l(t,"type"))}return u+=". Received type ".concat(n(i))}),TypeError),h("ERR_INVALID_ARG_VALUE",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid";void 0===c&&(c=r(89539));var i=c.inspect(t);return i.length>128&&(i="".concat(i.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(n,". Received ").concat(i)}),TypeError,RangeError),h("ERR_INVALID_RETURN_VALUE",(function(e,t,r){var i;return i=r&&r.constructor&&r.constructor.name?"instance of ".concat(r.constructor.name):"type ".concat(n(r)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(i,".")}),TypeError),h("ERR_MISSING_ARGS",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];void 0===a&&(a=r(69282)),a(t.length>0,"At least one arg needs to be specified");var i="The ",s=t.length;switch(t=t.map((function(e){return'"'.concat(e,'"')})),s){case 1:i+="".concat(t[0]," argument");break;case 2:i+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:i+=t.slice(0,s-1).join(", "),i+=", and ".concat(t[s-1]," arguments")}return"".concat(i," must be specified")}),TypeError),e.exports.codes=u},19158:function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var s=void 0!==/a/g.flags,o=function(e){var t=[];return e.forEach((function(e){return t.push(e)})),t},a=function(e){var t=[];return e.forEach((function(e,r){return t.push([r,e])})),t},c=Object.is?Object.is:r(20609),u=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},h=Number.isNaN?Number.isNaN:r(20360);function l(e){return e.call.bind(e)}var f=l(Object.prototype.hasOwnProperty),d=l(Object.prototype.propertyIsEnumerable),p=l(Object.prototype.toString),y=r(89539).types,m=y.isAnyArrayBuffer,g=y.isArrayBufferView,b=y.isDate,w=y.isMap,v=y.isRegExp,E=y.isSet,_=y.isNativeError,x=y.isBoxedPrimitive,k=y.isNumberObject,S=y.isStringObject,A=y.isBooleanObject,I=y.isBigIntObject,T=y.isSymbolObject,P=y.isFloat32Array,C=y.isFloat64Array;function D(e){if(0===e.length||e.length>10)return!0;for(var t=0;t<e.length;t++){var r=e.charCodeAt(t);if(r<48||r>57)return!0}return 10===e.length&&e>=Math.pow(2,32)}function R(e){return Object.keys(e).filter(D).concat(u(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}function O(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}var N=0,B=1,M=2,L=3;function U(e,t,r,n){if(e===t)return 0!==e||(!r||c(e,t));if(r){if("object"!==i(e))return"number"==typeof e&&h(e)&&h(t);if("object"!==i(t)||null===e||null===t)return!1;if(Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{if(null===e||"object"!==i(e))return(null===t||"object"!==i(t))&&e==t;if(null===t||"object"!==i(t))return!1}var o,a,u,l,f=p(e);if(f!==p(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var d=R(e),y=R(t);return d.length===y.length&&F(e,t,r,n,B,d)}if("[object Object]"===f&&(!w(e)&&w(t)||!E(e)&&E(t)))return!1;if(b(e)){if(!b(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if(v(e)){if(!v(t)||(u=e,l=t,!(s?u.source===l.source&&u.flags===l.flags:RegExp.prototype.toString.call(u)===RegExp.prototype.toString.call(l))))return!1}else if(_(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else{if(g(e)){if(r||!P(e)&&!C(e)){if(!function(e,t){return e.byteLength===t.byteLength&&0===O(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}(e,t))return!1}else if(!function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(e,t))return!1;var D=R(e),U=R(t);return D.length===U.length&&F(e,t,r,n,N,D)}if(E(e))return!(!E(t)||e.size!==t.size)&&F(e,t,r,n,M);if(w(e))return!(!w(t)||e.size!==t.size)&&F(e,t,r,n,L);if(m(e)){if(a=t,(o=e).byteLength!==a.byteLength||0!==O(new Uint8Array(o),new Uint8Array(a)))return!1}else if(x(e)&&!function(e,t){return k(e)?k(t)&&c(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):S(e)?S(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):A(e)?A(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):I(e)?I(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):T(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)}(e,t))return!1}return F(e,t,r,n,N)}function j(e,t){return t.filter((function(t){return d(e,t)}))}function F(e,t,r,s,c,h){if(5===arguments.length){h=Object.keys(e);var l=Object.keys(t);if(h.length!==l.length)return!1}for(var p=0;p<h.length;p++)if(!f(t,h[p]))return!1;if(r&&5===arguments.length){var y=u(e);if(0!==y.length){var m=0;for(p=0;p<y.length;p++){var g=y[p];if(d(e,g)){if(!d(t,g))return!1;h.push(g),m++}else if(d(t,g))return!1}var b=u(t);if(y.length!==b.length&&j(t,b).length!==m)return!1}else{var w=u(t);if(0!==w.length&&0!==j(t,w).length)return!1}}if(0===h.length&&(c===N||c===B&&0===e.length||0===e.size))return!0;if(void 0===s)s={val1:new Map,val2:new Map,position:0};else{var v=s.val1.get(e);if(void 0!==v){var E=s.val2.get(t);if(void 0!==E)return v===E}s.position++}s.val1.set(e,s.position),s.val2.set(t,s.position);var _=function(e,t,r,s,c,u){var h=0;if(u===M){if(!function(e,t,r,n){for(var s=null,a=o(e),c=0;c<a.length;c++){var u=a[c];if("object"===i(u)&&null!==u)null===s&&(s=new Set),s.add(u);else if(!t.has(u)){if(r)return!1;if(!$(e,t,u))return!1;null===s&&(s=new Set),s.add(u)}}if(null!==s){for(var h=o(t),l=0;l<h.length;l++){var f=h[l];if("object"===i(f)&&null!==f){if(!K(s,f,r,n))return!1}else if(!r&&!e.has(f)&&!K(s,f,r,n))return!1}return 0===s.size}return!0}(e,t,r,c))return!1}else if(u===L){if(!function(e,t,r,s){for(var o=null,c=a(e),u=0;u<c.length;u++){var h=n(c[u],2),l=h[0],f=h[1];if("object"===i(l)&&null!==l)null===o&&(o=new Set),o.add(l);else{var d=t.get(l);if(void 0===d&&!t.has(l)||!U(f,d,r,s)){if(r)return!1;if(!V(e,t,l,f,s))return!1;null===o&&(o=new Set),o.add(l)}}}if(null!==o){for(var p=a(t),y=0;y<p.length;y++){var m=n(p[y],2),g=(l=m[0],m[1]);if("object"===i(l)&&null!==l){if(!q(o,e,l,g,r,s))return!1}else if(!(r||e.has(l)&&U(e.get(l),g,!1,s)||q(o,e,l,g,!1,s)))return!1}return 0===o.size}return!0}(e,t,r,c))return!1}else if(u===B)for(;h<e.length;h++){if(!f(e,h)){if(f(t,h))return!1;for(var l=Object.keys(e);h<l.length;h++){var d=l[h];if(!f(t,d)||!U(e[d],t[d],r,c))return!1}return l.length===Object.keys(t).length}if(!f(t,h)||!U(e[h],t[h],r,c))return!1}for(h=0;h<s.length;h++){var p=s[h];if(!U(e[p],t[p],r,c))return!1}return!0}(e,t,r,h,s,c);return s.val1.delete(e),s.val2.delete(t),_}function K(e,t,r,n){for(var i=o(e),s=0;s<i.length;s++){var a=i[s];if(U(t,a,r,n))return e.delete(a),!0}return!1}function z(e){switch(i(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(h(e))return!1}return!0}function $(e,t,r){var n=z(r);return null!=n?n:t.has(n)&&!e.has(n)}function V(e,t,r,n,i){var s=z(r);if(null!=s)return s;var o=t.get(s);return!(void 0===o&&!t.has(s)||!U(n,o,!1,i))&&(!e.has(s)&&U(n,o,!1,i))}function q(e,t,r,n,i,s){for(var a=o(e),c=0;c<a.length;c++){var u=a[c];if(U(r,u,i,s)&&U(n,t.get(u),i,s))return e.delete(u),!0}return!1}e.exports={isDeepEqual:function(e,t){return U(e,t,false)},isDeepStrictEqual:function(e,t){return U(e,t,true)}}},79742:function(e,t){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,s=c(e),o=s[0],a=s[1],u=new i(function(e,t,r){return 3*(t+r)/4-r}(0,o,a)),h=0,l=a>0?o-4:o;for(r=0;r<l;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t);1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],o=16383,a=0,c=n-i;a<c;a+=o)s.push(u(e,a,a+o>c?c:a+o));1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,n){for(var i,s,o=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},11708:function(e,t,r){"use strict";const{AbstractLevel:n}=r(50875),i=r(31648),s=r(29967),{fromCallback:o}=r(16957),{Iterator:a}=r(8212),c=r(89687),u=r(89968),h=r(21217),l="level-js-",f=Symbol("idb"),d=Symbol("namePrefix"),p=Symbol("location"),y=Symbol("version"),m=Symbol("store"),g=Symbol("onComplete"),b=Symbol("promise");class w extends n{constructor(e,t,r){if("function"==typeof t||"function"==typeof r)throw new i("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:n,version:s,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof e)throw new Error("constructor requires a location string argument");this[p]=e,this[d]=null==n?l:n,this[y]=parseInt(s||1,10),this[f]=null}get location(){return this[p]}get namePrefix(){return this[d]}get version(){return this[y]}get db(){return this[f]}get type(){return"browser-level"}_open(e,t){const r=indexedDB.open(this[d]+this[p],this[y]);r.onerror=function(){t(r.error||new Error("unknown error"))},r.onsuccess=()=>{this[f]=r.result,t()},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this[p])||t.createObjectStore(this[p])}}[m](e){return this[f].transaction([this[p]],e).objectStore(this[p])}[g](e,t){const r=e.transaction;r.onabort=function(){t(r.error||new Error("aborted by user"))},r.oncomplete=function(){t(null,e.result)}}_get(e,t,r){const n=this[m]("readonly");let s;try{s=n.get(e)}catch(e){return this.nextTick(r,e)}this[g](s,(function(e,t){return e?r(e):void 0===t?r(new i("Entry not found",{code:"LEVEL_NOT_FOUND"})):void r(null,c(t))}))}_getMany(e,t,r){const n=this[m]("readonly"),i=e.map((e=>t=>{let r;try{r=n.get(e)}catch(e){return t(e)}r.onsuccess=()=>{const e=r.result;t(null,void 0===e?e:c(e))},r.onerror=e=>{e.stopPropagation(),t(r.error)}}));s(i,16,r)}_del(e,t,r){const n=this[m]("readwrite");let i;try{i=n.delete(e)}catch(e){return this.nextTick(r,e)}this[g](i,r)}_put(e,t,r,n){const i=this[m]("readwrite");let s;try{s=i.put(t,e)}catch(e){return this.nextTick(n,e)}this[g](s,n)}_iterator(e){return new a(this,this[p],e)}_batch(e,t,r){const n=this[m]("readwrite"),i=n.transaction;let s,o=0;i.onabort=function(){r(s||i.error||new Error("aborted by user"))},i.oncomplete=function(){r()},function t(){const r=e[o++],a=r.key;let c;try{c="del"===r.type?n.delete(a):n.put(r.value,a)}catch(e){return s=e,void i.abort()}o<e.length?c.onsuccess=t:"function"==typeof i.commit&&i.commit()}()}_clear(e,t){let r,n;try{r=h(e)}catch(e){return this.nextTick(t)}if(e.limit>=0)return u(this,this[p],r,e,t);try{const e=this[m]("readwrite");n=r?e.delete(r):e.clear()}catch(e){return this.nextTick(t,e)}this[g](n,t)}_close(e){this[f].close(),this.nextTick(e)}}w.destroy=function(e,t,r){"function"==typeof t&&(r=t,t=l),r=o(r,b);const n=indexedDB.deleteDatabase(t+e);return n.onsuccess=function(){r()},n.onerror=function(e){r(e)},r[b]},t.BrowserLevel=w},8212:function(e,t,r){"use strict";const{AbstractIterator:n}=r(50875),i=r(21217),s=r(89687),o=Symbol("cache"),a=Symbol("finished"),c=Symbol("options"),u=Symbol("currentOptions"),h=Symbol("position"),l=Symbol("location"),f=Symbol("first"),d={};function p(e){"function"==typeof e.commit&&e.commit()}t.Iterator=class extends n{constructor(e,t,r){super(e,r),this[o]=[],this[a]=0===this.limit,this[c]=r,this[u]={...r},this[h]=void 0,this[l]=t,this[f]=!0}_nextv(e,t,r){if(this[f]=!1,this[a])return this.nextTick(r,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(r,null,this[o].splice(0,e));let n;void 0!==this[h]&&(this[c].reverse?(this[u].lt=this[h],this[u].lte=void 0):(this[u].gt=this[h],this[u].gte=void 0));try{n=i(this[u])}catch(e){return this[a]=!0,this.nextTick(r,null,[])}const d=this.db.db.transaction([this[l]],"readonly"),y=d.objectStore(this[l]),m=[];if(this[c].reverse){y[!this[c].values&&y.openKeyCursor?"openKeyCursor":"openCursor"](n,"prev").onsuccess=t=>{const r=t.target.result;if(r){const{key:t,value:n}=r;this[h]=t,m.push([this[c].keys&&void 0!==t?s(t):void 0,this[c].values&&void 0!==n?s(n):void 0]),m.length<e?r.continue():p(d)}else this[a]=!0}}else{let t,r;const i=()=>{if(void 0===t||void 0===r)return;const n=Math.max(t.length,r.length);0===n||e===1/0?this[a]=!0:this[h]=t[n-1],m.length=n;for(let e=0;e<n;e++){const n=t[e],i=r[e];m[e]=[this[c].keys&&void 0!==n?s(n):void 0,this[c].values&&void 0!==i?s(i):void 0]}p(d)};this[c].keys||e<1/0?y.getAllKeys(n,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,i()}:(t=[],this.nextTick(i)),this[c].values?y.getAll(n,e<1/0?e:void 0).onsuccess=e=>{r=e.target.result,i()}:(r=[],this.nextTick(i))}d.onabort=()=>{r(d.error||new Error("aborted by user")),r=null},d.oncomplete=()=>{r(null,m),r=null}}_next(e){if(this[o].length>0){const[t,r]=this[o].shift();this.nextTick(e,null,t,r)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[f]&&(this[f]=!1,t=1),this._nextv(t,d,((t,r)=>{if(t)return e(t);this[o]=r,this._next(e)}))}}_all(e,t){this[f]=!1;const r=this[o].splice(0,this[o].length),n=this.limit-this.count-r.length;if(n<=0)return this.nextTick(t,null,r);this._nextv(n,d,((e,n)=>{if(e)return t(e);r.length>0&&(n=r.concat(n)),t(null,n)}))}_seek(e,t){let r;this[f]=!0,this[o]=[],this[a]=!1,this[h]=void 0,this[u]={...this[c]};try{r=i(this[c])}catch(e){return void(this[a]=!0)}null===r||r.includes(e)?this[c].reverse?this[u].lte=e:this[u].gte=e:this[a]=!0}}},89968:function(e){"use strict";e.exports=function(e,t,r,n,i){if(0===n.limit)return e.nextTick(i);const s=e.db.transaction([t],"readwrite"),o=s.objectStore(t);let a=0;s.oncomplete=function(){i()},s.onabort=function(){i(s.error||new Error("aborted by user"))};const c=o.openKeyCursor?"openKeyCursor":"openCursor",u=n.reverse?"prev":"next";o[c](r,u).onsuccess=function(e){const t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(n.limit<=0||++a<n.limit)&&t.continue()})}}},89687:function(e){"use strict";const t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},21217:function(e){"use strict";e.exports=function(e){const t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,r=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,n=void 0===e.gte,i=void 0===e.lte;return void 0!==t&&void 0!==r?IDBKeyRange.bound(t,r,n,i):void 0!==t?IDBKeyRange.lowerBound(t,n):void 0!==r?IDBKeyRange.upperBound(r,i):null}},48764:function(e,t,r){"use strict";var n=r(25108),i=r(79742),s=r(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50;var a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return h(e,t,r)}function h(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|m(e,t),n=c(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(z(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(z(e,ArrayBuffer)||e&&z(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(z(e,SharedArrayBuffer)||e&&z(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);var i=function(e){if(u.isBuffer(e)){var t=0|y(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||$(e.length)?c(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return l(e),c(e<0?0:0|y(e))}function d(e){for(var t=e.length<0?0:0|y(e.length),r=c(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,u.prototype),n}function y(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(i)return n?-1:j(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return C(this,t,r);case"base64":return A(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),$(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var h=-1;for(s=r;s<a;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(u(e,s+f)!==u(t,f)){l=!1;break}if(l)return s}return-1}function E(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if($(a))return o;e[r+o]=a}return o}function _(e,t,r,n){return K(j(t,e.length-r),e,r,n)}function x(e,t,r,n){return K(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function k(e,t,r,n){return K(F(t),e,r,n)}function S(e,t,r,n){return K(function(e,t){for(var r,n,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function A(e,t,r){return 0===t&&r===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,o,a,c,u=e[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=r)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=e[i+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=l}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=T));return r}(n)}t.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,r){return h(e,t,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},u.allocUnsafe=function(e){return f(e)},u.allocUnsafeSlow=function(e){return f(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(z(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(z(s,Uint8Array))i+s.length>n.length?u.from(s).copy(n,i):Uint8Array.prototype.set.call(n,s,i);else{if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i)}i+=s.length}return n},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,r,n,i){if(z(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(s,o),c=this.slice(n,i),h=e.slice(t,r),l=0;l<a;++l)if(c[l]!==h[l]){s=c[l],o=h[l];break}return s<o?-1:o<s?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return w(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return w(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return x(this,e,t,r);case"base64":return k(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function C(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function D(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=V[e[s]];return i}function R(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,n,i,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function B(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,n,i){return t=+t,r>>>=0,i||B(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,i){return t=+t,r>>>=0,i||B(e,0,r,8),s.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||N(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<r&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);N(this,e,t,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,r){return M(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return M(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var o=u.isBuffer(e)?e:u.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=o[s%a]}return this};var U=/[^+/0-9A-Za-z-_]/g;function j(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function F(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function K(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function $(e){return e!=e}var V=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},79830:function(e){"use strict";e.exports=function(e,t){if("string"==typeof e)return o(e);if("number"==typeof e)return s(e,t);return null},e.exports.format=s,e.exports.parse=o;var t=/\B(?=(\d{3})+(?!\d))/g,r=/(?:\.0*|(\.[^0]+)0+)$/,n={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},i=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function s(e,i){if(!Number.isFinite(e))return null;var s=Math.abs(e),o=i&&i.thousandsSeparator||"",a=i&&i.unitSeparator||"",c=i&&void 0!==i.decimalPlaces?i.decimalPlaces:2,u=Boolean(i&&i.fixedDecimals),h=i&&i.unit||"";h&&n[h.toLowerCase()]||(h=s>=n.pb?"PB":s>=n.tb?"TB":s>=n.gb?"GB":s>=n.mb?"MB":s>=n.kb?"KB":"B");var l=(e/n[h.toLowerCase()]).toFixed(c);return u||(l=l.replace(r,"$1")),o&&(l=l.split(".").map((function(e,r){return 0===r?e.replace(t,o):e})).join(".")),l+a+h}function o(e){if("number"==typeof e&&!isNaN(e))return e;if("string"!=typeof e)return null;var t,r=i.exec(e),s="b";return r?(t=parseFloat(r[1]),s=r[4].toLowerCase()):(t=parseInt(e,10),s="b"),isNaN(t)?null:Math.floor(n[s]*t)}},21924:function(e,t,r){"use strict";var n=r(40210),i=r(55559),s=i(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?i(r):r}},55559:function(e,t,r){"use strict";var n=r(58612),i=r(40210),s=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||n.call(o,s),c=i("%Object.getOwnPropertyDescriptor%",!0),u=i("%Object.defineProperty%",!0),h=i("%Math.max%");if(u)try{u({},"a",{value:1})}catch(e){u=null}e.exports=function(e){var t=a(n,o,arguments);c&&u&&(c(t,"length").configurable&&u(t,"length",{value:1+h(0,e.length-(arguments.length-1))}));return t};var l=function(){return a(n,s,arguments)};u?u(e.exports,"apply",{value:l}):e.exports.apply=l},16957:function(e,t,r){"use strict";var n=r(90886);t.fromCallback=function(e,t){if(void 0===e){var r=new Promise((function(t,r){e=function(e,n){e?r(e):t(n)}}));e[void 0!==t?t:"promise"]=r}else if("function"!=typeof e)throw new TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then((function(e){n((()=>t(null,e)))})).catch((function(e){n((()=>t(e)))}))}},90886:function(e){e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},99870:function(e,t,r){"use strict";r.d(t,{Jj:function(){return l},Y6:function(){return h},sj:function(){return v}});var n=r(25108);const i=Symbol("Comlink.proxy"),s=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),c=Symbol("Comlink.thrown"),u=e=>"object"==typeof e&&null!==e||"function"==typeof e,h=new Map([["proxy",{canHandle:e=>u(e)&&e[i],serialize(e){const{port1:t,port2:r}=new MessageChannel;return l(e,t),[r,[r]]},deserialize(e){return e.start(),g(e,[],t);var t}}],["throw",{canHandle:e=>u(e)&&c in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function l(e,t=globalThis,r=["*"]){t.addEventListener("message",(function i(s){if(!s||!s.data)return;if(!function(e,t){for(const r of e){if(t===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}return!1}(r,s.origin))return void n.warn(`Invalid origin '${s.origin}' for comlink proxy`);const{id:o,type:u,path:h}=Object.assign({path:[]},s.data),d=(s.data.argumentList||[]).map(_);let p;try{const t=h.slice(0,-1).reduce(((e,t)=>e[t]),e),r=h.reduce(((e,t)=>e[t]),e);switch(u){case"GET":p=r;break;case"SET":t[h.slice(-1)[0]]=_(s.data.value),p=!0;break;case"APPLY":p=r.apply(t,d);break;case"CONSTRUCT":p=v(new r(...d));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;l(e,r),p=function(e,t){return w.set(e,t),e}(t,[t])}break;case"RELEASE":p=void 0;break;default:return}}catch(e){p={value:e,[c]:0}}Promise.resolve(p).catch((e=>({value:e,[c]:0}))).then((r=>{const[n,s]=E(r);t.postMessage(Object.assign(Object.assign({},n),{id:o}),s),"RELEASE"===u&&(t.removeEventListener("message",i),f(t),a in e&&"function"==typeof e[a]&&e[a]())})).catch((e=>{const[r,n]=E({value:new TypeError("Unserializable return value"),[c]:0});t.postMessage(Object.assign(Object.assign({},r),{id:o}),n)}))})),t.start&&t.start()}function f(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function d(e){if(e)throw new Error("Proxy has been released and is not useable")}function p(e){return x(e,{type:"RELEASE"}).then((()=>{f(e)}))}const y=new WeakMap,m="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(y.get(e)||0)-1;y.set(e,t),0===t&&p(e)}));function g(e,t=[],r=function(){}){let n=!1;const i=new Proxy(r,{get(r,s){if(d(n),s===o)return()=>{!function(e){m&&m.unregister(e)}(i),p(e),n=!0};if("then"===s){if(0===t.length)return{then:()=>i};const r=x(e,{type:"GET",path:t.map((e=>e.toString()))}).then(_);return r.then.bind(r)}return g(e,[...t,s])},set(r,i,s){d(n);const[o,a]=E(s);return x(e,{type:"SET",path:[...t,i].map((e=>e.toString())),value:o},a).then(_)},apply(r,i,o){d(n);const a=t[t.length-1];if(a===s)return x(e,{type:"ENDPOINT"}).then(_);if("bind"===a)return g(e,t.slice(0,-1));const[c,u]=b(o);return x(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:c},u).then(_)},construct(r,i){d(n);const[s,o]=b(i);return x(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},o).then(_)}});return function(e,t){const r=(y.get(t)||0)+1;y.set(t,r),m&&m.register(e,t,e)}(i,e),i}function b(e){const t=e.map(E);return[t.map((e=>e[0])),(r=t.map((e=>e[1])),Array.prototype.concat.apply([],r))];var r}const w=new WeakMap;function v(e){return Object.assign(e,{[i]:!0})}function E(e){for(const[t,r]of h)if(r.canHandle(e)){const[n,i]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},i]}return[{type:"RAW",value:e},w.get(e)||[]]}function _(e){switch(e.type){case"HANDLER":return h.get(e.name).deserialize(e.value);case"RAW":return e.value}}function x(e,t,r){return new Promise((n=>{const i=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(r){r.data&&r.data.id&&r.data.id===i&&(e.removeEventListener("message",t),n(r.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:i},t),r)}))}},25108:function(e,t,r){var n=r(89539),i=r(69282);function s(){return(new Date).getTime()}var o,a=Array.prototype.slice,c={};o=void 0!==r.g&&r.g.console?r.g.console:"undefined"!=typeof window&&window.console?window.console:{};for(var u=[[function(){},"log"],[function(){o.log.apply(o,arguments)},"info"],[function(){o.log.apply(o,arguments)},"warn"],[function(){o.warn.apply(o,arguments)},"error"],[function(e){c[e]=s()},"time"],[function(e){var t=c[e];if(!t)throw new Error("No such label: "+e);delete c[e];var r=s()-t;o.log(e+": "+r+"ms")},"timeEnd"],[function(){var e=new Error;e.name="Trace",e.message=n.format.apply(null,arguments),o.error(e.stack)},"trace"],[function(e){o.log(n.inspect(e)+"\n")},"dir"],[function(e){if(!e){var t=a.call(arguments,1);i.ok(!1,n.format.apply(null,t))}},"assert"]],h=0;h<u.length;h++){var l=u[h],f=l[0],d=l[1];o[d]||(o[d]=f)}e.exports=o},74077:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(r.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function o(e){return"string"!=typeof e&&(e=String(e)),e}function a(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r.iterable&&(t[Symbol.iterator]=function(){return t}),t}function c(e){this.map={},e instanceof c?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function u(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function l(e){var t=new FileReader,r=h(t);return t.readAsArrayBuffer(e),r}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function d(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:r.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():r.arrayBuffer&&r.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||i(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?u(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(l)}),this.text=function(){var e,t,r,n=u(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=h(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}c.prototype.append=function(e,t){e=s(e),t=o(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},c.prototype.delete=function(e){delete this.map[s(e)]},c.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},c.prototype.set=function(e,t){this.map[s(e)]=o(t)},c.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},c.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),a(e)},c.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),a(e)},c.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),a(e)},r.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(e,t){var r,n,i=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),p.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function m(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function g(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},d.call(y.prototype),d.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];g.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function w(e,n){return new Promise((function(i,s){var o=new y(e,n);if(o.signal&&o.signal.aborted)return s(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new c,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var n="response"in a?a.response:a.responseText;i(new g(n,r))},a.onerror=function(){s(new TypeError("Network request failed"))},a.ontimeout=function(){s(new TypeError("Network request failed"))},a.onabort=function(){s(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r.blob&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",u)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}w.polyfill=!0,e.fetch||(e.fetch=w,e.Headers=c,e.Request=y,e.Response=g),t.Headers=c,t.Request=y,t.Response=g,t.fetch=w,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=n;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t},59435:function(e){var t=1e3,r=60*t,n=60*r,i=24*n,s=7*i,o=365.25*i;function a(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,c){c=c||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&isFinite(e))return c.long?function(e){var s=Math.abs(e);if(s>=i)return a(e,s,i,"day");if(s>=n)return a(e,s,n,"hour");if(s>=r)return a(e,s,r,"minute");if(s>=t)return a(e,s,t,"second");return e+" ms"}(e):function(e){var s=Math.abs(e);if(s>=i)return Math.round(e/i)+"d";if(s>=n)return Math.round(e/n)+"h";if(s>=r)return Math.round(e/r)+"m";if(s>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},11227:function(e,t,r){var n=r(25108),i=r(34155);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,n.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=n.debug||n.log||(()=>{}),e.exports=r(82447)(t);const{formatters:s}=e.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},82447:function(e,t,r){var n=r(25108);e.exports=function(e){function t(e){let r,n,s,o=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];r=s.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==t.namespaces&&(n=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(59435),t.destroy=function(){n.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},4289:function(e,t,r){"use strict";var n=r(82215),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),s=Object.prototype.toString,o=Array.prototype.concat,a=Object.defineProperty,c=r(31044)(),u=a&&c,h=function(e,t,r,n){if(t in e)if(!0===n){if(e[t]===r)return}else if("function"!=typeof(i=n)||"[object Function]"!==s.call(i)||!n())return;var i;u?a(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0}):e[t]=r},l=function(e,t){var r=arguments.length>2?arguments[2]:{},s=n(t);i&&(s=o.call(s,Object.getOwnPropertySymbols(t)));for(var a=0;a<s.length;a+=1)h(e,s[a],t[s[a]],r[s[a]])};l.supportsDescriptors=!!u,e.exports=l},65780:function(e){"use strict";const t=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},r=({clearTimeout:e,setTimeout:r,willResolve:n})=>(i,{value:s,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(t());let a,c,u;const h=e||clearTimeout,l=()=>{h(a),u(t())},f=new Promise(((e,t)=>{c=()=>{o&&o.removeEventListener("abort",l),n?e(s):t(s)},u=t,a=(r||setTimeout)(c,i)}));return o&&o.addEventListener("abort",l,{once:!0}),f.clear=()=>{h(a),a=null,c()},f},n=e=>{const t=r({...e,willResolve:!0});return t.reject=r({...e,willResolve:!1}),t.range=(e,r,n)=>t(((e,t)=>Math.floor(Math.random()*(t-e+1)+e))(e,r),n),t},i=n();i.createWithTimers=n,e.exports=i,e.exports.default=i},45001:function(e){"use strict";function t(e,t){t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=new Array(4))}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r||t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(0===arguments.length)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(0===arguments.length)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},t.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var r=this.size(),n=this._list.length;if(!(t>=r||t<-r)){t<0&&(t+=r),t=this._head+t&this._capacityMask;var i,s=this._list[t];if(e<r/2){for(i=e;i>0;i--)this._list[t]=this._list[t=t-1+n&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(i=r-1-e;i>0;i--)this._list[t]=this._list[t=t+1+n&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+n&this._capacityMask}return s}}},t.prototype.remove=function(e,t){var r,n=e,i=t;if(n===(0|n)&&this._head!==this._tail){var s=this.size(),o=this._list.length;if(!(n>=s||n<-s||t<1)){if(n<0&&(n+=s),1===t||!t)return(r=new Array(1))[0]=this.removeOne(n),r;if(0===n&&n+t>=s)return r=this.toArray(),this.clear(),r;var a;for(n+t>s&&(t=s-n),r=new Array(t),a=0;a<t;a++)r[a]=this._list[this._head+n+a&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===s){for(this._tail=this._tail-t+o&this._capacityMask,a=t;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+o&this._capacityMask,a=t-1;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(n<s/2){for(this._head=this._head+e+t+o&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[n=n-1+o&this._capacityMask]);for(n=this._head-1+o&this._capacityMask;i>0;)this._list[n=n-1+o&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+o&this._capacityMask,a=s-(t+e);a>0;a--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+o&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),r}}},t.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n)){if(arguments.length>2){var i,s,o,a=arguments.length,c=this._list.length,u=2;if(!n||r<n/2){for(s=new Array(r),i=0;i<r;i++)s[i]=this._list[this._head+i&this._capacityMask];for(0===t?(o=[],r>0&&(this._head=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._head=this._head+r+c&this._capacityMask);a>u;)this.unshift(arguments[--a]);for(i=r;i>0;i--)this.unshift(s[i-1])}else{var h=(s=new Array(n-(r+t))).length;for(i=0;i<h;i++)s[i]=this._list[this._head+r+t+i&this._capacityMask];for(0===t?(o=[],r!=n&&(this._tail=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._tail=this._tail-h+c&this._capacityMask);u<a;)this.push(arguments[u++]);for(i=0;i<h;i++)this.push(s[i])}return o}return this.remove(r,t)}}},t.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){var t=e.length,r=this._nextPowerOf2(t);this._list=new Array(r),this._capacityMask=r-1,this._tail=t;for(var n=0;n<t;n++)this._list[n]=e[n]},t.prototype._copyArray=function(e,t){var r=this._list,n=r.length,i=this.length;if((t|=i)==i&&this._head<this._tail)return this._list.slice(this._head,this._tail);var s,o=new Array(t),a=0;if(e||this._head>this._tail){for(s=this._head;s<n;s++)o[a++]=r[s];for(s=0;s<this._tail;s++)o[a++]=r[s]}else for(s=this._head;s<this._tail;s++)o[a++]=r[s];return o},t.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.prototype._nextPowerOf2=function(e){var t=1<<Math.log(e)/Math.log(2)+1;return Math.max(t,4)},e.exports=t},43631:function(e,t,r){"use strict";r.d(t,{qY:function(){return p}});var n=r(34155),i=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},s=function(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"},o=function(e){this.version=e,this.type="node",this.name="node",this.os=n.platform},a=function(e,t,r,n){this.name=e,this.version=t,this.os=r,this.bot=n,this.type="bot-device"},c=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},u=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},h=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,l=3,f=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],d=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function p(e){return e?m(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new u:"undefined"!=typeof navigator?m(navigator.userAgent):void 0!==n&&n.version?new o(n.version.slice(1)):null}function y(e){return""!==e&&f.reduce((function(t,r){var n=r[0],i=r[1];if(t)return t;var s=i.exec(e);return!!s&&[n,s]}),!1)}function m(e){var t=y(e);if(!t)return null;var r=t[0],n=t[1];if("searchbot"===r)return new c;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<l&&(o=i(i([],o,!0),function(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}(l-o.length),!0)):o=[];var u=o.join("."),f=function(e){for(var t=0,r=d.length;t<r;t++){var n=d[t],i=n[0];if(n[1].exec(e))return i}return null}(e),p=h.exec(e);return p&&p[1]?new a(r,u,f,p[1]):new s(r,u,f)}},39387:function(e,t,r){"use strict";r.d(t,{ZP:function(){return zr}});var n=r(25108);const i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:r.g,s=Object.keys,o=Array.isArray;function a(e,t){return"object"!=typeof t||s(t).forEach((function(r){e[r]=t[r]})),e}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);const c=Object.getPrototypeOf,u={}.hasOwnProperty;function h(e,t){return u.call(e,t)}function l(e,t){"function"==typeof t&&(t=t(c(e))),("undefined"==typeof Reflect?s:Reflect.ownKeys)(t).forEach((r=>{d(e,r,t[r])}))}const f=Object.defineProperty;function d(e,t,r,n){f(e,t,a(r&&h(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:l.bind(null,e.prototype)}}}}const y=Object.getOwnPropertyDescriptor;function m(e,t){let r;return y(e,t)||(r=c(e))&&m(r,t)}const g=[].slice;function b(e,t,r){return g.call(e,t,r)}function w(e,t){return t(e)}function v(e){if(!e)throw new Error("Assertion Failed")}function E(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function _(e,t){return e.reduce(((e,r,n)=>{var i=t(r,n);return i&&(e[i[0]]=i[1]),e}),{})}function x(e,t){if(h(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,i=t.length;n<i;++n){var s=x(e,t[n]);r.push(s)}return r}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:x(a,t.substr(o+1))}}function k(e,t,r){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){v("string"!=typeof r&&"length"in r);for(var n=0,i=t.length;n<i;++n)k(e,t[n],r[n])}else{var s=t.indexOf(".");if(-1!==s){var a=t.substr(0,s),c=t.substr(s+1);if(""===c)void 0===r?o(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=r;else{var u=e[a];u&&h(e,a)||(u=e[a]={}),k(u,c,r)}}else void 0===r?o(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function S(e){var t={};for(var r in e)h(e,r)&&(t[r]=e[r]);return t}const A=[].concat;function I(e){return A.apply([],e)}const T="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(I([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>i[e])),P=T.map((e=>i[e]));_(T,(e=>[e,!0]));let C=null;function D(e){C="undefined"!=typeof WeakMap&&new WeakMap;const t=R(e);return C=null,t}function R(e){if(!e||"object"!=typeof e)return e;let t=C&&C.get(e);if(t)return t;if(o(e)){t=[],C&&C.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(R(e[r]))}else if(P.indexOf(e.constructor)>=0)t=e;else{const r=c(e);for(var i in t=r===Object.prototype?{}:Object.create(r),C&&C.set(e,t),e)h(e,i)&&(t[i]=R(e[i]))}return t}const{toString:O}={};function N(e){return O.call(e).slice(8,-1)}const B="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",M="symbol"==typeof B?function(e){var t;return null!=e&&(t=e[B])&&t.apply(e)}:function(){return null},L={};function U(e){var t,r,n,i;if(1===arguments.length){if(o(e))return e.slice();if(this===L&&"string"==typeof e)return[e];if(i=M(e)){for(r=[];!(n=i.next()).done;)r.push(n.value);return r}if(null==e)return[e];if("number"==typeof(t=e.length)){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const j="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var F="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function K(e,t){F=e,z=t}var z=()=>!0;const $=!new Error("").stack;function V(){if($)try{throw V.arguments,new Error}catch(e){return e}return new Error}function q(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(z).map((e=>"\n"+e)).join("")):""}var W=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],H=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(W),G={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Y(e,t){this._e=V(),this.name=e,this.message=t}function J(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,r)=>r.indexOf(e)===t)).join("\n")}function X(e,t,r,n){this._e=V(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=J(e,t)}function Q(e,t){this._e=V(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=J(e,t)}p(Y).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+q(this._e,2))}},toString:function(){return this.name+": "+this.message}}),p(X).from(Y),p(Q).from(Y);var Z=H.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const ee=Y;var te=H.reduce(((e,t)=>{var r=t+"Error";function n(e,n){this._e=V(),this.name=r,e?"string"==typeof e?(this.message=`${e}${n?"\n "+n:""}`,this.inner=n||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=G[t]||r,this.inner=null)}return p(n).from(ee),e[t]=n,e}),{});te.Syntax=SyntaxError,te.Type=TypeError,te.Range=RangeError;var re=W.reduce(((e,t)=>(e[t+"Error"]=te[t],e)),{}),ne=H.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=te[t]),e)),{});function ie(){}function se(e){return e}function oe(e,t){return null==e||e===se?t:function(r){return t(e(r))}}function ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ce(e,t){return e===ie?t:function(){var r=e.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ae(n,this.onsuccess):n),i&&(this.onerror=this.onerror?ae(i,this.onerror):i),void 0!==s?s:r}}function ue(e,t){return e===ie?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ae(r,this.onsuccess):r),n&&(this.onerror=this.onerror?ae(n,this.onerror):n)}}function he(e,t){return e===ie?t:function(r){var n=e.apply(this,arguments);a(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ae(i,this.onsuccess):i),s&&(this.onerror=this.onerror?ae(s,this.onerror):s),void 0===n?void 0===o?void 0:o:a(n,o)}}function le(e,t){return e===ie?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(e,t){return e===ie?t:function(){var r=e.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return r.then((function(){return t.apply(n,s)}))}return t.apply(this,arguments)}}ne.ModifyError=X,ne.DexieError=Y,ne.BulkError=Q;var de={};const[pe,ye,me]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,c(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,c(t),e]})(),ge=ye&&ye.then,be=pe&&pe.constructor,we=!!me;var ve=!1,Ee=me?()=>{me.then(Ve)}:i.setImmediate?setImmediate.bind(null,Ve):i.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Ve(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Ve,0)},_e=function(e,t){De.push([e,t]),ke&&(Ee(),ke=!1)},xe=!0,ke=!0,Se=[],Ae=[],Ie=null,Te=se,Pe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{pt(e[0],e[1])}catch(e){}}))}},Ce=Pe,De=[],Re=0,Oe=[];function Ne(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ie,this._lib=!1;var t=this._PSD=Ce;if(F&&(this._stackHolder=V(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==de)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Ue(this,this._value))}this._state=null,this._value=null,++t.ref,Le(this,e)}const Be={get:function(){var e=Ce,t=et;function r(r,n){var i=!e.global&&(e!==Ce||t!==et);const s=i&&!it();var o=new Ne(((t,o)=>{Fe(this,new Me(ft(r,e,i,s),ft(n,e,i,s),t,o,e))}));return F&&$e(o,this),o}return r.prototype=de,r},set:function(e){d(this,"then",e&&e.prototype===de?Be:{get:function(){return e},set:Be.set})}};function Me(e,t,r,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=i}function Le(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&qe();t&&"function"==typeof t.then?Le(e,((e,r)=>{t instanceof Ne?t._then(e,r):t.then(e,r)})):(e._state=!0,e._value=t,je(e)),r&&We()}}),Ue.bind(null,e))}catch(t){Ue(e,t)}}function Ue(e,t){if(Ae.push(t),null===e._state){var r=e._lib&&qe();t=Te(t),e._state=!1,e._value=t,F&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,r){try{e.apply(null,void 0)}catch(e){}}((()=>{var r=m(t,"stack");t._promise=e,d(t,"stack",{get:()=>ve?r&&(r.get?r.get.apply(t):r.value):e.stack})})),function(e){Se.some((t=>t._value===e._value))||Se.push(e)}(e),je(e),r&&We()}}function je(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)Fe(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),0===Re&&(++Re,_e((()=>{0==--Re&&He()}),[]))}function Fe(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Re,_e(Ke,[r,e,t])}else e._listeners.push(t)}function Ke(e,t,r){try{Ie=t;var n,i=t._value;t._state?n=e(i):(Ae.length&&(Ae=[]),n=e(i),-1===Ae.indexOf(i)&&function(e){for(var t=Se.length;t;)if(Se[--t]._value===e._value)return void Se.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{Ie=null,0==--Re&&He(),--r.psd.ref||r.psd.finalize()}}function ze(e,t,r){if(t.length===r)return t;var n="";if(!1===e._state){var i,s,o=e._value;null!=o?(i=o.name||"Error",s=o.message||o,n=q(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+n)}return F&&((n=q(e._stackHolder,2))&&-1===t.indexOf(n)&&t.push(n),e._prev&&ze(e._prev,t,r)),t}function $e(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function Ve(){qe()&&We()}function qe(){var e=xe;return xe=!1,ke=!1,e}function We(){var e,t,r;do{for(;De.length>0;)for(e=De,De=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(De.length>0);xe=!0,ke=!0}function He(){var e=Se;Se=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Oe.slice(0),r=t.length;r;)t[--r]()}function Ge(e){return new Ne(de,!1,e)}function Ye(e,t){var r=Ce;return function(){var n=qe(),i=Ce;try{return ct(r,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ct(i,!1),n&&We()}}}l(Ne.prototype,{then:Be,_then:function(e,t){Fe(this,new Me(null,null,e,t,Ce))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],r=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?r(e):Ge(e))):this.then(null,(e=>e&&e.name===t?r(e):Ge(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Ge(t))))},stack:{get:function(){if(this._stack)return this._stack;try{ve=!0;var e=ze(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{ve=!1}}},timeout:function(e,t){return e<1/0?new Ne(((r,n)=>{var i=setTimeout((()=>n(new te.Timeout(t))),e);this.then(r,n).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(Ne.prototype,Symbol.toStringTag,"Dexie.Promise"),Pe.env=ut(),l(Ne,{all:function(){var e=U.apply(null,arguments).map(st);return new Ne((function(t,r){0===e.length&&t([]);var n=e.length;e.forEach(((i,s)=>Ne.resolve(i).then((r=>{e[s]=r,--n||t(e)}),r)))}))},resolve:e=>{if(e instanceof Ne)return e;if(e&&"function"==typeof e.then)return new Ne(((t,r)=>{e.then(t,r)}));var t=new Ne(de,!0,e);return $e(t,Ie),t},reject:Ge,race:function(){var e=U.apply(null,arguments).map(st);return new Ne(((t,r)=>{e.map((e=>Ne.resolve(e).then(t,r)))}))},PSD:{get:()=>Ce,set:e=>Ce=e},totalEchoes:{get:()=>et},newPSD:rt,usePSD:ht,scheduler:{get:()=>_e,set:e=>{_e=e}},rejectionMapper:{get:()=>Te,set:e=>{Te=e}},follow:(e,t)=>new Ne(((r,n)=>rt(((t,r)=>{var n=Ce;n.unhandleds=[],n.onunhandled=r,n.finalize=ae((function(){!function(e){Oe.push((function t(){e(),Oe.splice(Oe.indexOf(t),1)})),++Re,_e((()=>{0==--Re&&He()}),[])}((()=>{0===this.unhandleds.length?t():r(this.unhandleds[0])}))}),n.finalize),e()}),t,r,n)))}),be&&(be.allSettled&&d(Ne,"allSettled",(function(){const e=U.apply(null,arguments).map(st);return new Ne((t=>{0===e.length&&t([]);let r=e.length;const n=new Array(r);e.forEach(((e,i)=>Ne.resolve(e).then((e=>n[i]={status:"fulfilled",value:e}),(e=>n[i]={status:"rejected",reason:e})).then((()=>--r||t(n)))))}))})),be.any&&"undefined"!=typeof AggregateError&&d(Ne,"any",(function(){const e=U.apply(null,arguments).map(st);return new Ne(((t,r)=>{0===e.length&&r(new AggregateError([]));let n=e.length;const i=new Array(n);e.forEach(((e,s)=>Ne.resolve(e).then((e=>t(e)),(e=>{i[s]=e,--n||r(new AggregateError(i))}))))}))})));const Je={awaits:0,echoes:0,id:0};var Xe=0,Qe=[],Ze=0,et=0,tt=0;function rt(e,t,r,n){var i=Ce,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++tt;var o=Pe.env;s.env=we?{Promise:Ne,PromiseProp:{value:Ne,configurable:!0,writable:!0},all:Ne.all,race:Ne.race,allSettled:Ne.allSettled,any:Ne.any,resolve:Ne.resolve,reject:Ne.reject,nthen:dt(o.nthen,s),gthen:dt(o.gthen,s)}:{},t&&a(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var c=ht(s,e,r,n);return 0===s.ref&&s.finalize(),c}function nt(){return Je.id||(Je.id=++Xe),++Je.awaits,Je.echoes+=100,Je.id}function it(){return!!Je.awaits&&(0==--Je.awaits&&(Je.id=0),Je.echoes=100*Je.awaits,!0)}function st(e){return Je.echoes&&e&&e.constructor===be?(nt(),e.then((e=>(it(),e)),(e=>(it(),yt(e))))):e}function ot(e){++et,Je.echoes&&0!=--Je.echoes||(Je.echoes=Je.id=0),Qe.push(Ce),ct(e,!0)}function at(){var e=Qe[Qe.length-1];Qe.pop(),ct(e,!1)}function ct(e,t){var r=Ce;if((t?!Je.echoes||Ze++&&e===Ce:!Ze||--Ze&&e===Ce)||lt(t?ot.bind(null,e):at),e!==Ce&&(Ce=e,r===Pe&&(Pe.env=ut()),we)){var n=Pe.env.Promise,s=e.env;ye.then=s.nthen,n.prototype.then=s.gthen,(r.global||e.global)&&(Object.defineProperty(i,"Promise",s.PromiseProp),n.all=s.all,n.race=s.race,n.resolve=s.resolve,n.reject=s.reject,s.allSettled&&(n.allSettled=s.allSettled),s.any&&(n.any=s.any))}}function ut(){var e=i.Promise;return we?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ye.then,gthen:e.prototype.then}:{}}function ht(e,t,r,n,i){var s=Ce;try{return ct(e,!0),t(r,n,i)}finally{ct(s,!1)}}function lt(e){ge.call(pe,e)}function ft(e,t,r,n){return"function"!=typeof e?e:function(){var i=Ce;r&&nt(),ct(t,!0);try{return e.apply(this,arguments)}finally{ct(i,!1),n&&lt(it)}}}function dt(e,t){return function(r,n){return e.call(this,ft(r,t),ft(n,t))}}function pt(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var s,o={promise:t,reason:e};if(i.document&&document.createEvent?((s=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),a(s,o)):i.CustomEvent&&a(s=new CustomEvent("unhandledrejection",{detail:o}),o),s&&i.dispatchEvent&&(dispatchEvent(s),!i.PromiseRejectionEvent&&i.onunhandledrejection))try{i.onunhandledrejection(s)}catch(e){}F&&s&&!s.defaultPrevented&&n.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+ge).indexOf("[native code]")&&(nt=it=ie);var yt=Ne.reject;function mt(e,t,r,i){if(e.idbdb&&(e._state.openComplete||Ce.letThrough||e._vip)){var s=e._createTransaction(t,r,e._dbSchema);try{s.create(),e._state.PR1398_maxLoop=3}catch(s){return s.name===Z.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(n.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>mt(e,t,r,i)))):yt(s)}return s._promise(t,((e,t)=>rt((()=>(Ce.trans=s,i(e,t,s)))))).then((e=>s._completion.then((()=>e))))}if(e._state.openComplete)return yt(new te.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return yt(new te.DatabaseClosed);e.open().catch(ie)}return e._state.dbReadyPromise.then((()=>mt(e,t,r,i)))}const gt=String.fromCharCode(65535),bt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wt=[],vt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Et=vt,_t=vt,xt=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function kt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const St={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function At(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=D(t))[e],t)}class It{_trans(e,t,r){const n=this._tx||Ce.trans,i=this.name;function s(e,r,n){if(!n.schema[i])throw new te.NotFound("Table "+i+" not part of transaction");return t(n.idbtrans,n)}const o=qe();try{return n&&n.db===this.db?n===Ce.trans?n._promise(e,s,r):rt((()=>n._promise(e,s,r)),{trans:n,transless:Ce.transless||Ce}):mt(this.db,e,[this.name],s)}finally{o&&We()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(o(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=s(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(r&&this.db._maxKey!==gt)return this.where(r.name).equals(r.keyPath.map((t=>e[t])));!r&&F&&n.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:i}=this.schema,a=this.db._deps.indexedDB;function c(e,t){try{return 0===a.cmp(e,t)}catch(e){return!1}}const[u,h]=t.reduce((([t,r],n)=>{const s=i[n],a=e[n];return[t||s,t||!s?kt(r,s&&s.multi?e=>{const t=x(e,n);return o(t)&&t.some((e=>c(a,e)))}:e=>c(a,x(e,n))):r]}),[null,null]);return u?this.where(u.name).equals(e[u.keyPath]).filter(h):r?this.filter(h):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,o(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const r=Object.create(e.prototype);for(var n in t)if(h(t,n))try{r[n]=t[n]}catch(e){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){a(this,e)}))}add(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let i=e;return n&&r&&(i=At(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?Ne.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{k(e,n,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||o(e))return this.where(":id").equals(e).modify(t);{const r=x(e,this.schema.primKey.keyPath);if(void 0===r)return yt(new te.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?s(t).forEach((r=>{k(e,r,t[r])})):t(e,{value:e,primKey:r})}catch(e){}return this.where(":id").equals(r).modify(t)}}put(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let i=e;return n&&r&&(i=At(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Ne.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{k(e,n,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Ne.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:St}))).then((e=>e.numFailures?Ne.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,r){const n=Array.isArray(t)?t:void 0,i=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:s}=this.schema.primKey;if(s&&n)throw new te.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&r?e.map(At(s)):e;return this.core.mutate({trans:t,type:"add",keys:n,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return i?t:r;throw new Q(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,n)}))}))}bulkPut(e,t,r){const n=Array.isArray(t)?t:void 0,i=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:s}=this.schema.primKey;if(s&&n)throw new te.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=s&&r?e.map(At(s)):e;return this.core.mutate({trans:t,type:"put",keys:n,values:a,wantResults:i}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return i?t:r;throw new Q(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,n)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:r,failures:n})=>{if(0===e)return r;throw new Q(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,n)}))}}function Tt(e){var t={},r=function(r,n){if(n){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return t[r].subscribe.apply(null,s),e}if("string"==typeof r)return t[r]};r.addEventType=a;for(var n=1,i=arguments.length;n<i;++n)a(arguments[n]);return r;function a(e,n,i){if("object"==typeof e)return c(e);n||(n=le),i||(i=ie);var s={subscribers:[],fire:i,subscribe:function(e){-1===s.subscribers.indexOf(e)&&(s.subscribers.push(e),s.fire=n(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter((function(t){return t!==e})),s.fire=s.subscribers.reduce(n,i)}};return t[e]=r[e]=s,s}function c(e){s(e).forEach((function(t){var r=e[t];if(o(r))a(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new te.InvalidArgument("Invalid event config");var n=a(t,se,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){E((function(){e.apply(null,t)}))}))}))}}))}}function Pt(e,t){return p(t).from({prototype:e}),t}function Ct(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Dt(e,t){e.filter=kt(e.filter,t)}function Rt(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>kt(n(),t()):t,e.justLimit=r&&!n}function Ot(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new te.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Nt(e,t,r){const n=Ot(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function Bt(e,t,r,n){const i=e.replayFilter?kt(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},o=(e,r,n)=>{if(!i||i(r,n,(e=>r.stop(e)),(e=>r.fail(e)))){var o=r.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),h(s,a)||(s[a]=!0,t(e,r,n))}};return Promise.all([e.or._iterate(o,r),Mt(Nt(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Mt(Nt(e,n,r),kt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Mt(e,t,r,n){var i=Ye(n?(e,t,i)=>r(n(e),t,i):r);return e.then((e=>{if(e)return e.start((()=>{var r=()=>e.continue();t&&!t(e,(e=>r=e),(t=>{e.stop(t),r=ie}),(t=>{e.fail(t),r=ie}))||i(e.value,e,(e=>r=e)),r()}))}))}function Lt(e,t){try{const r=Ut(e),n=Ut(t);if(r!==n)return"Array"===r?1:"Array"===n?-1:"binary"===r?1:"binary"===n?-1:"string"===r?1:"string"===n?-1:"Date"===r?1:"Date"!==n?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const r=e.length,n=t.length,i=r<n?r:n;for(let r=0;r<i;++r)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return r===n?0:r<n?-1:1}(jt(e),jt(t));case"Array":return function(e,t){const r=e.length,n=t.length,i=r<n?r:n;for(let r=0;r<i;++r){const n=Lt(e[r],t[r]);if(0!==n)return n}return r===n?0:r<n?-1:1}(e,t)}}catch(e){}return NaN}function Ut(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const r=N(e);return"ArrayBuffer"===r?"binary":r}function jt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Ft{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,yt.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,yt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=kt(t.algorithm,e)}_iterate(e,t){return Bt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&a(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((r=>Bt(t,e,r,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,r=t.table.core;if(Ct(t,!0))return r.count({trans:e,query:{index:Ot(t,r.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var n=0;return Bt(t,(()=>(++n,!1)),e,r).then((()=>n))})).then(e)}sortBy(e,t){const r=e.split(".").reverse(),n=r[0],i=r.length-1;function s(e,t){return t?s(e[r[t]],t-1):e[n]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var r=s(e,i),n=s(t,i);return r<n?-o:r>n?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Ct(t,!0)&&t.limit>0){const{valueMapper:r}=t,n=Ot(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:n,range:t.range}}).then((({result:e})=>r?e.map(r):e))}{const r=[];return Bt(t,(e=>r.push(e)),e,t.table.core).then((()=>r))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Ct(t)?Rt(t,(()=>{var t=e;return(e,r)=>0===t||(1===t?(--t,!1):(r((()=>{e.advance(t),t=0})),!1))})):Rt(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Rt(this._ctx,(()=>{var t=e;return function(e,r,n){return--t<=0&&r(n),t>=0}}),!0),this}until(e,t){return Dt(this._ctx,(function(r,n,i){return!e(r.value)||(n(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,r;return Dt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,r=e,t.isMatch=kt(t.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.key,r)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.primaryKey,r)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.key)})).then((function(){return r})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Ct(t,!0)&&t.limit>0)return this._read((e=>{var r=Ot(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return Dt(this._ctx,(function(e){var t=e.primaryKey.toString(),n=h(r,t);return r[t]=!0,!n})),this}modify(e){var t=this._ctx;return this._write((r=>{var n;if("function"==typeof e)n=e;else{var i=s(e),o=i.length;n=function(t){for(var r=!1,n=0;n<o;++n){var s=i[n],a=e[s];x(t,s)!==a&&(k(t,s,a),r=!0)}return r}}const a=t.table.core,{outbound:c,extractKey:u}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,l=[];let f=0;const d=[],p=(e,t)=>{const{failures:r,numFailures:n}=t;f+=e-n;for(let e of s(r))l.push(r[e])};return this.clone().primaryKeys().then((i=>{const s=o=>{const l=Math.min(h,i.length-o);return a.getMany({trans:r,keys:i.slice(o,o+l),cache:"immutable"}).then((f=>{const d=[],y=[],m=c?[]:null,g=[];for(let e=0;e<l;++e){const t=f[e],r={value:D(t),primKey:i[o+e]};!1!==n.call(r,r.value,r)&&(null==r.value?g.push(i[o+e]):c||0===Lt(u(t),u(r.value))?(y.push(r.value),c&&m.push(i[o+e])):(g.push(i[o+e]),d.push(r.value)))}const b=Ct(t)&&t.limit===1/0&&("function"!=typeof e||e===Kt)&&{index:t.index,range:t.range};return Promise.resolve(d.length>0&&a.mutate({trans:r,type:"add",values:d}).then((e=>{for(let t in e.failures)g.splice(parseInt(t),1);p(d.length,e)}))).then((()=>(y.length>0||b&&"object"==typeof e)&&a.mutate({trans:r,type:"put",keys:m,values:y,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>p(y.length,e))))).then((()=>(g.length>0||b&&e===Kt)&&a.mutate({trans:r,type:"delete",keys:g,criteria:b}).then((e=>p(g.length,e))))).then((()=>i.length>o+l&&s(o+h)))}))};return s(0).then((()=>{if(l.length>0)throw new X("Error modifying one or more objects",l,f,d);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Ct(e)&&(e.isPrimKey&&!_t||3===t.type)?this._write((r=>{const{primaryKey:n}=e.table.core.schema,i=t;return e.table.core.count({trans:r,query:{index:n,range:i}}).then((t=>e.table.core.mutate({trans:r,type:"deleteRange",range:i}).then((({failures:e,lastResult:r,results:n,numFailures:i})=>{if(i)throw new X("Could not delete some values",Object.keys(e).map((t=>e[t])),t-i);return t-i}))))})):this.modify(Kt)}}const Kt=(e,t)=>t.value=null;function zt(e,t){return e<t?-1:e===t?0:1}function $t(e,t){return e>t?-1:e===t?0:1}function Vt(e,t,r){var n=e instanceof Jt?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function qt(e){return new e.Collection(e,(()=>Yt(""))).limit(0)}function Wt(e,t,r,n,i,s){for(var o=Math.min(e.length,n.length),a=-1,c=0;c<o;++c){var u=t[c];if(u!==n[c])return i(e[c],r[c])<0?e.substr(0,c)+r[c]+r.substr(c+1):i(e[c],n[c])<0?e.substr(0,c)+n[c]+r.substr(c+1):a>=0?e.substr(0,a)+t[a]+r.substr(a+1):null;i(e[c],u)<0&&(a=c)}return o<n.length&&"next"===s?e+r.substr(e.length):o<e.length&&"prev"===s?e.substr(0,r.length):a<0?null:e.substr(0,a)+n[a]+r.substr(a+1)}function Ht(e,t,r,n){var i,s,o,a,c,u,h,l=r.length;if(!r.every((e=>"string"==typeof e)))return Vt(e,"String expected.");function f(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),s=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),o="next"===e?zt:$t;var t=r.map((function(e){return{lower:s(e),upper:i(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),u=e,h="next"===e?"":n}f("next");var d=new e.Collection(e,(()=>Gt(a[0],c[l-1]+n)));d._ondirectionchange=function(e){f(e)};var p=0;return d._addAlgorithm((function(e,r,n){var i=e.key;if("string"!=typeof i)return!1;var f=s(i);if(t(f,c,p))return!0;for(var d=null,y=p;y<l;++y){var m=Wt(i,f,a[y],c[y],o,u);null===m&&null===d?p=y+1:(null===d||o(d,m)>0)&&(d=m)}return r(null!==d?function(){e.continue(d+h)}:n),!1})),d}function Gt(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Yt(e){return{type:1,lower:e,upper:e}}class Jt{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,n){r=!1!==r,n=!0===n;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?qt(this):new this.Collection(this,(()=>Gt(e,t,!r,!n)))}catch(e){return Vt(this,bt)}}equals(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Yt(e)))}above(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(e,void 0,!0)))}aboveOrEqual(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(e,void 0,!1)))}below(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(void 0,e)))}startsWith(e){return"string"!=typeof e?Vt(this,"String expected."):this.between(e,e+gt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):Ht(this,((e,t)=>0===e.indexOf(t[0])),[e],gt)}equalsIgnoreCase(e){return Ht(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=U.apply(L,arguments);return 0===e.length?qt(this):Ht(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=U.apply(L,arguments);return 0===e.length?qt(this):Ht(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,gt)}anyOf(){const e=U.apply(L,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Vt(this,bt)}if(0===e.length)return qt(this);const r=new this.Collection(this,(()=>Gt(e[0],e[e.length-1])));r._ondirectionchange=r=>{t="next"===r?this._ascending:this._descending,e.sort(t)};let n=0;return r._addAlgorithm(((r,i,s)=>{const o=r.key;for(;t(o,e[n])>0;)if(++n,n===e.length)return i(s),!1;return 0===t(o,e[n])||(i((()=>{r.continue(e[n])})),!1)})),r}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=U.apply(L,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Vt(this,bt)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const r=this._cmp,n=this._ascending,i=this._descending,s=this._min,o=this._max;if(0===e.length)return qt(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&n(e[0],e[1])<=0)))return Vt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",te.InvalidArgument);const a=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let u,h=n;function l(e,t){return h(e[0],t[0])}try{u=e.reduce((function(e,t){let n=0,i=e.length;for(;n<i;++n){const i=e[n];if(r(t[0],i[1])<0&&r(t[1],i[0])>0){i[0]=s(i[0],t[0]),i[1]=o(i[1],t[1]);break}}return n===i&&e.push(t),e}),[]),u.sort(l)}catch(e){return Vt(this,bt)}let f=0;const d=c?e=>n(e,u[f][1])>0:e=>n(e,u[f][1])>=0,p=a?e=>i(e,u[f][0])>0:e=>i(e,u[f][0])>=0;let y=d;const m=new this.Collection(this,(()=>Gt(u[0][0],u[u.length-1][1],!a,!c)));return m._ondirectionchange=e=>{"next"===e?(y=d,h=n):(y=p,h=i),u.sort(l)},m._addAlgorithm(((e,t,r)=>{for(var i=e.key;y(i);)if(++f,f===u.length)return t(r),!1;return!!function(e){return!d(e)&&!p(e)}(i)||(0===this._cmp(i,u[f][1])||0===this._cmp(i,u[f][0])||t((()=>{h===n?e.continue(u[f][0]):e.continue(u[f][1])})),!1)})),m}startsWithAnyOf(){const e=U.apply(L,arguments);return e.every((e=>"string"==typeof e))?0===e.length?qt(this):this.inAnyRange(e.map((e=>[e,e+gt]))):Vt(this,"startsWithAnyOf() only works with strings")}}function Xt(e){return Ye((function(t){return Qt(t),e(t.target.error),!1}))}function Qt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Zt=Tt(null,"storagemutated");class er{_lock(){return v(!Ce.global),++this._reculock,1!==this._reculock||Ce.global||(Ce.lockOwnerFor=this),this}_unlock(){if(v(!Ce.global),0==--this._reculock)for(Ce.global||(Ce.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ht(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Ce.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,r=this.db._state.dbOpenError;if(v(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new te.DatabaseClosed(r);case"MissingAPIError":throw new te.MissingAPI(r.message,r);default:throw new te.OpenFailed(r)}if(!this.active)throw new te.TransactionInactive;return v(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ye((t=>{Qt(t),this._reject(e.error)})),e.onabort=Ye((t=>{Qt(t),this.active&&this._reject(new te.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Ye((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Zt.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,r){if("readwrite"===e&&"readwrite"!==this.mode)return yt(new te.ReadOnly("Transaction is readonly"));if(!this.active)return yt(new te.TransactionInactive);if(this._locked())return new Ne(((n,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(n,i)},Ce])}));if(r)return rt((()=>{var e=new Ne(((e,r)=>{this._lock();const n=t(e,r,this);n&&n.then&&n.then(e,r)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var n=new Ne(((e,r)=>{var n=t(e,r,this);n&&n.then&&n.then(e,r)}));return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const r=Ne.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>r));else{t._waitingFor=r,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Ne(((e,n)=>{r.then((r=>t._waitingQueue.push(Ye(e.bind(null,r)))),(e=>t._waitingQueue.push(Ye(n.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new te.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(h(t,e))return t[e];const r=this.schema[e];if(!r)throw new te.NotFound("Table "+e+" not part of transaction");const n=new this.db.Table(e,r,this);return n.core=this.db.core.table(e),t[e]=n,n}}function tr(e,t,r,n,i,s,o){return{name:e,keyPath:t,unique:r,multi:n,auto:i,compound:s,src:(r&&!o?"&":"")+(n?"*":"")+(i?"++":"")+rr(t)}}function rr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function nr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:_(r,(e=>[e.name,e]))}}let ir=e=>{try{return e.only([[]]),ir=()=>[[]],[[]]}catch(e){return ir=()=>gt,gt}};function sr(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>x(t,e)}(e):t=>x(t,e)}function or(e){return[].slice.call(e)}let ar=0;function cr(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function ur(e,t,r){function n(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:r,upper:n,lowerOpen:i,upperOpen:s}=e;return void 0===r?void 0===n?null:t.upperBound(n,!!s):void 0===n?t.lowerBound(r,!!i):t.bound(r,n,!!i,!!s)}const{schema:i,hasGetAll:s}=function(e,t){const r=or(e.objectStoreNames);return{schema:{name:e.name,tables:r.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:r}=e,n=o(t),i=null==t,s={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:n,keyPath:t,autoIncrement:r,unique:!0,extractKey:sr(t)},indexes:or(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:r,multiEntry:n,keyPath:i}=e,a={name:t,compound:o(i),keyPath:i,unique:r,multiEntry:n,extractKey:sr(i)};return s[cr(i)]=a,a})),getIndexByKeyPath:e=>s[cr(e)]};return s[":id"]=a.primaryKey,null!=t&&(s[cr(t)]=a.primaryKey),a}))},hasGetAll:r.length>0&&"getAll"in t.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),a=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:r,keys:i,values:s,range:o}){return new Promise(((a,c)=>{a=Ye(a);const u=e.objectStore(t),h=null==u.keyPath,l="put"===r||"add"===r;if(!l&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);const{length:f}=i||s||{length:1};if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===f)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const p=[],y=[];let m=0;const g=e=>{++m,Qt(e)};if("deleteRange"===r){if(4===o.type)return a({numFailures:m,failures:y,results:[],lastResult:void 0});3===o.type?p.push(d=u.clear()):p.push(d=u.delete(n(o)))}else{const[e,t]=l?h?[s,i]:[s,null]:[i,null];if(l)for(let n=0;n<f;++n)p.push(d=t&&void 0!==t[n]?u[r](e[n],t[n]):u[r](e[n])),d.onerror=g;else for(let t=0;t<f;++t)p.push(d=u[r](e[t])),d.onerror=g}const b=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(y[t]=e.error))),a({numFailures:m,failures:y,results:"delete"===r?i:p.map((e=>e.result)),lastResult:t})};d.onerror=e=>{g(e),b(e)},d.onsuccess=b}))},getMany:({trans:e,keys:r})=>new Promise(((n,i)=>{n=Ye(n);const s=e.objectStore(t),o=r.length,a=new Array(o);let c,u=0,h=0;const l=e=>{const t=e.target;a[t._pos]=t.result,++h===u&&n(a)},f=Xt(i);for(let e=0;e<o;++e)null!=r[e]&&(c=s.get(r[e]),c._pos=e,c.onsuccess=l,c.onerror=f,++u);0===u&&n(a)})),get:({trans:e,key:r})=>new Promise(((n,i)=>{n=Ye(n);const s=e.objectStore(t).get(r);s.onsuccess=e=>n(e.target.result),s.onerror=Xt(i)})),query:function(e){return r=>new Promise(((i,s)=>{i=Ye(i);const{trans:o,values:a,limit:c,query:u}=r,h=c===1/0?void 0:c,{index:l,range:f}=u,d=o.objectStore(t),p=l.isPrimaryKey?d:d.index(l.name),y=n(f);if(0===c)return i({result:[]});if(e){const e=a?p.getAll(y,h):p.getAllKeys(y,h);e.onsuccess=e=>i({result:e.target.result}),e.onerror=Xt(s)}else{let e=0;const t=a||!("openKeyCursor"in p)?p.openCursor(y):p.openKeyCursor(y),r=[];t.onsuccess=n=>{const s=t.result;return s?(r.push(a?s.value:s.primaryKey),++e===c?i({result:r}):void s.continue()):i({result:r})},t.onerror=Xt(s)}}))}(s),openCursor:function({trans:e,values:r,query:i,reverse:s,unique:o}){return new Promise(((a,c)=>{a=Ye(a);const{index:u,range:h}=i,l=e.objectStore(t),f=u.isPrimaryKey?l:l.index(u.name),d=s?o?"prevunique":"prev":o?"nextunique":"next",p=r||!("openKeyCursor"in f)?f.openCursor(n(h),d):f.openKeyCursor(n(h),d);p.onerror=Xt(c),p.onsuccess=Ye((t=>{const r=p.result;if(!r)return void a(null);r.___id=++ar,r.done=!1;const n=r.continue.bind(r);let i=r.continuePrimaryKey;i&&(i=i.bind(r));const s=r.advance.bind(r),o=()=>{throw new Error("Cursor not stopped")};r.trans=e,r.stop=r.continue=r.continuePrimaryKey=r.advance=()=>{throw new Error("Cursor not started")},r.fail=Ye(c),r.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},r.start=e=>{const t=new Promise(((e,t)=>{e=Ye(e),p.onerror=Xt(t),r.fail=t,r.stop=t=>{r.stop=r.continue=r.continuePrimaryKey=r.advance=o,e(t)}})),a=()=>{if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=()=>{throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Ye((e=>{p.onsuccess=a,a()})),r.continue=n,r.continuePrimaryKey=i,r.advance=s,a(),t},a(r)}),c)}))},count({query:e,trans:r}){const{index:i,range:s}=e;return new Promise(((e,o)=>{const a=r.objectStore(t),c=i.isPrimaryKey?a:a.index(i.name),u=n(s),h=u?c.count(u):c.count();h.onsuccess=Ye((t=>e(t.target.result))),h.onerror=Xt(o)}))}}}(e))),c={};return a.forEach((e=>c[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!c[e])throw new Error(`Table '${e}' not found`);return c[e]},MIN_KEY:-1/0,MAX_KEY:ir(t),schema:i}}function hr({_novip:e},t){const r=t.db,n=function(e,t,{IDBKeyRange:r,indexedDB:n},i){const s=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(ur(t,r,i),e.dbcore);return{dbcore:s}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach((t=>{const r=t.name;e.core.schema.tables.some((e=>e.name===r))&&(t.core=e.core.table(r),e[r]instanceof e.Table&&(e[r].core=t.core))}))}function lr({_novip:e},t,r,n){r.forEach((r=>{const i=n[r];t.forEach((t=>{const n=m(t,r);(!n||"value"in n&&void 0===n.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?d(t,r,{get(){return this.table(r)},set(e){f(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[r]=new e.Table(r,i))}))}))}function fr({_novip:e},t){t.forEach((t=>{for(let r in t)t[r]instanceof e.Table&&delete t[r]}))}function dr(e,t){return e._cfg.version-t._cfg.version}function pr(e,t,r,n){const i=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,i);o.create(r),o._completion.catch(n);const a=o._reject.bind(o),c=Ce.transless||Ce;rt((()=>{Ce.trans=o,Ce.transless=c,0===t?(s(i).forEach((e=>{mr(r,e,i[e].primKey,i[e].indexes)})),hr(e,r),Ne.follow((()=>e.on.populate.fire(o))).catch(a)):function({_novip:e},t,r,n){const i=[],o=e._versions;let a=e._dbSchema=br(e,e.idbdb,n),c=!1;return o.filter((e=>e._cfg.version>=t)).forEach((o=>{i.push((()=>{const i=a,u=o._cfg.dbschema;wr(e,i,n),wr(e,u,n),a=e._dbSchema=u;const h=yr(i,u);h.add.forEach((e=>{mr(n,e[0],e[1].primKey,e[1].indexes)})),h.change.forEach((e=>{if(e.recreate)throw new te.Upgrade("Not yet support for changing primary key");{const t=n.objectStore(e.name);e.add.forEach((e=>gr(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),gr(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const l=o._cfg.contentUpgrade;if(l&&o._cfg.version>t){hr(e,n),r._memoizedTables={},c=!0;let t=S(u);h.del.forEach((e=>{t[e]=i[e]})),fr(e,[e.Transaction.prototype]),lr(e,[e.Transaction.prototype],s(t),t),r.schema=t;const o=j(l);let a;o&&nt();const f=Ne.follow((()=>{if(a=l(r),a&&o){var e=it.bind(null,null);a.then(e,e)}}));return a&&"function"==typeof a.then?Ne.resolve(a):f.then((()=>a))}})),i.push((t=>{c&&Et||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((r=>null==e[r]&&t.db.deleteObjectStore(r)))}(o._cfg.dbschema,t),fr(e,[e.Transaction.prototype]),lr(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),r.schema=e._dbSchema}))})),function e(){return i.length?Ne.resolve(i.shift()(r.idbtrans)).then(e):Ne.resolve()}().then((()=>{var e,t;t=n,s(e=a).forEach((r=>{t.db.objectStoreNames.contains(r)||mr(t,r,e[r].primKey,e[r].indexes)}))}))}(e,t,o,r).catch(a)}))}function yr(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const i=e[n],s=t[n];if(i){const e={name:n,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!vt)e.recreate=!0,r.change.push(e);else{const t=i.idxByName,n=s.idxByName;let o;for(o in t)n[o]||e.del.push(o);for(o in n){const r=t[o],i=n[o];r?r.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&r.change.push(e)}}else r.add.push([n,s])}return r}function mr(e,t,r,n){const i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((e=>gr(i,e))),i}function gr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function br(e,t,r){const n={};return b(t.objectStoreNames,0).forEach((e=>{const t=r.objectStore(e);let i=t.keyPath;const s=tr(rr(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),o=[];for(let e=0;e<t.indexNames.length;++e){const r=t.index(t.indexNames[e]);i=r.keyPath;var a=tr(r.name,i,!!r.unique,!!r.multiEntry,!1,i&&"string"!=typeof i,!1);o.push(a)}n[e]=nr(e,s,o)})),n}function wr({_novip:e},t,r){const n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){const s=n[i],o=r.objectStore(s);e._hasGetAll="getAll"in o;for(let e=0;e<o.indexNames.length;++e){const r=o.indexNames[e],n=o.index(r).keyPath,i="string"==typeof n?n:"["+b(n).join("+")+"]";if(t[s]){const e=t[s].idxByName[i];e&&(e.name=r,delete t[s].idxByName[i],t[s].idxByName[r]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class vr{_parseStoresSpec(e,t){s(e).forEach((r=>{if(null!==e[r]){var n=e[r].split(",").map(((e,t)=>{const r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return tr(r,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),o(n),0===t)})),i=n.shift();if(i.multi)throw new te.Schema("Primary key cannot be multi-valued");n.forEach((e=>{if(e.auto)throw new te.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new te.Schema("Index must have a name and cannot be an empty string")})),t[r]=nr(r,i,n)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,e):e;const r=t._versions,n={};let i={};return r.forEach((e=>{a(n,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(n,i)})),t._dbSchema=i,fr(t,[t._allTables,t,t.Transaction.prototype]),lr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],s(i),i),t._storeNames=s(i),this}upgrade(e){return this._cfg.contentUpgrade=fe(this._cfg.contentUpgrade||ie,e),this}}function Er(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new zr("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function _r(e){return e&&"function"==typeof e.databases}function xr(e){return rt((function(){return Ce.letThrough=!0,e()}))}function kr(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Sr(e){var t=t=>e.next(t),r=i(t),n=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),s=i.value;return i.done?s:s&&"function"==typeof s.then?s.then(r,n):o(s)?Promise.all(s).then(r,n):r(s)}}return i(t)()}function Ar(e,t,r){var n=arguments.length;if(n<2)throw new te.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];return r=i.pop(),[e,I(i),r]}function Ir(e,t,r,i,s){return Ne.resolve().then((()=>{const o=Ce.transless||Ce,a=e._createTransaction(t,r,e._dbSchema,i),c={trans:a,transless:o};if(i)a.idbtrans=i.idbtrans;else try{a.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===Z.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(n.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Ir(e,t,r,null,s)))):yt(i)}const u=j(s);let h;u&&nt();const l=Ne.follow((()=>{if(h=s.call(a,a),h)if(u){var e=it.bind(null,null);h.then(e,e)}else"function"==typeof h.next&&"function"==typeof h.throw&&(h=Sr(h))}),c);return(h&&"function"==typeof h.then?Ne.resolve(h).then((e=>a.active?e:yt(new te.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):l.then((()=>h))).then((e=>(i&&a._resolve(),a._completion.then((()=>e))))).catch((e=>(a._reject(e),yt(e))))}))}function Tr(e,t,r){const n=o(e)?e.slice():[e];for(let e=0;e<r;++e)n.push(t);return n}const Pr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,i={},s=[];function o(e,t,r){const n=cr(e),a=i[n]=i[n]||[],c=null==e?0:"string"==typeof e?1:e.length,u=t>0,h={...r,isVirtual:u,keyTail:t,keyLength:c,extractKey:sr(e),unique:!u&&r.unique};return a.push(h),h.isPrimaryKey||s.push(h),c>1&&o(2===c?e[0]:e.slice(0,c-1),t+1,r),a.sort(((e,t)=>e.keyTail-t.keyTail)),h}const a=o(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(const e of n.indexes)o(e.keyPath,0,e);function c(t){const r=t.query.index;return r.isVirtual?{...t,query:{index:r,range:(n=t.query.range,i=r.keyTail,{type:1===n.type?2:n.type,lower:Tr(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Tr(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var n,i}const u={...r,schema:{...n,primaryKey:a,indexes:s,getIndexByKeyPath:function(e){const t=i[cr(e)];return t&&t[0]}},count:e=>r.count(c(e)),query:e=>r.query(c(e)),openCursor(t){const{keyTail:n,isVirtual:i,keyLength:s}=t.query.index;return i?r.openCursor(c(t)).then((r=>r&&function(r){const i=Object.create(r,{continue:{value:function(i){null!=i?r.continue(Tr(i,t.reverse?e.MAX_KEY:e.MIN_KEY,n)):t.unique?r.continue(r.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,n)):r.continue()}},continuePrimaryKey:{value(t,i){r.continuePrimaryKey(Tr(t,e.MAX_KEY,n),i)}},primaryKey:{get:()=>r.primaryKey},key:{get(){const e=r.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:()=>r.value}});return i}(r))):r.openCursor(t)}};return u}}}};function Cr(e,t,r,n){return r=r||{},n=n||"",s(e).forEach((i=>{if(h(t,i)){var s=e[i],o=t[i];if("object"==typeof s&&"object"==typeof o&&s&&o){const e=N(s);e!==N(o)?r[n+i]=t[i]:"Object"===e?Cr(s,o,r,n+i+"."):s!==o&&(r[n+i]=t[i])}else s!==o&&(r[n+i]=t[i])}else r[n+i]=void 0})),s(t).forEach((i=>{h(e,i)||(r[n+i]=t[i])})),r}const Dr={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema,i={...r,mutate(e){const i=Ce.trans,{deleting:s,creating:o,updating:a}=i.table(t).hook;switch(e.type){case"add":if(o.fire===ie)break;return i._promise("readwrite",(()=>c(e)),!0);case"put":if(o.fire===ie&&a.fire===ie)break;return i._promise("readwrite",(()=>c(e)),!0);case"delete":if(s.fire===ie)break;return i._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(s.fire===ie)break;return i._promise("readwrite",(()=>function(e){return u(e.trans,e.range,1e4)}(e)),!0)}return r.mutate(e);function c(e){const t=Ce.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(n,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,r){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:r,cache:"immutable"})}(r,e,i).then((c=>{const u=i.map(((r,i)=>{const u=c[i],l={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(l,r,u,t);else if("add"===e.type||void 0===u){const s=o.fire.call(l,r,e.values[i],t);null==r&&null!=s&&(r=s,e.keys[i]=r,n.outbound||k(e.values[i],n.keyPath,r))}else{const n=Cr(u,e.values[i]),s=a.fire.call(l,n,r,u,t);if(s){const t=e.values[i];Object.keys(s).forEach((e=>{h(t,e)?t[e]=s[e]:k(t,e,s[e])}))}}return l}));return r.mutate(e).then((({failures:t,results:r,numFailures:n,lastResult:s})=>{for(let n=0;n<i.length;++n){const s=r?r[n]:i[n],o=u[n];null==s?o.onerror&&o.onerror(t[n]):o.onsuccess&&o.onsuccess("put"===e.type&&c[n]?e.values[n]:s)}return{failures:t,results:r,numFailures:n,lastResult:s}})).catch((e=>(u.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function u(e,t,i){return r.query({trans:e,values:!1,query:{index:n,range:t},limit:i}).then((({result:r})=>c({type:"delete",keys:r,trans:e}).then((n=>n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:u(e,{...t,lower:r[r.length-1],lowerOpen:!0},i)))))}}};return i}})};function Rr(e,t,r){try{if(!t)return null;if(t.keys.length<e.length)return null;const n=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)0===Lt(t.keys[i],e[s])&&(n.push(r?D(t.values[i]):t.values[i]),++s);return n.length===e.length?n:null}catch(e){return null}}const Or={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:e=>{if(!e.cache)return r.getMany(e);const t=Rr(e.keys,e.trans._cache,"clone"===e.cache);return t?Ne.resolve(t):r.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?D(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),r.mutate(e))}}})};function Nr(e){return!("from"in e)}const Br=function(e,t){if(!this){const t=new Br;return e&&"d"in e&&a(t,e),t}a(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Mr(e,t,r){const n=Lt(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(Nr(e))return a(e,{from:t,to:r,d:1});const i=e.l,s=e.r;if(Lt(r,e.from)<0)return i?Mr(i,t,r):e.l={from:t,to:r,d:1,l:null,r:null},jr(e);if(Lt(t,e.to)>0)return s?Mr(s,t,r):e.r={from:t,to:r,d:1,l:null,r:null},jr(e);Lt(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),Lt(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&Lr(e,i),s&&o&&Lr(e,s)}function Lr(e,t){Nr(t)||function e(t,{from:r,to:n,l:i,r:s}){Mr(t,r,n),i&&e(t,i),s&&e(t,s)}(e,t)}function Ur(e){let t=Nr(e)?null:{s:0,n:e};return{next(e){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&Lt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||Lt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function jr(e){var t,r;const n=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){const t="r"===i?"l":"r",r={...e},n=e[i];e.from=n.from,e.to=n.to,e[i]=n[i],r[i]=n[t],e[t]=r,r.d=Fr(r)}e.d=Fr(e)}function Fr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}l(Br.prototype,{add(e){return Lr(this,e),this},addKey(e){return Mr(this,e,e),this},addKeys(e){return e.forEach((e=>Mr(this,e,e))),this},[B](){return Ur(this)}});const Kr={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new Br(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const i=e.table(n),{schema:a}=i,{primaryKey:c}=a,{extractKey:u,outbound:h}=c,l={...i,mutate:e=>{const s=e.trans,c=s.mutatedParts||(s.mutatedParts={}),u=e=>{const r=`idb://${t}/${n}/${e}`;return c[r]||(c[r]=new Br)},h=u(""),l=u(":dels"),{type:f}=e;let[d,p]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const y=e.trans._cache;return i.mutate(e).then((e=>{if(o(d)){"delete"!==f&&(d=e.results),h.addKeys(d);const t=Rr(d,y);t||"add"===f||l.addKeys(d),(t||p)&&function(e,t,r,n){t.indexes.forEach((function(t){const i=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const a=e=>t.multiEntry&&o(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(r||n).forEach(((e,t)=>{const i=r&&s(r[t]),o=n&&s(n[t]);0!==Lt(i,o)&&(null!=i&&a(i),null!=o&&a(o))}))}))}(u,a,t,p)}else if(d){const e={from:d.lower,to:d.upper};l.add(e),h.add(e)}else h.add(r),l.add(r),a.indexes.forEach((e=>u(e.name).add(r)));return e}))}},f=({query:{index:t,range:r}})=>{var n,i;return[t,new Br(null!==(n=r.lower)&&void 0!==n?n:e.MIN_KEY,null!==(i=r.upper)&&void 0!==i?i:e.MAX_KEY)]},d={get:e=>[c,new Br(e.key)],getMany:e=>[c,(new Br).addKeys(e.keys)],count:f,query:f,openCursor:f};return s(d).forEach((e=>{l[e]=function(s){const{subscr:o}=Ce;if(o){const a=e=>{const r=`idb://${t}/${n}/${e}`;return o[r]||(o[r]=new Br)},c=a(""),l=a(":dels"),[f,p]=d[e](s);if(a(f.name||"").add(p),!f.isPrimaryKey){if("count"!==e){const t="query"===e&&h&&s.values&&i.query({...s,values:!1});return i[e].apply(this,arguments).then((r=>{if("query"===e){if(h&&s.values)return t.then((({result:e})=>(c.addKeys(e),r)));const e=s.values?r.result.map(u):r.result;s.values?c.addKeys(e):l.addKeys(e)}else if("openCursor"===e){const e=r,t=s.values;return e&&Object.create(e,{key:{get:()=>(l.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return l.addKey(t),t}},value:{get:()=>(t&&c.addKey(e.primaryKey),e.value)}})}return r}))}l.add(r)}}return i[e].apply(this,arguments)}})),l}}}};class zr{constructor(e,t){this._middlewares={},this.verno=0;const r=zr.dependencies;this._options=t={addons:zr.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ie,dbReadyPromise:null,cancelOpen:ie,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new Ne((e=>{s.dbReadyResolve=e})),s.openCanceller=new Ne(((e,t)=>{s.cancelOpen=t})),this._state=s,this.name=e,this.on=Tt(this,"populate","blocked","versionchange","close",{ready:[fe,ie]}),this.on.ready.subscribe=w(this.on.ready.subscribe,(e=>(t,r)=>{zr.vip((()=>{const n=this._state;if(n.openComplete)n.dbOpenError||Ne.resolve().then(t),r&&e(t);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(t),r&&e(t);else{e(t);const n=this;r||e((function e(){n.on.ready.unsubscribe(t),n.on.ready.unsubscribe(e)}))}}))})),this.Collection=(o=this,Pt(Ft.prototype,(function(e,t){this.db=o;let r=St,n=null;if(t)try{r=t()}catch(e){n=e}const i=e._ctx,s=i.table,a=s.hook.reading.fire;this._ctx={table:s,index:i.index,isPrimKey:!i.index||s.schema.primKey.keyPath&&i.index===s.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:i.or,valueMapper:a!==se?a:null}}))),this.Table=function(e){return Pt(It.prototype,(function(t,r,n){this.db=e,this._tx=n,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:Tt(null,{creating:[ce,ie],reading:[oe,se],updating:[he,ie],deleting:[ue,ie]})}))}(this),this.Transaction=function(e){return Pt(er.prototype,(function(t,r,n,i,s){this.db=e,this.mode=t,this.storeNames=r,this.schema=n,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Tt(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ne(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),yt(e)}))}))}(this),this.Version=function(e){return Pt(vr.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Pt(Jt.prototype,(function(t,r,n){this.db=e,this._ctx={table:t,index:":id"===r?null:r,or:n};const i=e._deps.indexedDB;if(!i)throw new te.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?n.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):n.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?n.warn(`Dexie.delete('${this.name}') was blocked`):n.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=ir(t.IDBKeyRange),this._createTransaction=(e,t,r,n)=>new this.Transaction(e,t,r,this._options.chromeTransactionDurability,n),this._fireOnBlocked=e=>{this.on("blocked").fire(e),wt.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Pr),this.use(Dr),this.use(Kr),this.use(Or),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new te.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new te.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var r=t.filter((t=>t._cfg.version===e))[0];return r||(r=new this.Version(e),t.push(r),t.sort(dr),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Ce.letThrough||this._vip)?e():new Ne(((e,t)=>{if(this._state.openComplete)return t(new te.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new te.DatabaseClosed);this.open().catch(ie)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:r,name:n}){n&&this.unuse({stack:e,name:n});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==r?10:r,name:n}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>r?e.create!==r:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?yt(t.dbOpenError):e));F&&(t.openCanceller._stackHolder=V()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const i=t.openCanceller;function o(){if(t.openCanceller!==i)throw new te.DatabaseClosed("db.open() was cancelled")}let a=t.dbReadyResolve,c=null,u=!1;return Ne.race([i,("undefined"==typeof navigator?Ne.resolve():kr()).then((()=>new Ne(((i,a)=>{if(o(),!r)throw new te.MissingAPI;const h=e.name,l=t.autoSchema?r.open(h):r.open(h,Math.round(10*e.verno));if(!l)throw new te.MissingAPI;l.onerror=Xt(a),l.onblocked=Ye(e._fireOnBlocked),l.onupgradeneeded=Ye((n=>{if(c=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=Qt,c.abort(),l.result.close();const e=r.deleteDatabase(h);e.onsuccess=e.onerror=Ye((()=>{a(new te.NoSuchDatabase(`Database ${h} doesnt exist`))}))}else{c.onerror=Xt(a);var i=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;u=i<1,e._novip.idbdb=l.result,pr(e,i/10,c,a)}}),a),l.onsuccess=Ye((()=>{c=null;const r=e._novip.idbdb=l.result,o=b(r.objectStoreNames);if(o.length>0)try{const i=r.transaction(1===(a=o).length?a[0]:a,"readonly");t.autoSchema?function({_novip:e},t,r){e.verno=t.version/10;const n=e._dbSchema=br(0,t,r);e._storeNames=b(t.objectStoreNames,0),lr(e,[e._allTables],s(n),n)}(e,r,i):(wr(e,e._dbSchema,i),function(e,t){const r=yr(br(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some((e=>e.add.length||e.change.length)))}(e,i)||n.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),hr(e,i)}catch(e){}var a;wt.push(e),r.onversionchange=Ye((r=>{t.vcFired=!0,e.on("versionchange").fire(r)})),r.onclose=Ye((t=>{e.on("close").fire(t)})),u&&function({indexedDB:e,IDBKeyRange:t},r){!_r(e)&&"__dbnames"!==r&&Er(e,t).put({name:r}).catch(ie)}(e._deps,h),i()}),a)}))))]).then((()=>(o(),t.onReadyBeingFired=[],Ne.resolve(xr((()=>e.on.ready.fire(e.vip)))).then((function r(){if(t.onReadyBeingFired.length>0){let n=t.onReadyBeingFired.reduce(fe,ie);return t.onReadyBeingFired=[],Ne.resolve(xr((()=>n(e.vip)))).then(r)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((r=>{t.dbOpenError=r;try{c&&c.abort()}catch(e){}return i===t.openCanceller&&e._close(),yt(r)})).finally((()=>{t.openComplete=!0,a()}))}(this)}_close(){const e=this._state,t=wt.indexOf(this);if(t>=0&&wt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Ne((t=>{e.dbReadyResolve=t})),e.openCanceller=new Ne(((t,r)=>{e.cancelOpen=r}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new te.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Ne(((r,n)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Ye((()=>{!function({indexedDB:e,IDBKeyRange:t},r){!_r(e)&&"__dbnames"!==r&&Er(e,t).delete(r).catch(ie)}(this._deps,this.name),r()})),e.onerror=Xt(n),e.onblocked=this._fireOnBlocked};if(e)throw new te.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return s(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Ar.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let n=Ce.trans;n&&n.db===this&&-1===e.indexOf("!")||(n=null);const i=-1!==e.indexOf("?");let s,o;e=e.replace("!","").replace("?","");try{if(o=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)s="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new te.InvalidArgument("Invalid transaction mode: "+e);s="readwrite"}if(n){if("readonly"===n.mode&&"readwrite"===s){if(!i)throw new te.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");n=null}n&&o.forEach((e=>{if(n&&-1===n.storeNames.indexOf(e)){if(!i)throw new te.SubTransaction("Table "+e+" not included in parent transaction.");n=null}})),i&&n&&!n.active&&(n=null)}}catch(e){return n?n._promise(null,((t,r)=>{r(e)})):yt(e)}const a=Ir.bind(null,this,s,o,n,r);return n?n._promise(s,a,"lock"):Ce.trans?ht(Ce.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!h(this._allTables,e))throw new te.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const $r="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Vr{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:r})}[$r](){return this}}function qr(e,t){return s(t).forEach((r=>{Lr(e[r]||(e[r]=new Br),t[r])})),e}let Wr;try{Wr={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(i){Wr={indexedDB:null,IDBKeyRange:null}}const Hr=zr;function Gr(e){let t=Yr;try{Yr=!0,Zt.storagemutated.fire(e)}finally{Yr=t}}l(Hr,{...ne,delete:e=>new Hr(e,{addons:[]}).delete(),exists:e=>new Hr(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return _r(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):Er(e,t).toCollection().primaryKeys()}(Hr.dependencies).then(e)}catch(e){return yt(new te.MissingAPI)}},defineClass:()=>function(e){a(this,e)},ignoreTransaction:e=>Ce.trans?ht(Ce.transless,e):e(),vip:xr,async:function(e){return function(){try{var t=Sr(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ne.resolve(t)}catch(e){return yt(e)}}},spawn:function(e,t,r){try{var n=Sr(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:Ne.resolve(n)}catch(e){return yt(e)}},currentTransaction:{get:()=>Ce.trans||null},waitFor:function(e,t){const r=Ne.resolve("function"==typeof e?Hr.ignoreTransaction(e):e).timeout(t||6e4);return Ce.trans?Ce.trans.waitFor(r):r},Promise:Ne,debug:{get:()=>F,set:e=>{K(e,"dexie"===e?()=>!0:xt)}},derive:p,extend:a,props:l,override:w,Events:Tt,on:Zt,liveQuery:function(e){return new Vr((t=>{const r=j(e);let n=!1,i={},o={};const a={get closed(){return n},unsubscribe:()=>{n=!0,Zt.storagemutated.unsubscribe(l)}};t.start&&t.start(a);let c=!1,u=!1;function h(){return s(o).some((e=>i[e]&&function(e,t){const r=Ur(t);let n=r.next();if(n.done)return!1;let i=n.value;const s=Ur(e);let o=s.next(i.from),a=o.value;for(;!n.done&&!o.done;){if(Lt(a.from,i.to)<=0&&Lt(a.to,i.from)>=0)return!0;Lt(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}(i[e],o[e])))}const l=e=>{qr(i,e),h()&&f()},f=()=>{if(c||n)return;i={};const s={},d=function(t){r&&nt();const n=()=>rt(e,{subscr:t,trans:null}),i=Ce.trans?ht(Ce.transless,n):n();return r&&i.then(it,it),i}(s);u||(Zt("storagemutated",l),u=!0),c=!0,Promise.resolve(d).then((e=>{c=!1,n||(h()?f():(i={},o=s,t.next&&t.next(e)))}),(e=>{c=!1,t.error&&t.error(e),a.unsubscribe()}))};return f(),a}))},extendObservabilitySet:qr,getByKeyPath:x,setByKeyPath:k,delByKeyPath:function(e,t){"string"==typeof t?k(e,t,void 0):"length"in t&&[].map.call(t,(function(t){k(e,t,void 0)}))},shallowClone:S,deepClone:D,getObjectDiff:Cr,cmp:Lt,asap:E,minKey:-1/0,addons:[],connections:wt,errnames:Z,dependencies:Wr,semVer:"3.2.3",version:"3.2.3".split(".").map((e=>parseInt(e))).reduce(((e,t,r)=>e+t/Math.pow(10,2*r)))}),Hr.maxKey=ir(Hr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Zt("storagemutated",(e=>{if(!Yr){let t;vt?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Yr=!0,dispatchEvent(t),Yr=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{Yr||Gr(e)})));let Yr=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");"function"==typeof e.unref&&e.unref(),Zt("storagemutated",(t=>{Yr||e.postMessage(t)})),e.onmessage=e=>{e.data&&Gr(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Zt("storagemutated",(e=>{try{Yr||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&Gr(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&Gr(e.changedParts)}))}Ne.rejectionMapper=function(e,t){if(!e||e instanceof Y||e instanceof TypeError||e instanceof SyntaxError||!e.name||!re[e.name])return e;var r=new re[e.name](t||e.message,e);return"stack"in e&&d(r,"stack",{get:function(){return this.inner.stack}}),r},K(F,xt)},26905:function(e){e.exports=function(e,t,r,n,i){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:i;return e===i?r:e}},32114:function(e){"use strict";function t(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}e.exports=function(e,r,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof r&&(n=r,r=""),r&&(n.code=r);try{return t(e,n)}catch(r){n.message=e.message,n.stack=e.stack;const i=function(){};i.prototype=Object.create(Object.getPrototypeOf(e));return t(new i,n)}}},8091:function(e){"use strict";function t(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var r=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var s=Object.keys(Object(i)),o=0,a=s.length;o<a;o++){var c=s[o],u=Object.getOwnPropertyDescriptor(i,c);void 0!==u&&u.enumerable&&(r[c]=i[c])}}return r}e.exports={assign:t,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:t})}}},90507:function(e,t,r){"use strict";const n=r(8231);t.zN=n.EventIterator,n.EventIterator},8231:function(e,t,r){"use strict";var n=r(25108);Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():n&&n.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch((()=>{})),this.pushQueue.push(t)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((e,t)=>{this.pullQueue.push({resolve:e,reject:t})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class s{constructor(e,{highWaterMark:t=100,lowWaterMark:r=1}={}){const n=new i;n.highWaterMark=t,n.lowWaterMark=r,n.removeCallback=e({push:e=>n.push(e),stop:()=>n.stop(),fail:e=>n.fail(e),on:(e,t)=>{n.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>n[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=s,t.default=s},17187:function(e,t,r){"use strict";var n,i=r(25108),s="object"==typeof Reflect?Reflect:null,o=s&&"function"==typeof s.apply?s.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}b(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&b(e,"error",t,r)}(e,i,{once:!0})}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function h(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function f(e,t,r,n){var s,o,a,c;if(h(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(s=l(e))>0&&a.length>s&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,c=u,i&&i.warn&&i.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=d.bind(n);return i.listener=r,n.wrapFn=i,i}function y(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function b(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){n.once&&e.removeEventListener(t,i),r(s)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return l(this)},c.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,h=g(c,u);for(r=0;r<u;++r)o(h[r],this,t)}return!0},c.prototype.addListener=function(e,t){return f(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return f(this,e,t,!0)},c.prototype.once=function(e,t){return h(t),this.on(e,p(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return h(t),this.prependListener(e,p(this,e,t)),this},c.prototype.removeListener=function(e,t){var r,n,i,s,o;if(h(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},c.prototype.listeners=function(e){return y(this,e,!0)},c.prototype.rawListeners=function(e){return y(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},c.prototype.listenerCount=m,c.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},72445:function(e){"use strict";e.exports=function(e){var t=e.uri,r=e.name,n=e.type;this.uri=t,this.name=r,this.type=n}},40804:function(e,t,r){"use strict";var n=r(51268);e.exports=function e(t,r,i){var s;void 0===r&&(r=""),void 0===i&&(i=n);var o=new Map;function a(e,t){var r=o.get(t);r?r.push.apply(r,e):o.set(t,e)}if(i(t))s=null,a([r],t);else{var c=r?r+".":"";if("undefined"!=typeof FileList&&t instanceof FileList)s=Array.prototype.map.call(t,(function(e,t){return a([""+c+t],e),null}));else if(Array.isArray(t))s=t.map((function(t,r){var n=e(t,""+c+r,i);return n.files.forEach(a),n.clone}));else if(t&&t.constructor===Object)for(var u in s={},t){var h=e(t[u],""+c+u,i);h.files.forEach(a),s[u]=h.clone}else s=t}return{clone:s,files:o}}},51268:function(e,t,r){"use strict";var n=r(72445);e.exports=function(e){return"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Blob&&e instanceof Blob||e instanceof n}},3975:function(e){e.exports=class{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},91607:function(e,t,r){const n=r(3975);e.exports=class{constructor(e){this.hwm=e||16,this.head=new n(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},16932:function(e,t,r){"use strict";const n=r(78501),i=r(58844),s=r(41192);e.exports={XMLParser:i,XMLValidator:n,XMLBuilder:s}},17849:function(e,t){"use strict";const r=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+r+"]["+(r+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",i=new RegExp("^"+n+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,r){if(t){const n=Object.keys(t),i=n.length;for(let s=0;s<i;s++)e[n[s]]="strict"===r?[t[n[s]]]:t[n[s]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){const t=i.exec(e);return!(null==t)},t.getAllMatches=function(e,t){const r=[];let n=t.exec(e);for(;n;){const i=[];i.startIndex=t.lastIndex-n[0].length;const s=n.length;for(let e=0;e<s;e++)i.push(n[e]);r.push(i),n=t.exec(e)}return r},t.nameRegexp=n},78501:function(e,t,r){"use strict";const n=r(17849),i={allowBooleanAttributes:!1,unpairedTags:[]};function s(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function o(e,t){const r=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const n=e.substr(r,t-r);if(t>5&&"xml"===n)return p("InvalidXml","XML declaration allowed only at the start of the document.",m(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function a(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let r=1;for(t+=8;t<e.length;t++)if("<"===e[t])r++;else if(">"===e[t]&&(r--,0===r))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},i,t);const r=[];let c=!1,u=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let i=0;i<e.length;i++)if("<"===e[i]&&"?"===e[i+1]){if(i+=2,i=o(e,i),i.err)return i}else{if("<"!==e[i]){if(s(e[i]))continue;return p("InvalidChar","char '"+e[i]+"' is not expected.",m(e,i))}{let y=i;if(i++,"!"===e[i]){i=a(e,i);continue}{let g=!1;"/"===e[i]&&(g=!0,i++);let b="";for(;i<e.length&&">"!==e[i]&&" "!==e[i]&&"\t"!==e[i]&&"\n"!==e[i]&&"\r"!==e[i];i++)b+=e[i];if(b=b.trim(),"/"===b[b.length-1]&&(b=b.substring(0,b.length-1),i--),l=b,!n.isName(l)){let t;return t=0===b.trim().length?"Invalid space after '<'.":"Tag '"+b+"' is an invalid name.",p("InvalidTag",t,m(e,i))}const w=h(e,i);if(!1===w)return p("InvalidAttr","Attributes for '"+b+"' have open quote.",m(e,i));let v=w.value;if(i=w.index,"/"===v[v.length-1]){const r=i-v.length;v=v.substring(0,v.length-1);const n=f(v,t);if(!0!==n)return p(n.err.code,n.err.msg,m(e,r+n.err.line));c=!0}else if(g){if(!w.tagClosed)return p("InvalidTag","Closing tag '"+b+"' doesn't have proper closing.",m(e,i));if(v.trim().length>0)return p("InvalidTag","Closing tag '"+b+"' can't have attributes or invalid starting.",m(e,y));{const t=r.pop();if(b!==t.tagName){let r=m(e,t.tagStartPos);return p("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+r.line+", col "+r.col+") instead of closing tag '"+b+"'.",m(e,y))}0==r.length&&(u=!0)}}else{const n=f(v,t);if(!0!==n)return p(n.err.code,n.err.msg,m(e,i-v.length+n.err.line));if(!0===u)return p("InvalidXml","Multiple possible root nodes found.",m(e,i));-1!==t.unpairedTags.indexOf(b)||r.push({tagName:b,tagStartPos:y}),c=!0}for(i++;i<e.length;i++)if("<"===e[i]){if("!"===e[i+1]){i++,i=a(e,i);continue}if("?"!==e[i+1])break;if(i=o(e,++i),i.err)return i}else if("&"===e[i]){const t=d(e,i);if(-1==t)return p("InvalidChar","char '&' is not expected.",m(e,i));i=t}else if(!0===u&&!s(e[i]))return p("InvalidXml","Extra text at the end",m(e,i));"<"===e[i]&&i--}}}var l;return c?1==r.length?p("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",m(e,r[0].tagStartPos)):!(r.length>0)||p("InvalidXml","Invalid '"+JSON.stringify(r.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):p("InvalidXml","Start tag expected.",1)};const c='"',u="'";function h(e,t){let r="",n="",i=!1;for(;t<e.length;t++){if(e[t]===c||e[t]===u)""===n?n=e[t]:n!==e[t]||(n="");else if(">"===e[t]&&""===n){i=!0;break}r+=e[t]}return""===n&&{value:r,index:t,tagClosed:i}}const l=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function f(e,t){const r=n.getAllMatches(e,l),i={};for(let e=0;e<r.length;e++){if(0===r[e][1].length)return p("InvalidAttr","Attribute '"+r[e][2]+"' has no space in starting.",g(r[e]));if(void 0!==r[e][3]&&void 0===r[e][4])return p("InvalidAttr","Attribute '"+r[e][2]+"' is without value.",g(r[e]));if(void 0===r[e][3]&&!t.allowBooleanAttributes)return p("InvalidAttr","boolean attribute '"+r[e][2]+"' is not allowed.",g(r[e]));const n=r[e][2];if(!y(n))return p("InvalidAttr","Attribute '"+n+"' is an invalid name.",g(r[e]));if(i.hasOwnProperty(n))return p("InvalidAttr","Attribute '"+n+"' is repeated.",g(r[e]));i[n]=1}return!0}function d(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let r=/\d/;for("x"===e[t]&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(r))break}return-1}(e,++t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(";"===e[t])break;return-1}return t}function p(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function y(e){return n.isName(e)}function m(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function g(e){return e.startIndex+e[1].length}},41192:function(e,t,r){"use strict";const n=r(82592),i={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function s(e){this.options=Object.assign({},i,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=o,this.options.format?(this.indentate=a,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(e,t,r){const n=this.j2x(e,r+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}function a(e){return this.options.indentBy.repeat(e)}function c(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}s.prototype.build=function(e){return this.options.preserveOrder?n(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},s.prototype.j2x=function(e,t){let r="",n="";for(let i in e)if(void 0===e[i]);else if(null===e[i])"?"===i[0]?n+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(e[i]instanceof Date)n+=this.buildTextValNode(e[i],i,"",t);else if("object"!=typeof e[i]){const s=this.isAttribute(i);if(s)r+=this.buildAttrPairStr(s,""+e[i]);else if(i===this.options.textNodeName){let t=this.options.tagValueProcessor(i,""+e[i]);n+=this.replaceEntitiesValue(t)}else n+=this.buildTextValNode(e[i],i,"",t)}else if(Array.isArray(e[i])){const r=e[i].length;let s="";for(let o=0;o<r;o++){const r=e[i][o];void 0===r||(null===r?"?"===i[0]?n+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+i+"/"+this.tagEndChar:"object"==typeof r?this.options.oneListGroup?s+=this.j2x(r,t+1).val:s+=this.processTextOrObjNode(r,i,t):s+=this.buildTextValNode(r,i,"",t))}this.options.oneListGroup&&(s=this.buildObjectNode(s,i,"",t)),n+=s}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const t=Object.keys(e[i]),n=t.length;for(let s=0;s<n;s++)r+=this.buildAttrPairStr(t[s],""+e[i][t[s]])}else n+=this.processTextOrObjNode(e[i],i,t);return{attrStr:r,val:n}},s.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},s.prototype.buildObjectNode=function(e,t,r,n){if(""===e)return"?"===t[0]?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",i=""),r&&-1===e.indexOf("<")?this.indentate(n)+"<"+t+r+s+">"+e+i:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(n)+"<"+t+r+s+this.tagEndChar+e+this.indentate(n)+i}},s.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},s.prototype.buildTextValNode=function(e,t,r,n){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,e);return i=this.replaceEntitiesValue(i),""===i?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+i+"</"+t+this.tagEndChar}},s.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e},e.exports=s},82592:function(e){function t(e,o,a,c){let u="",h=!1;for(let l=0;l<e.length;l++){const f=e[l],d=r(f);let p="";if(p=0===a.length?d:`${a}.${d}`,d===o.textNodeName){let e=f[d];i(p,o)||(e=o.tagValueProcessor(d,e),e=s(e,o)),h&&(u+=c),u+=e,h=!1;continue}if(d===o.cdataPropName){h&&(u+=c),u+=`<![CDATA[${f[d][0][o.textNodeName]}]]>`,h=!1;continue}if(d===o.commentPropName){u+=c+`\x3c!--${f[d][0][o.textNodeName]}--\x3e`,h=!0;continue}if("?"===d[0]){const e=n(f[":@"],o),t="?xml"===d?"":c;let r=f[d][0][o.textNodeName];r=0!==r.length?" "+r:"",u+=t+`<${d}${r}${e}?>`,h=!0;continue}let y=c;""!==y&&(y+=o.indentBy);const m=c+`<${d}${n(f[":@"],o)}`,g=t(f[d],o,p,y);-1!==o.unpairedTags.indexOf(d)?o.suppressUnpairedNode?u+=m+">":u+=m+"/>":g&&0!==g.length||!o.suppressEmptyNode?g&&g.endsWith(">")?u+=m+`>${g}${c}</${d}>`:(u+=m+">",g&&""!==c&&(g.includes("/>")||g.includes("</"))?u+=c+o.indentBy+g+c:u+=g,u+=`</${d}>`):u+=m+"/>",h=!0}return u}function r(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function n(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){let i=t.attributeValueProcessor(n,e[n]);i=s(i,t),!0===i&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${i}"`}return r}function i(e,t){let r=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function s(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}e.exports=function(e,r){let n="";return r.format&&r.indentBy.length>0&&(n="\n"),t(e,r,"",n)}},74780:function(e,t,r){const n=r(17849);function i(e,t){let r="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)r+=e[t];if(r=r.trim(),-1!==r.indexOf(" "))throw new Error("External entites are not supported");const n=e[t++];let i="";for(;t<e.length&&e[t]!==n;t++)i+=e[t];return[r,i,t]}function s(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function o(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function a(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function c(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function u(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function h(e){if(n.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}e.exports=function(e,t){const r={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let n=1,l=!1,f=!1,d="";for(;t<e.length;t++)if("<"!==e[t]||f)if(">"===e[t]){if(f?"-"===e[t-1]&&"-"===e[t-2]&&(f=!1,n--):n--,0===n)break}else"["===e[t]?l=!0:d+=e[t];else{if(l&&o(e,t))t+=7,[entityName,val,t]=i(e,t+1),-1===val.indexOf("&")&&(r[h(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(l&&a(e,t))t+=8;else if(l&&c(e,t))t+=8;else if(l&&u(e,t))t+=9;else{if(!s)throw new Error("Invalid DOCTYPE");f=!0}n++,d=""}if(0!==n)throw new Error("Unclosed DOCTYPE")}return{entities:r,i:t}}},66745:function(e,t){const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}};t.buildOptions=function(e){return Object.assign({},r,e)},t.defaultOptions=r},81078:function(e,t,r){"use strict";const n=r(17849),i=r(36311),s=r(74780),o=r(14153);"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,n.nameRegexp);function a(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function c(e,t,r,n,i,s,o){if(void 0!==e&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const n=this.options.tagValueProcessor(t,e,r,i,s);if(null==n)return e;if(typeof n!=typeof e||n!==e)return n;if(this.options.trimValues)return v(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?v(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function u(e){if(this.options.removeNSPrefix){const t=e.split(":"),r="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=r+t[1])}return e}const h=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function l(e,t,r){if(!this.options.ignoreAttributes&&"string"==typeof e){const r=n.getAllMatches(e,h),i=r.length,s={};for(let e=0;e<i;e++){const n=this.resolveNameSpace(r[e][1]);let i=r[e][4],o=this.options.attributeNamePrefix+n;if(n.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),"__proto__"===o&&(o="#__proto__"),void 0!==i){this.options.trimValues&&(i=i.trim()),i=this.replaceEntitiesValue(i);const e=this.options.attributeValueProcessor(n,i,t);s[o]=null==e?i:typeof e!=typeof i||e!==i?e:v(i,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[o]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=s,e}return s}}const f=function(e){e=e.replace(/\r\n?/g,"\n");const t=new i("!xml");let r=t,n="",o="";for(let a=0;a<e.length;a++){if("<"===e[a])if("/"===e[a+1]){const t=g(e,">",a,"Closing Tag is not closed.");let i=e.substring(a+2,t).trim();if(this.options.removeNSPrefix){const e=i.indexOf(":");-1!==e&&(i=i.substr(e+1))}this.options.transformTagName&&(i=this.options.transformTagName(i)),r&&(n=this.saveTextToParentTag(n,r,o));const s=o.substring(o.lastIndexOf(".")+1);if(i&&-1!==this.options.unpairedTags.indexOf(i))throw new Error(`Unpaired tag can not be used as closing tag: </${i}>`);let c=0;s&&-1!==this.options.unpairedTags.indexOf(s)?(c=o.lastIndexOf(".",o.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=o.lastIndexOf("."),o=o.substring(0,c),r=this.tagsNodeStack.pop(),n="",a=t}else if("?"===e[a+1]){let t=b(e,a,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,o),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new i(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,o,t.tagName)),this.addChild(r,e,o)}a=t.closeIndex+1}else if("!--"===e.substr(a+1,3)){const t=g(e,"--\x3e",a+4,"Comment is not closed.");if(this.options.commentPropName){const i=e.substring(a+4,t-2);n=this.saveTextToParentTag(n,r,o),r.add(this.options.commentPropName,[{[this.options.textNodeName]:i}])}a=t}else if("!D"===e.substr(a+1,2)){const t=s(e,a);this.docTypeEntities=t.entities,a=t.i}else if("!["===e.substr(a+1,2)){const t=g(e,"]]>",a,"CDATA is not closed.")-2,i=e.substring(a+9,t);if(n=this.saveTextToParentTag(n,r,o),this.options.cdataPropName)r.add(this.options.cdataPropName,[{[this.options.textNodeName]:i}]);else{let e=this.parseTextData(i,r.tagname,o,!0,!1,!0);null==e&&(e=""),r.add(this.options.textNodeName,e)}a=t+2}else{let s=b(e,a,this.options.removeNSPrefix),c=s.tagName,u=s.tagExp,h=s.attrExpPresent,l=s.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),r&&n&&"!xml"!==r.tagname&&(n=this.saveTextToParentTag(n,r,o,!1));const f=r;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(r=this.tagsNodeStack.pop(),o=o.substring(0,o.lastIndexOf("."))),c!==t.tagname&&(o+=o?"."+c:c),this.isItStopNode(this.options.stopNodes,o,c)){let t="";if(u.length>0&&u.lastIndexOf("/")===u.length-1)a=s.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(c))a=s.closeIndex;else{const r=this.readStopNodeData(e,c,l+1);if(!r)throw new Error(`Unexpected end of ${c}`);a=r.i,t=r.tagContent}const n=new i(c);c!==u&&h&&(n[":@"]=this.buildAttributesMap(u,o,c)),t&&(t=this.parseTextData(t,c,o,!0,h,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),n.add(this.options.textNodeName,t),this.addChild(r,n,o)}else{if(u.length>0&&u.lastIndexOf("/")===u.length-1){"/"===c[c.length-1]?(c=c.substr(0,c.length-1),u=c):u=u.substr(0,u.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));const e=new i(c);c!==u&&h&&(e[":@"]=this.buildAttributesMap(u,o,c)),this.addChild(r,e,o),o=o.substr(0,o.lastIndexOf("."))}else{const e=new i(c);this.tagsNodeStack.push(r),c!==u&&h&&(e[":@"]=this.buildAttributesMap(u,o,c)),this.addChild(r,e,o),r=e}n="",a=l}}else n+=e[a]}return t.child};function d(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);!1===n||("string"==typeof n?(t.tagname=n,e.addChild(t)):e.addChild(t))}const p=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function y(e,t,r,n){return e&&(void 0===n&&(n=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,r,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,n))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function m(e,t,r){const n="*."+r;for(const r in e){const i=e[r];if(n===i||t===i)return!0}return!1}function g(e,t,r,n){const i=e.indexOf(t,r);if(-1===i)throw new Error(n);return i+t.length-1}function b(e,t,r,n=">"){const i=function(e,t,r=">"){let n,i="";for(let s=t;s<e.length;s++){let t=e[s];if(n)t===n&&(n="");else if('"'===t||"'"===t)n=t;else if(t===r[0]){if(!r[1])return{data:i,index:s};if(e[s+1]===r[1])return{data:i,index:s}}else"\t"===t&&(t=" ");i+=t}}(e,t+1,n);if(!i)return;let s=i.data;const o=i.index,a=s.search(/\s/);let c=s,u=!0;if(-1!==a&&(c=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),r){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),u=c!==i.data.substr(e+1))}return{tagName:c,tagExp:s,closeIndex:o,attrExpPresent:u}}function w(e,t,r){const n=r;let i=1;for(;r<e.length;r++)if("<"===e[r])if("/"===e[r+1]){const s=g(e,">",r,`${t} is not closed`);if(e.substring(r+2,s).trim()===t&&(i--,0===i))return{tagContent:e.substring(n,r),i:s};r=s}else if("?"===e[r+1]){r=g(e,"?>",r+1,"StopNode is not closed.")}else if("!--"===e.substr(r+1,3)){r=g(e,"--\x3e",r+3,"StopNode is not closed.")}else if("!["===e.substr(r+1,2)){r=g(e,"]]>",r,"StopNode is not closed.")-2}else{const n=b(e,r,">");if(n){(n&&n.tagName)===t&&"/"!==n.tagExp[n.tagExp.length-1]&&i++,r=n.closeIndex}}}function v(e,t,r){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&o(e,r)}return n.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=a,this.parseXml=f,this.parseTextData=c,this.resolveNameSpace=u,this.buildAttributesMap=l,this.isItStopNode=m,this.replaceEntitiesValue=p,this.readStopNodeData=w,this.saveTextToParentTag=y,this.addChild=d}}},58844:function(e,t,r){const{buildOptions:n}=r(66745),i=r(81078),{prettify:s}=r(16997),o=r(78501);e.exports=class{constructor(e){this.externalEntities={},this.options=n(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const r=o.validate(e,t);if(!0!==r)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const r=new i(this.options);r.addExternalEntities(this.externalEntities);const n=r.parseXml(e);return this.options.preserveOrder||void 0===n?n:s(n,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},16997:function(e,t){"use strict";function r(e,t,o){let a;const c={};for(let u=0;u<e.length;u++){const h=e[u],l=n(h);let f="";if(f=void 0===o?l:o+"."+l,l===t.textNodeName)void 0===a?a=h[l]:a+=""+h[l];else{if(void 0===l)continue;if(h[l]){let e=r(h[l],t,f);const n=s(e,t);h[":@"]?i(e,h[":@"],f,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==c[l]&&c.hasOwnProperty(l)?(Array.isArray(c[l])||(c[l]=[c[l]]),c[l].push(e)):t.isArray(l,f,n)?c[l]=[e]:c[l]=e}}}return"string"==typeof a?a.length>0&&(c[t.textNodeName]=a):void 0!==a&&(c[t.textNodeName]=a),c}function n(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function i(e,t,r,n){if(t){const i=Object.keys(t),s=i.length;for(let o=0;o<s;o++){const s=i[o];n.isArray(s,r+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function s(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return 0===n||!(1!==n||!e[r]&&"boolean"!=typeof e[r]&&0!==e[r])}t.prettify=function(e,t){return r(e,t)}},36311:function(e){"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},96132:function(e,t){"use strict";function r(e,t=r.BASE){const n=e.length;for(let r=0;r<n;r++)t^=e.charCodeAt(r),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}Object.defineProperty(t,"__esModule",{value:!0}),r.BASE=2166136261,t.default=r,e.exports=r},94029:function(e,t,r){"use strict";var n=r(95320),i=Object.prototype.toString,s=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){if(!n(t))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=r),"[object Array]"===i.call(e)?function(e,t,r){for(var n=0,i=e.length;n<i;n++)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))}(e,t,o):"string"==typeof e?function(e,t,r){for(var n=0,i=e.length;n<i;n++)null==r?t(e.charAt(n),n,e):t.call(r,e.charAt(n),n,e)}(e,t,o):function(e,t,r){for(var n in e)s.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))}(e,t,o)}},17648:function(e){"use strict";var t=Array.prototype.slice,r=Object.prototype.toString;e.exports=function(e){var n=this;if("function"!=typeof n||"[object Function]"!==r.call(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var i,s=t.call(arguments,1),o=Math.max(0,n.length-s.length),a=[],c=0;c<o;c++)a.push("$"+c);if(i=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var r=n.apply(this,s.concat(t.call(arguments)));return Object(r)===r?r:this}return n.apply(e,s.concat(t.call(arguments)))})),n.prototype){var u=function(){};u.prototype=n.prototype,i.prototype=new u,u.prototype=null}return i}},58612:function(e,t,r){"use strict";var n=r(17648);e.exports=Function.prototype.bind||n},40210:function(e,t,r){"use strict";var n,i=SyntaxError,s=Function,o=TypeError,a=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var u=function(){throw new o},h=c?function(){try{return u}catch(e){try{return c(arguments,"callee").get}catch(e){return u}}}():u,l=r(41405)(),f=Object.getPrototypeOf||function(e){return e.__proto__},d={},p="undefined"==typeof Uint8Array?n:f(Uint8Array),y={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":l?f([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":d,"%AsyncGenerator%":d,"%AsyncGeneratorFunction%":d,"%AsyncIteratorPrototype%":d,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":d,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":l?f(f([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&l?f((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&l?f((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":l?f(""[Symbol.iterator]()):n,"%Symbol%":l?Symbol:n,"%SyntaxError%":i,"%ThrowTypeError%":h,"%TypedArray%":p,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};try{null.error}catch(e){var m=f(f(e));y["%Error.prototype%"]=m}var g=function e(t){var r;if("%AsyncFunction%"===t)r=a("async function () {}");else if("%GeneratorFunction%"===t)r=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=a("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(r=f(i.prototype))}return y[t]=r,r},b={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=r(58612),v=r(17642),E=w.call(Function.call,Array.prototype.concat),_=w.call(Function.apply,Array.prototype.splice),x=w.call(Function.call,String.prototype.replace),k=w.call(Function.call,String.prototype.slice),S=w.call(Function.call,RegExp.prototype.exec),A=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I=/\\(\\)?/g,T=function(e,t){var r,n=e;if(v(b,n)&&(n="%"+(r=b[n])[0]+"%"),v(y,n)){var s=y[n];if(s===d&&(s=g(n)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:s}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===S(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=k(e,0,1),r=k(e,-1);if("%"===t&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return x(e,A,(function(e,t,r,i){n[n.length]=r?x(i,I,"$1"):t||e})),n}(e),n=r.length>0?r[0]:"",s=T("%"+n+"%",t),a=s.name,u=s.value,h=!1,l=s.alias;l&&(n=l[0],_(r,E([0,1],l)));for(var f=1,d=!0;f<r.length;f+=1){var p=r[f],m=k(p,0,1),g=k(p,-1);if(('"'===m||"'"===m||"`"===m||'"'===g||"'"===g||"`"===g)&&m!==g)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&d||(h=!0),v(y,a="%"+(n+="."+p)+"%"))u=y[a];else if(null!=u){if(!(p in u)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&f+1>=r.length){var b=c(u,p);u=(d=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:u[p]}else d=v(u,p),u=u[p];d&&!h&&(y[a]=u)}}return u}},27296:function(e,t,r){"use strict";var n=r(40210)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},53458:function(e){e.exports="object"==typeof self?self.FormData:window.FormData},31230:function(e,t,r){"use strict";var n=r(70655),i=r(25202),s=r(25108),o=new Map,a=new Map,c=!0,u=!1;function h(e){return e.replace(/[\s,]+/g," ").trim()}function l(e){var t=new Set,r=[];return e.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var n=e.name.value,i=h((u=e.loc).source.body.substring(u.start,u.end)),o=a.get(n);o&&!o.has(i)?c&&s.warn("Warning: fragment with name "+n+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):o||a.set(n,o=new Set),o.add(i),t.has(i)||(t.add(i),r.push(e))}else r.push(e);var u})),(0,n.pi)((0,n.pi)({},e),{definitions:r})}function f(e){var t=h(e);if(!o.has(t)){var r=(0,i.Qc)(e,{experimentalFragmentVariables:u,allowLegacyFragmentVariables:u});if(!r||"Document"!==r.kind)throw new Error("Not a valid GraphQL document.");o.set(t,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(r){var n=e[r];n&&"object"==typeof n&&t.add(n)}))}));var r=e.loc;return r&&(delete r.startToken,delete r.endToken),e}(l(r)))}return o.get(t)}function d(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];"string"==typeof e&&(e=[e]);var n=e[0];return t.forEach((function(t,r){t&&"Document"===t.kind?n+=t.loc.source.body:n+=t,n+=e[r+1]})),f(n)}var p,y=d,m=function(){o.clear(),a.clear()},g=function(){c=!1},b=function(){u=!0},w=function(){u=!1};(p=d||(d={})).gql=y,p.resetCaches=m,p.disableFragmentWarnings=g,p.enableExperimentalFragmentVariables=b,p.disableExperimentalFragmentVariables=w,d.default=d,t.ZP=d},53767:function(e,t,r){"use strict";function n(e,t){if(!Boolean(e))throw new Error(t)}r.d(t,{a:function(){return n}})},6589:function(e,t,r){"use strict";r.d(t,{X:function(){return s}});const n=10,i=2;function s(e){return o(e,[])}function o(e,t){switch(typeof e){case"string":return JSON.stringify(e);case"function":return e.name?`[function ${e.name}]`:"[function]";case"object":return function(e,t){if(null===e)return"null";if(t.includes(e))return"[Circular]";const r=[...t,e];if(function(e){return"function"==typeof e.toJSON}(e)){const t=e.toJSON();if(t!==e)return"string"==typeof t?t:o(t,r)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>i)return"[Array]";const r=Math.min(n,e.length),s=e.length-r,a=[];for(let n=0;n<r;++n)a.push(o(e[n],t));1===s?a.push("... 1 more item"):s>1&&a.push(`... ${s} more items`);return"["+a.join(", ")+"]"}(e,r);return function(e,t){const r=Object.entries(e);if(0===r.length)return"{}";if(t.length>i)return"["+function(e){const t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){const t=e.constructor.name;if("string"==typeof t&&""!==t)return t}return t}(e)+"]";const n=r.map((([e,r])=>e+": "+o(r,t)));return"{ "+n.join(", ")+" }"}(e,r)}(e,t);default:return String(e)}}},39504:function(e,t,r){"use strict";r.d(t,{UG:function(){return a},WU:function(){return i},Ye:function(){return n},h8:function(){return s},ku:function(){return c}});class n{constructor(e,t,r){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=r}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class i{constructor(e,t,r,n,i,s){this.kind=e,this.start=t,this.end=r,this.line=n,this.column=i,this.value=s,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const s={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},o=new Set(Object.keys(s));function a(e){const t=null==e?void 0:e.kind;return"string"==typeof t&&o.has(t)}var c;!function(e){e.QUERY="query",e.MUTATION="mutation",e.SUBSCRIPTION="subscription"}(c||(c={}))},7420:function(e,t,r){"use strict";r.d(t,{LZ:function(){return o},wv:function(){return i}});var n=r(91022);function i(e){var t;let r=Number.MAX_SAFE_INTEGER,n=null,i=-1;for(let t=0;t<e.length;++t){var o;const a=e[t],c=s(a);c!==a.length&&(n=null!==(o=n)&&void 0!==o?o:t,i=t,0!==t&&c<r&&(r=c))}return e.map(((e,t)=>0===t?e:e.slice(r))).slice(null!==(t=n)&&void 0!==t?t:0,i+1)}function s(e){let t=0;for(;t<e.length&&(0,n.FD)(e.charCodeAt(t));)++t;return t}function o(e,t){const r=e.replace(/"""/g,'\\"""'),i=r.split(/\r\n|[\n\r]/g),s=1===i.length,o=i.length>1&&i.slice(1).every((e=>0===e.length||(0,n.FD)(e.charCodeAt(0)))),a=r.endsWith('\\"""'),c=e.endsWith('"')&&!a,u=e.endsWith("\\"),h=c||u,l=!(null!=t&&t.minimize)&&(!s||e.length>70||h||o||a);let f="";const d=s&&(0,n.FD)(e.charCodeAt(0));return(l&&!d||o)&&(f+="\n"),f+=r,(l||h)&&(f+="\n"),'"""'+f+'"""'}},91022:function(e,t,r){"use strict";function n(e){return 9===e||32===e}function i(e){return e>=48&&e<=57}function s(e){return e>=97&&e<=122||e>=65&&e<=90}function o(e){return s(e)||95===e}function a(e){return s(e)||i(e)||95===e}r.d(t,{FD:function(){return n},HQ:function(){return a},LQ:function(){return o},X1:function(){return i}})},6450:function(e,t,r){"use strict";var n;r.d(t,{h:function(){return n}}),function(e){e.NAME="Name",e.DOCUMENT="Document",e.OPERATION_DEFINITION="OperationDefinition",e.VARIABLE_DEFINITION="VariableDefinition",e.SELECTION_SET="SelectionSet",e.FIELD="Field",e.ARGUMENT="Argument",e.FRAGMENT_SPREAD="FragmentSpread",e.INLINE_FRAGMENT="InlineFragment",e.FRAGMENT_DEFINITION="FragmentDefinition",e.VARIABLE="Variable",e.INT="IntValue",e.FLOAT="FloatValue",e.STRING="StringValue",e.BOOLEAN="BooleanValue",e.NULL="NullValue",e.ENUM="EnumValue",e.LIST="ListValue",e.OBJECT="ObjectValue",e.OBJECT_FIELD="ObjectField",e.DIRECTIVE="Directive",e.NAMED_TYPE="NamedType",e.LIST_TYPE="ListType",e.NON_NULL_TYPE="NonNullType",e.SCHEMA_DEFINITION="SchemaDefinition",e.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",e.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",e.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",e.FIELD_DEFINITION="FieldDefinition",e.INPUT_VALUE_DEFINITION="InputValueDefinition",e.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",e.UNION_TYPE_DEFINITION="UnionTypeDefinition",e.ENUM_TYPE_DEFINITION="EnumTypeDefinition",e.ENUM_VALUE_DEFINITION="EnumValueDefinition",e.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",e.DIRECTIVE_DEFINITION="DirectiveDefinition",e.SCHEMA_EXTENSION="SchemaExtension",e.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",e.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",e.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",e.UNION_TYPE_EXTENSION="UnionTypeExtension",e.ENUM_TYPE_EXTENSION="EnumTypeExtension",e.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"}(n||(n={}))},25202:function(e,t,r){"use strict";function n(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}r.d(t,{Qc:function(){return K}});const i=/\r\n|[\n\r]/g;function s(e,t){let r=0,s=1;for(const o of e.body.matchAll(i)){if("number"==typeof o.index||n(!1),o.index>=t)break;r=o.index+o[0].length,s+=1}return{line:s,column:t+1-r}}function o(e){return a(e.source,s(e.source,e.start))}function a(e,t){const r=e.locationOffset.column-1,n="".padStart(r)+e.body,i=t.line-1,s=e.locationOffset.line-1,o=t.line+s,a=1===t.line?r:0,u=t.column+a,h=`${e.name}:${o}:${u}\n`,l=n.split(/\r\n|[\n\r]/g),f=l[i];if(f.length>120){const e=Math.floor(u/80),t=u%80,r=[];for(let e=0;e<f.length;e+=80)r.push(f.slice(e,e+80));return h+c([[`${o} |`,r[0]],...r.slice(1,e+1).map((e=>["|",e])),["|","^".padStart(t)],["|",r[e+1]]])}return h+c([[o-1+" |",l[i-1]],[`${o} |`,f],["|","^".padStart(u)],[`${o+1} |`,l[i+1]]])}function c(e){const t=e.filter((([e,t])=>void 0!==t)),r=Math.max(...t.map((([e])=>e.length)));return t.map((([e,t])=>e.padStart(r)+(t?" "+t:""))).join("\n")}class u extends Error{constructor(e,...t){var r,n,i;const{nodes:o,source:a,positions:c,path:l,originalError:f,extensions:d}=function(e){const t=e[0];return null==t||"kind"in t||"length"in t?{nodes:t,source:e[1],positions:e[2],path:e[3],originalError:e[4],extensions:e[5]}:t}(t);super(e),this.name="GraphQLError",this.path=null!=l?l:void 0,this.originalError=null!=f?f:void 0,this.nodes=h(Array.isArray(o)?o:o?[o]:void 0);const p=h(null===(r=this.nodes)||void 0===r?void 0:r.map((e=>e.loc)).filter((e=>null!=e)));this.source=null!=a?a:null==p||null===(n=p[0])||void 0===n?void 0:n.source,this.positions=null!=c?c:null==p?void 0:p.map((e=>e.start)),this.locations=c&&a?c.map((e=>s(a,e))):null==p?void 0:p.map((e=>s(e.source,e.start)));const y="object"==typeof(m=null==f?void 0:f.extensions)&&null!==m?null==f?void 0:f.extensions:void 0;var m;this.extensions=null!==(i=null!=d?d:y)&&void 0!==i?i:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),null!=f&&f.stack?Object.defineProperty(this,"stack",{value:f.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,u):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const t of this.nodes)t.loc&&(e+="\n\n"+o(t.loc));else if(this.source&&this.locations)for(const t of this.locations)e+="\n\n"+a(this.source,t);return e}toJSON(){const e={message:this.message};return null!=this.locations&&(e.locations=this.locations),null!=this.path&&(e.path=this.path),null!=this.extensions&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function h(e){return void 0===e||0===e.length?void 0:e}function l(e,t,r){return new u(`Syntax Error: ${r}`,{source:e,positions:[t]})}var f,d=r(39504);!function(e){e.QUERY="QUERY",e.MUTATION="MUTATION",e.SUBSCRIPTION="SUBSCRIPTION",e.FIELD="FIELD",e.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",e.FRAGMENT_SPREAD="FRAGMENT_SPREAD",e.INLINE_FRAGMENT="INLINE_FRAGMENT",e.VARIABLE_DEFINITION="VARIABLE_DEFINITION",e.SCHEMA="SCHEMA",e.SCALAR="SCALAR",e.OBJECT="OBJECT",e.FIELD_DEFINITION="FIELD_DEFINITION",e.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",e.INTERFACE="INTERFACE",e.UNION="UNION",e.ENUM="ENUM",e.ENUM_VALUE="ENUM_VALUE",e.INPUT_OBJECT="INPUT_OBJECT",e.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"}(f||(f={}));var p,y=r(6450),m=r(7420),g=r(91022);!function(e){e.SOF="<SOF>",e.EOF="<EOF>",e.BANG="!",e.DOLLAR="$",e.AMP="&",e.PAREN_L="(",e.PAREN_R=")",e.SPREAD="...",e.COLON=":",e.EQUALS="=",e.AT="@",e.BRACKET_L="[",e.BRACKET_R="]",e.BRACE_L="{",e.PIPE="|",e.BRACE_R="}",e.NAME="Name",e.INT="Int",e.FLOAT="Float",e.STRING="String",e.BLOCK_STRING="BlockString",e.COMMENT="Comment"}(p||(p={}));class b{constructor(e){const t=new d.WU(p.SOF,0,0,0,0);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){this.lastToken=this.token;return this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==p.EOF)do{if(e.next)e=e.next;else{const t=S(this,e.end);e.next=t,t.prev=e,e=t}}while(e.kind===p.COMMENT);return e}}function w(e){return e>=0&&e<=55295||e>=57344&&e<=1114111}function v(e,t){return E(e.charCodeAt(t))&&_(e.charCodeAt(t+1))}function E(e){return e>=55296&&e<=56319}function _(e){return e>=56320&&e<=57343}function x(e,t){const r=e.source.body.codePointAt(t);if(void 0===r)return p.EOF;if(r>=32&&r<=126){const e=String.fromCodePoint(r);return'"'===e?"'\"'":`"${e}"`}return"U+"+r.toString(16).toUpperCase().padStart(4,"0")}function k(e,t,r,n,i){const s=e.line,o=1+r-e.lineStart;return new d.WU(t,r,n,s,o,i)}function S(e,t){const r=e.source.body,n=r.length;let i=t;for(;i<n;){const t=r.charCodeAt(i);switch(t){case 65279:case 9:case 32:case 44:++i;continue;case 10:++i,++e.line,e.lineStart=i;continue;case 13:10===r.charCodeAt(i+1)?i+=2:++i,++e.line,e.lineStart=i;continue;case 35:return A(e,i);case 33:return k(e,p.BANG,i,i+1);case 36:return k(e,p.DOLLAR,i,i+1);case 38:return k(e,p.AMP,i,i+1);case 40:return k(e,p.PAREN_L,i,i+1);case 41:return k(e,p.PAREN_R,i,i+1);case 46:if(46===r.charCodeAt(i+1)&&46===r.charCodeAt(i+2))return k(e,p.SPREAD,i,i+3);break;case 58:return k(e,p.COLON,i,i+1);case 61:return k(e,p.EQUALS,i,i+1);case 64:return k(e,p.AT,i,i+1);case 91:return k(e,p.BRACKET_L,i,i+1);case 93:return k(e,p.BRACKET_R,i,i+1);case 123:return k(e,p.BRACE_L,i,i+1);case 124:return k(e,p.PIPE,i,i+1);case 125:return k(e,p.BRACE_R,i,i+1);case 34:return 34===r.charCodeAt(i+1)&&34===r.charCodeAt(i+2)?B(e,i):P(e,i)}if((0,g.X1)(t)||45===t)return I(e,i,t);if((0,g.LQ)(t))return M(e,i);throw l(e.source,i,39===t?"Unexpected single quote character ('), did you mean to use a double quote (\")?":w(t)||v(r,i)?`Unexpected character: ${x(e,i)}.`:`Invalid character: ${x(e,i)}.`)}return k(e,p.EOF,n,n)}function A(e,t){const r=e.source.body,n=r.length;let i=t+1;for(;i<n;){const e=r.charCodeAt(i);if(10===e||13===e)break;if(w(e))++i;else{if(!v(r,i))break;i+=2}}return k(e,p.COMMENT,t,i,r.slice(t+1,i))}function I(e,t,r){const n=e.source.body;let i=t,s=r,o=!1;if(45===s&&(s=n.charCodeAt(++i)),48===s){if(s=n.charCodeAt(++i),(0,g.X1)(s))throw l(e.source,i,`Invalid number, unexpected digit after 0: ${x(e,i)}.`)}else i=T(e,i,s),s=n.charCodeAt(i);if(46===s&&(o=!0,s=n.charCodeAt(++i),i=T(e,i,s),s=n.charCodeAt(i)),69!==s&&101!==s||(o=!0,s=n.charCodeAt(++i),43!==s&&45!==s||(s=n.charCodeAt(++i)),i=T(e,i,s),s=n.charCodeAt(i)),46===s||(0,g.LQ)(s))throw l(e.source,i,`Invalid number, expected digit but got: ${x(e,i)}.`);return k(e,o?p.FLOAT:p.INT,t,i,n.slice(t,i))}function T(e,t,r){if(!(0,g.X1)(r))throw l(e.source,t,`Invalid number, expected digit but got: ${x(e,t)}.`);const n=e.source.body;let i=t+1;for(;(0,g.X1)(n.charCodeAt(i));)++i;return i}function P(e,t){const r=e.source.body,n=r.length;let i=t+1,s=i,o="";for(;i<n;){const n=r.charCodeAt(i);if(34===n)return o+=r.slice(s,i),k(e,p.STRING,t,i+1,o);if(92!==n){if(10===n||13===n)break;if(w(n))++i;else{if(!v(r,i))throw l(e.source,i,`Invalid character within String: ${x(e,i)}.`);i+=2}}else{o+=r.slice(s,i);const t=117===r.charCodeAt(i+1)?123===r.charCodeAt(i+2)?C(e,i):D(e,i):N(e,i);o+=t.value,i+=t.size,s=i}}throw l(e.source,i,"Unterminated string.")}function C(e,t){const r=e.source.body;let n=0,i=3;for(;i<12;){const e=r.charCodeAt(t+i++);if(125===e){if(i<5||!w(n))break;return{value:String.fromCodePoint(n),size:i}}if(n=n<<4|O(e),n<0)break}throw l(e.source,t,`Invalid Unicode escape sequence: "${r.slice(t,t+i)}".`)}function D(e,t){const r=e.source.body,n=R(r,t+2);if(w(n))return{value:String.fromCodePoint(n),size:6};if(E(n)&&92===r.charCodeAt(t+6)&&117===r.charCodeAt(t+7)){const e=R(r,t+8);if(_(e))return{value:String.fromCodePoint(n,e),size:12}}throw l(e.source,t,`Invalid Unicode escape sequence: "${r.slice(t,t+6)}".`)}function R(e,t){return O(e.charCodeAt(t))<<12|O(e.charCodeAt(t+1))<<8|O(e.charCodeAt(t+2))<<4|O(e.charCodeAt(t+3))}function O(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function N(e,t){const r=e.source.body;switch(r.charCodeAt(t+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:"\n",size:2};case 114:return{value:"\r",size:2};case 116:return{value:"\t",size:2}}throw l(e.source,t,`Invalid character escape sequence: "${r.slice(t,t+2)}".`)}function B(e,t){const r=e.source.body,n=r.length;let i=e.lineStart,s=t+3,o=s,a="";const c=[];for(;s<n;){const n=r.charCodeAt(s);if(34===n&&34===r.charCodeAt(s+1)&&34===r.charCodeAt(s+2)){a+=r.slice(o,s),c.push(a);const n=k(e,p.BLOCK_STRING,t,s+3,(0,m.wv)(c).join("\n"));return e.line+=c.length-1,e.lineStart=i,n}if(92!==n||34!==r.charCodeAt(s+1)||34!==r.charCodeAt(s+2)||34!==r.charCodeAt(s+3))if(10!==n&&13!==n)if(w(n))++s;else{if(!v(r,s))throw l(e.source,s,`Invalid character within String: ${x(e,s)}.`);s+=2}else a+=r.slice(o,s),c.push(a),13===n&&10===r.charCodeAt(s+1)?s+=2:++s,a="",o=s,i=s;else a+=r.slice(o,s),o=s+1,s+=4}throw l(e.source,s,"Unterminated string.")}function M(e,t){const r=e.source.body,n=r.length;let i=t+1;for(;i<n;){const e=r.charCodeAt(i);if(!(0,g.HQ)(e))break;++i}return k(e,p.NAME,t,i,r.slice(t,i))}var L=r(53767),U=r(6589);const j=globalThis.process&&"production"===globalThis.process.env.NODE_ENV?function(e,t){return e instanceof t}:function(e,t){if(e instanceof t)return!0;if("object"==typeof e&&null!==e){var r;const n=t.prototype[Symbol.toStringTag];if(n===(Symbol.toStringTag in e?e[Symbol.toStringTag]:null===(r=e.constructor)||void 0===r?void 0:r.name)){const t=(0,U.X)(e);throw new Error(`Cannot use ${n} "${t}" from another module or realm.\n\nEnsure that there is only one instance of "graphql" in the node_modules\ndirectory. If different versions of "graphql" are the dependencies of other\nrelied on modules, use "resolutions" to ensure only one version is installed.\n\nhttps://yarnpkg.com/en/docs/selective-version-resolutions\n\nDuplicate "graphql" modules cannot be used at the same time since different\nversions may have different capabilities and behavior. The data from one\nversion used in the function from another could produce confusing and\nspurious results.`)}}return!1};class F{constructor(e,t="GraphQL request",r={line:1,column:1}){"string"==typeof e||(0,L.a)(!1,`Body must be a string. Received: ${(0,U.X)(e)}.`),this.body=e,this.name=t,this.locationOffset=r,this.locationOffset.line>0||(0,L.a)(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||(0,L.a)(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function K(e,t){return new z(e,t).parseDocument()}class z{constructor(e,t={}){const r=function(e){return j(e,F)}(e)?e:new F(e);this._lexer=new b(r),this._options=t,this._tokenCounter=0}parseName(){const e=this.expectToken(p.NAME);return this.node(e,{kind:y.h.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:y.h.DOCUMENT,definitions:this.many(p.SOF,this.parseDefinition,p.EOF)})}parseDefinition(){if(this.peek(p.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),t=e?this._lexer.lookahead():this._lexer.token;if(t.kind===p.NAME){switch(t.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw l(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(t.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(t)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(p.BRACE_L))return this.node(e,{kind:y.h.OPERATION_DEFINITION,operation:d.ku.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const t=this.parseOperationType();let r;return this.peek(p.NAME)&&(r=this.parseName()),this.node(e,{kind:y.h.OPERATION_DEFINITION,operation:t,name:r,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(p.NAME);switch(e.value){case"query":return d.ku.QUERY;case"mutation":return d.ku.MUTATION;case"subscription":return d.ku.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(p.PAREN_L,this.parseVariableDefinition,p.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:y.h.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(p.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(p.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(p.DOLLAR),this.node(e,{kind:y.h.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:y.h.SELECTION_SET,selections:this.many(p.BRACE_L,this.parseSelection,p.BRACE_R)})}parseSelection(){return this.peek(p.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,t=this.parseName();let r,n;return this.expectOptionalToken(p.COLON)?(r=t,n=this.parseName()):n=t,this.node(e,{kind:y.h.FIELD,alias:r,name:n,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(p.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(p.PAREN_L,t,p.PAREN_R)}parseArgument(e=!1){const t=this._lexer.token,r=this.parseName();return this.expectToken(p.COLON),this.node(t,{kind:y.h.ARGUMENT,name:r,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(p.SPREAD);const t=this.expectOptionalKeyword("on");return!t&&this.peek(p.NAME)?this.node(e,{kind:y.h.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:y.h.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),!0===this._options.allowLegacyFragmentVariables?this.node(e,{kind:y.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:y.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()}parseValueLiteral(e){const t=this._lexer.token;switch(t.kind){case p.BRACKET_L:return this.parseList(e);case p.BRACE_L:return this.parseObject(e);case p.INT:return this.advanceLexer(),this.node(t,{kind:y.h.INT,value:t.value});case p.FLOAT:return this.advanceLexer(),this.node(t,{kind:y.h.FLOAT,value:t.value});case p.STRING:case p.BLOCK_STRING:return this.parseStringLiteral();case p.NAME:switch(this.advanceLexer(),t.value){case"true":return this.node(t,{kind:y.h.BOOLEAN,value:!0});case"false":return this.node(t,{kind:y.h.BOOLEAN,value:!1});case"null":return this.node(t,{kind:y.h.NULL});default:return this.node(t,{kind:y.h.ENUM,value:t.value})}case p.DOLLAR:if(e){if(this.expectToken(p.DOLLAR),this._lexer.token.kind===p.NAME){const e=this._lexer.token.value;throw l(this._lexer.source,t.start,`Unexpected variable "$${e}" in constant value.`)}throw this.unexpected(t)}return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:y.h.STRING,value:e.value,block:e.kind===p.BLOCK_STRING})}parseList(e){return this.node(this._lexer.token,{kind:y.h.LIST,values:this.any(p.BRACKET_L,(()=>this.parseValueLiteral(e)),p.BRACKET_R)})}parseObject(e){return this.node(this._lexer.token,{kind:y.h.OBJECT,fields:this.any(p.BRACE_L,(()=>this.parseObjectField(e)),p.BRACE_R)})}parseObjectField(e){const t=this._lexer.token,r=this.parseName();return this.expectToken(p.COLON),this.node(t,{kind:y.h.OBJECT_FIELD,name:r,value:this.parseValueLiteral(e)})}parseDirectives(e){const t=[];for(;this.peek(p.AT);)t.push(this.parseDirective(e));return t}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const t=this._lexer.token;return this.expectToken(p.AT),this.node(t,{kind:y.h.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let t;if(this.expectOptionalToken(p.BRACKET_L)){const r=this.parseTypeReference();this.expectToken(p.BRACKET_R),t=this.node(e,{kind:y.h.LIST_TYPE,type:r})}else t=this.parseNamedType();return this.expectOptionalToken(p.BANG)?this.node(e,{kind:y.h.NON_NULL_TYPE,type:t}):t}parseNamedType(){return this.node(this._lexer.token,{kind:y.h.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(p.STRING)||this.peek(p.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");const r=this.parseConstDirectives(),n=this.many(p.BRACE_L,this.parseOperationTypeDefinition,p.BRACE_R);return this.node(e,{kind:y.h.SCHEMA_DEFINITION,description:t,directives:r,operationTypes:n})}parseOperationTypeDefinition(){const e=this._lexer.token,t=this.parseOperationType();this.expectToken(p.COLON);const r=this.parseNamedType();return this.node(e,{kind:y.h.OPERATION_TYPE_DEFINITION,operation:t,type:r})}parseScalarTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");const r=this.parseName(),n=this.parseConstDirectives();return this.node(e,{kind:y.h.SCALAR_TYPE_DEFINITION,description:t,name:r,directives:n})}parseObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");const r=this.parseName(),n=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();return this.node(e,{kind:y.h.OBJECT_TYPE_DEFINITION,description:t,name:r,interfaces:n,directives:i,fields:s})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(p.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(p.BRACE_L,this.parseFieldDefinition,p.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,t=this.parseDescription(),r=this.parseName(),n=this.parseArgumentDefs();this.expectToken(p.COLON);const i=this.parseTypeReference(),s=this.parseConstDirectives();return this.node(e,{kind:y.h.FIELD_DEFINITION,description:t,name:r,arguments:n,type:i,directives:s})}parseArgumentDefs(){return this.optionalMany(p.PAREN_L,this.parseInputValueDef,p.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,t=this.parseDescription(),r=this.parseName();this.expectToken(p.COLON);const n=this.parseTypeReference();let i;this.expectOptionalToken(p.EQUALS)&&(i=this.parseConstValueLiteral());const s=this.parseConstDirectives();return this.node(e,{kind:y.h.INPUT_VALUE_DEFINITION,description:t,name:r,type:n,defaultValue:i,directives:s})}parseInterfaceTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");const r=this.parseName(),n=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();return this.node(e,{kind:y.h.INTERFACE_TYPE_DEFINITION,description:t,name:r,interfaces:n,directives:i,fields:s})}parseUnionTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");const r=this.parseName(),n=this.parseConstDirectives(),i=this.parseUnionMemberTypes();return this.node(e,{kind:y.h.UNION_TYPE_DEFINITION,description:t,name:r,directives:n,types:i})}parseUnionMemberTypes(){return this.expectOptionalToken(p.EQUALS)?this.delimitedMany(p.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");const r=this.parseName(),n=this.parseConstDirectives(),i=this.parseEnumValuesDefinition();return this.node(e,{kind:y.h.ENUM_TYPE_DEFINITION,description:t,name:r,directives:n,values:i})}parseEnumValuesDefinition(){return this.optionalMany(p.BRACE_L,this.parseEnumValueDefinition,p.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,t=this.parseDescription(),r=this.parseEnumValueName(),n=this.parseConstDirectives();return this.node(e,{kind:y.h.ENUM_VALUE_DEFINITION,description:t,name:r,directives:n})}parseEnumValueName(){if("true"===this._lexer.token.value||"false"===this._lexer.token.value||"null"===this._lexer.token.value)throw l(this._lexer.source,this._lexer.token.start,`${$(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");const r=this.parseName(),n=this.parseConstDirectives(),i=this.parseInputFieldsDefinition();return this.node(e,{kind:y.h.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:r,directives:n,fields:i})}parseInputFieldsDefinition(){return this.optionalMany(p.BRACE_L,this.parseInputValueDef,p.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===p.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const t=this.parseConstDirectives(),r=this.optionalMany(p.BRACE_L,this.parseOperationTypeDefinition,p.BRACE_R);if(0===t.length&&0===r.length)throw this.unexpected();return this.node(e,{kind:y.h.SCHEMA_EXTENSION,directives:t,operationTypes:r})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const t=this.parseName(),r=this.parseConstDirectives();if(0===r.length)throw this.unexpected();return this.node(e,{kind:y.h.SCALAR_TYPE_EXTENSION,name:t,directives:r})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const t=this.parseName(),r=this.parseImplementsInterfaces(),n=this.parseConstDirectives(),i=this.parseFieldsDefinition();if(0===r.length&&0===n.length&&0===i.length)throw this.unexpected();return this.node(e,{kind:y.h.OBJECT_TYPE_EXTENSION,name:t,interfaces:r,directives:n,fields:i})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const t=this.parseName(),r=this.parseImplementsInterfaces(),n=this.parseConstDirectives(),i=this.parseFieldsDefinition();if(0===r.length&&0===n.length&&0===i.length)throw this.unexpected();return this.node(e,{kind:y.h.INTERFACE_TYPE_EXTENSION,name:t,interfaces:r,directives:n,fields:i})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const t=this.parseName(),r=this.parseConstDirectives(),n=this.parseUnionMemberTypes();if(0===r.length&&0===n.length)throw this.unexpected();return this.node(e,{kind:y.h.UNION_TYPE_EXTENSION,name:t,directives:r,types:n})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const t=this.parseName(),r=this.parseConstDirectives(),n=this.parseEnumValuesDefinition();if(0===r.length&&0===n.length)throw this.unexpected();return this.node(e,{kind:y.h.ENUM_TYPE_EXTENSION,name:t,directives:r,values:n})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const t=this.parseName(),r=this.parseConstDirectives(),n=this.parseInputFieldsDefinition();if(0===r.length&&0===n.length)throw this.unexpected();return this.node(e,{kind:y.h.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:r,fields:n})}parseDirectiveDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(p.AT);const r=this.parseName(),n=this.parseArgumentDefs(),i=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const s=this.parseDirectiveLocations();return this.node(e,{kind:y.h.DIRECTIVE_DEFINITION,description:t,name:r,arguments:n,repeatable:i,locations:s})}parseDirectiveLocations(){return this.delimitedMany(p.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,t=this.parseName();if(Object.prototype.hasOwnProperty.call(f,t.value))return t;throw this.unexpected(e)}node(e,t){return!0!==this._options.noLocation&&(t.loc=new d.Ye(e,this._lexer.lastToken,this._lexer.source)),t}peek(e){return this._lexer.token.kind===e}expectToken(e){const t=this._lexer.token;if(t.kind===e)return this.advanceLexer(),t;throw l(this._lexer.source,t.start,`Expected ${V(e)}, found ${$(t)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e&&(this.advanceLexer(),!0)}expectKeyword(e){const t=this._lexer.token;if(t.kind!==p.NAME||t.value!==e)throw l(this._lexer.source,t.start,`Expected "${e}", found ${$(t)}.`);this.advanceLexer()}expectOptionalKeyword(e){const t=this._lexer.token;return t.kind===p.NAME&&t.value===e&&(this.advanceLexer(),!0)}unexpected(e){const t=null!=e?e:this._lexer.token;return l(this._lexer.source,t.start,`Unexpected ${$(t)}.`)}any(e,t,r){this.expectToken(e);const n=[];for(;!this.expectOptionalToken(r);)n.push(t.call(this));return n}optionalMany(e,t,r){if(this.expectOptionalToken(e)){const e=[];do{e.push(t.call(this))}while(!this.expectOptionalToken(r));return e}return[]}many(e,t,r){this.expectToken(e);const n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(r));return n}delimitedMany(e,t){this.expectOptionalToken(e);const r=[];do{r.push(t.call(this))}while(this.expectOptionalToken(e));return r}advanceLexer(){const{maxTokens:e}=this._options,t=this._lexer.advance();if(void 0!==e&&t.kind!==p.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw l(this._lexer.source,t.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function $(e){const t=e.value;return V(e.kind)+(null!=t?` "${t}"`:"")}function V(e){return function(e){return e===p.BANG||e===p.DOLLAR||e===p.AMP||e===p.PAREN_L||e===p.PAREN_R||e===p.SPREAD||e===p.COLON||e===p.EQUALS||e===p.AT||e===p.BRACKET_L||e===p.BRACKET_R||e===p.BRACE_L||e===p.PIPE||e===p.BRACE_R}(e)?`"${e}"`:e}},31044:function(e,t,r){"use strict";var n=r(40210)("%Object.defineProperty%",!0),i=function(){if(n)try{return n({},"a",{value:1}),!0}catch(e){return!1}return!1};i.hasArrayLengthDefineBug=function(){if(!i())return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},41405:function(e,t,r){"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(55419);e.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},55419:function(e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},96410:function(e,t,r){"use strict";var n=r(55419);e.exports=function(){return n()&&!!Symbol.toStringTag}},17642:function(e,t,r){"use strict";var n=r(58612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},70248:function(e){e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},85923:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,h=this._events[a],l=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,i),!0;case 5:return h.fn.call(h.context,t,n,i,s),!0;case 6:return h.fn.call(h.context,t,n,i,s,o),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];h.fn.apply(h.context,c)}else{var f,d=h.length;for(u=0;u<d;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),l){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,n);break;case 4:h[u].fn.call(h[u].context,t,n,i);break;default:if(!c)for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];h[u].fn.apply(h[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,u=[],h=a.length;c<h;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},28050:function(e,t,r){const n=r(62800),i=r(8786),s=r(97391),o=r(51385),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:u}=r(8746),h=r(69559),l=r(12566),f=r(52034),d=r(35946),p=r(36596),y=r(42527),m=r(72621);e.exports={RateLimiterRedis:n,RateLimiterMongo:i,RateLimiterMySQL:s,RateLimiterPostgres:o,RateLimiterMemory:h,RateLimiterMemcache:l,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:u,RLWrapperBlackAndWhite:f,RateLimiterUnion:d,RateLimiterQueue:p,BurstyRateLimiter:y,RateLimiterRes:m}},42527:function(e,t,r){const n=r(72621);e.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return e?new n(e.remainingPoints,Math.min(e.msBeforeNext,t?t.msBeforeNext:0),e.consumedPoints,e.isFirstInDuration):null}consume(e,t=1,r={}){return this._rateLimiter.consume(e,t,r).catch((i=>i instanceof n?this._burstLimiter.consume(e,t,r).then((e=>Promise.resolve(this._combineRes(i,e)))).catch((e=>e instanceof n?Promise.reject(this._combineRes(i,e)):Promise.reject(e))):Promise.reject(i)))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then((([e,t])=>this._combineRes(e,t)))}get points(){return this._rateLimiter.points}}},52034:function(e,t,r){const n=r(72621);e.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(void 0===e)throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=void 0!==e&&e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new n(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new n(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.rejectBlack()),void 0===r?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch((()=>{})),r)}block(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch((()=>{})),r)}penalty(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch((()=>{})),r)}reward(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch((()=>{})),r)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),void 0===t||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}},41599:function(e){e.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=void 0===e?1:e}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=void 0===e?0:e}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=void 0!==e&&Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=void 0===e?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(void 0===e&&(e="rlflx"),"string"!=typeof e)throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}},8746:function(e,t,r){var n=r(34155),i=r(25108);const s=r(66778),o=r(10465),a=r(41599),c=r(69559),u=r(72621),h="rate_limiter_flexible";let l=null;const f=function(e,t,r,n){let i;i=null===n||!0===n||!1===n?n:{remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},e.send({channel:h,keyPrefix:t.keyPrefix,promiseId:t.promiseId,type:r,data:i})},d=function(e){setTimeout((()=>{this._initiated?n.send(e):void 0!==this._promises[e.promiseId]&&d.call(this,e)}),30)},p=function(e,t,r,i,s){const o={channel:h,keyPrefix:this.keyPrefix,func:e,promiseId:t,data:{key:r,arg:i,opts:s}};this._initiated?n.send(o):d.call(this,o)},y=function(e,t){if(!t||t.channel!==h||void 0===this._rateLimiters[t.keyPrefix])return!1;let r;switch(t.func){case"consume":r=this._rateLimiters[t.keyPrefix].consume(t.data.key,t.data.arg,t.data.opts);break;case"penalty":r=this._rateLimiters[t.keyPrefix].penalty(t.data.key,t.data.arg,t.data.opts);break;case"reward":r=this._rateLimiters[t.keyPrefix].reward(t.data.key,t.data.arg,t.data.opts);break;case"block":r=this._rateLimiters[t.keyPrefix].block(t.data.key,t.data.arg,t.data.opts);break;case"get":r=this._rateLimiters[t.keyPrefix].get(t.data.key,t.data.opts);break;case"delete":r=this._rateLimiters[t.keyPrefix].delete(t.data.key,t.data.opts);break;default:return!1}r&&r.then((r=>{f(e,t,"resolve",r)})).catch((r=>{f(e,t,"reject",r)}))},m=function(e){if(!e||e.channel!==h||e.keyPrefix!==this.keyPrefix)return!1;if(this._promises[e.promiseId]){let t;switch(clearTimeout(this._promises[e.promiseId].timeoutId),t=null===e.data||!0===e.data||!1===e.data?e.data:new u(e.data.remainingPoints,e.data.msBeforeNext,e.data.consumedPoints,e.data.isFirstInDuration),e.type){case"resolve":this._promises[e.promiseId].resolve(t);break;case"reject":this._promises[e.promiseId].reject(t);break;default:throw new Error(`RateLimiterCluster: no such message type '${e.type}'`)}delete this._promises[e.promiseId]}},g=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},b=function(e,t){const r=n.hrtime();let i=r[0].toString()+r[1].toString();return void 0!==this._promises[i]&&(i+=o.randomBytes(12).toString("base64")),this._promises[i]={resolve:e,reject:t,timeoutId:setTimeout((()=>{delete this._promises[i],t(new Error("RateLimiterCluster timeout: no answer from master in time"))}),this.timeoutMs)},i};e.exports={RateLimiterClusterMaster:class{constructor(){if(l)return l;this._rateLimiters={},s.setMaxListeners(0),s.on("message",((e,t)=>{t&&t.channel===h&&"init"===t.type?(void 0===this._rateLimiters[t.opts.keyPrefix]&&(this._rateLimiters[t.opts.keyPrefix]=new c(t.opts)),e.send({channel:h,type:"init",keyPrefix:t.opts.keyPrefix})):y.call(this,e,t)})),l=this}},RateLimiterClusterMasterPM2:class{constructor(e){if(l)return l;this._rateLimiters={},e.launchBus(((t,r)=>{r.on("process:msg",(t=>{const r=t.raw;if(r&&r.channel===h&&"init"===r.type)void 0===this._rateLimiters[r.opts.keyPrefix]&&(this._rateLimiters[r.opts.keyPrefix]=new c(r.opts)),e.sendDataToProcessId(t.process.pm_id,{data:{},topic:h,channel:h,type:"init",keyPrefix:r.opts.keyPrefix},((e,t)=>{e&&i.log(e,t)}));else{y.call(this,{send:r=>{const n=r;n.topic=h,void 0===n.data&&(n.data={}),e.sendDataToProcessId(t.process.pm_id,n,((e,t)=>{e&&i.log(e,t)}))}},r)}}))})),l=this}},RateLimiterCluster:class extends a{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=void 0===e?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),n.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,n.on("message",(e=>{e&&e.channel===h&&"init"===e.type&&e.keyPrefix===this.keyPrefix?this._initiated=!0:m.call(this,e)})),n.send({channel:h,type:"init",opts:g.call(this)}),this._promises={}}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"consume",s,e,t,r)}))}penalty(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"penalty",s,e,t,r)}))}reward(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"reward",s,e,t,r)}))}block(e,t,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"block",s,e,t,r)}))}get(e,t={}){return new Promise(((r,n)=>{const i=b.call(this,r,n);p.call(this,"get",i,e,t)}))}delete(e,t={}){return new Promise(((r,n)=>{const i=b.call(this,r,n);p.call(this,"delete",i,e,t)}))}}}},12566:function(e,t,r){const n=r(97636),i=r(72621);e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,r){const n=new i;return n.consumedPoints=parseInt(r.consumedPoints),n.isFirstInDuration=r.consumedPoints===t,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=r.msBeforeNext,n}_upsert(e,t,r,n=!1,i={}){return new Promise(((s,o)=>{const a=Date.now(),c=Math.floor(r/1e3);n?this.client.set(e,t,c,(r=>{r?o(r):this.client.set(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.incr(e,t,((u,h)=>{u||!1===h?this.client.add(e,t,c,((u,h)=>{if(u||!h)if(void 0===i.attemptNumber||i.attemptNumber<3){const a=Object.assign({},i);a.attemptNumber=a.attemptNumber?a.attemptNumber+1:1,this._upsert(e,t,r,n,a).then((e=>s(e))).catch((e=>o(e)))}else o(new Error("Can not add key"));else this.client.add(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.get(`${e}_expire`,((e,t)=>{if(e)o(e);else{const e=!1===t?0:t,r={consumedPoints:h,msBeforeNext:e>=0?Math.max(e-a,0):-1};s(r)}}))}))}))}_get(e){return new Promise(((t,r)=>{const n=Date.now();this.client.get(e,((i,s)=>{s?this.client.get(`${e}_expire`,((e,i)=>{if(e)r(e);else{const e=!1===i?0:i,r={consumedPoints:s,msBeforeNext:e>=0?Math.max(e-n,0):-1};t(r)}})):t(null)}))}))}_delete(e){return new Promise(((t,r)=>{this.client.del(e,((n,i)=>{n?r(n):!1===i?t(i):this.client.del(`${e}_expire`,(e=>{e?r(e):t(i)}))}))}))}}},69559:function(e,t,r){const n=r(41599),i=r(72053),s=r(72621);e.exports=class extends n{constructor(e={}){super(e),this._memoryStorage=new i}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=this.getKey(e),o=this._getKeySecDuration(r);let a=this._memoryStorage.incrby(s,t,o);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this._memoryStorage.set(s,a.consumedPoints,this.blockDuration)),i(a);else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let e=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(n,e,a)}else n(a)}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,-t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}block(e,t){const r=1e3*t,n=this.points+1;return this._memoryStorage.set(this.getKey(e),n,t),Promise.resolve(new s(0,0===r?-1:r,n))}set(e,t,r){const n=1e3*(r>=0?r:this.duration);return this._memoryStorage.set(this.getKey(e),t,r),Promise.resolve(new s(0,0===n?-1:n,t))}get(e){const t=this._memoryStorage.get(this.getKey(e));return null!==t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}}},8786:function(e,t,r){const n=r(97636),i=r(72621);function s(e){try{const t=e.client?e.client:e,{version:r}=t.topology.s.options.metadata.driver,n=r.split(".").map((e=>parseInt(e)));return{major:n[0],feature:n[1],patch:n[2]}}catch(e){return{major:0,feature:0,patch:0}}}class o extends n{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,"function"==typeof this.client.then?this.client.then((e=>{this.client=e,this._initCollection(),this._driverVersion=s(this.client)})):(this._initCollection(),this._driverVersion=s(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?o.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get client(){return this._client}set client(e){if(void 0===e)throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const e=("function"==typeof this.client.db?this.client.db(this.dbName):this.client).collection(this.tableName);e.createIndex({expire:-1},{expireAfterSeconds:0}),e.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=e}_getRateLimiterRes(e,t,r){const n=new i;let s;return s=void 0===r.value?r:r.value,n.isFirstInDuration=s.points===t,n.consumedPoints=s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=null!==s.expire?Math.max(new Date(s.expire).getTime()-Date.now(),0):-1,n}_upsert(e,t,r,n=!1,i={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const s=i.attrs||{};let o,a;n?(o={key:e},o=Object.assign(o,s),a={$set:{key:e,points:t,expire:r>0?new Date(Date.now()+r):null}},a.$set=Object.assign(a.$set,s)):(o={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},o=Object.assign(o,s),a={$setOnInsert:{key:e,expire:r>0?new Date(Date.now()+r):null},$inc:{points:t}},a.$setOnInsert=Object.assign(a.$setOnInsert,s));const c={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?c.returnDocument="after":c.returnOriginal=!1,new Promise(((i,u)=>{this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((o=>{if(o&&11e3===o.code){const o=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},s),a={$set:Object.assign({key:e,points:t,expire:r>0?new Date(Date.now()+r):null},s)};this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((s=>{s&&11e3===s.code?this._upsert(e,t,r,n).then((e=>i(e))).catch((e=>u(e))):u(s)}))}else u(o)}))}))}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},r);return this._collection.findOne(n)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e},r);return this._collection.deleteOne(n).then((e=>e.deletedCount>0))}}e.exports=o},97391:function(e,t,r){const n=r(97636),i=r(72621);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()):this._createDbAndTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{this._getConnection().then((r=>{r.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],(()=>{this._releaseConnection(r),t()}))})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise(((e,t)=>{this.client.getConnection(((r,n)=>{if(r)return t(r);e(n)}))}));case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise(((e,t)=>{this._getConnection().then((r=>{r.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,(n=>{if(n)return this._releaseConnection(r),t(n);r.query(this._getCreateTableStmt(),(n=>{if(n)return this._releaseConnection(r),t(n);this._releaseConnection(r),e()}))}))})).catch((e=>{t(e)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(void 0===e)if("Connection"===this.client.constructor.name)e="connection";else if("Pool"===this.client.constructor.name)e="pool";else{if("Sequelize"!==this.client.constructor.name)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,[s]=r;return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_upsertTransaction(e,t,r,n,i){return new Promise(((s,o)=>{e.query("BEGIN",(a=>{if(a)return e.rollback(),o(a);const c=Date.now(),u=n>0?c+n:null;let h,l;i?(h="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = ?, \n            expire = ?;",l=[this.dbName,this.tableName,t,r,u,r,u]):(h="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = IF(expire <= ?, ?, points + (?)), \n            expire = IF(expire <= ?, ?, expire);",l=[this.dbName,this.tableName,t,r,u,c,r,r,c,u]),e.query(h,l,(r=>{if(r)return e.rollback(),o(r);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],((t,r)=>{if(t)return e.rollback(),o(t);e.query("COMMIT",(t=>{if(t)return e.rollback(),o(t);s(r)}))}))}))}))}))}_upsert(e,t,r,n=!1){return this.tableCreated?new Promise(((i,s)=>{this._getConnection().then((o=>{this._upsertTransaction(o,e,t,r,n).then((e=>{i(e),this._releaseConnection(o)})).catch((e=>{s(e),this._releaseConnection(o)}))})).catch((e=>{s(e)}))})):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],((e,i)=>{e?r(e):0===i.length?t(null):t(i),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],((e,i)=>{e?r(e):t(i.affectedRows>0),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}}},51385:function(e,t,r){const n=r(97636),i=r(72621);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?"function"==typeof t&&t():this._createTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{const r={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(r).then((()=>{t()})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":default:return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master)}}_releaseConnection(e){switch(this.clientType){case"pool":case"typeorm":default:return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e)}}_createTable(){return new Promise(((e,t)=>{this._query({text:this._getCreateTableStmt()}).then((()=>{e()})).catch((r=>{"23505"===r.code?e():t(r)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( \n      key varchar(255) PRIMARY KEY,\n      points integer NOT NULL DEFAULT 0,\n      expire bigint\n    );`}get clientType(){return this._clientType}set clientType(e){const t=this.client.constructor.name;if(void 0===e)if("Client"===t)e="client";else if("Pool"===t||"BoundPool"===t)e="pool";else{if("Sequelize"!==t)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,s=r.rows[0];return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_query(e){const t={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise(((e,r)=>{this._getConnection().then((n=>{n.query(t).then((t=>{e(t),this._releaseConnection(n)})).catch((e=>{r(e),this._releaseConnection(n)}))})).catch((e=>{r(e)}))}))}_upsert(e,t,r,n=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const i=r>0?Date.now()+r:null,s=n?" $3 ":` CASE\n             WHEN ${this.tableName}.expire <= $4 THEN $3\n             ELSE ${this.tableName}.expire\n            END `;return this._query({name:n?"rlflx-upsert-force":"rlflx-upsert",text:`\n            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)\n              ON CONFLICT(key) DO UPDATE SET\n                points = CASE\n                          WHEN (${this.tableName}.expire <= $4 OR 1=${n?1:0}) THEN $2\n                          ELSE ${this.tableName}.points + ($2)\n                         END,\n                expire = ${s}\n            RETURNING points, expire;`,values:[e,t,i,Date.now()]})}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._query({name:"rlflx-get",text:`\n            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then((e=>{0===e.rowCount&&(e=null),t(e)})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then((e=>e.rowCount>0)):Promise.reject(Error("Table is not created yet"))}}},36596:function(e,t,r){const n=r(99061),i=4294967295,s="limiter";e.exports=class{constructor(e,t={maxQueueSize:i}){this._queueLimiters={KEY_DEFAULT:new o(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=s){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=s){return this._queueLimiters[t]||(this._queueLimiters[t]=new o(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};class o{constructor(e,t={maxQueueSize:i,key:s}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then((e=>null!==e?e.remainingPoints:this._limiterFlexible.points))}removeTokens(e){const t=this;return new Promise(((r,i)=>{e>t._limiterFlexible.points?i(new n(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`)):t._queue.length>0?t._queueRequest.call(t,r,i,e):t._limiterFlexible.consume(t._key,e).then((e=>{r(e.remainingPoints)})).catch((n=>{n instanceof Error?i(n):(t._queueRequest.call(t,r,i,e),null===t._waitTimeout&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),n.msBeforeNext)))}))}))}_queueRequest(e,t,r){const i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:r}):t(new n(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){const e=this;if(null!==e._waitTimeout&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),0===e._queue.length)return;const t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then((r=>{t.resolve(r.remainingPoints),e._processFIFO.call(e)})).catch((r=>{r instanceof Error?(t.reject(r),e._processFIFO.call(e)):(e._queue.unshift(t),null===e._waitTimeout&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),r.msBeforeNext)))}))}}},62800:function(e,t,r){const n=r(97636),i=r(72621),s="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,this.useRedisPackage=e.useRedisPackage,this.useRedis3AndLowerPackage=e.useRedis3AndLowerPackage,"function"==typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:s})}_isRedisReady(){return!this._rejectIfRedisNotReady||(!this.client.status||"ready"===this.client.status)&&!("function"==typeof this.client.isReady&&!this.client.isReady())}_getRateLimiterRes(e,t,r){let[n,s]=r;Array.isArray(n)&&([,n]=n,[,s]=s);const o=new i;return o.consumedPoints=parseInt(n),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=s,o}async _upsert(e,t,r,n=!1){if(!this._isRedisReady())throw new Error("Redis connection is not ready");const i=Math.floor(r/1e3),o=this.client.multi();return n?(i>0?this.useRedisPackage||this.useRedis3AndLowerPackage?o.set(e,t,{EX:i}):o.set(e,t,"EX",i):o.set(e,t),this.useRedisPackage||this.useRedis3AndLowerPackage?o.pTTL(e).exec(!0):o.pttl(e).exec(!0)):i>0?this.useRedisPackage||this.useRedis3AndLowerPackage?this.useRedis3AndLowerPackage?new Promise(((r,n)=>{const o=function(e,t){return e?n(e):r(t)};"function"==typeof this.client.rlflxIncr?this.client.rlflxIncr(e,t,i,o):this.client.eval(s,1,e,t,i,o)})):this.client.eval(s,{keys:[e],arguments:[String(t),String(i)]}):this.client.rlflxIncr([e].concat([String(t),String(i)])):this.useRedisPackage||this.useRedis3AndLowerPackage?o.incrBy(e,t).pTTL(e).exec(!0):o.incrby(e,t).pttl(e).exec(!0)}async _get(e){if(!this._isRedisReady())throw new Error("Redis connection is not ready");return this.useRedisPackage||this.useRedis3AndLowerPackage?this.client.multi().get(e).pTTL(e).exec(!0).then((e=>{const[t]=e;return null===t?null:e})):this.client.multi().get(e).pttl(e).exec().then((e=>{const[[,t]]=e;return null===t?null:e}))}_delete(e){return this.client.del(e).then((e=>e>0))}}},72621:function(e){e.exports=class{constructor(e,t,r,n){this.remainingPoints=void 0===e?0:e,this.msBeforeNext=void 0===t?0:t,this.consumedPoints=void 0===r?0:r,this.isFirstInDuration=void 0!==n&&n}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},97636:function(e,t,r){const n=r(41599),i=r(88521),s=r(72621);e.exports=class extends n{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new i}get client(){return this._client}set client(e){if(void 0===e)throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,r,n,i,s={}){const o=this._getRateLimiterRes(r,n,i);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&o.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(r,o.msBeforeNext),o.consumedPoints>this.points?t(o):e(o);if(o.consumedPoints>this.points){let e=Promise.resolve();this.blockDuration>0&&o.consumedPoints<=this.points+n&&(o.msBeforeNext=this.msBlockDuration,e=this._block(r,o.consumedPoints,this.msBlockDuration,s)),this.inMemoryBlockOnConsumed>0&&o.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(r,this.inMemoryBlockDuration),o.msBeforeNext=this.msInMemoryBlockDuration),e.then((()=>{t(o)})).catch((e=>{t(e)}))}else if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let t=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=o.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,t,o)}else e(o)}_handleError(e,t,r,i,s,o=!1,a={}){this.insuranceLimiter instanceof n?this.insuranceLimiter[t](s,o,a).then((e=>{r(e)})).catch((e=>{i(e)})):i(e)}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(void 0!==e&&!(e instanceof n))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,r={}){const n=1e3*t;return this._block(this.getKey(e),this.points+1,n,r)}set(e,t,r,n={}){const i=1e3*(r>=0?r:this.duration);return this._block(this.getKey(e),t,i,n)}consume(e,t=1,r={}){return new Promise(((n,i)=>{const o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return i(new s(0,a));this._upsert(o,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{this._afterConsume(n,i,o,t,e)})).catch((s=>{this._handleError(s,"consume",n,i,e,t,r)}))}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,t,e))})).catch((n=>{this._handleError(n,"penalty",i,s,e,t,r)}))}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,-t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,-t,e))})).catch((n=>{this._handleError(n,"reward",i,s,e,t,r)}))}))}get(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._get(r,t).then((e=>{n(null==e?null:this._getRateLimiterRes(r,0,e))})).catch((r=>{this._handleError(r,"get",n,i,e,t)}))}))}delete(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._delete(r,t).then((e=>{this._inMemoryBlockedKeys.delete(r),n(e)})).catch((r=>{this._handleError(r,"delete",n,i,e,t)}))}))}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,r){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,r,n={}){return new Promise(((i,o)=>{this._upsert(e,t,r,!0,n).then((()=>{i(new s(0,r>0?r:-1,t))})).catch((t=>{this._handleError(t,"block",i,o,this.parseKey(e),r/1e3,n)}))}))}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,r,n=!1,i={}){throw new Error("You have to implement the method '_upsert'!")}}},35946:function(e,t,r){const n=r(41599);e.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach((e=>{if(!(e instanceof n))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")})),this._limiters=e}consume(e,t=1){return new Promise(((r,n)=>{const i=[];this._limiters.forEach((r=>{i.push(r.consume(e,t).catch((e=>({rejected:!0,rej:e}))))})),Promise.all(i).then((e=>{const t={};let i=!1;e.forEach((e=>{!0===e.rejected&&(i=!0)}));for(let r=0;r<e.length;r++)i&&!0===e[r].rejected?t[this._limiters[r].keyPrefix]=e[r].rej:i||(t[this._limiters[r].keyPrefix]=e[r]);i?n(t):r(t)}))}))}}},91117:function(e){e.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach((t=>{this._keys[t]<=e&&delete this._keys[t]})),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,1e3*t)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();const e=Date.now();return t>=e?t-e:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach((e=>{delete this._keys[e]}))}}},88521:function(e,t,r){const n=r(91117);e.exports=n},72053:function(e,t,r){const n=r(71433),i=r(72621);e.exports=class{constructor(){this._storage={}}incrby(e,t,r){if(this._storage[e]){const n=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return 0!==n?(this._storage[e].value=this._storage[e].value+t,new i(0,n,this._storage[e].value,!1)):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const s=1e3*r;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new n(t,s>0?new Date(Date.now()+s):null),s>0&&(this._storage[e].timeoutId=setTimeout((()=>{delete this._storage[e]}),s),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new i(0,0===s?-1:s,this._storage[e].value,!0)}get(e){if(this._storage[e]){const t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return new i(0,t,this._storage[e].value,!1)}return null}delete(e){return!!this._storage[e]&&(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0)}}},71433:function(e){e.exports=class{constructor(e,t,r=null){this.value=e,this.expiresAt=t,this.timeoutId=r}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){e instanceof Date||!Number.isInteger(e)||(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}},99061:function(e){e.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}},64482:function(e,t,r){var n,i,s;i=[r(42450)],void 0===(s="function"==typeof(n=function(e){"use strict";var t=e.Reader,r=e.Writer,n=e.util,i=e.roots.default||(e.roots.default={});return i.RPC=function(){function s(e){if(this.subscriptions=[],this.messages=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.subscriptions=n.emptyArray,s.prototype.messages=n.emptyArray,s.prototype.control=null,Object.defineProperty(s.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){if(t||(t=r.create()),null!=e.subscriptions&&e.subscriptions.length)for(var n=0;n<e.subscriptions.length;++n)i.RPC.SubOpts.encode(e.subscriptions[n],t.uint32(10).fork()).ldelim();if(null!=e.messages&&e.messages.length)for(n=0;n<e.messages.length;++n)i.RPC.Message.encode(e.messages[n],t.uint32(18).fork()).ldelim();return null!=e.control&&Object.hasOwnProperty.call(e,"control")&&i.RPC.ControlMessage.encode(e.control,t.uint32(26).fork()).ldelim(),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.subscriptions&&s.subscriptions.length||(s.subscriptions=[]),s.subscriptions.push(i.RPC.SubOpts.decode(e,e.uint32()));break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.push(i.RPC.Message.decode(e,e.uint32()));break;case 3:s.control=i.RPC.ControlMessage.decode(e,e.uint32());break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC)return e;var t=new i.RPC;if(e.subscriptions){if(!Array.isArray(e.subscriptions))throw TypeError(".RPC.subscriptions: array expected");t.subscriptions=[];for(var r=0;r<e.subscriptions.length;++r){if("object"!=typeof e.subscriptions[r])throw TypeError(".RPC.subscriptions: object expected");t.subscriptions[r]=i.RPC.SubOpts.fromObject(e.subscriptions[r])}}if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".RPC.messages: array expected");for(t.messages=[],r=0;r<e.messages.length;++r){if("object"!=typeof e.messages[r])throw TypeError(".RPC.messages: object expected");t.messages[r]=i.RPC.Message.fromObject(e.messages[r])}}if(null!=e.control){if("object"!=typeof e.control)throw TypeError(".RPC.control: object expected");t.control=i.RPC.ControlMessage.fromObject(e.control)}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.subscriptions=[],r.messages=[]),e.subscriptions&&e.subscriptions.length){r.subscriptions=[];for(var n=0;n<e.subscriptions.length;++n)r.subscriptions[n]=i.RPC.SubOpts.toObject(e.subscriptions[n],t)}if(e.messages&&e.messages.length)for(r.messages=[],n=0;n<e.messages.length;++n)r.messages[n]=i.RPC.Message.toObject(e.messages[n],t);return null!=e.control&&e.hasOwnProperty("control")&&(r.control=i.RPC.ControlMessage.toObject(e.control,t),t.oneofs&&(r._control="control")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s.SubOpts=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.subscribe=null,s.prototype.topic=null,Object.defineProperty(s.prototype,"_subscribe",{get:n.oneOfGetter(o=["subscribe"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_topic",{get:n.oneOfGetter(o=["topic"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.subscribe&&Object.hasOwnProperty.call(e,"subscribe")&&t.uint32(8).bool(e.subscribe),null!=e.topic&&Object.hasOwnProperty.call(e,"topic")&&t.uint32(18).string(e.topic),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.SubOpts;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.subscribe=e.bool();break;case 2:s.topic=e.string();break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.SubOpts)return e;var t=new i.RPC.SubOpts;return null!=e.subscribe&&(t.subscribe=Boolean(e.subscribe)),null!=e.topic&&(t.topic=String(e.topic)),t},s.toObject=function(e,t){t||(t={});var r={};return null!=e.subscribe&&e.hasOwnProperty("subscribe")&&(r.subscribe=e.subscribe,t.oneofs&&(r._subscribe="subscribe")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic,t.oneofs&&(r._topic="topic")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.Message=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.from=null,s.prototype.data=null,s.prototype.seqno=null,s.prototype.topic="",s.prototype.signature=null,s.prototype.key=null,Object.defineProperty(s.prototype,"_from",{get:n.oneOfGetter(o=["from"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_data",{get:n.oneOfGetter(o=["data"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_seqno",{get:n.oneOfGetter(o=["seqno"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_signature",{get:n.oneOfGetter(o=["signature"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_key",{get:n.oneOfGetter(o=["key"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.from&&Object.hasOwnProperty.call(e,"from")&&t.uint32(10).bytes(e.from),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.seqno&&Object.hasOwnProperty.call(e,"seqno")&&t.uint32(26).bytes(e.seqno),t.uint32(34).string(e.topic),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(50).bytes(e.key),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var s=void 0===r?e.len:e.pos+r,o=new i.RPC.Message;e.pos<s;){var a=e.uint32();switch(a>>>3){case 1:o.from=e.bytes();break;case 2:o.data=e.bytes();break;case 3:o.seqno=e.bytes();break;case 4:o.topic=e.string();break;case 5:o.signature=e.bytes();break;case 6:o.key=e.bytes();break;default:e.skipType(7&a)}}if(!o.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:o});return o},s.fromObject=function(e){if(e instanceof i.RPC.Message)return e;var t=new i.RPC.Message;return null!=e.from&&("string"==typeof e.from?n.base64.decode(e.from,t.from=n.newBuffer(n.base64.length(e.from)),0):e.from.length&&(t.from=e.from)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.seqno&&("string"==typeof e.seqno?n.base64.decode(e.seqno,t.seqno=n.newBuffer(n.base64.length(e.seqno)),0):e.seqno.length&&(t.seqno=e.seqno)),null!=e.topic&&(t.topic=String(e.topic)),null!=e.signature&&("string"==typeof e.signature?n.base64.decode(e.signature,t.signature=n.newBuffer(n.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.key&&("string"==typeof e.key?n.base64.decode(e.key,t.key=n.newBuffer(n.base64.length(e.key)),0):e.key.length&&(t.key=e.key)),t},s.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.topic=""),null!=e.from&&e.hasOwnProperty("from")&&(r.from=t.bytes===String?n.base64.encode(e.from,0,e.from.length):t.bytes===Array?Array.prototype.slice.call(e.from):e.from,t.oneofs&&(r._from="from")),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data,t.oneofs&&(r._data="data")),null!=e.seqno&&e.hasOwnProperty("seqno")&&(r.seqno=t.bytes===String?n.base64.encode(e.seqno,0,e.seqno.length):t.bytes===Array?Array.prototype.slice.call(e.seqno):e.seqno,t.oneofs&&(r._seqno="seqno")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic),null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?n.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature,t.oneofs&&(r._signature="signature")),null!=e.key&&e.hasOwnProperty("key")&&(r.key=t.bytes===String?n.base64.encode(e.key,0,e.key.length):t.bytes===Array?Array.prototype.slice.call(e.key):e.key,t.oneofs&&(r._key="key")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlMessage=function(){function s(e){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return s.prototype.ihave=n.emptyArray,s.prototype.iwant=n.emptyArray,s.prototype.graft=n.emptyArray,s.prototype.prune=n.emptyArray,s.encode=function(e,t){if(t||(t=r.create()),null!=e.ihave&&e.ihave.length)for(var n=0;n<e.ihave.length;++n)i.RPC.ControlIHave.encode(e.ihave[n],t.uint32(10).fork()).ldelim();if(null!=e.iwant&&e.iwant.length)for(n=0;n<e.iwant.length;++n)i.RPC.ControlIWant.encode(e.iwant[n],t.uint32(18).fork()).ldelim();if(null!=e.graft&&e.graft.length)for(n=0;n<e.graft.length;++n)i.RPC.ControlGraft.encode(e.graft[n],t.uint32(26).fork()).ldelim();if(null!=e.prune&&e.prune.length)for(n=0;n<e.prune.length;++n)i.RPC.ControlPrune.encode(e.prune[n],t.uint32(34).fork()).ldelim();return t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlMessage;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.push(i.RPC.ControlIHave.decode(e,e.uint32()));break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.push(i.RPC.ControlIWant.decode(e,e.uint32()));break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.push(i.RPC.ControlGraft.decode(e,e.uint32()));break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.push(i.RPC.ControlPrune.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlMessage)return e;var t=new i.RPC.ControlMessage;if(e.ihave){if(!Array.isArray(e.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");t.ihave=[];for(var r=0;r<e.ihave.length;++r){if("object"!=typeof e.ihave[r])throw TypeError(".RPC.ControlMessage.ihave: object expected");t.ihave[r]=i.RPC.ControlIHave.fromObject(e.ihave[r])}}if(e.iwant){if(!Array.isArray(e.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");for(t.iwant=[],r=0;r<e.iwant.length;++r){if("object"!=typeof e.iwant[r])throw TypeError(".RPC.ControlMessage.iwant: object expected");t.iwant[r]=i.RPC.ControlIWant.fromObject(e.iwant[r])}}if(e.graft){if(!Array.isArray(e.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");for(t.graft=[],r=0;r<e.graft.length;++r){if("object"!=typeof e.graft[r])throw TypeError(".RPC.ControlMessage.graft: object expected");t.graft[r]=i.RPC.ControlGraft.fromObject(e.graft[r])}}if(e.prune){if(!Array.isArray(e.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");for(t.prune=[],r=0;r<e.prune.length;++r){if("object"!=typeof e.prune[r])throw TypeError(".RPC.ControlMessage.prune: object expected");t.prune[r]=i.RPC.ControlPrune.fromObject(e.prune[r])}}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.ihave=[],r.iwant=[],r.graft=[],r.prune=[]),e.ihave&&e.ihave.length){r.ihave=[];for(var n=0;n<e.ihave.length;++n)r.ihave[n]=i.RPC.ControlIHave.toObject(e.ihave[n],t)}if(e.iwant&&e.iwant.length)for(r.iwant=[],n=0;n<e.iwant.length;++n)r.iwant[n]=i.RPC.ControlIWant.toObject(e.iwant[n],t);if(e.graft&&e.graft.length)for(r.graft=[],n=0;n<e.graft.length;++n)r.graft[n]=i.RPC.ControlGraft.toObject(e.graft[n],t);if(e.prune&&e.prune.length)for(r.prune=[],n=0;n<e.prune.length;++n)r.prune[n]=i.RPC.ControlPrune.toObject(e.prune[n],t);return r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlIHave=function(){function s(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.topicID=null,s.prototype.messageIDs=n.emptyArray,Object.defineProperty(s.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(18).bytes(e.messageIDs[n]);return t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlIHave;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.topicID=e.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),s.messageIDs.push(e.bytes());break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlIHave)return e;var t=new i.RPC.ControlIHave;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var i=0;i<e.messageIDs.length;++i)r.messageIDs[i]=t.bytes===String?n.base64.encode(e.messageIDs[i],0,e.messageIDs[i].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[i]):e.messageIDs[i]}return r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlIWant=function(){function s(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return s.prototype.messageIDs=n.emptyArray,s.encode=function(e,t){if(t||(t=r.create()),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(10).bytes(e.messageIDs[n]);return t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlIWant;e.pos<n;){var o=e.uint32();o>>>3==1?(s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),s.messageIDs.push(e.bytes())):e.skipType(7&o)}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlIWant)return e;var t=new i.RPC.ControlIWant;if(e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var i=0;i<e.messageIDs.length;++i)r.messageIDs[i]=t.bytes===String?n.base64.encode(e.messageIDs[i],0,e.messageIDs[i].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[i]):e.messageIDs[i]}return r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlGraft=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.topicID=null,Object.defineProperty(s.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlGraft;e.pos<n;){var o=e.uint32();o>>>3==1?s.topicID=e.string():e.skipType(7&o)}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlGraft)return e;var t=new i.RPC.ControlGraft;return null!=e.topicID&&(t.topicID=String(e.topicID)),t},s.toObject=function(e,t){t||(t={});var r={};return null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.ControlPrune=function(){function s(e){if(this.peers=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.topicID=null,s.prototype.peers=n.emptyArray,s.prototype.backoff=null,Object.defineProperty(s.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_backoff",{get:n.oneOfGetter(o=["backoff"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.peers&&e.peers.length)for(var n=0;n<e.peers.length;++n)i.RPC.PeerInfo.encode(e.peers[n],t.uint32(18).fork()).ldelim();return null!=e.backoff&&Object.hasOwnProperty.call(e,"backoff")&&t.uint32(24).uint64(e.backoff),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.ControlPrune;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.topicID=e.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),s.peers.push(i.RPC.PeerInfo.decode(e,e.uint32()));break;case 3:s.backoff=e.uint64();break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.ControlPrune)return e;var t=new i.RPC.ControlPrune;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.peers){if(!Array.isArray(e.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");t.peers=[];for(var r=0;r<e.peers.length;++r){if("object"!=typeof e.peers[r])throw TypeError(".RPC.ControlPrune.peers: object expected");t.peers[r]=i.RPC.PeerInfo.fromObject(e.peers[r])}}return null!=e.backoff&&(n.Long?(t.backoff=n.Long.fromValue(e.backoff)).unsigned=!0:"string"==typeof e.backoff?t.backoff=parseInt(e.backoff,10):"number"==typeof e.backoff?t.backoff=e.backoff:"object"==typeof e.backoff&&(t.backoff=new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0))),t},s.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.peers=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.peers&&e.peers.length){r.peers=[];for(var s=0;s<e.peers.length;++s)r.peers[s]=i.RPC.PeerInfo.toObject(e.peers[s],t)}return null!=e.backoff&&e.hasOwnProperty("backoff")&&("number"==typeof e.backoff?r.backoff=t.longs===String?String(e.backoff):e.backoff:r.backoff=t.longs===String?n.Long.prototype.toString.call(e.backoff):t.longs===Number?new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0):e.backoff,t.oneofs&&(r._backoff="backoff")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s.PeerInfo=function(){function s(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return s.prototype.peerID=null,s.prototype.signedPeerRecord=null,Object.defineProperty(s.prototype,"_peerID",{get:n.oneOfGetter(o=["peerID"]),set:n.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_signedPeerRecord",{get:n.oneOfGetter(o=["signedPeerRecord"]),set:n.oneOfSetter(o)}),s.encode=function(e,t){return t||(t=r.create()),null!=e.peerID&&Object.hasOwnProperty.call(e,"peerID")&&t.uint32(10).bytes(e.peerID),null!=e.signedPeerRecord&&Object.hasOwnProperty.call(e,"signedPeerRecord")&&t.uint32(18).bytes(e.signedPeerRecord),t},s.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,s=new i.RPC.PeerInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:s.peerID=e.bytes();break;case 2:s.signedPeerRecord=e.bytes();break;default:e.skipType(7&o)}}return s},s.fromObject=function(e){if(e instanceof i.RPC.PeerInfo)return e;var t=new i.RPC.PeerInfo;return null!=e.peerID&&("string"==typeof e.peerID?n.base64.decode(e.peerID,t.peerID=n.newBuffer(n.base64.length(e.peerID)),0):e.peerID.length&&(t.peerID=e.peerID)),null!=e.signedPeerRecord&&("string"==typeof e.signedPeerRecord?n.base64.decode(e.signedPeerRecord,t.signedPeerRecord=n.newBuffer(n.base64.length(e.signedPeerRecord)),0):e.signedPeerRecord.length&&(t.signedPeerRecord=e.signedPeerRecord)),t},s.toObject=function(e,t){t||(t={});var r={};return null!=e.peerID&&e.hasOwnProperty("peerID")&&(r.peerID=t.bytes===String?n.base64.encode(e.peerID,0,e.peerID.length):t.bytes===Array?Array.prototype.slice.call(e.peerID):e.peerID,t.oneofs&&(r._peerID="peerID")),null!=e.signedPeerRecord&&e.hasOwnProperty("signedPeerRecord")&&(r.signedPeerRecord=t.bytes===String?n.base64.encode(e.signedPeerRecord,0,e.signedPeerRecord.length):t.bytes===Array?Array.prototype.slice.call(e.signedPeerRecord):e.signedPeerRecord,t.oneofs&&(r._signedPeerRecord="signedPeerRecord")),r},s.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},s}(),s}(),i})?n.apply(t,i):n)||(e.exports=s)},63083:function(e,t,r){"use strict";var n=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],i="undefined"==typeof globalThis?r.g:globalThis;e.exports=function(){for(var e=[],t=0;t<n.length;t++)"function"==typeof i[n[t]]&&(e[e.length]=n[t]);return e}},49736:function(e,t,r){"use strict";r.d(t,{C:function(){return i},aY:function(){return s},h6:function(){return o}});var n=r(1262);function i(e){return Boolean((0,n.cs)(e))}function s(e){return Boolean((0,n.XK)(e))}function o(e){return Boolean((0,n.yb)(e))}},1262:function(e,t,r){"use strict";r.d(t,{yb:function(){return c},cs:function(){return o},XK:function(){return a}});const n=45,i=15,s=new class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return void 0===r&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically((()=>{const t=this.readChar();if(t===e)return t}))}readSeparator(e,t,r){return this.readAtomically((()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return r()}))}readNumber(e,t,r,n){return this.readAtomically((()=>{let i=0,s=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*n)-1;for(;;){const r=this.readAtomically((()=>{const t=this.readChar();if(void 0===t)return;const r=Number.parseInt(t,e);return Number.isNaN(r)?void 0:r}));if(void 0===r)break;if(i*=e,i+=r,i>c)return;if(s+=1,void 0!==t&&s>t)return}return 0===s||!r&&a&&s>1?void 0:i}))}readIPv4Addr(){return this.readAtomically((()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,(()=>this.readNumber(10,3,!1,1)));if(void 0===r)return;e[t]=r}return e}))}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const r=2*t;if(t<e.length-3){const n=this.readSeparator(":",t,(()=>this.readIPv4Addr()));if(void 0!==n)return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],[r+4,!0]}const n=this.readSeparator(":",t,(()=>this.readNumber(16,4,!0,2)));if(void 0===n)return[r,!1];e[r]=n>>8,e[r+1]=255&n}return[e.length,!1]};return this.readAtomically((()=>{const t=new Uint8Array(16),[r,n]=e(t);if(16===r)return t;if(n)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const i=new Uint8Array(14),s=16-(r+2),[o]=e(i.subarray(0,s));return t.set(i.subarray(0,o),16-o),t}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function o(e){if(!(e.length>i))return s.new(e).parseWith((()=>s.readIPv4Addr()))}function a(e){if(!(e.length>n))return s.new(e).parseWith((()=>s.readIPv6Addr()))}function c(e){if(!(e.length>n))return s.new(e).parseWith((()=>s.readIPAddr()))}},99644:function(e,t,r){"use strict";r.d(t,{t:function(){return wn}});var n={};r.r(n),r.d(n,{base10:function(){return we}});var i={};r.r(i),r.d(i,{base16:function(){return ve},base16upper:function(){return Ee}});var s={};r.r(s),r.d(s,{base2:function(){return _e}});var o={};r.r(o),r.d(o,{base256emoji:function(){return Ae}});var a={};r.r(a),r.d(a,{base32:function(){return Ie},base32hex:function(){return De},base32hexpad:function(){return Oe},base32hexpadupper:function(){return Ne},base32hexupper:function(){return Re},base32pad:function(){return Pe},base32padupper:function(){return Ce},base32upper:function(){return Te},base32z:function(){return Be}});var c={};r.r(c),r.d(c,{base36:function(){return Me},base36upper:function(){return Le}});var u={};r.r(u),r.d(u,{base58btc:function(){return Ue},base58flickr:function(){return je}});var h={};r.r(h),r.d(h,{base64:function(){return Fe},base64pad:function(){return Ke},base64url:function(){return ze},base64urlpad:function(){return $e}});var l={};r.r(l),r.d(l,{base8:function(){return Ve}});var f={};r.r(f),r.d(f,{identity:function(){return qe}});var d={};r.r(d),r.d(d,{code:function(){return Ye},decode:function(){return Xe},encode:function(){return Je},name:function(){return Ge}});var p={};r.r(p),r.d(p,{code:function(){return Ze},decode:function(){return tt},encode:function(){return et},name:function(){return Qe}});var y={};r.r(y),r.d(y,{identity:function(){return At}});var m={};r.r(m),r.d(m,{sha256:function(){return Ct},sha512:function(){return Dt}});var g={};r.r(g),r.d(g,{Ed25519PrivateKey:function(){return ur},Ed25519PublicKey:function(){return cr},generateKeyPair:function(){return fr},generateKeyPairFromSeed:function(){return dr},unmarshalEd25519PrivateKey:function(){return hr},unmarshalEd25519PublicKey:function(){return lr}});var b={};r.r(b),r.d(b,{MAX_KEY_SIZE:function(){return Ar},RsaPrivateKey:function(){return Tr},RsaPublicKey:function(){return Ir},fromJwk:function(){return Dr},generateKeyPair:function(){return Rr},unmarshalRsaPrivateKey:function(){return Pr},unmarshalRsaPublicKey:function(){return Cr}});var w={};r.r(w),r.d(w,{Secp256k1PrivateKey:function(){return Mr},Secp256k1PublicKey:function(){return Br},generateKeyPair:function(){return jr},unmarshalSecp256k1PrivateKey:function(){return Lr},unmarshalSecp256k1PublicKey:function(){return Ur}});var v=r(9202),E=r(20375),_=r(85275);function x(){const e=(0,_.Z)();let t=!1;return{sink:async r=>{if(t)throw new Error("already piped");t=!0,e.resolve(r)},source:async function*(){const t=await e.promise;yield*t}()}}var k=r(32629);const S=65535,A=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var I=r(33869),T=r(4101);function P(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function C(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function D(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");P(e.outputLen),P(e.blockLen)}function R(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function O(e,t){C(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const N="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,B=e=>e instanceof Uint8Array,M=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),L=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function U(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!B(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class j{clone(){return this._cloneInto()}}function F(e){const t=t=>e().update(U(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}class K extends j{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,D(e);const r=U(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return R(this),this.iHash.update(e),this}digestInto(e){R(this),C(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const z=(e,t,r)=>new K(e,t).update(r).digest();function $(e,t,r){return D(e),void 0===r&&(r=new Uint8Array(e.outputLen)),z(e,U(r),U(t))}z.create=(e,t)=>new K(e,t);const V=new Uint8Array([0]),q=new Uint8Array;function W(e,t,r,n=32){if(D(e),P(n),n>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/e.outputLen);void 0===r&&(r=q);const s=new Uint8Array(i*e.outputLen),o=z.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let t=0;t<i;t++)V[0]=t+1,a.update(0===t?q:c).update(r).update(V).digestInto(c),s.set(c,e.outputLen*t),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),V.fill(0),s.slice(0,n)}class H extends j{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=M(this.buffer)}update(e){R(this);const{view:t,buffer:r,blockLen:n}=this,i=(e=U(e)).length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o!==n)r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0),this.pos=0);else{const t=M(e);for(;n<=i-s;s+=n)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){R(this),O(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:n,isLE:i}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>n-s&&(this.process(r,0),s=0);for(let e=s;e<n;e++)t[e]=0;!function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;e.setUint32(t+c,o,n),e.setUint32(t+u,a,n)}(r,n-8,BigInt(8*this.length),i),this.process(r,0);const o=M(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.length=n,e.pos=o,e.finished=i,e.destroyed=s,n%t&&e.buffer.set(r),e}}const G=(e,t,r)=>e&t^e&r^t&r,Y=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),J=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),X=new Uint32Array(64);class Q extends H{constructor(){super(64,32,8,!1),this.A=0|J[0],this.B=0|J[1],this.C=0|J[2],this.D=0|J[3],this.E=0|J[4],this.F=0|J[5],this.G=0|J[6],this.H=0|J[7]}get(){const{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)X[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=X[e-15],r=X[e-2],n=L(t,7)^L(t,18)^t>>>3,i=L(r,17)^L(r,19)^r>>>10;X[e]=i+X[e-7]+n+X[e-16]|0}let{A:r,B:n,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let e=0;e<64;e++){const t=u+(L(o,6)^L(o,11)^L(o,25))+((h=o)&a^~h&c)+Y[e]+X[e]|0,l=(L(r,2)^L(r,13)^L(r,22))+G(r,n,i)|0;u=c,c=a,a=o,o=s+t|0,s=i,i=n,n=r,r=t+l|0}var h;r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,n,i,s,o,a,c,u)}roundClean(){X.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Z=F((()=>new Q)),ee={hashSHA256:e=>Z(e),getHKDF(e,t){const r=$(Z,t,e),n=W(Z,r,void 0,96);return[n.subarray(0,32),n.subarray(32,64),n.subarray(64,96)]},generateX25519KeyPair(){const e=T.Sg.utils.randomPrivateKey();return{publicKey:T.Sg.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:T.Sg.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>T.Sg.getSharedSecret(e,t),chaCha20Poly1305Encrypt:(e,t,r,n)=>(0,I.CK)(n,t,r).encrypt(e),chaCha20Poly1305Decrypt:(e,t,r,n,i)=>(0,I.CK)(n,t,r).decrypt(e,i)};function te(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function re(e=0){return null!=globalThis.Buffer?.allocUnsafe?te(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function ne(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=re(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return te(r)}const ie=e=>{const t=(r=2,globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r));var r;return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};ie.bytes=2;const se=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};se.bytes=2;var oe=r(49541),ae=(r(3068),r(97450),r(3832));var ce=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},ue=ce;new Uint8Array(0);const he=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class le{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class fe{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return pe(this,e)}}class de{constructor(e){this.decoders=e}or(e){return pe(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const pe=(e,t)=>new de({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class ye{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new le(e,t,r),this.decoder=new fe(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const me=({name:e,prefix:t,encode:r,decode:n})=>new ye(e,t,r,n),ge=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=ue(r,t);return me({prefix:e,name:t,encode:n,decode:e=>he(i(e))})},be=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>me({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),we=ge({prefix:"9",name:"base10",alphabet:"0123456789"}),ve=be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ee=be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),_e=be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),xe=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),ke=xe.reduce(((e,t,r)=>(e[r]=t,e)),[]),Se=xe.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Ae=me({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=ke[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Se[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),Ie=be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Te=be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Pe=be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ce=be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),De=be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Re=be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Oe=be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ne=be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Be=be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Me=ge({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Le=ge({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ue=ge({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),je=ge({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Fe=be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ke=be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ze=be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$e=be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Ve=be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),qe=me({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),We=new TextEncoder,He=new TextDecoder,Ge="json",Ye=512,Je=e=>We.encode(JSON.stringify(e)),Xe=e=>JSON.parse(He.decode(e)),Qe="raw",Ze=85,et=e=>he(e),tt=e=>he(e);var rt=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=st;)r[n++]=255&t|nt,t/=128;for(;t&it;)r[n++]=255&t|nt,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},nt=128,it=-128,st=Math.pow(2,31);var ot=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&ct)<<s:(n&ct)*Math.pow(2,s),s+=7}while(n>=at);return e.bytes=o-r,i},at=128,ct=127;var ut=Math.pow(2,7),ht=Math.pow(2,14),lt=Math.pow(2,21),ft=Math.pow(2,28),dt=Math.pow(2,35),pt=Math.pow(2,42),yt=Math.pow(2,49),mt=Math.pow(2,56),gt=Math.pow(2,63),bt={encode:rt,decode:ot,encodingLength:function(e){return e<ut?1:e<ht?2:e<lt?3:e<ft?4:e<dt?5:e<pt?6:e<yt?7:e<mt?8:e<gt?9:10}};const wt=(e,t=0)=>[bt.decode(e,t),bt.decode.bytes],vt=(e,t,r=0)=>(bt.encode(e,t,r),t),Et=e=>bt.encodingLength(e),_t=(e,t)=>{const r=t.byteLength,n=Et(e),i=n+Et(r),s=new Uint8Array(i+r);return vt(e,s,0),vt(r,s,n),s.set(t,i),new kt(e,r,t,s)},xt=e=>{const t=he(e),[r,n]=wt(t),[i,s]=wt(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new kt(r,i,o,t)};class kt{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const St=he,At={code:0,name:"identity",encode:St,digest:e=>_t(0,St(e))},It=({name:e,code:t,encode:r})=>new Tt(e,t,r);class Tt{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?_t(this.code,t):t.then((e=>_t(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Pt=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ct=It({name:"sha2-256",code:18,encode:Pt("SHA-256")}),Dt=It({name:"sha2-512",code:19,encode:Pt("SHA-512")}),Rt=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Lt(r,Nt(e),t||Ue.encoder):Ut(r,Nt(e),t||Ie.encoder)},Ot=new WeakMap,Nt=e=>{const t=Ot.get(e);if(null==t){const t=new Map;return Ot.set(e,t),t}return t};class Bt{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==jt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ft)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Bt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=_t(e,t);return Bt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Bt.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return Rt(this,e)}toJSON(){return{"/":Rt(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Bt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Bt(e,r,n,i||Kt(e,r,n.bytes))}if(!0===t[zt]){const{version:e,multihash:r,code:n}=t,i=xt(r);return Bt.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==jt)throw new Error(`Version 0 CID must use dag-pb (code: ${jt}) block encoding`);return new Bt(e,t,r,r.bytes);case 1:{const n=Kt(e,t,r.bytes);return new Bt(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Bt.create(0,jt,e)}static createV1(e,t){return Bt.create(1,e,t)}static decode(e){const[t,r]=Bt.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Bt.inspectBytes(e),r=t.size-t.multihashSize,n=he(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new kt(t.multihashCode,t.digestSize,i,n);return[0===t.version?Bt.createV0(s):Bt.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=wt(e.subarray(t));return t+=n,r};let n=r(),i=jt;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Mt(e,t),i=Bt.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Nt(i).set(r,e),i}}const Mt=(e,t)=>{switch(e[0]){case"Q":{const r=t||Ue;return[Ue.prefix,r.decode(`${Ue.prefix}${e}`)]}case Ue.prefix:{const r=t||Ue;return[Ue.prefix,r.decode(e)]}case Ie.prefix:{const r=t||Ie;return[Ie.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Lt=(e,t,r)=>{const{prefix:n}=r;if(n!==Ue.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Ut=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},jt=112,Ft=18,Kt=(e,t,r)=>{const n=Et(e),i=n+Et(t),s=new Uint8Array(i+r.byteLength);return vt(e,s,0),vt(t,s,n),s.set(r,i),s},zt=Symbol.for("@ipld/js-cid/CID"),$t={...f,...s,...l,...n,...i,...a,...c,...u,...h,...o};function Vt(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const qt=Vt("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Wt=Vt("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=re((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Ht={utf8:qt,"utf-8":qt,hex:$t.base16,latin1:Wt,ascii:Wt,binary:Wt,...$t};function Gt(e,t="utf8"){const r=Ht[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):te(globalThis.Buffer.from(e,"utf-8"))}function Yt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const Jt=32,Xt=64,Qt=32;function Zt(e,t){const r=new Uint8Array(Xt);for(let n=0;n<Qt;n++)r[n]=e[n],r[Qt+n]=t[n];return r}var er={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const tr={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function rr(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=er.get();return r*=8,{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),h=a.getRandomValues(new Uint8Array(n)),l={name:t,iv:h};let f;if("string"==typeof c&&(c=Gt(c)),0===c.length){f=await a.subtle.importKey("jwk",tr,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{f=await a.subtle.importKey("jwk",tr,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const d=await a.subtle.encrypt(l,f,e);return ne([u,l.iv,new Uint8Array(d)])},decrypt:async function(e,c){const u=e.subarray(0,s),h=e.subarray(s,s+n),l=e.subarray(s+n),f={name:t,iv:h};let d;if("string"==typeof c&&(c=Gt(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{d=await a.subtle.importKey("jwk",tr,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(f,d,l);return new Uint8Array(p)}}}(),n=await r.encrypt(e,t);return Fe.encode(n)}var nr,ir,sr,or,ar=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(nr||(nr={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(ir||(ir={})),function(e){e.codec=()=>(0,ar.Ji)(ir)}(nr||(nr={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),nr.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=nr.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(sr||(sr={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),nr.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=nr.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(or||(or={}));class cr{_key;constructor(e){this._key=pr(e,Jt)}async verify(e,t){return async function(e,t,r){return T.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return sr.encode({Type:nr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Yt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ct.digest(this.bytes);return e}}class ur{_key;_publicKey;constructor(e,t){this._key=pr(e,Xt),this._publicKey=pr(t,Jt)}async sign(e){return async function(e,t){const r=e.subarray(0,Qt);return T.UN.sign(t,r)}(this._key,e)}get public(){return new cr(this._publicKey)}marshal(){return this._key}get bytes(){return or.encode({Type:nr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Yt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ct.digest(this.bytes);return e}async id(){const e=At.digest(this.public.bytes);return Ue.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return rr(this.bytes,e);throw new oe.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function hr(e){if(e.length>Xt){const t=(e=pr(e,Xt+Jt)).subarray(0,Xt),r=e.subarray(Xt,e.length);return new ur(t,r)}const t=(e=pr(e,Xt)).subarray(0,Xt),r=e.subarray(Jt);return new ur(t,r)}function lr(e){return e=pr(e,Jt),new cr(e)}async function fr(){const{privateKey:e,publicKey:t}=await async function(){const e=T.UN.utils.randomPrivateKey(),t=T.UN.getPublicKey(e);return{privateKey:Zt(e,t),publicKey:t}}();return new ur(e,t)}async function dr(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==Qt)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=T.UN.getPublicKey(t);return{privateKey:Zt(t,r),publicKey:r}}(e);return new ur(t,r)}function pr(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new oe.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}function yr(e,t="utf8"){const r=Ht[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}r(97116),r(15764);function mr(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=ne([new Uint8Array(t-r.length),r])}return yr(r,"base64url")}function gr(e){const t=function(e,t){let r=Gt(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=ne([new Uint8Array(t-r.length),r])}return r}(e);return new ae.jsbn.BigInteger(yr(t,"base16"),16)}const br={"P-256":256,"P-384":384,"P-521":521};Object.keys(br).join(" / ");r(63219);function wr(e){if(isNaN(e)||e<=0)throw new oe.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(N&&"function"==typeof N.getRandomValues)return N.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}r(28095);function vr(e,t){return t.map((t=>gr(e[t])))}async function Er(e){const t=[await er.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await xr(e)],r=await _r({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function _r(e){if(null==e.privateKey||null==e.publicKey)throw new oe.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([er.get().subtle.exportKey("jwk",e.privateKey),er.get().subtle.exportKey("jwk",e.publicKey)])}async function xr(e){return er.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function kr(e,t,r,n){const i=t?function(e){return ae.pki.setRsaPublicKey(...vr(e,["n","e"]))}(e):function(e){return ae.pki.setRsaPrivateKey(...vr(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Gt(n(yr(Uint8Array.from(r),"ascii"),i),"ascii")}function Sr(e){if("RSA"!==e.kty)throw new oe.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new oe.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*Gt(e.n,"base64url").length}const Ar=8192;class Ir{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await er.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return er.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new oe.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=ae.pki.publicKeyToAsn1({n:gr(e.n),e:gr(e.e)});return Gt(ae.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return sr.encode({Type:nr.RSA,Data:this.marshal()}).subarray()}encrypt(e){return kr(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Yt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ct.digest(this.bytes);return e}}class Tr{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return wr(16)}async sign(e){return async function(e,t){const r=await er.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await er.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new oe.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Ir(this._publicKey)}decrypt(e){return kr(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new oe.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=ae.pki.privateKeyToAsn1({n:gr(e.n),e:gr(e.e),d:gr(e.d),p:gr(e.p),q:gr(e.q),dP:gr(e.dp),dQ:gr(e.dq),qInv:gr(e.qi)});return Gt(ae.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return or.encode({Type:nr.RSA,Data:this.marshal()}).subarray()}equals(e){return Yt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ct.digest(this.bytes);return e}async id(){return yr(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new ae.util.ByteBuffer(this.marshal()),r=ae.asn1.fromDer(t),n=ae.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return ae.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return rr(this.bytes,e);throw new oe.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Pr(e){const t=function(e){const t=ae.asn1.fromDer(yr(e,"ascii")),r=ae.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:mr(r.n),e:mr(r.e),d:mr(r.d),p:mr(r.p),q:mr(r.q),dp:mr(r.dP),dq:mr(r.dQ),qi:mr(r.qInv),alg:"RS256"}}(e);if(Sr(t)>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await Er(t);return new Tr(r.privateKey,r.publicKey)}function Cr(e){const t=function(e){const t=ae.asn1.fromDer(yr(e,"ascii")),r=ae.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:mr(r.n),e:mr(r.e)}}(e);if(Sr(t)>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Ir(t)}async function Dr(e){if(Sr(e)>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Er(e);return new Tr(t.privateKey,t.publicKey)}async function Rr(e){if(e>Ar)throw new oe.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await er.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await _r(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Tr(t.privateKey,t.publicKey)}var Or=r(60533);function Nr(e){try{Or.kA.ProjectivePoint.fromHex(e)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Br{_key;constructor(e){Nr(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await Ct.digest(r);return Or.kA.verify(t,n,e)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Or.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return sr.encode({Type:nr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Yt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ct.digest(this.bytes);return e}}class Mr{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return Or.kA.getPublicKey(e,!0)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Or.kA.getPublicKey(e,!0)}catch(e){throw new oe.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Nr(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await Ct.digest(t);try{return Or.kA.sign(r,e).toDERRawBytes()}catch(e){throw new oe.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Br(this._publicKey)}marshal(){return this._key}get bytes(){return or.encode({Type:nr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Yt(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ct.digest(this.bytes);return e}async id(){return yr(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return rr(this.bytes,e);throw new oe.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Lr(e){return new Mr(e)}function Ur(e){return new Br(e)}async function jr(){const e=Or.kA.utils.randomPrivateKey();return new Mr(e)}const Fr={rsa:b,ed25519:g,secp256k1:w};function Kr(e){const t=Object.keys(Fr).join(" / ");return new oe.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}async function zr(e){const t=or.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case nr.RSA:return Fr.rsa.unmarshalRsaPrivateKey(r);case nr.Ed25519:return Fr.ed25519.unmarshalEd25519PrivateKey(r);case nr.Secp256k1:return Fr.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Kr(t.Type??"RSA")}}var $r=r(5681);const Vr=Symbol.for("nodejs.util.inspect.custom"),qr=Object.values($t).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),$t.identity.decoder),Wr=114,Hr=36,Gr=37;class Yr{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[$r.N]=!0;toString(){return null==this.string&&(this.string=Ue.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Bt.createV1(Wr,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Yt(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??qr,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=xt(Ue.decode(`z${e}`));return e.startsWith("12D")?new Xr({multihash:t}):e.startsWith("16U")?new Qr({multihash:t}):new Jr({multihash:t})}return function(e){try{const t=xt(e);if(t.code===At.code){if(t.digest.length===Hr)return new Xr({multihash:t});if(t.digest.length===Gr)return new Qr({multihash:t})}if(t.code===Ct.code)return new Jr({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Wr)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Ct.code)return new Jr({multihash:e.multihash});if(t.code===At.code){if(t.digest.length===Hr)return new Xr({multihash:e.multihash});if(t.digest.length===Gr)return new Qr({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Bt.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(qr.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return Yt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Vr](){return`PeerId(${this.toString()})`}}class Jr extends Yr{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Xr extends Yr{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class Qr extends Yr{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}async function Zr(e,t){return e.length===Hr?new Xr({multihash:_t(At.code,e),privateKey:t}):e.length===Gr?new Qr({multihash:_t(At.code,e),privateKey:t}):new Jr({multihash:await Ct.digest(e),publicKey:e,privateKey:t})}var en,tn;async function rn(e,t,r){const n=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");return(await zr(e.privateKey)).sign(t)}(e,on(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,r){return tn.encode({identityKey:e,identitySig:t,extensions:r??{webtransportCerthashes:[]}}).subarray()}(e.publicKey,n,r)}async function nn(e){return Zr(e.identityKey)}function sn(e){return tn.decode(e)}function on(e){const t=Gt("noise-libp2p-static-key:");return ne([t,e],t.length+e.length)}async function an(e,t,r){const n=await Zr(t.identityKey);if(!n.equals(r))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${r.toString()}`);const i=on(e);if(null==n.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const s=function(e){const t=sr.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case nr.RSA:return Fr.rsa.unmarshalRsaPublicKey(r);case nr.Ed25519:return Fr.ed25519.unmarshalEd25519PublicKey(r);case nr.Secp256k1:return Fr.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Kr(t.Type??"unknown")}}(n.publicKey);if(!await s.verify(i,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function cn(e){return e instanceof Uint8Array&&32===e.length}!function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={webtransportCerthashes:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.webtransportCerthashes.push(e.bytes());else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(en||(en={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,ar.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.identityKey&&e.identityKey.byteLength>0)&&(t.uint32(10),t.bytes(e.identityKey??new Uint8Array(0))),(!0===r.writeDefaults||null!=e.identitySig&&e.identitySig.byteLength>0)&&(t.uint32(18),t.bytes(e.identitySig??new Uint8Array(0))),null!=e.extensions&&(t.uint32(34),en.codec().encode(e.extensions,t,{writeDefaults:!1})),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.identityKey=e.bytes();break;case 2:r.identitySig=e.bytes();break;case 4:r.extensions=en.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,ar.LE)(t,e.codec()),e.decode=t=>(0,ar.C6)(t,e.codec())}(tn||(tn={}));var un=r(11227);un.formatters.b=e=>null==e?"undefined":Ue.baseEncode(e),un.formatters.t=e=>null==e?"undefined":Ie.baseEncode(e),un.formatters.m=e=>null==e?"undefined":Fe.baseEncode(e),un.formatters.p=e=>null==e?"undefined":e.toString(),un.formatters.c=e=>null==e?"undefined":e.toString(),un.formatters.k=e=>null==e?"undefined":e.toString(),un.formatters.a=e=>null==e?"undefined":e.toString();const hn=function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return un.enabled(`${e}:trace`)&&null!=un.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=un(`${e}:trace`)),Object.assign(un(e),{error:un(`${e}:error`),trace:t})}("libp2p:noise");let ln;function fn(e){e?(ln(`LOCAL_PUBLIC_EPHEMERAL_KEY ${yr(e.publicKey,"hex")}`),ln(`LOCAL_PRIVATE_EPHEMERAL_KEY ${yr(e.privateKey,"hex")}`)):ln("Missing local ephemeral keys.")}function dn(e){ln(`REMOTE_EPHEMERAL_PUBLIC_KEY ${yr(e,"hex")}`)}ln=A?hn:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});class pn{n;bytes;view;constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}class yn{crypto;constructor(e){this.crypto=e}encryptWithAd(e,t,r){const n=this.encrypt(e.k,e.n,t,r);return e.n.increment(),n}decryptWithAd(e,t,r,n){const{plaintext:i,valid:s}=this.decrypt(e.k,e.n,t,r,n);return s&&e.n.increment(),{plaintext:i,valid:s}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){return Yt(this.createEmptyKey(),e)}encrypt(e,t,r,n){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(n,t.getBytes(),r,e)}encryptAndHash(e,t){let r;return r=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,r),r}decrypt(e,t,r,n,i){t.assertValue();const s=this.crypto.chaCha20Poly1305Decrypt(n,t.getBytes(),r,e,i);return s?{plaintext:s,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let r,n=!0;return this.hasKey(e.cs)?({plaintext:r,valid:n}=this.decryptWithAd(e.cs,e.h,t)):r=t,this.mixHash(e,t),{plaintext:r,valid:n}}dh(e,t){try{const r=this.crypto.generateX25519SharedKey(e,t);return 32===r.length?r:r.subarray(0,32)}catch(e){const t=e;return hn.error(t),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(ne([e,t],e.length+t.length))}mixKey(e,t){const[r,n]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(n),e.ck=r}initializeKey(e){return{k:e,n:new pn}}initializeSymmetric(e){const t=Gt(e,"utf-8"),r=this.hashProtocolName(t),n=r,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:n,h:r}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}return this.getHash(e,new Uint8Array(0))}split(e){const[t,r]=this.crypto.getHKDF(e.ck,new Uint8Array(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(r)}}writeMessageRegular(e,t){const r=this.encryptWithAd(e,new Uint8Array(0),t);return{ne:this.createEmptyKey(),ns:new Uint8Array(0),ciphertext:r}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class mn extends yn{initializeInitiator(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:r,psk:n,re:new Uint8Array(32)}}initializeResponder(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:r,psk:n,re:new Uint8Array(32)}}writeMessageA(e,t,r){const n=new Uint8Array(0);e.e=void 0!==r?r:this.crypto.generateX25519KeyPair();const i=e.e.publicKey;this.mixHash(e.ss,i);return{ne:i,ns:n,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const n=e.s.publicKey,i=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));return{ne:r,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const r=e.s.publicKey,n=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t),s={ne:this.createEmptyKey(),ns:n,ciphertext:i},{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:s,cs1:o,cs2:a}}readMessageA(e,t){return cn(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(cn(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);n&&cn(r)&&(e.rs=r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:n&&s}}readMessageC(e,t){const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);if(n&&cn(r)&&(e.rs=r),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:n&&s,cs1:o,cs2:a}}initSession(e,t,r){const n=this.createEmptyKey(),i=new Uint8Array(32);let s;return s=e?this.initializeInitiator(t,r,i,n):this.initializeResponder(t,r,i,n),{hs:s,i:e,mc:0}}sendMessage(e,t,r){let n;if(0===e.mc)n=this.writeMessageA(e.hs,t,r);else if(1===e.mc)n=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:r,messageBuffer:i,cs1:s,cs2:o}=this.writeMessageC(e.hs,t);n=i,e.h=r,e.cs1=s,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");n=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");n=this.writeMessageRegular(e.cs2,t)}}return e.mc++,n}recvMessage(e,t){let r=new Uint8Array(0),n=!1;if(0===e.mc)({plaintext:r,valid:n}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:r,valid:n}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:i,plaintext:s,valid:o,cs1:a,cs2:c}=this.readMessageC(e.hs,t);r=s,n=o,e.h=i,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:r,valid:n}}}class gn{isInitiator;session;remotePeer;remoteExtensions={webtransportCerthashes:[]};payload;connection;xx;staticKeypair;prologue;constructor(e,t,r,n,i,s,o,a){this.isInitiator=e,this.payload=t,this.prologue=r,this.staticKeypair=i,this.connection=s,o&&(this.remotePeer=o),this.xx=a??new mn(n),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){var e,t;if(e=this.session.hs.s,ln(`LOCAL_STATIC_PUBLIC_KEY ${yr(e.publicKey,"hex")}`),ln(`LOCAL_STATIC_PRIVATE_KEY ${yr(e.privateKey,"hex")}`),this.isInitiator){hn.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));await this.connection.write((t=e,ne([t.ne,t.ciphertext],t.ne.length+t.ciphertext.length))),hn.trace("Stage 0 - Initiator finished sending first message."),fn(this.session.hs.e)}else{hn.trace("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:new Uint8Array(0)}}((await this.connection.read()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new oe.kz("xx handshake stage 0 validation fail");hn.trace("Stage 0 - Responder received first message."),dn(this.session.hs.re)}}async exchange(){if(this.isInitiator){hn.trace("Stage 1 - Initiator waiting to receive first message from responder...");const e=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.read()).subarray()),{plaintext:r,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new oe.kz("xx handshake stage 1 validation fail");hn.trace("Stage 1 - Initiator received the message."),dn(this.session.hs.re),t=this.session.hs.rs,ln(`REMOTE_STATIC_PUBLIC_KEY ${yr(t,"hex")}`),hn.trace("Initiator going to check remote's signature...");try{const e=sn(r);this.remotePeer=this.remotePeer||await nn(e),await an(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new oe.kT(`Error occurred while verifying signed payload: ${t.message}`)}hn.trace("All good with the signature!")}else{hn.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const t=this.xx.sendMessage(this.session,this.payload);await this.connection.write((e=t,ne([e.ne,e.ns,e.ciphertext],e.ne.length+e.ns.length+e.ciphertext.length))),hn.trace("Stage 1 - Responder sent the second handshake message with signed payload."),fn(this.session.hs.e)}var e,t}async finish(){if(this.isInitiator){hn.trace("Stage 2 - Initiator sending third handshake message.");const t=this.xx.sendMessage(this.session,this.payload);await this.connection.write((e=t,ne([e.ns,e.ciphertext],e.ns.length+e.ciphertext.length))),hn.trace("Stage 2 - Initiator sent message with signed payload.")}else{hn.trace("Stage 2 - Responder waiting for third handshake message...");const e=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.read()).subarray()),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new oe.kz("xx handshake stage 2 validation fail");hn.trace("Stage 2 - Responder received the message, finished handshake.");try{const e=sn(t);this.remotePeer=this.remotePeer||await nn(e),await an(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new oe.kT(`Error occurred while verifying signed payload: ${t.message}`)}}var e,t;(t=this.session).cs1&&t.cs2?(ln(`CIPHER_STATE_1 ${t.cs1.n.getUint64()} ${yr(t.cs1.k,"hex")}`),ln(`CIPHER_STATE_2 ${t.cs2.n.getUint64()} ${yr(t.cs2.k,"hex")}`)):ln("Missing cipher state.")}encrypt(e,t){const r=this.getCS(t);return this.xx.encryptWithAd(r,new Uint8Array(0),e)}decrypt(e,t,r){const n=this.getCS(t,!1);return this.xx.decryptWithAd(n,new Uint8Array(0),e,r)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new oe.kz("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}class bn{protocol="/noise";crypto;prologue;staticKeys;extensions;metrics;constructor(e={}){const{staticNoiseKey:t,extensions:r,crypto:n,prologueBytes:i,metrics:s}=e;this.crypto=n??ee,this.extensions=r,this.metrics=s?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(s):void 0,this.staticKeys=t?this.crypto.generateX25519KeyPairFromSeed(t):this.crypto.generateX25519KeyPair(),this.prologue=i??new Uint8Array(0)}async secureOutbound(e,t,r){const n=(0,E.p)(t,{lengthEncoder:ie,lengthDecoder:se,maxDataLength:S}),i=await this.performHandshake({connection:n,isInitiator:!0,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,r){const n=(0,E.p)(t,{lengthEncoder:ie,lengthDecoder:se,maxDataLength:S}),i=await this.performHandshake({connection:n,isInitiator:!1,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){const t=await rn(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:r,remotePeer:n,connection:i}=e,s=new gn(r,t,this.prologue,this.crypto,this.staticKeys,i,n);try{await s.propose(),await s.exchange(),await s.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){if(this.metrics?.xxHandshakeErrors.increment(),e instanceof Error)throw e.message=`Error occurred during XX handshake: ${e.message}`,e}return s}async createSecureConnection(e,t){const[r,n]=function(){const e=x(),t=x();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),i=e.unwrap();return await(0,k.z)(r,function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=65519){let i=r+65519;i>n.length&&(i=n.length);const s=e.encrypt(n.subarray(r,i),e.session);t?.encryptedPackets.increment(),yield ie(s.byteLength),yield s}}}(t,this.metrics),i,(e=>(0,v.J)(e,{lengthDecoder:se})),function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=S){let i=r+S;if(i>n.length&&(i=n.length),i-16<r)throw new Error("Invalid chunk");const s=n.subarray(r,i),o=n.subarray(r,i-16),{plaintext:a,valid:c}=e.decrypt(s,e.session,o);if(!c)throw t?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");t?.decryptedPackets.increment(),yield a}}}(t,this.metrics),r),n}}function wn(e={}){return()=>new bn(e)}},79071:function(e,t,r){"use strict";r.d(t,{P:function(){return re}});var n=r(49541),i=r(11227);var s=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);class o{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class a{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return u(this,e)}}class c{constructor(e){this.decoders=e}or(e){return u(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const u=(e,t)=>new c({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class h{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new o(e,t,r),this.decoder=new a(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const l=({name:e,prefix:t,encode:r,decode:n})=>new h(e,t,r,n),f=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=s(r,t);return l({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},d=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>l({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),p=d({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),y=(d({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),d({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),d({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),d({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),d({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),d({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),d({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),f({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"})),m=(f({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),d({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}));d({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),d({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),d({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function g(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return i.enabled(`${e}:trace`)&&null!=i.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=i(`${e}:trace`)),Object.assign(i(e),{error:i(`${e}:error`),trace:t})}i.formatters.b=e=>null==e?"undefined":y.baseEncode(e),i.formatters.t=e=>null==e?"undefined":p.baseEncode(e),i.formatters.m=e=>null==e?"undefined":m.baseEncode(e),i.formatters.p=e=>null==e?"undefined":e.toString(),i.formatters.c=e=>null==e?"undefined":e.toString(),i.formatters.k=e=>null==e?"undefined":e.toString(),i.formatters.a=e=>null==e?"undefined":e.toString();class b extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function w(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new b(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new b(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}var v=r(32629),E=r(85275);class _{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class x{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new _(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new _(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class k extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function S(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new x,a=(0,E.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>i?r:(i=!0,null!=e?(e=>(o=new x,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,E.Z)()}))}},return:()=>(o=new x,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new k)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(l.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return l.readableLength}},r}const A="ERR_INVALID_FRAME",I="ERR_UNREQUESTED_PING",T="ERR_NOT_MATCHING_PING",P="ERR_STREAM_ALREADY_EXISTS",C="ERR_DECODE_INVALID_VERSION",D="ERR_BOTH_CLIENTS",R="ERR_RECV_WINDOW_EXCEEDED",O=new Set([A,I,T,P,C,D,R]),N="ERR_INVALID_CONFIG",B="ERR_MUXER_LOCAL_CLOSED",M="ERR_MUXER_REMOTE_CLOSED",L=262144,U={log:g("libp2p:yamux"),enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:L,maxStreamWindowSize:16777216,maxMessageSize:65536};var j,F,K=r(62308);!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(j||(j={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(F||(F={}));const z=Object.values(F).filter((e=>"string"!=typeof e));var $;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}($||($={}));function V(e){const t=z.filter((t=>(e.flag&t)===t)).map((e=>F[e])).join("|");return`streamID=${e.streamID} type=${j[e.type]} flag=${t} length=${e.length}`}const q=2**24;class W{source;buffer;frameInProgress;constructor(e){this.source=function(e){if(void 0!==e[Symbol.iterator]){const t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw new Error("a source must be either an iterable or an async iterable")}(e),this.buffer=new K.H,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const e=this.readHeader();if(void 0===e)break;const{type:t,length:r}=e;t===j.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,r)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new n.sv("decoding frame already in progress","ERR_DECODE_IN_PROGRESS");if(this.buffer.length<12)return;const e=function(e){if(0!==e[0])throw new n.sv("Invalid frame version",C);return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*q+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*q+(e[9]<<16)+(e[10]<<8)+e[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),e}async readBytes(e){if(this.buffer.length<e)for await(const t of this.source)if(this.buffer.append(t),this.buffer.length>=e)break;const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function H(e){const t=new Uint8Array(12);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}var G=r(77399),Y=r(75671);var J,X=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r),yield r}();const r=(0,Y.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s?.then)return async function*(){yield n;for await(const e of r)await t(e),yield e}();const o=t;return function*(){yield n;for(const e of r)o(e),yield e}()};!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(J||(J={}));class Q extends G.b{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super({...e,onEnd:t=>{this.state=J.Finished,e.onEnd?.(t)}}),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=L,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=X(this.source,(()=>{this.sendWindowUpdate()}))}async sendNewStream(){}async sendData(e,t={}){for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&await this.waitForSendWindowCapacity(t),"open"!==this.status)return;const r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,e.length),n=this.getSendFlags();this.sendFrame({type:j.Data,flag:n,streamID:this._id,length:r},e.subarray(0,r)),this.sendWindowCapacity-=r,e.consume(r)}}async sendReset(){this.sendFrame({type:j.WindowUpdate,flag:F.RST,streamID:this._id,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|F.FIN;this.sendFrame({type:j.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(e={}){if(this.sendWindowCapacity>0)return;let t,r;const i=()=>{"open"===this.status?r(new n.sv("stream aborted","ERR_STREAM_ABORT")):t()};e.signal?.addEventListener("abort",i);try{await new Promise(((e,n)=>{this.sendWindowCapacityUpdate=()=>{e()},r=n,t=e}))}finally{e.signal?.removeEventListener("abort",i)}}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);const t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,0===t&&e.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(e,t){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new n.sv("receive window exceeded",R,{available:this.recvWindowCapacity,recv:e.length});const r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&F.ACK)===F.ACK&&this.state===J.SYNSent&&(this.state=J.Established),(e&F.FIN)===F.FIN&&this.remoteCloseWrite(),(e&F.RST)===F.RST&&this.reset()}getSendFlags(){switch(this.state){case J.Init:return this.state=J.SYNSent,F.SYN;case J.SYNReceived:return this.state=J.Established,F.ACK;default:return 0}}sendWindowUpdate(){const e=this.getSendFlags(),t=Date.now(),r=this.getRTT();if(0===e&&r>0&&t-this.epochStart<4*r&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;const n=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:j.WindowUpdate,flag:e,streamID:this._id,length:n})}}const Z="/yamux/1.0.0";class ee{protocol=Z;_init;constructor(e={}){this._init=e}createStreamMuxer(e){return new te({...this._init,...e})}}class te{protocol=Z;source;sink;config;log;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e){this.client="outbound"===e.direction,this.config={...U,...e},this.log=this.config.log,function(e){if(e.keepAliveInterval<=0)throw new n.sv("keep-alive interval must be positive",N);if(e.maxInboundStreams<0)throw new n.sv("max inbound streams must be larger or equal 0",N);if(e.maxOutboundStreams<0)throw new n.sv("max outbound streams must be larger or equal 0",N);if(e.initialStreamWindowSize<L)throw new n.sv("InitialStreamWindowSize must be larger or equal 256 kB",N);if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new n.sv("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",N);if(e.maxStreamWindowSize>2**32-1)throw new n.sv("MaxStreamWindowSize must be less than equal MAX_UINT32",N);if(e.maxMessageSize<1024)throw new n.sv("MaxMessageSize must be greater than a kilobyte",N)}(this.config),this.closeController=new AbortController,this.onIncomingStream=e.onIncomingStream,this.onStreamEnd=e.onStreamEnd,this._streams=new Map,this.source=function(e={}){return S((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach((e=>{e.destroy()}))}}),this.sink=async e=>{let t,r;e=w(e,this.closeController.signal,{returnOnAbort:!0});try{const r=new W(e);await(0,v.z)(r.emitFrames.bind(r),(async e=>{for await(const{header:t,readData:r}of e)await this.handleFrame(t,r)})),t=$.NormalTermination}catch(e){const n=e.code;O.has(n)?(this.log?.error("protocol error in sink",e),t=$.ProtocolError):(this.log?.error("internal error in sink",e),t=$.InternalError),r=e}this.log?.trace("muxer sink ended"),null!=r?this.abort(r,t):await this.close({reason:t})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=0,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch((e=>this.log?.error("keepalive error: %s",e)))}get streams(){return Array.from(this._streams.values())}newStream(e){if(void 0!==this.remoteGoAway)throw new n.sv("muxer closed remotely",M);if(void 0!==this.localGoAway)throw new n.sv("muxer closed locally",B);const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new n.sv("max outbound streams exceeded","ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED");this.log?.trace("new outgoing stream id=%s",t);const r=this._newStream(t,e,J.Init,"outbound");return this._streams.set(t,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new n.sv("muxer closed remotely",M);if(void 0!==this.localGoAway)throw new n.sv("muxer closed locally",B);if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise(((t,r)=>{const i=()=>{r(new n.sv("muxer closed locally",B))};this.closeController.signal.addEventListener("abort",i,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",i),t()}})),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const r=Date.now();this.rtt=r-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.closeController.signal.aborted)return;const t=e?.reason??$.NormalTermination;this.log?.trace("muxer close reason=%s",t),e.signal=e.signal??AbortSignal.timeout(500);try{await Promise.all([...this._streams.values()].map((async t=>t.close(e)))),this.sendGoAway(t),this._closeMuxer()}catch(e){this.abort(e)}}abort(e,t){if(!this.closeController.signal.aborted){t=t??$.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e);for(const t of this._streams.values())t.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,r,i){if(null!=this._streams.get(e))throw new n.sv("Stream already exists",P,{id:e});const s=new Q({id:e.toString(),name:t,state:r,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(s)},log:g(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){const e=new Promise(((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})}));for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise((e=>{t=setTimeout(e,this.config.keepAliveInterval)}))]),this.ping().catch((e=>this.log?.error("ping error: %s",e)))}catch(e){return void clearInterval(t)}}}async handleFrame(e,t){const{streamID:r,type:i,length:s}=e;if(this.log?.trace("received frame %s",V(e)),0===r)switch(i){case j.Ping:return void this.handlePing(e);case j.GoAway:return void this.handleGoAway(s);default:throw new n.sv("Invalid frame type",A,{header:e})}else switch(e.type){case j.Data:case j.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new n.sv("Invalid frame type",A,{header:e})}}handlePing(e){if(e.flag===F.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,F.ACK);else{if(e.flag!==F.ACK)throw new n.sv("Invalid frame flag",A,{header:e});this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length)}}handlePingResponse(e){if(void 0===this.activePing)throw new n.sv("ping not requested",I);if(this.activePing.id!==e)throw new n.sv("ping doesn't match our id",T);this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",$[e]??"unknown"),this.remoteGoAway=e;for(const e of this._streams.values())e.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:r,flag:n,type:i}=e;(n&F.SYN)===F.SYN&&this.incomingStream(r);const s=this._streams.get(r);if(void 0!==s)switch(i){case j.WindowUpdate:return void s.handleWindowUpdate(e);case j.Data:if(void 0===t)throw new Error("unreachable");return void await s.handleData(e,t);default:throw new Error("unreachable")}else if(i===j.Data){if(this.log?.("discarding data for stream id=%s",r),void 0===t)throw new Error("unreachable");await t()}else this.log?.("frame for missing stream id=%s",r)}incomingStream(e){if(this.client!==(e%2==0))throw new n.sv("both endpoints are clients",D);if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:j.WindowUpdate,flag:F.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return this.log?.("maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:j.WindowUpdate,flag:F.RST,streamID:e,length:0});const t=this._newStream(e,void 0,J.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %s",V(e)),e.type===j.Data){if(void 0===t)throw new n.sv("invalid frame",A);this.source.push(H(e)),this.source.push(t)}else this.source.push(H(e))}sendPing(e,t=F.SYN){t===F.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:j.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=$.NormalTermination){this.log?.("sending GoAway reason=%s",$[e]),this.localGoAway=e,this.sendFrame({type:j.GoAway,flag:0,streamID:0,length:e})}}function re(e={}){return()=>new ee(e)}},9839:function(e,t,r){"use strict";r(1262);parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255])},53184:function(e,t,r){"use strict";r.d(t,{Y4:function(){return ki}});var n={};r.r(n),r.d(n,{code:function(){return k},decode:function(){return A},encode:function(){return S},name:function(){return x}});var i=r(32114);var s=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t};var o=function(e,t=1){return t=Number(t),null!=e[Symbol.asyncIterator]?async function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for await(const n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}():function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for(const n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}()};async function*a(e,t=1){for await(const r of o(e,t)){const e=r.map((async e=>e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const r=await e[t];if(!r.ok)throw r.err;yield r.value}}}var c=r(62308);const u=(e={})=>{const t=e.chunkSize??262144;return async function*(e){let r=new c.H,n=0,i=!1;for await(const s of e)for(r.append(s),n+=s.length;n>=t;)if(yield r.slice(0,t),i=!0,t===r.length)r=new c.H,n=0;else{const e=new c.H;e.append(r.sublist(t)),r=e,n-=t}(!i||n>0)&&(yield r.subarray(0,n))}};var h,l,f,d=r(33808),p=r(46888);!function(e){let t,r,n;!function(e){e.Raw="Raw",e.Directory="Directory",e.File="File",e.Metadata="Metadata",e.Symlink="Symlink",e.HAMTShard="HAMTShard"}(t=e.DataType||(e.DataType={})),function(e){e[e.Raw=0]="Raw",e[e.Directory=1]="Directory",e[e.File=2]="File",e[e.Metadata=3]="Metadata",e[e.Symlink=4]="Symlink",e[e.HAMTShard=5]="HAMTShard"}(r||(r={})),function(e){e.codec=()=>(0,p.Ji)(r)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==n&&(n=(0,p.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.Type&&(r.uint32(8),e.DataType.codec().encode(t.Type,r)),null!=t.Data&&(r.uint32(18),r.bytes(t.Data)),null!=t.filesize&&(r.uint32(24),r.uint64(t.filesize)),null!=t.blocksizes)for(const e of t.blocksizes)r.uint32(32),r.uint64(e);null!=t.hashType&&(r.uint32(40),r.uint64(t.hashType)),null!=t.fanout&&(r.uint32(48),r.uint64(t.fanout)),null!=t.mode&&(r.uint32(56),r.uint32(t.mode)),null!=t.mtime&&(r.uint32(66),l.codec().encode(t.mtime,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={blocksizes:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.Type=e.DataType.codec().decode(t);break;case 2:n.Data=t.bytes();break;case 3:n.filesize=t.uint64();break;case 4:n.blocksizes.push(t.uint64());break;case 5:n.hashType=t.uint64();break;case 6:n.fanout=t.uint64();break;case 7:n.mode=t.uint32();break;case 8:n.mtime=l.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(h||(h={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,p.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(l||(l={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,p.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.MimeType=e.string();else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(f||(f={}));const y={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},m=["directory","hamt-sharded-directory"],g=parseInt("0644",8),b=parseInt("0755",8);class w{static unmarshal(e){const t=h.decode(e),r=new w({type:y[null!=t.Type?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:null!=t.mtime?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return r._originalMode=t.mode??0,r}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){const{type:t,data:r,blockSizes:n,hashType:s,fanout:o,mtime:a,mode:c}=e;if(null!=t&&!Object.values(y).includes(t))throw i(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t??"file",this.data=r,this.hashType=s,this.fanout=o,this.blockSizes=n??[],this._originalMode=0,this.mode=c,this.mtime=a}set mode(e){this._mode=null==e?this.isDirectory()?b:g:4095&e}get mode(){return this._mode}isDirectory(){return m.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach((t=>{e+=t})),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=h.DataType.Raw;break;case"directory":e=h.DataType.Directory;break;case"file":e=h.DataType.File;break;case"metadata":e=h.DataType.Metadata;break;case"symlink":e=h.DataType.Symlink;break;case"hamt-sharded-directory":e=h.DataType.HAMTShard;break;default:throw i(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let t,r,n=this.data;return null!=this.data&&0!==this.data.length||(n=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(this.mode??0),t!==g||this.isDirectory()||(t=void 0),t===b&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(r={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),h.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r})}}const v=new Uint8Array(0),E=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):v},_=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},x="raw",k=85,S=e=>_(e),A=e=>_(e);var I=r(43905);var T=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class P{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class C{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return R(this,e)}}class D{constructor(e){this.decoders=e}or(e){return R(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const R=(e,t)=>new D({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class O{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new P(e,t,r),this.decoder=new C(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const N=({name:e,prefix:t,encode:r,decode:n})=>new O(e,t,r,n),B=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=T(r,t);return N({prefix:e,name:t,encode:n,decode:e=>_(i(e))})},M=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>N({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),L=M({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),U=(M({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),M({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),M({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),M({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),M({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),M({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),M({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),M({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),B({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));B({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var j=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=z;)r[n++]=255&t|F,t/=128;for(;t&K;)r[n++]=255&t|F,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},F=128,K=-128,z=Math.pow(2,31);var $=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&q)<<s:(n&q)*Math.pow(2,s),s+=7}while(n>=V);return e.bytes=o-r,i},V=128,q=127;var W=Math.pow(2,7),H=Math.pow(2,14),G=Math.pow(2,21),Y=Math.pow(2,28),J=Math.pow(2,35),X=Math.pow(2,42),Q=Math.pow(2,49),Z=Math.pow(2,56),ee=Math.pow(2,63),te={encode:j,decode:$,encodingLength:function(e){return e<W?1:e<H?2:e<G?3:e<Y?4:e<J?5:e<X?6:e<Q?7:e<Z?8:e<ee?9:10}};const re=(e,t=0)=>[te.decode(e,t),te.decode.bytes],ne=(e,t,r=0)=>(te.encode(e,t,r),t),ie=e=>te.encodingLength(e),se=(e,t)=>{const r=t.byteLength,n=ie(e),i=n+ie(r),s=new Uint8Array(i+r);return ne(e,s,0),ne(r,s,n),s.set(t,i),new ae(e,r,t,s)},oe=e=>{const t=_(e),[r,n]=re(t),[i,s]=re(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new ae(r,i,o,t)};class ae{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const ce=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?de(r,he(e),t||U.encoder):pe(r,he(e),t||L.encoder)},ue=new WeakMap,he=e=>{const t=ue.get(e);if(null==t){const t=new Map;return ue.set(e,t),t}return t};class le{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ye)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==me)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return le.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=se(e,t);return le.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return le.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return ce(this,e)}toJSON(){return{"/":ce(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof le)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new le(e,r,n,i||ge(e,r,n.bytes))}if(!0===t[be]){const{version:e,multihash:r,code:n}=t,i=oe(r);return le.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ye)throw new Error(`Version 0 CID must use dag-pb (code: ${ye}) block encoding`);return new le(e,t,r,r.bytes);case 1:{const n=ge(e,t,r.bytes);return new le(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return le.create(0,ye,e)}static createV1(e,t){return le.create(1,e,t)}static decode(e){const[t,r]=le.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=le.inspectBytes(e),r=t.size-t.multihashSize,n=_(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new ae(t.multihashCode,t.digestSize,i,n);return[0===t.version?le.createV0(s):le.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=re(e.subarray(t));return t+=n,r};let n=r(),i=ye;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=fe(e,t),i=le.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return he(i).set(r,e),i}}const fe=(e,t)=>{switch(e[0]){case"Q":{const r=t||U;return[U.prefix,r.decode(`${U.prefix}${e}`)]}case U.prefix:{const r=t||U;return[U.prefix,r.decode(e)]}case L.prefix:{const r=t||L;return[L.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},de=(e,t,r)=>{const{prefix:n}=r;if(n!==U.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},pe=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},ye=112,me=18,ge=(e,t,r)=>{const n=ie(e),i=n+ie(t),s=new Uint8Array(i+r.byteLength);return ne(e,s,0),ne(t,s,n),s.set(r,i),s},be=Symbol.for("@ipld/js-cid/CID"),we=({name:e,code:t,encode:r})=>new ve(e,t,r);class ve{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?se(this.code,t):t.then((e=>se(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Ee=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),_e=we({name:"sha2-256",code:18,encode:Ee("SHA-256")}),xe=(we({name:"sha2-512",code:19,encode:Ee("SHA-512")}),async(e,t,r)=>{null==r.codec&&(r.codec=d);const n=await _e.digest(e),i=le.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,r),i});function ke(e){return async function*(t,r){let i=0n;for await(let s of t.content)yield async()=>{let o;const a={codec:d,cidVersion:e.cidVersion,onProgress:e.onProgress};e.rawLeaves?(a.codec=n,a.cidVersion=1):(o=new w({type:e.leafType,data:s}),s=d.encode({Data:o.marshal(),Links:[]}));const c=await xe(s,r,a);return i+=BigInt(s.byteLength),e.onProgress?.(new I.V("unixfs:importer:progress:file:write",{bytesWritten:i,cid:c,path:t.path})),{cid:c,unixfs:o,size:BigInt(s.length),block:s}}}}const Se=async(e,t,r)=>{const n=new w({type:"directory",mtime:e.mtime,mode:e.mode}),i=(0,d.encode)((0,d.prepare)({Data:n.marshal()}));return{cid:await xe(i,t,r),path:e.path,unixfs:n,size:BigInt(i.length),originalPath:e.originalPath,block:i}};function Ae(e){return!0===e.single}const Ie=async(e,t,r)=>r.layout(async function*(e,t,r){let n,i=-1;for await(const s of a(r.bufferImporter(e,t),r.blockWriteConcurrency))i++,0!==i?(1===i&&null!=n&&(yield{...n,block:void 0,single:void 0},n=void 0),yield{...s,block:void 0}):n={...s,single:!0};null!=n&&(yield n)}(e,t,r),((e,t,r)=>async function(n){if(1===n.length&&Ae(n[0])&&r.reduceSingleLeafToSelf){const i=n[0];let s=i.block;return!Ae(i)||void 0===e.mtime&&void 0===e.mode||(i.unixfs=new w({type:"file",mtime:e.mtime,mode:e.mode,data:i.block}),s={Data:i.unixfs.marshal(),Links:[]},i.block=(0,d.encode)((0,d.prepare)(s)),i.cid=await xe(i.block,t,{...r,cidVersion:r.cidVersion}),i.size=BigInt(i.block.length)),r.onProgress?.(new I.V("unixfs:importer:progress:file:layout",{cid:i.cid,path:i.originalPath})),{cid:i.cid,path:e.path,unixfs:i.unixfs,size:i.size,originalPath:i.originalPath}}const i=new w({type:"file",mtime:e.mtime,mode:e.mode}),s=n.filter((e=>e.cid.code===k&&e.size>0||null!=e.unixfs&&null==e.unixfs.data&&e.unixfs.fileSize()>0n||Boolean(e.unixfs?.data?.length))).map((e=>e.cid.code===k?(i.addBlockSize(e.size),{Name:"",Tsize:Number(e.size),Hash:e.cid}):(null==e.unixfs||null==e.unixfs.data?i.addBlockSize(e.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(e.unixfs.data.length)),{Name:"",Tsize:Number(e.size),Hash:e.cid}))),o={Data:i.marshal(),Links:s},a=(0,d.encode)((0,d.prepare)(o)),c=await xe(a,t,r);return r.onProgress?.(new I.V("unixfs:importer:progress:file:layout",{cid:c,path:e.originalPath})),{cid:c,path:e.path,unixfs:i,size:BigInt(a.length+o.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),originalPath:e.originalPath,block:a}})(e,t,r));function Te(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(t=e,Symbol.iterator in t)return async function*(){yield*e}();if(function(e){return Symbol.asyncIterator in e}(e))return e}catch{throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}var t;throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function Pe(e){return null!=e.content}var Ce=r(77408);const De=()=>async function*(e){for await(const t of e){if(void 0===t.length)throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"==typeof t||t instanceof String)yield(0,Ce.m)(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw i(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}},Re=174;function Oe(e){const t=e?.maxChildrenPerNode??Re;return async function e(r,n){const i=[];for await(const e of o(r,t))i.push(await n(e));return i.length>1?e(i,n):i[0]}}class Ne{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}const Be=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Me=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class Le extends Ne{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(void 0!==this.nodeSize)return this.nodeSize;this.nodeSize=0;for(const[e,t]of this._children.entries())null!=t.size&&null!=t.cid&&(this.nodeSize+=e.length+(1===this.options.cidVersion?Me.bytes.byteLength:Be.bytes.byteLength));return this.nodeSize}async*flush(e){const t=[];for(const[r,n]of this._children.entries()){let i=n;if(n instanceof Ne)for await(const t of n.flush(e))i=t,yield t;null!=i.size&&null!=i.cid&&t.push({Name:r,Tsize:Number(i.size),Hash:i.cid})}const r=new w({type:"directory",mtime:this.mtime,mode:this.mode}),n={Data:r.marshal(),Links:t},i=(0,d.encode)((0,d.prepare)(n)),s=await xe(i,e,this.options),o=i.length+n.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=s,this.size=o,yield{cid:s,unixfs:r,path:this.path,size:BigInt(o)}}}const Ue=new Uint8Array(0),je=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):Ue};var Fe=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=$e;)r[n++]=255&t|Ke,t/=128;for(;t&ze;)r[n++]=255&t|Ke,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Ke=128,ze=-128,$e=Math.pow(2,31);var Ve=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&We)<<s:(n&We)*Math.pow(2,s),s+=7}while(n>=qe);return e.bytes=o-r,i},qe=128,We=127;var He=Math.pow(2,7),Ge=Math.pow(2,14),Ye=Math.pow(2,21),Je=Math.pow(2,28),Xe=Math.pow(2,35),Qe=Math.pow(2,42),Ze=Math.pow(2,49),et=Math.pow(2,56),tt=Math.pow(2,63),rt={encode:Fe,decode:Ve,encodingLength:function(e){return e<He?1:e<Ge?2:e<Ye?3:e<Je?4:e<Xe?5:e<Qe?6:e<Ze?7:e<et?8:e<tt?9:10}};const nt=(e,t,r=0)=>(rt.encode(e,t,r),t),it=e=>rt.encodingLength(e),st=(e,t)=>{const r=t.byteLength,n=it(e),i=n+it(r),s=new Uint8Array(i+r);return nt(e,s,0),nt(r,s,n),s.set(t,i),new ot(e,r,t,s)};class ot{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const at=({name:e,code:t,encode:r})=>new ct(e,t,r);class ct{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?st(this.code,t):t.then((e=>st(this.code,e)))}throw Error("Unknown type, must be binary type")}}var ut=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class ht{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class lt{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return dt(this,e)}}class ft{constructor(e){this.decoders=e}or(e){return dt(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const dt=(e,t)=>new ft({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class pt{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new ht(e,t,r),this.decoder=new lt(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const yt=({name:e,prefix:t,encode:r,decode:n})=>new pt(e,t,r,n),mt=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=ut(r,t);return yt({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},gt=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>yt({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)});mt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),gt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),gt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),gt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),gt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),gt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),gt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),new WeakMap;class bt{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return bt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return bt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return bt.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return cid_format(this,e)}toJSON(){return{"/":cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof bt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new bt(e,r,n,i||cid_encodeCID(e,r,n.bytes))}if(!0===t[cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return bt.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new bt(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new bt(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return bt.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return bt.create(1,e,t)}static decode(e){const[t,r]=bt.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=bt.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?bt.createV0(s):bt.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),i=bt.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");var wt=r(40469);at({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const vt=at({name:"murmur3-128",code:34,encode:e=>je(wt.x64.hash128(e))});at({name:"murmur3-x64-64",code:34,encode:e=>je(wt.x64.hash128(e)).subarray(0,8)});var Et=r(96991);async function _t(e){return(await vt.encode(e)).slice(0,8).reverse()}const xt=BigInt(34);var kt=class extends Ne{_bucket;constructor(e,t){super(e,t),this._bucket=(0,Et.$)({hashFn:_t,bits:t.shardFanoutBits??8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=At(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of St(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*St(e,t,r,n){const i=e._children,s=(e.tableSize()-1).toString(16).length,o=[];let a=0n;for(let e=0;e<i.length;e++){const r=i.get(e);if(null==r)continue;const c=e.toString(16).toUpperCase().padStart(s,"0");if(r instanceof Et.r){let e;for await(const i of St(r,t,null,n))e=i;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:c,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;if(null==n)throw new Error("Did not flush dir");const i=c+r.key;o.push({Name:i,Tsize:Number(n.size),Hash:n.cid}),a+=n.size}else{const e=r.value;if(null==e.cid)continue;const t=c+r.key,n=e.size;o.push({Name:t,Tsize:Number(n),Hash:e.cid}),a+=BigInt(n??0)}}const c=Uint8Array.from(i.bitField().reverse()),u=new w({type:"hamt-sharded-directory",data:c,fanout:BigInt(e.tableSize()),hashType:xt,mtime:r?.mtime,mode:r?.mode}),h={Data:u.marshal(),Links:o},l=(0,d.encode)((0,d.prepare)(h)),f=await xe(l,t,n),p=BigInt(l.byteLength)+a;yield{cid:f,unixfs:u,size:p}}function At(e,t,r){const n=e._children,i=(e.tableSize()-1).toString(16).length,s=[];for(let e=0;e<n.length;e++){const t=n.get(e);if(null==t)continue;const o=e.toString(16).toUpperCase().padStart(i,"0");if(t instanceof Et.r){const e=At(t,null,r);s.push({Name:o,Tsize:Number(e),Hash:0===r.cidVersion?Be:Me})}else if("function"==typeof t.value.flush){const e=t.value.nodeSize();s.push({Name:o+t.key,Tsize:Number(e),Hash:0===r.cidVersion?Be:Me})}else{const e=t.value;if(null==e.cid)continue;const r=o+t.key,n=e.size;s.push({Name:r,Tsize:Number(n),Hash:e.cid})}}const o=Uint8Array.from(n.bitField().reverse()),a=new w({type:"hamt-sharded-directory",data:o,fanout:BigInt(e.tableSize()),hashType:xt,mtime:t?.mtime,mode:t?.mode});return(0,d.encode)((0,d.prepare)({Data:a.marshal(),Links:s})).length}async function It(e,t,r,n){let i=t;t instanceof Le&&t.estimateNodeSize()>r&&(i=await async function(e,t){const r=new kt({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(const{key:t,child:n}of e.eachChildSeries())await r.put(t,n);return r}(t,n));const s=i.parent;if(null!=s){if(i!==t){if(null!=e&&(e.parent=i),null==i.parentKey)throw new Error("No parent key found");await s.put(i.parentKey,i)}return It(i,s,r,n)}return i}const Tt=(e="")=>e.split(/(?<!\\)\//).filter(Boolean);async function Pt(e,t,r){const n=Tt(e.path??""),i=n.length-1;let s=t,o="";for(let a=0;a<n.length;a++){const c=n[a];o+=`${""!==o?"/":""}${c}`;const u=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,u)await s.put(c,e),t=await It(null,s,r.shardSplitThresholdBytes,r);else{let e=await s.get(c);null!=e&&e instanceof Ne||(e=new Le({root:!1,dir:!0,parent:s,parentKey:c,path:o,dirty:!0,flat:!0,mtime:e?.unixfs?.mtime,mode:e?.unixfs?.mode},r)),await s.put(c,e),s=e}}return t}async function*Ct(e,t){e instanceof Ne?yield*e.flush(t):!0===e.unixfs?.isDirectory()&&(yield e)}async function*Dt(e,t,r={}){let n;n=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];const i=r.wrapWithDirectory??!1,s=r.shardSplitThresholdBytes??262144,o=r.shardFanoutBits??8,c=r.cidVersion??1,h=r.rawLeaves??!0,l=r.leafType??"file",f=r.fileImportConcurrency??50,d=r.blockWriteConcurrency??10,p=r.reduceSingleLeafToSelf??!0,y=r.chunker??u(),m=r.chunkValidator??De(),g=r.dagBuilder??function(e){return async function*(t,r){for await(const n of t){let t;if(null!=n.path&&(t=n.path,n.path=n.path.split("/").filter((e=>null!=e&&"."!==e)).join("/")),Pe(n)){const i={path:n.path,mtime:n.mtime,mode:n.mode,content:async function*(){let t=0n;for await(const r of e.chunker(e.chunkValidator(Te(n.content)))){const i=BigInt(r.byteLength);t+=i,e.onProgress?.(new I.V("unixfs:importer:progress:file:read",{bytesRead:t,chunkSize:i,path:n.path})),yield r}}(),originalPath:t};yield async()=>Ie(i,r,e)}else{if(null==n.path)throw new Error("Import candidate must have content or path or both");{const i={path:n.path,mtime:n.mtime,mode:n.mode,originalPath:t};yield async()=>Se(i,r,e)}}}}}({chunker:y,chunkValidator:m,wrapWithDirectory:i,layout:r.layout??Oe(),bufferImporter:r.bufferImporter??ke({cidVersion:c,rawLeaves:h,leafType:l,onProgress:r.onProgress}),blockWriteConcurrency:d,reduceSingleLeafToSelf:p,cidVersion:c,onProgress:r.onProgress}),b=r.treeBuilder??function(e){return async function*(t,r){let n,i=new Le({root:!0,dir:!0,path:"",dirty:!0,flat:!0},e),s=!1;for await(const r of t){if(null==r)continue;const t=`${r.originalPath??""}`.split("/")[0];null!=t&&""!==t&&(null==n?(n=t,s=!0):n!==t&&(s=!1)),i=await Pt(r,i,e),null!=r.unixfs&&r.unixfs.isDirectory()||(yield r)}if(e.wrapWithDirectory||s&&i.childCount()>1)yield*Ct(i,r);else for await(const e of i.eachChildSeries())null!=e&&(yield*Ct(e.child,r))}}({wrapWithDirectory:i,shardSplitThresholdBytes:s,shardFanoutBits:o,cidVersion:c,onProgress:r.onProgress});for await(const e of b(a(g(n,t),f),t))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}async function Rt(e,t,r={}){const n=await s(Dt([e],t,r));if(null==n)throw i(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return n}r(63060);const Ot={cidVersion:1,rawLeaves:!0,layout:Oe({maxChildrenPerNode:1024}),chunker:u({chunkSize:1048576})};async function Nt(e,t,r={}){const{cid:n}=await async function(e,t,r={}){return Rt({content:e},t,r)}(e,t,{...Ot,...r});return n}async function Bt(e,t,r={}){const{cid:n}=await async function(e,t,r={}){return Rt({content:e},t,r)}(e,t,{...Ot,...r});return n}async function Mt(e,t,r={}){const{cid:n}=await async function(e,t,r={}){const n=await s(Dt([e],t,r));if(null==n)throw i(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return n}({...e,path:e.path??"-"},t,{...Ot,...r});return n}var Lt=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t;for await(const r of e)t=r;return t})();let t;for(const r of e)t=r;return t},Ut=r(90560);const jt=0;var Ft=async(e,t,r,n,s,o,a,c)=>{const u=await a.get(e,c),h=Ut.decode(u);let l=h,f=r;for(;n.length>0;){const s=n[0];if(!(s in l))throw i(new Error(`No property named ${s} found in cbor node ${e}`),"ERR_NO_PROP");{n.shift(),f=`${f}/${s}`;const i=le.asCID(l[s]);if(null!=i)return{entry:{type:"object",name:t,path:r,cid:e,node:u,depth:o,size:BigInt(u.length),content:async function*(){yield h}},next:{cid:i,name:s,path:f,toResolve:n}};l=l[s]}}return{entry:{type:"object",name:t,path:r,cid:e,node:u,depth:o,size:BigInt(u.length),content:async function*(){yield h}}}};var Kt=function(e,t,r,n){const i=BigInt(e.length),s=BigInt(t+i);return r>=s||n<t?new Uint8Array(0):(n>=t&&n<s&&(e=e.subarray(0,Number(n-t))),r>=t&&r<s&&(e=e.subarray(Number(r-t))),e)};var zt=(e,t=0,r=e)=>{const n=BigInt(e),s=BigInt(t??0);let o=BigInt(r);if(o!==n&&(o=s+o),o>n&&(o=n),s<0n)throw i(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(s>n)throw i(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(o<0n)throw i(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(o>n)throw i(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:s,end:o}};var $t=async(e,t,r,n,s,o,a,c)=>{if(n.length>0)throw i(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const u=oe(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:(h=u.digest,async function*(e={}){const{start:t,end:r}=zt(h.length,e.offset,e.length),n=Kt(h,0n,t,r);e.onProgress?.(new I.V("unixfs:exporter:progress:identity",{bytesRead:BigInt(n.byteLength),totalBytes:r-t,fileSize:BigInt(h.byteLength)})),yield n}),depth:o,size:BigInt(u.digest.length),node:u.digest}};var h};var Vt=async(e,t,r,n,s,o,a,c)=>{if(n.length>0)throw i(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const u=await a.get(e,c);return{entry:{type:"raw",name:t,path:r,cid:e,content:(h=u,async function*(e={}){const{start:t,end:r}=zt(h.length,e.offset,e.length),n=Kt(h,0n,t,r);e.onProgress?.(new I.V("unixfs:exporter:progress:raw",{bytesRead:BigInt(n.byteLength),totalBytes:r-t,fileSize:BigInt(h.byteLength)})),yield n}),depth:o,size:BigInt(u.length),node:u}};var h};const qt=new Uint8Array(0),Wt=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):qt};var Ht=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Jt;)r[n++]=255&t|Gt,t/=128;for(;t&Yt;)r[n++]=255&t|Gt,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Gt=128,Yt=-128,Jt=Math.pow(2,31);var Xt=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Zt)<<s:(n&Zt)*Math.pow(2,s),s+=7}while(n>=Qt);return e.bytes=o-r,i},Qt=128,Zt=127;var er=Math.pow(2,7),tr=Math.pow(2,14),rr=Math.pow(2,21),nr=Math.pow(2,28),ir=Math.pow(2,35),sr=Math.pow(2,42),or=Math.pow(2,49),ar=Math.pow(2,56),cr=Math.pow(2,63),ur={encode:Ht,decode:Xt,encodingLength:function(e){return e<er?1:e<tr?2:e<rr?3:e<nr?4:e<ir?5:e<sr?6:e<or?7:e<ar?8:e<cr?9:10}};const hr=(e,t,r=0)=>(ur.encode(e,t,r),t),lr=e=>ur.encodingLength(e),fr=(e,t)=>{const r=t.byteLength,n=lr(e),i=n+lr(r),s=new Uint8Array(i+r);return hr(e,s,0),hr(r,s,n),s.set(t,i),new dr(e,r,t,s)};class dr{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const pr=({name:e,code:t,encode:r})=>new yr(e,t,r);class yr{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?fr(this.code,t):t.then((e=>fr(this.code,e)))}throw Error("Unknown type, must be binary type")}}var mr=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class gr{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class br{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return vr(this,e)}}class wr{constructor(e){this.decoders=e}or(e){return vr(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const vr=(e,t)=>new wr({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Er{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new gr(e,t,r),this.decoder=new br(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const _r=({name:e,prefix:t,encode:r,decode:n})=>new Er(e,t,r,n),xr=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=mr(r,t);return _r({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},kr=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>_r({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)});xr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),xr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),kr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),kr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),kr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),kr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),kr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),new WeakMap;class Sr{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Sr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return Sr.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Sr.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return src_cid_format(this,e)}toJSON(){return{"/":src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Sr)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Sr(e,r,n,i||src_cid_encodeCID(e,r,n.bytes))}if(!0===t[src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return Sr.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new Sr(e,t,r,r.bytes);case 1:{const n=src_cid_encodeCID(e,t,r.bytes);return new Sr(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Sr.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return Sr.create(1,e,t)}static decode(e){const[t,r]=Sr.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Sr.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?Sr.createV0(s):Sr.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=src_cid_parseCIDtoBytes(e,t),i=Sr.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");pr({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const Ar=pr({name:"murmur3-128",code:34,encode:e=>Wt(wt.x64.hash128(e))}),Ir=(pr({name:"murmur3-x64-64",code:34,encode:e=>Wt(wt.x64.hash128(e)).subarray(0,8)}),async function(e){return(await Ar.encode(e)).slice(0,8).reverse()}),Tr=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),Pr=async(e,t,r,n,s)=>{if(null==n){if(null==e.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let t;try{t=w.unmarshal(e.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if("hamt-sharded-directory"!==t.type)throw i(new Error("not a HAMT"),"ERR_NOT_UNIXFS");if(null==t.fanout)throw i(new Error("missing fanout"),"ERR_NOT_UNIXFS");const r=(0,Et.$)({hashFn:Ir,bits:Math.log2(Number(t.fanout))});n={rootBucket:r,hamtDepth:1,lastBucket:r}}const o=(n.lastBucket.tableSize()-1).toString(16).length;await(async(e,t,r)=>{const n=(t.tableSize()-1).toString(16).length;await Promise.all(e.map((async e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(e.Name.length!==n)await r.put(e.Name.substring(2),!0);else{const n=parseInt(e.Name,16);t._putObjectAt(n,new Et.r({hash:r._options.hash,bits:r._options.bits},t,n))}})))})(e.Links,n.lastBucket,n.rootBucket);const a=await n.rootBucket._findNewBucketAndPos(t);let c=Tr(a.pos,o);const u=(e=>{let t=e.bucket;const r=[];for(;null!=t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()})(a);u.length>n.hamtDepth&&(n.lastBucket=u[n.hamtDepth],c=Tr(n.lastBucket._posAtParent,o));const h=e.Links.find((e=>{if(null==e.Name)return!1;const r=e.Name.substring(0,o),n=e.Name.substring(o);return r===c&&(""===n||n===t)}));if(null==h)return;if(null!=h.Name&&h.Name.substring(o)===t)return h.Hash;n.hamtDepth++;const l=await r.get(h.Hash,s);return e=(0,d.decode)(l),Pr(e,t,r,n,s)};var Cr=Pr,Dr=r(75671);var Rr=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,Dr.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){await s&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===s&&(yield n);for(const e of r)o(e)&&(yield e)}()};var Or=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)yield t(r)}();const r=(0,Dr.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){yield await s;for await(const e of r)yield t(e)}();const o=t;return function*(){yield s;for(const e of r)yield o(e)}()},Nr=r(69849),Br=r(32629);var Mr=(e,t,r,n,i,s,o)=>async function*(r={}){const a=r.offset??0,c=r.length??t.Links.length,u=t.Links.slice(a,c);r.onProgress?.(new I.V("unixfs:exporter:walk:directory",{cid:e})),yield*(0,Br.z)(u,(e=>Or(e,(e=>async()=>{const t=e.Name??"",a=`${n}/${t}`;return(await i(e.Hash,t,a,[],s+1,o,r)).entry}))),(e=>(0,Nr.Z)(e,{ordered:!0})),(e=>Rr(e,(e=>null!=e))))},Lr=r(37430),Ur=r(28364);async function jr(e,t,r,n,s,o,a){if(t instanceof Uint8Array){const e=Kt(t,n,s,o);return void r.push(e)}if(null==t.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=w.unmarshal(t.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if(null!=c.data){const e=c.data,t=Kt(e,n,s,o);r.push(t),n+=BigInt(t.byteLength)}const u=[];if(t.Links.length!==c.blockSizes.length)throw i(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let e=0;e<t.Links.length;e++){const r=t.Links[e],i=n,a=i+c.blockSizes[e];if((s>=i&&s<a||o>=i&&o<=a||s<i&&o>a)&&u.push({link:r,blockStart:n}),(n=a)>o)break}await(0,Br.z)(u,(t=>Or(t,(t=>async()=>{const r=await e.get(t.link.Hash,a);return{...t,block:r}}))),(e=>(0,Nr.Z)(e,{ordered:!0})),(async t=>{for await(const{link:n,block:c,blockStart:u}of t){let t;switch(n.Hash.code){case d.code:t=d.decode(c);break;case k:t=c;break;default:return void r.end(i(new Error(`Unsupported codec: ${n.Hash.code}`),"ERR_NOT_UNIXFS"))}const h=new Ur.Z({concurrency:1});h.on("error",(e=>{r.end(e)})),h.add((async()=>{a.onProgress?.(new I.V("unixfs:exporter:walk:file",{cid:n.Hash})),await jr(e,t,r,u,s,o,a)})),await h.onIdle()}})),n>=o&&r.end()}var Fr=(e,t,r,n,s,o,a)=>async function*(n={}){const s=r.fileSize();if(void 0===s)throw new Error("File was a directory");const{start:o,end:c}=zt(s,n.offset,n.length);if(0n===c)return;let u=0n;const h=c-o,l=(0,Lr.d)();n.onProgress?.(new I.V("unixfs:exporter:walk:file",{cid:e})),jr(a,t,l,0n,o,c,n).catch((e=>{l.end(e)}));for await(const e of l)if(null!=e){if(u+=BigInt(e.byteLength),u>h)throw l.end(),i(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");u===h&&l.end(),n.onProgress?.(new I.V("unixfs:exporter:progress:unixfs:file",{bytesRead:u,totalBytes:h,fileSize:s})),yield e}if(u<h)throw i(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")};async function*Kr(e,t,r,n,s,o){const a=e.Links;if(null==e.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=w.unmarshal(e.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if(null==c.fanout)throw i(new Error("missing fanout"),"ERR_NOT_UNIXFS");const u=(c.fanout-1n).toString(16).length,h=(0,Br.z)(a,(i=>Or(i,(i=>async()=>{const a=null!=i.Name?i.Name.substring(u):null;if(null!=a&&""!==a){const e=await r(i.Hash,a,`${t}/${a}`,[],n+1,s,o);return{entries:null==e.entry?[]:[e.entry]}}{const a=await s.get(i.Hash,o);return e=(0,d.decode)(a),o.onProgress?.(new I.V("unixfs:exporter:walk:hamt-sharded-directory",{cid:i.Hash})),{entries:Kr(e,t,r,n,s,o)}}}))),(e=>(0,Nr.Z)(e,{ordered:!0})));for await(const{entries:e}of h)yield*e}var zr=(e,t,r,n,i,s,o)=>function(r={}){return r.onProgress?.(new I.V("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),Kr(t,n,i,s,o,r)};const $r={raw:Fr,file:Fr,directory:Mr,"hamt-sharded-directory":zr,metadata:(e,t,r,n,i,s,o)=>()=>[],symlink:(e,t,r,n,i,s,o)=>()=>[]};var Vr=async(e,t,r,n,s,o,a,c)=>{const u=await a.get(e,c),h=(0,d.decode)(u);let l,f;if(null==t&&(t=e.toString()),null==h.Data)throw i(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=w.unmarshal(h.Data)}catch(e){throw i(e,"ERR_NOT_UNIXFS")}if(null==r&&(r=t),n.length>0){let e;if(e="hamt-sharded-directory"===l?.type?await Cr(h,n[0],a):((e,t)=>{const r=e.Links.find((e=>e.Name===t));return r?.Hash})(h,n[0]),null==e)throw i(new Error("file does not exist"),"ERR_NOT_FOUND");const t=n.shift();f={cid:e,toResolve:n,name:t??"",path:`${r}/${t}`}}const p=$r[l.type](e,h,l,r,s,o,a);if(null==p)throw i(new Error("could not find content exporter"),"ERR_NOT_FOUND");return l.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:p,unixfs:l,depth:o,node:h,size:l.fileSize()},next:f}:{entry:{type:"file",name:t,path:r,cid:e,content:p,unixfs:l,depth:o,node:h,size:l.fileSize()},next:f}};const qr={[d.code]:Vr,[k]:Vt,[Ut.code]:Ft,[jt]:$t},Wr=async(e,t,r,n,s,o,a)=>{const c=qr[e.code];if(null==c)throw i(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return c(e,t,r,n,Wr,s,o,a)};var Hr=Wr;const Gr=e=>{if(e instanceof Uint8Array)return{cid:le.decode(e),toResolve:[]};const t=le.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=((e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean))(e);return{cid:le.parse(t[0]),toResolve:t.slice(1)}}throw i(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function Yr(e,t,r={}){const n=await Lt(async function*(e,t,r={}){let{cid:n,toResolve:s}=Gr(e),o=n.toString(),a=o;const c=s.length;for(;;){const u=await Hr(n,o,a,s,c,t,r);if(null==u.entry&&null==u.next)throw i(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(null!=u.entry&&(yield u.entry),null==u.next)return;s=u.next.toResolve,n=u.next.cid,o=u.next.name,a=u.next.path}}(e,t,r));if(null==n)throw i(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}async function*Jr(e,t,r={}){const n=await Yr(e,t,r);if(null!=n&&(yield n,"directory"===n.type))for await(const e of async function*e(t,r){for await(const n of t.content(r))yield n,n instanceof Uint8Array||"directory"===n.type&&(yield*e(n,r))}(n,r))yield e}var Xr=r(79221);class Qr extends Error{name;code;constructor(e,t,r){super(e),this.name=t,this.code=r}}class Zr extends Qr{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}}class en extends Qr{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PBNODE")}}class tn extends Qr{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class rn extends Qr{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}}class nn extends Qr{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}class sn extends Qr{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}}class on extends Qr{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}}class an extends Qr{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}}class cn extends Qr{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}}var un=r(11227);const hn=M({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});M({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),M({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),M({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function ln(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return un.enabled(`${e}:trace`)&&null!=un.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=un(`${e}:trace`)),Object.assign(un(e),{error:un(`${e}:error`),trace:t})}un.formatters.b=e=>null==e?"undefined":U.baseEncode(e),un.formatters.t=e=>null==e?"undefined":L.baseEncode(e),un.formatters.m=e=>null==e?"undefined":hn.baseEncode(e),un.formatters.p=e=>null==e?"undefined":e.toString(),un.formatters.c=e=>null==e?"undefined":e.toString(),un.formatters.k=e=>null==e?"undefined":e.toString(),un.formatters.a=e=>null==e?"undefined":e.toString();var fn=r(20544),dn=r(41690);function pn(e){return function(t){return t instanceof yn?t:new yn(t,e)}}class yn{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?(0,dn.z)([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new bn(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}const mn=[255,254,252,248,240,224,192,128],gn=[1,3,7,15,31,63,127,255];class bn{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t);r=(r<<i)+wn(e,n-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function wn(e,t,r){const n=function(e,t){return mn[e]&gn[Math.min(t+e-1,7)]}(t,r);return(e&n)>>>t}we({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const vn=we({name:"murmur3-128",code:34,encode:e=>E(wt.x64.hash128(e))}),En=(we({name:"murmur3-x64-64",code:34,encode:e=>E(wt.x64.hash128(e)).subarray(0,8)}),BigInt(vn.code));async function _n(e){return(await vn.encode(e)).subarray(0,8).reverse()}const xn=async(e,t,r)=>{null==r.codec&&(r.codec=d);const n=await _e.digest(e),i=le.create(r.cidVersion,r.codec.code,n);return await t.put(i,e,{...r,signal:r.signal}),i};class kn{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}class Sn extends kn{_bucket;constructor(e,t){super(e,t),this._bucket=(0,Et.$)({hashFn:_n,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=In(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of An(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*An(e,t,r,n){const i=e._children,s=[];let o=0n;for(let e=0;e<i.length;e++){const r=i.get(e);if(null==r)continue;const a=e.toString(16).toUpperCase().padStart(2,"0");if(r instanceof Et.r){let e;for await(const i of An(r,t,null,n))e=i;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:a,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;if(null==n)throw new Error("Did not flush dir");const i=a+r.key;s.push({Name:i,Tsize:Number(n.size),Hash:n.cid}),o+=n.size}else{const e=r.value;if(null==e.cid)continue;const t=a+r.key,n=e.size;s.push({Name:t,Tsize:Number(n),Hash:e.cid}),o+=BigInt(n??0)}}const a=Uint8Array.from(i.bitField().reverse()),c=new w({type:"hamt-sharded-directory",data:a,fanout:BigInt(e.tableSize()),hashType:En,mtime:r?.mtime,mode:r?.mode}),u={Data:c.marshal(),Links:s},h=(0,d.encode)((0,d.prepare)(u)),l=await xn(h,t,n),f=BigInt(h.byteLength)+o;yield{cid:l,unixfs:c,size:f}}function In(e,t,r){const n=e._children,i=[];for(let e=0;e<n.length;e++){const t=n.get(e);if(null==t)continue;const s=e.toString(16).toUpperCase().padStart(2,"0");if(t instanceof Et.r){const e=In(t,null,r);i.push({Name:s,Tsize:Number(e),Hash:0===r.cidVersion?Tn:Pn})}else if("function"==typeof t.value.flush){const e=t.value.nodeSize();i.push({Name:s+t.key,Tsize:Number(e),Hash:0===r.cidVersion?Tn:Pn})}else{const e=t.value;if(null==e.cid)continue;const r=s+t.key,n=e.size;i.push({Name:r,Tsize:Number(n),Hash:e.cid})}}const s=Uint8Array.from(n.bitField().reverse()),o=new w({type:"hamt-sharded-directory",data:s,fanout:BigInt(e.tableSize()),hashType:En,mtime:t?.mtime,mode:t?.mode});return(0,d.encode)((0,d.prepare)({Data:o.marshal(),Links:i})).length}const Tn=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Pn=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),Cn=ln("helia:unixfs:commands:utils:hamt-utils"),Dn=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Rn=async(e,t,r)=>{const n=w.unmarshal(e[0].node.Data??new Uint8Array(0)),i=BigInt(Math.pow(2,8));let s,o;e.reverse();for(let a=0;a<e.length;a++){const c=a===e.length-1,u=e[a],h=Uint8Array.from(u.children.bitField().reverse()),l=new w({type:"hamt-sharded-directory",data:h,fanout:i,hashType:En});c&&(l.mtime=n.mtime,l.mode=n.mode),o={Data:l.marshal(),Links:u.node.Links};const f=d.encode(d.prepare(o));if(s=await xn(f,t,r),!c){const t=e[a+1];if(null==t)throw new Error("Was not operating on shard root but also had no parent?");Cn("updating link in parent sub-shard with prefix %s",t.prefix),t.node.Links=t.node.Links.filter((e=>e.Name!==t.prefix)),t.node.Links.push({Name:t.prefix,Hash:s,Tsize:u.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),f.byteLength)})}}if(null==s||null==o)throw new Error("Noting persisted");return{cid:s,node:o}},On=async(e,t,r,n)=>{const i=pn(_n)((0,Ce.m)(t)),s=[];for(;;){const o=await r.get(e,n),a=d.decode(o),c=new fn,u=await i.take(8),h=Dn(u);let l;s.push({prefix:h,children:c,node:a});for(const e of a.Links){const t=e.Name??"";if(t.length<2)throw new Error("Invalid HAMT - link name was too short");const r=parseInt(t.substring(0,2),16);c.set(r,!0),t.startsWith(h)&&(l=e)}if(null==l){Cn("no link found with prefix %s for %s",h,t);break}const f=l.Name??"";if(f.length<2)throw new Error("Invalid HAMT - link name was too short");if(2!==f.length)break;e=l.Hash,Cn("descend into sub-shard with prefix %s",f)}return{path:s,hash:i}};async function Nn(e,t,r,n){if(null==e.Data)throw new Error("DagPB node had no data");const i=w.unmarshal(e.Data);let s;if("directory"===i.type)s=function(e){let t=0;for(const r of e.Links)t+=(r.Name??"").length,t+=1===r.Hash.version?Pn.bytes.byteLength:Tn.bytes.byteLength;return t}(e);else{if("hamt-sharded-directory"!==i.type)throw new Error("Can only estimate the size of directories or shards");s=await Bn(e,0,r,t,n)}return s>r}async function Bn(e,t,r,n,i){if(t>r)return r;if(null==e.Data)return t;if(!w.unmarshal(e.Data).isDirectory())return t;for(const s of e.Links){let e=s.Name??"";if(e=e.substring(2),t+=e.length,t+=s.Hash.bytes.byteLength,s.Hash.code===d.code){const e=await n.get(s.Hash,i),o=d.decode(e);t+=await Bn(o,t,r,n,i)}}return t}const Mn=ln("helia:unixfs:components:utils:add-link");async function Ln(e,t,r,n){if(null==e.node.Data)throw new cn("Invalid parent passed to addLink");if("hamt-sharded-directory"===w.unmarshal(e.node.Data).type)return Mn("adding link to sharded directory"),Fn(e,t,r,n);Mn(`adding ${t.Name} (${t.Hash}) to regular directory`);const i=await jn(e,t,r,n);if(await Nn(i.node,r,n.shardSplitThresholdBytes,n)){Mn("converting directory to sharded directory");const e=await Un(i,r);i.cid=e.cid,i.node=d.decode(await r.get(e.cid,n))}return i}const Un=async(e,t)=>{if(null==e.node.Data)throw new cn("Invalid parent passed to convertToShardedDirectory");const r=w.unmarshal(e.node.Data),n=await(async(e,t,r)=>{const n=new Sn({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:r.mtime,mode:r.mode},r);for(let e=0;e<t.length;e++)await n._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});const i=await Lt(n.flush(e));if(null==i)throw new Error("Flushing shard yielded no result");return i})(t,e.node.Links.map((e=>({name:e.Name??"",size:BigInt(e.Tsize??0),cid:e.Hash}))),{mode:r.mode,mtime:r.mtime,cidVersion:e.cid.version});return Mn(`converted directory to sharded directory ${n.cid}`),n},jn=async(e,t,r,n)=>{const i=e.node.Links.filter((e=>{const r=e.Name===t.Name;if(r&&!n.allowOverwriting)throw new rn;return!r}));if(i.push(t),null==e.node.Data)throw new en("Parent node with no data passed to addToDirectory");const s=w.unmarshal(e.node.Data);let o;if(null!=s.mtime){const e=Date.now(),t=Math.floor(e/1e3);s.mtime={secs:BigInt(t),nsecs:1e3*(e-1e3*t)},o=s.marshal()}else o=e.node.Data;e.node=d.prepare({Data:o,Links:i});const a=d.encode(e.node),c=await _e.digest(a),u=le.create(e.cid.version,d.code,c);return await r.put(u,a),{node:e.node,cid:u}},Fn=async(e,t,r,n)=>{const{path:i,hash:s}=await On(e.cid,t.Name,r,n),o=i[i.length-1];if(null==o)throw new Error("Invalid HAMT, could not generate path");const a=o.prefix,c=parseInt(a,16);Mn("next prefix for %s is %s",t.Name,a);const u=`${a}${t.Name}`,h=o.node.Links.find((e=>(e.Name??"").startsWith(a)));if(null!=h)if(Mn("link %s was present in shard",u),h.Name===u){if(!n.allowOverwriting)throw new rn;Mn("overwriting %s in subshard",t.Name),o.node.Links=o.node.Links.filter((e=>e.Name!==u)),o.node.Links.push({Name:u,Hash:t.Hash,Tsize:t.Tsize})}else{if(2===h.Name?.length)throw new Error("Existing link was subshard?!");{Mn("prefix %s already exists, creating new subshard",a);const e=o.node.Links.findIndex((e=>e.Name?.startsWith(a))),r=o.node.Links.splice(e,1)[0],n=(r.Name??"").substring(2),c=pn(_n)((0,Ce.m)(n));for(let e=0;e<i.length;e++)await c.take(8);for(;;){const e=await c.take(8),o=Dn(e);r.Name=`${o}${n}`;const u=await s.take(8),h=Dn(u);if(o===h){const e=new fn;e.set(u,!0),i.push({prefix:h,children:e,node:{Links:[]}});continue}const l=new fn;l.set(u,!0),l.set(e,!0),i.push({prefix:a,children:l,node:{Links:[r,{Name:`${h}${t.Name}`,Hash:t.Hash,Tsize:t.Tsize}]}});break}}}else Mn("link %s was not present in sub-shard",u),t.Name=u,o.node.Links.push(t),o.children.set(c,!0),Mn("adding %s to existing sub-shard",u);return Rn(i,r,n)};async function Kn(e,t,r={}){const n=await Yr(e,t,r);if("directory"!==n.type)throw new an(`${e.toString()} was not a UnixFS directory`);return{cid:e,node:n.node}}async function zn(e,t,r,n){const i=await Yr(e,r,n);if("directory"!==i.type&&"file"!==i.type&&"raw"!==i.type)throw new Zr(`${e.toString()} was not a UnixFS node`);return{Name:t,Tsize:i.node instanceof Uint8Array?i.node.byteLength:$n(i.node),Hash:e}}function $n(e){const t=e.Links.reduce(((e,t)=>e+(t.Tsize??0)),0);return d.encode(e).byteLength+t}const Vn=ln("helia:unixfs:components:utils:resolve");async function qn(e,t,r,n){if(null==t||""===t)return{cid:e};Vn('resolve "%s" under %c',t,e);const i=t.split("/").filter(Boolean),s=[{name:"",cid:e,size:0n}];for(let t=0;t<i.length;t++){const o=i[t],a=await Yr(e,r,n);if(Vn('resolving "%s"',o,a),"file"===a.type){if(t<i.length-1)throw new cn("Path was invalid");e=a.cid}else{if("directory"!==a.type)throw new cn("Could not resolve path");{let t;for await(const e of a.content())if(e.name===o){t=e.cid;break}if(null==t)throw new nn("Could not find path in directory");e=t,s.push({name:o,cid:e,size:a.size})}}}return Vn("resolved %s to %c",t,e),{cid:e,path:t,segments:s}}async function Wn(e,t,r,n){if(null==t.segments||0===t.segments.length)return e;let i=t.segments.pop();if(null==i)throw new Error("Insufficient segments");i.cid=e,t.segments.reverse();for(const s of t.segments){const[t,o]=await Promise.all([Kn(s.cid,r,n),zn(i.cid,i.name,r,n)]);e=(await Ln(t,o,r,{...n,allowOverwriting:!0,cidVersion:e.version})).cid,s.cid=e,i=s}return e}const Hn=Xr.Z.bind({ignoreUndefined:!0}),Gn={};const Yn=262144,Jn=Xr.Z.bind({ignoreUndefined:!0}),Xn=ln("helia:unixfs:chmod"),Qn={recursive:!1,shardSplitThresholdBytes:Yn};const Zn=Xr.Z.bind({ignoreUndefined:!0}),ei=ln("helia:unixfs:cp"),ti={force:!1,shardSplitThresholdBytes:Yn};const ri=Xr.Z.bind({ignoreUndefined:!0}),ni={};const ii=Xr.Z.bind({ignoreUndefined:!0}),si=ln("helia:unixfs:mkdir"),oi={cidVersion:1,force:!1,shardSplitThresholdBytes:Yn};const ai=ln("helia:unixfs:utils:remove-link");const ci=async(e,t,r,n)=>{e.node.Links=e.node.Links.filter((e=>e.Name!==t));const i=d.encode(e.node),s=await xn(i,r,{...n,cidVersion:e.cid.version});return ai(`Updated regular directory ${s}`),{node:e.node,cid:s}},ui=async(e,t,r,n)=>{const{path:i}=await On(e.cid,t,r,n),s=i[i.length-1];if(null==s)throw new Error("Invalid HAMT, could not generate path");const o=s.node.Links.filter((e=>(e.Name??"").substring(2)===t)).map((e=>e.Name)).pop();if(null==o)throw new Error("File not found");const a=o.substring(0,2),c=parseInt(a,16);if(s.node.Links=s.node.Links.filter((e=>e.Name!==o)),s.children.unset(c),1===s.node.Links.length)for(;1!==i.length;){const e=i[i.length-1];if(null==e||e.node.Links.length>1)break;i.pop();const t=i[i.length-1];if(null==t)break;const r=e.node.Links[0];t.node.Links=t.node.Links.filter((e=>!(e.Name??"").startsWith(t.prefix))),t.node.Links.push({Hash:r.Hash,Name:`${t.prefix}${(r.Name??"").substring(2)}`,Tsize:r.Tsize})}return Rn(i,r,n)},hi=async(e,t,r)=>{if(null==e.node.Data)throw new cn("Invalid parent passed to convertToFlatDirectory");const n={Links:[]},i=await Yr(e.cid,t);if("directory"!==i.type)throw new Error("Unexpected node type");for await(const e of i.content()){let t=0;t=e.node instanceof Uint8Array?e.node.byteLength:d.encode(e.node).length,n.Links.push({Hash:e.cid,Name:e.name,Tsize:t})}const s=w.unmarshal(e.node.Data);n.Data=new w({type:"directory",mode:s.mode,mtime:s.mtime}).marshal();const o=d.encode(d.prepare(n));return{cid:await xn(o,t,{codec:d,cidVersion:e.cid.version,signal:r.signal}),node:n}},li=Xr.Z.bind({ignoreUndefined:!0}),fi=ln("helia:unixfs:rm"),di={shardSplitThresholdBytes:Yn};async function pi(e,t,r,n={}){const i=li(di,n);if(t.includes("/"))throw new cn("Name must not have slashes");const s=await Kn(e,r,i);fi("Removing %s from %c",t,e);const o=await async function(e,t,r,n){if(null==e.node.Data)throw new en("Parent node had no data");if("hamt-sharded-directory"===w.unmarshal(e.node.Data).type){ai(`removing ${t} from sharded directory`);const i=await ui(e,t,r,n);return await Nn(i.node,r,n.shardSplitThresholdBytes,n)?i:(ai("converting shard to flat directory %c",e.cid),hi(i,r,n))}return ai(`removing link ${t} regular directory`),ci(e,t,r,n)}(s,t,r,{...i,cidVersion:e.version});return o.cid}const yi=Xr.Z.bind({ignoreUndefined:!0}),mi=ln("helia:unixfs:stat"),gi={};async function bi(e,t,r={}){const n=yi(gi,r),i=await qn(e,r.path,t,n);mi("stat %c",i.cid);const s=await Yr(i.cid,t,n);if("file"!==s.type&&"directory"!==s.type&&"raw"!==s.type)throw new Zr;let o,a,c=0n,u=0n,h=0n,l=0n,f=0;const d=s.type;let p;if("raw"===s.type&&(c=BigInt(s.node.byteLength),u=BigInt(s.node.byteLength),h=BigInt(s.node.byteLength),l=BigInt(s.node.byteLength),f=1),"directory"===s.type&&(c=0n,u=BigInt(s.unixfs.marshal().byteLength),h=0n,l=u,f=1,o=s.unixfs.mode,a=s.unixfs.mtime,p=s.unixfs),"file"===s.type){const e=await wi(i.cid,t,n);c=s.unixfs.fileSize(),u=BigInt((s.node.Data?.byteLength??0)+s.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),h=BigInt(e.localFileSize),l=BigInt(e.localDagSize),f=e.blocks,o=s.unixfs.mode,a=s.unixfs.mtime,p=s.unixfs}return{cid:i.cid,mode:o,mtime:a,fileSize:c,dagSize:u,localFileSize:h,localDagSize:l,blocks:f,type:d,unixfs:p}}async function wi(e,t,r){const n={localFileSize:0,localDagSize:0,blocks:0};if(await t.has(e,r)){const i=await t.get(e,r);if(n.blocks++,n.localDagSize+=i.byteLength,e.code===k)n.localFileSize+=i.byteLength;else{if(e.code!==d.code)throw new tn(`${e.toString()} was neither DAG_PB nor RAW`);{const s=d.decode(i);if(s.Links.length>0)for(const e of s.Links){const i=await wi(e.Hash,t,r);n.localFileSize+=i.localFileSize,n.localDagSize+=i.localDagSize,n.blocks+=i.blocks}else{if(null==s.Data)throw new en(`PBNode ${e.toString()} had no data`);const t=w.unmarshal(s.Data);if(null==t.data)throw new en(`UnixFS node ${e.toString()} had no data`);n.localFileSize+=t.data.byteLength??0}}}}return n}const vi=Xr.Z.bind({ignoreUndefined:!0}),Ei=ln("helia:unixfs:touch"),_i={recursive:!1,shardSplitThresholdBytes:Yn};r(67064);class xi{components;constructor(e){this.components=e}async*addAll(e,t={}){yield*async function*(e,t,r={}){yield*Dt(e,t,{...Ot,...r})}(e,this.components.blockstore,t)}async addBytes(e,t={}){return Nt(e,this.components.blockstore,t)}async addByteStream(e,t={}){return Bt(e,this.components.blockstore,t)}async addFile(e,t={}){return async function(e,t,r={}){const{cid:n}=await Rt(e,t,{...Ot,...r});return n}(e,this.components.blockstore,t)}async addDirectory(e={},t={}){return Mt(e,this.components.blockstore,t)}async*cat(e,t={}){yield*async function*(e,t,r={}){const n=Hn(Gn,r),i=await qn(e,n.path,t,n),s=await Yr(i.cid,t,n);if("file"!==s.type&&"raw"!==s.type)throw new on;if(null==s.content)throw new sn;yield*s.content(n)}(e,this.components.blockstore,t)}async chmod(e,t,r={}){return async function(e,t,r,n={}){const i=Jn(Qn,n),s=await qn(e,i.path,r,n);if(Xn("chmod %c %d",s.cid,t),i.recursive){const o=await(0,Br.z)((async function*(){for await(const e of Jr(s.cid,r,n)){let r,n=[];if("raw"===e.type)r=new w({type:"file",data:e.node});else{if("file"!==e.type&&"directory"!==e.type)throw new Zr;r=e.unixfs,n=e.node.Links}r.mode=t;const i={Data:r.marshal(),Links:n};yield{path:e.path,content:i}}}),(t=>Dt(t,r,{...i,dagBuilder:async function*(t,r){for await(const n of t)yield async function(){const t=n.content,s=d.encode(t),o=await xn(s,r,{...i,cidVersion:e.version});if(null==t.Data)throw new en(`${o} had no data`);const a=w.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:n.path,unixfs:a}}}})),(async e=>Lt(e)));if(null==o)throw new tn(`Could not chmod ${s.cid.toString()}`);return Wn(o.cid,s,r,i)}const o=await r.get(s.cid,n);let a,c=[];if(s.cid.code===k)a=new w({type:"file",data:o});else{const e=d.decode(o);if(null==e.Data)throw new en(`${s.cid.toString()} had no data`);c=e.Links,a=w.unmarshal(e.Data)}a.mode=t;const u=d.encode({Data:a.marshal(),Links:c}),h=await _e.digest(u),l=le.create(s.cid.version,d.code,h);return await r.put(l,u),Wn(l,s,r,i)}(e,t,this.components.blockstore,r)}async cp(e,t,r,n={}){return async function(e,t,r,n,i={}){const s=Zn(ti,i);if(r.includes("/"))throw new cn("Name must not have slashes");const[o,a]=await Promise.all([Kn(t,n,s),zn(e,r,n,s)]);return ei('Adding %c as "%s" to %c',e,r,t),(await Ln(o,a,n,{allowOverwriting:s.force,cidVersion:t.version,...s})).cid}(e,t,r,this.components.blockstore,n)}async*ls(e,t={}){yield*async function*(e,t,r={}){const n=ri(ni,r),i=await qn(e,n.path,t,n),s=await Yr(i.cid,t);if("file"!==s.type&&"raw"!==s.type){if(null==s.content)throw new sn;if("directory"!==s.type)throw new an;yield*s.content({offset:r.offset,length:r.length})}else yield s}(e,this.components.blockstore,t)}async mkdir(e,t,r={}){return async function(e,t,r,n={}){const i=ii(oi,n);if(t.includes("/"))throw new cn("Path must not have slashes");if("directory"!==(await Yr(e,r,n)).type)throw new an(`${e.toString()} was not a UnixFS directory`);si("creating %s",t);const s={Data:new w({type:"directory",mode:i.mode,mtime:i.mtime}).marshal(),Links:[]},o=d.encode(s),a=await _e.digest(o),c=le.create(i.cidVersion,d.code,a);await r.put(c,o);const[u,h]=await Promise.all([Kn(e,r,i),zn(c,t,r,i)]);return si("adding empty dir called %s to %c",t,e),(await Ln(u,h,r,{...i,allowOverwriting:i.force})).cid}(e,t,this.components.blockstore,r)}async rm(e,t,r={}){return pi(e,t,this.components.blockstore,r)}async stat(e,t={}){return bi(e,this.components.blockstore,t)}async touch(e,t={}){return async function(e,t,r={}){const n=vi(_i,r),i=await qn(e,n.path,t,n),s=n.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(Ei("touch %c %o",i.cid,s),n.recursive){const r=await(0,Br.z)((async function*(){for await(const e of Jr(i.cid,t)){let t,r;if("raw"===e.type)t=new w({data:e.node}),r=[];else{if("file"!==e.type&&"directory"!==e.type)throw new Zr;t=e.unixfs,r=e.node.Links}t.mtime=s;const n={Data:t.marshal(),Links:r};yield{path:e.path,content:n}}}),(r=>Dt(r,t,{...n,dagBuilder:async function*(t,r){for await(const i of t)yield async function(){const t=i.content,s=d.encode(t),o=await xn(s,r,{...n,cidVersion:e.version});if(null==t.Data)throw new en(`${o} had no data`);const a=w.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:i.path,unixfs:a}}}})),(async e=>Lt(e)));if(null==r)throw new tn(`Could not chmod ${i.cid.toString()}`);return Wn(r.cid,i,t,n)}const o=await t.get(i.cid,r);let a,c=[];if(i.cid.code===k)a=new w({data:o});else{const e=d.decode(o);if(c=e.Links,null==e.Data)throw new en(`${i.cid.toString()} had no data`);a=w.unmarshal(e.Data)}a.mtime=s;const u=d.encode({Data:a.marshal(),Links:c}),h=await _e.digest(u),l=le.create(i.cid.version,d.code,h);return await t.put(l,u),Wn(l,i,t,n)}(e,this.components.blockstore,t)}}function ki(e){return new xi(e)}},28391:function(e,t,r){"use strict";r.d(t,{_L:function(){return n},D7:function(){return o},wJ:function(){return i}});class n extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function i(e,t,r){const i=r??{},s=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const o=()=>{null!=r&&r()};for(t.addEventListener("abort",o);;){let a;try{if(t.aborted){const{abortMessage:e,abortCode:t}=i;throw new n(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=i;t(new n(e,r))}}));a=await Promise.race([e,s.next()]),r=null}catch(r){t.removeEventListener("abort",o);const n="aborted"===r.type&&t.aborted;if(n&&null!=i.onAbort&&await i.onAbort(e),"function"==typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=i.onReturnError&&i.onReturnError(e)}))}catch(e){null!=i.onReturnError&&i.onReturnError(e)}if(n&&!0===i.returnOnAbort)return;throw r}if(!0===a.done)break;yield a.value}t.removeEventListener("abort",o)}()}function s(e,t,r){return n=>e(i(n,t,r))}function o(e,t,r){return{sink:s(e.sink,t,{...r,onAbort:void 0}),source:i(e.source,t,r)}}},7688:function(e,t,r){"use strict";function n(e){if(!Array.isArray(e))throw new TypeError("Expected an array, got "+typeof e);for(let t=(e=[...e]).length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}r.d(t,{Z:function(){return n}})},40619:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(53597);function i(e){return"function"==typeof e.stream?(0,n.Z)(e.stream()):(0,n.Z)(new Response(e).body)}},98724:function(e,t,r){"use strict";r.d(t,{Ed:function(){return d},D1:function(){return ue},DA:function(){return se}});var n={};r.r(n),r.d(n,{abortedError:function(){return f},closeFailedError:function(){return o},deleteFailedError:function(){return u},getFailedError:function(){return c},hasFailedError:function(){return h},notFoundError:function(){return l},openFailedError:function(){return s},putFailedError:function(){return a}});var i=r(32114);function s(e){return e=e??new Error("Open failed"),i(e,"ERR_OPEN_FAILED")}function o(e){return e=e??new Error("Close failed"),i(e,"ERR_CLOSE_FAILED")}function a(e){return e=e??new Error("Put failed"),i(e,"ERR_PUT_FAILED")}function c(e){return e=e??new Error("Get failed"),i(e,"ERR_GET_FAILED")}function u(e){return e=e??new Error("Delete failed"),i(e,"ERR_DELETE_FAILED")}function h(e){return e=e??new Error("Has failed"),i(e,"ERR_HAS_FAILED")}function l(e){return e=e??new Error("Not Found"),i(e,"ERR_NOT_FOUND")}function f(e){return e=e??new Error("Aborted"),i(e,"ERR_ABORTED")}class d{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:r,block:n}of e)await this.put(r,n,t),yield r}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const r of e)yield{cid:r,block:await this.get(r,t)}}async delete(e,t){await Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const r of e)await this.delete(r,t),yield r}async*getAll(e){throw new Error(".getAll is not implemented")}}var p=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const y=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class m{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class g{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return w(this,e)}}class b{constructor(e){this.decoders=e}or(e){return w(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const w=(e,t)=>new b({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class v{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new m(e,t,r),this.decoder=new g(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const E=({name:e,prefix:t,encode:r,decode:n})=>new v(e,t,r,n),_=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=p(r,t);return E({prefix:e,name:t,encode:n,decode:e=>y(i(e))})},x=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>E({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),k=x({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),S=(x({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),x({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),x({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),x({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),x({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),x({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),x({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),x({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),_({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));_({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var A=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=P;)r[n++]=255&t|I,t/=128;for(;t&T;)r[n++]=255&t|I,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},I=128,T=-128,P=Math.pow(2,31);var C=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&R)<<s:(n&R)*Math.pow(2,s),s+=7}while(n>=D);return e.bytes=o-r,i},D=128,R=127;var O=Math.pow(2,7),N=Math.pow(2,14),B=Math.pow(2,21),M=Math.pow(2,28),L=Math.pow(2,35),U=Math.pow(2,42),j=Math.pow(2,49),F=Math.pow(2,56),K=Math.pow(2,63),z={encode:A,decode:C,encodingLength:function(e){return e<O?1:e<N?2:e<B?3:e<M?4:e<L?5:e<U?6:e<j?7:e<F?8:e<K?9:10}};const $=(e,t=0)=>[z.decode(e,t),z.decode.bytes],V=(e,t,r=0)=>(z.encode(e,t,r),t),q=e=>z.encodingLength(e),W=e=>{const t=y(e),[r,n]=$(t),[i,s]=$(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new H(r,i,o,t)};class H{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const G=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Z(r,J(e),t||S.encoder):ee(r,J(e),t||k.encoder)},Y=new WeakMap,J=e=>{const t=Y.get(e);if(null==t){const t=new Map;return Y.set(e,t),t}return t};class X{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==te)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==re)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return X.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=((e,t)=>{const r=t.byteLength,n=q(e),i=n+q(r),s=new Uint8Array(i+r);return V(e,s,0),V(r,s,n),s.set(t,i),new H(e,r,t,s)})(e,t);return X.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return X.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return G(this,e)}toJSON(){return{"/":G(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof X)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new X(e,r,n,i||ne(e,r,n.bytes))}if(!0===t[ie]){const{version:e,multihash:r,code:n}=t,i=W(r);return X.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==te)throw new Error(`Version 0 CID must use dag-pb (code: ${te}) block encoding`);return new X(e,t,r,r.bytes);case 1:{const n=ne(e,t,r.bytes);return new X(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return X.create(0,te,e)}static createV1(e,t){return X.create(1,e,t)}static decode(e){const[t,r]=X.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=X.inspectBytes(e),r=t.size-t.multihashSize,n=y(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new H(t.multihashCode,t.digestSize,i,n);return[0===t.version?X.createV0(s):X.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=$(e.subarray(t));return t+=n,r};let n=r(),i=te;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Q(e,t),i=X.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return J(i).set(r,e),i}}const Q=(e,t)=>{switch(e[0]){case"Q":{const r=t||S;return[S.prefix,r.decode(`${S.prefix}${e}`)]}case S.prefix:{const r=t||S;return[S.prefix,r.decode(e)]}case k.prefix:{const r=t||k;return[k.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Z=(e,t,r)=>{const{prefix:n}=r;if(n!==S.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},ee=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},te=112,re=18,ne=(e,t,r)=>{const n=q(e),i=n+q(t),s=new Uint8Array(i+r.byteLength);return V(e,s,0),V(t,s,n),s.set(r,i),s},ie=Symbol.for("@ipld/js-cid/CID");class se extends d{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(k.encode(e.multihash.bytes),t),e}get(e){const t=this.data.get(k.encode(e.multihash.bytes));if(null==t)throw l();return t}has(e){return this.data.has(k.encode(e.multihash.bytes))}async delete(e){this.data.delete(k.encode(e.multihash.bytes))}async*getAll(){for(const[e,t]of this.data.entries())yield{cid:X.createV1(85,W(k.decode(e))),block:t}}}var oe=r(11227);const ae=x({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});x({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),x({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),x({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});oe.formatters.b=e=>null==e?"undefined":S.baseEncode(e),oe.formatters.t=e=>null==e?"undefined":k.baseEncode(e),oe.formatters.m=e=>null==e?"undefined":ae.baseEncode(e),oe.formatters.p=e=>null==e?"undefined":e.toString(),oe.formatters.c=e=>null==e?"undefined":e.toString(),oe.formatters.k=e=>null==e?"undefined":e.toString(),oe.formatters.a=e=>null==e?"undefined":e.toString();class ce extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}!function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);oe.enabled(`${e}:trace`)&&null!=oe.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=oe(`${e}:trace`)),Object.assign(oe(e),{error:oe(`${e}:error`),trace:t})}("blockstore:core:tiered");const ue={...n}},58733:function(e,t,r){"use strict";r.d(t,{x:function(){return w}});var n=r(93361),i=r(37430),s=r(66699),o=r(38161),a=r(53137),c=r(29094),u=r(14249),h=r(81653),l=r(32114),f=r(44752),d=r(56635);const p=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();class y{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,n.Z)(this.putMany(e,r)),e=[],await(0,n.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,f.Z)(r,(t=>t.key.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,f.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>p(e,t)),r)),null!=e.offset){let t=0;r=(0,f.Z)(r,(()=>t++>=(e.offset||0)))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,f.Z)(r,(t=>t.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,f.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>p(e,t)),r)),null!=e.offset){let t=0;r=(0,f.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}}function m(e){const t=o.k0.asCID(e);if(!t)throw l(new Error("Not a valid cid"),"ERR_INVALID_CID");return new s.s("/"+u.base32.encode(t.multihash.bytes).slice(1).toUpperCase(),!1)}function g(e){return o.k0.createV1(a.code,c.Jx(u.base32.decode("b"+e.toString().slice(1).toLowerCase())))}function b(e){const t=e.substring(0,1);if("/"===t)return b(e.substring(1));let r,n;r="b"===t.toLowerCase()?e=>u.base32.decode(e.toLowerCase()).subarray(2):"c"===t.toLowerCase()?e=>u.base32pad.decode(e.toLowerCase()).subarray(2):"z"===t?e=>h.base58btc.decode(e).subarray(2):"Q"===t?e=>h.base58btc.decode("z"+e):e=>u.base32.decode("b"+e.toLowerCase()).subarray(2);for(let t=1;t<e.length;t++)try{n=r(e.substring(0,t))}catch(e){if("Unexpected end of data"!==e.message)throw e}let i="/C";return n&&(i=`/${u.base32.encode(n).slice(1,-1).toUpperCase()||"C"}`),i}class w extends y{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:r,value:n}of this.child.query(function(e){return{...e,prefix:e.prefix?b(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e({key:g(t.key),value:t.value}))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e({key:g(t.key),value:t.value},{key:g(r.key),value:r.value}))):void 0}}(e),t))yield{key:g(r),value:n}}async*queryKeys(e,t){for await(const r of this.child.queryKeys(function(e){return{...e,prefix:e.prefix?b(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e(g(t)))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e(g(t),g(r)))):void 0}}(e),t))yield g(r)}async get(e,t){return this.child.get(m(e),t)}async*getMany(e,t){for await(const r of e)yield this.get(r,t)}async put(e,t,r){await this.child.put(m(e),t,r)}async*putMany(e,t){const r=(0,i.d)({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)((async()=>{try{const i=this.child;await(0,n.Z)(this.child.putMany(async function*(){for await(const n of e){const e=m(n.key);await i.has(e,t)||(yield{key:e,value:n.value}),r.push(n)}}())),r.end()}catch(e){r.end(e)}})),yield*r}has(e,t){return this.child.has(m(e),t)}delete(e,t){return this.child.delete(m(e),t)}deleteMany(e,t){const r=(0,i.d)({objectMode:!0});return(0,n.Z)(this.child.deleteMany(async function*(){for await(const t of e)yield m(t),r.push(t);r.end()}(),t)).catch((e=>{r.end(e)})),r}}},33634:function(e,t,r){"use strict";r.d(t,{Y:function(){return X}});var n=r(98724),i=r(4424);var s=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const o=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class a{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class c{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return h(this,e)}}class u{constructor(e){this.decoders=e}or(e){return h(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const h=(e,t)=>new u({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class l{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new a(e,t,r),this.decoder=new c(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const f=({name:e,prefix:t,encode:r,decode:n})=>new l(e,t,r,n),d=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=s(r,t);return f({prefix:e,name:t,encode:n,decode:e=>o(i(e))})},p=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>f({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),y=p({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),m=p({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),g=(p({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),p({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),p({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),p({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),p({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),p({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),d({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));d({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var b=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=E;)r[n++]=255&t|w,t/=128;for(;t&v;)r[n++]=255&t|w,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},w=128,v=-128,E=Math.pow(2,31);var _=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&k)<<s:(n&k)*Math.pow(2,s),s+=7}while(n>=x);return e.bytes=o-r,i},x=128,k=127;var S=Math.pow(2,7),A=Math.pow(2,14),I=Math.pow(2,21),T=Math.pow(2,28),P=Math.pow(2,35),C=Math.pow(2,42),D=Math.pow(2,49),R=Math.pow(2,56),O=Math.pow(2,63),N={encode:b,decode:_,encodingLength:function(e){return e<S?1:e<A?2:e<I?3:e<T?4:e<P?5:e<C?6:e<D?7:e<R?8:e<O?9:10}};const B=(e,t=0)=>[N.decode(e,t),N.decode.bytes],M=(e,t,r=0)=>(N.encode(e,t,r),t),L=e=>N.encodingLength(e),U=e=>{const t=o(e),[r,n]=B(t),[i,s]=B(t.subarray(n)),a=t.subarray(n+s);if(a.byteLength!==i)throw new Error("Incorrect length");return new j(r,i,a,t)};class j{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const F=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?q(r,z(e),t||g.encoder):W(r,z(e),t||y.encoder)},K=new WeakMap,z=e=>{const t=K.get(e);if(null==t){const t=new Map;return K.set(e,t),t}return t};class ${constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==H)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==G)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=((e,t)=>{const r=t.byteLength,n=L(e),i=n+L(r),s=new Uint8Array(i+r);return M(e,s,0),M(r,s,n),s.set(t,i),new j(e,r,t,s)})(e,t);return $.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return F(this,e)}toJSON(){return{"/":F(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof $)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new $(e,r,n,i||Y(e,r,n.bytes))}if(!0===t[J]){const{version:e,multihash:r,code:n}=t,i=U(r);return $.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==H)throw new Error(`Version 0 CID must use dag-pb (code: ${H}) block encoding`);return new $(e,t,r,r.bytes);case 1:{const n=Y(e,t,r.bytes);return new $(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return $.create(0,H,e)}static createV1(e,t){return $.create(1,e,t)}static decode(e){const[t,r]=$.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$.inspectBytes(e),r=t.size-t.multihashSize,n=o(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new j(t.multihashCode,t.digestSize,i,n);return[0===t.version?$.createV0(s):$.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=B(e.subarray(t));return t+=n,r};let n=r(),i=H;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=V(e,t),i=$.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return z(i).set(r,e),i}}const V=(e,t)=>{switch(e[0]){case"Q":{const r=t||g;return[g.prefix,r.decode(`${g.prefix}${e}`)]}case g.prefix:{const r=t||g;return[g.prefix,r.decode(e)]}case y.prefix:{const r=t||y;return[y.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},q=(e,t,r)=>{const{prefix:n}=r;if(n!==g.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},W=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},H=112,G=18,Y=(e,t,r)=>{const n=L(e),i=n+L(t),s=new Uint8Array(i+r.byteLength);return M(e,s,0),M(t,s,n),s.set(r,i),s},J=Symbol.for("@ipld/js-cid/CID");class X extends n.Ed{location;version;db;base;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1,this.base=t.base??m}#e(e){return`/${this.base.encoder.encode(e.multihash.bytes)}`}#t(e){return $.createV1(85,U(this.base.decoder.decode(e.substring(1))))}async open(){try{const e=this.location;this.db=await(0,i.X3)(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw n.D1.openFailedError(e)}}async close(){this.db?.close()}async put(e,t){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return await this.db.put(this.location,t,this.#e(e)),e}catch(e){throw n.D1.putFailedError(e)}}async get(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");let t;try{t=await this.db.get(this.location,this.#e(e))}catch(e){throw n.D1.putFailedError(e)}if(void 0===t)throw n.D1.notFoundError();return t}async delete(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{await this.db.delete(this.location,this.#e(e))}catch(e){throw n.D1.putFailedError(e)}}async has(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return Boolean(await this.db.getKey(this.location,this.#e(e)))}catch(e){throw n.D1.putFailedError(e)}}async*getAll(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");for(const e of await this.db.getAllKeys(this.location)){const t=this.#t(e.toString()),r=await this.get(t);yield{cid:t,block:r}}}async destroy(){await(0,i.Lj)(this.location)}}},53597:function(e,t,r){"use strict";async function*n(e,t={}){const r=e.getReader();try{for(;;){const e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}r.d(t,{Z:function(){return n}})},11067:function(e,t,r){"use strict";function n(e){return e instanceof Uint8Array?{get:t=>e[t],set(t,r){e[t]=r}}:{get:t=>e.get(t),set(t,r){e.set(t,r)}}}r.d(t,{Z:function(){return n}})},64936:function(e,t,r){"use strict";r.d(t,{Dy:function(){return s.D},Jx:function(){return i.Jx},WU:function(){return s.W},cv:function(){return n.cv}});var n=r(72696),i=r(61287),s=r(59787)},55580:function(e,t,r){"use strict";r.d(t,{Fh:function(){return p},Jl:function(){return c},Km:function(){return h},Tp:function(){return y},X0:function(){return a},YX:function(){return u},Zh:function(){return l},cs:function(){return f},kj:function(){return o},or:function(){return s},uN:function(){return d}});var n=r(59787),i=r(85590);const s=[24,256,65536,4294967296,BigInt("18446744073709551616")];function o(e,t,r){(0,i.DO)(e,t,1);const n=e[t];if(!0===r.strict&&n<s[0])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);return n}function a(e,t,r){(0,i.DO)(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<s[1])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);return n}function c(e,t,r){(0,i.DO)(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<s[2])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);return n}function u(e,t,r){(0,i.DO)(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],a=(BigInt(n)<<BigInt(32))+BigInt(o);if(!0===r.strict&&a<s[3])throw new Error(`${i.IR} integer encoded in more bytes than necessary (strict decode)`);if(a<=Number.MAX_SAFE_INTEGER)return Number(a);if(!0===r.allowBigInt)return a;throw new Error(`${i.IR} integers outside of the safe integer range are not supported`)}function h(e,t,r,i){return new n.W(n.D.uint,o(e,t+1,i),2)}function l(e,t,r,i){return new n.W(n.D.uint,a(e,t+1,i),3)}function f(e,t,r,i){return new n.W(n.D.uint,c(e,t+1,i),5)}function d(e,t,r,i){return new n.W(n.D.uint,u(e,t+1,i),9)}function p(e,t){return y(e,0,t.value)}function y(e,t,r){if(r<s[0]){const n=Number(r);e.push([t|n])}else if(r<s[1]){const n=Number(r);e.push([24|t,n])}else if(r<s[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<s[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<s[4]))throw new Error(`${i.IR} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&i,i>>=8,r[7]=255&i,i>>=8,r[6]=255&i,i>>=8,r[5]=255&i,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,e.push(r)}}}p.encodedSize=function(e){return y.encodedSize(e.value)},y.encodedSize=function(e){return e<s[0]?1:e<s[1]?2:e<s[2]?3:e<s[3]?5:9},p.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}},53929:function(e,t,r){"use strict";r.d(t,{UT:function(){return f},ec:function(){return l},r0:function(){return a},wy:function(){return c},yr:function(){return o}});var n=r(59787),i=r(55580),s=r(85590);function o(e,t,r,s){return new n.W(n.D.negint,-1-i.kj(e,t+1,s),2)}function a(e,t,r,s){return new n.W(n.D.negint,-1-i.X0(e,t+1,s),3)}function c(e,t,r,s){return new n.W(n.D.negint,-1-i.Jl(e,t+1,s),5)}const u=BigInt(-1),h=BigInt(1);function l(e,t,r,o){const a=i.YX(e,t+1,o);if("bigint"!=typeof a){const e=-1-a;if(e>=Number.MIN_SAFE_INTEGER)return new n.W(n.D.negint,e,9)}if(!0!==o.allowBigInt)throw new Error(`${s.IR} integers outside of the safe integer range are not supported`);return new n.W(n.D.negint,u-BigInt(a),9)}function f(e,t){const r=t.value,n="bigint"==typeof r?r*u-h:-1*r-1;i.Tp(e,t.type.majorEncoded,n)}f.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*u-h:-1*t-1;return r<i.or[0]?1:r<i.or[1]?2:r<i.or[2]?3:r<i.or[3]?5:9},f.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0}},11560:function(e,t,r){"use strict";r.d(t,{BS:function(){return h},Ii:function(){return c},ME:function(){return f},UQ:function(){return u},hg:function(){return p},zU:function(){return l}});var n=r(59787),i=r(85590),s=r(55580),o=r(22042);function a(e,t,r,s){(0,i.DO)(e,t,r+s);const a=(0,o.tP)(e,t+r,t+r+s);return new n.W(n.D.bytes,a,r+s)}function c(e,t,r,n){return a(e,t,1,r)}function u(e,t,r,n){return a(e,t,2,s.kj(e,t+1,n))}function h(e,t,r,n){return a(e,t,3,s.X0(e,t+1,n))}function l(e,t,r,n){return a(e,t,5,s.Jl(e,t+1,n))}function f(e,t,r,n){const o=s.YX(e,t+1,n);if("bigint"==typeof o)throw new Error(`${i.IR} 64-bit integer bytes lengths not supported`);return a(e,t,9,o)}function d(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===n.D.string?(0,o.mL)(e.value):e.value),e.encodedBytes}function p(e,t){const r=d(t);s.Tp(e,t.type.majorEncoded,r.length),e.push(r)}p.encodedSize=function(e){const t=d(e);return s.Tp.encodedSize(t.length)+t.length},p.compareTokens=function(e,t){return r=d(e),n=d(t),r.length<n.length?-1:r.length>n.length?1:(0,o.qu)(r,n);var r,n}},50768:function(e,t,r){"use strict";r.d(t,{Bq:function(){return h},YW:function(){return p},bc:function(){return d},h:function(){return l},nt:function(){return u},q0:function(){return f}});var n=r(59787),i=r(85590),s=r(55580),o=r(11560),a=r(22042);function c(e,t,r,s,o){const c=r+s;(0,i.DO)(e,t,c);const u=new n.W(n.D.string,(0,a.BB)(e,t+r,t+c),c);return!0===o.retainStringBytes&&(u.byteValue=(0,a.tP)(e,t+r,t+c)),u}function u(e,t,r,n){return c(e,t,1,r,n)}function h(e,t,r,n){return c(e,t,2,s.kj(e,t+1,n),n)}function l(e,t,r,n){return c(e,t,3,s.X0(e,t+1,n),n)}function f(e,t,r,n){return c(e,t,5,s.Jl(e,t+1,n),n)}function d(e,t,r,n){const o=s.YX(e,t+1,n);if("bigint"==typeof o)throw new Error(`${i.IR} 64-bit integer string lengths not supported`);return c(e,t,9,o,n)}const p=o.hg},8278:function(e,t,r){"use strict";r.d(t,{HF:function(){return d},Ju:function(){return a},OC:function(){return u},a8:function(){return l},h7:function(){return c},lY:function(){return h},s5:function(){return f}});var n=r(59787),i=r(55580),s=r(85590);function o(e,t,r,i){return new n.W(n.D.array,i,r)}function a(e,t,r,n){return o(0,0,1,r)}function c(e,t,r,n){return o(0,0,2,i.kj(e,t+1,n))}function u(e,t,r,n){return o(0,0,3,i.X0(e,t+1,n))}function h(e,t,r,n){return o(0,0,5,i.Jl(e,t+1,n))}function l(e,t,r,n){const a=i.YX(e,t+1,n);if("bigint"==typeof a)throw new Error(`${s.IR} 64-bit integer array lengths not supported`);return o(0,0,9,a)}function f(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${s.IR} indefinite length items not allowed`);return o(0,0,1,1/0)}function d(e,t){i.Tp(e,n.D.array.majorEncoded,t.value)}d.compareTokens=i.Fh.compareTokens,d.encodedSize=function(e){return i.Tp.encodedSize(e.value)}},59283:function(e,t,r){"use strict";r.d(t,{F2:function(){return l},G:function(){return c},IY:function(){return h},KI:function(){return d},_K:function(){return a},ng:function(){return f},qe:function(){return u}});var n=r(59787),i=r(55580),s=r(85590);function o(e,t,r,i){return new n.W(n.D.map,i,r)}function a(e,t,r,n){return o(0,0,1,r)}function c(e,t,r,n){return o(0,0,2,i.kj(e,t+1,n))}function u(e,t,r,n){return o(0,0,3,i.X0(e,t+1,n))}function h(e,t,r,n){return o(0,0,5,i.Jl(e,t+1,n))}function l(e,t,r,n){const a=i.YX(e,t+1,n);if("bigint"==typeof a)throw new Error(`${s.IR} 64-bit integer map lengths not supported`);return o(0,0,9,a)}function f(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${s.IR} indefinite length items not allowed`);return o(0,0,1,1/0)}function d(e,t){i.Tp(e,n.D.map.majorEncoded,t.value)}d.compareTokens=i.Fh.compareTokens,d.encodedSize=function(e){return i.Tp.encodedSize(e.value)}},82428:function(e,t,r){"use strict";r.d(t,{CF:function(){return a},MV:function(){return u},ZR:function(){return o},qJ:function(){return s},vP:function(){return c},xy:function(){return h}});var n=r(59787),i=r(55580);function s(e,t,r,i){return new n.W(n.D.tag,r,1)}function o(e,t,r,s){return new n.W(n.D.tag,i.kj(e,t+1,s),2)}function a(e,t,r,s){return new n.W(n.D.tag,i.X0(e,t+1,s),3)}function c(e,t,r,s){return new n.W(n.D.tag,i.Jl(e,t+1,s),5)}function u(e,t,r,s){return new n.W(n.D.tag,i.YX(e,t+1,s),9)}function h(e,t){i.Tp(e,n.D.tag.majorEncoded,t.value)}h.compareTokens=i.Fh.compareTokens,h.encodedSize=function(e){return i.Tp.encodedSize(e.value)}},73851:function(e,t,r){"use strict";r.d(t,{GI:function(){return p},h1:function(){return h},mW:function(){return d},tA:function(){return m},vV:function(){return y},y7:function(){return l}});var n=r(59787),i=r(85590),s=r(55580);const o=20,a=21,c=22,u=23;function h(e,t,r,s){if(!1===s.allowUndefined)throw new Error(`${i.IR} undefined values are not supported`);return!0===s.coerceUndefinedToNull?new n.W(n.D.null,null,1):new n.W(n.D.undefined,void 0,1)}function l(e,t,r,s){if(!1===s.allowIndefinite)throw new Error(`${i.IR} indefinite length items not allowed`);return new n.W(n.D.break,void 0,1)}function f(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${i.IR} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${i.IR} Infinity values are not supported`)}return new n.W(n.D.float,e,t)}function d(e,t,r,n){return f(E(e,t+1),3,n)}function p(e,t,r,n){return f(x(e,t+1),5,n)}function y(e,t,r,n){return f(k(e,t+1),9,n)}function m(e,t,r){const i=t.value;if(!1===i)e.push([n.D.float.majorEncoded|o]);else if(!0===i)e.push([n.D.float.majorEncoded|a]);else if(null===i)e.push([n.D.float.majorEncoded|c]);else if(void 0===i)e.push([n.D.float.majorEncoded|u]);else{let t,n=!1;r&&!0===r.float64||(v(i),t=E(w,1),i===t||Number.isNaN(i)?(w[0]=249,e.push(w.slice(0,3)),n=!0):(_(i),t=x(w,1),i===t&&(w[0]=250,e.push(w.slice(0,5)),n=!0))),n||(s=i,b.setFloat64(0,s,!1),t=k(w,1),w[0]=251,e.push(w.slice(0,9)))}var s}m.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){v(r);let e=E(w,1);if(r===e||Number.isNaN(r))return 3;if(_(r),e=x(w,1),r===e)return 5}return 9};const g=new ArrayBuffer(9),b=new DataView(g,1),w=new Uint8Array(g,0);function v(e){if(e===1/0)b.setUint16(0,31744,!1);else if(e===-1/0)b.setUint16(0,64512,!1);else if(Number.isNaN(e))b.setUint16(0,32256,!1);else{b.setFloat32(0,e);const t=b.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)b.setUint16(0,31744,!1);else if(0===r)b.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?b.setUint16(0,0):e<-14?b.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):b.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function E(e,t){if(e.length-t<2)throw new Error(`${i.IR} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,s=1023&r;let o;return o=0===n?s*2**-24:31!==n?(s+1024)*2**(n-25):0===s?1/0:NaN,32768&r?-o:o}function _(e){b.setFloat32(0,e,!1)}function x(e,t){if(e.length-t<4)throw new Error(`${i.IR} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function k(e,t){if(e.length-t<8)throw new Error(`${i.IR} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}m.compareTokens=s.Fh.compareTokens},22042:function(e,t,r){"use strict";r.d(t,{BB:function(){return c},Dz:function(){return a},Pu:function(){return b},mL:function(){return u},nI:function(){return h},qu:function(){return p},tP:function(){return l},un:function(){return d},zo:function(){return f}});const n=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,i=new TextDecoder,s=new TextEncoder;function o(e){return n&&globalThis.Buffer.isBuffer(e)}function a(e){return e instanceof Uint8Array?o(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const c=n?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):m(e,t,r):(e,t,r)=>r-t>64?i.decode(e.subarray(t,r)):m(e,t,r),u=n?e=>e.length>64?globalThis.Buffer.from(e):y(e):e=>e.length>64?s.encode(e):y(e),h=e=>Uint8Array.from(e),l=n?(e,t,r)=>o(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),f=n?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),a(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},d=n?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function p(e,t){if(o(e)&&o(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function y(e,t=1/0){let r;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function m(e,t,r){const n=[];for(;t<r;){const i=e[t];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:i<128&&(s=i);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&i)<<6|63&r,c>127&&(s=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&i)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),t+=o}return b(n)}const g=4096;function b(e){const t=e.length;if(t<=g)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=g));return r}},85590:function(e,t,r){"use strict";r.d(t,{DO:function(){return o},IR:function(){return n},OO:function(){return i}});const n="CBOR decode error:",i="CBOR encode error:",s=[];function o(e,t,r){if(e.length-t<r)throw new Error(`${n} not enough data for type`)}s[23]=1,s[24]=2,s[25]=3,s[26]=5,s[27]=9},61287:function(e,t,r){"use strict";r.d(t,{Jx:function(){return l}});var n=r(85590),i=r(59787),s=r(53741);const o={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class a{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=s.PS[e];if(void 0===t){const r=s.cW[e];if(!r)throw new Error(`${n.IR} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=31&e;t=r(this.data,this.pos,i,this.options)}return this.pos+=t.encodedLength,t}}const c=Symbol.for("DONE"),u=Symbol.for("BREAK");function h(e,t){if(e.done())return c;const r=e.next();if(r.type===i.D.break)return u;if(r.type.terminal)return r.value;if(r.type===i.D.array)return function(e,t,r){const i=[];for(let s=0;s<e.value;s++){const o=h(t,r);if(o===u){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed array`)}if(o===c)throw new Error(`${n.IR} found array but not enough entries (got ${s}, expected ${e.value})`);i[s]=o}return i}(r,e,t);if(r.type===i.D.map)return function(e,t,r){const i=!0===r.useMaps,s=i?void 0:{},o=i?new Map:void 0;for(let a=0;a<e.value;a++){const l=h(t,r);if(l===u){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed map`)}if(l===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(!0!==i&&"string"!=typeof l)throw new Error(`${n.IR} non-string keys not supported (got ${typeof l})`);if(!0===r.rejectDuplicateMapKeys&&(i&&o.has(l)||!i&&l in s))throw new Error(`${n.IR} found repeat map key "${l}"`);const f=h(t,r);if(f===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no value], expected ${e.value})`);i?o.set(l,f):s[l]=f}return i?o:s}(r,e,t);if(r.type===i.D.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=h(e,t);return t.tags[r.value](n)}throw new Error(`${n.IR} tag not supported (${r.value})`)}throw new Error("unsupported")}function l(e,t){if(!(e instanceof Uint8Array))throw new Error(`${n.IR} data to decode must be a Uint8Array`);const r=(t=Object.assign({},o,t)).tokenizer||new a(e,t),i=h(r,t);if(i===c)throw new Error(`${n.IR} did not find any content to decode`);if(i===u)throw new Error(`${n.IR} got unexpected break`);if(!r.done())throw new Error(`${n.IR} too many terminals, data makes no sense`);return i}},72696:function(e,t,r){"use strict";r.d(t,{cv:function(){return P},w$:function(){return T}});const n=["string","number","bigint","symbol"],i=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function s(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(n.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const r=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(i.includes(t))return t;return}(e);return r||"Object"}var o=r(59787),a=r(22042);class c{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=(0,a.un)(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=(0,a.tP)(r,0,this.cursor)}else t=(0,a.zo)(this.chunks,this.cursor);return e&&this.reset(),t}}var u=r(85590),h=r(53741),l=r(55580),f=r(53929),d=r(11560),p=r(50768),y=r(8278),m=r(59283),g=r(82428),b=r(73851),w=r(25108);const v={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const i=r.type.major,s=E[i].compareTokens(r,n);0===s&&w.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return s},quickEncodeToken:h.JN};const E=function(){const e=[];return e[o.D.uint.major]=l.Fh,e[o.D.negint.major]=f.UT,e[o.D.bytes.major]=d.hg,e[o.D.string.major]=p.YW,e[o.D.array.major]=y.HF,e[o.D.map.major]=m.KI,e[o.D.tag.major]=g.xy,e[o.D.float.major]=b.tA,e}(),_=new c;class x{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${u.OO} object contains circular references`);return new x(t,e)}}const k={null:new o.W(o.D.null,null),undefined:new o.W(o.D.undefined,void 0),true:new o.W(o.D.true,!0),false:new o.W(o.D.false,!1),emptyArray:new o.W(o.D.array,0),emptyMap:new o.W(o.D.map,0)},S={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new o.W(o.D.uint,e):new o.W(o.D.negint,e):new o.W(o.D.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new o.W(o.D.uint,e):new o.W(o.D.negint,e),Uint8Array:(e,t,r,n)=>new o.W(o.D.bytes,e),string:(e,t,r,n)=>new o.W(o.D.string,e),boolean:(e,t,r,n)=>e?k.true:k.false,null:(e,t,r,n)=>k.null,undefined:(e,t,r,n)=>k.undefined,ArrayBuffer:(e,t,r,n)=>new o.W(o.D.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new o.W(o.D.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[k.emptyArray,new o.W(o.D.break)]:k.emptyArray;n=x.createCheck(n,e);const i=[];let s=0;for(const t of e)i[s++]=A(t,r,n);return r.addBreakTokens?[new o.W(o.D.array,e.length),i,new o.W(o.D.break)]:[new o.W(o.D.array,e.length),i]},Object(e,t,r,n){const i="Object"!==t,s=i?e.keys():Object.keys(e),a=i?e.size:s.length;if(!a)return!0===r.addBreakTokens?[k.emptyMap,new o.W(o.D.break)]:k.emptyMap;n=x.createCheck(n,e);const c=[];let u=0;for(const t of s)c[u++]=[A(t,r,n),A(i?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(c,r),r.addBreakTokens?[new o.W(o.D.map,a),c,new o.W(o.D.break)]:[new o.W(o.D.map,a),c]}};S.Map=S.Object,S.Buffer=S.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))S[`${e}Array`]=S.DataView;function A(e,t={},r){const n=s(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||S[n];if("function"==typeof i){const s=i(e,n,t,r);if(null!=s)return s}const o=S[n];if(!o)throw new Error(`${u.OO} unsupported type: ${n}`);return o(e,n,t,r)}function I(e,t,r,n){if(Array.isArray(t))for(const i of t)I(e,i,r,n);else r[t.type.major](e,t,n)}function T(e,t,r){const n=A(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const i=t[n.type.major];if(i.encodedSize){const e=i.encodedSize(n,r),t=new c(e);if(i(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return(0,a.Dz)(t.chunks[0])}}return _.reset(),I(_,n,t,r),_.toBytes(!0)}function P(e,t){return t=Object.assign({},v,t),T(e,E,t)}},97223:function(e,t,r){"use strict";r.d(t,{d2:function(){return l},Jx:function(){return f},cv:function(){return u}});var n=r(59787),i=r(72696),s=r(85590),o=r(22042);class a extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===n.D.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===n.D.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[n.D.uint.major](e,t){this.prefix(e);const r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[n.D.negint.major](e,t){this[n.D.uint.major](e,t)}[n.D.bytes.major](e,t){throw new Error(`${s.OO} unsupported type: Uint8Array`)}[n.D.string.major](e,t){this.prefix(e);const r=(0,o.mL)(JSON.stringify(t.value));e.push(r.length>32?(0,o.Dz)(r):r)}[n.D.array.major](e,t){this.prefix(e),this.inRecursive.push({type:n.D.array,elements:0}),e.push([91])}[n.D.map.major](e,t){this.prefix(e),this.inRecursive.push({type:n.D.map,elements:0}),e.push([123])}[n.D.tag.major](e,t){}[n.D.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===n.D.array)e.push([93]);else{if(t.type!==n.D.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${s.OO} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const r=String(t.value),i=[];let o=!1;for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e),o||46!==i[e]&&101!==i[e]&&69!==i[e]||(o=!0);o||(i.push(46),i.push(48)),e.push(i)}}const c={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${s.OO} complex map keys are not supported`);const r=e[0],i=t[0];if(r.type!==n.D.string||i.type!==n.D.string)throw new Error(`${s.OO} non-string map keys are not supported`);if(r<i)return-1;if(r>i)return 1;throw new Error(`${s.OO} unexpected duplicate map keys, this is not supported`)}};function u(e,t){return t=Object.assign({},c,t),(0,i.w$)(e,new a,t)}var h=r(61287);class l{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${s.IR} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${s.IR} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,r=!1;const i=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this.pos++}};if(45===this.ch()&&(t=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new n.W(n.D.uint,0,this.pos-e);this.pos++,r=!0}if(i([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${s.IR} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(r)throw new Error(`${s.IR} unexpected token at position ${this.pos}`);r=!0,this.pos++,i([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,i([48,49,50,51,52,53,54,55,56,57]));const o=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),a=parseFloat(o);return r?new n.W(n.D.float,a,this.pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(a)?new n.W(a>=0?n.D.uint:n.D.negint,a,this.pos-e):new n.W(a>=0?n.D.uint:n.D.negint,BigInt(o),this.pos-e)}parseString(){if(34!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let e=this.pos,t=0;e<this.data.length&&t<65536;e++,t++){const r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){const r=String.fromCharCode.apply(null,this.data.subarray(this.pos,e));return this.pos=e+1,new n.W(n.D.string,r,t)}}const e=this.pos,t=[],r=()=>{if(this.pos+4>=this.data.length)throw new Error(`${s.IR} unexpected end of unicode escape sequence at position ${this.pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${s.IR} unexpected unicode escape character at position ${this.pos}`);t=t-65+10}e=16*e+t,this.pos++}return e},i=()=>{const e=this.ch();let r,n,i,o,a=null,c=e>239?4:e>223?3:e>191?2:1;if(this.pos+c>this.data.length)throw new Error(`${s.IR} unexpected unicode sequence at position ${this.pos}`);switch(c){case 1:e<128&&(a=e);break;case 2:r=this.data[this.pos+1],128==(192&r)&&(o=(31&e)<<6|63&r,o>127&&(a=o));break;case 3:r=this.data[this.pos+1],n=this.data[this.pos+2],128==(192&r)&&128==(192&n)&&(o=(15&e)<<12|(63&r)<<6|63&n,o>2047&&(o<55296||o>57343)&&(a=o));break;case 4:r=this.data[this.pos+1],n=this.data[this.pos+2],i=this.data[this.pos+3],128==(192&r)&&128==(192&n)&&128==(192&i)&&(o=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&i,o>65535&&o<1114112&&(a=o))}null===a?(a=65533,c=1):a>65535&&(a-=65536,t.push(a>>>10&1023|55296),a=56320|1023&a),t.push(a),this.pos+=c};for(;!this.done();){const a=this.ch();let c;switch(a){case 92:if(this.pos++,this.done())throw new Error(`${s.IR} unexpected string termination at position ${this.pos}`);switch(c=this.ch(),this.pos++,c){case 34:case 39:case 92:case 47:t.push(c);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${s.IR} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new n.W(n.D.string,(0,o.Pu)(t),this.pos-e);default:if(a<32)throw new Error(`${s.IR} invalid control character at position ${this.pos}`);a<128?(t.push(a),this.pos++):i()}}throw new Error(`${s.IR} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new n.W(n.D.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new n.W(n.D.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new n.W(n.D.null,null,4);case 102:return this.expect([102,97,108,115,101]),new n.W(n.D.false,!1,5);case 116:return this.expect([116,114,117,101]),new n.W(n.D.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${s.IR} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);if(44!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);if(44!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${s.IR} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${s.IR} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function f(e,t){return t=Object.assign({tokenizer:new l(e,t)},t),(0,h.Jx)(e,t)}},53741:function(e,t,r){"use strict";r.d(t,{JN:function(){return b},PS:function(){return g},cW:function(){return m}});var n=r(59787),i=r(55580),s=r(53929),o=r(11560),a=r(50768),c=r(8278),u=r(59283),h=r(82428),l=r(73851),f=r(85590),d=r(22042);function p(e,t,r){throw new Error(`${f.IR} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function y(e){return()=>{throw new Error(`${f.IR} ${e}`)}}const m=[];for(let e=0;e<=23;e++)m[e]=p;m[24]=i.Km,m[25]=i.Zh,m[26]=i.cs,m[27]=i.uN,m[28]=p,m[29]=p,m[30]=p,m[31]=p;for(let e=32;e<=55;e++)m[e]=p;m[56]=s.yr,m[57]=s.r0,m[58]=s.wy,m[59]=s.ec,m[60]=p,m[61]=p,m[62]=p,m[63]=p;for(let e=64;e<=87;e++)m[e]=o.Ii;m[88]=o.UQ,m[89]=o.BS,m[90]=o.zU,m[91]=o.ME,m[92]=p,m[93]=p,m[94]=p,m[95]=y("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)m[e]=a.nt;m[120]=a.Bq,m[121]=a.h,m[122]=a.q0,m[123]=a.bc,m[124]=p,m[125]=p,m[126]=p,m[127]=y("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)m[e]=c.Ju;m[152]=c.h7,m[153]=c.OC,m[154]=c.lY,m[155]=c.a8,m[156]=p,m[157]=p,m[158]=p,m[159]=c.s5;for(let e=160;e<=183;e++)m[e]=u._K;m[184]=u.G,m[185]=u.qe,m[186]=u.IY,m[187]=u.F2,m[188]=p,m[189]=p,m[190]=p,m[191]=u.ng;for(let e=192;e<=215;e++)m[e]=h.qJ;m[216]=h.ZR,m[217]=h.CF,m[218]=h.vP,m[219]=h.MV,m[220]=p,m[221]=p,m[222]=p,m[223]=p;for(let e=224;e<=243;e++)m[e]=y("simple values are not supported");m[244]=p,m[245]=p,m[246]=p,m[247]=l.h1,m[248]=y("simple values are not supported"),m[249]=l.mW,m[250]=l.GI,m[251]=l.vV,m[252]=p,m[253]=p,m[254]=p,m[255]=l.y7;const g=[];for(let e=0;e<24;e++)g[e]=new n.W(n.D.uint,e,1);for(let e=-1;e>=-24;e--)g[31-e]=new n.W(n.D.negint,e,1);function b(e){switch(e.type){case n.D.false:return(0,d.nI)([244]);case n.D.true:return(0,d.nI)([245]);case n.D.null:return(0,d.nI)([246]);case n.D.bytes:return e.value.length?void 0:(0,d.nI)([64]);case n.D.string:return""===e.value?(0,d.nI)([96]):void 0;case n.D.array:return 0===e.value?(0,d.nI)([128]):void 0;case n.D.map:return 0===e.value?(0,d.nI)([160]):void 0;case n.D.uint:return e.value<24?(0,d.nI)([Number(e.value)]):void 0;case n.D.negint:if(e.value>=-24)return(0,d.nI)([31-Number(e.value)])}}g[64]=new n.W(n.D.bytes,new Uint8Array(0),1),g[96]=new n.W(n.D.string,"",1),g[128]=new n.W(n.D.array,0,1),g[160]=new n.W(n.D.map,0,1),g[244]=new n.W(n.D.false,!1,1),g[245]=new n.W(n.D.true,!0,1),g[246]=new n.W(n.D.null,null,1)},59787:function(e,t,r){"use strict";r.d(t,{D:function(){return n},W:function(){return i}});class n{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}n.uint=new n(0,"uint",!0),n.negint=new n(1,"negint",!0),n.bytes=new n(2,"bytes",!0),n.string=new n(3,"string",!0),n.array=new n(4,"array",!1),n.map=new n(5,"map",!1),n.tag=new n(6,"tag",!1),n.float=new n(7,"float",!0),n.false=new n(7,"false",!0),n.true=new n(7,"true",!0),n.null=new n(7,"null",!0),n.undefined=new n(7,"undefined",!0),n.break=new n(7,"break",!0);class i{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}},84296:function(e,t,r){"use strict";r.r(t),r.d(t,{code:function(){return d},decode:function(){return b},encode:function(){return g},name:function(){return f},toGeneral:function(){return m}});var n=r(99382);function i(e){return n.base64url.encode(e).slice(1)}function s(e){return n.base64url.decode(`u${e}`)}var o=r(38161);function a(e){const t={signature:s(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=s(e.protected)),t}function c(e){const t={signature:i(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=i(e.protected)),t}function u(e){const t={};return e.encrypted_key&&(t.encrypted_key=s(e.encrypted_key)),e.header&&(t.header=e.header),t}function h(e){const t={};return e.encrypted_key&&(t.encrypted_key=i(e.encrypted_key)),e.header&&(t.header=e.header),t}var l=r(90560);const f="dag-jose",d=133;function p(e){return"payload"in e&&"string"==typeof e.payload&&"signatures"in e&&Array.isArray(e.signatures)}function y(e){return"ciphertext"in e&&"string"==typeof e.ciphertext&&"iv"in e&&"string"==typeof e.iv&&"protected"in e&&"string"==typeof e.protected&&"tag"in e&&"string"==typeof e.tag}function m(e){if("string"==typeof e){const t=e.split(".");if(3===t.length)return function(e){const[t,r,n]=e;return{payload:r,signatures:[{protected:t,signature:n}],link:o.k0.decode(s(r))}}(t);if(5===t.length)return function(e){const[t,r,n,i,s]=e,o={ciphertext:i,iv:n,protected:t,tag:s};return r&&(o.recipients=[{encrypted_key:r}]),o}(t);throw new Error("Not a valid JOSE string")}if(p(e)||y(e))return e;throw new Error("Not a valid unencoded JOSE object")}function g(e){let t;if("string"==typeof e&&(e=m(e)),p(e))t=function(e){const t=s(e.payload);try{o.k0.decode(t)}catch(e){throw new Error("Not a valid DagJWS")}return{payload:t,signatures:e.signatures.map(a)}}(e);else{if(!y(e))throw new Error("Not a valid JOSE object");t=function(e){const t={ciphertext:s(e.ciphertext),protected:s(e.protected),iv:s(e.iv),tag:s(e.tag)};return e.aad&&(t.aad=s(e.aad)),e.recipients&&(t.recipients=e.recipients.map(u)),e.unprotected&&(t.unprotected=e.unprotected),t}(e)}return new Uint8Array(l.encode(t))}function b(e){let t;try{t=l.decode(e)}catch(e){throw new Error("Not a valid DAG-JOSE object")}if("payload"in(r=t)&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures))return function(e){const t={payload:i(e.payload),signatures:e.signatures.map(c)};return t.link=o.k0.decode(new Uint8Array(e.payload)),t}(t);if(function(e){return"ciphertext"in e&&e.ciphertext instanceof Uint8Array&&"iv"in e&&e.iv instanceof Uint8Array&&"protected"in e&&e.protected instanceof Uint8Array&&"tag"in e&&e.tag instanceof Uint8Array}(t))return function(e){const t={ciphertext:i(e.ciphertext),protected:i(e.protected),iv:i(e.iv),tag:i(e.tag)};return e.aad&&(t.aad=i(e.aad)),e.recipients&&(t.recipients=e.recipients.map(h)),e.unprotected&&(t.unprotected=e.unprotected),t}(t);throw new Error("Not a valid DAG-JOSE object");var r}},54589:function(e,t,r){"use strict";r.d(t,{e:function(){return u}});var n=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);},i=r(75671);var s=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,i.Z)(e),{value:n,done:s}=r.next();if(!0===s)return function*(){}();const o=t(n);if("function"==typeof o.then)return async function*(){await o&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const a=t;return function*(){!0===o&&(yield n);for(const e of r)a(e)&&(yield e)}()};var o=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t};var a=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const r=await o(e);yield*r.sort(t)}():function*(){const r=o(e);yield*r.sort(t)}()};var c=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}():function*(){let r=0;if(!(t<1))for(const n of e)if(yield n,r++,r===t)return}()};class u{put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield r}async*getMany(e,t={}){for await(const r of e)yield{key:r,value:await this.get(r,t)}}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await n(this.putMany(e,r)),e=[],await n(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix){const t=e.prefix;r=s(r,(e=>e.key.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>s(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){let t=0;const n=e.offset;r=s(r,(()=>t++>=n))}return null!=e.limit&&(r=c(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix){const t=e.prefix;r=s(r,(e=>e.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>s(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){const t=e.offset;let n=0;r=s(r,(()=>n++>=t))}return null!=e.limit&&(r=c(r,e.limit)),r}}},66801:function(e,t,r){"use strict";r.r(t),r.d(t,{abortedError:function(){return u},dbDeleteFailedError:function(){return s},dbOpenFailedError:function(){return i},dbReadFailedError:function(){return a},dbWriteFailedError:function(){return o},notFoundError:function(){return c}});var n=r(32114);function i(e){return e=e??new Error("Cannot open database"),n(e,"ERR_DB_OPEN_FAILED")}function s(e){return e=e??new Error("Delete failed"),n(e,"ERR_DB_DELETE_FAILED")}function o(e){return e=e??new Error("Write failed"),n(e,"ERR_DB_WRITE_FAILED")}function a(e){return e=e??new Error("Read failed"),n(e,"ERR_DB_READ_FAILED")}function c(e){return e=e??new Error("Not Found"),n(e,"ERR_NOT_FOUND")}function u(e){return e=e??new Error("Aborted"),n(e,"ERR_ABORTED")}},32651:function(e,t,r){"use strict";r.d(t,{eF:function(){return o.e},D1:function(){return n},ar:function(){return a.a}});var n=r(66801),i=r(88309);const s="SHARDING";var o=r(54589),a=r(92291);r(32629);new i.s(s);class c extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}var u=r(11227);var h=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);class l{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class f{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return p(this,e)}}class d{constructor(e){this.decoders=e}or(e){return p(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const p=(e,t)=>new d({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class y{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new l(e,t,r),this.decoder=new f(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const m=({name:e,prefix:t,encode:r,decode:n})=>new y(e,t,r,n),g=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=h(r,t);return m({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},b=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>m({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),w=b({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),v=(b({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),b({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),b({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),b({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),b({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),b({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),b({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),b({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),g({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"})),E=(g({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),b({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}));b({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),b({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});u.formatters.b=e=>null==e?"undefined":v.baseEncode(e),u.formatters.t=e=>null==e?"undefined":w.baseEncode(e),u.formatters.m=e=>null==e?"undefined":E.baseEncode(e),u.formatters.p=e=>null==e?"undefined":e.toString(),u.formatters.c=e=>null==e?"undefined":e.toString(),u.formatters.k=e=>null==e?"undefined":e.toString(),u.formatters.a=e=>null==e?"undefined":e.toString();!function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);u.enabled(`${e}:trace`)&&null!=u.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=u(`${e}:trace`)),Object.assign(u(e),{error:u(`${e}:error`),trace:t})}("datastore:core:tiered")},92291:function(e,t,r){"use strict";r.d(t,{a:function(){return o}});var n=r(88309),i=r(54589),s=r(66801);class o extends i.e{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){const t=this.data.get(e.toString());if(null==t)throw s.notFoundError();return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(const[e,t]of this.data.entries())yield{key:new n.s(e),value:t}}*_allKeys(){for(const e of this.data.keys())yield new n.s(e)}}},88309:function(e,t,r){"use strict";r.d(t,{s:function(){return u}});var n=r(53416),i=r(77408),s=r(49784);const o="/",a=(new TextEncoder).encode(o),c=a[0];class u{_buf;constructor(e,t){if("string"==typeof e)this._buf=(0,i.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==c)throw new Error("Invalid key")}toString(e="utf8"){return(0,s.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new u(e.join(o))}static random(){return new u((0,n.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new u(e):"function"==typeof e.uint8Array?new u(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=a),this._buf[0]!==c){const e=new Uint8Array(this._buf.byteLength+1);e.fill(c,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===c;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return u.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(o).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new u(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(o)||(e+=o),e+=this.type(),new u(e)}parent(){const e=this.list();return 1===e.length?new u(o):new u(e.slice(0,-1).join(o))}child(e){return this.toString()===o?e:e.toString()===o?this:new u(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return u.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}},55472:function(e,t,r){"use strict";r.d(t,{s:function(){return m}});var n=r(32651),i=r(4424),s=r(53416),o=r(49784),a=r(77408);const c="/",u=(new TextEncoder).encode(c),h=u[0];class l{constructor(e,t){if("string"==typeof e)this._buf=(0,a.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==h)throw new Error("Invalid key")}toString(e="utf8"){return(0,o.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new l(e.join(c))}static random(){return new l((0,s.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new l(e):"function"==typeof e.uint8Array?new l(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=u),this._buf[0]!==h){const e=new Uint8Array(this._buf.byteLength+1);e.fill(h,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===h;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return l.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(c).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new l(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(c)||(e+=c),e+=this.type(),new l(e)}parent(){const e=this.list();return 1===e.length?new l(c):new l(e.slice(0,-1).join(c))}child(e){return this.toString()===c?e:e.toString()===c?this:new l(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return l.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}var f=r(75671);var d=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,f.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){await s&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===s&&(yield n);for(const e of r)o(e)&&(yield e)}()};var p=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t};var y=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const r=await p(e);yield*r.sort(t)}():function*(){const r=p(e);yield*r.sort(t)}()};class m extends n.eF{location;version;db;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1}async open(){try{const e=this.location;this.db=await(0,i.X3)(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw n.D1.dbOpenFailedError(e)}}async close(){this.db?.close()}async put(e,t){if(null==this.db)throw new Error("Datastore needs to be opened.");try{return await this.db.put(this.location,t,e.toString()),e}catch(e){throw n.D1.dbWriteFailedError(e)}}async get(e){if(null==this.db)throw new Error("Datastore needs to be opened.");let t;try{t=await this.db.get(this.location,e.toString())}catch(e){throw n.D1.dbReadFailedError(e)}if(void 0===t)throw n.D1.notFoundError();return t}async has(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return Boolean(await this.db.getKey(this.location,e.toString()))}catch(e){throw n.D1.dbReadFailedError(e)}}async delete(e){if(null==this.db)throw new Error("Datastore needs to be opened.");try{await this.db.delete(this.location,e.toString())}catch(e){throw n.D1.dbWriteFailedError(e)}}batch(){const e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async()=>{if(null==this.db)throw new Error("Datastore needs to be opened.");const r=this.db.transaction(this.location,"readwrite");try{const n=e.filter((({key:e})=>null==t.find((t=>t.toString()===e.toString())))).map((e=>async()=>{await r.store.put(e.value,e.key.toString())})).concat(t.map((e=>async()=>{await r.store.delete(e.toString())}))).concat((async()=>{await r.done}));await Promise.all(n.map((async e=>{await e()})))}catch{r.abort()}}}}async*query(e){let t=this.#r(e,((e,t)=>({key:e,value:t})));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>d(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>y(e,t)),t)),yield*t}async*queryKeys(e){let t=this.#r(e,(e=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>d(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>y(e,t)),t)),yield*t}async*#r(e,t){if(null==this.db)throw new Error("Datastore needs to be opened.");let r=0,n=-1;for(const i of await this.db.getAllKeys(this.location)){if(null!=e.prefix&&!i.toString().startsWith(e.prefix))continue;if(null!=e.limit&&r===e.limit)return;if(n++,null!=e.offset&&n<e.offset)continue;const s=new l(i.toString());let o;try{o=await this.get(s)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e;continue}null!=o&&(yield t(s,o),r++)}}async destroy(){await(0,i.Lj)(this.location)}}},12460:function(e,t,r){"use strict";r.d(t,{k:function(){return y}});var n=r(64348),i=r(32114);function s(e){return e=e||new Error("Write failed"),i(e,"ERR_DB_WRITE_FAILED")}r(66699);const o="SHARDING";const a=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();var c=r(93361),u=r(44752),h=r(56635);class l{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,c.Z)(this.putMany(e,r)),e=[],await(0,c.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,u.Z)(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){let t=0;r=(0,u.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,h.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,u.Z)(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){let t=0;r=(0,u.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,h.Z)(r,e.limit)),r}}new n.s(o),new n.s("_README");(0,r(69860).kg)("datastore:core:tiered");var f=r(21007),d=r(34751),p=r(21301);class y extends l{constructor(e,t={}){super(),this.db="string"==typeof e?new p.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw function(e){return e=e||new Error("Cannot open database"),i(e,"ERR_DB_OPEN_FAILED")}(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(e){throw s(e)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(e){if(e.notFound)throw function(e){return e=e||new Error("Not Found"),i(e,"ERR_NOT_FOUND")}(e);throw s(e)}return t}async has(e){try{await this.db.get(e.toString())}catch(e){if(e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(e.toString())}catch(e){throw function(e){return e=e||new Error("Delete failed"),i(e,"ERR_DB_DELETE_FAILED")}(e)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,r)=>{e.push({type:"put",key:t.toString(),value:r})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,d.Z)(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=(0,u.Z)(t,(()=>e++>=r))}return n&&(t=(0,h.Z)(t,n)),t}queryKeys(e){let t=(0,f.Z)(this._query({values:!1,prefix:e.prefix}),(({key:e})=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,u.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,d.Z)(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=(0,u.Z)(t,(()=>e++>=r))}return n&&(t=(0,h.Z)(t,n)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const r=e.prefix.toString();t.gte=r,t.lt=r+"ÿ"}const r=this.db.iterator(t);if(r[Symbol.asyncIterator])return async function*(e){for await(const[t,r]of e)yield{key:new n.s(t,!1),value:r};await e.close()}(r);if(null!=r.next&&null!=r.end)return i=r,{[Symbol.asyncIterator]:()=>({next:()=>new Promise(((e,t)=>{i.next(((r,s,o)=>r?t(r):null==s?i.end((r=>{if(r)return t(r);e({done:!0,value:void 0})})):void e({done:!1,value:{key:new n.s(s,!1),value:o}})))})),return:()=>new Promise(((e,t)=>{i.end((r=>{if(r)return t(r);e({done:!0,value:void 0})}))}))})};var i;throw new Error("Level returned incompatible iterator")}}},61711:function(e,t,r){"use strict";r.d(t,{R:function(){return w}});var n=r(64348);r(32114);r(66699);const i="SHARDING";const s=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();var o=r(93361),a=r(44752),c=r(56635);class u{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,o.Z)(this.putMany(e,r)),e=[],await(0,o.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,a.Z)(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,a.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>s(e,t)),r)),null!=e.offset){let t=0;r=(0,a.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,c.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,a.Z)(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,a.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>s(e,t)),r)),null!=e.offset){let t=0;r=(0,a.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,c.Z)(r,e.limit)),r}}new n.s(i),new n.s("_README");var h=r(69860);(0,h.kg)("datastore:core:tiered");var l=r(52770),f=r(49784),d=r(77408);const p="/record/";function y(e){return(0,f.B)(e,"base32")}function m(e){("string"==typeof e||e instanceof String)&&(e=(0,d.m)(e.toString()));const t=(0,f.B)(e,"base64url");return`${p}${t}`}var g=r(73062);const b=(0,h.kg)("datastore-pubsub:publisher");class w extends u{constructor(e,t,r,n,i,s){if(super(),!n)throw new l.s("missing validator","ERR_INVALID_PARAMETERS");if("function"!=typeof n)throw new l.s("missing validate function","ERR_INVALID_PARAMETERS");if("function"!=typeof i)throw new l.s("missing select function","ERR_INVALID_PARAMETERS");if(s&&"function"!=typeof s)throw new l.s("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=r,this._validator=n,this._selector=i,this._handleSubscriptionKeyFn=s,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,r){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw b.error(e),new l.s(e,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){const e="received value is not a Uint8Array";throw b.error(e),new l.s(e,"ERR_INVALID_VALUE_RECEIVED")}const n=m(e);b(`publish value for topic ${n}`),await this._pubsub.publish(n,t)}async get(e,t){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw b.error(e),new l.s(e,"ERR_INVALID_DATASTORE_KEY")}const r=m(e),n=await this._pubsub.getTopics();if(n&&Array.isArray(n)&&n.indexOf(r)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(r)}catch(e){const t=`cannot subscribe topic ${r}`;throw b.error(t),new l.s(t,"ERR_SUBSCRIBING_TOPIC")}return b(`subscribed values for key ${r}`),this._getLocal(e)}unsubscribe(e){const t=m(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){const r=new n.s("/"+y(e),!1);let i;try{i=await this._datastore.get(r,t)}catch(e){if("ERR_NOT_FOUND"!==e.code){const e=`unexpected error getting the ipns record for ${r.toString()}`;throw b.error(e),new l.s(e,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const t=`local record requested was not found for ${r.toString()}`;throw b.error(t),new l.s(t,"ERR_NOT_FOUND")}if(!(i instanceof Uint8Array)){const e="found record that we couldn't convert to a value";throw b.error(e),new l.s(e,"ERR_INVALID_RECORD_RECEIVED")}return i}async _onMessage(e){const t=e.detail;if("signed"!==t.type)return void b.error("unsigned message received, this module can only work with signed messages");const{data:r,from:n,topic:i}=t;let s;try{s=function(e){if(e.substring(0,p.length)!==p)throw new l.s("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");const t=e.substring(p.length);return(0,d.m)(t,"base64url")}(i)}catch(e){return void b.error(e)}if(b(`message received for topic ${i}`),this._peerId.equals(n))b("message discarded as it is from the same peer");else{if(this._handleSubscriptionKeyFn){let e;try{e=await this._handleSubscriptionKeyFn(s)}catch(e){return void b.error("message discarded by the subscriptionKeyFn")}s=e}try{await this._storeIfSubscriptionIsBetter(s,r)}catch(e){b.error(e)}}}async _storeIfSubscriptionIsBetter(e,t,r){let n=!1;try{n=await this._isBetter(e,t)}catch(e){if("ERR_NOT_VALID_RECORD"!==e.code)throw e}n&&await this._storeRecord(e,t,r)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return 0===await this._selector(e,t)}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch(e){const t="record received through pubsub is not valid";throw b.error(t),new l.s(t,"ERR_NOT_VALID_RECORD")}const r=new n.s(e);let i;try{i=await this._getLocal(r.uint8Array())}catch(e){return!0}return!(0,g.f)(i,t)&&this._selectRecord(e,[i,t])}async _storeRecord(e,t,r){const i=new n.s("/"+y(e),!1);await this._datastore.put(i,t,r),b(`record for ${m(e)} was stored in the datastore`)}}},41309:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(11227),i=r(73692);const s=globalThis.fetch,o=globalThis.Headers;globalThis.Request,globalThis.Response;function a(e,t,r){return`${e}?name=${t}&type=${r}`}async function c(e,t){const r=await s(e,{headers:new o({accept:"application/dns-json"}),signal:t});return await r.json()}function u(e,t){return`${t}_${e}`}const h=Object.assign(n("dns-over-http-resolver"),{error:n("dns-over-http-resolver:error")});var l=class{constructor(e={}){this._cache=new i({max:e?.maxCache??100}),this._TXTcache=new i({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??c,this._abortControllers=[]}cancel(){this._abortControllers.forEach((e=>e.abort()))}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*t),n=e[t];e[t]=e[r],e[r]=n}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",r=this._cache.get(u(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(a(r,e,t),i.signal),s=n.Answer.map((e=>e.data)),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._cache.set(u(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),h.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",r=this._cache.get(u(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(a(r,e,t),i.signal),s=n.Answer.map((e=>e.data)),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._cache.set(u(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),h.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",r=this._TXTcache.get(u(e,t));if(null!=r)return r;let n=!1;for(const r of this._getShuffledServers()){const i=new AbortController;this._abortControllers.push(i);try{const n=await this._request(a(r,e,t),i.signal),s=n.Answer.map((e=>[e.data.replace(/['"]+/g,"")])),o=Math.min(...n.Answer.map((e=>e.TTL)));return this._TXTcache.set(u(e,t),s,{ttl:o}),s}catch(s){i.signal.aborted&&(n=!0),h.error(`${r} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==i))}}if(n)throw Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}},85965:function(e,t,r){"use strict";r.d(t,{sk:function(){return G},Vq:function(){return _},Y3:function(){return K},Qc:function(){return H}});const n=Object.create(null);n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const i=Object.create(null);Object.keys(n).forEach((e=>{i[n[e]]=e}));const s={type:"error",data:"parser error"},o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,c=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};var u=({type:e,data:t},r,i)=>{return o&&t instanceof Blob?r?i(t):c(t,i):a&&(t instanceof ArrayBuffer||(s=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer))?r?i(t):c(new Blob([t]),i):i(n[e]+(t||""));var s};const h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<h.length;e++)l[h.charCodeAt(e)]=e;const f="function"==typeof ArrayBuffer,d=(e,t)=>{if(f){const r=(e=>{let t,r,n,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const u=new ArrayBuffer(o),h=new Uint8Array(u);for(t=0;t<a;t+=4)r=l[e.charCodeAt(t)],n=l[e.charCodeAt(t+1)],i=l[e.charCodeAt(t+2)],s=l[e.charCodeAt(t+3)],h[c++]=r<<2|n>>4,h[c++]=(15&n)<<4|i>>2,h[c++]=(3&i)<<6|63&s;return u})(e);return p(r,t)}return{base64:!0,data:e}},p=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e;var y=(e,t)=>{if("string"!=typeof e)return{type:"message",data:p(e,t)};const r=e.charAt(0);if("b"===r)return{type:"message",data:d(e.substring(1),t)};return i[r]?e.length>1?{type:i[r],data:e.substring(1)}:{type:i[r]}:s};const m=String.fromCharCode(30);var g=r(99748);const b="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function w(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const v=b.setTimeout,E=b.clearTimeout;function _(e,t){t.useNativeTimers?(e.setTimeoutFn=v.bind(b),e.clearTimeoutFn=E.bind(b)):(e.setTimeoutFn=b.setTimeout.bind(b),e.clearTimeoutFn=b.clearTimeout.bind(b))}class x extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class k extends g.Q{constructor(e){super(),this.writable=!1,_(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new x(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=y(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const S="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),A=64,I={};let T,P=0,C=0;function D(e){let t="";do{t=S[e%A]+t,e=Math.floor(e/A)}while(e>0);return t}function R(){const e=D(+new Date);return e!==T?(P=0,T=e):e+"."+D(P++)}for(;C<A;C++)I[S[C]]=C;function O(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}let N=!1;try{N="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const B=N;function M(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||B))return new XMLHttpRequest}catch(e){}if(!t)try{return new(b[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function L(){}const U=null!=new M({xdomain:!1}).responseType;class j extends g.Q{constructor(e,t){super(),_(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=w(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new M(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=j.requestsCount++,j.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=L,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete j.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(j.requestsCount=0,j.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",F);else if("function"==typeof addEventListener){addEventListener("onpagehide"in b?"pagehide":"unload",F,!1)}function F(){for(let e in j.requests)j.requests.hasOwnProperty(e)&&j.requests[e].abort()}const K="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),z=b.WebSocket||b.MozWebSocket;r(23085).lW;const $="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const V={websocket:class extends k{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=$?{}:w(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=$?new z(e,t,r):t?new z(e,t):new z(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;u(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&K((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=R()),this.supportsBinary||(e.b64=1);const n=O(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!z}},polling:class extends k{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=U&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(m),n=[];for(let e=0;e<r.length;e++){const i=y(r[e],t);if(n.push(i),"error"===i.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let i=0;e.forEach(((e,s)=>{u(e,!1,(e=>{n[s]=e,++i===r&&t(n.join(m))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=R()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=O(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new j(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},q=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,W=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function H(e){const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let i=q.exec(e||""),s={},o=14;for(;o--;)s[W[o]]=i[o]||"";return-1!=r&&-1!=n&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,s.path),s.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,s.query),s}class G extends g.Q{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=H(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=H(t.host).host),_(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new V[e](r)}open(){let e;if(this.opts.rememberUpgrade&&G.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;G.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;G.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){r||(r=!0,u(),t.close(),t=null)}const s=e=>{const r=new Error("probe error: "+e);r.transport=t.name,i(),this.emitReserved("upgradeError",r)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){t&&e.name!==t.name&&i()}const u=()=>{t.removeListener("open",n),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",G.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){G.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}G.protocol=4;G.protocol},95034:function(e,t,r){"use strict";r.d(t,{pM:function(){return a}});r(58090);var n=r(48764),i=r(33606),s=r(94391);const o={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4};async function a(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(t?.length>1)return u(s.FY(t))}function c(e,t,r){r={offset:0,...r};for(const[n,i]of t.entries())if(r.mask){if(i!==(r.mask[n]&e[n+r.offset]))return!1}else if(i!==e[n+r.offset])return!1;return!0}async function u(e){try{return(new h).parse(e)}catch(e){if(!(e instanceof s.dL))throw e}}class h{check(e,t){return c(this.buffer,e,t)}checkString(e,t){return this.check((r=e,[...r].map((e=>e.charCodeAt(0)))),t);var r}async parse(e){if(this.buffer=n.Buffer.alloc(4100),void 0===e.fileInfo.size&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.parse(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const t=await e.readToken(o);return e.position+t>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(t),u(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===this.buffer[0]||70===this.buffer[0])&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(this.buffer,{length:30});const r={compressedSize:this.buffer.readUInt32LE(18),uncompressedSize:this.buffer.readUInt32LE(22),filenameLength:this.buffer.readUInt16LE(26),extraFieldLength:this.buffer.readUInt16LE(28)};if(r.filename=await e.readToken(new i.uW(r.filenameLength,"utf-8")),await e.ignore(r.extraFieldLength),"META-INF/mozilla.rsa"===r.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(r.filename.endsWith(".rels")||r.filename.endsWith(".xml")){switch(r.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}}if(r.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(r.filename.startsWith("3D/")&&r.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===r.filename&&r.compressedSize===r.uncompressedSize){let a=await e.readToken(new i.uW(r.compressedSize,"utf-8"));switch(a=a.trim(),a){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}}if(0===r.compressedSize){let h=-1;for(;h<0&&e.position<e.fileInfo.size;)await e.peekBuffer(this.buffer,{mayBeLess:!0}),h=this.buffer.indexOf("504B0304",0,"hex"),await e.ignore(h>=0?h:this.buffer.length)}else await e.ignore(r.compressedSize)}}catch(l){if(!(l instanceof s.dL))throw l}return{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const f=n.Buffer.alloc(8);return await e.readBuffer(f),c(f,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:c(f,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:c(f,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:c(f,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:c(f,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:c(f,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(3===this.buffer[2]||5===this.buffer[2]||7===this.buffer[2])&&(4===this.buffer[3]||6===this.buffer[3]||8===this.buffer[3]))return{ext:"zip",mime:"application/zip"};if(this.checkString("ftyp",{offset:4})&&0!=(96&this.buffer[8])){const d=this.buffer.toString("binary",8,12).replace("\0"," ").trim();switch(d){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return d.startsWith("3g")?d.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF")){try{await e.ignore(1350);const p=10485760,y=n.Buffer.alloc(Math.min(p,e.fileInfo.size));if(await e.readBuffer(y,{mayBeLess:!0}),y.includes(n.Buffer.from("AIPrivateData")))return{ext:"ai",mime:"application/postscript"}}catch(m){if(!(m instanceof s.dL))throw m}return{ext:"pdf",mime:"application/pdf"}}if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const g=await this.readTiffHeader(!1);if(g)return g}if(this.check([77,77])){const b=await this.readTiffHeader(!0);if(b)return b}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function w(){const t=await e.peekNumber(i.fB);let r=128,s=0;for(;0==(t&r)&&0!==r;)++s,r>>=1;const o=n.Buffer.alloc(s+1);return await e.readBuffer(o),o}async function v(){const e=await w(),t=await w();t[0]^=128>>t.length-1;const r=Math.min(6,t.length);return{id:e.readUIntBE(0,e.length),len:t.readUIntBE(t.length-r,r)}}async function E(t){for(;t>0;){const r=await v();if(17026===r.id){return(await e.readToken(new i.uW(r.len,"utf-8"))).replace(/\00.*$/g,"")}await e.ignore(r.len),--t}}const _=await v();switch(await E(_.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(this.check([82,73,70,70])){if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1"))return{ext:"parquet",mime:"application/x-parquet"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(0===this.buffer[6]||1===this.buffer[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const x=this.buffer.toString("binary",2,6);if(x.match("^d*")&&x>=1e3&&x<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>")){await e.ignore(8);return"debian-binary"===await e.readToken(new i.uW(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"}}if(this.checkString("**ACE",{offset:7})&&(await e.peekBuffer(this.buffer,{length:14,mayBeLess:!0}),this.checkString("**",{offset:12})))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.check([137,80,78,71,13,10,26,10])){async function k(){return{length:await e.readToken(i.ZW),type:await e.readToken(new i.uW(4,"binary"))}}await e.ignore(8);do{const S=await k();if(S.length<0)return;switch(S.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(S.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function A(){const t=n.Buffer.alloc(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(i.zR))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const I=await A();let T=I.size-24;if(c(I.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const P=n.Buffer.alloc(16);if(T-=await e.readBuffer(P),c(P,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(c(P,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(T)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10])){await e.ignore(20);switch(await e.readToken(new i.uW(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const C=this.buffer.readUInt32LE(12);if(C>12&&this.buffer.length>=C+16)try{const D=this.buffer.slice(16,C+16).toString();if(JSON.parse(D).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),function(e,t=0){const r=Number.parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(r))return!1;let n=256;for(let r=t;r<t+148;r++)n+=e[r];for(let r=t+156;r<t+512;r++)n+=e[r];return r===n}(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(this.buffer.length>=2&&this.check([255,224],{offset:0,mask:[255,224]})){if(this.check([16],{offset:1,mask:[22]}))return this.check([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}async readTiffTag(e){const t=await this.tokenizer.readToken(e?i.US:i.p);switch(this.tokenizer.ignore(10),t){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?i.US:i.p);for(let r=0;r<t;++r){const t=await this.readTiffTag(e);if(t)return t}}async readTiffHeader(e){const t=(e?i.US:i.p).get(this.buffer,2),r=(e?i.jj:i.xW).get(this.buffer,4);if(42===t){if(r>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r>=8&&(this.check([28,0,254,0],{offset:8})||this.check([31,0,11,0],{offset:8})))return{ext:"nef",mime:"image/x-nikon-nef"}}await this.tokenizer.ignore(r);return await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(43===t)return{ext:"tif",mime:"image/tiff"}}}new Set(["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace"]),new Set(["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/x-parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed"])},1707:function(e,t,r){"use strict";r.d(t,{WY:function(){return j}});const n={parse:JSON.parse,stringify:JSON.stringify};var i=r(51268),s=r(40804),o=r(53458);const a=e=>i(e)||null!==e&&"object"==typeof e&&"function"==typeof e.pipe;var c=(e,t,r,i=n)=>{const{clone:c,files:u}=s({query:e,variables:t,operationName:r},"",a);if(0===u.size){if(!Array.isArray(e))return i.stringify(c);if(void 0!==t&&!Array.isArray(t))throw new Error("Cannot create request body with given variable type, array expected");const r=e.reduce(((e,r,n)=>(e.push({query:r,variables:t?t[n]:void 0}),e)),[]);return i.stringify(r)}const h=new("undefined"==typeof FormData?o:FormData);h.append("operations",i.stringify(c));const l={};let f=0;return u.forEach((e=>{l[++f]=e})),h.append("map",i.stringify(l)),f=0,u.forEach(((e,t)=>{h.append(""+ ++f,t)})),h};const u=(e,t,...r)=>{const[n,i]=r;return e.document?e:{url:e,document:t,variables:n,requestHeaders:i,signal:void 0}};var h=r(25202),l=r(7420);const f=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function d(e){return p[e.charCodeAt(0)]}const p=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"];var y=r(53767),m=r(6589),g=r(39504),b=r(6450);const w=Object.freeze({});function v(e,t,r=g.h8){const n=new Map;for(const e of Object.values(b.h))n.set(e,E(t,e));let i,s,o,a=Array.isArray(e),c=[e],u=-1,h=[],l=e;const f=[],d=[];do{u++;const e=u===c.length,b=e&&0!==h.length;if(e){if(s=0===d.length?void 0:f[f.length-1],l=o,o=d.pop(),b)if(a){l=l.slice();let e=0;for(const[t,r]of h){const n=t-e;null===r?(l.splice(n,1),e++):l[n]=r}}else{l=Object.defineProperties({},Object.getOwnPropertyDescriptors(l));for(const[e,t]of h)l[e]=t}u=i.index,c=i.keys,h=i.edits,a=i.inArray,i=i.prev}else if(o){if(s=a?u:c[u],l=o[s],null==l)continue;f.push(s)}let E;if(!Array.isArray(l)){var p,v;(0,g.UG)(l)||(0,y.a)(!1,`Invalid AST Node: ${(0,m.X)(l)}.`);const r=e?null===(p=n.get(l.kind))||void 0===p?void 0:p.leave:null===(v=n.get(l.kind))||void 0===v?void 0:v.enter;if(E=null==r?void 0:r.call(t,l,s,o,f,d),E===w)break;if(!1===E){if(!e){f.pop();continue}}else if(void 0!==E&&(h.push([s,E]),!e)){if(!(0,g.UG)(E)){f.pop();continue}l=E}}var _;if(void 0===E&&b&&h.push([s,l]),e)f.pop();else i={inArray:a,index:u,keys:c,edits:h,prev:i},a=Array.isArray(l),c=a?l:null!==(_=r[l.kind])&&void 0!==_?_:[],u=-1,h=[],o&&d.push(o),o=l}while(void 0!==i);return 0!==h.length?h[h.length-1][1]:e}function E(e,t){const r=e[t];return"object"==typeof r?r:"function"==typeof r?{enter:r,leave:void 0}:{enter:e.enter,leave:e.leave}}function _(e){return v(e,x)}const x={Name:{leave:e=>e.value},Variable:{leave:e=>"$"+e.name},Document:{leave:e=>k(e.definitions,"\n\n")},OperationDefinition:{leave(e){const t=A("(",k(e.variableDefinitions,", "),")"),r=k([e.operation,k([e.name,t]),k(e.directives," ")]," ");return("query"===r?"":r+" ")+e.selectionSet}},VariableDefinition:{leave:({variable:e,type:t,defaultValue:r,directives:n})=>e+": "+t+A(" = ",r)+A(" ",k(n," "))},SelectionSet:{leave:({selections:e})=>S(e)},Field:{leave({alias:e,name:t,arguments:r,directives:n,selectionSet:i}){const s=A("",e,": ")+t;let o=s+A("(",k(r,", "),")");return o.length>80&&(o=s+A("(\n",I(k(r,"\n")),"\n)")),k([o,k(n," "),i]," ")}},Argument:{leave:({name:e,value:t})=>e+": "+t},FragmentSpread:{leave:({name:e,directives:t})=>"..."+e+A(" ",k(t," "))},InlineFragment:{leave:({typeCondition:e,directives:t,selectionSet:r})=>k(["...",A("on ",e),k(t," "),r]," ")},FragmentDefinition:{leave:({name:e,typeCondition:t,variableDefinitions:r,directives:n,selectionSet:i})=>`fragment ${e}${A("(",k(r,", "),")")} on ${t} ${A("",k(n," ")," ")}`+i},IntValue:{leave:({value:e})=>e},FloatValue:{leave:({value:e})=>e},StringValue:{leave:({value:e,block:t})=>t?(0,l.LZ)(e):`"${e.replace(f,d)}"`},BooleanValue:{leave:({value:e})=>e?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:e})=>e},ListValue:{leave:({values:e})=>"["+k(e,", ")+"]"},ObjectValue:{leave:({fields:e})=>"{"+k(e,", ")+"}"},ObjectField:{leave:({name:e,value:t})=>e+": "+t},Directive:{leave:({name:e,arguments:t})=>"@"+e+A("(",k(t,", "),")")},NamedType:{leave:({name:e})=>e},ListType:{leave:({type:e})=>"["+e+"]"},NonNullType:{leave:({type:e})=>e+"!"},SchemaDefinition:{leave:({description:e,directives:t,operationTypes:r})=>A("",e,"\n")+k(["schema",k(t," "),S(r)]," ")},OperationTypeDefinition:{leave:({operation:e,type:t})=>e+": "+t},ScalarTypeDefinition:{leave:({description:e,name:t,directives:r})=>A("",e,"\n")+k(["scalar",t,k(r," ")]," ")},ObjectTypeDefinition:{leave:({description:e,name:t,interfaces:r,directives:n,fields:i})=>A("",e,"\n")+k(["type",t,A("implements ",k(r," & ")),k(n," "),S(i)]," ")},FieldDefinition:{leave:({description:e,name:t,arguments:r,type:n,directives:i})=>A("",e,"\n")+t+(T(r)?A("(\n",I(k(r,"\n")),"\n)"):A("(",k(r,", "),")"))+": "+n+A(" ",k(i," "))},InputValueDefinition:{leave:({description:e,name:t,type:r,defaultValue:n,directives:i})=>A("",e,"\n")+k([t+": "+r,A("= ",n),k(i," ")]," ")},InterfaceTypeDefinition:{leave:({description:e,name:t,interfaces:r,directives:n,fields:i})=>A("",e,"\n")+k(["interface",t,A("implements ",k(r," & ")),k(n," "),S(i)]," ")},UnionTypeDefinition:{leave:({description:e,name:t,directives:r,types:n})=>A("",e,"\n")+k(["union",t,k(r," "),A("= ",k(n," | "))]," ")},EnumTypeDefinition:{leave:({description:e,name:t,directives:r,values:n})=>A("",e,"\n")+k(["enum",t,k(r," "),S(n)]," ")},EnumValueDefinition:{leave:({description:e,name:t,directives:r})=>A("",e,"\n")+k([t,k(r," ")]," ")},InputObjectTypeDefinition:{leave:({description:e,name:t,directives:r,fields:n})=>A("",e,"\n")+k(["input",t,k(r," "),S(n)]," ")},DirectiveDefinition:{leave:({description:e,name:t,arguments:r,repeatable:n,locations:i})=>A("",e,"\n")+"directive @"+t+(T(r)?A("(\n",I(k(r,"\n")),"\n)"):A("(",k(r,", "),")"))+(n?" repeatable":"")+" on "+k(i," | ")},SchemaExtension:{leave:({directives:e,operationTypes:t})=>k(["extend schema",k(e," "),S(t)]," ")},ScalarTypeExtension:{leave:({name:e,directives:t})=>k(["extend scalar",e,k(t," ")]," ")},ObjectTypeExtension:{leave:({name:e,interfaces:t,directives:r,fields:n})=>k(["extend type",e,A("implements ",k(t," & ")),k(r," "),S(n)]," ")},InterfaceTypeExtension:{leave:({name:e,interfaces:t,directives:r,fields:n})=>k(["extend interface",e,A("implements ",k(t," & ")),k(r," "),S(n)]," ")},UnionTypeExtension:{leave:({name:e,directives:t,types:r})=>k(["extend union",e,k(t," "),A("= ",k(r," | "))]," ")},EnumTypeExtension:{leave:({name:e,directives:t,values:r})=>k(["extend enum",e,k(t," "),S(r)]," ")},InputObjectTypeExtension:{leave:({name:e,directives:t,fields:r})=>k(["extend input",e,k(t," "),S(r)]," ")}};function k(e,t=""){var r;return null!==(r=null==e?void 0:e.filter((e=>e)).join(t))&&void 0!==r?r:""}function S(e){return A("{\n",I(k(e,"\n")),"\n}")}function A(e,t,r=""){return null!=t&&""!==t?e+t+r:""}function I(e){return A("  ",e.replace(/\n/g,"\n  "))}function T(e){var t;return null!==(t=null==e?void 0:e.some((e=>e.includes("\n"))))&&void 0!==t&&t}const P=e=>{let t;const r=e.definitions.filter((e=>"OperationDefinition"===e.kind));return 1===r.length&&(t=r[0]?.name?.value),t},C=e=>{if("string"==typeof e){let t;try{const r=(0,h.Qc)(e);t=P(r)}catch(e){}return{query:e,operationName:t}}const t=P(e);return{query:_(e),operationName:t}};class D extends Error{constructor(e,t){super(`${D.extractMessage(e)}: ${JSON.stringify({response:e,request:t})}`),Object.setPrototypeOf(this,D.prototype),this.response=e,this.request=t,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,D)}static extractMessage(e){return e.errors?.[0]?.message??`GraphQL Error (Code: ${e.status})`}}var R=r(74077),O=r.t(R,2);r(25108);const N=e=>{let t={};return e&&("undefined"!=typeof Headers&&e instanceof Headers||O&&R.Headers&&e instanceof R.Headers?t=(e=>{const t={};return e.forEach(((e,r)=>{t[r]=e})),t})(e):Array.isArray(e)?e.forEach((([e,r])=>{e&&void 0!==r&&(t[e]=r)})):t=e),t},B=e=>e.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),M=e=>async t=>{const{url:r,query:i,variables:s,operationName:o,fetch:a,fetchOptions:u,middleware:h}=t,l={...t.headers};let f,d="";"POST"===e?(f=c(i,s,o,u.jsonSerializer),"string"==typeof f&&(l["Content-Type"]="application/json")):d=(e=>{if(!Array.isArray(e.query)){const t=e,r=[`query=${encodeURIComponent(B(t.query))}`];return e.variables&&r.push(`variables=${encodeURIComponent(t.jsonSerializer.stringify(t.variables))}`),t.operationName&&r.push(`operationName=${encodeURIComponent(t.operationName)}`),r.join("&")}if(void 0!==e.variables&&!Array.isArray(e.variables))throw new Error("Cannot create query with given variable type, array expected");const t=e,r=e.query.reduce(((e,r,n)=>(e.push({query:B(r),variables:t.variables?t.jsonSerializer.stringify(t.variables[n]):void 0}),e)),[]);return`query=${encodeURIComponent(t.jsonSerializer.stringify(r))}`})({query:i,variables:s,operationName:o,jsonSerializer:u.jsonSerializer??n});const p={method:e,headers:l,body:f,...u};let y=r,m=p;if(h){const e=await Promise.resolve(h({...p,url:r,operationName:o,variables:s})),{url:t,...n}=e;y=t,m=n}return d&&(y=`${y}?${d}`),await a(y,m)};class L{constructor(e,t={}){this.url=e,this.requestConfig=t,this.rawRequest=async(...e)=>{const[t,r,n]=e,i=((e,t,r)=>e.query?e:{query:e,variables:t,requestHeaders:r,signal:void 0})(t,r,n),{headers:s,fetch:o=R,method:a="POST",requestMiddleware:c,responseMiddleware:u,...h}=this.requestConfig,{url:l}=this;void 0!==i.signal&&(h.signal=i.signal);const{operationName:f}=C(i.query);return U({url:l,query:i.query,variables:i.variables,headers:{...N(K(s)),...N(i.requestHeaders)},operationName:f,fetch:o,method:a,fetchOptions:h,middleware:c}).then((e=>(u&&u(e),e))).catch((e=>{throw u&&u(e),e}))}}async request(e,...t){const[r,n]=t,i=((e,t,r)=>e.document?e:{document:e,variables:t,requestHeaders:r,signal:void 0})(e,r,n),{headers:s,fetch:o=R,method:a="POST",requestMiddleware:c,responseMiddleware:u,...h}=this.requestConfig,{url:l}=this;void 0!==i.signal&&(h.signal=i.signal);const{query:f,operationName:d}=C(i.document);return U({url:l,query:f,variables:i.variables,headers:{...N(K(s)),...N(i.requestHeaders)},operationName:d,fetch:o,method:a,fetchOptions:h,middleware:c}).then((e=>(u&&u(e),e.data))).catch((e=>{throw u&&u(e),e}))}batchRequests(e,t){const r=((e,t)=>e.documents?e:{documents:e,requestHeaders:t,signal:void 0})(e,t),{headers:n,...i}=this.requestConfig;void 0!==r.signal&&(i.signal=r.signal);const s=r.documents.map((({document:e})=>C(e).query)),o=r.documents.map((({variables:e})=>e));return U({url:this.url,query:s,variables:o,headers:{...N(K(n)),...N(r.requestHeaders)},operationName:void 0,fetch:this.requestConfig.fetch??R,method:this.requestConfig.method||"POST",fetchOptions:i,middleware:this.requestConfig.requestMiddleware}).then((e=>(this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e.data))).catch((e=>{throw this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e}))}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,t){const{headers:r}=this.requestConfig;return r?r[e]=t:this.requestConfig.headers={[e]:t},this}setEndpoint(e){return this.url=e,this}}const U=async e=>{const{query:t,variables:r,fetchOptions:i}=e,s=M((e.method??"post").toUpperCase());const o=Array.isArray(e.query),a=await s(e),c=await F(a,i.jsonSerializer??n),u=Array.isArray(c)?!c.some((({data:e})=>!e)):Boolean(c.data),h=Array.isArray(c)||!c.errors||Array.isArray(c.errors)&&!c.errors.length||"all"===i.errorPolicy||"ignore"===i.errorPolicy;if(a.ok&&h&&u){const{errors:e,...t}=(Array.isArray(c),c),r="ignore"===i.errorPolicy?t:c;return{...o?{data:r}:r,headers:a.headers,status:a.status}}throw new D({..."string"==typeof c?{error:c}:c,status:a.status,headers:a.headers},{query:t,variables:r})};async function j(e,t,...r){const n=u(e,t,...r);return new L(n.url).request({...n})}const F=async(e,t)=>{let r;return e.headers.forEach(((e,t)=>{"content-type"===t.toLowerCase()&&(r=e)})),r&&(r.toLowerCase().startsWith("application/json")||r.toLowerCase().startsWith("application/graphql+json")||r.toLowerCase().startsWith("application/graphql-response+json"))?t.parse(await e.text()):e.text()},K=e=>"function"==typeof e?e():e},96991:function(e,t,r){"use strict";r.d(t,{r:function(){return s},$:function(){return m}});var n=r(20544),i=r(77408);class s{constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new n,this.key=null}async put(e,t){const r=await this._findNewBucketAndPos(e);await r.bucket._putAt(r,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((e,t)=>t instanceof s?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof s?yield*t.eachLeafSeries():yield t}serialize(e,t){return t(this._children.reduce(((r,n,i)=>(null!=n&&(n instanceof s?r.push(n.serialize(e,t)):r.push(e(n,i))),r)),[]))}async asyncTransform(e,t){return await u(this,e,t)}toJSON(){return this.serialize(a,c)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);if(!(r instanceof s))return null!=r&&r.key===e?r:void 0}async _findPlace(e){const t=this._options.hash("string"==typeof e?(0,i.m)(e):e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof s?await n._findPlace(t):{bucket:this,pos:r,hash:t,existingChild:n}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){const e=new s(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const r=await e._findPlace(t.existingChild.hash);return r.bucket._putAt(r,t.existingChild.key,t.existingChild.value),await e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(o);if(null!=e&&!(e instanceof s)){const t=e.hash;t.untake(this._options.bits);const r={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function o(e){return Boolean(e)}function a(e,t){return e.key}function c(e){return e}async function u(e,t,r){const n=[];for(const i of e._children.compactArray())if(i instanceof s)await u(i,t,r);else{const r=await t(i);n.push({bitField:e._children.bitField(),children:r})}return await r(n)}const h=[255,254,252,248,240,224,192,128],l=[1,3,7,15,31,63,127,255];class f{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,i=Math.min(n,t);r=(r<<i)+d(e,n-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function d(e,t,r){const n=function(e,t){return h[e]&l[Math.min(t+e-1,7)]}(t,r);return(e&n)>>>t}var p=r(41690);class y{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?(0,p.z)([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new f(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}function m(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const t={bits:e.bits??8,hash:(r=e.hashFn,function(e){return e instanceof y?e:new y(e,r)})};var r;return new s(t)}},21771:function(e,t,r){"use strict";r.d(t,{F:function(){return Dd}});var n={};r.r(n),r.d(n,{base32:function(){return ue},base32hex:function(){return de},base32hexpad:function(){return ye},base32hexpadupper:function(){return me},base32hexupper:function(){return pe},base32pad:function(){return le},base32padupper:function(){return fe},base32upper:function(){return he},base32z:function(){return ge}});var i={};r.r(i),r.d(i,{base58btc:function(){return be},base58flickr:function(){return we}});var s={};r.r(s),r.d(s,{base64:function(){return ve},base64pad:function(){return Ee},base64url:function(){return _e},base64urlpad:function(){return xe}});var o={};r.r(o),r.d(o,{identity:function(){return Ze}});var a={};r.r(a),r.d(a,{sha256:function(){return nt},sha512:function(){return it}});var c={};r.r(c),r.d(c,{base36:function(){return Vr},base36upper:function(){return qr}});var u={};r.r(u),r.d(u,{code:function(){return ri},decode:function(){return ii},encode:function(){return ni},name:function(){return ti}});var h={};r.r(h),r.d(h,{code:function(){return oi},decode:function(){return ci},encode:function(){return ai},name:function(){return si}});var l={};r.r(l),r.d(l,{base58btc:function(){return Vi},base58flickr:function(){return qi}});var f={};r.r(f),r.d(f,{base10:function(){return Wi}});var d={};r.r(d),r.d(d,{base16:function(){return Hi},base16upper:function(){return Gi}});var p={};r.r(p),r.d(p,{base2:function(){return Yi}});var y={};r.r(y),r.d(y,{base256emoji:function(){return Zi}});var m={};r.r(m),r.d(m,{base32:function(){return es},base32hex:function(){return is},base32hexpad:function(){return os},base32hexpadupper:function(){return as},base32hexupper:function(){return ss},base32pad:function(){return rs},base32padupper:function(){return ns},base32upper:function(){return ts},base32z:function(){return cs}});var g={};r.r(g),r.d(g,{base36:function(){return us},base36upper:function(){return hs}});var b={};r.r(b),r.d(b,{base64:function(){return ls},base64pad:function(){return fs},base64url:function(){return ds},base64urlpad:function(){return ps}});var w={};r.r(w),r.d(w,{base8:function(){return ys}});var v={};r.r(v),r.d(v,{identity:function(){return ms}});var E={};r.r(E),r.d(E,{code:function(){return vs},decode:function(){return _s},encode:function(){return Es},name:function(){return ws}});var _={};r.r(_),r.d(_,{code:function(){return ks},decode:function(){return As},encode:function(){return Ss},name:function(){return xs}});var x={};r.r(x),r.d(x,{identity:function(){return Xs}});var k={};r.r(k),r.d(k,{sha256:function(){return to},sha512:function(){return ro}});var S={};r.r(S),r.d(S,{Ed25519PrivateKey:function(){return ua},Ed25519PublicKey:function(){return ca},generateKeyPair:function(){return fa},generateKeyPairFromSeed:function(){return da},unmarshalEd25519PrivateKey:function(){return ha},unmarshalEd25519PublicKey:function(){return la}});var A={};r.r(A),r.d(A,{MAX_KEY_SIZE:function(){return Aa},RsaPrivateKey:function(){return Ta},RsaPublicKey:function(){return Ia},fromJwk:function(){return Da},generateKeyPair:function(){return Ra},unmarshalRsaPrivateKey:function(){return Pa},unmarshalRsaPublicKey:function(){return Ca}});var I={};r.r(I),r.d(I,{Secp256k1PrivateKey:function(){return Ma},Secp256k1PublicKey:function(){return Ba},generateKeyPair:function(){return ja},unmarshalSecp256k1PrivateKey:function(){return La},unmarshalSecp256k1PublicKey:function(){return Ua}});var T={};r.r(T),r.d(T,{identity:function(){return iu}});var P={};r.r(P),r.d(P,{base2:function(){return su}});var C={};r.r(C),r.d(C,{base8:function(){return ou}});var D={};r.r(D),r.d(D,{base10:function(){return au}});var R={};r.r(R),r.d(R,{base16:function(){return cu},base16upper:function(){return uu}});var O={};r.r(O),r.d(O,{base32:function(){return hu},base32hex:function(){return pu},base32hexpad:function(){return mu},base32hexpadupper:function(){return gu},base32hexupper:function(){return yu},base32pad:function(){return fu},base32padupper:function(){return du},base32upper:function(){return lu},base32z:function(){return bu}});var N={};r.r(N),r.d(N,{base36:function(){return wu},base36upper:function(){return vu}});var B={};r.r(B),r.d(B,{base58btc:function(){return Eu},base58flickr:function(){return _u}});var M={};r.r(M),r.d(M,{base64:function(){return xu},base64pad:function(){return ku},base64url:function(){return Su},base64urlpad:function(){return Au}});var L={};r.r(L),r.d(L,{base256emoji:function(){return Cu}});var U={};r.r(U),r.d(U,{sha256:function(){return th},sha512:function(){return rh}});var j={};r.r(j),r.d(j,{identity:function(){return ih}});var F={};r.r(F),r.d(F,{code:function(){return oh},decode:function(){return ch},encode:function(){return ah},name:function(){return sh}});var K={};r.r(K),r.d(K,{code:function(){return fh},decode:function(){return ph},encode:function(){return dh},name:function(){return lh}});var z={};r.r(z),r.d(z,{base10:function(){return Xh}});var $={};r.r($),r.d($,{base16:function(){return Qh},base16upper:function(){return Zh}});var V={};r.r(V),r.d(V,{base2:function(){return el}});var q={};r.r(q),r.d(q,{base256emoji:function(){return il}});var W={};r.r(W),r.d(W,{base8:function(){return sl}});var H={};r.r(H),r.d(H,{identity:function(){return ol}});var G={};r.r(G),r.d(G,{Ed25519PrivateKey:function(){return cf},Ed25519PublicKey:function(){return af},generateKeyPair:function(){return lf},generateKeyPairFromSeed:function(){return ff},unmarshalEd25519PrivateKey:function(){return uf},unmarshalEd25519PublicKey:function(){return hf}});var Y={};r.r(Y),r.d(Y,{MAX_KEY_SIZE:function(){return Af},RsaPrivateKey:function(){return Tf},RsaPublicKey:function(){return If},fromJwk:function(){return Df},generateKeyPair:function(){return Rf},unmarshalRsaPrivateKey:function(){return Pf},unmarshalRsaPublicKey:function(){return Cf}});var J={};r.r(J),r.d(J,{Secp256k1PrivateKey:function(){return Bf},Secp256k1PublicKey:function(){return Nf},generateKeyPair:function(){return Uf},unmarshalSecp256k1PrivateKey:function(){return Mf},unmarshalSecp256k1PublicKey:function(){return Lf}});var X=r(11227);var Q=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Z=Q;new Uint8Array(0);const ee=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class te{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class re{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ie(this,e)}}class ne{constructor(e){this.decoders=e}or(e){return ie(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ie=(e,t)=>new ne({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class se{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new te(e,t,r),this.decoder=new re(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const oe=({name:e,prefix:t,encode:r,decode:n})=>new se(e,t,r,n),ae=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Z(r,t);return oe({prefix:e,name:t,encode:n,decode:e=>ee(i(e))})},ce=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>oe({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),ue=ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),he=ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),le=ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),fe=ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),de=ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pe=ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ye=ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),me=ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ge=ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),be=ae({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),we=ae({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ve=ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ee=ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),_e=ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xe=ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function ke(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return X.enabled(`${e}:trace`)&&null!=X.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=X(`${e}:trace`)),Object.assign(X(e),{error:X(`${e}:error`),trace:t})}X.formatters.b=e=>null==e?"undefined":be.baseEncode(e),X.formatters.t=e=>null==e?"undefined":ue.baseEncode(e),X.formatters.m=e=>null==e?"undefined":ve.baseEncode(e),X.formatters.p=e=>null==e?"undefined":e.toString(),X.formatters.c=e=>null==e?"undefined":e.toString(),X.formatters.k=e=>null==e?"undefined":e.toString(),X.formatters.a=e=>null==e?"undefined":e.toString();var Se=r(98724),Ae=r(32651),Ie=r(44837);var Te=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);},Pe=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Re;)r[n++]=255&t|Ce,t/=128;for(;t&De;)r[n++]=255&t|Ce,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Ce=128,De=-128,Re=Math.pow(2,31);var Oe=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Be)<<s:(n&Be)*Math.pow(2,s),s+=7}while(n>=Ne);return e.bytes=o-r,i},Ne=128,Be=127;var Me=Math.pow(2,7),Le=Math.pow(2,14),Ue=Math.pow(2,21),je=Math.pow(2,28),Fe=Math.pow(2,35),Ke=Math.pow(2,42),ze=Math.pow(2,49),$e=Math.pow(2,56),Ve=Math.pow(2,63),qe={encode:Pe,decode:Oe,encodingLength:function(e){return e<Me?1:e<Le?2:e<Ue?3:e<je?4:e<Fe?5:e<Ke?6:e<ze?7:e<$e?8:e<Ve?9:10}};const We=(e,t=0)=>[qe.decode(e,t),qe.decode.bytes],He=(e,t,r=0)=>(qe.encode(e,t,r),t),Ge=e=>qe.encodingLength(e),Ye=(e,t)=>{const r=t.byteLength,n=Ge(e),i=n+Ge(r),s=new Uint8Array(i+r);return He(e,s,0),He(r,s,n),s.set(t,i),new Xe(e,r,t,s)},Je=e=>{const t=ee(e),[r,n]=We(t),[i,s]=We(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Xe(r,i,o,t)};class Xe{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Qe=ee,Ze={code:0,name:"identity",encode:Qe,digest:e=>Ye(0,Qe(e))},et=({name:e,code:t,encode:r})=>new tt(e,t,r);class tt{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ye(this.code,t):t.then((e=>Ye(this.code,e)))}throw Error("Unknown type, must be binary type")}}const rt=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),nt=et({name:"sha2-256",code:18,encode:rt("SHA-256")}),it=et({name:"sha2-512",code:19,encode:rt("SHA-512")});var st=r(43905);const ot=["string","number","bigint","symbol"],at=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function ct(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(ot.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const r=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(at.includes(t))return t;return}(e);return r||"Object"}class ut{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}ut.uint=new ut(0,"uint",!0),ut.negint=new ut(1,"negint",!0),ut.bytes=new ut(2,"bytes",!0),ut.string=new ut(3,"string",!0),ut.array=new ut(4,"array",!1),ut.map=new ut(5,"map",!1),ut.tag=new ut(6,"tag",!1),ut.float=new ut(7,"float",!0),ut.false=new ut(7,"false",!0),ut.true=new ut(7,"true",!0),ut.null=new ut(7,"null",!0),ut.undefined=new ut(7,"undefined",!0),ut.break=new ut(7,"break",!0);class ht{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const lt=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,ft=new TextDecoder,dt=new TextEncoder;function pt(e){return lt&&globalThis.Buffer.isBuffer(e)}function yt(e){return e instanceof Uint8Array?pt(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const mt=lt?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):xt(e,t,r):(e,t,r)=>r-t>64?ft.decode(e.subarray(t,r)):xt(e,t,r),gt=lt?e=>e.length>64?globalThis.Buffer.from(e):_t(e):e=>e.length>64?dt.encode(e):_t(e),bt=e=>Uint8Array.from(e),wt=lt?(e,t,r)=>pt(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),vt=lt?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),yt(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},Et=lt?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function _t(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return t}function xt(e,t,r){const n=[];for(;t<r;){const i=e[t];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:i<128&&(s=i);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&i)<<6|63&r,c>127&&(s=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&i)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),t+=o}return St(n)}const kt=4096;function St(e){const t=e.length;if(t<=kt)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=kt));return r}class At{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Et(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=wt(r,0,this.cursor)}else t=vt(this.chunks,this.cursor);return e&&this.reset(),t}}const It="CBOR decode error:",Tt="CBOR encode error:",Pt=[];function Ct(e,t,r){if(e.length-t<r)throw new Error(`${It} not enough data for type`)}Pt[23]=1,Pt[24]=2,Pt[25]=3,Pt[26]=5,Pt[27]=9;const Dt=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Rt(e,t,r){Ct(e,t,1);const n=e[t];if(!0===r.strict&&n<Dt[0])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);return n}function Ot(e,t,r){Ct(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<Dt[1])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);return n}function Nt(e,t,r){Ct(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<Dt[2])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);return n}function Bt(e,t,r){Ct(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(n)<<BigInt(32))+BigInt(i);if(!0===r.strict&&s<Dt[3])throw new Error(`${It} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===r.allowBigInt)return s;throw new Error(`${It} integers outside of the safe integer range are not supported`)}function Mt(e,t){return Lt(e,0,t.value)}function Lt(e,t,r){if(r<Dt[0]){const n=Number(r);e.push([t|n])}else if(r<Dt[1]){const n=Number(r);e.push([24|t,n])}else if(r<Dt[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<Dt[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<Dt[4]))throw new Error(`${It} encountered BigInt larger than allowable range`);{const r=[27|t,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&i,i>>=8,r[7]=255&i,i>>=8,r[6]=255&i,i>>=8,r[5]=255&i,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,e.push(r)}}}Mt.encodedSize=function(e){return Lt.encodedSize(e.value)},Lt.encodedSize=function(e){return e<Dt[0]?1:e<Dt[1]?2:e<Dt[2]?3:e<Dt[3]?5:9},Mt.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const Ut=BigInt(-1),jt=BigInt(1);function Ft(e,t){const r=t.value,n="bigint"==typeof r?r*Ut-jt:-1*r-1;Lt(e,t.type.majorEncoded,n)}function Kt(e,t,r,n){Ct(e,t,r+n);const i=wt(e,t+r,t+r+n);return new ht(ut.bytes,i,r+n)}function zt(e,t,r,n){return Kt(e,t,1,r)}function $t(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===ut.string?gt(e.value):e.value),e.encodedBytes}function Vt(e,t){const r=$t(t);Lt(e,t.type.majorEncoded,r.length),e.push(r)}function qt(e,t,r,n,i){const s=r+n;Ct(e,t,s);const o=new ht(ut.string,mt(e,t+r,t+s),s);return!0===i.retainStringBytes&&(o.byteValue=wt(e,t+r,t+s)),o}function Wt(e,t,r,n){return qt(e,t,1,r,n)}Ft.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*Ut-jt:-1*t-1;return r<Dt[0]?1:r<Dt[1]?2:r<Dt[2]?3:r<Dt[3]?5:9},Ft.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Vt.encodedSize=function(e){const t=$t(e);return Lt.encodedSize(t.length)+t.length},Vt.compareTokens=function(e,t){return r=$t(e),n=$t(t),r.length<n.length?-1:r.length>n.length?1:function(e,t){if(pt(e)&&pt(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}(r,n);var r,n};const Ht=Vt;function Gt(e,t,r,n){return new ht(ut.array,n,r)}function Yt(e,t,r,n){return Gt(0,0,1,r)}function Jt(e,t){Lt(e,ut.array.majorEncoded,t.value)}function Xt(e,t,r,n){return new ht(ut.map,n,r)}function Qt(e,t,r,n){return Xt(0,0,1,r)}function Zt(e,t){Lt(e,ut.map.majorEncoded,t.value)}function er(e,t,r,n){return new ht(ut.tag,r,1)}function tr(e,t){Lt(e,ut.tag.majorEncoded,t.value)}Jt.compareTokens=Mt.compareTokens,Jt.encodedSize=function(e){return Lt.encodedSize(e.value)},Zt.compareTokens=Mt.compareTokens,Zt.encodedSize=function(e){return Lt.encodedSize(e.value)},tr.compareTokens=Mt.compareTokens,tr.encodedSize=function(e){return Lt.encodedSize(e.value)};const rr=20,nr=21,ir=22,sr=23;function or(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error(`${It} NaN values are not supported`);if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${It} Infinity values are not supported`)}return new ht(ut.float,e,t)}function ar(e,t,r){const n=t.value;if(!1===n)e.push([ut.float.majorEncoded|rr]);else if(!0===n)e.push([ut.float.majorEncoded|nr]);else if(null===n)e.push([ut.float.majorEncoded|ir]);else if(void 0===n)e.push([ut.float.majorEncoded|sr]);else{let t,s=!1;r&&!0===r.float64||(lr(n),t=fr(hr,1),n===t||Number.isNaN(n)?(hr[0]=249,e.push(hr.slice(0,3)),s=!0):(dr(n),t=pr(hr,1),n===t&&(hr[0]=250,e.push(hr.slice(0,5)),s=!0))),s||(i=n,ur.setFloat64(0,i,!1),t=yr(hr,1),hr[0]=251,e.push(hr.slice(0,9)))}var i}ar.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;if(!t||!0!==t.float64){lr(r);let e=fr(hr,1);if(r===e||Number.isNaN(r))return 3;if(dr(r),e=pr(hr,1),r===e)return 5}return 9};const cr=new ArrayBuffer(9),ur=new DataView(cr,1),hr=new Uint8Array(cr,0);function lr(e){if(e===1/0)ur.setUint16(0,31744,!1);else if(e===-1/0)ur.setUint16(0,64512,!1);else if(Number.isNaN(e))ur.setUint16(0,32256,!1);else{ur.setFloat32(0,e);const t=ur.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)ur.setUint16(0,31744,!1);else if(0===r)ur.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?ur.setUint16(0,0):e<-14?ur.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):ur.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function fr(e,t){if(e.length-t<2)throw new Error(`${It} not enough data for float16`);const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,i=1023&r;let s;return s=0===n?i*2**-24:31!==n?(i+1024)*2**(n-25):0===i?1/0:NaN,32768&r?-s:s}function dr(e){ur.setFloat32(0,e,!1)}function pr(e,t){if(e.length-t<4)throw new Error(`${It} not enough data for float32`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function yr(e,t){if(e.length-t<8)throw new Error(`${It} not enough data for float64`);const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function mr(e,t,r){throw new Error(`${It} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function gr(e){return()=>{throw new Error(`${It} ${e}`)}}ar.compareTokens=Mt.compareTokens;const br=[];for(let e=0;e<=23;e++)br[e]=mr;br[24]=function(e,t,r,n){return new ht(ut.uint,Rt(e,t+1,n),2)},br[25]=function(e,t,r,n){return new ht(ut.uint,Ot(e,t+1,n),3)},br[26]=function(e,t,r,n){return new ht(ut.uint,Nt(e,t+1,n),5)},br[27]=function(e,t,r,n){return new ht(ut.uint,Bt(e,t+1,n),9)},br[28]=mr,br[29]=mr,br[30]=mr,br[31]=mr;for(let e=32;e<=55;e++)br[e]=mr;br[56]=function(e,t,r,n){return new ht(ut.negint,-1-Rt(e,t+1,n),2)},br[57]=function(e,t,r,n){return new ht(ut.negint,-1-Ot(e,t+1,n),3)},br[58]=function(e,t,r,n){return new ht(ut.negint,-1-Nt(e,t+1,n),5)},br[59]=function(e,t,r,n){const i=Bt(e,t+1,n);if("bigint"!=typeof i){const e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new ht(ut.negint,e,9)}if(!0!==n.allowBigInt)throw new Error(`${It} integers outside of the safe integer range are not supported`);return new ht(ut.negint,Ut-BigInt(i),9)},br[60]=mr,br[61]=mr,br[62]=mr,br[63]=mr;for(let e=64;e<=87;e++)br[e]=zt;br[88]=function(e,t,r,n){return Kt(e,t,2,Rt(e,t+1,n))},br[89]=function(e,t,r,n){return Kt(e,t,3,Ot(e,t+1,n))},br[90]=function(e,t,r,n){return Kt(e,t,5,Nt(e,t+1,n))},br[91]=function(e,t,r,n){const i=Bt(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer bytes lengths not supported`);return Kt(e,t,9,i)},br[92]=mr,br[93]=mr,br[94]=mr,br[95]=gr("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)br[e]=Wt;br[120]=function(e,t,r,n){return qt(e,t,2,Rt(e,t+1,n),n)},br[121]=function(e,t,r,n){return qt(e,t,3,Ot(e,t+1,n),n)},br[122]=function(e,t,r,n){return qt(e,t,5,Nt(e,t+1,n),n)},br[123]=function(e,t,r,n){const i=Bt(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer string lengths not supported`);return qt(e,t,9,i,n)},br[124]=mr,br[125]=mr,br[126]=mr,br[127]=gr("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)br[e]=Yt;br[152]=function(e,t,r,n){return Gt(0,0,2,Rt(e,t+1,n))},br[153]=function(e,t,r,n){return Gt(0,0,3,Ot(e,t+1,n))},br[154]=function(e,t,r,n){return Gt(0,0,5,Nt(e,t+1,n))},br[155]=function(e,t,r,n){const i=Bt(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer array lengths not supported`);return Gt(0,0,9,i)},br[156]=mr,br[157]=mr,br[158]=mr,br[159]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${It} indefinite length items not allowed`);return Gt(0,0,1,1/0)};for(let e=160;e<=183;e++)br[e]=Qt;br[184]=function(e,t,r,n){return Xt(0,0,2,Rt(e,t+1,n))},br[185]=function(e,t,r,n){return Xt(0,0,3,Ot(e,t+1,n))},br[186]=function(e,t,r,n){return Xt(0,0,5,Nt(e,t+1,n))},br[187]=function(e,t,r,n){const i=Bt(e,t+1,n);if("bigint"==typeof i)throw new Error(`${It} 64-bit integer map lengths not supported`);return Xt(0,0,9,i)},br[188]=mr,br[189]=mr,br[190]=mr,br[191]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${It} indefinite length items not allowed`);return Xt(0,0,1,1/0)};for(let e=192;e<=215;e++)br[e]=er;br[216]=function(e,t,r,n){return new ht(ut.tag,Rt(e,t+1,n),2)},br[217]=function(e,t,r,n){return new ht(ut.tag,Ot(e,t+1,n),3)},br[218]=function(e,t,r,n){return new ht(ut.tag,Nt(e,t+1,n),5)},br[219]=function(e,t,r,n){return new ht(ut.tag,Bt(e,t+1,n),9)},br[220]=mr,br[221]=mr,br[222]=mr,br[223]=mr;for(let e=224;e<=243;e++)br[e]=gr("simple values are not supported");br[244]=mr,br[245]=mr,br[246]=mr,br[247]=function(e,t,r,n){if(!1===n.allowUndefined)throw new Error(`${It} undefined values are not supported`);return!0===n.coerceUndefinedToNull?new ht(ut.null,null,1):new ht(ut.undefined,void 0,1)},br[248]=gr("simple values are not supported"),br[249]=function(e,t,r,n){return or(fr(e,t+1),3,n)},br[250]=function(e,t,r,n){return or(pr(e,t+1),5,n)},br[251]=function(e,t,r,n){return or(yr(e,t+1),9,n)},br[252]=mr,br[253]=mr,br[254]=mr,br[255]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error(`${It} indefinite length items not allowed`);return new ht(ut.break,void 0,1)};const wr=[];for(let e=0;e<24;e++)wr[e]=new ht(ut.uint,e,1);for(let e=-1;e>=-24;e--)wr[31-e]=new ht(ut.negint,e,1);wr[64]=new ht(ut.bytes,new Uint8Array(0),1),wr[96]=new ht(ut.string,"",1),wr[128]=new ht(ut.array,0,1),wr[160]=new ht(ut.map,0,1),wr[244]=new ht(ut.false,!1,1),wr[245]=new ht(ut.true,!0,1),wr[246]=new ht(ut.null,null,1);var vr=r(25108);const Er={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const i=r.type.major,s=_r[i].compareTokens(r,n);0===s&&vr.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return s},quickEncodeToken:function(e){switch(e.type){case ut.false:return bt([244]);case ut.true:return bt([245]);case ut.null:return bt([246]);case ut.bytes:return e.value.length?void 0:bt([64]);case ut.string:return""===e.value?bt([96]):void 0;case ut.array:return 0===e.value?bt([128]):void 0;case ut.map:return 0===e.value?bt([160]):void 0;case ut.uint:return e.value<24?bt([Number(e.value)]):void 0;case ut.negint:if(e.value>=-24)return bt([31-Number(e.value)])}}};const _r=function(){const e=[];return e[ut.uint.major]=Mt,e[ut.negint.major]=Ft,e[ut.bytes.major]=Vt,e[ut.string.major]=Ht,e[ut.array.major]=Jt,e[ut.map.major]=Zt,e[ut.tag.major]=tr,e[ut.float.major]=ar,e}(),xr=new At;class kr{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Tt} object contains circular references`);return new kr(t,e)}}const Sr={null:new ht(ut.null,null),undefined:new ht(ut.undefined,void 0),true:new ht(ut.true,!0),false:new ht(ut.false,!1),emptyArray:new ht(ut.array,0),emptyMap:new ht(ut.map,0)},Ar={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new ht(e>=0?ut.uint:ut.negint,e):new ht(ut.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new ht(ut.uint,e):new ht(ut.negint,e),Uint8Array:(e,t,r,n)=>new ht(ut.bytes,e),string:(e,t,r,n)=>new ht(ut.string,e),boolean:(e,t,r,n)=>e?Sr.true:Sr.false,null:(e,t,r,n)=>Sr.null,undefined:(e,t,r,n)=>Sr.undefined,ArrayBuffer:(e,t,r,n)=>new ht(ut.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new ht(ut.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[Sr.emptyArray,new ht(ut.break)]:Sr.emptyArray;n=kr.createCheck(n,e);const i=[];let s=0;for(const t of e)i[s++]=Ir(t,r,n);return r.addBreakTokens?[new ht(ut.array,e.length),i,new ht(ut.break)]:[new ht(ut.array,e.length),i]},Object(e,t,r,n){const i="Object"!==t,s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return!0===r.addBreakTokens?[Sr.emptyMap,new ht(ut.break)]:Sr.emptyMap;n=kr.createCheck(n,e);const a=[];let c=0;for(const t of s)a[c++]=[Ir(t,r,n),Ir(i?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,r),r.addBreakTokens?[new ht(ut.map,o),a,new ht(ut.break)]:[new ht(ut.map,o),a]}};Ar.Map=Ar.Object,Ar.Buffer=Ar.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Ar[`${e}Array`]=Ar.DataView;function Ir(e,t={},r){const n=ct(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||Ar[n];if("function"==typeof i){const s=i(e,n,t,r);if(null!=s)return s}const s=Ar[n];if(!s)throw new Error(`${Tt} unsupported type: ${n}`);return s(e,n,t,r)}function Tr(e,t,r,n){if(Array.isArray(t))for(const i of t)Tr(e,i,r,n);else r[t.type.major](e,t,n)}function Pr(e,t,r){const n=Ir(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const i=t[n.type.major];if(i.encodedSize){const e=i.encodedSize(n,r),t=new At(e);if(i(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return yt(t.chunks[0])}}return xr.reset(),Tr(xr,n,t,r),xr.toBytes(!0)}function Cr(e,t){return t=Object.assign({},Er,t),Pr(e,_r,t)}const Dr={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Rr{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=wr[e];if(void 0===t){const r=br[e];if(!r)throw new Error(`${It} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const n=31&e;t=r(this.data,this._pos,n,this.options)}return this._pos+=t.encodedLength,t}}const Or=Symbol.for("DONE"),Nr=Symbol.for("BREAK");function Br(e,t){if(e.done())return Or;const r=e.next();if(r.type===ut.break)return Nr;if(r.type.terminal)return r.value;if(r.type===ut.array)return function(e,t,r){const n=[];for(let i=0;i<e.value;i++){const s=Br(t,r);if(s===Nr){if(e.value===1/0)break;throw new Error(`${It} got unexpected break to lengthed array`)}if(s===Or)throw new Error(`${It} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=s}return n}(r,e,t);if(r.type===ut.map)return function(e,t,r){const n=!0===r.useMaps,i=n?void 0:{},s=n?new Map:void 0;for(let o=0;o<e.value;o++){const a=Br(t,r);if(a===Nr){if(e.value===1/0)break;throw new Error(`${It} got unexpected break to lengthed map`)}if(a===Or)throw new Error(`${It} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof a)throw new Error(`${It} non-string keys not supported (got ${typeof a})`);if(!0===r.rejectDuplicateMapKeys&&(n&&s.has(a)||!n&&a in i))throw new Error(`${It} found repeat map key "${a}"`);const c=Br(t,r);if(c===Or)throw new Error(`${It} found map but not enough entries (got ${o} [no value], expected ${e.value})`);n?s.set(a,c):i[a]=c}return n?s:i}(r,e,t);if(r.type===ut.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=Br(e,t);return t.tags[r.value](n)}throw new Error(`${It} tag not supported (${r.value})`)}throw new Error("unsupported")}function Mr(e,t){const[r,n]=function(e,t){if(!(e instanceof Uint8Array))throw new Error(`${It} data to decode must be a Uint8Array`);const r=(t=Object.assign({},Dr,t)).tokenizer||new Rr(e,t),n=Br(r,t);if(n===Or)throw new Error(`${It} did not find any content to decode`);if(n===Nr)throw new Error(`${It} got unexpected break`);return[n,e.subarray(r.pos())]}(e,t);if(n.length>0)throw new Error(`${It} too many terminals, data makes no sense`);return r}var Lr=r(53416),Ur=r(49784),jr=r(77408);const Fr="/",Kr=(new TextEncoder).encode(Fr),zr=Kr[0];class $r{constructor(e,t){if("string"==typeof e)this._buf=(0,jr.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==zr)throw new Error("Invalid key")}toString(e="utf8"){return(0,Ur.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new $r(e.join(Fr))}static random(){return new $r((0,Lr.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new $r(e):"function"==typeof e.uint8Array?new $r(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Kr),this._buf[0]!==zr){const e=new Uint8Array(this._buf.byteLength+1);e.fill(zr,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===zr;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return $r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Fr).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new $r(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Fr)||(e+=Fr),e+=this.type(),new $r(e)}parent(){const e=this.list();return 1===e.length?new $r(Fr):new $r(e.slice(0,-1).join(Fr))}child(e){return this.toString()===Fr?e:e.toString()===Fr?this:new $r(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return $r.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}const Vr=ae({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),qr=ae({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Wr=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Xr(r,Gr(e),t||be.encoder):Qr(r,Gr(e),t||ue.encoder)},Hr=new WeakMap,Gr=e=>{const t=Hr.get(e);if(null==t){const t=new Map;return Hr.set(e,t),t}return t};class Yr{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Zr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==en)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Yr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Ye(e,t);return Yr.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Yr.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return Wr(this,e)}toJSON(){return{"/":Wr(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Yr)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Yr(e,r,n,i||tn(e,r,n.bytes))}if(!0===t[rn]){const{version:e,multihash:r,code:n}=t,i=Je(r);return Yr.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Zr)throw new Error(`Version 0 CID must use dag-pb (code: ${Zr}) block encoding`);return new Yr(e,t,r,r.bytes);case 1:{const n=tn(e,t,r.bytes);return new Yr(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Yr.create(0,Zr,e)}static createV1(e,t){return Yr.create(1,e,t)}static decode(e){const[t,r]=Yr.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Yr.inspectBytes(e),r=t.size-t.multihashSize,n=ee(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Xe(t.multihashCode,t.digestSize,i,n);return[0===t.version?Yr.createV0(s):Yr.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=We(e.subarray(t));return t+=n,r};let n=r(),i=Zr;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Jr(e,t),i=Yr.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Gr(i).set(r,e),i}}const Jr=(e,t)=>{switch(e[0]){case"Q":{const r=t||be;return[be.prefix,r.decode(`${be.prefix}${e}`)]}case be.prefix:{const r=t||be;return[be.prefix,r.decode(e)]}case ue.prefix:{const r=t||ue;return[ue.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Xr=(e,t,r)=>{const{prefix:n}=r;if(n!==be.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Qr=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},Zr=112,en=18,tn=(e,t,r)=>{const n=Ge(e),i=n+Ge(t),s=new Uint8Array(i+r.byteLength);return He(e,s,0),He(t,s,n),s.set(r,i),s},rn=Symbol.for("@ipld/js-cid/CID");var nn=r(85275),sn=r(85923),on=r.n(sn),an=r(71198);var cn,un=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};cn=new WeakMap;var hn,ln,fn,dn,pn,yn,mn,gn,bn,wn,vn,En,_n,xn,kn,Sn,An,In,Tn,Pn,Cn,Dn,Rn,On,Nn,Bn,Mn=class{constructor(){cn.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&un(this,cn,"f")[this.size-1].priority>=t.priority)return void un(this,cn,"f").push(r);const n=function(e,t,r){let n=0,i=e.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}(un(this,cn,"f"),r,((e,t)=>t.priority-e.priority));un(this,cn,"f").splice(n,0,r)}dequeue(){const e=un(this,cn,"f").shift();return null==e?void 0:e.run}filter(e){return un(this,cn,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return un(this,cn,"f").length}},Ln=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},Un=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class jn extends Error{}class Fn extends(on()){constructor(e){var t,r,n,i;if(super(),hn.add(this),ln.set(this,void 0),fn.set(this,void 0),dn.set(this,0),pn.set(this,void 0),yn.set(this,void 0),mn.set(this,0),gn.set(this,void 0),bn.set(this,void 0),wn.set(this,void 0),vn.set(this,void 0),En.set(this,0),_n.set(this,void 0),xn.set(this,void 0),kn.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Mn,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);Ln(this,ln,e.carryoverConcurrencyCount,"f"),Ln(this,fn,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),Ln(this,pn,e.intervalCap,"f"),Ln(this,yn,e.interval,"f"),Ln(this,wn,new e.queueClass,"f"),Ln(this,vn,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Ln(this,kn,!0===e.throwOnTimeout,"f"),Ln(this,xn,!1===e.autoStart,"f")}get concurrency(){return Un(this,_n,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Ln(this,_n,e,"f"),Un(this,hn,"m",On).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:Un(this,kn,"f"),...t},new Promise(((r,n)=>{Un(this,wn,"f").enqueue((async()=>{var i,s,o;Ln(this,En,(s=Un(this,En,"f"),++s),"f"),Ln(this,dn,(o=Un(this,dn,"f"),++o),"f");try{if(null===(i=t.signal)||void 0===i?void 0:i.aborted)throw new jn("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=(0,an.ZP)(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,Un(this,hn,"m",Nn).call(this,t.signal)]));const s=await n;r(s),this.emit("completed",s)}catch(e){if(e instanceof an.W5&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{Un(this,hn,"m",In).call(this)}}),t),this.emit("add"),Un(this,hn,"m",Cn).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return Un(this,xn,"f")?(Ln(this,xn,!1,"f"),Un(this,hn,"m",On).call(this),this):this}pause(){Ln(this,xn,!0,"f")}clear(){Ln(this,wn,new(Un(this,vn,"f")),"f")}async onEmpty(){0!==Un(this,wn,"f").size&&await Un(this,hn,"m",Bn).call(this,"empty")}async onSizeLessThan(e){Un(this,wn,"f").size<e||await Un(this,hn,"m",Bn).call(this,"next",(()=>Un(this,wn,"f").size<e))}async onIdle(){0===Un(this,En,"f")&&0===Un(this,wn,"f").size||await Un(this,hn,"m",Bn).call(this,"idle")}get size(){return Un(this,wn,"f").size}sizeBy(e){return Un(this,wn,"f").filter(e).length}get pending(){return Un(this,En,"f")}get isPaused(){return Un(this,xn,"f")}}ln=new WeakMap,fn=new WeakMap,dn=new WeakMap,pn=new WeakMap,yn=new WeakMap,mn=new WeakMap,gn=new WeakMap,bn=new WeakMap,wn=new WeakMap,vn=new WeakMap,En=new WeakMap,_n=new WeakMap,xn=new WeakMap,kn=new WeakMap,hn=new WeakSet,Sn=function(){return Un(this,fn,"f")||Un(this,dn,"f")<Un(this,pn,"f")},An=function(){return Un(this,En,"f")<Un(this,_n,"f")},In=function(){var e;Ln(this,En,(e=Un(this,En,"f"),--e),"f"),Un(this,hn,"m",Cn).call(this),this.emit("next")},Tn=function(){Un(this,hn,"m",Rn).call(this),Un(this,hn,"m",Dn).call(this),Ln(this,bn,void 0,"f")},Pn=function(){const e=Date.now();if(void 0===Un(this,gn,"f")){const t=Un(this,mn,"f")-e;if(!(t<0))return void 0===Un(this,bn,"f")&&Ln(this,bn,setTimeout((()=>{Un(this,hn,"m",Tn).call(this)}),t),"f"),!0;Ln(this,dn,Un(this,ln,"f")?Un(this,En,"f"):0,"f")}return!1},Cn=function(){if(0===Un(this,wn,"f").size)return Un(this,gn,"f")&&clearInterval(Un(this,gn,"f")),Ln(this,gn,void 0,"f"),this.emit("empty"),0===Un(this,En,"f")&&this.emit("idle"),!1;if(!Un(this,xn,"f")){const e=!Un(this,hn,"a",Pn);if(Un(this,hn,"a",Sn)&&Un(this,hn,"a",An)){const t=Un(this,wn,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&Un(this,hn,"m",Dn).call(this),!0)}}return!1},Dn=function(){Un(this,fn,"f")||void 0!==Un(this,gn,"f")||(Ln(this,gn,setInterval((()=>{Un(this,hn,"m",Rn).call(this)}),Un(this,yn,"f")),"f"),Ln(this,mn,Date.now()+Un(this,yn,"f"),"f"))},Rn=function(){0===Un(this,dn,"f")&&0===Un(this,En,"f")&&Un(this,gn,"f")&&(clearInterval(Un(this,gn,"f")),Ln(this,gn,void 0,"f")),Ln(this,dn,Un(this,ln,"f")?Un(this,En,"f"):0,"f"),Un(this,hn,"m",On).call(this)},On=function(){for(;Un(this,hn,"m",Cn).call(this););},Nn=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new jn("The task was aborted."))}),{once:!0})}))},Bn=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var Kn=Fn,zn=r(73062),$n=r(90560);class Vn extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===Type.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===Type.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[ut.uint.major](e,t){this.prefix(e);const r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[ut.negint.major](e,t){this[Type.uint.major](e,t)}[ut.bytes.major](e,t){throw new Error(`${encodeErrPrefix} unsupported type: Uint8Array`)}[ut.string.major](e,t){this.prefix(e);const r=fromString(JSON.stringify(t.value));e.push(r.length>32?asU8A(r):r)}[ut.array.major](e,t){this.prefix(e),this.inRecursive.push({type:Type.array,elements:0}),e.push([91])}[ut.map.major](e,t){this.prefix(e),this.inRecursive.push({type:Type.map,elements:0}),e.push([123])}[ut.tag.major](e,t){}[ut.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===Type.array)e.push([93]);else{if(t.type!==Type.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${encodeErrPrefix} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const r=String(t.value),n=[];let i=!1;for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e),i||46!==n[e]&&101!==n[e]&&69!==n[e]||(i=!0);i||(n.push(46),n.push(48)),e.push(n)}}class qn{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${It} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${It} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,r=!1;const n=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this._pos++}};if(45===this.ch()&&(t=!0,this._pos++),48===this.ch()){if(this._pos++,46!==this.ch())return new ht(ut.uint,0,this._pos-e);this._pos++,r=!0}if(n([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${It} unexpected token at position ${this._pos}`);if(!this.done()&&46===this.ch()){if(r)throw new Error(`${It} unexpected token at position ${this._pos}`);r=!0,this._pos++,n([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this._pos++,this.done()||43!==this.ch()&&45!==this.ch()||this._pos++,n([48,49,50,51,52,53,54,55,56,57]));const i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return r?new ht(ut.float,s,this._pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(s)?new ht(s>=0?ut.uint:ut.negint,s,this._pos-e):new ht(s>=0?ut.uint:ut.negint,BigInt(i),this._pos-e)}parseString(){if(34!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let e=this._pos,t=0;e<this.data.length&&t<65536;e++,t++){const r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){const r=String.fromCharCode.apply(null,this.data.subarray(this._pos,e));return this._pos=e+1,new ht(ut.string,r,t)}}const e=this._pos,t=[],r=()=>{if(this._pos+4>=this.data.length)throw new Error(`${It} unexpected end of unicode escape sequence at position ${this._pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${It} unexpected unicode escape character at position ${this._pos}`);t=t-65+10}e=16*e+t,this._pos++}return e},n=()=>{const e=this.ch();let r,n,i,s,o=null,a=e>239?4:e>223?3:e>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${It} unexpected unicode sequence at position ${this._pos}`);switch(a){case 1:e<128&&(o=e);break;case 2:r=this.data[this._pos+1],128==(192&r)&&(s=(31&e)<<6|63&r,s>127&&(o=s));break;case 3:r=this.data[this._pos+1],n=this.data[this._pos+2],128==(192&r)&&128==(192&n)&&(s=(15&e)<<12|(63&r)<<6|63&n,s>2047&&(s<55296||s>57343)&&(o=s));break;case 4:r=this.data[this._pos+1],n=this.data[this._pos+2],i=this.data[this._pos+3],128==(192&r)&&128==(192&n)&&128==(192&i)&&(s=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&i,s>65535&&s<1114112&&(o=s))}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this._pos+=a};for(;!this.done();){const i=this.ch();let s;switch(i){case 92:if(this._pos++,this.done())throw new Error(`${It} unexpected string termination at position ${this._pos}`);switch(s=this.ch(),this._pos++,s){case 34:case 39:case 92:case 47:t.push(s);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${It} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ht(ut.string,St(t),this._pos-e);default:if(i<32)throw new Error(`${It} invalid control character at position ${this._pos}`);i<128?(t.push(i),this._pos++):n()}}throw new Error(`${It} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ht(ut.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ht(ut.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ht(ut.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ht(ut.false,!1,5);case 116:return this.expect([116,114,117,101]),new ht(ut.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${It} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1);if(44!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1);if(44!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this._pos++,this.skipWhitespace(),new ht(ut.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${It} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${It} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}const Wn={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Wn.tags[42]=Yr.parse;new TextDecoder,new TextEncoder;const Hn=new TextDecoder;function Gn(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const i=e[t++];if(r+=n<28?(127&i)<<n:(127&i)*2**n,i<128)break}return[r,t]}function Yn(e,t){let r;[r,t]=Gn(e,t);const n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function Jn(e,t){let r;return[r,t]=Gn(e,t),[7&r,r>>3,t]}function Xn(e){const t={},r=e.length;let n=0;for(;n<r;){let r,i;if([r,i,n]=Jn(e,n),1===i){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=Yn(e,n)}else if(2===i){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,n]=Yn(e,n),t.Name=Hn.decode(i)}else{if(3!==i)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=Gn(e,n)}}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}new TextEncoder;new TextEncoder;function Qn(e){const t=function(e){const t=e.length;let r,n,i=0,s=!1;for(;i<t;){let t,o;if([t,o,i]=Jn(e,i),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===o){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,i]=Yn(e,i),r&&(s=!0)}else{if(2!==o)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`);{if(s)throw new Error("protobuf: (PBNode) duplicate Links section");let t;r||(r=[]),[t,i]=Yn(e,i),r.push(Xn(t))}}}if(i>t)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return n&&(o.Data=n),o.Links=r||[],o}(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map((e=>{const t={};try{t.Hash=Yr.decode(e.Hash)}catch(e){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),r}const Zn=new TextEncoder,ei=new TextDecoder,ti="json",ri=512,ni=e=>Zn.encode(JSON.stringify(e)),ii=e=>JSON.parse(ei.decode(e)),si="raw",oi=85,ai=e=>ee(e),ci=e=>ee(e),ui={codec:112,async*walk(e){const t=Qn(e);yield*t.Links.map((e=>e.Hash))}},hi={codec:oi,async*walk(){}},li={codec:$n.code,async*walk(e){const t=[],r=[];r[42]=e=>{if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");const r=Yr.decode(e.subarray(1));return t.push(r),r},Mr(e,{tags:r}),yield*t}};class fi extends qn{tokenBuffer;constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===ut.map){const e=this._next();if(e.type===ut.string&&"/"===e.value){const e=this._next();if(e.type===ut.string){if(this._next().type!==ut.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new ht(ut.tag,42,0)}if(e.type===ut.map){const e=this._next();if(e.type===ut.string&&"bytes"===e.value){const e=this._next();if(e.type===ut.string){for(let e=0;e<2;e++){if(this._next().type!==ut.break)throw new Error("Invalid encoded Bytes form")}const t=ve.decode(`m${e.value}`);return new ht(ut.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}const di={codec:297,async*walk(e){const t=[],r=[];var n,i;r[42]=e=>{const r=Yr.parse(e);return t.push(r),r},n=e,i={tags:r,tokenizer:new fi(e,{tags:r,allowIndefinite:!0,allowUndefined:!0,allowNaN:!0,allowInfinity:!0,allowBigInt:!0,strict:!1,rejectDuplicateMapKeys:!1})},Mr(n,i=Object.assign({tokenizer:new qn(n,i)},i)),yield*t}},pi=[hi,ui,li,di,{codec:ri,async*walk(){}}],yi="/pin/",mi="/pinned-block/",gi=Vr;function bi(e){return 0===e.version&&(e=e.toV1()),new $r(`${yi}${e.toString(gi)}`)}class wi{datastore;blockstore;dagWalkers;constructor(e,t,r){this.datastore=e,this.blockstore=t,this.dagWalkers={},[...pi,...r].forEach((e=>{this.dagWalkers[e.codec]=e}))}async add(e,t={}){const r=bi(e);if(await this.datastore.has(r))throw new Error("Already pinned");const n=Math.round(t.depth??1/0);if(n<0)throw new Error("Depth must be greater than or equal to 0");const i=new Kn({concurrency:1});i.add((async()=>{await this.#n(e,i,(t=>{null==t.pinnedBy.find((t=>(0,zn.f)(t,e.bytes)))&&(t.pinCount++,t.pinnedBy.push(e.bytes))}),{...t,depth:n})}));const s=(0,nn.Z)();i.on("error",(e=>{i.clear(),s.reject(e)})),await Promise.race([i.onIdle(),s.promise]);const o={depth:n,metadata:t.metadata??{}};return await this.datastore.put(r,Cr(o),t),{cid:e,...o}}async#n(e,t,r,n){if(-1===n.depth)return;const i=this.dagWalkers[e.code];if(null==i)throw new Error(`No dag walker found for cid codec ${e.code}`);const s=await this.blockstore.get(e,n);await this.#i(e,r,n);for await(const e of i.walk(s))t.add((async()=>{await this.#n(e,t,r,{...n,depth:n.depth-1})}))}async#i(e,t,r){const n=new $r(`${mi}${gi.encode(e.multihash.bytes)}`);let i={pinCount:0,pinnedBy:[]};try{i=Mr(await this.datastore.get(n,r))}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}t(i),0===i.pinCount&&await this.datastore.has(n)?await this.datastore.delete(n):(await this.datastore.put(n,Cr(i),r),r.onProgress?.(new st.V("helia:pin:add",{detail:e})))}async rm(e,t={}){const r=bi(e),n=Mr(await this.datastore.get(r,t));await this.datastore.delete(r,t);const i=new Kn({concurrency:1});return i.add((async()=>{await this.#n(e,i,(t=>{t.pinCount--,t.pinnedBy=t.pinnedBy.filter((t=>(0,zn.f)(t,e.bytes)))}),{...t,depth:n.depth})})),await i.onIdle(),{cid:e,...n}}async*ls(e={}){for await(const{key:t,value:r}of this.datastore.query({prefix:yi+(null!=e.cid?`${e.cid.toString(Vr)}`:"")},e)){const e=Yr.parse(t.toString().substring(5),Vr),n=Mr(r);yield{cid:e,...n}}}async isPinned(e,t={}){const r=new $r(`${mi}${gi.encode(e.multihash.bytes)}`);return this.datastore.has(r,t)}}var vi=r(95155);class Ei{lock;child;pins;constructor(e,t,r={}){this.child=e,this.pins=t,this.lock=(0,vi.Z)({singleProcess:r.holdGcLock})}unwrap(){return this.child}async put(e,t,r={}){const n=await this.lock.readLock();try{return await this.child.put(e,t,r)}finally{n()}}async*putMany(e,t={}){const r=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{r()}}async get(e,t={}){const r=await this.lock.readLock();try{return await this.child.get(e,t)}finally{r()}}async*getMany(e,t={}){const r=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{r()}}async delete(e,t={}){const r=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{r()}}async*deleteMany(e,t={}){const r=await this.lock.writeLock();try{const r=this;yield*this.child.deleteMany(async function*(){for await(const t of e){if(await r.pins.isPinned(t))throw new Error("CID was pinned");yield t}}(),t)}finally{r()}}async has(e,t={}){const r=await this.lock.readLock();try{return await this.child.has(e,t)}finally{r()}}async*getAll(e={}){const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}}const _i=new $r("/version");var xi=r(75671);var ki=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,xi.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){await s&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===s&&(yield n);for(const e of r)o(e)&&(yield e)}()};var Si=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r),yield r}();const r=(0,xi.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s?.then)return async function*(){yield n;for await(const e of r)await t(e),yield e}();const o=t;return function*(){yield n;for(const e of r)o(e),yield e}()};class Ai{child;bitswap;constructor(e,t={}){this.child=e,this.bitswap=t.bitswap}unwrap(){return this.child}async put(e,t,r={}){return await this.child.has(e)?(r.onProgress?.(new st.V("blocks:put:duplicate",e)),e):(!0===this.bitswap?.isStarted()&&(r.onProgress?.(new st.V("blocks:put:bitswap:notify",e)),this.bitswap.notify(e,t,r)),r.onProgress?.(new st.V("blocks:put:blockstore:put",e)),this.child.put(e,t,r))}async*putMany(e,t={}){const r=ki(e,(async({cid:e})=>{const r=await this.child.has(e);return r&&t.onProgress?.(new st.V("blocks:put-many:duplicate",e)),!r})),n=Si(r,(({cid:e,block:r})=>{t.onProgress?.(new st.V("blocks:put-many:bitswap:notify",e)),this.bitswap?.notify(e,r,t)}));t.onProgress?.(new st.V("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(n,t)}async get(e,t={}){if(!0!==t.offline&&null!=this.bitswap?.isStarted()&&!await this.child.has(e)){t.onProgress?.(new st.V("blocks:get:bitswap:get",e));const r=await this.bitswap.want(e,t);return t.onProgress?.(new st.V("blocks:get:blockstore:put",e)),await this.child.put(e,r,t),r}return t.onProgress?.(new st.V("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){t.onProgress?.(new st.V("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(Si(e,(async e=>{if(!0!==t.offline&&!0===this.bitswap?.isStarted()&&!await this.child.has(e)){t.onProgress?.(new st.V("blocks:get-many:bitswap:get",e));const r=await this.bitswap.want(e,t);t.onProgress?.(new st.V("blocks:get-many:blockstore:put",e)),await this.child.put(e,r,t)}})))}async delete(e,t={}){t.onProgress?.(new st.V("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){t.onProgress?.(new st.V("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const t of e)yield t}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){e.onProgress?.(new st.V("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}const Ii=ke("helia");class Ti{libp2p;blockstore;datastore;pins;#s;constructor(e){const t=[nt,it,Ze,...e.hashers??[]];this.#s=(0,Ie.n)(e.libp2p,e.blockstore,{hashLoader:{getHasher:async e=>{const r=t.find((t=>t.code===e||t.name===e));if(null!=r)return r;throw new Error(`Could not load hasher for code/name "${e}"`)}}});const r=new Ai(e.blockstore,{bitswap:this.#s});this.pins=new wi(e.datastore,r,e.dagWalkers??[]),this.libp2p=e.libp2p,this.blockstore=new Ei(r,this.pins,{holdGcLock:e.holdGcLock}),this.datastore=e.datastore}async start(){await async function(e){if(!await e.has(_i))return void await e.put(_i,(0,jr.m)("1"));const t=await e.get(_i),r=(0,Ur.B)(t);if(1!==parseInt(r,10))throw new Error("Unknown datastore version, a datastore migration may be required")}(this.datastore),await(this.#s?.start()),await this.libp2p.start()}async stop(){await this.libp2p.stop(),await(this.#s?.stop())}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const t=this,r=this.blockstore.unwrap();Ii("gc start"),await Te(r.deleteMany(async function*(){for await(const{cid:n}of r.getAll())try{if(await t.pins.isPinned(n,e))continue;yield n,e.onProgress?.(new st.V("helia:gc:deleted",n))}catch(t){Ii.error("Error during gc",t),e.onProgress?.(new st.V("helia:gc:error",t))}}()))}finally{t()}Ii("gc finished")}}var Pi=r(63718),Ci=r(32629),Di=r(49541),Ri=r(5681);var Oi=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Ni=Oi;new Uint8Array(0);const Bi=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Mi{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Li{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ji(this,e)}}class Ui{constructor(e){this.decoders=e}or(e){return ji(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ji=(e,t)=>new Ui({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Fi{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Mi(e,t,r),this.decoder=new Li(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ki=({name:e,prefix:t,encode:r,decode:n})=>new Fi(e,t,r,n),zi=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Ni(r,t);return Ki({prefix:e,name:t,encode:n,decode:e=>Bi(i(e))})},$i=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Ki({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Vi=zi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),qi=zi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Wi=zi({prefix:"9",name:"base10",alphabet:"0123456789"}),Hi=$i({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gi=$i({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Yi=$i({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ji=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Xi=Ji.reduce(((e,t,r)=>(e[r]=t,e)),[]),Qi=Ji.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Zi=Ki({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Xi[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Qi[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),es=$i({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ts=$i({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rs=$i({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ns=$i({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),is=$i({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ss=$i({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),os=$i({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),as=$i({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),cs=$i({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),us=zi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hs=zi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ls=$i({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),fs=$i({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ds=$i({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ps=$i({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ys=$i({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ms=Ki({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),gs=new TextEncoder,bs=new TextDecoder,ws="json",vs=512,Es=e=>gs.encode(JSON.stringify(e)),_s=e=>JSON.parse(bs.decode(e)),xs="raw",ks=85,Ss=e=>Bi(e),As=e=>Bi(e);var Is=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Cs;)r[n++]=255&t|Ts,t/=128;for(;t&Ps;)r[n++]=255&t|Ts,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Ts=128,Ps=-128,Cs=Math.pow(2,31);var Ds=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Os)<<s:(n&Os)*Math.pow(2,s),s+=7}while(n>=Rs);return e.bytes=o-r,i},Rs=128,Os=127;var Ns=Math.pow(2,7),Bs=Math.pow(2,14),Ms=Math.pow(2,21),Ls=Math.pow(2,28),Us=Math.pow(2,35),js=Math.pow(2,42),Fs=Math.pow(2,49),Ks=Math.pow(2,56),zs=Math.pow(2,63),$s={encode:Is,decode:Ds,encodingLength:function(e){return e<Ns?1:e<Bs?2:e<Ms?3:e<Ls?4:e<Us?5:e<js?6:e<Fs?7:e<Ks?8:e<zs?9:10}};const Vs=(e,t=0)=>[$s.decode(e,t),$s.decode.bytes],qs=(e,t,r=0)=>($s.encode(e,t,r),t),Ws=e=>$s.encodingLength(e),Hs=(e,t)=>{const r=t.byteLength,n=Ws(e),i=n+Ws(r),s=new Uint8Array(i+r);return qs(e,s,0),qs(r,s,n),s.set(t,i),new Ys(e,r,t,s)},Gs=e=>{const t=Bi(e),[r,n]=Vs(t),[i,s]=Vs(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ys(r,i,o,t)};class Ys{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Js=Bi,Xs={code:0,name:"identity",encode:Js,digest:e=>Hs(0,Js(e))},Qs=({name:e,code:t,encode:r})=>new Zs(e,t,r);class Zs{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Hs(this.code,t):t.then((e=>Hs(this.code,e)))}throw Error("Unknown type, must be binary type")}}const eo=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),to=Qs({name:"sha2-256",code:18,encode:eo("SHA-256")}),ro=Qs({name:"sha2-512",code:19,encode:eo("SHA-512")}),no=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?co(r,so(e),t||Vi.encoder):uo(r,so(e),t||es.encoder)},io=new WeakMap,so=e=>{const t=io.get(e);if(null==t){const t=new Map;return io.set(e,t),t}return t};class oo{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ho)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==lo)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return oo.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Hs(e,t);return oo.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return oo.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return no(this,e)}toJSON(){return{"/":no(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof oo)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new oo(e,r,n,i||fo(e,r,n.bytes))}if(!0===t[po]){const{version:e,multihash:r,code:n}=t,i=Gs(r);return oo.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ho)throw new Error(`Version 0 CID must use dag-pb (code: ${ho}) block encoding`);return new oo(e,t,r,r.bytes);case 1:{const n=fo(e,t,r.bytes);return new oo(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return oo.create(0,ho,e)}static createV1(e,t){return oo.create(1,e,t)}static decode(e){const[t,r]=oo.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=oo.inspectBytes(e),r=t.size-t.multihashSize,n=Bi(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Ys(t.multihashCode,t.digestSize,i,n);return[0===t.version?oo.createV0(s):oo.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Vs(e.subarray(t));return t+=n,r};let n=r(),i=ho;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=ao(e,t),i=oo.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return so(i).set(r,e),i}}const ao=(e,t)=>{switch(e[0]){case"Q":{const r=t||Vi;return[Vi.prefix,r.decode(`${Vi.prefix}${e}`)]}case Vi.prefix:{const r=t||Vi;return[Vi.prefix,r.decode(e)]}case es.prefix:{const r=t||es;return[es.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},co=(e,t,r)=>{const{prefix:n}=r;if(n!==Vi.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},uo=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},ho=112,lo=18,fo=(e,t,r)=>{const n=Ws(e),i=n+Ws(t),s=new Uint8Array(i+r.byteLength);return qs(e,s,0),qs(t,s,n),s.set(r,i),s},po=Symbol.for("@ipld/js-cid/CID"),yo={...v,...p,...w,...f,...d,...m,...g,...l,...b,...y};function mo(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const go=Symbol.for("nodejs.util.inspect.custom"),bo=Object.values(yo).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),yo.identity.decoder),wo=114,vo=36,Eo=37;class _o{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Ri.N]=!0;toString(){return null==this.string&&(this.string=Vi.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return oo.createV1(wo,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return mo(this.multihash.bytes,e);if("string"==typeof e)return Ao(e).equals(this);if(null!=e?.multihash?.bytes)return mo(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[go](){return`PeerId(${this.toString()})`}}class xo extends _o{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class ko extends _o{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class So extends _o{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function Ao(e,t){if(t=t??bo,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Gs(Vi.decode(`z${e}`));return e.startsWith("12D")?new ko({multihash:t}):e.startsWith("16U")?new So({multihash:t}):new xo({multihash:t})}return Io(bo.decode(e))}function Io(e){try{const t=Gs(e);if(t.code===Xs.code){if(t.digest.length===vo)return new ko({multihash:t});if(t.digest.length===Eo)return new So({multihash:t})}if(t.code===to.code)return new xo({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==wo)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===to.code)return new xo({multihash:e.multihash});if(t.code===Xs.code){if(t.digest.length===vo)return new ko({multihash:e.multihash});if(t.digest.length===Eo)return new So({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(oo.decode(e))}throw new Error("Supplied PeerID CID is invalid")}function To(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return X.enabled(`${e}:trace`)&&null!=X.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=X(`${e}:trace`)),Object.assign(X(e),{error:X(`${e}:error`),trace:t})}X.formatters.b=e=>null==e?"undefined":Vi.baseEncode(e),X.formatters.t=e=>null==e?"undefined":es.baseEncode(e),X.formatters.m=e=>null==e?"undefined":ls.baseEncode(e),X.formatters.p=e=>null==e?"undefined":e.toString(),X.formatters.c=e=>null==e?"undefined":e.toString(),X.formatters.k=e=>null==e?"undefined":e.toString(),X.formatters.a=e=>null==e?"undefined":e.toString();var Po=r(23247);class Co{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(e,t,r){this.gossip=e,this.msgIdToStrFn=r;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,r=!1){const{msgIdStr:n}=e;return!this.msgs.has(n)&&(this.msgs.set(n,{message:t,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),r||this.notValidatedCount++,!0)}observeDuplicate(e,t){const r=this.msgs.get(e);r&&!r.validated&&r.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const r=this.msgs.get(e);if(!r)return null;const n=(r.iwantCounts.get(t)??0)+1;return r.iwantCounts.set(t,n),{msg:r.message,count:n}}getGossipIDs(e){const t=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach((r=>{const n=this.msgs.get(r.msgIdStr);if(n&&n.validated&&e.has(r.topic)){let e=t.get(r.topic);e||(e=[],t.set(r.topic,e)),e.push(r.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;const{message:r,originatingPeers:n}=t;return t.validated=!0,t.originatingPeers=new Set,{message:r,originatingPeers:n}}shift(){this.history[this.history.length-1].forEach((e=>{const t=this.msgs.get(e.msgIdStr);t&&(this.msgs.delete(e.msgIdStr),t.validated||this.notValidatedCount--)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}var Do=r(64482);const{RPC:Ro}=Do,Oo="/floodsub/1.0.0",No="/meshsub/1.0.0",Bo="/meshsub/1.1.0",Mo=5e3;function Lo(e){if(e.length<=1)return e;for(let t=0;t<e.length;t++){const r=Math.floor(Math.random()*Math.floor(e.length)),n=e[t];e[t]=e[r],e[r]=n}return e}function Uo(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function jo(e=0){return null!=globalThis.Buffer?.allocUnsafe?Uo(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Fo(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Ko=Fo("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),zo=Fo("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=jo((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var $o={utf8:Ko,"utf-8":Ko,hex:yo.base16,latin1:zo,ascii:zo,binary:zo,...yo};function Vo(e,t="utf8"){const r=$o[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function qo(e){return Vo(e,"base64")}r(3068),r(97450);var Wo=r(3832);function Ho(e,t="utf8"){const r=$o[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Uo(globalThis.Buffer.from(e,"utf-8"))}var Go=r(4101);const Yo=32,Jo=64,Xo=32;function Qo(e,t){const r=new Uint8Array(Jo);for(let n=0;n<Xo;n++)r[n]=e[n],r[Xo+n]=t[n];return r}function Zo(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=jo(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return Uo(r)}var ea={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const ta={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function ra(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=ea.get();return r*=8,{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),h=a.getRandomValues(new Uint8Array(n)),l={name:t,iv:h};let f;if("string"==typeof c&&(c=Ho(c)),0===c.length){f=await a.subtle.importKey("jwk",ta,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{f=await a.subtle.importKey("jwk",ta,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const d=await a.subtle.encrypt(l,f,e);return Zo([u,l.iv,new Uint8Array(d)])},decrypt:async function(e,c){const u=e.subarray(0,s),h=e.subarray(s,s+n),l=e.subarray(s+n),f={name:t,iv:h};let d;if("string"==typeof c&&(c=Ho(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{d=await a.subtle.importKey("jwk",ta,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(f,d,l);return new Uint8Array(p)}}}(),n=await r.encrypt(e,t);return ls.encode(n)}var na,ia,sa,oa,aa=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(na||(na={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(ia||(ia={})),function(e){e.codec=()=>(0,aa.Ji)(ia)}(na||(na={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),na.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=na.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(sa||(sa={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),na.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=na.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(oa||(oa={}));class ca{_key;constructor(e){this._key=pa(e,Yo)}async verify(e,t){return async function(e,t,r){return Go.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return sa.encode({Type:na.Ed25519,Data:this.marshal()}).subarray()}equals(e){return mo(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}}class ua{_key;_publicKey;constructor(e,t){this._key=pa(e,Jo),this._publicKey=pa(t,Yo)}async sign(e){return async function(e,t){const r=e.subarray(0,Xo);return Go.UN.sign(t,r)}(this._key,e)}get public(){return new ca(this._publicKey)}marshal(){return this._key}get bytes(){return oa.encode({Type:na.Ed25519,Data:this.marshal()}).subarray()}equals(e){return mo(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}async id(){const e=Xs.digest(this.public.bytes);return Vi.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return ra(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function ha(e){if(e.length>Jo){const t=(e=pa(e,Jo+Yo)).subarray(0,Jo),r=e.subarray(Jo,e.length);return new ua(t,r)}const t=(e=pa(e,Jo)).subarray(0,Jo),r=e.subarray(Yo);return new ua(t,r)}function la(e){return e=pa(e,Yo),new ca(e)}async function fa(){const{privateKey:e,publicKey:t}=await async function(){const e=Go.UN.utils.randomPrivateKey(),t=Go.UN.getPublicKey(e);return{privateKey:Qo(e,t),publicKey:t}}();return new ua(e,t)}async function da(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==Xo)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=Go.UN.getPublicKey(t);return{privateKey:Qo(t,r),publicKey:r}}(e);return new ua(t,r)}function pa(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new Di.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}r(97116),r(15764);function ya(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Zo([new Uint8Array(t-r.length),r])}return Vo(r,"base64url")}function ma(e){const t=function(e,t){let r=Ho(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Zo([new Uint8Array(t-r.length),r])}return r}(e);return new Wo.jsbn.BigInteger(Vo(t,"base16"),16)}const ga={"P-256":256,"P-384":384,"P-521":521};Object.keys(ga).join(" / ");r(63219);const ba="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function wa(e){if(isNaN(e)||e<=0)throw new Di.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(ba&&"function"==typeof ba.getRandomValues)return ba.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}r(28095);function va(e,t){return t.map((t=>ma(e[t])))}async function Ea(e){const t=[await ea.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await xa(e)],r=await _a({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function _a(e){if(null==e.privateKey||null==e.publicKey)throw new Di.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([ea.get().subtle.exportKey("jwk",e.privateKey),ea.get().subtle.exportKey("jwk",e.publicKey)])}async function xa(e){return ea.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function ka(e,t,r,n){const i=t?function(e){return Wo.pki.setRsaPublicKey(...va(e,["n","e"]))}(e):function(e){return Wo.pki.setRsaPrivateKey(...va(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Ho(n(Vo(Uint8Array.from(r),"ascii"),i),"ascii")}function Sa(e){if("RSA"!==e.kty)throw new Di.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new Di.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*Ho(e.n,"base64url").length}const Aa=8192;class Ia{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await ea.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return ea.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Wo.pki.publicKeyToAsn1({n:ma(e.n),e:ma(e.e)});return Ho(Wo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return sa.encode({Type:na.RSA,Data:this.marshal()}).subarray()}encrypt(e){return ka(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return mo(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}}class Ta{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return wa(16)}async sign(e){return async function(e,t){const r=await ea.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await ea.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new Di.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Ia(this._publicKey)}decrypt(e){return ka(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Wo.pki.privateKeyToAsn1({n:ma(e.n),e:ma(e.e),d:ma(e.d),p:ma(e.p),q:ma(e.q),dP:ma(e.dp),dQ:ma(e.dq),qInv:ma(e.qi)});return Ho(Wo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return oa.encode({Type:na.RSA,Data:this.marshal()}).subarray()}equals(e){return mo(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}async id(){return Vo(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new Wo.util.ByteBuffer(this.marshal()),r=Wo.asn1.fromDer(t),n=Wo.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return Wo.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return ra(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Pa(e){const t=function(e){const t=Wo.asn1.fromDer(Vo(e,"ascii")),r=Wo.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:ya(r.n),e:ya(r.e),d:ya(r.d),p:ya(r.p),q:ya(r.q),dp:ya(r.dP),dq:ya(r.dQ),qi:ya(r.qInv),alg:"RS256"}}(e);if(Sa(t)>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await Ea(t);return new Ta(r.privateKey,r.publicKey)}function Ca(e){const t=function(e){const t=Wo.asn1.fromDer(Vo(e,"ascii")),r=Wo.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:ya(r.n),e:ya(r.e)}}(e);if(Sa(t)>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Ia(t)}async function Da(e){if(Sa(e)>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Ea(e);return new Ta(t.privateKey,t.publicKey)}async function Ra(e){if(e>Aa)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await ea.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await _a(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Ta(t.privateKey,t.publicKey)}var Oa=r(60533);function Na(e){try{Oa.kA.ProjectivePoint.fromHex(e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Ba{_key;constructor(e){Na(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await to.digest(r);return Oa.kA.verify(t,n,e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Oa.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return sa.encode({Type:na.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return mo(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}}class Ma{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return Oa.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Oa.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Na(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await to.digest(t);try{return Oa.kA.sign(r,e).toDERRawBytes()}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Ba(this._publicKey)}marshal(){return this._key}get bytes(){return oa.encode({Type:na.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return mo(this.bytes,e.bytes)}async hash(){const{bytes:e}=await to.digest(this.bytes);return e}async id(){return Vo(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return ra(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function La(e){return new Ma(e)}function Ua(e){return new Ba(e)}async function ja(){const e=Oa.kA.utils.randomPrivateKey();return new Ma(e)}const Fa={rsa:A,ed25519:S,secp256k1:I};function Ka(e){const t=Object.keys(Fa).join(" / ");return new Di.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function za(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return Fa[e];throw Ka(e)}function $a(e){const t=sa.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case na.RSA:return Fa.rsa.unmarshalRsaPublicKey(r);case na.Ed25519:return Fa.ed25519.unmarshalEd25519PublicKey(r);case na.Secp256k1:return Fa.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Ka(t.Type??"unknown")}}async function Va(e){const t=oa.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case na.RSA:return Fa.rsa.unmarshalRsaPrivateKey(r);case na.Ed25519:return Fa.ed25519.unmarshalEd25519PrivateKey(r);case na.Secp256k1:return Fa.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Ka(t.Type??"RSA")}}var qa,Wa,Ha,Ga,Ya,Ja=r(92679);function Xa(e){switch(e){case Ja.Ct.Ignore:return Ha.Ignore;case Ja.Ct.Reject:return Ha.Reject}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(qa||(qa={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(Wa||(Wa={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(Ha||(Ha={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(Ga||(Ga={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(Ya||(Ya={}));const Qa="ERR_INVALID_PEER_SCORE_PARAMS",Za={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},ec={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function tc(e={}){return{...Za,...e,topics:e.topics?Object.entries(e.topics).reduce(((e,[t,r])=>(e[t]=function(e={}){return{...ec,...e}}(r),e)),{}):{}}}function rc(e){if(e.topicWeight<0)throw new Di.sv("invalid topic weight; must be >= 0",Qa);if(0===e.timeInMeshQuantum)throw new Di.sv("invalid TimeInMeshQuantum; must be non zero",Qa);if(e.timeInMeshWeight<0)throw new Di.sv("invalid TimeInMeshWeight; must be positive (or 0 to disable)",Qa);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new Di.sv("invalid TimeInMeshQuantum; must be positive",Qa);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new Di.sv("invalid TimeInMeshCap; must be positive",Qa);if(e.firstMessageDeliveriesWeight<0)throw new Di.sv("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",Qa);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new Di.sv("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",Qa);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new Di.sv("invalid FirstMessageDeliveriesCap; must be positive",Qa);if(e.meshMessageDeliveriesWeight>0)throw new Di.sv("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",Qa);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new Di.sv("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",Qa);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new Di.sv("invalid MeshMessageDeliveriesCap; must be positive",Qa);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new Di.sv("invalid MeshMessageDeliveriesThreshold; must be positive",Qa);if(e.meshMessageDeliveriesWindow<0)throw new Di.sv("invalid MeshMessageDeliveriesWindow; must be non-negative",Qa);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new Di.sv("invalid MeshMessageDeliveriesActivation; must be at least 1s",Qa);if(e.meshFailurePenaltyWeight>0)throw new Di.sv("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",Qa);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new Di.sv("invalid MeshFailurePenaltyDecay; must be between 0 and 1",Qa);if(e.invalidMessageDeliveriesWeight>0)throw new Di.sv("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",Qa);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new Di.sv("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",Qa)}const nc={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function ic(e={}){return{...nc,...e}}function sc(e,t,r,n){let i=0;Object.entries(t.topics).forEach((([e,t])=>{const n=r.topics[e];if(void 0===n)return;let s=0;if(t.inMesh){let e=t.meshTime/n.timeInMeshQuantum;e>n.timeInMeshCap&&(e=n.timeInMeshCap),s+=e*n.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>n.firstMessageDeliveriesCap&&(o=n.firstMessageDeliveriesCap),s+=o*n.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n.meshMessageDeliveriesThreshold){const e=n.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;s+=e*e*n.meshMessageDeliveriesWeight}s+=t.meshFailurePenalty*n.meshFailurePenaltyWeight;s+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*n.invalidMessageDeliveriesWeight,i+=s*n.topicWeight})),r.topicScoreCap>0&&i>r.topicScoreCap&&(i=r.topicScoreCap);const s=r.appSpecificScore(e);if(i+=s*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),s=t?t.size:0;if(s>r.IPColocationFactorThreshold){const e=s-r.IPColocationFactorThreshold;i+=e*e*r.IPColocationFactorWeight}})),t.behaviourPenalty>r.behaviourPenaltyThreshold){const e=t.behaviourPenalty-r.behaviourPenaltyThreshold;i+=e*e*r.behaviourPenaltyWeight}return i}var oc,ac=r(45001);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(oc||(oc={}));class cc{records;queue;constructor(){this.records=new Map,this.queue=new ac}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:oc.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const r={msgId:e,expire:Date.now()+12e4};return this.queue.push(r),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function uc(e,t,r=(()=>!0)){const n=new Set;if(t<=0)return n;for(const i of e){if(n.size>=t)break;r(i)&&(n.add(i),e.delete(i))}return n}class hc extends Map{getDefault;constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}const lc=To("libp2p:gossipsub:score");class fc{params;metrics;peerStats=new Map;peerIPs=new hc((()=>new Set));scoreCache=new Map;deliveryRecords=new cc;_backgroundInterval;scoreCacheValidityMs;computeScore;constructor(e,t,r){this.params=e,this.metrics=t,function(e){for(const[t,r]of Object.entries(e.topics))try{rc(r)}catch(e){throw new Di.sv(`invalid score parameters for topic ${t}: ${e.message}`,Qa)}if(e.topicScoreCap<0)throw new Di.sv("invalid topic score cap; must be positive (or 0 for no cap)",Qa);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new Di.sv("missing application specific score function",Qa);if(e.IPColocationFactorWeight>0)throw new Di.sv("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",Qa);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new Di.sv("invalid IPColocationFactorThreshold; must be at least 1",Qa);if(e.behaviourPenaltyWeight>0)throw new Di.sv("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",Qa);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new Di.sv("invalid BehaviourPenaltyDecay; must be between 0 and 1",Qa);if(e.decayInterval<1e3)throw new Di.sv("invalid DecayInterval; must be at least 1s",Qa);if(e.decayToZero<=0||e.decayToZero>=1)throw new Di.sv("invalid DecayToZero; must be between 0 and 1",Qa)}(e),this.scoreCacheValidityMs=r.scoreCacheValidityMs,this.computeScore=r.computeScore??sc}get size(){return this.peerStats.size}start(){this._backgroundInterval?lc("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),lc("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),lc("stopped")):lc("Peer score already stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([e,t])=>[e,t])))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((r,n)=>{r.connected?(Object.entries(r.topics).forEach((([r,n])=>{const i=this.params.topics[r];void 0!==i&&(n.firstMessageDeliveries*=i.firstMessageDeliveriesDecay,n.firstMessageDeliveries<t&&(n.firstMessageDeliveries=0),n.meshMessageDeliveries*=i.meshMessageDeliveriesDecay,n.meshMessageDeliveries<t&&(n.meshMessageDeliveries=0),n.meshFailurePenalty*=i.meshFailurePenaltyDecay,n.meshFailurePenalty<t&&(n.meshFailurePenalty=0),n.invalidMessageDeliveries*=i.invalidMessageDeliveriesDecay,n.invalidMessageDeliveries<t&&(n.invalidMessageDeliveries=0),n.inMesh&&(n.meshTime=e-n.graftTime,n.meshTime>i.meshMessageDeliveriesActivation&&(n.meshMessageDeliveriesActive=!0)))})),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<t&&(r.behaviourPenalty=0)):e>r.expire&&(this.removeIPsForPeer(n,r.knownIPs),this.peerStats.delete(n),this.scoreCache.delete(n))}))}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const r=Date.now(),n=this.scoreCache.get(e);if(n&&n.cacheUntil>r)return n.score;this.metrics?.scoreFnRuns.inc();const i=this.computeScore(e,t,this.params,this.peerIPs),s=r+this.scoreCacheValidityMs;return n?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-n.score)),n.score=i,n.cacheUntil=s):this.scoreCache.set(e,{score:i,cacheUntil:s}),i}addPenalty(e,t,r){const n=this.peerStats.get(e);n&&(n.behaviourPenalty+=t,this.metrics?.onScorePenalty(r))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.delete(t);const n=this.peerIPs.get(t);n&&(n.delete(e),0===n.size&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0)return this.removeIPsForPeer(e,t.knownIPs),void this.peerStats.delete(e);Object.entries(t.topics).forEach((([e,t])=>{t.firstMessageDeliveries=0;const r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){const e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){const r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){const t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,r){this.markFirstMessageDelivery(e,r);const n=this.deliveryRecords.ensureRecord(t),i=Date.now();n.status===oc.unknown?(n.status=oc.valid,n.validated=i,n.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,r)}))):lc("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-n.firstSeenTsMs,oc[n.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,r,n){switch(n){case Ha.Error:return void this.markInvalidMessageDelivery(e,r);case Ha.Blacklisted:return}const i=this.deliveryRecords.ensureRecord(t);if(i.status===oc.unknown){if(n===Ha.Ignore)return i.status=oc.ignored,void i.peers.clear();i.status=oc.invalid,this.markInvalidMessageDelivery(e,r),i.peers.forEach((e=>{this.markInvalidMessageDelivery(e,r)})),i.peers.clear()}else lc("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeenTsMs,oc[i.status])}duplicateMessage(e,t,r){const n=this.deliveryRecords.ensureRecord(t);if(!n.peers.has(e))switch(n.status){case oc.unknown:n.peers.add(e);break;case oc.valid:n.peers.add(e),this.markDuplicateMessageDelivery(e,r,n.validated);break;case oc.invalid:this.markInvalidMessageDelivery(e,r);case oc.ignored:}}markInvalidMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){let r=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(r,e.firstMessageDeliveries+1),e.inMesh&&(r=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(r,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,r){const n=this.peerStats.get(e);if(n){const e=void 0!==r?Date.now():0,i=this.getPtopicStats(n,t);if(i&&i.inMesh){const n=this.params.topics[t];if(void 0!==r){const i=e-r,s=i>n.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,i,s),s)return}const s=n.meshMessageDeliveriesCap;i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const r of t){const t=this.peerIPs.get(r);t&&(t.delete(e),0===t.size&&this.peerIPs.delete(r))}}getPtopicStats(e,t){let r=e.topics[t];return void 0!==r?r:void 0!==this.params.topics[t]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=r,r):null}}class dc{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(e,t,r){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=r,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const r=t[Math.floor(Math.random()*t.length)],n=this.msgIdToStrFn(r);let i=this.promises.get(n);i||(i=new Map,this.promises.set(n,i));const s=Date.now();i.has(e)||(i.set(e,s+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(n)||this.requestMsByMsg.set(n,s)))}getBrokenPromises(){const e=Date.now(),t=new Map;let r=0;return this.promises.forEach(((n,i)=>{n.forEach(((i,s)=>{i<e&&(t.set(s,(t.get(s)??0)+1),n.delete(s),r++)})),n.size||this.promises.delete(i)})),this.metrics?.iwantPromiseBroken.inc(r),t}deliverMessage(e,t=!1){this.trackMessage(e);const r=this.promises.get(e);r&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,t){this.trackMessage(e),t!==Ha.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[r,n]of this.requestMsByMsg.entries()){if(!(n<e))break;this.requestMsByMsg.delete(r),t++}this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}class pc{entries=new Map;validityMs;constructor(e){this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,r]of this.entries.entries()){if(!(r.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var yc,mc,gc,bc,wc,vc;!function(e){e.forward="forward",e.publish="publish"}(yc||(yc={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(mc||(mc={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Excess="excess"}(gc||(gc={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(bc||(bc={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(wc||(wc={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(vc||(vc={}));r(8925);r(98960);const Ec=Ho("libp2p-pubsub:");function _c(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return((e,t)=>{const r=Ho(t.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(e.length+r.length);return n.set(e,0),n.set(r,e.length),n})(e.from.toBytes(),e.sequenceNumber)}async function xc(e){return await to.encode(e.data)}function kc(e,t,r,n,i){let s=0;const o=new Map;if(Object.entries(t.topics).forEach((([e,t])=>{const n=i.get(e)??"unknown",a=r.topics[e];if(void 0===a)return;let c=o.get(n);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(n,c));let u=0,h=0,l=0,f=0,d=0;if(t.inMesh){u+=Math.max(t.meshTime/a.timeInMeshQuantum,a.timeInMeshCap)*a.timeInMeshWeight}let p=t.firstMessageDeliveries;if(p>a.firstMessageDeliveriesCap&&(p=a.firstMessageDeliveriesCap),h+=p*a.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const e=a.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;l+=e*e*a.meshMessageDeliveriesWeight}f+=t.meshFailurePenalty*a.meshFailurePenaltyWeight;d+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*a.invalidMessageDeliveriesWeight,s+=(u+h+l+f+d)*a.topicWeight,c.p1w+=u,c.p2w+=h,c.p3w+=l,c.p3bw+=f,c.p4w+=d})),r.topicScoreCap>0&&s>r.topicScoreCap){s=r.topicScoreCap;const e=r.topicScoreCap/s;for(const t of o.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,c=0,u=0;a+=r.appSpecificScore(e)*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),i=t?t.size:0;if(i>r.IPColocationFactorThreshold){const e=i-r.IPColocationFactorThreshold;c+=e*e*r.IPColocationFactorWeight}}));return u+=t.behaviourPenalty*t.behaviourPenalty*r.behaviourPenaltyWeight,s+=a+c+u,{byTopic:o,p5w:a,p6w:c,p7w:u,score:s}}class Sc{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Ac{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Sc(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Sc(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class Ic extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Tc(e={}){return Pc((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function Pc(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new Ac,a=(0,nn.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>i?r:(i=!0,null!=e?(e=>(o=new Ac,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,nn.Z)()}))}},return:()=>(o=new Ac,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new Ic)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(l.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return l.readableLength}},r}class Cc extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Dc(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new Cc(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new Cc(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}var Rc=r(9202);class Oc{rawStream;pushable;closeController;maxBufferSize;constructor(e,t,r){this.rawStream=e,this.pushable=Tc({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,(0,Ci.z)(Dc(this.pushable,this.closeController.signal,{returnOnAbort:!0}),(e=>(0,Rc.c)(e)),this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class Nc{source;rawStream;closeController;constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=Dc((0,Ci.z)(this.rawStream,(e=>(0,Rc.J)(e,t))),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var Bc=r(42450);const Mc={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function Lc(e,t){t={...t};const r=Bc.Reader.create(e),n=e.length,i=void 0===n?r.len:r.pos+n,s={};for(;r.pos<i;){const e=r.uint32();switch(e>>>3){case 1:s.subscriptions&&s.subscriptions.length||(s.subscriptions=[]),s.subscriptions.length<t.maxSubscriptions?s.subscriptions.push(Uc(r,r.uint32())):r.skipType(7&e);break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.length<t.maxMessages?s.messages.push(jc(r,r.uint32())):r.skipType(7&e);break;case 3:s.control=Fc(r,r.uint32(),t);break;default:r.skipType(7&e)}}return s}function Uc(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topic=e.string();break;default:e.skipType(7&t)}}return n}function jc(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topic=e.string();break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&t)}}if(!n.topic)throw Error("missing required 'topic'");return n}function Fc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.length<r.maxControlMessages?i.ihave.push(Kc(e,e.uint32(),r)):e.skipType(7&t);break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.length<r.maxControlMessages?i.iwant.push(zc(e,e.uint32(),r)):e.skipType(7&t);break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.length<r.maxControlMessages?i.graft.push($c(e,e.uint32())):e.skipType(7&t);break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.length<r.maxControlMessages?i.prune.push(Vc(e,e.uint32(),r)):e.skipType(7&t);break;default:e.skipType(7&t)}}return i}function Kc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:i.topicID=e.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),r.maxIhaveMessageIDs-- >0?i.messageIDs.push(e.bytes()):e.skipType(7&t);break;default:e.skipType(7&t)}}return i}function zc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),r.maxIwantMessageIDs-- >0?i.messageIDs.push(e.bytes()):e.skipType(7&t);else e.skipType(7&t)}return i}function $c(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();if(t>>>3==1)n.topicID=e.string();else e.skipType(7&t)}return n}function Vc(e,t,r){const n=void 0===t?e.len:e.pos+t,i={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:i.topicID=e.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),r.maxPeerInfos-- >0?i.peers.push(qc(e,e.uint32())):e.skipType(7&t);break;case 3:i.backoff=e.uint64();break;default:e.skipType(7&t)}}return i}function qc(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.peerID=e.bytes();break;case 2:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n}r(9839);var Wc=r(57050);var Hc=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=r[e.charCodeAt(t)];if(255===h)return;for(var l=0,f=s-1;(0!==h||l<i)&&-1!==f;f--,l++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(n+(s-d)),y=n;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var l=t[i],f=0,d=o-1;(0!==l||f<n)&&-1!==d;d--,f++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=f,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Gc=Hc;new Uint8Array(0);const Yc=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Jc{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Xc{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Zc(this,e)}}class Qc{constructor(e){this.decoders=e}or(e){return Zc(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Zc=(e,t)=>new Qc({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class eu{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Jc(e,t,r),this.decoder=new Xc(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const tu=({name:e,prefix:t,encode:r,decode:n})=>new eu(e,t,r,n),ru=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Gc(r,t);return tu({prefix:e,name:t,encode:n,decode:e=>Yc(i(e))})},nu=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>tu({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),iu=tu({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),su=nu({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ou=nu({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),au=ru({prefix:"9",name:"base10",alphabet:"0123456789"}),cu=nu({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uu=nu({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),hu=nu({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lu=nu({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fu=nu({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),du=nu({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pu=nu({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yu=nu({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mu=nu({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gu=nu({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bu=nu({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),wu=ru({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vu=ru({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Eu=ru({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_u=ru({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),xu=nu({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ku=nu({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Su=nu({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Au=nu({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Iu=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Tu=Iu.reduce(((e,t,r)=>(e[r]=t,e)),[]),Pu=Iu.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Cu=tu({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Tu[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Pu[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var Du=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Nu;)r[n++]=255&t|Ru,t/=128;for(;t&Ou;)r[n++]=255&t|Ru,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Ru=128,Ou=-128,Nu=Math.pow(2,31);var Bu=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Lu)<<s:(n&Lu)*Math.pow(2,s),s+=7}while(n>=Mu);return e.bytes=o-r,i},Mu=128,Lu=127;var Uu=Math.pow(2,7),ju=Math.pow(2,14),Fu=Math.pow(2,21),Ku=Math.pow(2,28),zu=Math.pow(2,35),$u=Math.pow(2,42),Vu=Math.pow(2,49),qu=Math.pow(2,56),Wu=Math.pow(2,63),Hu={encode:Du,decode:Bu,encodingLength:function(e){return e<Uu?1:e<ju?2:e<Fu?3:e<Ku?4:e<zu?5:e<$u?6:e<Vu?7:e<qu?8:e<Wu?9:10}};const Gu=(e,t,r=0)=>(Hu.encode(e,t,r),t),Yu=e=>Hu.encodingLength(e),Ju=(e,t)=>{const r=t.byteLength,n=Yu(e),i=n+Yu(r),s=new Uint8Array(i+r);return Gu(e,s,0),Gu(r,s,n),s.set(t,i),new Xu(e,r,t,s)};class Xu{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Qu=({name:e,code:t,encode:r})=>new Zu(e,t,r);class Zu{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ju(this.code,t):t.then((e=>Ju(this.code,e)))}throw Error("Unknown type, must be binary type")}}const eh=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),th=Qu({name:"sha2-256",code:18,encode:eh("SHA-256")}),rh=Qu({name:"sha2-512",code:19,encode:eh("SHA-512")}),nh=Yc,ih={code:0,name:"identity",encode:nh,digest:e=>Ju(0,nh(e))},sh="raw",oh=85,ah=e=>Yc(e),ch=e=>Yc(e),uh=new TextEncoder,hh=new TextDecoder,lh="json",fh=512,dh=e=>uh.encode(JSON.stringify(e)),ph=e=>JSON.parse(hh.decode(e));new WeakMap;class yh{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return yh.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return yh.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return yh.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return src_cid_format(this,e)}toJSON(){return{"/":src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof yh)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new yh(e,r,n,i||src_cid_encodeCID(e,r,n.bytes))}if(!0===t[src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return yh.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new yh(e,t,r,r.bytes);case 1:{const n=src_cid_encodeCID(e,t,r.bytes);return new yh(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return yh.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return yh.create(1,e,t)}static decode(e){const[t,r]=yh.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=yh.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?yh.createV0(s):yh.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=src_cid_parseCIDtoBytes(e,t),i=yh.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const mh={...T,...P,...C,...D,...R,...O,...N,...B,...M,...L};function gh(e=0){return null!=globalThis.Buffer?.allocUnsafe?function(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function bh(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const wh=bh("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),vh=bh("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=gh((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Eh={utf8:wh,"utf-8":wh,hex:mh.base16,latin1:vh,ascii:vh,binary:vh,...mh};function _h(e,t="utf8"){const r=Eh[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var xh=r(49736);const kh=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Sh=-1,Ah={},Ih={};function Th(e){if("number"==typeof e){if(null!=Ih[e])return Ih[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=Ah[e])return Ah[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Sh,"ip6zone"],[43,8,"ipcidr"],[53,Sh,"dns",!0],[54,Sh,"dns4",!0],[55,Sh,"dns6",!0],[56,Sh,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Sh,"unix",!1,!0],[421,Sh,"ipfs"],[421,Sh,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Sh,"garlic64"],[448,0,"tls"],[449,Sh,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Sh,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Sh,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);Ih[t.code]=t,Ah[t.name]=t}));Th("ip4"),Th("ip6"),Th("ipcidr");function Ph(e,t){switch(Th(e).code){case 4:case 41:return function(e){const t=kh(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!xh.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Rh(t);case 6:case 273:case 33:case 132:return Dh(t).toString();case 421:return function(e){const t=Wc.Jx(e),r=e.slice(Wc.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return _h(r,"base58btc")}(t);case 444:case 445:return Oh(t);case 466:return function(e){const t=Wc.Jx(e),r=e.slice(Wc.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+_h(r,"base64url")}(t);default:return _h(t,"base16")}}const Ch=Object.values(yo).map((e=>e.decoder));!function(){let e=Ch[0].or(Ch[1]);Ch.slice(2).forEach((t=>e=e.or(t)))}();function Dh(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Rh(e){const t=Wc.Jx(e);if((e=e.slice(Wc.P$(t))).length!==t)throw new Error("inconsistent lengths");return _h(e)}function Oh(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${_h(t,"base32")}:${Dh(r)}`}var Nh;!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(Nh||(Nh={}));var Bh;!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(Bh||(Bh={}));class Mh extends Po.v{globalSignaturePolicy;multicodecs=[Bo,No];publishConfig;dataTransform;peers=new Set;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=Tc({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;components;directPeerInitial=null;static multicodec=Bo;opts;decodeRpcLimits;metrics;status={code:Bh.stopped};maxInboundStreams;maxOutboundStreams;allowedTopics;heartbeatTimer=null;constructor(e,t={}){super();const r={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,unsubcribeBackoff:1e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:tc(t.scoreParams),scoreThresholds:ic(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=r.decodeRpcLimits??Mc,this.globalSignaturePolicy=r.globalSignaturePolicy??Ja.xq,r.fallbackToFloodsub&&this.multicodecs.push(Oo),this.log=To(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map((e=>e.id.toString()))),this.seenCache=new pc({validityMs:r.seenTTL}),this.publishedMessageIds=new pc({validityMs:r.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Ja.xq:this.msgIdFn=_c;break;case Ja.Q_:this.msgIdFn=xc}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new pc({validityMs:r.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??qo,this.mcache=t.messageCache||new Co(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const e=Math.max(...Object.values(r.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),1e3),n=function(e,t,r){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:e.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:e.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:e.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:e.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:e.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:e.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:e.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:e.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:e.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:e.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",labelNames:["topic"],buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:e.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:e.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:e.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:e.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:e.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:e.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:e.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:e.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:e.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:e.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:e.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:e.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:e.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:e.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:e.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),iwantPromiseUntracked:e.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:e.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,r){const n=this.toTopic(e);switch(t){case mc.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:n},r);break;case mc.Random:this.meshPeerInclusionEventsRandom.inc({topic:n},r);break;case mc.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:n},r);break;case mc.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:n},r);break;case mc.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:n},r);break;case mc.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:n},r);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:n},r)}},onRemoveFromMesh(e,t,r){const n=this.toTopic(e);switch(t){case gc.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:n},r);break;case gc.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:n},r);break;case gc.Prune:this.meshPeerChurnEventsPrune.inc({topic:n},r);break;case gc.Excess:this.meshPeerChurnEventsExcess.inc({topic:n},r);break;default:this.meshPeerChurnEventsUnknown.inc({topic:n},r)}},onReportValidation(e,t,r){if(this.asyncValidationMcacheHit.inc({hit:null!=e?"hit":"miss"}),null!=e){const r=this.toTopic(e.message.topic);switch(t){case Ja.Ct.Accept:this.acceptedMessagesTotal.inc({topic:r});break;case Ja.Ct.Ignore:this.ignoredMessagesTotal.inc({topic:r});break;case Ja.Ct.Reject:this.rejectedMessagesTotal.inc({topic:r});break;default:this.unknownValidationResultsTotal.inc({topic:r})}}null!=r?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-r)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,r){const n=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:n},t),this.ihaveRcvNotSeenMsgids.inc({topic:n},r)},onIwantRcv(e,t){for(const[t,r]of e){const e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const r=this.toTopic(e);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},t)},onPublishMsg(e,t,r,n,i){const s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},r*n),this.msgPublishPeersByTopic.inc({topic:s},r),this.directPeersPublishedTotal.inc({topic:s},t.direct),this.floodsubPeersPublishedTotal.inc({topic:s},t.floodsub),this.meshPeersPublishedTotal.inc({topic:s},t.mesh),this.fanoutPeersPublishedTotal.inc({topic:s},t.fanout),this.msgPublishTime.observe({topic:s},i/1e3)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvError(e){const t=this.toTopic(e);this.msgReceivedError.inc({topic:t},1)},onPrevalidationResult(e,t){const r=this.toTopic(e);switch(t){case Ya.duplicate:this.prevalidationDuplicateTotal.inc({topic:r});break;case Ya.invalid:this.prevalidationInvalidTotal.inc({topic:r});break;case Ya.valid:this.prevalidationValidTotal.inc({topic:r});break;default:this.prevalidationUnknownTotal.inc({topic:r})}},onMsgRecvInvalid(e,t){const r=this.toTopic(e),n=t.reason===Ha.Error?t.error:t.reason;this.msgReceivedInvalid.inc({error:n},1),this.msgReceivedInvalidByTopic.inc({topic:r},1)},onDuplicateMsgDelivery(e,t,r){if(this.duplicateMsgDeliveryDelay.observe(t/1e3),r){const t=this.toTopic(e);this.duplicateMsgLateDelivery.inc({topic:t},1)}},onPublishDuplicateMsg(e){const t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),e.messages&&this.rpcRecvMessage.inc(e.messages.length),e.control&&(this.rpcRecvControl.inc(1),e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),e.messages&&this.rpcSentMessage.inc(e.messages.length),e.control){const t=e.control.ihave?.length??0,r=e.control.iwant?.length??0,n=e.control.graft?.length??0,i=e.control.prune?.length??0;t>0&&this.rpcSentIHave.inc(t),r>0&&this.rpcSentIWant.inc(r),n>0&&this.rpcSentGraft.inc(n),i>0&&this.rpcSentPrune.inc(i),(t>0||r>0||n>0||i>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let r=0,n=0,i=0,s=0;for(const o of e)o>=t.graylistThreshold&&r++,o>=t.publishThreshold&&n++,o>=t.gossipThreshold&&i++,o>=0&&s++;this.peersByScoreThreshold.set({threshold:vc.graylist},r),this.peersByScoreThreshold.set({threshold:vc.publish},n),this.peersByScoreThreshold.set({threshold:vc.gossip},i),this.peersByScoreThreshold.set({threshold:vc.mesh},s),this.score.set(e)},registerScoreWeights(e){for(const[t,r]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},r.p1w),this.scoreWeights.set({topic:t,p:"p2"},r.p2w),this.scoreWeights.set({topic:t,p:"p3"},r.p3w),this.scoreWeights.set({topic:t,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:t,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const r=new Map;e.forEach(((e,t)=>{const n=this.topicStrToLabel.get(t)??"unknown";let i=r.get(n);i||(i=new Set,r.set(n,i)),e.forEach((e=>i?.add(e)))}));for(const[e,n]of r){const r=[];n.forEach((e=>{r.push(t.get(e)??0)})),this.scorePerMesh.set({topic:e},r)}}}}(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});n.mcacheSize.addCollect((()=>this.onScrapeMetrics(n)));for(const e of this.multicodecs)n.protocolsEnabled.set({protocol:e},1);this.metrics=n}else this.metrics=null;this.gossipTracer=new dc(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new fc(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=r.allowedTopics?new Set(r.allowedTopics):null}getPeers(){return[...this.peers.keys()].map((e=>Ao(e)))}isStarted(){return this.status.code===Bh.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await async function(e,t){switch(e){case Ja.xq:{if(!t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await Va(t.privateKey);return{type:Wa.Signing,author:t,key:t.publicKey,privateKey:e}}case Ja.Q_:return{type:Wa.Anonymous};default:throw new Error(`Unknown signature policy "${e}"`)}}(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=Tc({objectMode:!0}),(0,Ci.z)(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:r}of e)await this.createOutboundStream(t,r)})).catch((e=>this.log.error("outbound inflight queue error",e))),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.peerStore.merge(e.id,{multiaddrs:e.addrs})})));const e=this.components.registrar;await Promise.all(this.multicodecs.map((t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const t={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)},r=await Promise.all(this.multicodecs.map((r=>e.register(r,t)))),n=setTimeout(this.runHeartbeat,100);this.status={code:Bh.started,registrarTopologyIds:r,heartbeatTimeout:n,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>await this.connect(e))))})).catch((e=>{this.log(e)}))}),1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Bh.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:Bh.stopped};const t=this.components.registrar;await Promise.all(this.multicodecs.map((e=>t.unhandle(e)))),e.forEach((e=>t.unregister(e))),this.outboundInflightQueue.end();for(const e of this.streamsOutbound.values())e.close();this.streamsOutbound.clear();for(const e of this.streamsInbound.values())e.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const r=t.remotePeer;this.addPeer(r,t.direction,t.remoteAddr),this.createInboundStream(r,e),this.outboundInflightQueue.push({peerId:r,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.status}),this.isStarted()&&"open"===t.status&&(this.addPeer(e,t.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{const n=new Oc(await t.newStream(this.multicodecs),(e=>this.log.error("outbound pipe error",e)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(r,n);const i=n.protocol;i===Oo&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}async createInboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(!this.peers.has(r))return;const n=this.streamsInbound.get(r);void 0!==n&&(this.log("replacing existing inbound steam %s",r),n.close()),this.log("create inbound stream %s",r);const i=new Nc(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,i),this.pipePeerReadStream(e,i.source).catch((e=>this.log(e)))}addPeer(e,t,r){const n=e.toString();if(!this.peers.has(n)){this.log("new peer %p",e),this.peers.add(n),this.score.addPeer(n);const i=function(e){for(const t of e.tuples())switch(t[0]){case Nh.ip4:case Nh.ip6:return Ph(t[0],t[1])}return null}(r);null!==i?this.score.addIP(n,i):this.log("Added peer has no IP in current address %s %s",n,r.toString()),this.outbound.has(n)||this.outbound.set(n,"outbound"===t)}}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const r=this.streamsOutbound.get(t),n=this.streamsInbound.get(t);r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close(),n?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const e of this.topics.values())e.delete(t);for(const[e,r]of this.mesh)!0===r.delete(t)&&this.metrics?.onRemoveFromMesh(e,gc.Dc,1);for(const e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===Bh.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map((e=>Ao(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await(0,Ci.z)(t,(async t=>{for await(const r of t)try{const t=r.subarray(),n=Lc(t,this.decodeRpcLimits);if(this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,n)}catch(e){this.metrics?.onRpcRecvError(),this.log(e)}else this.handleReceivedRpc(e,n).catch((e=>{this.metrics?.onRpcRecvError(),this.log(e)}))}catch(e){this.metrics?.onRpcDataError(),this.log(e)}}))}catch(t){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(t,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void this.metrics?.rpcRecvNotAccepted.inc();const r=t.subscriptions?t.subscriptions.length:0,n=t.messages?t.messages.length:0;let i=0,s=0,o=0,a=0;if(t.control&&(t.control.ihave&&(i=t.control.ihave.length),t.control.iwant&&(s=t.control.iwant.length),t.control.graft&&(o=t.control.graft.length),t.control.prune&&(a=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${r} messages ${n} ihave ${i} iwant ${s} graft ${o} prune ${a}`),t.subscriptions&&t.subscriptions.length>0){const r=[];t.subscriptions.forEach((t=>{const n=t.topic,i=!0===t.subscribe;if(null!=n){if(this.allowedTopics&&!this.allowedTopics.has(n))return;this.handleReceivedSubscription(e,n,i),r.push({topic:n,subscribe:i})}})),this.dispatchEvent(new Po.A("subscription-change",{detail:{peerId:e,subscriptions:r}}))}if(t.messages)for(const r of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(r.topic))continue;const t=this.handleReceivedMessage(e,r).catch((e=>{this.metrics?.onMsgRecvError(r.topic),this.log(e)}));this.opts.awaitRpcMessageHandler&&await t}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,r){this.log("subscription update from %p topic %s",e,t);let n=this.topics.get(t);null==n&&(n=new Set,this.topics.set(t,n)),r?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const r=await this.validateReceivedMessage(e,t);switch(this.metrics?.onPrevalidationResult(t.topic,r.code),r.code){case Ya.duplicate:return this.score.duplicateMessage(e.toString(),r.msgIdStr,t.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),void this.mcache.observeDuplicate(r.msgIdStr,e.toString());case Ya.invalid:if(r.msgIdStr){const n=r.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,r.reason),this.gossipTracer.rejectMessage(n,r.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void this.metrics?.onMsgRecvInvalid(t.topic,r);case Ya.valid:if(this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)){this.components.peerId.equals(e)&&!this.opts.emitSelf||(super.dispatchEvent(new Po.A("gossipsub:message",{detail:{propagationSource:e,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new Po.A("message",{detail:r.msg})))}this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const r=this.fastMsgIdFn?.(t),n=void 0!==r?this.fastMsgIdCache?.get(r):void 0;if(n)return{code:Ya.duplicate,msgIdStr:n};const i=await async function(e,t){switch(e){case Ja.Q_:return null!=t.signature?{valid:!1,error:Ga.SignaturePresent}:null!=t.seqno?{valid:!1,error:Ga.SeqnoPresent}:null!=t.key?{valid:!1,error:Ga.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case Ja.xq:{if(null==t.seqno)return{valid:!1,error:Ga.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:Ga.InvalidSeqno};if(null==t.signature)return{valid:!1,error:Ga.InvalidSignature};if(null==t.from)return{valid:!1,error:Ga.InvalidPeerId};let e,i;try{e=Io(t.from)}catch(e){return{valid:!1,error:Ga.InvalidPeerId}}if(t.key){if(i=$a(t.key),void 0!==e.publicKey&&!mo(i.bytes,e.publicKey))return{valid:!1,error:Ga.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:Ga.InvalidPeerId};i=$a(e.publicKey)}const s={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},o=Zo([Ec,Ro.Message.encode(s).finish()]);return await i.verify(o,t.signature)?{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${Vo(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:t.key??(r=i,za(n=(n??"rsa").toLowerCase()),r.bytes)}}:{valid:!1,error:Ga.InvalidSignature}}}var r,n}(this.globalSignaturePolicy,t);if(!i.valid)return{code:Ya.invalid,reason:Ha.Error,error:i.error};const s=i.message;try{this.dataTransform&&(s.data=this.dataTransform.inboundTransform(t.topic,s.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:Ya.invalid,reason:Ha.Error,error:Ga.TransformFailed}}const o=await this.msgIdFn(s),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(void 0!==r&&this.fastMsgIdCache){this.fastMsgIdCache.put(r,a)&&this.metrics?.fastMsgIdCacheCollision.inc()}if(this.seenCache.has(a))return{code:Ya.duplicate,msgIdStr:a};this.seenCache.put(a);const u=this.topicValidators.get(t.topic);if(null!=u){let t;try{t=await u(e,s)}catch(e){const r=e.code;"ERR_TOPIC_VALIDATOR_IGNORE"===r&&(t=Ja.Ct.Ignore),t="ERR_TOPIC_VALIDATOR_REJECT"===r?Ja.Ct.Reject:Ja.Ct.Ignore}if(t!==Ja.Ct.Accept)return{code:Ya.invalid,reason:Xa(t),msgIdStr:a}}return{code:Ya.valid,messageId:c,msg:s}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,r){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:r})))})}async handleControlMessage(e,t){if(void 0===t)return;const r=t.ihave?this.handleIHave(e,t.ihave):[],n=t.iwant?this.handleIWant(e,t.iwant):[],i=t.graft?await this.handleGraft(e,t.graft):[];if(t.prune&&await this.handlePrune(e,t.prune),!r.length&&!n.length&&!i.length)return;const s=this.sendRpc(e,{messages:n,control:{iwant:r,prune:i}}),o=r[0]?.messageIDs;o&&(s?this.gossipTracer.addPromise(e,o):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),r=this.acceptFromWhitelist.get(e);if(r&&r.messagesAccepted<128&&r.acceptUntil>=t)return r.messagesAccepted+=1,!0;const n=this.score.score(e);return n>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),n>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:wc.LowScore}),[];const n=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,n),n>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:wc.MaxIhave}),[];const i=this.iasked.get(e)??0;if(i>=Mo)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:wc.MaxIasked}),[];const s=new Map;if(t.forEach((({topicID:e,messageIDs:t})=>{if(!e||!t||!this.mesh.has(e))return;let r=0;t.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(s.set(t,e),r++)})),this.metrics?.onIhaveRcv(e,t.length,r)})),!s.size)return[];let o=s.size;o+i>Mo&&(o=Mo-i),this.log("IHAVE: Asking for %d out of %d messages from %s",o,s.size,e);let a=Array.from(s.values());return Lo(a),a=a.slice(0,o),this.iasked.set(e,i+o),[{messageIDs:a}]}handleIWant(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];const n=new Map,i=new Map;let s=0;return t.forEach((({messageIDs:t})=>{t&&t.forEach((t=>{const r=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(r,e);null!=o?(i.set(o.msg.topic,1+(i.get(o.msg.topic)??0)),o.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):n.set(r,o.msg)):s++}))})),this.metrics?.onIwantRcv(i,s),n.size?(this.log("IWANT: Sending %d messages to %s",n.size,e),Array.from(n.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const r=[],n=this.score.score(e),i=Date.now();let s=this.opts.doPX;if(t.forEach((({topicID:t})=>{if(!t)return;const o=this.mesh.get(t);if(!o)return void(s=!1);if(o.has(e))return;if(this.direct.has(e))return this.log("GRAFT: ignoring request from direct peer %s",e),r.push(t),void(s=!1);const a=this.backoff.get(t)?.get(e);if("number"==typeof a&&i<a){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,bc.GraftBackoff),s=!1;const n=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return i<n&&this.score.addPenalty(e,1,bc.GraftBackoff),this.addBackoff(e,t),void r.push(t)}return n<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,n,t),r.push(t),s=!1,void this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(r.push(t),void this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),void this.metrics?.onAddToMesh(t,mc.Subscribed,1))})),!r.length)return[];return await Promise.all(r.map((t=>this.makePrune(e,t,s,false))))}async handlePrune(e,t){const r=this.score.score(e);for(const{topicID:n,backoff:i,peers:s}of t){if(null==n)continue;const t=this.mesh.get(n);if(!t)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,n),this.score.prune(e,n),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(n,gc.Prune,1)),"number"==typeof i&&i>0?this.doAddBackoff(e,n,1e3*i):this.addBackoff(e,n),s&&s.length){if(r<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,r,n);continue}await this.pxConnect(s)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,r){let n=this.backoff.get(t);n||(n=new Map,this.backoff.set(t,n));const i=Date.now()+r;(n.get(e)??0)<i&&n.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,bc.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!=0)return;const e=Date.now();this.backoff.forEach(((t,r)=>{t.forEach(((r,n)=>{r+1*this.opts.heartbeatInterval<e&&t.delete(n)})),0===t.size&&this.backoff.delete(r)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>await this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&(Lo(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(!e.peerID)return;const r=Io(e.peerID),n=r.toString();if(!this.peers.has(n))if(e.signedPeerRecord)try{if(!await this.components.peerStore.consumePeerRecord(e.signedPeerRecord,r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(n)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(n)}))),t.length&&await Promise.all(t.map((async e=>await this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=Ao(e),r=await this.components.connectionManager.openConnection(t);for(const e of this.multicodecs)for(const n of this.components.registrar.getTopologies(e))n.onConnect?.(t,r)}subscribe(e){if(this.status.code!==Bh.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Bh.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e)}join(e){if(this.status.code!==Bh.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,r=this.backoff.get(e),n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach((e=>{this.direct.has(e)||!(this.score.score(e)>=0)||r&&r.has(e)||t.add(e)})),this.metrics?.onAddToMesh(e,mc.Fanout,t.size)),t.size<this.opts.D){const n=t.size;this.getRandomGossipPeers(e,this.opts.D,(e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0&&(!r||!r.has(e)))).forEach((e=>{t.add(e)})),this.metrics?.onAddToMesh(e,mc.Random,t.size-n)}this.mesh.set(e,t),t.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}leave(e){if(this.status.code!==Bh.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map((async t=>(this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e))))).catch((e=>{this.log("Error sending prunes to mesh peers",e)})),this.mesh.delete(e))}selectPeersToForward(e,t,r){const n=new Set,i=this.topics.get(e);i&&(this.direct.forEach((e=>{i.has(e)&&t!==e&&!r?.has(e)&&n.add(e)})),this.floodsubPeers.forEach((e=>{i.has(e)&&t!==e&&!r?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&n.add(e)})));const s=this.mesh.get(e);return s&&s.size>0&&s.forEach((e=>{t===e||r?.has(e)||n.add(e)})),n}selectPeersToPublish(e){const t=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},n=this.topics.get(e);if(n)if(this.opts.floodPublish)n.forEach((e=>{this.direct.has(e)?(t.add(e),r.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));else{this.direct.forEach((e=>{n.has(e)&&(t.add(e),r.direct++)})),this.floodsubPeers.forEach((e=>{n.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));const i=this.mesh.get(e);if(i&&i.size>0)i.forEach((e=>{t.add(e),r.mesh++}));else{const n=this.fanout.get(e);if(n&&n.size>0)n.forEach((e=>{t.add(e),r.fanout++}));else{const n=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));n.size>0&&(this.fanout.set(e,n),n.forEach((e=>{t.add(e),r.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:r}}forwardMessage(e,t,r,n){r&&this.score.deliverMessage(r,e,t.topic);const i=this.selectPeersToForward(t.topic,r,n);i.forEach((e=>{this.sendRpc(e,{messages:[t]})})),this.metrics?.onForwardMsg(t.topic,i.size)}async publish(e,t,r){const n=Date.now(),i=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:s,msg:o}=await async function(e,t,r,n){switch(e.type){case Wa.Signing:{const i={from:e.author.toBytes(),data:n,seqno:wa(8),topic:t,signature:void 0,key:void 0},s=Zo([Ec,Ro.Message.encode(i).finish()]);return i.signature=await e.privateKey.sign(s),i.key=e.key,{raw:i,msg:{type:"signed",from:e.author,data:r,sequenceNumber:BigInt(`0x${Vo(i.seqno,"base16")}`),topic:t,signature:i.signature,key:i.key}}}case Wa.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:t}}}}(this.publishConfig,e,t,i),a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),u=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(u)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:h,tosendCount:l}=this.selectPeersToPublish(e),f=!0===this.opts.emitSelf&&this.subscriptions.has(e),d=r?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(0===h.size&&!d&&!f)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},s,!0),this.publishedMessageIds.put(c);for(const e of h){this.sendRpc(e,{messages:[s]})||h.delete(e)}const p=Date.now()-n;return this.metrics?.onPublishMsg(e,l,h.size,null!=s.data?s.data.length:0,p),f&&(h.add(this.components.peerId.toString()),super.dispatchEvent(new Po.A("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:o}})),super.dispatchEvent(new Po.A("message",{detail:o}))),{recipients:Array.from(h.values()).map((e=>Ao(e)))}}reportMessageValidationResult(e,t,r){let n;if(r===Ja.Ct.Accept){if(n=this.mcache.validate(e),null!=n){const{message:r,originatingPeers:i}=n;this.score.deliverMessage(t,e,r.topic),this.forwardMessage(e,n.message,t,i)}}else if(n=this.mcache.remove(e),n){const i=Xa(r),{message:s,originatingPeers:o}=n;this.score.rejectMessage(t,e,s.topic,i);for(const t of o)this.score.rejectMessage(t,e,s.topic,i)}const i=this.score.messageFirstSeenTimestampMs(e);this.metrics?.onReportValidation(n,r,i)}sendGraft(e,t){const r=[{topicID:t}];this.sendRpc(e,{control:{graft:r}})}async sendPrune(e,t){const r=[await this.makePrune(e,t,this.opts.doPX,!0)];this.sendRpc(e,{control:{prune:r}})}sendRpc(e,t){const r=this.streamsOutbound.get(e);if(!r)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const n=this.control.get(e);n&&(this.piggybackControl(e,t,n),this.control.delete(e));const i=this.gossip.get(e);i&&(this.piggybackGossip(e,t,i),this.gossip.delete(e));const s=Ro.encode(t).finish();try{r.push(s)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),n&&this.control.set(e,n),i&&this.gossip.set(e,i),!1}return this.metrics?.onRpcSent(t,s.length),!0}piggybackControl(e,t,r){if(r.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(const n of r.graft)n.topicID&&this.mesh.get(n.topicID)?.has(e)&&t.control.graft.push(n)}if(r.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(const n of r.prune)n.topicID&&!this.mesh.get(n.topicID)?.has(e)&&t.control.prune.push(n)}}piggybackGossip(e,t,r){t.control||(t.control={}),t.control.ihave=r}async sendGraftPrune(e,t,r){const n=this.opts.doPX;for(const[i,s]of e){const e=s.map((e=>({topicID:e})));let o=[];const a=t.get(i);a&&(o=await Promise.all(a.map((async e=>await this.makePrune(i,e,n&&!r.get(i),false)))),t.delete(i)),this.sendRpc(i,{control:{graft:e,prune:o}})}for(const[e,i]of t){const t=await Promise.all(i.map((async t=>await this.makePrune(e,t,n&&!r.get(e),false))));this.sendRpc(e,{control:{prune:t}})}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[r,n]of e)this.doEmitGossip(r,n,t.get(r)??[])}doEmitGossip(e,t,r){if(!r.length)return;if(Lo(r),r.length>Mo&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),!t.size)return;let n=this.opts.Dlazy;const i=.25*t.size;let s=t;i>n&&(n=i),n>s.size?n=s.size:s=Lo(Array.from(s)).slice(0,n),s.forEach((t=>{let n=r;r.length>Mo&&(n=Lo(n.slice()).slice(0,Mo)),this.pushGossip(t,{topicID:e,messageIDs:n})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);const r=this.gossip.get(e)||[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,r,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===No)return{topicID:t,peers:[]};const i=n?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,s=i/1e3;if(this.doAddBackoff(e,t,i),!r)return{topicID:t,peers:[],backoff:s};const o=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),a=await Promise.all(Array.from(o).map((async e=>{const t=Ao(e);let r;try{r=await this.components.peerStore.get(t)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return{peerID:t.toBytes(),signedPeerRecord:r?.peerRecordEnvelope}})));return{topicID:t,peers:a,backoff:s}}runHeartbeat=()=>{const e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=e&&e(),this.status.code===Bh.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}}))};async heartbeat(){const{D:e,Dlo:t,Dhi:r,Dscore:n,Dout:i,fanoutTTL:s}=this.opts;this.heartbeatTicks++;const o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},c=new Map,u=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const l=new Map;this.mesh.forEach(((s,o)=>{const f=this.topics.get(o),d=new Set,p=new Set;if(l.set(o,p),f){const e=Lo(Array.from(f)),t=this.backoff.get(o);for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!s.has(r)&&!this.direct.has(r)){const e=a(r);t&&t.has(r)||!(e>=0)||d.add(r),e>=this.opts.scoreThresholds.gossipThreshold&&p.add(r)}}}const y=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),s.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&p.add(e),this.metrics?.onRemoveFromMesh(o,t,1);const r=u.get(e);r?r.push(o):u.set(e,[o])},m=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),s.add(e),p.delete(e),this.metrics?.onAddToMesh(o,t,1);const r=c.get(e);r?r.push(o):c.set(e,[o])};if(s.forEach((e=>{const t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),y(e,gc.BadScore),h.set(e,!0))})),s.size<t){const t=function(e,t){return uc(e,t,(()=>!0))}(d,e-s.size);t.forEach((e=>{m(e,mc.NotEnough)}))}if(s.size>r){let t=Array.from(s);t.sort(((e,t)=>a(t)-a(e))),t=t.slice(0,n).concat(Lo(t.slice(n)));let r=0;if(t.slice(0,e).forEach((e=>{this.outbound.get(e)&&r++})),r<i){const n=e=>{const r=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=r};if(r>0){let i=r;for(let r=1;r<e&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}let i=e-r;for(let r=e;r<t.length&&i>0;r++)this.outbound.get(t[r])&&(n(r),i--)}t.slice(e).forEach((e=>{y(e,gc.Excess)}))}if(s.size>=t){let e=0;if(s.forEach((t=>{this.outbound.get(t)&&e++})),e<i){uc(d,i-e,(e=>!0===this.outbound.get(e))).forEach((e=>{m(e,mc.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&s.size>1){const e=Array.from(s).sort(((e,t)=>a(e)-a(t))),t=Math.floor(s.size/2),r=a(e[t]);if(r<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=uc(d,this.opts.opportunisticGraftPeers,(e=>a(e)>r));for(const t of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,o),m(t,mc.Opportunistic)}}}));const f=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+s<f&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((t,r)=>{const n=this.topics.get(r);t.forEach((e=>{(!n.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)}));const i=this.topics.get(r),s=[],o=new Set;if(l.set(r,o),i){const e=Lo(Array.from(i));for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!t.has(r)&&!this.direct.has(r)){const e=a(r);e>=this.opts.scoreThresholds.publishThreshold&&s.push(r),e>=this.opts.scoreThresholds.gossipThreshold&&o.add(r)}}}if(t.size<e){const r=e-t.size;s.slice(0,r).forEach((e=>{t.add(e),o?.delete(e)}))}})),this.emitGossip(l),await this.sendGraftPrune(c,u,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new Po.A("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,r=(()=>!0)){const n=this.topics.get(e);if(!n)return new Set;let i=[];return n.forEach((e=>{const t=this.streamsOutbound.get(e);t&&this.multicodecs.includes(t.protocol)&&r(e)&&i.push(e)})),i=Lo(i),t>0&&i.length>t&&(i=i.slice(0,t)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;const r=Date.now();e.connectedPeersBackoffSec.reset();for(const n of this.backoff.values()){t+=n.size;for(const[t,i]of n.entries())this.peers.has(t)&&e.connectedPeersBackoffSec.observe(Math.max(0,i-r)/1e3)}e.cacheSize.set({cache:"backoff"},t);for(const[t,r]of this.topics)e.topicPeersCount.set({topicStr:t},r.size);for(const[t,r]of this.mesh)e.meshPeerCounts.set({topicStr:t},r.size);const n=[],i=new Map;e.behaviourPenalty.reset();for(const t of this.peers.keys()){const r=this.score.score(t);n.push(r),i.set(t,r),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,i);const s=function(e,t,r,n,i){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of e){const e=t.get(o);if(e){const t=kc(o,e,r,n,i);for(const[e,r]of t.byTopic){let t=s.byTopic.get(e);t||(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(e,t)),t.p1w.push(r.p1w),t.p2w.push(r.p2w),t.p3w.push(r.p3w),t.p3bw.push(r.p3bw),t.p4w.push(r.p4w)}s.p5w.push(t.p5w),s.p6w.push(t.p6w),s.p7w.push(t.p7w),s.score.push(t.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}}function Lh(e={}){return t=>new Mh(t,e)}var Uh=r(99644),jh=r(79071),Fh=r(44913),Kh=r(18135),zh=r(62298);class $h extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Vh(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new $h(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new $h(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}class qh{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Wh{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new qh(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new qh(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class Hh extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Gh(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new Wh,a=(0,nn.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>i?r:(i=!0,null!=e?(e=>(o=new Wh,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,nn.Z)()}))}},return:()=>(o=new Wh,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new Hh)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(l.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return l.readableLength}},r}var Yh=r(28050);function Jh(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}const Xh=ae({prefix:"9",name:"base10",alphabet:"0123456789"}),Qh=ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Zh=ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),el=ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),tl=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),rl=tl.reduce(((e,t,r)=>(e[r]=t,e)),[]),nl=tl.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const il=oe({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=rl[t]),"")},decode:function(e){const t=[];for(const r of e){const e=nl[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),sl=ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ol=oe({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),al={...H,...V,...W,...z,...$,...n,...c,...i,...s,...q};function cl(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const ul=cl("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),hl=cl("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer?.allocUnsafe?Jh(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var ll={utf8:ul,"utf-8":ul,hex:al.base16,latin1:hl,ascii:hl,binary:hl,...al};function fl(e,t="utf8"){const r=ll[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Jh(globalThis.Buffer.from(e,"utf-8"))}function dl(e,t="utf8"){const r=ll[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var pl,yl=r(62308);!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(pl||(pl={}));const ml=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),gl=Object.freeze({NEW_STREAM:pl.NEW_STREAM,MESSAGE:pl.MESSAGE_INITIATOR,CLOSE:pl.CLOSE_INITIATOR,RESET:pl.RESET_INITIATOR}),bl=Object.freeze({MESSAGE:pl.MESSAGE_RECEIVER,CLOSE:pl.CLOSE_RECEIVER,RESET:pl.RESET_RECEIVER}),wl=1<<20;class vl{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=wl,t=4194304){this._buffer=new yl.H,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){if("ERR_MSG_TOO_BIG"===e.code)throw e;break}const{id:e,type:r,length:n,offset:i}=this._headerInfo;if(this._buffer.length-i<n)break;const s={id:e,type:r};r!==pl.NEW_STREAM&&r!==pl.MESSAGE_INITIATOR&&r!==pl.MESSAGE_RECEIVER||(s.data=this._buffer.sublist(i,i+n)),t.push(s),this._buffer.consume(i+n),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:r}=xl(e),{value:n,offset:i}=xl(e,r),s=7&t;if(null==ml[s])throw new Error(`Invalid type received: ${s}`);if(n>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:s,offset:r+i,length:n}}}const El=128,_l=127;function xl(e,t=0){let r,n=0,i=0,s=t;const o=e.length;do{if(s>=o||i>49)throw t=0,new RangeError("Could not decode varint");r=e.get(s++),n+=i<28?(r&_l)<<i:(r&_l)*Math.pow(2,i),i+=7}while(r>=El);return{value:n,offset:t=s-t}}const kl=1048576,Sl=(e,t)=>{t.append(e)};var Al=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=new yl.H,n=!1,i=(0,nn.Z)(),s=Number(t?.size??kl);if((isNaN(s)||0===s||s<0)&&(s=kl),s!==Math.round(s))throw new Error("Batch size must be an integer");const o=t?.yieldAfter??0,a=t?.serialize??Sl;for(Promise.resolve().then((async()=>{try{let t;for await(const n of e)a(n,r),r.byteLength>=s?(clearTimeout(t),i.resolve()):t=setTimeout((()=>{i.resolve()}),o);clearTimeout(t),i.resolve()}catch(e){i.reject(e)}finally{n=!0}}));!n;)if(await i.promise,i=(0,nn.Z)(),r.byteLength>0){const e=r;r=new yl.H,yield e.subarray()}}():function*(){const r=new yl.H;let n=Number(t?.size??kl);if((isNaN(n)||0===n||n<0)&&(n=kl),n!==Math.round(n))throw new Error("Batch size must be an integer");const i=t?.serialize??Sl;for(const t of e)i(t,r),r.byteLength>=n&&(yield r.subarray(0,n),r.consume(n));r.byteLength>0&&(yield r.subarray())}()};function Il(e){return new Uint8Array(e)}const Tl=10240;const Pl=new class{_pool;_poolOffset;constructor(){this._pool=Il(Tl),this._poolOffset=0}write(e,t){const r=this._pool;let n=this._poolOffset;Wc.cv(e.id<<3|e.type,r,n),n+=Wc.P$(e.id<<3|e.type),e.type!==pl.NEW_STREAM&&e.type!==pl.MESSAGE_INITIATOR&&e.type!==pl.MESSAGE_RECEIVER||null==e.data?(Wc.cv(0,r,n),n+=Wc.P$(0)):(Wc.cv(e.data.length,r,n),n+=Wc.P$(e.data.length));const i=r.subarray(this._poolOffset,n);Tl-n<100?(this._pool=Il(Tl),this._poolOffset=0):this._poolOffset=n,t.append(i),e.type!==pl.NEW_STREAM&&e.type!==pl.MESSAGE_INITIATOR&&e.type!==pl.MESSAGE_RECEIVER||null==e.data||t.append(e.data)}};var Cl=r(77399);class Dl extends Cl.b{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types="outbound"===e.direction?gl:bl,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:gl.NEW_STREAM,data:new yl.H(fl(this.name))})}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}const Rl=ke("libp2p:mplex");function Ol(e){const t={...e,type:`${ml[e.type]} (${e.type})`};return e.type===pl.NEW_STREAM&&(t.data=dl(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==pl.MESSAGE_INITIATOR&&e.type!==pl.MESSAGE_RECEIVER||(t.data=dl(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class Nl{protocol="/mplex/6.7.0";sink;source;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;constructor(e){e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.closeTimeout=e.closeTimeout??500,this.sink=this._createSink(),this._source=function(e={}){return Gh((e=>{let t;const r=[];for(;!e.isEmpty()&&(t=e.shift(),null!=t);){if(null!=t.error)throw t.error;!1===t.done&&r.push(t.value)}return null==t?{done:!0}:{done:!0===t.done,value:r}}),e)}({objectMode:!0,onEnd:()=>{for(const e of this._streams.initiators.values())e.destroy();for(const e of this._streams.receivers.values())e.destroy()}}),this.source=(0,Ci.z)(this._source,(e=>async function*(e,t=0){if(null!=t&&0!==t)yield*Al(e,{size:t,serialize:(e,t)=>{for(const r of e)Pl.write(r,t)}});else for await(const t of e){const e=new yl.H;for(const r of t)Pl.write(r,e);yield e.subarray()}}(e,this._init.minSendBytes))),this.closeController=new AbortController,this.rateLimiter=new Yh.RateLimiterMemory({points:e.disconnectThreshold??5,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}async close(e){if(this.closeController.signal.aborted)return;const t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map((async e=>e.close({signal:t})))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(e){this.abort(e)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach((t=>{t.abort(e)})),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){const{id:t,name:r,type:n,registry:i}=e;if(Rl("new %s stream %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??1024))throw new Di.sv("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(i.has(t))throw new Error(`${n} stream ${t} already exists!`);const s=function(e){const{id:t,name:r,send:n,onEnd:i,type:s="initiator",maxMsgSize:o=wl}=e;return new Dl({id:"initiator"===s?`i${t}`:`r${t}`,streamId:t,name:`${null==r?t:r}`,direction:"initiator"===s?"outbound":"inbound",maxDataSize:o,onEnd:i,send:n,log:ke(`libp2p:mplex:stream:${s}:${t}`)})}({id:t,name:r,send:async e=>{Rl.enabled&&Rl.trace("%s stream %s send",n,t,Ol(e)),this._source.push(e)},type:n,onEnd:()=>{Rl("%s stream with id %s and protocol %s ended",n,t,s.protocol),i.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(s)},maxMsgSize:this._init.maxMsgSize});return i.set(t,s),s}_createSink(){return async e=>{try{e=Vh(e,this.closeController.signal,{returnOnAbort:!0});const t=new vl(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const r of e)for(const e of t.write(r))await this._handleIncoming(e);this._source.end()}catch(e){Rl("error in sink",e),this._source.end(e)}}}async _handleIncoming(e){const{id:t,type:r}=e;if(Rl.enabled&&Rl.trace("incoming message",Ol(e)),e.type===pl.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??1024)){Rl("too many inbound streams open"),this._source.push({id:t,type:pl.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return Rl("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this.abort(new Error("Too many open streams"))}return}const r=this._newReceiverStream({id:t,name:dl(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(r))}const n=(1==(1&r)?this._streams.initiators:this._streams.receivers).get(t);if(null==n){Rl("missing stream %s for message type %s",t,ml[r]);try{await this.rateLimiter.consume("missing-stream",1)}catch{return Rl("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),void this.abort(new Error("Too many messages for missing streams"))}return}const i=this._init.maxStreamBufferSize??4194304;try{switch(r){case pl.MESSAGE_INITIATOR:case pl.MESSAGE_RECEIVER:if(n.sourceReadableLength()>i)throw this._source.push({id:e.id,type:r===pl.MESSAGE_INITIATOR?pl.RESET_RECEIVER:pl.RESET_INITIATOR}),new Di.sv("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");n.sourcePush(e.data);break;case pl.CLOSE_INITIATOR:case pl.CLOSE_RECEIVER:n.remoteCloseWrite();break;case pl.RESET_INITIATOR:case pl.RESET_RECEIVER:n.reset();break;default:Rl("unknown message type %s",r)}}catch(e){Rl.error("error while processing message",e),n.abort(e)}}}class Bl{protocol="/mplex/6.7.0";_init;constructor(e={}){this._init=e}createStreamMuxer(e={}){return new Nl({...e,...this._init})}}function Ml(e={}){return()=>new Bl(e)}var Ll=r(46177),Ul=r(57392),jl=r(15624);function Fl(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Kl(e=0){return null!=globalThis.Buffer?.allocUnsafe?Fl(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function zl(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const $l=zl("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Vl=zl("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Kl((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var ql={utf8:$l,"utf-8":$l,hex:al.base16,latin1:Vl,ascii:Vl,binary:Vl,...al};function Wl(e,t="utf8"){const r=ql[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Fl(globalThis.Buffer.from(e,"utf-8"))}function Hl(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const Gl=32,Yl=64,Jl=32;function Xl(e,t){const r=new Uint8Array(Yl);for(let n=0;n<Jl;n++)r[n]=e[n],r[Jl+n]=t[n];return r}function Ql(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Kl(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return Fl(r)}var Zl={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const ef={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function tf(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=Zl.get();return r*=8,{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),h=a.getRandomValues(new Uint8Array(n)),l={name:t,iv:h};let f;if("string"==typeof c&&(c=Wl(c)),0===c.length){f=await a.subtle.importKey("jwk",ef,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{f=await a.subtle.importKey("jwk",ef,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const d=await a.subtle.encrypt(l,f,e);return Ql([u,l.iv,new Uint8Array(d)])},decrypt:async function(e,c){const u=e.subarray(0,s),h=e.subarray(s,s+n),l=e.subarray(s+n),f={name:t,iv:h};let d;if("string"==typeof c&&(c=Wl(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{d=await a.subtle.importKey("jwk",ef,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(f,d,l);return new Uint8Array(p)}}}(),n=await r.encrypt(e,t);return ve.encode(n)}var rf,nf,sf,of;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(rf||(rf={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(nf||(nf={})),function(e){e.codec=()=>(0,aa.Ji)(nf)}(rf||(rf={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),rf.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=rf.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(sf||(sf={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,aa.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),rf.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=rf.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(of||(of={}));class af{_key;constructor(e){this._key=df(e,Gl)}async verify(e,t){return async function(e,t,r){return Go.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return sf.encode({Type:rf.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}}class cf{_key;_publicKey;constructor(e,t){this._key=df(e,Yl),this._publicKey=df(t,Gl)}async sign(e){return async function(e,t){const r=e.subarray(0,Jl);return Go.UN.sign(t,r)}(this._key,e)}get public(){return new af(this._publicKey)}marshal(){return this._key}get bytes(){return of.encode({Type:rf.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}async id(){const e=Ze.digest(this.public.bytes);return be.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return tf(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function uf(e){if(e.length>Yl){const t=(e=df(e,Yl+Gl)).subarray(0,Yl),r=e.subarray(Yl,e.length);return new cf(t,r)}const t=(e=df(e,Yl)).subarray(0,Yl),r=e.subarray(Gl);return new cf(t,r)}function hf(e){return e=df(e,Gl),new af(e)}async function lf(){const{privateKey:e,publicKey:t}=await async function(){const e=Go.UN.utils.randomPrivateKey(),t=Go.UN.getPublicKey(e);return{privateKey:Xl(e,t),publicKey:t}}();return new cf(e,t)}async function ff(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==Jl)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=Go.UN.getPublicKey(t);return{privateKey:Xl(t,r),publicKey:r}}(e);return new cf(t,r)}function df(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new Di.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}function pf(e,t="utf8"){const r=ql[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function yf(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Ql([new Uint8Array(t-r.length),r])}return pf(r,"base64url")}function mf(e){const t=function(e,t){let r=Wl(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Ql([new Uint8Array(t-r.length),r])}return r}(e);return new Wo.jsbn.BigInteger(pf(t,"base16"),16)}const gf={"P-256":256,"P-384":384,"P-521":521};Object.keys(gf).join(" / ");const bf="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function wf(e){if(isNaN(e)||e<=0)throw new Di.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(bf&&"function"==typeof bf.getRandomValues)return bf.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}function vf(e,t){return t.map((t=>mf(e[t])))}async function Ef(e){const t=[await Zl.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await xf(e)],r=await _f({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function _f(e){if(null==e.privateKey||null==e.publicKey)throw new Di.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Zl.get().subtle.exportKey("jwk",e.privateKey),Zl.get().subtle.exportKey("jwk",e.publicKey)])}async function xf(e){return Zl.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function kf(e,t,r,n){const i=t?function(e){return Wo.pki.setRsaPublicKey(...vf(e,["n","e"]))}(e):function(e){return Wo.pki.setRsaPrivateKey(...vf(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Wl(n(pf(Uint8Array.from(r),"ascii"),i),"ascii")}function Sf(e){if("RSA"!==e.kty)throw new Di.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new Di.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*Wl(e.n,"base64url").length}const Af=8192;class If{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await Zl.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Zl.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Wo.pki.publicKeyToAsn1({n:mf(e.n),e:mf(e.e)});return Wl(Wo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return sf.encode({Type:rf.RSA,Data:this.marshal()}).subarray()}encrypt(e){return kf(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}}class Tf{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return wf(16)}async sign(e){return async function(e,t){const r=await Zl.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Zl.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new Di.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new If(this._publicKey)}decrypt(e){return kf(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new Di.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Wo.pki.privateKeyToAsn1({n:mf(e.n),e:mf(e.e),d:mf(e.d),p:mf(e.p),q:mf(e.q),dP:mf(e.dp),dQ:mf(e.dq),qInv:mf(e.qi)});return Wl(Wo.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return of.encode({Type:rf.RSA,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}async id(){return pf(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new Wo.util.ByteBuffer(this.marshal()),r=Wo.asn1.fromDer(t),n=Wo.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return Wo.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return tf(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Pf(e){const t=function(e){const t=Wo.asn1.fromDer(pf(e,"ascii")),r=Wo.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:yf(r.n),e:yf(r.e),d:yf(r.d),p:yf(r.p),q:yf(r.q),dp:yf(r.dP),dq:yf(r.dQ),qi:yf(r.qInv),alg:"RS256"}}(e);if(Sf(t)>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await Ef(t);return new Tf(r.privateKey,r.publicKey)}function Cf(e){const t=function(e){const t=Wo.asn1.fromDer(pf(e,"ascii")),r=Wo.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:yf(r.n),e:yf(r.e)}}(e);if(Sf(t)>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new If(t)}async function Df(e){if(Sf(e)>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Ef(e);return new Tf(t.privateKey,t.publicKey)}async function Rf(e){if(e>Af)throw new Di.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Zl.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await _f(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Tf(t.privateKey,t.publicKey)}function Of(e){try{Oa.kA.ProjectivePoint.fromHex(e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Nf{_key;constructor(e){Of(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await nt.digest(r);return Oa.kA.verify(t,n,e)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Oa.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return sf.encode({Type:rf.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}}class Bf{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return Oa.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Oa.kA.getPublicKey(e,!0)}catch(e){throw new Di.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Of(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await nt.digest(t);try{return Oa.kA.sign(r,e).toDERRawBytes()}catch(e){throw new Di.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Nf(this._publicKey)}marshal(){return this._key}get bytes(){return of.encode({Type:rf.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hl(this.bytes,e.bytes)}async hash(){const{bytes:e}=await nt.digest(this.bytes);return e}async id(){return pf(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return tf(this.bytes,e);throw new Di.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Mf(e){return new Bf(e)}function Lf(e){return new Nf(e)}async function Uf(){const e=Oa.kA.utils.randomPrivateKey();return new Bf(e)}const jf={rsa:Y,ed25519:G,secp256k1:J};function Ff(e){const t=Object.keys(jf).join(" / ");return new Di.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function Kf(e){const t=sf.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case rf.RSA:return jf.rsa.unmarshalRsaPublicKey(r);case rf.Ed25519:return jf.ed25519.unmarshalEd25519PublicKey(r);case rf.Secp256k1:return jf.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Ff(t.Type??"unknown")}}function zf(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const $f=Symbol.for("nodejs.util.inspect.custom"),Vf=Object.values(al).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),al.identity.decoder),qf=114,Wf=36,Hf=37;class Gf{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Ri.N]=!0;toString(){return null==this.string&&(this.string=be.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Yr.createV1(qf,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return zf(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??Vf,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Je(be.decode(`z${e}`));return e.startsWith("12D")?new Jf({multihash:t}):e.startsWith("16U")?new Xf({multihash:t}):new Yf({multihash:t})}return Qf(Vf.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return zf(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[$f](){return`PeerId(${this.toString()})`}}class Yf extends Gf{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Jf extends Gf{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class Xf extends Gf{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function Qf(e){try{const t=Je(e);if(t.code===Ze.code){if(t.digest.length===Wf)return new Jf({multihash:t});if(t.digest.length===Hf)return new Xf({multihash:t})}if(t.code===nt.code)return new Yf({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==qf)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===nt.code)return new Yf({multihash:e.multihash});if(t.code===Ze.code){if(t.digest.length===Wf)return new Jf({multihash:e.multihash});if(t.digest.length===Hf)return new Xf({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Yr.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var Zf=r(32114),ed=r(79297),td=r(41690);const rd="ERR_UNRECOGNIZED_VALIDITY",nd="ERR_SIGNATURE_VERIFICATION",id="ERR_UNRECOGNIZED_FORMAT",sd="ERR_UNDEFINED_PARAMETER",od="ERR_RECORD_TOO_LARGE";var ad;!function(e){let t,r,n;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(r||(r={})),function(e){e.codec=()=>(0,aa.Ji)(r)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==n&&(n=(0,aa.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.value&&(r.uint32(10),r.bytes(t.value)),null!=t.signatureV1&&(r.uint32(18),r.bytes(t.signatureV1)),null!=t.validityType&&(r.uint32(24),e.ValidityType.codec().encode(t.validityType,r)),null!=t.validity&&(r.uint32(34),r.bytes(t.validity)),null!=t.sequence&&(r.uint32(40),r.uint64(t.sequence)),null!=t.ttl&&(r.uint32(48),r.uint64(t.ttl)),null!=t.pubKey&&(r.uint32(58),r.bytes(t.pubKey)),null!=t.signatureV2&&(r.uint32(66),r.bytes(t.signatureV2)),null!=t.data&&(r.uint32(74),r.bytes(t.data)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.value=t.bytes();break;case 2:n.signatureV1=t.bytes();break;case 3:n.validityType=e.ValidityType.codec().decode(t);break;case 4:n.validity=t.bytes();break;case 5:n.sequence=t.uint64();break;case 6:n.ttl=t.uint64();break;case 7:n.pubKey=t.bytes();break;case 8:n.signatureV2=t.bytes();break;case 9:n.data=t.bytes();break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,aa.LE)(t,e.codec()),e.decode=t=>(0,aa.C6)(t,e.codec())}(ad||(ad={}));const cd=ke("ipns:utils"),ud=(0,jr.m)("/ipns/");const hd=async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw cd.error(e),Zf(e,sd)}let r;if(null!=t.pubKey){try{r=Kf(t.pubKey)}catch(e){throw cd.error(e),e}if(!(await async function(e,t){return e.length===Wf?new Jf({multihash:Ye(Ze.code,e),privateKey:t}):e.length===Hf?new Xf({multihash:Ye(Ze.code,e),privateKey:t}):new Yf({multihash:await nt.digest(e),publicKey:e,privateKey:t})}(t.pubKey)).equals(e))throw Zf(new Error("Embedded public key did not match PeerID"),"ERR_INVALID_EMBEDDED_KEY")}else null!=e.publicKey&&(r=Kf(e.publicKey));if(null!=r)return r;throw Zf(new Error("no public key is available"),sd)};function ld(e){const t=ad.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw Zf(new Error("missing data or signatureV2"),nd);const r=dd(t.data),n=pd(r.Value);let i;try{i=ed.fromDate(function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw new Error("Invalid format");const n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),u=parseInt(r[7].padEnd(6,"0").slice(0,3),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}((0,Ur.B)(r.Validity)))}catch(e){throw cd.error("unrecognized validity format (not an rfc3339 format)"),Zf(new Error("unrecognized validity format (not an rfc3339 format)"),id)}if(null!=t.value&&null!=t.signatureV1)return yd(t),{value:n,validityType:ad.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:n,validityType:ad.ValidityType.EOL,validity:i,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}const fd=e=>Qf(e.slice(ud.length)),dd=e=>{const t=Mr(e);if(0!==t.ValidityType)throw Zf(new Error("Unknown validity type"),rd);return t.ValidityType=ad.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t},pd=e=>{if(null!=e){if((0,Ri.I)(e))return`/ipns/${e.toCID().toString(Vr)}`;if(e instanceof Uint8Array){const t=(0,Ur.B)(e);t.startsWith("/")&&(e=t)}const t=e.toString().trim();if(t.startsWith("/")&&t.length>1)return t;const r=Yr.asCID(e);if(null!=r)return 114===r.code?`/ipns/${r.toString(Vr)}`:`/ipfs/${r.toV1().toString()}`;try{return e instanceof Uint8Array?`/ipfs/${Yr.decode(e).toV1().toString()}`:`/ipfs/${Yr.parse(t).toV1().toString()}`}catch{}}throw Zf(new Error("Value must be a valid content path starting with /"),"ERR_INVALID_VALUE")},yd=e=>{if(null==e.data)throw Zf(new Error("Record data is missing"),"ERR_INVALID_RECORD_DATA");const t=dd(e.data);if(!(0,zn.f)(t.Value,e.value??new Uint8Array(0)))throw Zf(new Error('Field "value" did not match between protobuf and CBOR'),nd);if(!(0,zn.f)(t.Validity,e.validity??new Uint8Array(0)))throw Zf(new Error('Field "validity" did not match between protobuf and CBOR'),nd);if(t.ValidityType!==e.validityType)throw Zf(new Error('Field "validityType" did not match between protobuf and CBOR'),nd);if(t.Sequence!==e.sequence)throw Zf(new Error('Field "sequence" did not match between protobuf and CBOR'),nd);if(t.TTL!==e.ttl)throw Zf(new Error('Field "ttl" did not match between protobuf and CBOR'),nd)};function md(e,t){const r=t.map(((e,t)=>({record:ld(e),index:t})));return r.sort(((e,t)=>{const r=e.record.sequence,n=t.record.sequence;if(r>n)return-1;if(r<n)return 1;const i=e.record.validity.toDate(),s=t.record.validity.toDate();return i.getTime()>s.getTime()?-1:i.getTime()<s.getTime()?1:0})),r[0].index}const gd=ke("ipns:validator"),bd=10240,wd=async(e,t)=>{const r=ld(t);let n;try{const t=(e=>{const t=(0,jr.m)("ipns-signature:");return(0,td.z)([t,e])})(r.data);n=await e.verify(t,r.signatureV2)}catch(e){n=!1}if(!n)throw gd.error("record signature verification failed"),Zf(new Error("record signature verification failed"),nd);if(r.validityType===ad.ValidityType.EOL){if(r.validity.toDate().getTime()<Date.now())throw gd.error("record has expired"),Zf(new Error("record has expired"),"ERR_IPNS_EXPIRED_RECORD")}else if(null!=r.validityType)throw gd.error("unrecognized validity type"),Zf(new Error("unrecognized validity type"),rd);gd("ipns record for %b is valid",r.value)};async function vd(e,t){if(t.byteLength>bd)throw Zf(new Error("record too large"),od);const r=fd(e),n=ld(t),i=await hd(r,n);await wd(i,t)}var Ed=r(76805),_d=r(69850),xd=r(90704),kd=r(21141),Sd=r(70036);const Ad={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};async function Id(e,t){const r={addresses:{listen:["/webrtc"]},transports:[(0,_d.f)({discoverRelays:1}),(0,Ll.Z)(),(0,Ll.R)(),(0,jl.d)(),(0,Ul.E)()],connectionEncryption:[(0,Uh.t)()],streamMuxers:[(0,jh.P)(),Ml()],peerDiscovery:[(0,Fh.U)(Ad)],contentRouters:[(0,Kh.$)("https://cid.contact")],services:{identify:(0,kd.HA)(),autoNAT:(0,Ed.D)(),pubsub:Lh(),dcutr:(0,xd.P)(),dht:(0,zh.p7)({clientMode:!0,validators:{ipns:vd},selectors:{ipns:md}}),ping:(0,Sd.J)()}};return t=t??{},(0,Pi.N)({datastore:e,...r,...t,start:!1})}const Td="2.0.3",Pd="helia",Cd=ke("helia");async function Dd(e={}){const t=e.datastore??new Ae.ar,r=e.blockstore??new Se.DA;let n;n=function(e){if(null==e)return!1;return["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every((t=>"function"==typeof e[t]))}(e.libp2p)?e.libp2p:await Id(t,e.libp2p);const i=new Ti({...e,datastore:t,blockstore:r,libp2p:n});return!1!==e.start&&await i.start(),function(e){try{if(null==e.libp2p.services.identify.host.agentVersion.match(/js-libp2p\/\d+\.\d+\.\d+\sUserAgent=/))return;e.libp2p.services.identify.host.agentVersion=`${Pd}/${Td} ${e.libp2p.services.identify.host.agentVersion}`}catch(e){Cd.error("could not add Helia to agent version",e)}}(i),i}},4424:function(e,t,r){"use strict";r.d(t,{Lj:function(){return g},X3:function(){return m}});const n=(e,t)=>t.some((t=>e instanceof t));let i,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap;let l={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return p(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(y(this),t),p(o.get(this))}:function(...t){return p(e.apply(y(this),t))}:function(t,...r){const n=e.call(y(this),t,...r);return c.set(n,t.sort?t.sort():[t]),p(n)}}function d(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));a.set(e,t)}(e),n(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,l):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(p(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),h.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=d(e);return t!==e&&(u.set(e,t),h.set(t,e)),t}const y=e=>h.get(e);function m(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=p(o);return n&&o.addEventListener("upgradeneeded",(e=>{n(p(o.result),e.oldVersion,e.newVersion,p(o.transaction),e)})),r&&o.addEventListener("blocked",(e=>r(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}function g(e,{blocked:t}={}){const r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",(e=>t(e.oldVersion,e))),p(r).then((()=>{}))}const b=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],v=new Map;function E(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(v.get(t))return v.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=w.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!b.includes(r))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),i&&s.done]))[0]};return v.set(t,s),s}l=(e=>({...e,get:(t,r,n)=>E(t,r)||e.get(t,r,n),has:(t,r)=>!!E(t,r)||e.has(t,r)}))(l)}}]);
//# sourceMappingURL=630.8687bc8c.chunk.js.map