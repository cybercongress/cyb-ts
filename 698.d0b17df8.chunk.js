/*! For license information please see 698.d0b17df8.chunk.js.LICENSE.txt */
(self.webpackChunkcyb=self.webpackChunkcyb||[]).push([[698],{96945:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,s),!0;case 6:return l.fn.call(l.context,t,n,i,s,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},36026:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,s),!0;case 6:return l.fn.call(l.context,t,n,i,s,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},73223:function(e){e.exports=function e(n,i){var s,o=0,a=0,c=i=i||0,u=n.length;do{if(c>=u||a>49)throw e.bytes=0,new RangeError("Could not decode varint");s=n[c++],o+=a<28?(s&r)<<a:(s&r)*Math.pow(2,a),a+=7}while(s>=t);return e.bytes=c-i,o};var t=128,r=127},81557:function(e){e.exports=function e(i,s,o){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");s=s||[];var a=o=o||0;for(;i>=n;)s[o++]=255&i|t,i/=128;for(;i&r;)s[o++]=255&i|t,i>>>=7;return s[o]=0|i,e.bytes=o-a+1,s};var t=128,r=-128,n=Math.pow(2,31)},59379:function(e,t,r){e.exports={encode:r(81557),decode:r(73223),encodingLength:r(35374)}},35374:function(e){var t=Math.pow(2,7),r=Math.pow(2,14),n=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<r?2:e<n?3:e<i?4:e<s?5:e<o?6:e<a?7:e<c?8:e<u?9:10}},76915:function(e){e.exports=function e(n,i){var s,o=0,a=0,c=i=i||0,u=n.length;do{if(c>=u||a>49)throw e.bytes=0,new RangeError("Could not decode varint");s=n[c++],o+=a<28?(s&r)<<a:(s&r)*Math.pow(2,a),a+=7}while(s>=t);return e.bytes=c-i,o};var t=128,r=127},1824:function(e){e.exports=function e(i,s,o){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");s=s||[];var a=o=o||0;for(;i>=n;)s[o++]=255&i|t,i/=128;for(;i&r;)s[o++]=255&i|t,i>>>=7;return s[o]=0|i,e.bytes=o-a+1,s};var t=128,r=-128,n=Math.pow(2,31)},31617:function(e,t,r){e.exports={encode:r(1824),decode:r(76915),encodingLength:r(19145)}},19145:function(e){var t=Math.pow(2,7),r=Math.pow(2,14),n=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<r?2:e<n?3:e<i?4:e<s?5:e<o?6:e<a?7:e<c?8:e<u?9:10}},404:function(e){e.exports=function e(n,i){var s,o=0,a=0,c=i=i||0,u=n.length;do{if(c>=u||a>49)throw e.bytes=0,new RangeError("Could not decode varint");s=n[c++],o+=a<28?(s&r)<<a:(s&r)*Math.pow(2,a),a+=7}while(s>=t);return e.bytes=c-i,o};var t=128,r=127},27666:function(e){e.exports=function e(i,s,o){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");s=s||[];var a=o=o||0;for(;i>=n;)s[o++]=255&i|t,i/=128;for(;i&r;)s[o++]=255&i|t,i>>>=7;return s[o]=0|i,e.bytes=o-a+1,s};var t=128,r=-128,n=Math.pow(2,31)},9027:function(e,t,r){e.exports={encode:r(27666),decode:r(404),encodingLength:r(67387)}},67387:function(e){var t=Math.pow(2,7),r=Math.pow(2,14),n=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<r?2:e<n?3:e<i?4:e<s?5:e<o?6:e<a?7:e<c?8:e<u?9:10}},88747:function(e,t,r){"use strict";const{encodeText:n}=r(94409);e.exports=class{constructor(e,t,r,i){this.name=e,this.code=t,this.codeBuf=n(this.code),this.alphabet=i,this.codec=r(i)}encode(e){return this.codec.encode(e)}decode(e){for(const t of e)if(this.alphabet&&this.alphabet.indexOf(t)<0)throw new Error(`invalid character '${t}' in '${e}'`);return this.codec.decode(e)}}},65167:function(e,t,r){"use strict";const n=r(28820),i=r(88747),{rfc4648:s}=r(77908),{decodeText:o,encodeText:a}=r(94409),c=[["identity","\0",()=>({encode:o,decode:a}),""],["base2","0",s(1),"01"],["base8","7",s(3),"01234567"],["base10","9",n,"0123456789"],["base16","f",s(4),"0123456789abcdef"],["base16upper","F",s(4),"0123456789ABCDEF"],["base32hex","v",s(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",s(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",s(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",s(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",s(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",s(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",s(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",s(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",s(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",n,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",n,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",n,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",n,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",s(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",s(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",s(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",s(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],u=c.reduce(((e,t)=>(e[t[0]]=new i(t[0],t[1],t[2],t[3]),e)),{}),l=c.reduce(((e,t)=>(e[t[1]]=u[t[0]],e)),{});e.exports={names:u,codes:l}},26869:function(e,t,r){"use strict";const n=r(65167),{encodeText:i,decodeText:s,concat:o}=r(94409);function a(e){if(Object.prototype.hasOwnProperty.call(n.names,e))return n.names[e];if(Object.prototype.hasOwnProperty.call(n.codes,e))return n.codes[e];throw new Error(`Unsupported encoding: ${e}`)}(t=e.exports=function(e,t){if(!t)throw new Error("requires an encoded Uint8Array");const{name:r,codeBuf:n}=a(e);return function(e,t){const r=a(e);r.decode(s(t))}(r,t),o([n,t],n.length+t.length)}).encode=function(e,t){const r=a(e),n=i(r.encode(t));return o([r.codeBuf,n],r.codeBuf.length+n.length)},t.decode=function(e){e instanceof Uint8Array&&(e=s(e));const t=e[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(t)&&(e=e.toLowerCase()),a(e[0]).decode(e.substring(1))},t.isEncoded=function(e){if(e instanceof Uint8Array&&(e=s(e)),"[object String]"!==Object.prototype.toString.call(e))return!1;try{return a(e[0]).name}catch(e){return!1}},t.encoding=a,t.encodingFromData=function(e){return e instanceof Uint8Array&&(e=s(e)),a(e[0])};const c=Object.freeze(n.names),u=Object.freeze(n.codes);t.names=c,t.codes=u},77908:function(e){"use strict";e.exports={rfc4648:e=>t=>({encode:r=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(r,t,e),decode:r=>((e,t,r)=>{const n={};for(let e=0;e<t.length;++e)n[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const s=new Uint8Array(i*r/8|0);let o=0,a=0,c=0;for(let t=0;t<i;++t){const i=n[e[t]];if(void 0===i)throw new SyntaxError("Invalid character "+e[t]);a=a<<r|i,o+=r,o>=8&&(o-=8,s[c++]=255&a>>o)}if(o>=r||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return s})(r,t,e)})}},94409:function(e){"use strict";const t=new TextDecoder,r=new TextEncoder;e.exports={decodeText:e=>t.decode(e),encodeText:e=>r.encode(e),concat:function(e,t){const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}}},22465:function(e){"use strict";const t=Object.freeze({identity:0,sha1:17,"sha2-256":18,"sha2-512":19,"sha3-512":20,"sha3-384":21,"sha3-256":22,"sha3-224":23,"shake-128":24,"shake-256":25,"keccak-224":26,"keccak-256":27,"keccak-384":28,"keccak-512":29,blake3:30,"murmur3-128":34,"murmur3-32":35,"dbl-sha2-256":86,md4:212,md5:213,bmt:214,"sha2-256-trunc254-padded":4114,"ripemd-128":4178,"ripemd-160":4179,"ripemd-256":4180,"ripemd-320":4181,x11:4352,kangarootwelve:7425,"sm3-256":21325,"blake2b-8":45569,"blake2b-16":45570,"blake2b-24":45571,"blake2b-32":45572,"blake2b-40":45573,"blake2b-48":45574,"blake2b-56":45575,"blake2b-64":45576,"blake2b-72":45577,"blake2b-80":45578,"blake2b-88":45579,"blake2b-96":45580,"blake2b-104":45581,"blake2b-112":45582,"blake2b-120":45583,"blake2b-128":45584,"blake2b-136":45585,"blake2b-144":45586,"blake2b-152":45587,"blake2b-160":45588,"blake2b-168":45589,"blake2b-176":45590,"blake2b-184":45591,"blake2b-192":45592,"blake2b-200":45593,"blake2b-208":45594,"blake2b-216":45595,"blake2b-224":45596,"blake2b-232":45597,"blake2b-240":45598,"blake2b-248":45599,"blake2b-256":45600,"blake2b-264":45601,"blake2b-272":45602,"blake2b-280":45603,"blake2b-288":45604,"blake2b-296":45605,"blake2b-304":45606,"blake2b-312":45607,"blake2b-320":45608,"blake2b-328":45609,"blake2b-336":45610,"blake2b-344":45611,"blake2b-352":45612,"blake2b-360":45613,"blake2b-368":45614,"blake2b-376":45615,"blake2b-384":45616,"blake2b-392":45617,"blake2b-400":45618,"blake2b-408":45619,"blake2b-416":45620,"blake2b-424":45621,"blake2b-432":45622,"blake2b-440":45623,"blake2b-448":45624,"blake2b-456":45625,"blake2b-464":45626,"blake2b-472":45627,"blake2b-480":45628,"blake2b-488":45629,"blake2b-496":45630,"blake2b-504":45631,"blake2b-512":45632,"blake2s-8":45633,"blake2s-16":45634,"blake2s-24":45635,"blake2s-32":45636,"blake2s-40":45637,"blake2s-48":45638,"blake2s-56":45639,"blake2s-64":45640,"blake2s-72":45641,"blake2s-80":45642,"blake2s-88":45643,"blake2s-96":45644,"blake2s-104":45645,"blake2s-112":45646,"blake2s-120":45647,"blake2s-128":45648,"blake2s-136":45649,"blake2s-144":45650,"blake2s-152":45651,"blake2s-160":45652,"blake2s-168":45653,"blake2s-176":45654,"blake2s-184":45655,"blake2s-192":45656,"blake2s-200":45657,"blake2s-208":45658,"blake2s-216":45659,"blake2s-224":45660,"blake2s-232":45661,"blake2s-240":45662,"blake2s-248":45663,"blake2s-256":45664,"skein256-8":45825,"skein256-16":45826,"skein256-24":45827,"skein256-32":45828,"skein256-40":45829,"skein256-48":45830,"skein256-56":45831,"skein256-64":45832,"skein256-72":45833,"skein256-80":45834,"skein256-88":45835,"skein256-96":45836,"skein256-104":45837,"skein256-112":45838,"skein256-120":45839,"skein256-128":45840,"skein256-136":45841,"skein256-144":45842,"skein256-152":45843,"skein256-160":45844,"skein256-168":45845,"skein256-176":45846,"skein256-184":45847,"skein256-192":45848,"skein256-200":45849,"skein256-208":45850,"skein256-216":45851,"skein256-224":45852,"skein256-232":45853,"skein256-240":45854,"skein256-248":45855,"skein256-256":45856,"skein512-8":45857,"skein512-16":45858,"skein512-24":45859,"skein512-32":45860,"skein512-40":45861,"skein512-48":45862,"skein512-56":45863,"skein512-64":45864,"skein512-72":45865,"skein512-80":45866,"skein512-88":45867,"skein512-96":45868,"skein512-104":45869,"skein512-112":45870,"skein512-120":45871,"skein512-128":45872,"skein512-136":45873,"skein512-144":45874,"skein512-152":45875,"skein512-160":45876,"skein512-168":45877,"skein512-176":45878,"skein512-184":45879,"skein512-192":45880,"skein512-200":45881,"skein512-208":45882,"skein512-216":45883,"skein512-224":45884,"skein512-232":45885,"skein512-240":45886,"skein512-248":45887,"skein512-256":45888,"skein512-264":45889,"skein512-272":45890,"skein512-280":45891,"skein512-288":45892,"skein512-296":45893,"skein512-304":45894,"skein512-312":45895,"skein512-320":45896,"skein512-328":45897,"skein512-336":45898,"skein512-344":45899,"skein512-352":45900,"skein512-360":45901,"skein512-368":45902,"skein512-376":45903,"skein512-384":45904,"skein512-392":45905,"skein512-400":45906,"skein512-408":45907,"skein512-416":45908,"skein512-424":45909,"skein512-432":45910,"skein512-440":45911,"skein512-448":45912,"skein512-456":45913,"skein512-464":45914,"skein512-472":45915,"skein512-480":45916,"skein512-488":45917,"skein512-496":45918,"skein512-504":45919,"skein512-512":45920,"skein1024-8":45921,"skein1024-16":45922,"skein1024-24":45923,"skein1024-32":45924,"skein1024-40":45925,"skein1024-48":45926,"skein1024-56":45927,"skein1024-64":45928,"skein1024-72":45929,"skein1024-80":45930,"skein1024-88":45931,"skein1024-96":45932,"skein1024-104":45933,"skein1024-112":45934,"skein1024-120":45935,"skein1024-128":45936,"skein1024-136":45937,"skein1024-144":45938,"skein1024-152":45939,"skein1024-160":45940,"skein1024-168":45941,"skein1024-176":45942,"skein1024-184":45943,"skein1024-192":45944,"skein1024-200":45945,"skein1024-208":45946,"skein1024-216":45947,"skein1024-224":45948,"skein1024-232":45949,"skein1024-240":45950,"skein1024-248":45951,"skein1024-256":45952,"skein1024-264":45953,"skein1024-272":45954,"skein1024-280":45955,"skein1024-288":45956,"skein1024-296":45957,"skein1024-304":45958,"skein1024-312":45959,"skein1024-320":45960,"skein1024-328":45961,"skein1024-336":45962,"skein1024-344":45963,"skein1024-352":45964,"skein1024-360":45965,"skein1024-368":45966,"skein1024-376":45967,"skein1024-384":45968,"skein1024-392":45969,"skein1024-400":45970,"skein1024-408":45971,"skein1024-416":45972,"skein1024-424":45973,"skein1024-432":45974,"skein1024-440":45975,"skein1024-448":45976,"skein1024-456":45977,"skein1024-464":45978,"skein1024-472":45979,"skein1024-480":45980,"skein1024-488":45981,"skein1024-496":45982,"skein1024-504":45983,"skein1024-512":45984,"skein1024-520":45985,"skein1024-528":45986,"skein1024-536":45987,"skein1024-544":45988,"skein1024-552":45989,"skein1024-560":45990,"skein1024-568":45991,"skein1024-576":45992,"skein1024-584":45993,"skein1024-592":45994,"skein1024-600":45995,"skein1024-608":45996,"skein1024-616":45997,"skein1024-624":45998,"skein1024-632":45999,"skein1024-640":46e3,"skein1024-648":46001,"skein1024-656":46002,"skein1024-664":46003,"skein1024-672":46004,"skein1024-680":46005,"skein1024-688":46006,"skein1024-696":46007,"skein1024-704":46008,"skein1024-712":46009,"skein1024-720":46010,"skein1024-728":46011,"skein1024-736":46012,"skein1024-744":46013,"skein1024-752":46014,"skein1024-760":46015,"skein1024-768":46016,"skein1024-776":46017,"skein1024-784":46018,"skein1024-792":46019,"skein1024-800":46020,"skein1024-808":46021,"skein1024-816":46022,"skein1024-824":46023,"skein1024-832":46024,"skein1024-840":46025,"skein1024-848":46026,"skein1024-856":46027,"skein1024-864":46028,"skein1024-872":46029,"skein1024-880":46030,"skein1024-888":46031,"skein1024-896":46032,"skein1024-904":46033,"skein1024-912":46034,"skein1024-920":46035,"skein1024-928":46036,"skein1024-936":46037,"skein1024-944":46038,"skein1024-952":46039,"skein1024-960":46040,"skein1024-968":46041,"skein1024-976":46042,"skein1024-984":46043,"skein1024-992":46044,"skein1024-1000":46045,"skein1024-1008":46046,"skein1024-1016":46047,"skein1024-1024":46048,"poseidon-bls12_381-a2-fc1":46081,"poseidon-bls12_381-a2-fc1-sc":46082});e.exports={names:t}},9886:function(e,t,r){"use strict";const n=r(26869),i=r(94676),{names:s}=r(22465),{toString:o}=r(26467),{fromString:a}=r(81848),{concat:c}=r(47),u={};for(const e in s){const t=e;u[s[t]]=t}function l(e){if(!(e instanceof Uint8Array))throw new Error("multihash must be a Uint8Array");if(e.length<2)throw new Error("multihash too short. must be > 2 bytes.");const t=i.decode(e);if(!f(t))throw new Error(`multihash unknown function code: 0x${t.toString(16)}`);e=e.slice(i.decode.bytes);const r=i.decode(e);if(r<0)throw new Error(`multihash invalid length: ${r}`);if((e=e.slice(i.decode.bytes)).length!==r)throw new Error(`multihash length inconsistent: 0x${o(e,"base16")}`);return{code:t,name:u[t],length:r,digest:e}}function h(e){let t=e;if("string"==typeof e){if(void 0===s[e])throw new Error(`Unrecognized hash function named: ${e}`);t=s[e]}if("number"!=typeof t)throw new Error(`Hash function code should be a number. Got: ${t}`);if(void 0===u[t]&&!d(t))throw new Error(`Unrecognized function code: ${t}`);return t}function d(e){return e>0&&e<16}function f(e){return!!d(e)||!!u[e]}function p(e){l(e)}Object.freeze(u),e.exports={names:s,codes:u,toHexString:function(e){if(!(e instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return o(e,"base16")},fromHexString:function(e){return a(e,"base16")},toB58String:function(e){if(!(e instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return o(n.encode("base58btc",e)).slice(1)},fromB58String:function(e){const t=e instanceof Uint8Array?o(e):e;return n.decode("z"+t)},decode:l,encode:function(e,t,r){if(!e||void 0===t)throw new Error("multihash encode requires at least two args: digest, code");const n=h(t);if(!(e instanceof Uint8Array))throw new Error("digest should be a Uint8Array");if(null==r&&(r=e.length),r&&e.length!==r)throw new Error("digest length should be equal to specified length.");const s=i.encode(n),o=i.encode(r);return c([s,o,e],s.length+o.length+e.length)},coerceCode:h,isAppCode:d,validate:p,prefix:function(e){return p(e),e.subarray(0,2)},isValidCode:f}},99507:function(e,t,r){"use strict";const n=r(61798),{EventEmitter:i}=r(17187);function s(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function o(e,t){if(!(t instanceof Uint8Array))throw new TypeError(e+" is not a Uint8Array")}class a extends i{constructor(e={}){super(),this.localNodeId=e.localNodeId||n(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||a.distance,this.arbiter=e.arbiter||a.arbiter,this.metadata=Object.assign({},e.metadata),o("option.localNodeId as parameter 1",this.localNodeId),this.root={contacts:[],dontSplit:!1,left:null,right:null}}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let r=0,n=0;const i=Math.min(e.length,t.length),s=Math.max(e.length,t.length);for(;n<i;++n)r=256*r+(e[n]^t[n]);for(;n<s;++n)r=256*r+255;return r}add(e){o("contact.id",(e||{}).id);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e.id,t++);const n=this._indexOf(r,e.id);return n>=0?(this._update(r,n,e),this):r.contacts.length<this.numberOfNodesPerKBucket?(r.contacts.push(e),this.emit("added",e),this):r.dontSplit?(this.emit("ping",r.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(r,t),this.add(e))}closest(e,t=1/0){if(o("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let r=[];for(let n=[this.root],i=0;n.length>0&&r.length<t;){const t=n.pop();if(null===t.contacts){const r=this._determineNode(t,e,i++);n.push(t.left===r?t.right:t.left),n.push(r)}else r=r.concat(t.contacts)}return r.map((t=>[this.distance(t.id,e),t])).sort(((e,t)=>e[0]-t[0])).slice(0,t).map((e=>e[1]))}count(){let e=0;for(const t=[this.root];t.length>0;){const r=t.pop();null===r.contacts?t.push(r.right,r.left):e+=r.contacts.length}return e}_determineNode(e,t,r){const n=r>>3,i=r%8;if(t.length<=n&&0!==i)return e.left;return t[n]&1<<7-i?e.right:e.left}get(e){o("id",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);return n>=0?r.contacts[n]:null}_indexOf(e,t){for(let r=0;r<e.contacts.length;++r)if(s(e.contacts[r].id,t))return r;return-1}remove(e){o("the id as parameter 1",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);if(n>=0){const e=r.contacts.splice(n,1)[0];this.emit("removed",e)}return this}_split(e,t){e.left={contacts:[],dontSplit:!1,left:null,right:null},e.right={contacts:[],dontSplit:!1,left:null,right:null};for(const r of e.contacts)this._determineNode(e,r.id,t).contacts.push(r);e.contacts=null;const r=this._determineNode(e,this.localNodeId,t);(e.left===r?e.right:e.left).dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const r=t.pop();null===r.contacts?t.push(r.right,r.left):e=e.concat(r.contacts)}return e}*toIterable(){for(const e=[this.root];e.length>0;){const t=e.pop();null===t.contacts?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,r){if(!s(e.contacts[t].id,r.id))throw new Error("wrong index for _update");const n=e.contacts[t],i=this.arbiter(n,r);i===n&&n!==r||(e.contacts.splice(t,1),e.contacts.push(i),this.emit("updated",n,i))}}e.exports=a},80724:function(e,t){"use strict";t.supports=function(...e){const t=e.reduce(((e,t)=>Object.assign(e,t)),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}},58499:function(e,t,r){"use strict";const n=r(31648),i=r(8002),{Encoding:s}=r(8266),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=r(89754),u=Symbol("formats"),l=Symbol("encodings"),h=new Set(["buffer","view","utf8"]);t.Transcoder=class{constructor(e){if(!Array.isArray(e))throw new TypeError("The first argument 'formats' must be an array");if(!e.every((e=>h.has(e))))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'");this[l]=new Map,this[u]=new Set(e);for(const e in i)try{this.encoding(e)}catch(e){if("LEVEL_ENCODING_NOT_SUPPORTED"!==e.code)throw e}}encodings(){return Array.from(new Set(this[l].values()))}encoding(e){let t=this[l].get(e);if(void 0===t){if("string"==typeof e&&""!==e){if(t=f[e],!t)throw new n(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if("object"!=typeof e||null===e)throw new TypeError("First argument 'encoding' must be a string or object");t=function(e){if(e instanceof s)return e;const t="type"in e&&"string"==typeof e.type?e.type:void 0,r=e.name||t||"anonymous-"+p++;switch(function(e){return"format"in e&&void 0!==e.format?e.format:"buffer"in e&&"boolean"==typeof e.buffer?e.buffer?"buffer":"utf8":"code"in e&&Number.isInteger(e.code)?"view":"buffer"}(e)){case"view":return new a({...e,name:r});case"utf8":return new c({...e,name:r});case"buffer":return new o({...e,name:r});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}(e)}const{name:r,format:i}=t;if(!this[u].has(i))if(this[u].has("view"))t=t.createViewTranscoder();else if(this[u].has("buffer"))t=t.createBufferTranscoder();else{if(!this[u].has("utf8"))throw new n(`Encoding '${r}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});t=t.createUTF8Transcoder()}for(const n of[e,r,t.name,t.commonName])this[l].set(n,t)}return t}};const d={binary:i.buffer,"utf-8":i.utf8},f={...i,...d};let p=0},8266:function(e,t,r){"use strict";const n=r(31648),i=new Set(["buffer","view","utf8"]);t.Encoding=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,"function"!=typeof this.encode)throw new TypeError("The 'encode' property must be a function");if("function"!=typeof this.decode)throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!=typeof this.name||""===this.name)throw new TypeError("The 'name' property must be a string");if("string"!=typeof this.format||!i.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new n(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}},8002:function(e,t,r){"use strict";const{Buffer:n}=r(35275)||{Buffer:{isBuffer:()=>!1}},{textEncoder:i,textDecoder:s}=r(85850)(),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=r(89754),u=e=>e;t.utf8=new c({encode:function(e){return n.isBuffer(e)?e.toString("utf8"):ArrayBuffer.isView(e)?s.decode(e):String(e)},decode:u,name:"utf8",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:function(e){return s.decode(e)},name:`${this.name}+view`})},createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:function(e){return e.toString("utf8")},name:`${this.name}+buffer`})}}),t.json=new c({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:u,name:"buffer",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:n.from(String(e),"utf8")},decode:function(e){return n.from(e.buffer,e.byteOffset,e.byteLength)},name:`${this.name}+view`})}}),t.view=new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:u,name:"view",createBufferTranscoder(){return new o({encode:function(e){return n.isBuffer(e)?e:ArrayBuffer.isView(e)?n.from(e.buffer,e.byteOffset,e.byteLength):n.from(String(e),"utf8")},decode:u,name:`${this.name}+buffer`})}}),t.hex=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"hex")},decode:function(e){return e.toString("hex")},name:"hex"}),t.base64=new o({encode:function(e){return n.isBuffer(e)?e:n.from(String(e),"base64")},decode:function(e){return e.toString("base64")},name:"base64"})},89754:function(e,t,r){"use strict";const{Buffer:n}=r(35275)||{},{Encoding:i}=r(8266),s=r(85850);class o extends i{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:e=>this.decode(n.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}}class a extends i{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new o({encode:e=>{const t=this.encode(e);return n.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}}t.BufferFormat=o,t.ViewFormat=a,t.UTF8Format=class extends i{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new o({encode:e=>n.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=s();return new a({encode:t=>e.encode(this.encode(t)),decode:e=>this.decode(t.decode(e)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}}},85850:function(e){"use strict";let t=null;e.exports=function(){return null===t&&(t={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),t}},35275:function(e,t,r){"use strict";var n=r(25108);const i=r(79742),s=r(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50;const a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|g(e,t);let n=c(r);const i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Q(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Q(e,ArrayBuffer)||e&&Q(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(Q(e,SharedArrayBuffer)||e&&Q(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,r);const i=function(e){if(u.isBuffer(e)){const t=0|y(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||J(e.length)?c(0):f(e);if("Buffer"===e.type&&Array.isArray(e.data))return f(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return h(e),c(e<0?0:0|y(e))}function f(e){const t=e.length<0?0:0|y(e.length),r=c(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,u.prototype),n}function y(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function g(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Q(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(e).length;default:if(i)return n?-1:H(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return I(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),J(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){let s,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(u(e,s)===u(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===c)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){let r=!0;for(let n=0;n<c;n++)if(u(e,s+n)!==u(t,n)){r=!1;break}if(r)return s}return-1}function E(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(J(n))return o;e[r+o]=n}return o}function _(e,t,r,n){return Y(H(t,e.length-r),e,r,n)}function A(e,t,r,n){return Y(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return Y(W(t),e,r,n)}function R(e,t,r,n){return Y(function(e,t){let r,n,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function I(e,t,r){return 0===t&&r===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[i+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(s=c));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(e){const t=e.length;if(t<=P)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=P));return r}(n)}t.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,r){return function(e,t,r){return h(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},u.allocUnsafe=function(e){return d(e)},u.allocUnsafeSlow=function(e){return d(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(Q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),Q(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=u.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(Q(t,Uint8Array))i+t.length>n.length?(u.isBuffer(t)||(t=u.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!u.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},u.byteLength=g,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)b(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?x(this,0,e):m.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,r,n,i){if(Q(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(s,o),c=this.slice(n,i),l=e.slice(t,r);for(let e=0;e<a;++e)if(c[e]!==l[e]){s=c[e],o=l[e];break}return s<o?-1:o<s?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return w(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return w(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return A(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const P=4096;function C(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function k(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=Z[e[n]];return i}function D(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,r,n,i,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function L(e,t,r,n,i){z(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function U(e,t,r,n,i){z(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function M(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,n,i){return t=+t,r>>>=0,i||M(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function K(e,t,r,n,i){return t=+t,r>>>=0,i||M(e,0,r,8),s.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,u.prototype),n},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=X((function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),u.prototype.readBigUInt64BE=X((function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||O(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=X((function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),u.prototype.readBigInt64BE=X((function(e){q(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){N(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){N(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=X((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=X((function(e,t=0){return U(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);N(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);N(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=X((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=X((function(e,t=0){return U(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return K(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return K(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const s=u.isBuffer(e)?e:u.from(e,n),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%o]}return this};const $={};function V(e,t,r){$[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function j(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function z(e,t,r,n,i,s){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new $.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){q(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||F(t,e.length-(r+1))}(n,i,s)}function q(e,t){if("number"!=typeof e)throw new $.ERR_INVALID_ARG_TYPE(t,"number",e)}function F(e,t,r){if(Math.floor(e)!==e)throw q(e,r),new $.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new $.ERR_BUFFER_OUT_OF_BOUNDS;throw new $.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}V("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),V("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),V("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=j(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=j(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const G=/[^+/0-9A-Za-z-_]/g;function H(e,t){let r;t=t||1/0;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function W(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function Q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function J(e){return e!=e}const Z=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function X(e){return"undefined"==typeof BigInt?ee:e}function ee(){throw new Error("BigInt not supported")}},21301:function(e,t,r){t.Level=r(11708).BrowserLevel},72287:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,s),!0;case 6:return l.fn.call(l.context,t,n,i,s,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},60644:function(e,t,r){const n=r(91240),i=r(9400),s=r(44862),o=r(49489),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:u}=r(76190),l=r(86823),h=r(50653),d=r(39121),f=r(14574),p=r(90126),y=r(66354),g=r(19853);e.exports={RateLimiterRedis:n,RateLimiterMongo:i,RateLimiterMySQL:s,RateLimiterPostgres:o,RateLimiterMemory:l,RateLimiterMemcache:h,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:u,RLWrapperBlackAndWhite:d,RateLimiterUnion:f,RateLimiterQueue:p,BurstyRateLimiter:y,RateLimiterRes:g}},66354:function(e,t,r){const n=r(19853);e.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return e?new n(e.remainingPoints,Math.min(e.msBeforeNext,t?t.msBeforeNext:0),e.consumedPoints,e.isFirstInDuration):null}consume(e,t=1,r={}){return this._rateLimiter.consume(e,t,r).catch((i=>i instanceof n?this._burstLimiter.consume(e,t,r).then((e=>Promise.resolve(this._combineRes(i,e)))).catch((e=>e instanceof n?Promise.reject(this._combineRes(i,e)):Promise.reject(e))):Promise.reject(i)))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then((([e,t])=>this._combineRes(e,t)))}get points(){return this._rateLimiter.points}}},39121:function(e,t,r){const n=r(19853);e.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(void 0===e)throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=void 0!==e&&e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(void 0===e&&(e=()=>!1),"function"!=typeof e)throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new n(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new n(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.rejectBlack()),void 0===r?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch((()=>{})),r)}block(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch((()=>{})),r)}penalty(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch((()=>{})),r)}reward(e,t){let r;return this.isWhiteListedSomewhere(e)?r=this.resolveWhite():this.isBlackListedSomewhere(e)&&(r=this.resolveBlack()),void 0===r?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch((()=>{})),r)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),void 0===t||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}},97568:function(e){e.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=void 0===e?1:e}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=void 0===e?0:e}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=void 0!==e&&Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=void 0===e?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(void 0===e&&(e="rlflx"),"string"!=typeof e)throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}},76190:function(e,t,r){var n=r(34155),i=r(25108);const s=r(83886),o=r(52),a=r(97568),c=r(86823),u=r(19853),l="rate_limiter_flexible";let h=null;const d=function(e,t,r,n){let i;i=null===n||!0===n||!1===n?n:{remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},e.send({channel:l,keyPrefix:t.keyPrefix,promiseId:t.promiseId,type:r,data:i})},f=function(e){setTimeout((()=>{this._initiated?n.send(e):void 0!==this._promises[e.promiseId]&&f.call(this,e)}),30)},p=function(e,t,r,i,s){const o={channel:l,keyPrefix:this.keyPrefix,func:e,promiseId:t,data:{key:r,arg:i,opts:s}};this._initiated?n.send(o):f.call(this,o)},y=function(e,t){if(!t||t.channel!==l||void 0===this._rateLimiters[t.keyPrefix])return!1;let r;switch(t.func){case"consume":r=this._rateLimiters[t.keyPrefix].consume(t.data.key,t.data.arg,t.data.opts);break;case"penalty":r=this._rateLimiters[t.keyPrefix].penalty(t.data.key,t.data.arg,t.data.opts);break;case"reward":r=this._rateLimiters[t.keyPrefix].reward(t.data.key,t.data.arg,t.data.opts);break;case"block":r=this._rateLimiters[t.keyPrefix].block(t.data.key,t.data.arg,t.data.opts);break;case"get":r=this._rateLimiters[t.keyPrefix].get(t.data.key,t.data.opts);break;case"delete":r=this._rateLimiters[t.keyPrefix].delete(t.data.key,t.data.opts);break;default:return!1}r&&r.then((r=>{d(e,t,"resolve",r)})).catch((r=>{d(e,t,"reject",r)}))},g=function(e){if(!e||e.channel!==l||e.keyPrefix!==this.keyPrefix)return!1;if(this._promises[e.promiseId]){let t;switch(clearTimeout(this._promises[e.promiseId].timeoutId),t=null===e.data||!0===e.data||!1===e.data?e.data:new u(e.data.remainingPoints,e.data.msBeforeNext,e.data.consumedPoints,e.data.isFirstInDuration),e.type){case"resolve":this._promises[e.promiseId].resolve(t);break;case"reject":this._promises[e.promiseId].reject(t);break;default:throw new Error(`RateLimiterCluster: no such message type '${e.type}'`)}delete this._promises[e.promiseId]}},m=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},b=function(e,t){const r=n.hrtime();let i=r[0].toString()+r[1].toString();return void 0!==this._promises[i]&&(i+=o.randomBytes(12).toString("base64")),this._promises[i]={resolve:e,reject:t,timeoutId:setTimeout((()=>{delete this._promises[i],t(new Error("RateLimiterCluster timeout: no answer from master in time"))}),this.timeoutMs)},i};e.exports={RateLimiterClusterMaster:class{constructor(){if(h)return h;this._rateLimiters={},s.setMaxListeners(0),s.on("message",((e,t)=>{t&&t.channel===l&&"init"===t.type?(void 0===this._rateLimiters[t.opts.keyPrefix]&&(this._rateLimiters[t.opts.keyPrefix]=new c(t.opts)),e.send({channel:l,type:"init",keyPrefix:t.opts.keyPrefix})):y.call(this,e,t)})),h=this}},RateLimiterClusterMasterPM2:class{constructor(e){if(h)return h;this._rateLimiters={},e.launchBus(((t,r)=>{r.on("process:msg",(t=>{const r=t.raw;if(r&&r.channel===l&&"init"===r.type)void 0===this._rateLimiters[r.opts.keyPrefix]&&(this._rateLimiters[r.opts.keyPrefix]=new c(r.opts)),e.sendDataToProcessId(t.process.pm_id,{data:{},topic:l,channel:l,type:"init",keyPrefix:r.opts.keyPrefix},((e,t)=>{e&&i.log(e,t)}));else{y.call(this,{send:r=>{const n=r;n.topic=l,void 0===n.data&&(n.data={}),e.sendDataToProcessId(t.process.pm_id,n,((e,t)=>{e&&i.log(e,t)}))}},r)}}))})),h=this}},RateLimiterCluster:class extends a{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=void 0===e?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),n.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,n.on("message",(e=>{e&&e.channel===l&&"init"===e.type&&e.keyPrefix===this.keyPrefix?this._initiated=!0:g.call(this,e)})),n.send({channel:l,type:"init",opts:m.call(this)}),this._promises={}}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"consume",s,e,t,r)}))}penalty(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"penalty",s,e,t,r)}))}reward(e,t=1,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"reward",s,e,t,r)}))}block(e,t,r={}){return new Promise(((n,i)=>{const s=b.call(this,n,i);p.call(this,"block",s,e,t,r)}))}get(e,t={}){return new Promise(((r,n)=>{const i=b.call(this,r,n);p.call(this,"get",i,e,t)}))}delete(e,t={}){return new Promise(((r,n)=>{const i=b.call(this,r,n);p.call(this,"delete",i,e,t)}))}}}},50653:function(e,t,r){const n=r(9524),i=r(19853);e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,r){const n=new i;return n.consumedPoints=parseInt(r.consumedPoints),n.isFirstInDuration=r.consumedPoints===t,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=r.msBeforeNext,n}_upsert(e,t,r,n=!1,i={}){return new Promise(((s,o)=>{const a=Date.now(),c=Math.floor(r/1e3);n?this.client.set(e,t,c,(r=>{r?o(r):this.client.set(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.incr(e,t,((u,l)=>{u||!1===l?this.client.add(e,t,c,((u,l)=>{if(u||!l)if(void 0===i.attemptNumber||i.attemptNumber<3){const a=Object.assign({},i);a.attemptNumber=a.attemptNumber?a.attemptNumber+1:1,this._upsert(e,t,r,n,a).then((e=>s(e))).catch((e=>o(e)))}else o(new Error("Can not add key"));else this.client.add(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{s({consumedPoints:t,msBeforeNext:c>0?1e3*c:-1})}))})):this.client.get(`${e}_expire`,((e,t)=>{if(e)o(e);else{const e=!1===t?0:t,r={consumedPoints:l,msBeforeNext:e>=0?Math.max(e-a,0):-1};s(r)}}))}))}))}_get(e){return new Promise(((t,r)=>{const n=Date.now();this.client.get(e,((i,s)=>{s?this.client.get(`${e}_expire`,((e,i)=>{if(e)r(e);else{const e=!1===i?0:i,r={consumedPoints:s,msBeforeNext:e>=0?Math.max(e-n,0):-1};t(r)}})):t(null)}))}))}_delete(e){return new Promise(((t,r)=>{this.client.del(e,((n,i)=>{n?r(n):!1===i?t(i):this.client.del(`${e}_expire`,(e=>{e?r(e):t(i)}))}))}))}}},86823:function(e,t,r){const n=r(97568),i=r(70226),s=r(19853);e.exports=class extends n{constructor(e={}){super(e),this._memoryStorage=new i}consume(e,t=1,r={}){return new Promise(((n,i)=>{const s=this.getKey(e),o=this._getKeySecDuration(r);let a=this._memoryStorage.incrby(s,t,o);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this._memoryStorage.set(s,a.consumedPoints,this.blockDuration)),i(a);else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let e=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(n,e,a)}else n(a)}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise((e=>{const i=this._getKeySecDuration(r),s=this._memoryStorage.incrby(n,-t,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),e(s)}))}block(e,t){const r=1e3*t,n=this.points+1;return this._memoryStorage.set(this.getKey(e),n,t),Promise.resolve(new s(0,0===r?-1:r,n))}set(e,t,r){const n=1e3*(r>=0?r:this.duration);return this._memoryStorage.set(this.getKey(e),t,r),Promise.resolve(new s(0,0===n?-1:n,t))}get(e){const t=this._memoryStorage.get(this.getKey(e));return null!==t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}}},9400:function(e,t,r){const n=r(9524),i=r(19853);function s(e){try{const t=e.client?e.client:e,{version:r}=t.topology.s.options.metadata.driver,n=r.split(".").map((e=>parseInt(e)));return{major:n[0],feature:n[1],patch:n[2]}}catch(e){return{major:0,feature:0,patch:0}}}class o extends n{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,"function"==typeof this.client.then?this.client.then((e=>{this.client=e,this._initCollection(),this._driverVersion=s(this.client)})):(this._initCollection(),this._driverVersion=s(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?o.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get client(){return this._client}set client(e){if(void 0===e)throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const e=("function"==typeof this.client.db?this.client.db(this.dbName):this.client).collection(this.tableName);e.createIndex({expire:-1},{expireAfterSeconds:0}),e.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=e}_getRateLimiterRes(e,t,r){const n=new i;let s;return s=void 0===r.value?r:r.value,n.isFirstInDuration=s.points===t,n.consumedPoints=s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=null!==s.expire?Math.max(new Date(s.expire).getTime()-Date.now(),0):-1,n}_upsert(e,t,r,n=!1,i={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const s=i.attrs||{};let o,a;n?(o={key:e},o=Object.assign(o,s),a={$set:{key:e,points:t,expire:r>0?new Date(Date.now()+r):null}},a.$set=Object.assign(a.$set,s)):(o={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},o=Object.assign(o,s),a={$setOnInsert:{key:e,expire:r>0?new Date(Date.now()+r):null},$inc:{points:t}},a.$setOnInsert=Object.assign(a.$setOnInsert,s));const c={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?c.returnDocument="after":c.returnOriginal=!1,new Promise(((i,u)=>{this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((o=>{if(o&&11e3===o.code){const o=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},s),a={$set:Object.assign({key:e,points:t,expire:r>0?new Date(Date.now()+r):null},s)};this._collection.findOneAndUpdate(o,a,c).then((e=>{i(e)})).catch((s=>{s&&11e3===s.code?this._upsert(e,t,r,n).then((e=>i(e))).catch((e=>u(e))):u(s)}))}else u(o)}))}))}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},r);return this._collection.findOne(n)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const r=t.attrs||{},n=Object.assign({key:e},r);return this._collection.deleteOne(n).then((e=>e.deletedCount>0))}}e.exports=o},44862:function(e,t,r){const n=r(9524),i=r(19853);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()):this._createDbAndTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{this._getConnection().then((r=>{r.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],(()=>{this._releaseConnection(r),t()}))})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise(((e,t)=>{this.client.getConnection(((r,n)=>{if(r)return t(r);e(n)}))}));case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise(((e,t)=>{this._getConnection().then((r=>{r.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,(n=>{if(n)return this._releaseConnection(r),t(n);r.query(this._getCreateTableStmt(),(n=>{if(n)return this._releaseConnection(r),t(n);this._releaseConnection(r),e()}))}))})).catch((e=>{t(e)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(void 0===e)if("Connection"===this.client.constructor.name)e="connection";else if("Pool"===this.client.constructor.name)e="pool";else{if("Sequelize"!==this.client.constructor.name)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=void 0===e?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,[s]=r;return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_upsertTransaction(e,t,r,n,i){return new Promise(((s,o)=>{e.query("BEGIN",(a=>{if(a)return e.rollback(),o(a);const c=Date.now(),u=n>0?c+n:null;let l,h;i?(l="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = ?, \n            expire = ?;",h=[this.dbName,this.tableName,t,r,u,r,u]):(l="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = IF(expire <= ?, ?, points + (?)), \n            expire = IF(expire <= ?, ?, expire);",h=[this.dbName,this.tableName,t,r,u,c,r,r,c,u]),e.query(l,h,(r=>{if(r)return e.rollback(),o(r);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],((t,r)=>{if(t)return e.rollback(),o(t);e.query("COMMIT",(t=>{if(t)return e.rollback(),o(t);s(r)}))}))}))}))}))}_upsert(e,t,r,n=!1){return this.tableCreated?new Promise(((i,s)=>{this._getConnection().then((o=>{this._upsertTransaction(o,e,t,r,n).then((e=>{i(e),this._releaseConnection(o)})).catch((e=>{s(e),this._releaseConnection(o)}))})).catch((e=>{s(e)}))})):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],((e,i)=>{e?r(e):0===i.length?t(null):t(i),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise(((t,r)=>{this._getConnection().then((n=>{n.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],((e,i)=>{e?r(e):t(i.affectedRows>0),this._releaseConnection(n)}))})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}}},49489:function(e,t,r){const n=r(9524),i=r(19853);e.exports=class extends n{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?"function"==typeof t&&t():this._createTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof t&&t()})).catch((e=>{if("function"!=typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{const r={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(r).then((()=>{t()})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":default:return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master)}}_releaseConnection(e){switch(this.clientType){case"pool":case"typeorm":default:return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e)}}_createTable(){return new Promise(((e,t)=>{this._query({text:this._getCreateTableStmt()}).then((()=>{e()})).catch((r=>{"23505"===r.code?e():t(r)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( \n      key varchar(255) PRIMARY KEY,\n      points integer NOT NULL DEFAULT 0,\n      expire bigint\n    );`}get clientType(){return this._clientType}set clientType(e){const t=this.client.constructor.name;if(void 0===e)if("Client"===t)e="client";else if("Pool"===t||"BoundPool"===t)e="pool";else{if("Sequelize"!==t)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=void 0===e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=void 0!==e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=void 0===e||Boolean(e)}_getRateLimiterRes(e,t,r){const n=new i,s=r.rows[0];return n.isFirstInDuration=t===s.points,n.consumedPoints=n.isFirstInDuration?t:s.points,n.remainingPoints=Math.max(this.points-n.consumedPoints,0),n.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,n}_query(e){const t={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise(((e,r)=>{this._getConnection().then((n=>{n.query(t).then((t=>{e(t),this._releaseConnection(n)})).catch((e=>{r(e),this._releaseConnection(n)}))})).catch((e=>{r(e)}))}))}_upsert(e,t,r,n=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const i=r>0?Date.now()+r:null,s=n?" $3 ":` CASE\n             WHEN ${this.tableName}.expire <= $4 THEN $3\n             ELSE ${this.tableName}.expire\n            END `;return this._query({name:n?"rlflx-upsert-force":"rlflx-upsert",text:`\n            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)\n              ON CONFLICT(key) DO UPDATE SET\n                points = CASE\n                          WHEN (${this.tableName}.expire <= $4 OR 1=${n?1:0}) THEN $2\n                          ELSE ${this.tableName}.points + ($2)\n                         END,\n                expire = ${s}\n            RETURNING points, expire;`,values:[e,t,i,Date.now()]})}_get(e){return this.tableCreated?new Promise(((t,r)=>{this._query({name:"rlflx-get",text:`\n            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then((e=>{0===e.rowCount&&(e=null),t(e)})).catch((e=>{r(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then((e=>e.rowCount>0)):Promise.reject(Error("Table is not created yet"))}}},90126:function(e,t,r){const n=r(15602),i=4294967295,s="limiter";e.exports=class{constructor(e,t={maxQueueSize:i}){this._queueLimiters={KEY_DEFAULT:new o(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=s){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=s){return this._queueLimiters[t]||(this._queueLimiters[t]=new o(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};class o{constructor(e,t={maxQueueSize:i,key:s}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then((e=>null!==e?e.remainingPoints:this._limiterFlexible.points))}removeTokens(e){const t=this;return new Promise(((r,i)=>{e>t._limiterFlexible.points?i(new n(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`)):t._queue.length>0?t._queueRequest.call(t,r,i,e):t._limiterFlexible.consume(t._key,e).then((e=>{r(e.remainingPoints)})).catch((n=>{n instanceof Error?i(n):(t._queueRequest.call(t,r,i,e),null===t._waitTimeout&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),n.msBeforeNext)))}))}))}_queueRequest(e,t,r){const i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:e,reject:t,tokens:r}):t(new n(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){const e=this;if(null!==e._waitTimeout&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),0===e._queue.length)return;const t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then((r=>{t.resolve(r.remainingPoints),e._processFIFO.call(e)})).catch((r=>{r instanceof Error?(t.reject(r),e._processFIFO.call(e)):(e._queue.unshift(t),null===e._waitTimeout&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),r.msBeforeNext)))}))}}},91240:function(e,t,r){const n=r(9524),i=r(19853),s="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";e.exports=class extends n{constructor(e){super(e),this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,this.useRedisPackage=e.useRedisPackage,this.useRedis3AndLowerPackage=e.useRedis3AndLowerPackage,"function"==typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:s})}_isRedisReady(){return!this._rejectIfRedisNotReady||(!this.client.status||"ready"===this.client.status)&&!("function"==typeof this.client.isReady&&!this.client.isReady())}_getRateLimiterRes(e,t,r){let[n,s]=r;Array.isArray(n)&&([,n]=n,[,s]=s);const o=new i;return o.consumedPoints=parseInt(n),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=s,o}async _upsert(e,t,r,n=!1){if(!this._isRedisReady())throw new Error("Redis connection is not ready");const i=Math.floor(r/1e3),o=this.client.multi();return n?(i>0?this.useRedisPackage||this.useRedis3AndLowerPackage?o.set(e,t,{EX:i}):o.set(e,t,"EX",i):o.set(e,t),this.useRedisPackage||this.useRedis3AndLowerPackage?o.pTTL(e).exec(!0):o.pttl(e).exec(!0)):i>0?this.useRedisPackage||this.useRedis3AndLowerPackage?this.useRedis3AndLowerPackage?new Promise(((r,n)=>{const o=function(e,t){return e?n(e):r(t)};"function"==typeof this.client.rlflxIncr?this.client.rlflxIncr(e,t,i,o):this.client.eval(s,1,e,t,i,o)})):this.client.eval(s,{keys:[e],arguments:[String(t),String(i)]}):this.client.rlflxIncr([e].concat([String(t),String(i)])):this.useRedisPackage||this.useRedis3AndLowerPackage?o.incrBy(e,t).pTTL(e).exec(!0):o.incrby(e,t).pttl(e).exec(!0)}async _get(e){if(!this._isRedisReady())throw new Error("Redis connection is not ready");return this.useRedisPackage||this.useRedis3AndLowerPackage?this.client.multi().get(e).pTTL(e).exec(!0).then((e=>{const[t]=e;return null===t?null:e})):this.client.multi().get(e).pttl(e).exec().then((e=>{const[[,t]]=e;return null===t?null:e}))}_delete(e){return this.client.del(e).then((e=>e>0))}}},19853:function(e){e.exports=class{constructor(e,t,r,n){this.remainingPoints=void 0===e?0:e,this.msBeforeNext=void 0===t?0:t,this.consumedPoints=void 0===r?0:r,this.isFirstInDuration=void 0!==n&&n}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},9524:function(e,t,r){const n=r(97568),i=r(88438),s=r(19853);e.exports=class extends n{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new i}get client(){return this._client}set client(e){if(void 0===e)throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,r,n,i,s={}){const o=this._getRateLimiterRes(r,n,i);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&o.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(r,o.msBeforeNext),o.consumedPoints>this.points?t(o):e(o);if(o.consumedPoints>this.points){let e=Promise.resolve();this.blockDuration>0&&o.consumedPoints<=this.points+n&&(o.msBeforeNext=this.msBlockDuration,e=this._block(r,o.consumedPoints,this.msBlockDuration,s)),this.inMemoryBlockOnConsumed>0&&o.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(r,this.inMemoryBlockDuration),o.msBeforeNext=this.msInMemoryBlockDuration),e.then((()=>{t(o)})).catch((e=>{t(e)}))}else if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let t=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=o.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,t,o)}else e(o)}_handleError(e,t,r,i,s,o=!1,a={}){this.insuranceLimiter instanceof n?this.insuranceLimiter[t](s,o,a).then((e=>{r(e)})).catch((e=>{i(e)})):i(e)}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(void 0!==e&&!(e instanceof n))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,r={}){const n=1e3*t;return this._block(this.getKey(e),this.points+1,n,r)}set(e,t,r,n={}){const i=1e3*(r>=0?r:this.duration);return this._block(this.getKey(e),t,i,n)}consume(e,t=1,r={}){return new Promise(((n,i)=>{const o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return i(new s(0,a));this._upsert(o,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{this._afterConsume(n,i,o,t,e)})).catch((s=>{this._handleError(s,"consume",n,i,e,t,r)}))}))}penalty(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,t,e))})).catch((n=>{this._handleError(n,"penalty",i,s,e,t,r)}))}))}reward(e,t=1,r={}){const n=this.getKey(e);return new Promise(((i,s)=>{this._upsert(n,-t,1e3*this._getKeySecDuration(r),!1,r).then((e=>{i(this._getRateLimiterRes(n,-t,e))})).catch((n=>{this._handleError(n,"reward",i,s,e,t,r)}))}))}get(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._get(r,t).then((e=>{n(null==e?null:this._getRateLimiterRes(r,0,e))})).catch((r=>{this._handleError(r,"get",n,i,e,t)}))}))}delete(e,t={}){const r=this.getKey(e);return new Promise(((n,i)=>{this._delete(r,t).then((e=>{this._inMemoryBlockedKeys.delete(r),n(e)})).catch((r=>{this._handleError(r,"delete",n,i,e,t)}))}))}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,r){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,r,n={}){return new Promise(((i,o)=>{this._upsert(e,t,r,!0,n).then((()=>{i(new s(0,r>0?r:-1,t))})).catch((t=>{this._handleError(t,"block",i,o,this.parseKey(e),r/1e3,n)}))}))}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,r,n=!1,i={}){throw new Error("You have to implement the method '_upsert'!")}}},14574:function(e,t,r){const n=r(97568);e.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach((e=>{if(!(e instanceof n))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")})),this._limiters=e}consume(e,t=1){return new Promise(((r,n)=>{const i=[];this._limiters.forEach((r=>{i.push(r.consume(e,t).catch((e=>({rejected:!0,rej:e}))))})),Promise.all(i).then((e=>{const t={};let i=!1;e.forEach((e=>{!0===e.rejected&&(i=!0)}));for(let r=0;r<e.length;r++)i&&!0===e[r].rejected?t[this._limiters[r].keyPrefix]=e[r].rej:i||(t[this._limiters[r].keyPrefix]=e[r]);i?n(t):r(t)}))}))}}},61135:function(e){e.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach((t=>{this._keys[t]<=e&&delete this._keys[t]})),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,1e3*t)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();const e=Date.now();return t>=e?t-e:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach((e=>{delete this._keys[e]}))}}},88438:function(e,t,r){const n=r(61135);e.exports=n},70226:function(e,t,r){const n=r(4486),i=r(19853);e.exports=class{constructor(){this._storage={}}incrby(e,t,r){if(this._storage[e]){const n=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return 0!==n?(this._storage[e].value=this._storage[e].value+t,new i(0,n,this._storage[e].value,!1)):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const s=1e3*r;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new n(t,s>0?new Date(Date.now()+s):null),s>0&&(this._storage[e].timeoutId=setTimeout((()=>{delete this._storage[e]}),s),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new i(0,0===s?-1:s,this._storage[e].value,!0)}get(e){if(this._storage[e]){const t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return new i(0,t,this._storage[e].value,!1)}return null}delete(e){return!!this._storage[e]&&(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0)}}},4486:function(e){e.exports=class{constructor(e,t,r=null){this.value=e,this.expiresAt=t,this.timeoutId=r}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){e instanceof Date||!Number.isInteger(e)||(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}},15602:function(e){e.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}},1469:function(e){var t=Array.isArray;e.exports=t},13218:function(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},96486:function(e,t,r){var n;e=r.nmd(e),function(){var i,s="Expected a function",o="__lodash_hash_undefined__",a="__lodash_placeholder__",c=16,u=32,l=64,h=128,d=256,f=1/0,p=9007199254740991,y=NaN,g=4294967295,m=[["ary",h],["bind",1],["bindKey",2],["curry",8],["curryRight",c],["flip",512],["partial",u],["partialRight",l],["rearg",d]],b="[object Arguments]",w="[object Array]",v="[object Boolean]",E="[object Date]",_="[object Error]",A="[object Function]",S="[object GeneratorFunction]",R="[object Map]",I="[object Number]",x="[object Object]",P="[object Promise]",C="[object RegExp]",T="[object Set]",k="[object String]",D="[object Symbol]",O="[object WeakMap]",N="[object ArrayBuffer]",L="[object DataView]",U="[object Float32Array]",M="[object Float64Array]",B="[object Int8Array]",K="[object Int16Array]",$="[object Int32Array]",V="[object Uint8Array]",j="[object Uint8ClampedArray]",z="[object Uint16Array]",q="[object Uint32Array]",F=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,W=/&(?:amp|lt|gt|quot|#39);/g,Y=/[&<>"']/g,Q=RegExp(W.source),J=RegExp(Y.source),Z=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,ee=/<%=([\s\S]+?)%>/g,te=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,re=/^\w*$/,ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ie=/[\\^$.*+?()[\]{}|]/g,se=RegExp(ie.source),oe=/^\s+/,ae=/\s/,ce=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ue=/\{\n\/\* \[wrapped with (.+)\] \*/,le=/,? & /,he=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,de=/[()=,{}\[\]\/\s]/,fe=/\\(\\)?/g,pe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ye=/\w*$/,ge=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,be=/^\[object .+?Constructor\]$/,we=/^0o[0-7]+$/i,ve=/^(?:0|[1-9]\d*)$/,Ee=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_e=/($^)/,Ae=/['\n\r\u2028\u2029\\]/g,Se="\\ud800-\\udfff",Re="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ie="\\u2700-\\u27bf",xe="a-z\\xdf-\\xf6\\xf8-\\xff",Pe="A-Z\\xc0-\\xd6\\xd8-\\xde",Ce="\\ufe0e\\ufe0f",Te="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ke="[']",De="["+Se+"]",Oe="["+Te+"]",Ne="["+Re+"]",Le="\\d+",Ue="["+Ie+"]",Me="["+xe+"]",Be="[^"+Se+Te+Le+Ie+xe+Pe+"]",Ke="\\ud83c[\\udffb-\\udfff]",$e="[^"+Se+"]",Ve="(?:\\ud83c[\\udde6-\\uddff]){2}",je="[\\ud800-\\udbff][\\udc00-\\udfff]",ze="["+Pe+"]",qe="\\u200d",Fe="(?:"+Me+"|"+Be+")",Ge="(?:"+ze+"|"+Be+")",He="(?:['](?:d|ll|m|re|s|t|ve))?",We="(?:['](?:D|LL|M|RE|S|T|VE))?",Ye="(?:"+Ne+"|"+Ke+")"+"?",Qe="["+Ce+"]?",Je=Qe+Ye+("(?:"+qe+"(?:"+[$e,Ve,je].join("|")+")"+Qe+Ye+")*"),Ze="(?:"+[Ue,Ve,je].join("|")+")"+Je,Xe="(?:"+[$e+Ne+"?",Ne,Ve,je,De].join("|")+")",et=RegExp(ke,"g"),tt=RegExp(Ne,"g"),rt=RegExp(Ke+"(?="+Ke+")|"+Xe+Je,"g"),nt=RegExp([ze+"?"+Me+"+"+He+"(?="+[Oe,ze,"$"].join("|")+")",Ge+"+"+We+"(?="+[Oe,ze+Fe,"$"].join("|")+")",ze+"?"+Fe+"+"+He,ze+"+"+We,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Le,Ze].join("|"),"g"),it=RegExp("["+qe+Se+Re+Ce+"]"),st=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ot=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],at=-1,ct={};ct[U]=ct[M]=ct[B]=ct[K]=ct[$]=ct[V]=ct[j]=ct[z]=ct[q]=!0,ct[b]=ct[w]=ct[N]=ct[v]=ct[L]=ct[E]=ct[_]=ct[A]=ct[R]=ct[I]=ct[x]=ct[C]=ct[T]=ct[k]=ct[O]=!1;var ut={};ut[b]=ut[w]=ut[N]=ut[L]=ut[v]=ut[E]=ut[U]=ut[M]=ut[B]=ut[K]=ut[$]=ut[R]=ut[I]=ut[x]=ut[C]=ut[T]=ut[k]=ut[D]=ut[V]=ut[j]=ut[z]=ut[q]=!0,ut[_]=ut[A]=ut[O]=!1;var lt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ht=parseFloat,dt=parseInt,ft="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,pt="object"==typeof self&&self&&self.Object===Object&&self,yt=ft||pt||Function("return this")(),gt=t&&!t.nodeType&&t,mt=gt&&e&&!e.nodeType&&e,bt=mt&&mt.exports===gt,wt=bt&&ft.process,vt=function(){try{var e=mt&&mt.require&&mt.require("util").types;return e||wt&&wt.binding&&wt.binding("util")}catch(e){}}(),Et=vt&&vt.isArrayBuffer,_t=vt&&vt.isDate,At=vt&&vt.isMap,St=vt&&vt.isRegExp,Rt=vt&&vt.isSet,It=vt&&vt.isTypedArray;function xt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Pt(e,t,r,n){for(var i=-1,s=null==e?0:e.length;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function Ct(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function Tt(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function kt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function Dt(e,t){for(var r=-1,n=null==e?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}function Ot(e,t){return!!(null==e?0:e.length)&&zt(e,t,0)>-1}function Nt(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function Lt(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function Ut(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function Mt(e,t,r,n){var i=-1,s=null==e?0:e.length;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function Bt(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function Kt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var $t=Ht("length");function Vt(e,t,r){var n;return r(e,(function(e,r,i){if(t(e,r,i))return n=r,!1})),n}function jt(e,t,r,n){for(var i=e.length,s=r+(n?1:-1);n?s--:++s<i;)if(t(e[s],s,e))return s;return-1}function zt(e,t,r){return t==t?function(e,t,r){var n=r-1,i=e.length;for(;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):jt(e,Ft,r)}function qt(e,t,r,n){for(var i=r-1,s=e.length;++i<s;)if(n(e[i],t))return i;return-1}function Ft(e){return e!=e}function Gt(e,t){var r=null==e?0:e.length;return r?Qt(e,t)/r:y}function Ht(e){return function(t){return null==t?i:t[e]}}function Wt(e){return function(t){return null==e?i:e[t]}}function Yt(e,t,r,n,i){return i(e,(function(e,i,s){r=n?(n=!1,e):t(r,e,i,s)})),r}function Qt(e,t){for(var r,n=-1,s=e.length;++n<s;){var o=t(e[n]);o!==i&&(r=r===i?o:r+o)}return r}function Jt(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Zt(e){return e?e.slice(0,yr(e)+1).replace(oe,""):e}function Xt(e){return function(t){return e(t)}}function er(e,t){return Lt(t,(function(t){return e[t]}))}function tr(e,t){return e.has(t)}function rr(e,t){for(var r=-1,n=e.length;++r<n&&zt(t,e[r],0)>-1;);return r}function nr(e,t){for(var r=e.length;r--&&zt(t,e[r],0)>-1;);return r}var ir=Wt({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),sr=Wt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function or(e){return"\\"+lt[e]}function ar(e){return it.test(e)}function cr(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function ur(e,t){return function(r){return e(t(r))}}function lr(e,t){for(var r=-1,n=e.length,i=0,s=[];++r<n;){var o=e[r];o!==t&&o!==a||(e[r]=a,s[i++]=r)}return s}function hr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function dr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}function fr(e){return ar(e)?function(e){var t=rt.lastIndex=0;for(;rt.test(e);)++t;return t}(e):$t(e)}function pr(e){return ar(e)?function(e){return e.match(rt)||[]}(e):function(e){return e.split("")}(e)}function yr(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var gr=Wt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var mr=function e(t){var r,n=(t=null==t?yt:mr.defaults(yt.Object(),t,mr.pick(yt,ot))).Array,ae=t.Date,Se=t.Error,Re=t.Function,Ie=t.Math,xe=t.Object,Pe=t.RegExp,Ce=t.String,Te=t.TypeError,ke=n.prototype,De=Re.prototype,Oe=xe.prototype,Ne=t["__core-js_shared__"],Le=De.toString,Ue=Oe.hasOwnProperty,Me=0,Be=(r=/[^.]+$/.exec(Ne&&Ne.keys&&Ne.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",Ke=Oe.toString,$e=Le.call(xe),Ve=yt._,je=Pe("^"+Le.call(Ue).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ze=bt?t.Buffer:i,qe=t.Symbol,Fe=t.Uint8Array,Ge=ze?ze.allocUnsafe:i,He=ur(xe.getPrototypeOf,xe),We=xe.create,Ye=Oe.propertyIsEnumerable,Qe=ke.splice,Je=qe?qe.isConcatSpreadable:i,Ze=qe?qe.iterator:i,Xe=qe?qe.toStringTag:i,rt=function(){try{var e=ds(xe,"defineProperty");return e({},"",{}),e}catch(e){}}(),it=t.clearTimeout!==yt.clearTimeout&&t.clearTimeout,lt=ae&&ae.now!==yt.Date.now&&ae.now,ft=t.setTimeout!==yt.setTimeout&&t.setTimeout,pt=Ie.ceil,gt=Ie.floor,mt=xe.getOwnPropertySymbols,wt=ze?ze.isBuffer:i,vt=t.isFinite,$t=ke.join,Wt=ur(xe.keys,xe),br=Ie.max,wr=Ie.min,vr=ae.now,Er=t.parseInt,_r=Ie.random,Ar=ke.reverse,Sr=ds(t,"DataView"),Rr=ds(t,"Map"),Ir=ds(t,"Promise"),xr=ds(t,"Set"),Pr=ds(t,"WeakMap"),Cr=ds(xe,"create"),Tr=Pr&&new Pr,kr={},Dr=Bs(Sr),Or=Bs(Rr),Nr=Bs(Ir),Lr=Bs(xr),Ur=Bs(Pr),Mr=qe?qe.prototype:i,Br=Mr?Mr.valueOf:i,Kr=Mr?Mr.toString:i;function $r(e){if(ra(e)&&!Fo(e)&&!(e instanceof qr)){if(e instanceof zr)return e;if(Ue.call(e,"__wrapped__"))return Ks(e)}return new zr(e)}var Vr=function(){function e(){}return function(t){if(!ta(t))return{};if(We)return We(t);e.prototype=t;var r=new e;return e.prototype=i,r}}();function jr(){}function zr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function qr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=g,this.__views__=[]}function Fr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Gr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Hr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Wr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Hr;++t<r;)this.add(e[t])}function Yr(e){var t=this.__data__=new Gr(e);this.size=t.size}function Qr(e,t){var r=Fo(e),n=!r&&qo(e),i=!r&&!n&&Yo(e),s=!r&&!n&&!i&&la(e),o=r||n||i||s,a=o?Jt(e.length,Ce):[],c=a.length;for(var u in e)!t&&!Ue.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ws(u,c))||a.push(u);return a}function Jr(e){var t=e.length;return t?e[Yn(0,t-1)]:i}function Zr(e,t){return Ls(Ti(e),cn(t,0,e.length))}function Xr(e){return Ls(Ti(e))}function en(e,t,r){(r!==i&&!Vo(e[t],r)||r===i&&!(t in e))&&on(e,t,r)}function tn(e,t,r){var n=e[t];Ue.call(e,t)&&Vo(n,r)&&(r!==i||t in e)||on(e,t,r)}function rn(e,t){for(var r=e.length;r--;)if(Vo(e[r][0],t))return r;return-1}function nn(e,t,r,n){return fn(e,(function(e,i,s){t(n,e,r(e),s)})),n}function sn(e,t){return e&&ki(t,Da(t),e)}function on(e,t,r){"__proto__"==t&&rt?rt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function an(e,t){for(var r=-1,s=t.length,o=n(s),a=null==e;++r<s;)o[r]=a?i:xa(e,t[r]);return o}function cn(e,t,r){return e==e&&(r!==i&&(e=e<=r?e:r),t!==i&&(e=e>=t?e:t)),e}function un(e,t,r,n,s,o){var a,c=1&t,u=2&t,l=4&t;if(r&&(a=s?r(e,n,s,o):r(e)),a!==i)return a;if(!ta(e))return e;var h=Fo(e);if(h){if(a=function(e){var t=e.length,r=new e.constructor(t);t&&"string"==typeof e[0]&&Ue.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!c)return Ti(e,a)}else{var d=ys(e),f=d==A||d==S;if(Yo(e))return Si(e,c);if(d==x||d==b||f&&!s){if(a=u||f?{}:ms(e),!c)return u?function(e,t){return ki(e,ps(e),t)}(e,function(e,t){return e&&ki(t,Oa(t),e)}(a,e)):function(e,t){return ki(e,fs(e),t)}(e,sn(a,e))}else{if(!ut[d])return s?e:{};a=function(e,t,r){var n=e.constructor;switch(t){case N:return Ri(e);case v:case E:return new n(+e);case L:return function(e,t){var r=t?Ri(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case U:case M:case B:case K:case $:case V:case j:case z:case q:return Ii(e,r);case R:return new n;case I:case k:return new n(e);case C:return function(e){var t=new e.constructor(e.source,ye.exec(e));return t.lastIndex=e.lastIndex,t}(e);case T:return new n;case D:return i=e,Br?xe(Br.call(i)):{}}var i}(e,d,c)}}o||(o=new Yr);var p=o.get(e);if(p)return p;o.set(e,a),aa(e)?e.forEach((function(n){a.add(un(n,t,r,n,e,o))})):na(e)&&e.forEach((function(n,i){a.set(i,un(n,t,r,i,e,o))}));var y=h?i:(l?u?ss:is:u?Oa:Da)(e);return Ct(y||e,(function(n,i){y&&(n=e[i=n]),tn(a,i,un(n,t,r,i,e,o))})),a}function ln(e,t,r){var n=r.length;if(null==e)return!n;for(e=xe(e);n--;){var s=r[n],o=t[s],a=e[s];if(a===i&&!(s in e)||!o(a))return!1}return!0}function hn(e,t,r){if("function"!=typeof e)throw new Te(s);return ks((function(){e.apply(i,r)}),t)}function dn(e,t,r,n){var i=-1,s=Ot,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;r&&(t=Lt(t,Xt(r))),n?(s=Nt,o=!1):t.length>=200&&(s=tr,o=!1,t=new Wr(t));e:for(;++i<a;){var l=e[i],h=null==r?l:r(l);if(l=n||0!==l?l:0,o&&h==h){for(var d=u;d--;)if(t[d]===h)continue e;c.push(l)}else s(t,h,n)||c.push(l)}return c}$r.templateSettings={escape:Z,evaluate:X,interpolate:ee,variable:"",imports:{_:$r}},$r.prototype=jr.prototype,$r.prototype.constructor=$r,zr.prototype=Vr(jr.prototype),zr.prototype.constructor=zr,qr.prototype=Vr(jr.prototype),qr.prototype.constructor=qr,Fr.prototype.clear=function(){this.__data__=Cr?Cr(null):{},this.size=0},Fr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Fr.prototype.get=function(e){var t=this.__data__;if(Cr){var r=t[e];return r===o?i:r}return Ue.call(t,e)?t[e]:i},Fr.prototype.has=function(e){var t=this.__data__;return Cr?t[e]!==i:Ue.call(t,e)},Fr.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Cr&&t===i?o:t,this},Gr.prototype.clear=function(){this.__data__=[],this.size=0},Gr.prototype.delete=function(e){var t=this.__data__,r=rn(t,e);return!(r<0)&&(r==t.length-1?t.pop():Qe.call(t,r,1),--this.size,!0)},Gr.prototype.get=function(e){var t=this.__data__,r=rn(t,e);return r<0?i:t[r][1]},Gr.prototype.has=function(e){return rn(this.__data__,e)>-1},Gr.prototype.set=function(e,t){var r=this.__data__,n=rn(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},Hr.prototype.clear=function(){this.size=0,this.__data__={hash:new Fr,map:new(Rr||Gr),string:new Fr}},Hr.prototype.delete=function(e){var t=ls(this,e).delete(e);return this.size-=t?1:0,t},Hr.prototype.get=function(e){return ls(this,e).get(e)},Hr.prototype.has=function(e){return ls(this,e).has(e)},Hr.prototype.set=function(e,t){var r=ls(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Wr.prototype.add=Wr.prototype.push=function(e){return this.__data__.set(e,o),this},Wr.prototype.has=function(e){return this.__data__.has(e)},Yr.prototype.clear=function(){this.__data__=new Gr,this.size=0},Yr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Yr.prototype.get=function(e){return this.__data__.get(e)},Yr.prototype.has=function(e){return this.__data__.has(e)},Yr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Gr){var n=r.__data__;if(!Rr||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Hr(n)}return r.set(e,t),this.size=r.size,this};var fn=Ni(En),pn=Ni(_n,!0);function yn(e,t){var r=!0;return fn(e,(function(e,n,i){return r=!!t(e,n,i)})),r}function gn(e,t,r){for(var n=-1,s=e.length;++n<s;){var o=e[n],a=t(o);if(null!=a&&(c===i?a==a&&!ua(a):r(a,c)))var c=a,u=o}return u}function mn(e,t){var r=[];return fn(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function bn(e,t,r,n,i){var s=-1,o=e.length;for(r||(r=bs),i||(i=[]);++s<o;){var a=e[s];t>0&&r(a)?t>1?bn(a,t-1,r,n,i):Ut(i,a):n||(i[i.length]=a)}return i}var wn=Li(),vn=Li(!0);function En(e,t){return e&&wn(e,t,Da)}function _n(e,t){return e&&vn(e,t,Da)}function An(e,t){return Dt(t,(function(t){return Zo(e[t])}))}function Sn(e,t){for(var r=0,n=(t=vi(t,e)).length;null!=e&&r<n;)e=e[Ms(t[r++])];return r&&r==n?e:i}function Rn(e,t,r){var n=t(e);return Fo(e)?n:Ut(n,r(e))}function In(e){return null==e?e===i?"[object Undefined]":"[object Null]":Xe&&Xe in xe(e)?function(e){var t=Ue.call(e,Xe),r=e[Xe];try{e[Xe]=i;var n=!0}catch(e){}var s=Ke.call(e);n&&(t?e[Xe]=r:delete e[Xe]);return s}(e):function(e){return Ke.call(e)}(e)}function xn(e,t){return e>t}function Pn(e,t){return null!=e&&Ue.call(e,t)}function Cn(e,t){return null!=e&&t in xe(e)}function Tn(e,t,r){for(var s=r?Nt:Ot,o=e[0].length,a=e.length,c=a,u=n(a),l=1/0,h=[];c--;){var d=e[c];c&&t&&(d=Lt(d,Xt(t))),l=wr(d.length,l),u[c]=!r&&(t||o>=120&&d.length>=120)?new Wr(c&&d):i}d=e[0];var f=-1,p=u[0];e:for(;++f<o&&h.length<l;){var y=d[f],g=t?t(y):y;if(y=r||0!==y?y:0,!(p?tr(p,g):s(h,g,r))){for(c=a;--c;){var m=u[c];if(!(m?tr(m,g):s(e[c],g,r)))continue e}p&&p.push(g),h.push(y)}}return h}function kn(e,t,r){var n=null==(e=Ps(e,t=vi(t,e)))?e:e[Ms(Qs(t))];return null==n?i:xt(n,e,r)}function Dn(e){return ra(e)&&In(e)==b}function On(e,t,r,n,s){return e===t||(null==e||null==t||!ra(e)&&!ra(t)?e!=e&&t!=t:function(e,t,r,n,s,o){var a=Fo(e),c=Fo(t),u=a?w:ys(e),l=c?w:ys(t),h=(u=u==b?x:u)==x,d=(l=l==b?x:l)==x,f=u==l;if(f&&Yo(e)){if(!Yo(t))return!1;a=!0,h=!1}if(f&&!h)return o||(o=new Yr),a||la(e)?rs(e,t,r,n,s,o):function(e,t,r,n,i,s,o){switch(r){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case N:return!(e.byteLength!=t.byteLength||!s(new Fe(e),new Fe(t)));case v:case E:case I:return Vo(+e,+t);case _:return e.name==t.name&&e.message==t.message;case C:case k:return e==t+"";case R:var a=cr;case T:var c=1&n;if(a||(a=hr),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=2,o.set(e,t);var l=rs(a(e),a(t),n,i,s,o);return o.delete(e),l;case D:if(Br)return Br.call(e)==Br.call(t)}return!1}(e,t,u,r,n,s,o);if(!(1&r)){var p=h&&Ue.call(e,"__wrapped__"),y=d&&Ue.call(t,"__wrapped__");if(p||y){var g=p?e.value():e,m=y?t.value():t;return o||(o=new Yr),s(g,m,r,n,o)}}if(!f)return!1;return o||(o=new Yr),function(e,t,r,n,s,o){var a=1&r,c=is(e),u=c.length,l=is(t),h=l.length;if(u!=h&&!a)return!1;var d=u;for(;d--;){var f=c[d];if(!(a?f in t:Ue.call(t,f)))return!1}var p=o.get(e),y=o.get(t);if(p&&y)return p==t&&y==e;var g=!0;o.set(e,t),o.set(t,e);var m=a;for(;++d<u;){var b=e[f=c[d]],w=t[f];if(n)var v=a?n(w,b,f,t,e,o):n(b,w,f,e,t,o);if(!(v===i?b===w||s(b,w,r,n,o):v)){g=!1;break}m||(m="constructor"==f)}if(g&&!m){var E=e.constructor,_=t.constructor;E==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof E&&E instanceof E&&"function"==typeof _&&_ instanceof _||(g=!1)}return o.delete(e),o.delete(t),g}(e,t,r,n,s,o)}(e,t,r,n,On,s))}function Nn(e,t,r,n){var s=r.length,o=s,a=!n;if(null==e)return!o;for(e=xe(e);s--;){var c=r[s];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<o;){var u=(c=r[s])[0],l=e[u],h=c[1];if(a&&c[2]){if(l===i&&!(u in e))return!1}else{var d=new Yr;if(n)var f=n(l,h,u,e,t,d);if(!(f===i?On(h,l,3,n,d):f))return!1}}return!0}function Ln(e){return!(!ta(e)||(t=e,Be&&Be in t))&&(Zo(e)?je:be).test(Bs(e));var t}function Un(e){return"function"==typeof e?e:null==e?ic:"object"==typeof e?Fo(e)?jn(e[0],e[1]):Vn(e):fc(e)}function Mn(e){if(!Ss(e))return Wt(e);var t=[];for(var r in xe(e))Ue.call(e,r)&&"constructor"!=r&&t.push(r);return t}function Bn(e){if(!ta(e))return function(e){var t=[];if(null!=e)for(var r in xe(e))t.push(r);return t}(e);var t=Ss(e),r=[];for(var n in e)("constructor"!=n||!t&&Ue.call(e,n))&&r.push(n);return r}function Kn(e,t){return e<t}function $n(e,t){var r=-1,i=Ho(e)?n(e.length):[];return fn(e,(function(e,n,s){i[++r]=t(e,n,s)})),i}function Vn(e){var t=hs(e);return 1==t.length&&t[0][2]?Is(t[0][0],t[0][1]):function(r){return r===e||Nn(r,e,t)}}function jn(e,t){return Es(e)&&Rs(t)?Is(Ms(e),t):function(r){var n=xa(r,e);return n===i&&n===t?Pa(r,e):On(t,n,3)}}function zn(e,t,r,n,s){e!==t&&wn(t,(function(o,a){if(s||(s=new Yr),ta(o))!function(e,t,r,n,s,o,a){var c=Cs(e,r),u=Cs(t,r),l=a.get(u);if(l)return void en(e,r,l);var h=o?o(c,u,r+"",e,t,a):i,d=h===i;if(d){var f=Fo(u),p=!f&&Yo(u),y=!f&&!p&&la(u);h=u,f||p||y?Fo(c)?h=c:Wo(c)?h=Ti(c):p?(d=!1,h=Si(u,!0)):y?(d=!1,h=Ii(u,!0)):h=[]:sa(u)||qo(u)?(h=c,qo(c)?h=ba(c):ta(c)&&!Zo(c)||(h=ms(u))):d=!1}d&&(a.set(u,h),s(h,u,n,o,a),a.delete(u));en(e,r,h)}(e,t,a,r,zn,n,s);else{var c=n?n(Cs(e,a),o,a+"",e,t,s):i;c===i&&(c=o),en(e,a,c)}}),Oa)}function qn(e,t){var r=e.length;if(r)return ws(t+=t<0?r:0,r)?e[t]:i}function Fn(e,t,r){t=t.length?Lt(t,(function(e){return Fo(e)?function(t){return Sn(t,1===e.length?e[0]:e)}:e})):[ic];var n=-1;t=Lt(t,Xt(us()));var i=$n(e,(function(e,r,i){var s=Lt(t,(function(t){return t(e)}));return{criteria:s,index:++n,value:e}}));return function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(i,(function(e,t){return function(e,t,r){var n=-1,i=e.criteria,s=t.criteria,o=i.length,a=r.length;for(;++n<o;){var c=xi(i[n],s[n]);if(c)return n>=a?c:c*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}))}function Gn(e,t,r){for(var n=-1,i=t.length,s={};++n<i;){var o=t[n],a=Sn(e,o);r(a,o)&&ei(s,vi(o,e),a)}return s}function Hn(e,t,r,n){var i=n?qt:zt,s=-1,o=t.length,a=e;for(e===t&&(t=Ti(t)),r&&(a=Lt(e,Xt(r)));++s<o;)for(var c=0,u=t[s],l=r?r(u):u;(c=i(a,l,c,n))>-1;)a!==e&&Qe.call(a,c,1),Qe.call(e,c,1);return e}function Wn(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==s){var s=i;ws(i)?Qe.call(e,i,1):di(e,i)}}return e}function Yn(e,t){return e+gt(_r()*(t-e+1))}function Qn(e,t){var r="";if(!e||t<1||t>p)return r;do{t%2&&(r+=e),(t=gt(t/2))&&(e+=e)}while(t);return r}function Jn(e,t){return Ds(xs(e,t,ic),e+"")}function Zn(e){return Jr(Va(e))}function Xn(e,t){var r=Va(e);return Ls(r,cn(t,0,r.length))}function ei(e,t,r,n){if(!ta(e))return e;for(var s=-1,o=(t=vi(t,e)).length,a=o-1,c=e;null!=c&&++s<o;){var u=Ms(t[s]),l=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(s!=a){var h=c[u];(l=n?n(h,u,c):i)===i&&(l=ta(h)?h:ws(t[s+1])?[]:{})}tn(c,u,l),c=c[u]}return e}var ti=Tr?function(e,t){return Tr.set(e,t),e}:ic,ri=rt?function(e,t){return rt(e,"toString",{configurable:!0,enumerable:!1,value:tc(t),writable:!0})}:ic;function ni(e){return Ls(Va(e))}function ii(e,t,r){var i=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(r=r>s?s:r)<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var o=n(s);++i<s;)o[i]=e[i+t];return o}function si(e,t){var r;return fn(e,(function(e,n,i){return!(r=t(e,n,i))})),!!r}function oi(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;n<i;){var s=n+i>>>1,o=e[s];null!==o&&!ua(o)&&(r?o<=t:o<t)?n=s+1:i=s}return i}return ai(e,t,ic,r)}function ai(e,t,r,n){var s=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=r(t))!=t,c=null===t,u=ua(t),l=t===i;s<o;){var h=gt((s+o)/2),d=r(e[h]),f=d!==i,p=null===d,y=d==d,g=ua(d);if(a)var m=n||y;else m=l?y&&(n||f):c?y&&f&&(n||!p):u?y&&f&&!p&&(n||!g):!p&&!g&&(n?d<=t:d<t);m?s=h+1:o=h}return wr(o,4294967294)}function ci(e,t){for(var r=-1,n=e.length,i=0,s=[];++r<n;){var o=e[r],a=t?t(o):o;if(!r||!Vo(a,c)){var c=a;s[i++]=0===o?0:o}}return s}function ui(e){return"number"==typeof e?e:ua(e)?y:+e}function li(e){if("string"==typeof e)return e;if(Fo(e))return Lt(e,li)+"";if(ua(e))return Kr?Kr.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function hi(e,t,r){var n=-1,i=Ot,s=e.length,o=!0,a=[],c=a;if(r)o=!1,i=Nt;else if(s>=200){var u=t?null:Qi(e);if(u)return hr(u);o=!1,i=tr,c=new Wr}else c=t?[]:a;e:for(;++n<s;){var l=e[n],h=t?t(l):l;if(l=r||0!==l?l:0,o&&h==h){for(var d=c.length;d--;)if(c[d]===h)continue e;t&&c.push(h),a.push(l)}else i(c,h,r)||(c!==a&&c.push(h),a.push(l))}return a}function di(e,t){return null==(e=Ps(e,t=vi(t,e)))||delete e[Ms(Qs(t))]}function fi(e,t,r,n){return ei(e,t,r(Sn(e,t)),n)}function pi(e,t,r,n){for(var i=e.length,s=n?i:-1;(n?s--:++s<i)&&t(e[s],s,e););return r?ii(e,n?0:s,n?s+1:i):ii(e,n?s+1:0,n?i:s)}function yi(e,t){var r=e;return r instanceof qr&&(r=r.value()),Mt(t,(function(e,t){return t.func.apply(t.thisArg,Ut([e],t.args))}),r)}function gi(e,t,r){var i=e.length;if(i<2)return i?hi(e[0]):[];for(var s=-1,o=n(i);++s<i;)for(var a=e[s],c=-1;++c<i;)c!=s&&(o[s]=dn(o[s]||a,e[c],t,r));return hi(bn(o,1),t,r)}function mi(e,t,r){for(var n=-1,s=e.length,o=t.length,a={};++n<s;){var c=n<o?t[n]:i;r(a,e[n],c)}return a}function bi(e){return Wo(e)?e:[]}function wi(e){return"function"==typeof e?e:ic}function vi(e,t){return Fo(e)?e:Es(e,t)?[e]:Us(wa(e))}var Ei=Jn;function _i(e,t,r){var n=e.length;return r=r===i?n:r,!t&&r>=n?e:ii(e,t,r)}var Ai=it||function(e){return yt.clearTimeout(e)};function Si(e,t){if(t)return e.slice();var r=e.length,n=Ge?Ge(r):new e.constructor(r);return e.copy(n),n}function Ri(e){var t=new e.constructor(e.byteLength);return new Fe(t).set(new Fe(e)),t}function Ii(e,t){var r=t?Ri(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function xi(e,t){if(e!==t){var r=e!==i,n=null===e,s=e==e,o=ua(e),a=t!==i,c=null===t,u=t==t,l=ua(t);if(!c&&!l&&!o&&e>t||o&&a&&u&&!c&&!l||n&&a&&u||!r&&u||!s)return 1;if(!n&&!o&&!l&&e<t||l&&r&&s&&!n&&!o||c&&r&&s||!a&&s||!u)return-1}return 0}function Pi(e,t,r,i){for(var s=-1,o=e.length,a=r.length,c=-1,u=t.length,l=br(o-a,0),h=n(u+l),d=!i;++c<u;)h[c]=t[c];for(;++s<a;)(d||s<o)&&(h[r[s]]=e[s]);for(;l--;)h[c++]=e[s++];return h}function Ci(e,t,r,i){for(var s=-1,o=e.length,a=-1,c=r.length,u=-1,l=t.length,h=br(o-c,0),d=n(h+l),f=!i;++s<h;)d[s]=e[s];for(var p=s;++u<l;)d[p+u]=t[u];for(;++a<c;)(f||s<o)&&(d[p+r[a]]=e[s++]);return d}function Ti(e,t){var r=-1,i=e.length;for(t||(t=n(i));++r<i;)t[r]=e[r];return t}function ki(e,t,r,n){var s=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var c=t[o],u=n?n(r[c],e[c],c,r,e):i;u===i&&(u=e[c]),s?on(r,c,u):tn(r,c,u)}return r}function Di(e,t){return function(r,n){var i=Fo(r)?Pt:nn,s=t?t():{};return i(r,e,us(n,2),s)}}function Oi(e){return Jn((function(t,r){var n=-1,s=r.length,o=s>1?r[s-1]:i,a=s>2?r[2]:i;for(o=e.length>3&&"function"==typeof o?(s--,o):i,a&&vs(r[0],r[1],a)&&(o=s<3?i:o,s=1),t=xe(t);++n<s;){var c=r[n];c&&e(t,c,n,o)}return t}))}function Ni(e,t){return function(r,n){if(null==r)return r;if(!Ho(r))return e(r,n);for(var i=r.length,s=t?i:-1,o=xe(r);(t?s--:++s<i)&&!1!==n(o[s],s,o););return r}}function Li(e){return function(t,r,n){for(var i=-1,s=xe(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===r(s[c],c,s))break}return t}}function Ui(e){return function(t){var r=ar(t=wa(t))?pr(t):i,n=r?r[0]:t.charAt(0),s=r?_i(r,1).join(""):t.slice(1);return n[e]()+s}}function Mi(e){return function(t){return Mt(Za(qa(t).replace(et,"")),e,"")}}function Bi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Vr(e.prototype),n=e.apply(r,t);return ta(n)?n:r}}function Ki(e){return function(t,r,n){var s=xe(t);if(!Ho(t)){var o=us(r,3);t=Da(t),r=function(e){return o(s[e],e,s)}}var a=e(t,r,n);return a>-1?s[o?t[a]:a]:i}}function $i(e){return ns((function(t){var r=t.length,n=r,o=zr.prototype.thru;for(e&&t.reverse();n--;){var a=t[n];if("function"!=typeof a)throw new Te(s);if(o&&!c&&"wrapper"==as(a))var c=new zr([],!0)}for(n=c?n:r;++n<r;){var u=as(a=t[n]),l="wrapper"==u?os(a):i;c=l&&_s(l[0])&&424==l[1]&&!l[4].length&&1==l[9]?c[as(l[0])].apply(c,l[3]):1==a.length&&_s(a)?c[u]():c.thru(a)}return function(){var e=arguments,n=e[0];if(c&&1==e.length&&Fo(n))return c.plant(n).value();for(var i=0,s=r?t[i].apply(this,e):n;++i<r;)s=t[i].call(this,s);return s}}))}function Vi(e,t,r,s,o,a,c,u,l,d){var f=t&h,p=1&t,y=2&t,g=24&t,m=512&t,b=y?i:Bi(e);return function h(){for(var w=arguments.length,v=n(w),E=w;E--;)v[E]=arguments[E];if(g)var _=cs(h),A=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(v,_);if(s&&(v=Pi(v,s,o,g)),a&&(v=Ci(v,a,c,g)),w-=A,g&&w<d){var S=lr(v,_);return Wi(e,t,Vi,h.placeholder,r,v,S,u,l,d-w)}var R=p?r:this,I=y?R[e]:e;return w=v.length,u?v=function(e,t){var r=e.length,n=wr(t.length,r),s=Ti(e);for(;n--;){var o=t[n];e[n]=ws(o,r)?s[o]:i}return e}(v,u):m&&w>1&&v.reverse(),f&&l<w&&(v.length=l),this&&this!==yt&&this instanceof h&&(I=b||Bi(I)),I.apply(R,v)}}function ji(e,t){return function(r,n){return function(e,t,r,n){return En(e,(function(e,i,s){t(n,r(e),i,s)})),n}(r,e,t(n),{})}}function zi(e,t){return function(r,n){var s;if(r===i&&n===i)return t;if(r!==i&&(s=r),n!==i){if(s===i)return n;"string"==typeof r||"string"==typeof n?(r=li(r),n=li(n)):(r=ui(r),n=ui(n)),s=e(r,n)}return s}}function qi(e){return ns((function(t){return t=Lt(t,Xt(us())),Jn((function(r){var n=this;return e(t,(function(e){return xt(e,n,r)}))}))}))}function Fi(e,t){var r=(t=t===i?" ":li(t)).length;if(r<2)return r?Qn(t,e):t;var n=Qn(t,pt(e/fr(t)));return ar(t)?_i(pr(n),0,e).join(""):n.slice(0,e)}function Gi(e){return function(t,r,s){return s&&"number"!=typeof s&&vs(t,r,s)&&(r=s=i),t=pa(t),r===i?(r=t,t=0):r=pa(r),function(e,t,r,i){for(var s=-1,o=br(pt((t-e)/(r||1)),0),a=n(o);o--;)a[i?o:++s]=e,e+=r;return a}(t,r,s=s===i?t<r?1:-1:pa(s),e)}}function Hi(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=ma(t),r=ma(r)),e(t,r)}}function Wi(e,t,r,n,s,o,a,c,h,d){var f=8&t;t|=f?u:l,4&(t&=~(f?l:u))||(t&=-4);var p=[e,t,s,f?o:i,f?a:i,f?i:o,f?i:a,c,h,d],y=r.apply(i,p);return _s(e)&&Ts(y,p),y.placeholder=n,Os(y,e,t)}function Yi(e){var t=Ie[e];return function(e,r){if(e=ma(e),(r=null==r?0:wr(ya(r),292))&&vt(e)){var n=(wa(e)+"e").split("e");return+((n=(wa(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var Qi=xr&&1/hr(new xr([,-0]))[1]==f?function(e){return new xr(e)}:uc;function Ji(e){return function(t){var r=ys(t);return r==R?cr(t):r==T?dr(t):function(e,t){return Lt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Zi(e,t,r,o,f,p,y,g){var m=2&t;if(!m&&"function"!=typeof e)throw new Te(s);var b=o?o.length:0;if(b||(t&=-97,o=f=i),y=y===i?y:br(ya(y),0),g=g===i?g:ya(g),b-=f?f.length:0,t&l){var w=o,v=f;o=f=i}var E=m?i:os(e),_=[e,t,r,o,f,w,v,p,y,g];if(E&&function(e,t){var r=e[1],n=t[1],i=r|n,s=i<131,o=n==h&&8==r||n==h&&r==d&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==r;if(!s&&!o)return e;1&n&&(e[2]=t[2],i|=1&r?0:4);var c=t[3];if(c){var u=e[3];e[3]=u?Pi(u,c,t[4]):c,e[4]=u?lr(e[3],a):t[4]}(c=t[5])&&(u=e[5],e[5]=u?Ci(u,c,t[6]):c,e[6]=u?lr(e[5],a):t[6]);(c=t[7])&&(e[7]=c);n&h&&(e[8]=null==e[8]?t[8]:wr(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=i}(_,E),e=_[0],t=_[1],r=_[2],o=_[3],f=_[4],!(g=_[9]=_[9]===i?m?0:e.length:br(_[9]-b,0))&&24&t&&(t&=-25),t&&1!=t)A=8==t||t==c?function(e,t,r){var s=Bi(e);return function o(){for(var a=arguments.length,c=n(a),u=a,l=cs(o);u--;)c[u]=arguments[u];var h=a<3&&c[0]!==l&&c[a-1]!==l?[]:lr(c,l);return(a-=h.length)<r?Wi(e,t,Vi,o.placeholder,i,c,h,i,i,r-a):xt(this&&this!==yt&&this instanceof o?s:e,this,c)}}(e,t,g):t!=u&&33!=t||f.length?Vi.apply(i,_):function(e,t,r,i){var s=1&t,o=Bi(e);return function t(){for(var a=-1,c=arguments.length,u=-1,l=i.length,h=n(l+c),d=this&&this!==yt&&this instanceof t?o:e;++u<l;)h[u]=i[u];for(;c--;)h[u++]=arguments[++a];return xt(d,s?r:this,h)}}(e,t,r,o);else var A=function(e,t,r){var n=1&t,i=Bi(e);return function t(){return(this&&this!==yt&&this instanceof t?i:e).apply(n?r:this,arguments)}}(e,t,r);return Os((E?ti:Ts)(A,_),e,t)}function Xi(e,t,r,n){return e===i||Vo(e,Oe[r])&&!Ue.call(n,r)?t:e}function es(e,t,r,n,s,o){return ta(e)&&ta(t)&&(o.set(t,e),zn(e,t,i,es,o),o.delete(t)),e}function ts(e){return sa(e)?i:e}function rs(e,t,r,n,s,o){var a=1&r,c=e.length,u=t.length;if(c!=u&&!(a&&u>c))return!1;var l=o.get(e),h=o.get(t);if(l&&h)return l==t&&h==e;var d=-1,f=!0,p=2&r?new Wr:i;for(o.set(e,t),o.set(t,e);++d<c;){var y=e[d],g=t[d];if(n)var m=a?n(g,y,d,t,e,o):n(y,g,d,e,t,o);if(m!==i){if(m)continue;f=!1;break}if(p){if(!Kt(t,(function(e,t){if(!tr(p,t)&&(y===e||s(y,e,r,n,o)))return p.push(t)}))){f=!1;break}}else if(y!==g&&!s(y,g,r,n,o)){f=!1;break}}return o.delete(e),o.delete(t),f}function ns(e){return Ds(xs(e,i,Fs),e+"")}function is(e){return Rn(e,Da,fs)}function ss(e){return Rn(e,Oa,ps)}var os=Tr?function(e){return Tr.get(e)}:uc;function as(e){for(var t=e.name+"",r=kr[t],n=Ue.call(kr,t)?r.length:0;n--;){var i=r[n],s=i.func;if(null==s||s==e)return i.name}return t}function cs(e){return(Ue.call($r,"placeholder")?$r:e).placeholder}function us(){var e=$r.iteratee||sc;return e=e===sc?Un:e,arguments.length?e(arguments[0],arguments[1]):e}function ls(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function hs(e){for(var t=Da(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Rs(i)]}return t}function ds(e,t){var r=function(e,t){return null==e?i:e[t]}(e,t);return Ln(r)?r:i}var fs=mt?function(e){return null==e?[]:(e=xe(e),Dt(mt(e),(function(t){return Ye.call(e,t)})))}:gc,ps=mt?function(e){for(var t=[];e;)Ut(t,fs(e)),e=He(e);return t}:gc,ys=In;function gs(e,t,r){for(var n=-1,i=(t=vi(t,e)).length,s=!1;++n<i;){var o=Ms(t[n]);if(!(s=null!=e&&r(e,o)))break;e=e[o]}return s||++n!=i?s:!!(i=null==e?0:e.length)&&ea(i)&&ws(o,i)&&(Fo(e)||qo(e))}function ms(e){return"function"!=typeof e.constructor||Ss(e)?{}:Vr(He(e))}function bs(e){return Fo(e)||qo(e)||!!(Je&&e&&e[Je])}function ws(e,t){var r=typeof e;return!!(t=null==t?p:t)&&("number"==r||"symbol"!=r&&ve.test(e))&&e>-1&&e%1==0&&e<t}function vs(e,t,r){if(!ta(r))return!1;var n=typeof t;return!!("number"==n?Ho(r)&&ws(t,r.length):"string"==n&&t in r)&&Vo(r[t],e)}function Es(e,t){if(Fo(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ua(e))||(re.test(e)||!te.test(e)||null!=t&&e in xe(t))}function _s(e){var t=as(e),r=$r[t];if("function"!=typeof r||!(t in qr.prototype))return!1;if(e===r)return!0;var n=os(r);return!!n&&e===n[0]}(Sr&&ys(new Sr(new ArrayBuffer(1)))!=L||Rr&&ys(new Rr)!=R||Ir&&ys(Ir.resolve())!=P||xr&&ys(new xr)!=T||Pr&&ys(new Pr)!=O)&&(ys=function(e){var t=In(e),r=t==x?e.constructor:i,n=r?Bs(r):"";if(n)switch(n){case Dr:return L;case Or:return R;case Nr:return P;case Lr:return T;case Ur:return O}return t});var As=Ne?Zo:mc;function Ss(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Oe)}function Rs(e){return e==e&&!ta(e)}function Is(e,t){return function(r){return null!=r&&(r[e]===t&&(t!==i||e in xe(r)))}}function xs(e,t,r){return t=br(t===i?e.length-1:t,0),function(){for(var i=arguments,s=-1,o=br(i.length-t,0),a=n(o);++s<o;)a[s]=i[t+s];s=-1;for(var c=n(t+1);++s<t;)c[s]=i[s];return c[t]=r(a),xt(e,this,c)}}function Ps(e,t){return t.length<2?e:Sn(e,ii(t,0,-1))}function Cs(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Ts=Ns(ti),ks=ft||function(e,t){return yt.setTimeout(e,t)},Ds=Ns(ri);function Os(e,t,r){var n=t+"";return Ds(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(ce,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return Ct(m,(function(r){var n="_."+r[0];t&r[1]&&!Ot(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(ue);return t?t[1].split(le):[]}(n),r)))}function Ns(e){var t=0,r=0;return function(){var n=vr(),s=16-(n-r);if(r=n,s>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Ls(e,t){var r=-1,n=e.length,s=n-1;for(t=t===i?n:t;++r<t;){var o=Yn(r,s),a=e[o];e[o]=e[r],e[r]=a}return e.length=t,e}var Us=function(e){var t=Lo(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ne,(function(e,r,n,i){t.push(n?i.replace(fe,"$1"):r||e)})),t}));function Ms(e){if("string"==typeof e||ua(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Bs(e){if(null!=e){try{return Le.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ks(e){if(e instanceof qr)return e.clone();var t=new zr(e.__wrapped__,e.__chain__);return t.__actions__=Ti(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var $s=Jn((function(e,t){return Wo(e)?dn(e,bn(t,1,Wo,!0)):[]})),Vs=Jn((function(e,t){var r=Qs(t);return Wo(r)&&(r=i),Wo(e)?dn(e,bn(t,1,Wo,!0),us(r,2)):[]})),js=Jn((function(e,t){var r=Qs(t);return Wo(r)&&(r=i),Wo(e)?dn(e,bn(t,1,Wo,!0),i,r):[]}));function zs(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:ya(r);return i<0&&(i=br(n+i,0)),jt(e,us(t,3),i)}function qs(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var s=n-1;return r!==i&&(s=ya(r),s=r<0?br(n+s,0):wr(s,n-1)),jt(e,us(t,3),s,!0)}function Fs(e){return(null==e?0:e.length)?bn(e,1):[]}function Gs(e){return e&&e.length?e[0]:i}var Hs=Jn((function(e){var t=Lt(e,bi);return t.length&&t[0]===e[0]?Tn(t):[]})),Ws=Jn((function(e){var t=Qs(e),r=Lt(e,bi);return t===Qs(r)?t=i:r.pop(),r.length&&r[0]===e[0]?Tn(r,us(t,2)):[]})),Ys=Jn((function(e){var t=Qs(e),r=Lt(e,bi);return(t="function"==typeof t?t:i)&&r.pop(),r.length&&r[0]===e[0]?Tn(r,i,t):[]}));function Qs(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Js=Jn(Zs);function Zs(e,t){return e&&e.length&&t&&t.length?Hn(e,t):e}var Xs=ns((function(e,t){var r=null==e?0:e.length,n=an(e,t);return Wn(e,Lt(t,(function(e){return ws(e,r)?+e:e})).sort(xi)),n}));function eo(e){return null==e?e:Ar.call(e)}var to=Jn((function(e){return hi(bn(e,1,Wo,!0))})),ro=Jn((function(e){var t=Qs(e);return Wo(t)&&(t=i),hi(bn(e,1,Wo,!0),us(t,2))})),no=Jn((function(e){var t=Qs(e);return t="function"==typeof t?t:i,hi(bn(e,1,Wo,!0),i,t)}));function io(e){if(!e||!e.length)return[];var t=0;return e=Dt(e,(function(e){if(Wo(e))return t=br(e.length,t),!0})),Jt(t,(function(t){return Lt(e,Ht(t))}))}function so(e,t){if(!e||!e.length)return[];var r=io(e);return null==t?r:Lt(r,(function(e){return xt(t,i,e)}))}var oo=Jn((function(e,t){return Wo(e)?dn(e,t):[]})),ao=Jn((function(e){return gi(Dt(e,Wo))})),co=Jn((function(e){var t=Qs(e);return Wo(t)&&(t=i),gi(Dt(e,Wo),us(t,2))})),uo=Jn((function(e){var t=Qs(e);return t="function"==typeof t?t:i,gi(Dt(e,Wo),i,t)})),lo=Jn(io);var ho=Jn((function(e){var t=e.length,r=t>1?e[t-1]:i;return r="function"==typeof r?(e.pop(),r):i,so(e,r)}));function fo(e){var t=$r(e);return t.__chain__=!0,t}function po(e,t){return t(e)}var yo=ns((function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,s=function(t){return an(t,e)};return!(t>1||this.__actions__.length)&&n instanceof qr&&ws(r)?((n=n.slice(r,+r+(t?1:0))).__actions__.push({func:po,args:[s],thisArg:i}),new zr(n,this.__chain__).thru((function(e){return t&&!e.length&&e.push(i),e}))):this.thru(s)}));var go=Di((function(e,t,r){Ue.call(e,r)?++e[r]:on(e,r,1)}));var mo=Ki(zs),bo=Ki(qs);function wo(e,t){return(Fo(e)?Ct:fn)(e,us(t,3))}function vo(e,t){return(Fo(e)?Tt:pn)(e,us(t,3))}var Eo=Di((function(e,t,r){Ue.call(e,r)?e[r].push(t):on(e,r,[t])}));var _o=Jn((function(e,t,r){var i=-1,s="function"==typeof t,o=Ho(e)?n(e.length):[];return fn(e,(function(e){o[++i]=s?xt(t,e,r):kn(e,t,r)})),o})),Ao=Di((function(e,t,r){on(e,r,t)}));function So(e,t){return(Fo(e)?Lt:$n)(e,us(t,3))}var Ro=Di((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]}));var Io=Jn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&vs(e,t[0],t[1])?t=[]:r>2&&vs(t[0],t[1],t[2])&&(t=[t[0]]),Fn(e,bn(t,1),[])})),xo=lt||function(){return yt.Date.now()};function Po(e,t,r){return t=r?i:t,t=e&&null==t?e.length:t,Zi(e,h,i,i,i,i,t)}function Co(e,t){var r;if("function"!=typeof t)throw new Te(s);return e=ya(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=i),r}}var To=Jn((function(e,t,r){var n=1;if(r.length){var i=lr(r,cs(To));n|=u}return Zi(e,n,t,r,i)})),ko=Jn((function(e,t,r){var n=3;if(r.length){var i=lr(r,cs(ko));n|=u}return Zi(t,n,e,r,i)}));function Do(e,t,r){var n,o,a,c,u,l,h=0,d=!1,f=!1,p=!0;if("function"!=typeof e)throw new Te(s);function y(t){var r=n,s=o;return n=o=i,h=t,c=e.apply(s,r)}function g(e){var r=e-l;return l===i||r>=t||r<0||f&&e-h>=a}function m(){var e=xo();if(g(e))return b(e);u=ks(m,function(e){var r=t-(e-l);return f?wr(r,a-(e-h)):r}(e))}function b(e){return u=i,p&&n?y(e):(n=o=i,c)}function w(){var e=xo(),r=g(e);if(n=arguments,o=this,l=e,r){if(u===i)return function(e){return h=e,u=ks(m,t),d?y(e):c}(l);if(f)return Ai(u),u=ks(m,t),y(l)}return u===i&&(u=ks(m,t)),c}return t=ma(t)||0,ta(r)&&(d=!!r.leading,a=(f="maxWait"in r)?br(ma(r.maxWait)||0,t):a,p="trailing"in r?!!r.trailing:p),w.cancel=function(){u!==i&&Ai(u),h=0,n=l=o=u=i},w.flush=function(){return u===i?c:b(xo())},w}var Oo=Jn((function(e,t){return hn(e,1,t)})),No=Jn((function(e,t,r){return hn(e,ma(t)||0,r)}));function Lo(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Te(s);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(Lo.Cache||Hr),r}function Uo(e){if("function"!=typeof e)throw new Te(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Lo.Cache=Hr;var Mo=Ei((function(e,t){var r=(t=1==t.length&&Fo(t[0])?Lt(t[0],Xt(us())):Lt(bn(t,1),Xt(us()))).length;return Jn((function(n){for(var i=-1,s=wr(n.length,r);++i<s;)n[i]=t[i].call(this,n[i]);return xt(e,this,n)}))})),Bo=Jn((function(e,t){var r=lr(t,cs(Bo));return Zi(e,u,i,t,r)})),Ko=Jn((function(e,t){var r=lr(t,cs(Ko));return Zi(e,l,i,t,r)})),$o=ns((function(e,t){return Zi(e,d,i,i,i,t)}));function Vo(e,t){return e===t||e!=e&&t!=t}var jo=Hi(xn),zo=Hi((function(e,t){return e>=t})),qo=Dn(function(){return arguments}())?Dn:function(e){return ra(e)&&Ue.call(e,"callee")&&!Ye.call(e,"callee")},Fo=n.isArray,Go=Et?Xt(Et):function(e){return ra(e)&&In(e)==N};function Ho(e){return null!=e&&ea(e.length)&&!Zo(e)}function Wo(e){return ra(e)&&Ho(e)}var Yo=wt||mc,Qo=_t?Xt(_t):function(e){return ra(e)&&In(e)==E};function Jo(e){if(!ra(e))return!1;var t=In(e);return t==_||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!sa(e)}function Zo(e){if(!ta(e))return!1;var t=In(e);return t==A||t==S||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Xo(e){return"number"==typeof e&&e==ya(e)}function ea(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=p}function ta(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ra(e){return null!=e&&"object"==typeof e}var na=At?Xt(At):function(e){return ra(e)&&ys(e)==R};function ia(e){return"number"==typeof e||ra(e)&&In(e)==I}function sa(e){if(!ra(e)||In(e)!=x)return!1;var t=He(e);if(null===t)return!0;var r=Ue.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Le.call(r)==$e}var oa=St?Xt(St):function(e){return ra(e)&&In(e)==C};var aa=Rt?Xt(Rt):function(e){return ra(e)&&ys(e)==T};function ca(e){return"string"==typeof e||!Fo(e)&&ra(e)&&In(e)==k}function ua(e){return"symbol"==typeof e||ra(e)&&In(e)==D}var la=It?Xt(It):function(e){return ra(e)&&ea(e.length)&&!!ct[In(e)]};var ha=Hi(Kn),da=Hi((function(e,t){return e<=t}));function fa(e){if(!e)return[];if(Ho(e))return ca(e)?pr(e):Ti(e);if(Ze&&e[Ze])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Ze]());var t=ys(e);return(t==R?cr:t==T?hr:Va)(e)}function pa(e){return e?(e=ma(e))===f||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ya(e){var t=pa(e),r=t%1;return t==t?r?t-r:t:0}function ga(e){return e?cn(ya(e),0,g):0}function ma(e){if("number"==typeof e)return e;if(ua(e))return y;if(ta(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ta(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Zt(e);var r=me.test(e);return r||we.test(e)?dt(e.slice(2),r?2:8):ge.test(e)?y:+e}function ba(e){return ki(e,Oa(e))}function wa(e){return null==e?"":li(e)}var va=Oi((function(e,t){if(Ss(t)||Ho(t))ki(t,Da(t),e);else for(var r in t)Ue.call(t,r)&&tn(e,r,t[r])})),Ea=Oi((function(e,t){ki(t,Oa(t),e)})),_a=Oi((function(e,t,r,n){ki(t,Oa(t),e,n)})),Aa=Oi((function(e,t,r,n){ki(t,Da(t),e,n)})),Sa=ns(an);var Ra=Jn((function(e,t){e=xe(e);var r=-1,n=t.length,s=n>2?t[2]:i;for(s&&vs(t[0],t[1],s)&&(n=1);++r<n;)for(var o=t[r],a=Oa(o),c=-1,u=a.length;++c<u;){var l=a[c],h=e[l];(h===i||Vo(h,Oe[l])&&!Ue.call(e,l))&&(e[l]=o[l])}return e})),Ia=Jn((function(e){return e.push(i,es),xt(La,i,e)}));function xa(e,t,r){var n=null==e?i:Sn(e,t);return n===i?r:n}function Pa(e,t){return null!=e&&gs(e,t,Cn)}var Ca=ji((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ke.call(t)),e[t]=r}),tc(ic)),Ta=ji((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Ke.call(t)),Ue.call(e,t)?e[t].push(r):e[t]=[r]}),us),ka=Jn(kn);function Da(e){return Ho(e)?Qr(e):Mn(e)}function Oa(e){return Ho(e)?Qr(e,!0):Bn(e)}var Na=Oi((function(e,t,r){zn(e,t,r)})),La=Oi((function(e,t,r,n){zn(e,t,r,n)})),Ua=ns((function(e,t){var r={};if(null==e)return r;var n=!1;t=Lt(t,(function(t){return t=vi(t,e),n||(n=t.length>1),t})),ki(e,ss(e),r),n&&(r=un(r,7,ts));for(var i=t.length;i--;)di(r,t[i]);return r}));var Ma=ns((function(e,t){return null==e?{}:function(e,t){return Gn(e,t,(function(t,r){return Pa(e,r)}))}(e,t)}));function Ba(e,t){if(null==e)return{};var r=Lt(ss(e),(function(e){return[e]}));return t=us(t),Gn(e,r,(function(e,r){return t(e,r[0])}))}var Ka=Ji(Da),$a=Ji(Oa);function Va(e){return null==e?[]:er(e,Da(e))}var ja=Mi((function(e,t,r){return t=t.toLowerCase(),e+(r?za(t):t)}));function za(e){return Ja(wa(e).toLowerCase())}function qa(e){return(e=wa(e))&&e.replace(Ee,ir).replace(tt,"")}var Fa=Mi((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),Ga=Mi((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Ha=Ui("toLowerCase");var Wa=Mi((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}));var Ya=Mi((function(e,t,r){return e+(r?" ":"")+Ja(t)}));var Qa=Mi((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Ja=Ui("toUpperCase");function Za(e,t,r){return e=wa(e),(t=r?i:t)===i?function(e){return st.test(e)}(e)?function(e){return e.match(nt)||[]}(e):function(e){return e.match(he)||[]}(e):e.match(t)||[]}var Xa=Jn((function(e,t){try{return xt(e,i,t)}catch(e){return Jo(e)?e:new Se(e)}})),ec=ns((function(e,t){return Ct(t,(function(t){t=Ms(t),on(e,t,To(e[t],e))})),e}));function tc(e){return function(){return e}}var rc=$i(),nc=$i(!0);function ic(e){return e}function sc(e){return Un("function"==typeof e?e:un(e,1))}var oc=Jn((function(e,t){return function(r){return kn(r,e,t)}})),ac=Jn((function(e,t){return function(r){return kn(e,r,t)}}));function cc(e,t,r){var n=Da(t),i=An(t,n);null!=r||ta(t)&&(i.length||!n.length)||(r=t,t=e,e=this,i=An(t,Da(t)));var s=!(ta(r)&&"chain"in r&&!r.chain),o=Zo(e);return Ct(i,(function(r){var n=t[r];e[r]=n,o&&(e.prototype[r]=function(){var t=this.__chain__;if(s||t){var r=e(this.__wrapped__);return(r.__actions__=Ti(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,Ut([this.value()],arguments))})})),e}function uc(){}var lc=qi(Lt),hc=qi(kt),dc=qi(Kt);function fc(e){return Es(e)?Ht(Ms(e)):function(e){return function(t){return Sn(t,e)}}(e)}var pc=Gi(),yc=Gi(!0);function gc(){return[]}function mc(){return!1}var bc=zi((function(e,t){return e+t}),0),wc=Yi("ceil"),vc=zi((function(e,t){return e/t}),1),Ec=Yi("floor");var _c,Ac=zi((function(e,t){return e*t}),1),Sc=Yi("round"),Rc=zi((function(e,t){return e-t}),0);return $r.after=function(e,t){if("function"!=typeof t)throw new Te(s);return e=ya(e),function(){if(--e<1)return t.apply(this,arguments)}},$r.ary=Po,$r.assign=va,$r.assignIn=Ea,$r.assignInWith=_a,$r.assignWith=Aa,$r.at=Sa,$r.before=Co,$r.bind=To,$r.bindAll=ec,$r.bindKey=ko,$r.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Fo(e)?e:[e]},$r.chain=fo,$r.chunk=function(e,t,r){t=(r?vs(e,t,r):t===i)?1:br(ya(t),0);var s=null==e?0:e.length;if(!s||t<1)return[];for(var o=0,a=0,c=n(pt(s/t));o<s;)c[a++]=ii(e,o,o+=t);return c},$r.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var s=e[t];s&&(i[n++]=s)}return i},$r.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Ut(Fo(r)?Ti(r):[r],bn(t,1))},$r.cond=function(e){var t=null==e?0:e.length,r=us();return e=t?Lt(e,(function(e){if("function"!=typeof e[1])throw new Te(s);return[r(e[0]),e[1]]})):[],Jn((function(r){for(var n=-1;++n<t;){var i=e[n];if(xt(i[0],this,r))return xt(i[1],this,r)}}))},$r.conforms=function(e){return function(e){var t=Da(e);return function(r){return ln(r,e,t)}}(un(e,1))},$r.constant=tc,$r.countBy=go,$r.create=function(e,t){var r=Vr(e);return null==t?r:sn(r,t)},$r.curry=function e(t,r,n){var s=Zi(t,8,i,i,i,i,i,r=n?i:r);return s.placeholder=e.placeholder,s},$r.curryRight=function e(t,r,n){var s=Zi(t,c,i,i,i,i,i,r=n?i:r);return s.placeholder=e.placeholder,s},$r.debounce=Do,$r.defaults=Ra,$r.defaultsDeep=Ia,$r.defer=Oo,$r.delay=No,$r.difference=$s,$r.differenceBy=Vs,$r.differenceWith=js,$r.drop=function(e,t,r){var n=null==e?0:e.length;return n?ii(e,(t=r||t===i?1:ya(t))<0?0:t,n):[]},$r.dropRight=function(e,t,r){var n=null==e?0:e.length;return n?ii(e,0,(t=n-(t=r||t===i?1:ya(t)))<0?0:t):[]},$r.dropRightWhile=function(e,t){return e&&e.length?pi(e,us(t,3),!0,!0):[]},$r.dropWhile=function(e,t){return e&&e.length?pi(e,us(t,3),!0):[]},$r.fill=function(e,t,r,n){var s=null==e?0:e.length;return s?(r&&"number"!=typeof r&&vs(e,t,r)&&(r=0,n=s),function(e,t,r,n){var s=e.length;for((r=ya(r))<0&&(r=-r>s?0:s+r),(n=n===i||n>s?s:ya(n))<0&&(n+=s),n=r>n?0:ga(n);r<n;)e[r++]=t;return e}(e,t,r,n)):[]},$r.filter=function(e,t){return(Fo(e)?Dt:mn)(e,us(t,3))},$r.flatMap=function(e,t){return bn(So(e,t),1)},$r.flatMapDeep=function(e,t){return bn(So(e,t),f)},$r.flatMapDepth=function(e,t,r){return r=r===i?1:ya(r),bn(So(e,t),r)},$r.flatten=Fs,$r.flattenDeep=function(e){return(null==e?0:e.length)?bn(e,f):[]},$r.flattenDepth=function(e,t){return(null==e?0:e.length)?bn(e,t=t===i?1:ya(t)):[]},$r.flip=function(e){return Zi(e,512)},$r.flow=rc,$r.flowRight=nc,$r.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},$r.functions=function(e){return null==e?[]:An(e,Da(e))},$r.functionsIn=function(e){return null==e?[]:An(e,Oa(e))},$r.groupBy=Eo,$r.initial=function(e){return(null==e?0:e.length)?ii(e,0,-1):[]},$r.intersection=Hs,$r.intersectionBy=Ws,$r.intersectionWith=Ys,$r.invert=Ca,$r.invertBy=Ta,$r.invokeMap=_o,$r.iteratee=sc,$r.keyBy=Ao,$r.keys=Da,$r.keysIn=Oa,$r.map=So,$r.mapKeys=function(e,t){var r={};return t=us(t,3),En(e,(function(e,n,i){on(r,t(e,n,i),e)})),r},$r.mapValues=function(e,t){var r={};return t=us(t,3),En(e,(function(e,n,i){on(r,n,t(e,n,i))})),r},$r.matches=function(e){return Vn(un(e,1))},$r.matchesProperty=function(e,t){return jn(e,un(t,1))},$r.memoize=Lo,$r.merge=Na,$r.mergeWith=La,$r.method=oc,$r.methodOf=ac,$r.mixin=cc,$r.negate=Uo,$r.nthArg=function(e){return e=ya(e),Jn((function(t){return qn(t,e)}))},$r.omit=Ua,$r.omitBy=function(e,t){return Ba(e,Uo(us(t)))},$r.once=function(e){return Co(2,e)},$r.orderBy=function(e,t,r,n){return null==e?[]:(Fo(t)||(t=null==t?[]:[t]),Fo(r=n?i:r)||(r=null==r?[]:[r]),Fn(e,t,r))},$r.over=lc,$r.overArgs=Mo,$r.overEvery=hc,$r.overSome=dc,$r.partial=Bo,$r.partialRight=Ko,$r.partition=Ro,$r.pick=Ma,$r.pickBy=Ba,$r.property=fc,$r.propertyOf=function(e){return function(t){return null==e?i:Sn(e,t)}},$r.pull=Js,$r.pullAll=Zs,$r.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Hn(e,t,us(r,2)):e},$r.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?Hn(e,t,i,r):e},$r.pullAt=Xs,$r.range=pc,$r.rangeRight=yc,$r.rearg=$o,$r.reject=function(e,t){return(Fo(e)?Dt:mn)(e,Uo(us(t,3)))},$r.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],s=e.length;for(t=us(t,3);++n<s;){var o=e[n];t(o,n,e)&&(r.push(o),i.push(n))}return Wn(e,i),r},$r.rest=function(e,t){if("function"!=typeof e)throw new Te(s);return Jn(e,t=t===i?t:ya(t))},$r.reverse=eo,$r.sampleSize=function(e,t,r){return t=(r?vs(e,t,r):t===i)?1:ya(t),(Fo(e)?Zr:Xn)(e,t)},$r.set=function(e,t,r){return null==e?e:ei(e,t,r)},$r.setWith=function(e,t,r,n){return n="function"==typeof n?n:i,null==e?e:ei(e,t,r,n)},$r.shuffle=function(e){return(Fo(e)?Xr:ni)(e)},$r.slice=function(e,t,r){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&vs(e,t,r)?(t=0,r=n):(t=null==t?0:ya(t),r=r===i?n:ya(r)),ii(e,t,r)):[]},$r.sortBy=Io,$r.sortedUniq=function(e){return e&&e.length?ci(e):[]},$r.sortedUniqBy=function(e,t){return e&&e.length?ci(e,us(t,2)):[]},$r.split=function(e,t,r){return r&&"number"!=typeof r&&vs(e,t,r)&&(t=r=i),(r=r===i?g:r>>>0)?(e=wa(e))&&("string"==typeof t||null!=t&&!oa(t))&&!(t=li(t))&&ar(e)?_i(pr(e),0,r):e.split(t,r):[]},$r.spread=function(e,t){if("function"!=typeof e)throw new Te(s);return t=null==t?0:br(ya(t),0),Jn((function(r){var n=r[t],i=_i(r,0,t);return n&&Ut(i,n),xt(e,this,i)}))},$r.tail=function(e){var t=null==e?0:e.length;return t?ii(e,1,t):[]},$r.take=function(e,t,r){return e&&e.length?ii(e,0,(t=r||t===i?1:ya(t))<0?0:t):[]},$r.takeRight=function(e,t,r){var n=null==e?0:e.length;return n?ii(e,(t=n-(t=r||t===i?1:ya(t)))<0?0:t,n):[]},$r.takeRightWhile=function(e,t){return e&&e.length?pi(e,us(t,3),!1,!0):[]},$r.takeWhile=function(e,t){return e&&e.length?pi(e,us(t,3)):[]},$r.tap=function(e,t){return t(e),e},$r.throttle=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new Te(s);return ta(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),Do(e,t,{leading:n,maxWait:t,trailing:i})},$r.thru=po,$r.toArray=fa,$r.toPairs=Ka,$r.toPairsIn=$a,$r.toPath=function(e){return Fo(e)?Lt(e,Ms):ua(e)?[e]:Ti(Us(wa(e)))},$r.toPlainObject=ba,$r.transform=function(e,t,r){var n=Fo(e),i=n||Yo(e)||la(e);if(t=us(t,4),null==r){var s=e&&e.constructor;r=i?n?new s:[]:ta(e)&&Zo(s)?Vr(He(e)):{}}return(i?Ct:En)(e,(function(e,n,i){return t(r,e,n,i)})),r},$r.unary=function(e){return Po(e,1)},$r.union=to,$r.unionBy=ro,$r.unionWith=no,$r.uniq=function(e){return e&&e.length?hi(e):[]},$r.uniqBy=function(e,t){return e&&e.length?hi(e,us(t,2)):[]},$r.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?hi(e,i,t):[]},$r.unset=function(e,t){return null==e||di(e,t)},$r.unzip=io,$r.unzipWith=so,$r.update=function(e,t,r){return null==e?e:fi(e,t,wi(r))},$r.updateWith=function(e,t,r,n){return n="function"==typeof n?n:i,null==e?e:fi(e,t,wi(r),n)},$r.values=Va,$r.valuesIn=function(e){return null==e?[]:er(e,Oa(e))},$r.without=oo,$r.words=Za,$r.wrap=function(e,t){return Bo(wi(t),e)},$r.xor=ao,$r.xorBy=co,$r.xorWith=uo,$r.zip=lo,$r.zipObject=function(e,t){return mi(e||[],t||[],tn)},$r.zipObjectDeep=function(e,t){return mi(e||[],t||[],ei)},$r.zipWith=ho,$r.entries=Ka,$r.entriesIn=$a,$r.extend=Ea,$r.extendWith=_a,cc($r,$r),$r.add=bc,$r.attempt=Xa,$r.camelCase=ja,$r.capitalize=za,$r.ceil=wc,$r.clamp=function(e,t,r){return r===i&&(r=t,t=i),r!==i&&(r=(r=ma(r))==r?r:0),t!==i&&(t=(t=ma(t))==t?t:0),cn(ma(e),t,r)},$r.clone=function(e){return un(e,4)},$r.cloneDeep=function(e){return un(e,5)},$r.cloneDeepWith=function(e,t){return un(e,5,t="function"==typeof t?t:i)},$r.cloneWith=function(e,t){return un(e,4,t="function"==typeof t?t:i)},$r.conformsTo=function(e,t){return null==t||ln(e,t,Da(t))},$r.deburr=qa,$r.defaultTo=function(e,t){return null==e||e!=e?t:e},$r.divide=vc,$r.endsWith=function(e,t,r){e=wa(e),t=li(t);var n=e.length,s=r=r===i?n:cn(ya(r),0,n);return(r-=t.length)>=0&&e.slice(r,s)==t},$r.eq=Vo,$r.escape=function(e){return(e=wa(e))&&J.test(e)?e.replace(Y,sr):e},$r.escapeRegExp=function(e){return(e=wa(e))&&se.test(e)?e.replace(ie,"\\$&"):e},$r.every=function(e,t,r){var n=Fo(e)?kt:yn;return r&&vs(e,t,r)&&(t=i),n(e,us(t,3))},$r.find=mo,$r.findIndex=zs,$r.findKey=function(e,t){return Vt(e,us(t,3),En)},$r.findLast=bo,$r.findLastIndex=qs,$r.findLastKey=function(e,t){return Vt(e,us(t,3),_n)},$r.floor=Ec,$r.forEach=wo,$r.forEachRight=vo,$r.forIn=function(e,t){return null==e?e:wn(e,us(t,3),Oa)},$r.forInRight=function(e,t){return null==e?e:vn(e,us(t,3),Oa)},$r.forOwn=function(e,t){return e&&En(e,us(t,3))},$r.forOwnRight=function(e,t){return e&&_n(e,us(t,3))},$r.get=xa,$r.gt=jo,$r.gte=zo,$r.has=function(e,t){return null!=e&&gs(e,t,Pn)},$r.hasIn=Pa,$r.head=Gs,$r.identity=ic,$r.includes=function(e,t,r,n){e=Ho(e)?e:Va(e),r=r&&!n?ya(r):0;var i=e.length;return r<0&&(r=br(i+r,0)),ca(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&zt(e,t,r)>-1},$r.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:ya(r);return i<0&&(i=br(n+i,0)),zt(e,t,i)},$r.inRange=function(e,t,r){return t=pa(t),r===i?(r=t,t=0):r=pa(r),function(e,t,r){return e>=wr(t,r)&&e<br(t,r)}(e=ma(e),t,r)},$r.invoke=ka,$r.isArguments=qo,$r.isArray=Fo,$r.isArrayBuffer=Go,$r.isArrayLike=Ho,$r.isArrayLikeObject=Wo,$r.isBoolean=function(e){return!0===e||!1===e||ra(e)&&In(e)==v},$r.isBuffer=Yo,$r.isDate=Qo,$r.isElement=function(e){return ra(e)&&1===e.nodeType&&!sa(e)},$r.isEmpty=function(e){if(null==e)return!0;if(Ho(e)&&(Fo(e)||"string"==typeof e||"function"==typeof e.splice||Yo(e)||la(e)||qo(e)))return!e.length;var t=ys(e);if(t==R||t==T)return!e.size;if(Ss(e))return!Mn(e).length;for(var r in e)if(Ue.call(e,r))return!1;return!0},$r.isEqual=function(e,t){return On(e,t)},$r.isEqualWith=function(e,t,r){var n=(r="function"==typeof r?r:i)?r(e,t):i;return n===i?On(e,t,i,r):!!n},$r.isError=Jo,$r.isFinite=function(e){return"number"==typeof e&&vt(e)},$r.isFunction=Zo,$r.isInteger=Xo,$r.isLength=ea,$r.isMap=na,$r.isMatch=function(e,t){return e===t||Nn(e,t,hs(t))},$r.isMatchWith=function(e,t,r){return r="function"==typeof r?r:i,Nn(e,t,hs(t),r)},$r.isNaN=function(e){return ia(e)&&e!=+e},$r.isNative=function(e){if(As(e))throw new Se("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ln(e)},$r.isNil=function(e){return null==e},$r.isNull=function(e){return null===e},$r.isNumber=ia,$r.isObject=ta,$r.isObjectLike=ra,$r.isPlainObject=sa,$r.isRegExp=oa,$r.isSafeInteger=function(e){return Xo(e)&&e>=-9007199254740991&&e<=p},$r.isSet=aa,$r.isString=ca,$r.isSymbol=ua,$r.isTypedArray=la,$r.isUndefined=function(e){return e===i},$r.isWeakMap=function(e){return ra(e)&&ys(e)==O},$r.isWeakSet=function(e){return ra(e)&&"[object WeakSet]"==In(e)},$r.join=function(e,t){return null==e?"":$t.call(e,t)},$r.kebabCase=Fa,$r.last=Qs,$r.lastIndexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var s=n;return r!==i&&(s=(s=ya(r))<0?br(n+s,0):wr(s,n-1)),t==t?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(e,t,s):jt(e,Ft,s,!0)},$r.lowerCase=Ga,$r.lowerFirst=Ha,$r.lt=ha,$r.lte=da,$r.max=function(e){return e&&e.length?gn(e,ic,xn):i},$r.maxBy=function(e,t){return e&&e.length?gn(e,us(t,2),xn):i},$r.mean=function(e){return Gt(e,ic)},$r.meanBy=function(e,t){return Gt(e,us(t,2))},$r.min=function(e){return e&&e.length?gn(e,ic,Kn):i},$r.minBy=function(e,t){return e&&e.length?gn(e,us(t,2),Kn):i},$r.stubArray=gc,$r.stubFalse=mc,$r.stubObject=function(){return{}},$r.stubString=function(){return""},$r.stubTrue=function(){return!0},$r.multiply=Ac,$r.nth=function(e,t){return e&&e.length?qn(e,ya(t)):i},$r.noConflict=function(){return yt._===this&&(yt._=Ve),this},$r.noop=uc,$r.now=xo,$r.pad=function(e,t,r){e=wa(e);var n=(t=ya(t))?fr(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return Fi(gt(i),r)+e+Fi(pt(i),r)},$r.padEnd=function(e,t,r){e=wa(e);var n=(t=ya(t))?fr(e):0;return t&&n<t?e+Fi(t-n,r):e},$r.padStart=function(e,t,r){e=wa(e);var n=(t=ya(t))?fr(e):0;return t&&n<t?Fi(t-n,r)+e:e},$r.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),Er(wa(e).replace(oe,""),t||0)},$r.random=function(e,t,r){if(r&&"boolean"!=typeof r&&vs(e,t,r)&&(t=r=i),r===i&&("boolean"==typeof t?(r=t,t=i):"boolean"==typeof e&&(r=e,e=i)),e===i&&t===i?(e=0,t=1):(e=pa(e),t===i?(t=e,e=0):t=pa(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var s=_r();return wr(e+s*(t-e+ht("1e-"+((s+"").length-1))),t)}return Yn(e,t)},$r.reduce=function(e,t,r){var n=Fo(e)?Mt:Yt,i=arguments.length<3;return n(e,us(t,4),r,i,fn)},$r.reduceRight=function(e,t,r){var n=Fo(e)?Bt:Yt,i=arguments.length<3;return n(e,us(t,4),r,i,pn)},$r.repeat=function(e,t,r){return t=(r?vs(e,t,r):t===i)?1:ya(t),Qn(wa(e),t)},$r.replace=function(){var e=arguments,t=wa(e[0]);return e.length<3?t:t.replace(e[1],e[2])},$r.result=function(e,t,r){var n=-1,s=(t=vi(t,e)).length;for(s||(s=1,e=i);++n<s;){var o=null==e?i:e[Ms(t[n])];o===i&&(n=s,o=r),e=Zo(o)?o.call(e):o}return e},$r.round=Sc,$r.runInContext=e,$r.sample=function(e){return(Fo(e)?Jr:Zn)(e)},$r.size=function(e){if(null==e)return 0;if(Ho(e))return ca(e)?fr(e):e.length;var t=ys(e);return t==R||t==T?e.size:Mn(e).length},$r.snakeCase=Wa,$r.some=function(e,t,r){var n=Fo(e)?Kt:si;return r&&vs(e,t,r)&&(t=i),n(e,us(t,3))},$r.sortedIndex=function(e,t){return oi(e,t)},$r.sortedIndexBy=function(e,t,r){return ai(e,t,us(r,2))},$r.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=oi(e,t);if(n<r&&Vo(e[n],t))return n}return-1},$r.sortedLastIndex=function(e,t){return oi(e,t,!0)},$r.sortedLastIndexBy=function(e,t,r){return ai(e,t,us(r,2),!0)},$r.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var r=oi(e,t,!0)-1;if(Vo(e[r],t))return r}return-1},$r.startCase=Ya,$r.startsWith=function(e,t,r){return e=wa(e),r=null==r?0:cn(ya(r),0,e.length),t=li(t),e.slice(r,r+t.length)==t},$r.subtract=Rc,$r.sum=function(e){return e&&e.length?Qt(e,ic):0},$r.sumBy=function(e,t){return e&&e.length?Qt(e,us(t,2)):0},$r.template=function(e,t,r){var n=$r.templateSettings;r&&vs(e,t,r)&&(t=i),e=wa(e),t=_a({},t,n,Xi);var s,o,a=_a({},t.imports,n.imports,Xi),c=Da(a),u=er(a,c),l=0,h=t.interpolate||_e,d="__p += '",f=Pe((t.escape||_e).source+"|"+h.source+"|"+(h===ee?pe:_e).source+"|"+(t.evaluate||_e).source+"|$","g"),p="//# sourceURL="+(Ue.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++at+"]")+"\n";e.replace(f,(function(t,r,n,i,a,c){return n||(n=i),d+=e.slice(l,c).replace(Ae,or),r&&(s=!0,d+="' +\n__e("+r+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),n&&(d+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),l=c+t.length,t})),d+="';\n";var y=Ue.call(t,"variable")&&t.variable;if(y){if(de.test(y))throw new Se("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(F,""):d).replace(G,"$1").replace(H,"$1;"),d="function("+(y||"obj")+") {\n"+(y?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Xa((function(){return Re(c,p+"return "+d).apply(i,u)}));if(g.source=d,Jo(g))throw g;return g},$r.times=function(e,t){if((e=ya(e))<1||e>p)return[];var r=g,n=wr(e,g);t=us(t),e-=g;for(var i=Jt(n,t);++r<e;)t(r);return i},$r.toFinite=pa,$r.toInteger=ya,$r.toLength=ga,$r.toLower=function(e){return wa(e).toLowerCase()},$r.toNumber=ma,$r.toSafeInteger=function(e){return e?cn(ya(e),-9007199254740991,p):0===e?e:0},$r.toString=wa,$r.toUpper=function(e){return wa(e).toUpperCase()},$r.trim=function(e,t,r){if((e=wa(e))&&(r||t===i))return Zt(e);if(!e||!(t=li(t)))return e;var n=pr(e),s=pr(t);return _i(n,rr(n,s),nr(n,s)+1).join("")},$r.trimEnd=function(e,t,r){if((e=wa(e))&&(r||t===i))return e.slice(0,yr(e)+1);if(!e||!(t=li(t)))return e;var n=pr(e);return _i(n,0,nr(n,pr(t))+1).join("")},$r.trimStart=function(e,t,r){if((e=wa(e))&&(r||t===i))return e.replace(oe,"");if(!e||!(t=li(t)))return e;var n=pr(e);return _i(n,rr(n,pr(t))).join("")},$r.truncate=function(e,t){var r=30,n="...";if(ta(t)){var s="separator"in t?t.separator:s;r="length"in t?ya(t.length):r,n="omission"in t?li(t.omission):n}var o=(e=wa(e)).length;if(ar(e)){var a=pr(e);o=a.length}if(r>=o)return e;var c=r-fr(n);if(c<1)return n;var u=a?_i(a,0,c).join(""):e.slice(0,c);if(s===i)return u+n;if(a&&(c+=u.length-c),oa(s)){if(e.slice(c).search(s)){var l,h=u;for(s.global||(s=Pe(s.source,wa(ye.exec(s))+"g")),s.lastIndex=0;l=s.exec(h);)var d=l.index;u=u.slice(0,d===i?c:d)}}else if(e.indexOf(li(s),c)!=c){var f=u.lastIndexOf(s);f>-1&&(u=u.slice(0,f))}return u+n},$r.unescape=function(e){return(e=wa(e))&&Q.test(e)?e.replace(W,gr):e},$r.uniqueId=function(e){var t=++Me;return wa(e)+t},$r.upperCase=Qa,$r.upperFirst=Ja,$r.each=wo,$r.eachRight=vo,$r.first=Gs,cc($r,(_c={},En($r,(function(e,t){Ue.call($r.prototype,t)||(_c[t]=e)})),_c),{chain:!1}),$r.VERSION="4.17.21",Ct(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){$r[e].placeholder=$r})),Ct(["drop","take"],(function(e,t){qr.prototype[e]=function(r){r=r===i?1:br(ya(r),0);var n=this.__filtered__&&!t?new qr(this):this.clone();return n.__filtered__?n.__takeCount__=wr(r,n.__takeCount__):n.__views__.push({size:wr(r,g),type:e+(n.__dir__<0?"Right":"")}),n},qr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Ct(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;qr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:us(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),Ct(["head","last"],(function(e,t){var r="take"+(t?"Right":"");qr.prototype[e]=function(){return this[r](1).value()[0]}})),Ct(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");qr.prototype[e]=function(){return this.__filtered__?new qr(this):this[r](1)}})),qr.prototype.compact=function(){return this.filter(ic)},qr.prototype.find=function(e){return this.filter(e).head()},qr.prototype.findLast=function(e){return this.reverse().find(e)},qr.prototype.invokeMap=Jn((function(e,t){return"function"==typeof e?new qr(this):this.map((function(r){return kn(r,e,t)}))})),qr.prototype.reject=function(e){return this.filter(Uo(us(e)))},qr.prototype.slice=function(e,t){e=ya(e);var r=this;return r.__filtered__&&(e>0||t<0)?new qr(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==i&&(r=(t=ya(t))<0?r.dropRight(-t):r.take(t-e)),r)},qr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},qr.prototype.toArray=function(){return this.take(g)},En(qr.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),s=$r[n?"take"+("last"==t?"Right":""):t],o=n||/^find/.test(t);s&&($r.prototype[t]=function(){var t=this.__wrapped__,a=n?[1]:arguments,c=t instanceof qr,u=a[0],l=c||Fo(t),h=function(e){var t=s.apply($r,Ut([e],a));return n&&d?t[0]:t};l&&r&&"function"==typeof u&&1!=u.length&&(c=l=!1);var d=this.__chain__,f=!!this.__actions__.length,p=o&&!d,y=c&&!f;if(!o&&l){t=y?t:new qr(this);var g=e.apply(t,a);return g.__actions__.push({func:po,args:[h],thisArg:i}),new zr(g,d)}return p&&y?e.apply(this,a):(g=this.thru(h),p?n?g.value()[0]:g.value():g)})})),Ct(["pop","push","shift","sort","splice","unshift"],(function(e){var t=ke[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);$r.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply(Fo(i)?i:[],e)}return this[r]((function(r){return t.apply(Fo(r)?r:[],e)}))}})),En(qr.prototype,(function(e,t){var r=$r[t];if(r){var n=r.name+"";Ue.call(kr,n)||(kr[n]=[]),kr[n].push({name:t,func:r})}})),kr[Vi(i,2).name]=[{name:"wrapper",func:i}],qr.prototype.clone=function(){var e=new qr(this.__wrapped__);return e.__actions__=Ti(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ti(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ti(this.__views__),e},qr.prototype.reverse=function(){if(this.__filtered__){var e=new qr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},qr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=Fo(e),n=t<0,i=r?e.length:0,s=function(e,t,r){var n=-1,i=r.length;for(;++n<i;){var s=r[n],o=s.size;switch(s.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=wr(t,e+o);break;case"takeRight":e=br(e,t-o)}}return{start:e,end:t}}(0,i,this.__views__),o=s.start,a=s.end,c=a-o,u=n?a:o-1,l=this.__iteratees__,h=l.length,d=0,f=wr(c,this.__takeCount__);if(!r||!n&&i==c&&f==c)return yi(e,this.__actions__);var p=[];e:for(;c--&&d<f;){for(var y=-1,g=e[u+=t];++y<h;){var m=l[y],b=m.iteratee,w=m.type,v=b(g);if(2==w)g=v;else if(!v){if(1==w)continue e;break e}}p[d++]=g}return p},$r.prototype.at=yo,$r.prototype.chain=function(){return fo(this)},$r.prototype.commit=function(){return new zr(this.value(),this.__chain__)},$r.prototype.next=function(){this.__values__===i&&(this.__values__=fa(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},$r.prototype.plant=function(e){for(var t,r=this;r instanceof jr;){var n=Ks(r);n.__index__=0,n.__values__=i,t?s.__wrapped__=n:t=n;var s=n;r=r.__wrapped__}return s.__wrapped__=e,t},$r.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof qr){var t=e;return this.__actions__.length&&(t=new qr(this)),(t=t.reverse()).__actions__.push({func:po,args:[eo],thisArg:i}),new zr(t,this.__chain__)}return this.thru(eo)},$r.prototype.toJSON=$r.prototype.valueOf=$r.prototype.value=function(){return yi(this.__wrapped__,this.__actions__)},$r.prototype.first=$r.prototype.head,Ze&&($r.prototype[Ze]=function(){return this}),$r}();yt._=mr,(n=function(){return mr}.call(t,r,t,e))===i||(e.exports=n)}.call(this)},50308:function(e){e.exports=function(){}},70942:function(e,t,r){"use strict";const n=r(49727),{hasOwnProperty:i}=Object.prototype,{propertyIsEnumerable:s}=Object,o=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),a=this,c={concatArrays:!1,ignoreUndefined:!1},u=e=>{const t=[];for(const r in e)i.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(e);for(const n of r)s.call(e,n)&&t.push(n)}return t};function l(e){return Array.isArray(e)?function(e){const t=e.slice(0,0);return u(e).forEach((r=>{o(t,r,l(e[r]))})),t}(e):n(e)?function(e){const t=null===Object.getPrototypeOf(e)?Object.create(null):{};return u(e).forEach((r=>{o(t,r,l(e[r]))})),t}(e):e}const h=(e,t,r,n)=>(r.forEach((r=>{void 0===t[r]&&n.ignoreUndefined||(r in e&&e[r]!==Object.getPrototypeOf(e)?o(e,r,f(e[r],t[r],n)):o(e,r,l(t[r])))})),e),d=(e,t,r)=>{let n=e.slice(0,0),s=0;return[e,t].forEach((t=>{const a=[];for(let r=0;r<t.length;r++)i.call(t,r)&&(a.push(String(r)),o(n,s++,t===e?t[r]:l(t[r])));n=h(n,t,u(t).filter((e=>!a.includes(e))),r)})),n};function f(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?d(e,t,r):n(t)&&n(e)?h(e,t,u(t),r):l(t)}e.exports=function(...e){const t=f(l(c),this!==a&&this||{},c);let r={_:{}};for(const i of e)if(void 0!==i){if(!n(i))throw new TypeError("`"+i+"` is not an Option Object");r=f(r,{_:i},t)}return r._}},79221:function(e,t,r){"use strict";var n=r(70942),i=r.n(n);t.Z=i()},49727:function(e){"use strict";e.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},31648:function(e){"use strict";e.exports=class extends Error{constructor(e,t){super(e||""),"object"==typeof t&&null!==t&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},44913:function(e,t,r){"use strict";r.d(t,{U:function(){return Xt}});var n={};r.r(n),r.d(n,{base32:function(){return T},base32hex:function(){return N},base32hexpad:function(){return U},base32hexpadupper:function(){return M},base32hexupper:function(){return L},base32pad:function(){return D},base32padupper:function(){return O},base32upper:function(){return k},base32z:function(){return B}});var i={};r.r(i),r.d(i,{base58btc:function(){return K},base58flickr:function(){return $}});var s={};r.r(s),r.d(s,{base64:function(){return V},base64pad:function(){return j},base64url:function(){return z},base64urlpad:function(){return q}});var o={};r.r(o),r.d(o,{base10:function(){return H}});var a={};r.r(a),r.d(a,{base16:function(){return W},base16upper:function(){return Y}});var c={};r.r(c),r.d(c,{base2:function(){return Q}});var u={};r.r(u),r.d(u,{base256emoji:function(){return ee}});var l={};r.r(l),r.d(l,{base36:function(){return te},base36upper:function(){return re}});var h={};r.r(h),r.d(h,{base8:function(){return ne}});var d={};r.r(d),r.d(d,{identity:function(){return ie}});var f={};r.r(f),r.d(f,{code:function(){return ce},decode:function(){return le},encode:function(){return ue},name:function(){return ae}});var p={};r.r(p),r.d(p,{code:function(){return de},decode:function(){return pe},encode:function(){return fe},name:function(){return he}});var y={};r.r(y),r.d(y,{identity:function(){return Ke}});var g={};r.r(g),r.d(g,{sha256:function(){return ze},sha512:function(){return qe}});var m=r(23247),b=r(85521),w=r(11227);var v=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const E=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class _{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class A{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return R(this,e)}}class S{constructor(e){this.decoders=e}or(e){return R(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const R=(e,t)=>new S({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class I{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new _(e,t,r),this.decoder=new A(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const x=({name:e,prefix:t,encode:r,decode:n})=>new I(e,t,r,n),P=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=v(r,t);return x({prefix:e,name:t,encode:n,decode:e=>E(i(e))})},C=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>x({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),T=C({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),k=C({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),D=C({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),O=C({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),N=C({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),L=C({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),U=C({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),M=C({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),B=C({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),K=P({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),$=P({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),V=C({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),j=C({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),z=C({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),q=C({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});w.formatters.b=e=>null==e?"undefined":K.baseEncode(e),w.formatters.t=e=>null==e?"undefined":T.baseEncode(e),w.formatters.m=e=>null==e?"undefined":V.baseEncode(e),w.formatters.p=e=>null==e?"undefined":e.toString(),w.formatters.c=e=>null==e?"undefined":e.toString(),w.formatters.k=e=>null==e?"undefined":e.toString(),w.formatters.a=e=>null==e?"undefined":e.toString();var F=r(49541),G=r(5681);const H=P({prefix:"9",name:"base10",alphabet:"0123456789"}),W=C({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Y=C({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Q=C({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),J=Array.from(""),Z=J.reduce(((e,t,r)=>(e[r]=t,e)),[]),X=J.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const ee=x({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Z[t]),"")},decode:function(e){const t=[];for(const r of e){const e=X[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),te=P({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),re=P({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ne=C({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ie=x({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),se=new TextEncoder,oe=new TextDecoder,ae="json",ce=512,ue=e=>se.encode(JSON.stringify(e)),le=e=>JSON.parse(oe.decode(e)),he="raw",de=85,fe=e=>E(e),pe=e=>E(e);var ye=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=be;)r[n++]=255&t|ge,t/=128;for(;t&me;)r[n++]=255&t|ge,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},ge=128,me=-128,be=Math.pow(2,31);var we=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Ee)<<s:(n&Ee)*Math.pow(2,s),s+=7}while(n>=ve);return e.bytes=o-r,i},ve=128,Ee=127;var _e=Math.pow(2,7),Ae=Math.pow(2,14),Se=Math.pow(2,21),Re=Math.pow(2,28),Ie=Math.pow(2,35),xe=Math.pow(2,42),Pe=Math.pow(2,49),Ce=Math.pow(2,56),Te=Math.pow(2,63),ke={encode:ye,decode:we,encodingLength:function(e){return e<_e?1:e<Ae?2:e<Se?3:e<Re?4:e<Ie?5:e<xe?6:e<Pe?7:e<Ce?8:e<Te?9:10}};const De=(e,t=0)=>[ke.decode(e,t),ke.decode.bytes],Oe=(e,t,r=0)=>(ke.encode(e,t,r),t),Ne=e=>ke.encodingLength(e),Le=(e,t)=>{const r=t.byteLength,n=Ne(e),i=n+Ne(r),s=new Uint8Array(i+r);return Oe(e,s,0),Oe(r,s,n),s.set(t,i),new Me(e,r,t,s)},Ue=e=>{const t=E(e),[r,n]=De(t),[i,s]=De(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Me(r,i,o,t)};class Me{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Be=E,Ke={code:0,name:"identity",encode:Be,digest:e=>Le(0,Be(e))},$e=({name:e,code:t,encode:r})=>new Ve(e,t,r);class Ve{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Le(this.code,t):t.then((e=>Le(this.code,e)))}throw Error("Unknown type, must be binary type")}}const je=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),ze=$e({name:"sha2-256",code:18,encode:je("SHA-256")}),qe=$e({name:"sha2-512",code:19,encode:je("SHA-512")}),Fe=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Qe(r,He(e),t||K.encoder):Je(r,He(e),t||T.encoder)},Ge=new WeakMap,He=e=>{const t=Ge.get(e);if(null==t){const t=new Map;return Ge.set(e,t),t}return t};class We{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Ze)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Xe)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return We.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Le(e,t);return We.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return We.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return Fe(this,e)}toJSON(){return{"/":Fe(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof We)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new We(e,r,n,i||et(e,r,n.bytes))}if(!0===t[tt]){const{version:e,multihash:r,code:n}=t,i=Ue(r);return We.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Ze)throw new Error(`Version 0 CID must use dag-pb (code: ${Ze}) block encoding`);return new We(e,t,r,r.bytes);case 1:{const n=et(e,t,r.bytes);return new We(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return We.create(0,Ze,e)}static createV1(e,t){return We.create(1,e,t)}static decode(e){const[t,r]=We.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=We.inspectBytes(e),r=t.size-t.multihashSize,n=E(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Me(t.multihashCode,t.digestSize,i,n);return[0===t.version?We.createV0(s):We.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=De(e.subarray(t));return t+=n,r};let n=r(),i=Ze;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Ye(e,t),i=We.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return He(i).set(r,e),i}}const Ye=(e,t)=>{switch(e[0]){case"Q":{const r=t||K;return[K.prefix,r.decode(`${K.prefix}${e}`)]}case K.prefix:{const r=t||K;return[K.prefix,r.decode(e)]}case T.prefix:{const r=t||T;return[T.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Qe=(e,t,r)=>{const{prefix:n}=r;if(n!==K.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Je=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},Ze=112,Xe=18,et=(e,t,r)=>{const n=Ne(e),i=n+Ne(t),s=new Uint8Array(i+r.byteLength);return Oe(e,s,0),Oe(t,s,n),s.set(r,i),s},tt=Symbol.for("@ipld/js-cid/CID"),rt={...d,...c,...h,...o,...a,...n,...l,...i,...s,...u};function nt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const it=Symbol.for("nodejs.util.inspect.custom"),st=Object.values(rt).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),rt.identity.decoder),ot=114,at=36,ct=37;class ut{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[G.N]=!0;toString(){return null==this.string&&(this.string=K.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return We.createV1(ot,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return nt(this.multihash.bytes,e);if("string"==typeof e)return ft(e).equals(this);if(null!=e?.multihash?.bytes)return nt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[it](){return`PeerId(${this.toString()})`}}class lt extends ut{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class ht extends ut{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class dt extends ut{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function ft(e,t){if(t=t??st,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Ue(K.decode(`z${e}`));return e.startsWith("12D")?new ht({multihash:t}):e.startsWith("16U")?new dt({multihash:t}):new lt({multihash:t})}return function(e){try{const t=Ue(e);if(t.code===Ke.code){if(t.digest.length===at)return new ht({multihash:t});if(t.digest.length===ct)return new dt({multihash:t})}if(t.code===ze.code)return new lt({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==ot)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===ze.code)return new lt({multihash:e.multihash});if(t.code===Ke.code){if(t.digest.length===at)return new ht({multihash:e.multihash});if(t.digest.length===ct)return new dt({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(We.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(st.decode(e))}var pt=r(61093),yt=r(73062),gt=r(49784),mt=r(57050),bt=r(41690),wt=(r(9839),r(77408)),vt=r(49736);const Et=vt.C,_t=vt.aY,At=function(e){let t=0;if(e=e.toString().trim(),Et(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(_t(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;Et(r[n])&&(e=At(r[n]),r[n]=(0,gt.B)(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,(0,gt.B)(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},St=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Rt=-1,It={},xt={};function Pt(e){if("number"==typeof e){if(null!=xt[e])return xt[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=It[e])return It[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Rt,"ip6zone"],[43,8,"ipcidr"],[53,Rt,"dns",!0],[54,Rt,"dns4",!0],[55,Rt,"dns6",!0],[56,Rt,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Rt,"unix",!1,!0],[421,Rt,"ipfs"],[421,Rt,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Rt,"garlic64"],[448,0,"tls"],[449,Rt,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Rt,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Rt,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);xt[t.code]=t,It[t.name]=t}));Pt("ip4"),Pt("ip6"),Pt("ipcidr");function Ct(e,t){switch(Pt(e).code){case 4:case 41:return function(e){const t=St(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!vt.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Mt(t);case 6:case 273:case 33:case 132:return Lt(t).toString();case 421:return function(e){const t=mt.Jx(e),r=e.slice(mt.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return(0,gt.B)(r,"base58btc")}(t);case 444:case 445:return Bt(t);case 466:return function(e){const t=mt.Jx(e),r=e.slice(mt.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+(0,gt.B)(r,"base64url")}(t);default:return(0,gt.B)(t,"base16")}}function Tt(e,t){switch(Pt(e).code){case 4:case 41:return Ot(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Ut(t);case 6:case 273:case 33:case 132:return Nt(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?Ue(K.decode(`z${e}`)).bytes:We.parse(e).multihash.bytes;const r=Uint8Array.from(mt.cv(t.length));return(0,bt.z)([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=T.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Nt(n);return(0,bt.z)([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=T.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Nt(n);return(0,bt.z)([r,i],r.length+i.length)}(t);case 466:return function(e){const t=Dt.decode(e),r=Uint8Array.from(mt.cv(t.length));return(0,bt.z)([r,t],r.length+t.length)}(t);default:return(0,wt.m)(t,"base16")}}const kt=Object.values(rt).map((e=>e.decoder)),Dt=function(){let e=kt[0].or(kt[1]);return kt.slice(2).forEach((t=>e=e.or(t))),e}();function Ot(e){if(!vt.h6(e))throw new Error("invalid ip address");return At(e)}function Nt(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function Lt(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Ut(e){const t=(0,wt.m)(e),r=Uint8Array.from(mt.cv(t.length));return(0,bt.z)([r,t],r.length+t.length)}function Mt(e){const t=mt.Jx(e);if((e=e.slice(mt.P$(t))).length!==t)throw new Error("inconsistent lengths");return(0,gt.B)(e)}function Bt(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${(0,gt.B)(t,"base32")}:${Lt(r)}`}function Kt(e){const t=[],r=[];let n=null,i=0;for(;i<e.length;){const s=mt.Jx(e,i),o=mt.P$(s),a=Pt(s),c=jt(a,e.slice(i+o));if(0===c){t.push([s]),r.push([s]),i+=o;continue}const u=e.slice(i+o,i+o+c);if(i+=c+o,i>e.length)throw qt("Invalid address Uint8Array: "+(0,gt.B)(e,"base16"));t.push([s,u]);const l=Ct(s,u);if(r.push([s,l]),!0===a.path){n=l;break}}return{bytes:Uint8Array.from(e),string:$t(r),tuples:t,stringTuples:r,path:n}}function $t(e){const t=[];return e.map((e=>{const r=Pt(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),zt(t.join("/"))}function Vt(e){return(0,bt.z)(e.map((e=>{const t=Pt(e[0]);let r=Uint8Array.from(mt.cv(t.code));return e.length>1&&null!=e[1]&&(r=(0,bt.z)([r,e[1]])),r})))}function jt(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=mt.Jx(t instanceof Uint8Array?t:Uint8Array.from(t));return e+mt.P$(e)}}function zt(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function qt(e){return new Error("Error parsing address: "+e)}const Ft=Symbol.for("nodejs.util.inspect.custom"),Gt=[Pt("dns").code,Pt("dns4").code,Pt("dns6").code,Pt("dnsaddr").code],Ht=new Map,Wt=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Yt(e){return Boolean(e?.[Wt])}class Qt{bytes;#e;#t;#r;#n;[Wt]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=Kt(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);t=function(e){const t=[],r=[];let n=null;const i=(e=zt(e)).split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=Pt(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(s++,s>=i.length)throw qt("invalid address: "+e);if(!0===o.path){n=zt(i.slice(s).join("/")),t.push([o.code,Tt(o.code,n)]),r.push([o.code,n]);break}const a=Tt(o.code,i[s]);t.push([o.code,a]),r.push([o.code,Ct(o.code,a)])}return{string:$t(r),bytes:Vt(t),tuples:t,stringTuples:r,path:n}}(e)}else{if(!Yt(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");t=Kt(e.bytes)}this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=Pt("tcp"),o=Pt("udp"),a=Pt("ip4"),c=Pt("ip6"),u=Pt("dns6"),l=Pt("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),Gt.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=Pt(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=Pt(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#t.map((([e])=>Object.assign({},Pt(e))))}protoCodes(){return this.#t.map((([e])=>e))}protoNames(){return this.#t.map((([e])=>Pt(e).name))}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(e){return e=new Qt(e),new Qt(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Qt(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new Qt(Vt(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach((([t,r])=>{t===It.p2p.code&&e.push([t,r]),t===It["p2p-circuit"].code&&(e=[])}));const t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?(0,gt.B)(K.decode(`z${e}`),"base58btc"):(0,gt.B)(We.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#n}equals(e){return(0,yt.f)(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=Ht.get(t.name);if(null==r)throw new F.sv(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new Qt(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[Ft](){return`Multiaddr(${this.#e})`}}const Jt=function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return w.enabled(`${e}:trace`)&&null!=w.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=w(`${e}:trace`)),Object.assign(w(e),{error:w(`${e}:error`),trace:t})}("libp2p:bootstrap");class Zt extends m.v{static tag="bootstrap";timer;list;timeout;components;_init;constructor(e,t={list:[]}){if(null==t.list||0===t.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??1e3,this.list=[];for(const e of t.list){if(!pt.Ul.matches(e)){Jt.error("Invalid multiaddr");continue}const t=new Qt(e),r=t.getPeerId();if(null==r){Jt.error("Invalid bootstrap multiaddr without peer id");continue}const n={id:ft(r),multiaddrs:[t],protocols:[]};this.list.push(n)}this._init=t}[b.O]=this;[Symbol.toStringTag]="@libp2p/bootstrap";isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(Jt("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout((()=>{this._discoverBootstrapPeers().catch((e=>{Jt.error(e)}))}),this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(const e of this.list){if(await this.components.peerStore.merge(e.id,{tags:{[this._init.tagName??"bootstrap"]:{value:this._init.tagValue??50,ttl:this._init.tagTTL??12e4}}}),null==this.timer)return;this.safeDispatchEvent("peer",{detail:e})}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function Xt(e){return t=>new Zt(t,e)}},63042:function(e,t,r){"use strict";r.d(t,{U:function(){return a}});var n=r(44234),i={SHA1:20,SHA256:32,SHA512:64};const s={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},o=async(e,t)=>{const r=await n.Z.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,0,r.byteLength)};async function a(e,t){const r=s[e],a=await n.Z.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{digest:async e=>await o(a,e),length:i[e]}}},79944:function(e,t,r){"use strict";r.d(t,{XP:function(){return i},nk:function(){return u},O6:function(){return s.Z}});r(63042),r(8925),r(3832),r(49784),r(77408);var n=r(52770);var i=r(8394),s=r(95887),o=r(98960),a=r(97116);const c={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function u(e,t,r,i,s){if("sha1"!==s&&"sha2-256"!==s&&"sha2-512"!==s){const e=Object.keys(c).join(" / ");throw new n.s(`Hash '${s}' is unknown or not supported. Must be ${e}`,"ERR_UNSUPPORTED_HASH_TYPE")}const u=c[s],l=o(e,t,r,i,u);return a.encode64(l,null)}},8394:function(e,t,r){"use strict";r.r(t),r.d(t,{generateEphemeralKeyPair:function(){return k},generateKeyPair:function(){return be},generateKeyPairFromSeed:function(){return we},importKey:function(){return Se},keyStretcher:function(){return b},keysPBM:function(){return n},marshalPrivateKey:function(){return Ae},marshalPublicKey:function(){return Ee},supportedKeys:function(){return ye},unmarshalPrivateKey:function(){return _e},unmarshalPublicKey:function(){return ve}});var n={};r.r(n),r.d(n,{KeyType:function(){return a},PrivateKey:function(){return l},PublicKey:function(){return u}});var i={};r.r(i),r.d(i,{RsaPrivateKey:function(){return z},RsaPublicKey:function(){return j},fromJwk:function(){return G},generateKeyPair:function(){return H},unmarshalRsaPrivateKey:function(){return q},unmarshalRsaPublicKey:function(){return F}});var s={};r.r(s),r.d(s,{Ed25519PrivateKey:function(){return re},Ed25519PublicKey:function(){return te},generateKeyPair:function(){return se},generateKeyPairFromSeed:function(){return oe},unmarshalEd25519PrivateKey:function(){return ne},unmarshalEd25519PublicKey:function(){return ie}});var o={};r.r(o),r.d(o,{Secp256k1PrivateKey:function(){return he},Secp256k1PublicKey:function(){return le},generateKeyPair:function(){return pe},unmarshalSecp256k1PrivateKey:function(){return de},unmarshalSecp256k1PublicKey:function(){return fe}});var a,c,u,l,h=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(a||(a={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(c||(c={})),function(e){e.codec=()=>(0,h.Ji)(c)}(a||(a={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,h.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),a.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=a.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,h.LE)(t,e.codec()),e.decode=t=>(0,h.C6)(t,e.codec())}(u||(u={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,h.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),a.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=a.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,h.LE)(t,e.codec()),e.decode=t=>(0,h.C6)(t,e.codec())}(l||(l={}));r(3068),r(97450);var d=r(3832),f=r(52770),p=r(77408),y=r(41690),g=r(63042);const m={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,keySize:32}};async function b(e,t,r){const n=m[e];if(null==n){const t=Object.keys(m).join(" / ");throw new f.s(`unknown cipher type '${e}'. Must be ${t}`,"ERR_INVALID_CIPHER_TYPE")}if(null==t)throw new f.s("missing hash type","ERR_MISSING_HASH_TYPE");const i=n.keySize,s=n.ivSize,o=(0,p.m)("key expansion"),a=2*(s+i+20),c=await g.U(t,r);let u=await c.digest(o);const l=[];let h=0;for(;h<a;){const e=await c.digest((0,y.z)([u,o]));let t=e.length;h+t>a&&(t=a-h),l.push(e),h+=t,u=await c.digest(u)}const d=a/2,b=(0,y.z)(l),w=b.subarray(0,d),v=b.subarray(d,a),E=e=>({iv:e.subarray(0,s),cipherKey:e.subarray(s,s+i),macKey:e.subarray(s+i)});return{k1:E(w),k2:E(v)}}var w=r(44234),v=(r(97116),r(15764),r(49784));function E(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=(0,y.z)([new Uint8Array(t-r.length),r])}return(0,v.B)(r,"base64url")}function _(e){const t=A(e);return new d.jsbn.BigInteger((0,v.B)(t,"base16"),16)}function A(e,t){let r=(0,p.m)(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=(0,y.z)([new Uint8Array(t-r.length),r])}return r}var S=r(73062);const R={"P-256":256,"P-384":384,"P-521":521},I=Object.keys(R).join(" / ");const x={"P-256":32,"P-384":48,"P-521":66};function P(e){if(null==e.crv||null==e.x||null==e.y)throw new f.s("JWK was missing components","ERR_INVALID_PARAMETERS");if("P-256"!==e.crv&&"P-384"!==e.crv&&"P-521"!==e.crv)throw new f.s(`Unknown curve: ${e.crv}. Must be ${I}`,"ERR_INVALID_CURVE");const t=x[e.crv];return(0,y.z)([Uint8Array.from([4]),A(e.x,t),A(e.y,t)],1+2*t)}function C(e,t){if("P-256"!==e&&"P-384"!==e&&"P-521"!==e)throw new f.s(`Unknown curve: ${e}. Must be ${I}`,"ERR_INVALID_CURVE");const r=x[e];if(!(0,S.f)(t.subarray(0,1),Uint8Array.from([4])))throw new f.s("Cannot unmarshal public key - invalid key format","ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:(0,v.B)(t.subarray(1,r+1),"base64url"),y:(0,v.B)(t.subarray(1+r),"base64url"),ext:!0}}const T=(e,t)=>({...C(e,t.public),d:(0,v.B)(t.private,"base64url")});var k=async function(e){if("P-256"!==e&&"P-384"!==e&&"P-521"!==e)throw new f.s(`Unknown curve: ${e}. Must be ${I}`,"ERR_INVALID_CURVE");const t=await w.Z.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]);return{key:P(await w.Z.get().subtle.exportKey("jwk",t.publicKey)),genSharedKey:async(r,n)=>{let i;i=null!=n?await w.Z.get().subtle.importKey("jwk",T(e,n),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):t.privateKey;const s=await w.Z.get().subtle.importKey("jwk",C(e,r),{name:"ECDH",namedCurve:e},!1,[]),o=await w.Z.get().subtle.deriveBits({name:"ECDH",namedCurve:e,public:s},i,R[e]);return new Uint8Array(o,0,o.byteLength)}}},D=r(99382);function O(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=w.Z.get();r*=8;return{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),l=a.getRandomValues(new Uint8Array(n)),h={name:t,iv:l};"string"==typeof c&&(c=(0,p.m)(c));const d={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},f=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),g=await a.subtle.deriveKey(d,f,{name:t,length:r},!0,["encrypt"]),m=await a.subtle.encrypt(h,g,e);return(0,y.z)([u,h.iv,new Uint8Array(m)])},decrypt:async function(e,c){const u=e.subarray(0,s),l=e.subarray(s,s+n),h=e.subarray(s+n),d={name:t,iv:l};"string"==typeof c&&(c=(0,p.m)(c));const f={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},y=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),g=await a.subtle.deriveKey(f,y,{name:t,length:r},!0,["decrypt"]),m=await a.subtle.decrypt(d,g,h);return new Uint8Array(m)}}}var N=r(27353),L=(r(63219),r(95887));r(28095);function U(e,t){return t.map((t=>_(e[t])))}async function M(e){const t=[await w.Z.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await K(e)],r=await B({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function B(e){if(null==e.privateKey||null==e.publicKey)throw new f.s("Private and public key are required","ERR_INVALID_PARAMETERS");return await Promise.all([w.Z.get().subtle.exportKey("jwk",e.privateKey),w.Z.get().subtle.exportKey("jwk",e.publicKey)])}async function K(e){return await w.Z.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function $(e,t,r,n){const i=t?function(e){return d.pki.setRsaPublicKey(...U(e,["n","e"]))}(e):function(e){return d.pki.setRsaPrivateKey(...U(e,["n","e","d","p","q","dp","dq","qi"]))}(e),s=n((0,v.B)(Uint8Array.from(r),"ascii"),i);return(0,p.m)(s,"ascii")}async function V(e,t){const r=O(),n=await r.encrypt(e,t);return D.base64.encode(n)}class j{constructor(e){this._key=e}async verify(e,t){return await async function(e,t,r){const n=await w.Z.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await w.Z.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new f.s("JWK was missing components","ERR_INVALID_PARAMETERS");const t=d.pki.publicKeyToAsn1({n:_(e.n),e:_(e.e)});return(0,p.m)(d.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return u.encode({Type:a.RSA,Data:this.marshal()}).subarray()}encrypt(e){return $(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,S.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await N.sha256.digest(this.bytes);return e}}class z{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return L.Z(16)}async sign(e){return await async function(e,t){const r=await w.Z.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await w.Z.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new f.s("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new j(this._publicKey)}decrypt(e){return $(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new f.s("JWK was missing components","ERR_INVALID_PARAMETERS");const t=d.pki.privateKeyToAsn1({n:_(e.n),e:_(e.e),d:_(e.d),p:_(e.p),q:_(e.q),dP:_(e.dp),dQ:_(e.dq),qInv:_(e.qi)});return(0,p.m)(d.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return l.encode({Type:a.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,S.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await N.sha256.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,v.B)(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new d.util.ByteBuffer(this.marshal()),r=d.asn1.fromDer(t),n=d.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return d.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return await V(this.bytes,e);throw new f.s(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function q(e){const t=function(e){const t=d.asn1.fromDer((0,v.B)(e,"ascii")),r=d.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:E(r.n),e:E(r.e),d:E(r.d),p:E(r.p),q:E(r.q),dp:E(r.dP),dq:E(r.dQ),qi:E(r.qInv),alg:"RS256"}}(e),r=await M(t);return new z(r.privateKey,r.publicKey)}function F(e){const t=function(e){const t=d.asn1.fromDer((0,v.B)(e,"ascii")),r=d.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:E(r.n),e:E(r.e)}}(e);return new j(t)}async function G(e){const t=await M(e);return new z(t.privateKey,t.publicKey)}async function H(e){const t=await async function(e){const t=await w.Z.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await B(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new z(t.privateKey,t.publicKey)}var W=r(81653),Y=r(38566),Q=r(15866);const J=32,Z=64,X=32;function ee(e,t){const r=new Uint8Array(Z);for(let n=0;n<X;n++)r[n]=e[n],r[X+n]=t[n];return r}class te{constructor(e){this._key=ae(e,J)}async verify(e,t){return await async function(e,t,r){return await Q.T(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return u.encode({Type:a.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,S.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await N.sha256.digest(this.bytes);return e}}class re{constructor(e,t){this._key=ae(e,Z),this._publicKey=ae(t,J)}async sign(e){return await async function(e,t){const r=e.subarray(0,X);return await Q.Xx(t,r)}(this._key,e)}get public(){return new te(this._publicKey)}marshal(){return this._key}get bytes(){return l.encode({Type:a.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,S.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await N.sha256.digest(this.bytes);return e}async id(){const e=Y.identity.digest(this.public.bytes);return W.base58btc.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await V(this.bytes,e);throw new f.s(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function ne(e){if(e.length>Z){const t=(e=ae(e,Z+J)).subarray(0,Z),r=e.subarray(Z,e.length);return new re(t,r)}const t=(e=ae(e,Z)).subarray(0,Z),r=e.subarray(J);return new re(t,r)}function ie(e){return e=ae(e,J),new te(e)}async function se(){const{privateKey:e,publicKey:t}=await async function(){const e=Q.P6.randomPrivateKey(),t=await Q.$3(e);return{privateKey:ee(e,t),publicKey:t}}();return new re(e,t)}async function oe(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==X)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=await Q.$3(t);return{privateKey:ee(t,r),publicKey:r}}(e);return new re(t,r)}function ae(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new f.s(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}var ce=r(27760);function ue(e){try{ce.E9.fromHex(e)}catch(e){throw new f.s(String(e),"ERR_INVALID_PUBLIC_KEY")}}class le{constructor(e){ue(e),this._key=e}async verify(e,t){return await async function(e,t,r){try{const{digest:n}=await N.sha256.digest(r);return ce.T(t,n,e)}catch(e){throw new f.s(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,ce.E9.fromHex(e).toRawBytes(!0);var e}get bytes(){return u.encode({Type:a.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,S.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await N.sha256.digest(this.bytes);return e}}class he{constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return ce.$3(e,!0)}catch(e){throw new f.s(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{ce.$3(e,!0)}catch(e){throw new f.s(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),ue(this._publicKey)}async sign(e){return await async function(e,t){const{digest:r}=await N.sha256.digest(t);try{return await ce.Xx(r,e)}catch(e){throw new f.s(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new le(this._publicKey)}marshal(){return this._key}get bytes(){return l.encode({Type:a.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,S.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await N.sha256.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,v.B)(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await V(this.bytes,e);throw new f.s(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function de(e){return new he(e)}function fe(e){return new le(e)}async function pe(){const e=ce.P6.randomPrivateKey();return new he(e)}const ye={rsa:i,ed25519:s,secp256k1:o};function ge(e){const t=Object.keys(ye).join(" / ");return new f.s(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function me(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return ye[e];throw ge(e)}async function be(e,t){return await me(e).generateKeyPair(t??2048)}async function we(e,t,r){if("ed25519"!==e.toLowerCase())throw new f.s("Seed key derivation is unimplemented for RSA or secp256k1","ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return await oe(t)}function ve(e){const t=u.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case a.RSA:return ye.rsa.unmarshalRsaPublicKey(r);case a.Ed25519:return ye.ed25519.unmarshalEd25519PublicKey(r);case a.Secp256k1:return ye.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw ge(t.Type??"RSA")}}function Ee(e,t){return me(t=(t??"rsa").toLowerCase()),e.bytes}async function _e(e){const t=l.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case a.RSA:return await ye.rsa.unmarshalRsaPrivateKey(r);case a.Ed25519:return ye.ed25519.unmarshalEd25519PrivateKey(r);case a.Secp256k1:return ye.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw ge(t.Type??"RSA")}}function Ae(e,t){return me(t=(t??"rsa").toLowerCase()),e.bytes}async function Se(e,t){try{const r=await async function(e,t){const r=D.base64.decode(e),n=O();return await n.decrypt(r,t)}(e,t);return await _e(r)}catch(e){}const r=d.pki.decryptRsaPrivateKey(e,t);if(null===r)throw new f.s("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=d.asn1.toDer(d.pki.privateKeyToAsn1(r));return n=(0,p.m)(n.getBytes(),"ascii"),await ye.rsa.unmarshalRsaPrivateKey(n)}},95887:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(27760),i=r(52770);function s(e){if(isNaN(e)||e<=0)throw new i.s("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return n.P6.randomBytes(e)}},44234:function(e,t){"use strict";t.Z={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}}},35505:function(e,t,r){"use strict";r.d(t,{OP:function(){return p}});var n=r(69860),i=r(93361),s=r(28364),o=r(85275),a=r(32114),c=r(32044);const u=(0,n.kg)("libp2p:delegated-content-routing"),l=3e4;var h,d;!function(e){e[e.SENDING_QUERY=0]="SENDING_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADDING_PEER=6]="ADDING_PEER",e[e.DIALING_PEER=7]="DIALING_PEER"}(h||(h={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(d||(d={}));class f{constructor(e){if(null==e)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new s.Z({concurrency:4}),this.httpQueueRefs=new s.Z({concurrency:2});const{protocol:t,host:r,port:n}=e.getEndpointConfig();u(`enabled DelegatedContentRouting via ${t}://${r}:${n}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(e,t={}){u("findProviders starts: %c",e),t.timeout=t.timeout??l,t.signal=c([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const r=(0,o.Z)(),n=(0,o.Z)();this.httpQueue.add((async()=>(r.resolve(),await n.promise)));try{await r.promise;for await(const r of this.client.dht.findProvs(e,t))"PROVIDER"===r.name&&(yield*r.providers.map((e=>({id:e.id,protocols:[],multiaddrs:e.multiaddrs}))))}catch(e){throw u.error("findProviders errored:",e),e}finally{n.resolve(),u("findProviders finished: %c",e)}}async provide(e,t={}){u("provide starts: %c",e),t.timeout=t.timeout??l,t.signal=c([this.abortController.signal].concat(null!=t.signal?[t.signal]:[])),await this.httpQueueRefs.add((async()=>{await this.client.block.stat(e,t),await(0,i.Z)(this.client.dht.provide(e,t))})),u("provide finished: %c",e)}async put(e,t,r={}){u("put value start: %b",e),r.timeout=r.timeout??l,r.signal=c([this.abortController.signal].concat(null!=r.signal?[r.signal]:[])),await this.httpQueue.add((async()=>{await(0,i.Z)(this.client.dht.put(e,t,r))})),u("put value finished: %b",e)}async get(e,t={}){u("get value start: %b",e),t.timeout=t.timeout??l,t.signal=c([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const r=await this.httpQueue.add((async()=>{for await(const r of this.client.dht.get(e,t))if("VALUE"===r.name)return u("get value finished: %b",e),r.value;throw a(new Error("Not found"),"ERR_NOT_FOUND")}));if(void 0===r)throw a(new Error("Not found"),"ERR_NOT_FOUND");return r}}function p(e){return()=>new f(e)}},38532:function(e,t,r){"use strict";r.d(t,{e8:function(){return p}});var n=r(69860),i=r(38161),s=r(28364),o=r(85275),a=r(52770),c=r(32044),u=r(23366);const l=(0,n.kg)("libp2p:delegated-peer-routing");var h,d;!function(e){e[e.SENDING_QUERY=0]="SENDING_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADDING_PEER=6]="ADDING_PEER",e[e.DIALING_PEER=7]="DIALING_PEER"}(h||(h={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(d||(d={}));class f{constructor(e){if(null==e)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new s.Z({concurrency:4});const{protocol:t,host:r,port:n}=e.getEndpointConfig();l(`enabled DelegatedPeerRouting via ${t}://${r}:${n}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(e,t={}){l("findPeer starts: %p",e),t.timeout=t.timeout??3e4,t.signal=c([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const r=(0,o.Z)(),n=(0,o.Z)();this.httpQueue.add((async()=>(r.resolve(),await n.promise)));try{await r.promise;for await(const r of this.client.dht.findPeer(e,t))if("FINAL_PEER"===r.name){return{id:r.peer.id,multiaddrs:r.peer.multiaddrs,protocols:[]}}}catch(e){throw l.error("findPeer errored: %o",e),e}finally{n.resolve(),l("findPeer finished: %p",e)}throw new a.s("Not found","ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){let r;const n=i.k0.asCID(e);r=null!=n?n:(0,u.cv)(e),l("getClosestPeers starts: %s",r),t.timeout=t.timeout??3e4,t.signal=c([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const s=(0,o.Z)(),a=(0,o.Z)();this.httpQueue.add((async()=>(s.resolve(),await a.promise)));try{await s.promise;for await(const e of this.client.dht.query(r,t))"PEER_RESPONSE"===e.name&&(yield*e.closer.map((e=>({id:e.id,multiaddrs:e.multiaddrs,protocols:[]}))))}catch(e){throw l.error("getClosestPeers errored:",e),e}finally{a.resolve(),l("getClosestPeers finished: %b",e)}}}function p(e){return()=>new f(e)}},19859:function(e,t,r){"use strict";r.d(t,{kT:function(){return n},kz:function(){return i}});class n extends Error{constructor(e="Unexpected Peer"){super(e),this.code=n.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class i extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=i.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class s extends Error{constructor(e="Invalid crypto transmission"){super(e),this.code=s.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}},48302:function(e,t,r){"use strict";r.d(t,{N:function(){return n}});const n=Symbol.for("@libp2p/connection")},80486:function(e,t,r){"use strict";r.d(t,{Z5:function(){return i},m$:function(){return s},o1:function(){return n}});const n="OPEN",i="CLOSING",s="CLOSED"},59769:function(e,t,r){"use strict";r.d(t,{N:function(){return n}});const n=Symbol.for("@libp2p/peer-discovery")},682:function(e,t,r){"use strict";r.d(t,{I:function(){return i},N:function(){return n}});const n=Symbol.for("@libp2p/peer-id");function i(e){return null!=e&&Boolean(e[n])}},43710:function(e,t,r){"use strict";r.d(t,{$:function(){return n}});const n="keep-alive"},6834:function(e,t,r){"use strict";r.d(t,{Ct:function(){return s},Q_:function(){return i},xq:function(){return n}});const n="StrictSign",i="StrictNoSign";var s;!function(e){e.Accept="accept",e.Ignore="ignore",e.Reject="reject"}(s||(s={}))},1388:function(e,t,r){"use strict";r.d(t,{d:function(){return n},w:function(){return i}});const n=Symbol.for("@libp2p/topology");function i(e){return null!=e&&Boolean(e[n])}},12348:function(e,t,r){"use strict";r.d(t,{NA:function(){return n},P7:function(){return i}});const n=Symbol.for("@libp2p/transport");var i;!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(i||(i={}))},27710:function(e,t,r){"use strict";r.d(t,{J:function(){return n}});const n=Symbol.for("@libp2p/content-routing")},49541:function(e,t,r){"use strict";r.d(t,{_L:function(){return n},kT:function(){return s},kz:function(){return o},sv:function(){return i}});class n extends Error{code;type;constructor(e="The operation was aborted"){super(e),this.code=n.code,this.type=n.type}static code="ABORT_ERR";static type="aborted"}class i extends Error{code;props;constructor(e,t,r){super(e),this.code=t,this.name=r?.name??"CodeError",this.props=r??{}}}class s extends Error{code;constructor(e="Unexpected Peer"){super(e),this.code=s.code}static code="ERR_UNEXPECTED_PEER"}class o extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=o.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}class a extends Error{code;constructor(e="Invalid crypto transmission"){super(e),this.code=a.code}static code=null}},23247:function(e,t,r){"use strict";r.d(t,{A:function(){return s},v:function(){return n}});class n extends EventTarget{#i=new Map;listenerCount(e){const t=this.#i.get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let n=this.#i.get(e);null==n&&(n=[],this.#i.set(e,n)),n.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let n=this.#i.get(e);null!=n&&(n=n.filter((({callback:e})=>e!==t)),this.#i.set(e,n))}dispatchEvent(e){const t=super.dispatchEvent(e);let r=this.#i.get(e.type);return null==r||(r=r.filter((({once:e})=>!e)),this.#i.set(e.type,r)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new s(e,t))}}class i extends Event{detail;constructor(e,t){super(e,t),this.detail=t?.detail}}const s=globalThis.CustomEvent??i},40480:function(e,t,r){"use strict";r.d(t,{s:function(){return i}});class n extends Map{metric;constructor(e){super();const{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function i(e){const{name:t,metrics:r}=e;let i;return i=null!=r?new n({name:t,metrics:r}):new Map,i}},85521:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});const n=Symbol.for("@libp2p/peer-discovery")},5681:function(e,t,r){"use strict";r.d(t,{I:function(){return i},N:function(){return n}});const n=Symbol.for("@libp2p/peer-id");function i(e){return null!=e&&Boolean(e[n])}},77309:function(e,t,r){"use strict";r.d(t,{z:function(){return n}});const n=Symbol.for("@libp2p/peer-routing")},92679:function(e,t,r){"use strict";r.d(t,{Ct:function(){return s},Q_:function(){return i},xq:function(){return n}});const n="StrictSign",i="StrictNoSign";var s;!function(e){e.Accept="accept",e.Ignore="ignore",e.Reject="reject"}(s||(s={}))},77399:function(e,t,r){"use strict";r.d(t,{b:function(){return f}});class n extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function i(e,t,r){const i=r??{},s=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const o=()=>{null!=r&&r()};for(t.addEventListener("abort",o);;){let a;try{if(t.aborted){const{abortMessage:e,abortCode:t}=i;throw new n(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=i;t(new n(e,r))}}));a=await Promise.race([e,s.next()]),r=null}catch(r){t.removeEventListener("abort",o);const n="aborted"===r.type&&t.aborted;if(n&&null!=i.onAbort&&i.onAbort(e),"function"==typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=i.onReturnError&&i.onReturnError(e)}))}catch(e){null!=i.onReturnError&&i.onReturnError(e)}if(n&&!0===i.returnOnAbort)return;throw r}if(!0===a.done)break;yield a.value}t.removeEventListener("abort",o)}()}var s=r(85275);class o{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class a{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new o(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new o(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class c extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function u(e,t){let r,n,i,o=(t=t??{}).onEnd,u=new a,l=(0,s.Z)();const h=e=>null!=n?n(e):(u.push(e),r),d=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return h({done:!1,value:e})},f=e=>i?r:(i=!0,null!=e?(e=>(u=new a,null!=n?n({error:e}):(u.push({error:e}),r)))(e):h({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return u.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,u.push(s);try{t(e(u))}catch(e){i(e)}return r}})):e(u)}finally{u.isEmpty()&&queueMicrotask((()=>{l.resolve(),l=(0,s.Z)()}))}},return:()=>(u=new a,f(),{done:!0}),throw:e=>(f(e),{done:!0}),push:d,end:f,get readableLength(){return u.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),u.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new c)},t.addEventListener("abort",n)})));try{await Promise.race([l.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==o)return r;const p=r;return r={[Symbol.asyncIterator](){return this},next:()=>p.next(),throw:e=>(p.throw(e),null!=o&&(o(e),o=void 0),{done:!0}),return:()=>(p.return(),null!=o&&(o(),o=void 0),{done:!0}),push:d,end:e=>(p.end(e),null!=o&&(o(e),o=void 0),r),get readableLength(){return p.readableLength}},r}var l=r(62308),h=r(49541);function d(e){return null!=e&&"function"==typeof e.then}class f{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;sinkController;sinkEnd;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;log;constructor(e){this.sinkController=new AbortController,this.sinkEnd=(0,s.Z)(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.onEnd=e.onEnd,this.onCloseRead=e?.onCloseRead,this.onCloseWrite=e?.onCloseWrite,this.onReset=e?.onReset,this.onAbort=e?.onAbort,this.source=this.streamSource=function(e={}){return u((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}({onEnd:e=>{null!=e?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.readStatus="closed",this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(e){if("ready"!==this.writeStatus)throw new h.sv(`writable end state is "${this.writeStatus}" not "ready"`,"ERR_SINK_INVALID_STATE");try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if("outbound"===this.direction){const e=this.sendNewStream(t);d(e)&&await e}e=i(e,this.sinkController.signal,{returnOnAbort:!0}),this.log.trace("sink reading from source");for await(let r of e){r=r instanceof Uint8Array?new l.H(r):r;const e=this.sendData(r,t);d(e)&&await e}this.log.trace("sink finished reading from source"),this.writeStatus="done",this.log.trace("sink calling closeWrite"),await this.closeWrite(t),this.onSinkEnd()}catch(e){throw this.log.trace("sink ended with error, calling abort with error",e),this.abort(e),e}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseRead?.(),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),null!=this.onEnd&&this.onEnd(this.endErr)):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),null!=e&&null==this.endErr&&(this.endErr=e),this.onCloseWrite?.(),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),null!=this.onEnd&&this.onEnd(this.endErr)):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.log.trace("closing gracefully"),this.status="closing",await Promise.all([this.closeRead(e),this.closeWrite(e)]),this.status="closed",this.log.trace("closed gracefully")}async closeRead(e={}){if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing","ready"===t&&(this.log.trace("ending internal source queue"),this.streamSource.end()),"reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),this.log.trace("closed readable end of stream")}async closeWrite(e={}){if("closing"===this.writeStatus||"closed"===this.writeStatus)return;this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus);const t=this.writeStatus;"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await this.sink([])),this.writeStatus="closing","writing"===t&&await new Promise(((e,t)=>{queueMicrotask((()=>{this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),this.sinkEnd.promise.then(e,t)}))})),"reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeWrite&&(this.log.trace("send close write to remote"),await this.sendCloseWrite(e)),this.writeStatus="closed",this.log.trace("closed writable end of stream")}abort(e){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();d(t)&&t.catch((e=>{this.log.error("error sending reset message",e)})),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;const e=new h.sv("stream reset","ERR_STREAM_RESET");this.status="reset",this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){"closing"!==this.readStatus&&"closed"!==this.readStatus?(this.log.trace("remote close write"),this._closeSource()):this.log("received remote close write but local source is already closed")}remoteCloseRead(){"closing"!==this.writeStatus&&"closed"!==this.writeStatus?(this.log.trace("remote close read"),this._closeSink()):this.log("received remote close read but local sink is already closed")}destroy(){"closed"!==this.status&&"aborted"!==this.status&&"reset"!==this.status?(this.log.trace("muxer destroyed"),this._closeSinkAndSource()):this.log("received destroy but we are already closed")}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}},55265:function(e,t,r){"use strict";r.d(t,{NA:function(){return n},P7:function(){return i}});const n=Symbol.for("@libp2p/transport");var i;!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(i||(i={}))},52770:function(e,t,r){"use strict";r.d(t,{_:function(){return n},s:function(){return i}});class n extends Error{constructor(e="The operation was aborted"){super(e),this.code=n.code,this.type=n.type}static get code(){return"ABORT_ERR"}static get type(){return"aborted"}}class i extends Error{constructor(e,t,r){super(e),this.code=t,this.name=r?.name??"CodeError",this.props=r??{}}}},46857:function(e,t,r){"use strict";r.d(t,{A:function(){return a},v:function(){return s}});var n,i=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class s extends EventTarget{constructor(){super(...arguments),n.set(this,new Map)}listenerCount(e){const t=i(this,n,"f").get(e);return null==t?0:t.length}addEventListener(e,t,r){super.addEventListener(e,t,r);let s=i(this,n,"f").get(e);null==s&&(s=[],i(this,n,"f").set(e,s)),s.push({callback:t,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(e,t,r){super.removeEventListener(e.toString(),t??null,r);let s=i(this,n,"f").get(e);null!=s&&(s=s.filter((({callback:e})=>e!==t)),i(this,n,"f").set(e,s))}dispatchEvent(e){const t=super.dispatchEvent(e);let r=i(this,n,"f").get(e.type);return null==r||(r=r.filter((({once:e})=>!e)),i(this,n,"f").set(e.type,r)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new a(e,t))}}n=new WeakMap;class o extends Event{constructor(e,t){super(e,t),this.detail=t?.detail}}const a=globalThis.CustomEvent??o},57447:function(e,t,r){"use strict";function n(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}r.d(t,{qK:function(){return n}})},18135:function(e,t,r){"use strict";r.d(t,{$:function(){return Br}});var n={};r.r(n),r.d(n,{base32:function(){return C},base32hex:function(){return O},base32hexpad:function(){return L},base32hexpadupper:function(){return U},base32hexupper:function(){return N},base32pad:function(){return k},base32padupper:function(){return D},base32upper:function(){return T},base32z:function(){return M}});var i={};r.r(i),r.d(i,{base58btc:function(){return B},base58flickr:function(){return K}});var s={};r.r(s),r.d(s,{base64:function(){return $},base64pad:function(){return V},base64url:function(){return j},base64urlpad:function(){return z}});var o={};r.r(o),r.d(o,{base10:function(){return F}});var a={};r.r(a),r.d(a,{base16:function(){return G},base16upper:function(){return H}});var c={};r.r(c),r.d(c,{base2:function(){return W}});var u={};r.r(u),r.d(u,{base256emoji:function(){return Z}});var l={};r.r(l),r.d(l,{base36:function(){return X},base36upper:function(){return ee}});var h={};r.r(h),r.d(h,{base8:function(){return te}});var d={};r.r(d),r.d(d,{identity:function(){return re}});var f={};r.r(f),r.d(f,{code:function(){return oe},decode:function(){return ce},encode:function(){return ae},name:function(){return se}});var p={};r.r(p),r.d(p,{code:function(){return le},decode:function(){return de},encode:function(){return he},name:function(){return ue}});var y={};r.r(y),r.d(y,{identity:function(){return Me}});var g={};r.r(g),r.d(g,{sha256:function(){return Ve},sha512:function(){return je}});var m=r(49541),b=r(11227);var w=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const v=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class E{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class _{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return S(this,e)}}class A{constructor(e){this.decoders=e}or(e){return S(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const S=(e,t)=>new A({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class R{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new E(e,t,r),this.decoder=new _(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const I=({name:e,prefix:t,encode:r,decode:n})=>new R(e,t,r,n),x=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=w(r,t);return I({prefix:e,name:t,encode:n,decode:e=>v(i(e))})},P=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>I({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),C=P({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),T=P({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),k=P({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),D=P({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),O=P({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),N=P({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),L=P({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),U=P({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),M=P({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),B=x({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),K=x({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),$=P({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),V=P({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),j=P({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),z=P({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});b.formatters.b=e=>null==e?"undefined":B.baseEncode(e),b.formatters.t=e=>null==e?"undefined":C.baseEncode(e),b.formatters.m=e=>null==e?"undefined":$.baseEncode(e),b.formatters.p=e=>null==e?"undefined":e.toString(),b.formatters.c=e=>null==e?"undefined":e.toString(),b.formatters.k=e=>null==e?"undefined":e.toString(),b.formatters.a=e=>null==e?"undefined":e.toString();var q=r(5681);const F=x({prefix:"9",name:"base10",alphabet:"0123456789"}),G=P({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),H=P({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),W=P({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Y=Array.from(""),Q=Y.reduce(((e,t,r)=>(e[r]=t,e)),[]),J=Y.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Z=I({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Q[t]),"")},decode:function(e){const t=[];for(const r of e){const e=J[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),X=x({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ee=x({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),te=P({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),re=I({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),ne=new TextEncoder,ie=new TextDecoder,se="json",oe=512,ae=e=>ne.encode(JSON.stringify(e)),ce=e=>JSON.parse(ie.decode(e)),ue="raw",le=85,he=e=>v(e),de=e=>v(e);var fe=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=ge;)r[n++]=255&t|pe,t/=128;for(;t&ye;)r[n++]=255&t|pe,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},pe=128,ye=-128,ge=Math.pow(2,31);var me=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&we)<<s:(n&we)*Math.pow(2,s),s+=7}while(n>=be);return e.bytes=o-r,i},be=128,we=127;var ve=Math.pow(2,7),Ee=Math.pow(2,14),_e=Math.pow(2,21),Ae=Math.pow(2,28),Se=Math.pow(2,35),Re=Math.pow(2,42),Ie=Math.pow(2,49),xe=Math.pow(2,56),Pe=Math.pow(2,63),Ce={encode:fe,decode:me,encodingLength:function(e){return e<ve?1:e<Ee?2:e<_e?3:e<Ae?4:e<Se?5:e<Re?6:e<Ie?7:e<xe?8:e<Pe?9:10}};const Te=(e,t=0)=>[Ce.decode(e,t),Ce.decode.bytes],ke=(e,t,r=0)=>(Ce.encode(e,t,r),t),De=e=>Ce.encodingLength(e),Oe=(e,t)=>{const r=t.byteLength,n=De(e),i=n+De(r),s=new Uint8Array(i+r);return ke(e,s,0),ke(r,s,n),s.set(t,i),new Le(e,r,t,s)},Ne=e=>{const t=v(e),[r,n]=Te(t),[i,s]=Te(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Le(r,i,o,t)};class Le{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Ue=v,Me={code:0,name:"identity",encode:Ue,digest:e=>Oe(0,Ue(e))},Be=({name:e,code:t,encode:r})=>new Ke(e,t,r);class Ke{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Oe(this.code,t):t.then((e=>Oe(this.code,e)))}throw Error("Unknown type, must be binary type")}}const $e=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ve=Be({name:"sha2-256",code:18,encode:$e("SHA-256")}),je=Be({name:"sha2-512",code:19,encode:$e("SHA-512")}),ze=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?We(r,Fe(e),t||B.encoder):Ye(r,Fe(e),t||C.encoder)},qe=new WeakMap,Fe=e=>{const t=qe.get(e);if(null==t){const t=new Map;return qe.set(e,t),t}return t};class Ge{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Qe)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Je)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ge.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Oe(e,t);return Ge.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ge.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return ze(this,e)}toJSON(){return{"/":ze(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Ge)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Ge(e,r,n,i||Ze(e,r,n.bytes))}if(!0===t[Xe]){const{version:e,multihash:r,code:n}=t,i=Ne(r);return Ge.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Qe)throw new Error(`Version 0 CID must use dag-pb (code: ${Qe}) block encoding`);return new Ge(e,t,r,r.bytes);case 1:{const n=Ze(e,t,r.bytes);return new Ge(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Ge.create(0,Qe,e)}static createV1(e,t){return Ge.create(1,e,t)}static decode(e){const[t,r]=Ge.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ge.inspectBytes(e),r=t.size-t.multihashSize,n=v(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Le(t.multihashCode,t.digestSize,i,n);return[0===t.version?Ge.createV0(s):Ge.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Te(e.subarray(t));return t+=n,r};let n=r(),i=Qe;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=He(e,t),i=Ge.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Fe(i).set(r,e),i}}const He=(e,t)=>{switch(e[0]){case"Q":{const r=t||B;return[B.prefix,r.decode(`${B.prefix}${e}`)]}case B.prefix:{const r=t||B;return[B.prefix,r.decode(e)]}case C.prefix:{const r=t||C;return[C.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},We=(e,t,r)=>{const{prefix:n}=r;if(n!==B.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Ye=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},Qe=112,Je=18,Ze=(e,t,r)=>{const n=De(e),i=n+De(t),s=new Uint8Array(i+r.byteLength);return ke(e,s,0),ke(t,s,n),s.set(r,i),s},Xe=Symbol.for("@ipld/js-cid/CID"),et={...d,...c,...h,...o,...a,...n,...l,...i,...s,...u};function tt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const rt=Symbol.for("nodejs.util.inspect.custom"),nt=Object.values(et).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),et.identity.decoder),it=114,st=36,ot=37;class at{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[q.N]=!0;toString(){return null==this.string&&(this.string=B.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Ge.createV1(it,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return tt(this.multihash.bytes,e);if("string"==typeof e)return ht(e).equals(this);if(null!=e?.multihash?.bytes)return tt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[rt](){return`PeerId(${this.toString()})`}}class ct extends at{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class ut extends at{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class lt extends at{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function ht(e,t){if(t=t??nt,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Ne(B.decode(`z${e}`));return e.startsWith("12D")?new ut({multihash:t}):e.startsWith("16U")?new lt({multihash:t}):new ct({multihash:t})}return function(e){try{const t=Ne(e);if(t.code===Me.code){if(t.digest.length===st)return new ut({multihash:t});if(t.digest.length===ot)return new lt({multihash:t})}if(t.code===Ve.code)return new ct({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==it)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Ve.code)return new ct({multihash:e.multihash});if(t.code===Me.code){if(t.digest.length===st)return new ut({multihash:e.multihash});if(t.digest.length===ot)return new lt({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Ge.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(nt.decode(e))}var dt=r(73062),ft=r(49784),pt=r(57050),yt=r(41690),gt=(r(9839),r(77408)),mt=r(49736);const bt=mt.C,wt=mt.aY,vt=function(e){let t=0;if(e=e.toString().trim(),bt(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(wt(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;bt(r[n])&&(e=vt(r[n]),r[n]=(0,ft.B)(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,(0,ft.B)(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},Et=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},_t=-1,At={},St={};function Rt(e){if("number"==typeof e){if(null!=St[e])return St[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=At[e])return At[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,_t,"ip6zone"],[43,8,"ipcidr"],[53,_t,"dns",!0],[54,_t,"dns4",!0],[55,_t,"dns6",!0],[56,_t,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,_t,"unix",!1,!0],[421,_t,"ipfs"],[421,_t,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,_t,"garlic64"],[448,0,"tls"],[449,_t,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,_t,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,_t,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);St[t.code]=t,At[t.name]=t}));Rt("ip4"),Rt("ip6"),Rt("ipcidr");function It(e,t){switch(Rt(e).code){case 4:case 41:return function(e){const t=Et(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!mt.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Nt(t);case 6:case 273:case 33:case 132:return Dt(t).toString();case 421:return function(e){const t=pt.Jx(e),r=e.slice(pt.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return(0,ft.B)(r,"base58btc")}(t);case 444:case 445:return Lt(t);case 466:return function(e){const t=pt.Jx(e),r=e.slice(pt.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+(0,ft.B)(r,"base64url")}(t);default:return(0,ft.B)(t,"base16")}}function xt(e,t){switch(Rt(e).code){case 4:case 41:return Tt(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Ot(t);case 6:case 273:case 33:case 132:return kt(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?Ne(B.decode(`z${e}`)).bytes:Ge.parse(e).multihash.bytes;const r=Uint8Array.from(pt.cv(t.length));return(0,yt.z)([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=C.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=kt(n);return(0,yt.z)([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=C.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=kt(n);return(0,yt.z)([r,i],r.length+i.length)}(t);case 466:return function(e){const t=Ct.decode(e),r=Uint8Array.from(pt.cv(t.length));return(0,yt.z)([r,t],r.length+t.length)}(t);default:return(0,gt.m)(t,"base16")}}const Pt=Object.values(et).map((e=>e.decoder)),Ct=function(){let e=Pt[0].or(Pt[1]);return Pt.slice(2).forEach((t=>e=e.or(t))),e}();function Tt(e){if(!mt.h6(e))throw new Error("invalid ip address");return vt(e)}function kt(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function Dt(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Ot(e){const t=(0,gt.m)(e),r=Uint8Array.from(pt.cv(t.length));return(0,yt.z)([r,t],r.length+t.length)}function Nt(e){const t=pt.Jx(e);if((e=e.slice(pt.P$(t))).length!==t)throw new Error("inconsistent lengths");return(0,ft.B)(e)}function Lt(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${(0,ft.B)(t,"base32")}:${Dt(r)}`}function Ut(e){const t=[],r=[];let n=null,i=0;for(;i<e.length;){const s=pt.Jx(e,i),o=pt.P$(s),a=Rt(s),c=Kt(a,e.slice(i+o));if(0===c){t.push([s]),r.push([s]),i+=o;continue}const u=e.slice(i+o,i+o+c);if(i+=c+o,i>e.length)throw Vt("Invalid address Uint8Array: "+(0,ft.B)(e,"base16"));t.push([s,u]);const l=It(s,u);if(r.push([s,l]),!0===a.path){n=l;break}}return{bytes:Uint8Array.from(e),string:Mt(r),tuples:t,stringTuples:r,path:n}}function Mt(e){const t=[];return e.map((e=>{const r=Rt(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),$t(t.join("/"))}function Bt(e){return(0,yt.z)(e.map((e=>{const t=Rt(e[0]);let r=Uint8Array.from(pt.cv(t.code));return e.length>1&&null!=e[1]&&(r=(0,yt.z)([r,e[1]])),r})))}function Kt(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=pt.Jx(t instanceof Uint8Array?t:Uint8Array.from(t));return e+pt.P$(e)}}function $t(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Vt(e){return new Error("Error parsing address: "+e)}const jt=Symbol.for("nodejs.util.inspect.custom"),zt=[Rt("dns").code,Rt("dns4").code,Rt("dns6").code,Rt("dnsaddr").code],qt=new Map,Ft=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Gt(e){return Boolean(e?.[Ft])}class Ht{bytes;#e;#t;#r;#n;[Ft]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=Ut(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);t=function(e){const t=[],r=[];let n=null;const i=(e=$t(e)).split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=Rt(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(s++,s>=i.length)throw Vt("invalid address: "+e);if(!0===o.path){n=$t(i.slice(s).join("/")),t.push([o.code,xt(o.code,n)]),r.push([o.code,n]);break}const a=xt(o.code,i[s]);t.push([o.code,a]),r.push([o.code,It(o.code,a)])}return{string:Mt(r),bytes:Bt(t),tuples:t,stringTuples:r,path:n}}(e)}else{if(!Gt(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");t=Ut(e.bytes)}this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=Rt("tcp"),o=Rt("udp"),a=Rt("ip4"),c=Rt("ip6"),u=Rt("dns6"),l=Rt("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),zt.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=Rt(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=Rt(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#t.map((([e])=>Object.assign({},Rt(e))))}protoCodes(){return this.#t.map((([e])=>e))}protoNames(){return this.#t.map((([e])=>Rt(e).name))}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(e){return e=new Ht(e),new Ht(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Ht(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new Ht(Bt(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach((([t,r])=>{t===At.p2p.code&&e.push([t,r]),t===At["p2p-circuit"].code&&(e=[])}));const t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?(0,ft.B)(B.decode(`z${e}`),"base58btc"):(0,ft.B)(Ge.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#n}equals(e){return(0,dt.f)(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=qt.get(t.name);if(null==r)throw new m.sv(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new Ht(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[jt](){return`Multiaddr(${this.#e})`}}function Wt(e){return new Ht(e)}var Yt=r(24094),Qt=r(85275),Jt=r(96945),Zt=r.n(Jt),Xt=r(71198);var er,tr=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};er=new WeakMap;var rr,nr,ir,sr,or,ar,cr,ur,lr,hr,dr,fr,pr,yr,gr,mr,br,wr,vr,Er,_r,Ar,Sr,Rr,Ir,xr,Pr=class{constructor(){er.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&tr(this,er,"f")[this.size-1].priority>=t.priority)return void tr(this,er,"f").push(r);const n=function(e,t,r){let n=0,i=e.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}(tr(this,er,"f"),r,((e,t)=>t.priority-e.priority));tr(this,er,"f").splice(n,0,r)}dequeue(){const e=tr(this,er,"f").shift();return null==e?void 0:e.run}filter(e){return tr(this,er,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return tr(this,er,"f").length}},Cr=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},Tr=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class kr extends Error{}class Dr extends(Zt()){constructor(e){var t,r,n,i;if(super(),rr.add(this),nr.set(this,void 0),ir.set(this,void 0),sr.set(this,0),or.set(this,void 0),ar.set(this,void 0),cr.set(this,0),ur.set(this,void 0),lr.set(this,void 0),hr.set(this,void 0),dr.set(this,void 0),fr.set(this,0),pr.set(this,void 0),yr.set(this,void 0),gr.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Pr,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);Cr(this,nr,e.carryoverConcurrencyCount,"f"),Cr(this,ir,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),Cr(this,or,e.intervalCap,"f"),Cr(this,ar,e.interval,"f"),Cr(this,hr,new e.queueClass,"f"),Cr(this,dr,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Cr(this,gr,!0===e.throwOnTimeout,"f"),Cr(this,yr,!1===e.autoStart,"f")}get concurrency(){return Tr(this,pr,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Cr(this,pr,e,"f"),Tr(this,rr,"m",Rr).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:Tr(this,gr,"f"),...t},new Promise(((r,n)=>{Tr(this,hr,"f").enqueue((async()=>{var i,s,o;Cr(this,fr,(s=Tr(this,fr,"f"),++s),"f"),Cr(this,sr,(o=Tr(this,sr,"f"),++o),"f");try{if(null===(i=t.signal)||void 0===i?void 0:i.aborted)throw new kr("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=(0,Xt.ZP)(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,Tr(this,rr,"m",Ir).call(this,t.signal)]));const s=await n;r(s),this.emit("completed",s)}catch(e){if(e instanceof Xt.W5&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{Tr(this,rr,"m",wr).call(this)}}),t),this.emit("add"),Tr(this,rr,"m",_r).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return Tr(this,yr,"f")?(Cr(this,yr,!1,"f"),Tr(this,rr,"m",Rr).call(this),this):this}pause(){Cr(this,yr,!0,"f")}clear(){Cr(this,hr,new(Tr(this,dr,"f")),"f")}async onEmpty(){0!==Tr(this,hr,"f").size&&await Tr(this,rr,"m",xr).call(this,"empty")}async onSizeLessThan(e){Tr(this,hr,"f").size<e||await Tr(this,rr,"m",xr).call(this,"next",(()=>Tr(this,hr,"f").size<e))}async onIdle(){0===Tr(this,fr,"f")&&0===Tr(this,hr,"f").size||await Tr(this,rr,"m",xr).call(this,"idle")}get size(){return Tr(this,hr,"f").size}sizeBy(e){return Tr(this,hr,"f").filter(e).length}get pending(){return Tr(this,fr,"f")}get isPaused(){return Tr(this,yr,"f")}}nr=new WeakMap,ir=new WeakMap,sr=new WeakMap,or=new WeakMap,ar=new WeakMap,cr=new WeakMap,ur=new WeakMap,lr=new WeakMap,hr=new WeakMap,dr=new WeakMap,fr=new WeakMap,pr=new WeakMap,yr=new WeakMap,gr=new WeakMap,rr=new WeakSet,mr=function(){return Tr(this,ir,"f")||Tr(this,sr,"f")<Tr(this,or,"f")},br=function(){return Tr(this,fr,"f")<Tr(this,pr,"f")},wr=function(){var e;Cr(this,fr,(e=Tr(this,fr,"f"),--e),"f"),Tr(this,rr,"m",_r).call(this),this.emit("next")},vr=function(){Tr(this,rr,"m",Sr).call(this),Tr(this,rr,"m",Ar).call(this),Cr(this,lr,void 0,"f")},Er=function(){const e=Date.now();if(void 0===Tr(this,ur,"f")){const t=Tr(this,cr,"f")-e;if(!(t<0))return void 0===Tr(this,lr,"f")&&Cr(this,lr,setTimeout((()=>{Tr(this,rr,"m",vr).call(this)}),t),"f"),!0;Cr(this,sr,Tr(this,nr,"f")?Tr(this,fr,"f"):0,"f")}return!1},_r=function(){if(0===Tr(this,hr,"f").size)return Tr(this,ur,"f")&&clearInterval(Tr(this,ur,"f")),Cr(this,ur,void 0,"f"),this.emit("empty"),0===Tr(this,fr,"f")&&this.emit("idle"),!1;if(!Tr(this,yr,"f")){const e=!Tr(this,rr,"a",Er);if(Tr(this,rr,"a",mr)&&Tr(this,rr,"a",br)){const t=Tr(this,hr,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&Tr(this,rr,"m",Ar).call(this),!0)}}return!1},Ar=function(){Tr(this,ir,"f")||void 0!==Tr(this,ur,"f")||(Cr(this,ur,setInterval((()=>{Tr(this,rr,"m",Sr).call(this)}),Tr(this,ar,"f")),"f"),Cr(this,cr,Date.now()+Tr(this,ar,"f"),"f"))},Sr=function(){0===Tr(this,sr,"f")&&0===Tr(this,fr,"f")&&Tr(this,ur,"f")&&(clearInterval(Tr(this,ur,"f")),Cr(this,ur,void 0,"f")),Cr(this,sr,Tr(this,nr,"f")?Tr(this,fr,"f"):0,"f"),Tr(this,rr,"m",Rr).call(this)},Rr=function(){for(;Tr(this,rr,"m",_r).call(this););},Ir=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new kr("The task was aborted."))}),{once:!0})}))},xr=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var Or=Dr;const Nr=function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return b.enabled(`${e}:trace`)&&null!=b.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=b(`${e}:trace`)),Object.assign(b(e),{error:b(`${e}:error`),trace:t})}("ipni-content-routing"),Lr=4,Ur=3e4;class Mr{started;httpQueue;shutDownController;clientUrl;timeout;constructor(e,t={}){Nr("enabled IPNI routing via",e),this.started=!1,this.shutDownController=new AbortController,this.httpQueue=new Or({concurrency:t.concurrentRequests??Lr}),this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??Ur}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}async*findProviders(e,t={}){Nr("findProviders starts: %c",e);const r=function(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e){if(!0===t?.aborted){r();break}null!=t?.addEventListener&&t.addEventListener("abort",r)}const n=t.signal;return n.clear=function(){for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)},n}([this.shutDownController.signal,t.signal,AbortSignal.timeout(this.timeout)]),n=(0,Qt.Z)(),i=(0,Qt.Z)();this.httpQueue.add((async()=>(n.resolve(),i.promise)));try{await n.promise;const t=`${this.clientUrl}cid/${e.toString()}?cascade=ipfs-dht`,i={headers:{Accept:"application/x-ndjson"},signal:r},s=await fetch(t,i);if(null==s.body)throw new m.sv("IPNI response had no body","ERR_BAD_RESPONSE");for await(const e of Yt(async function*(e,t={}){const r=e.getReader();try{for(;;){const e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}(s.body)))"gBI="===e.Metadata&&(yield this.mapEvent(e))}catch(e){Nr.error("findProviders errored:",e)}finally{r.clear(),i.resolve(),Nr("findProviders finished: %c",e)}}mapEvent(e){const t=ht(e.Provider.ID),r=[];for(const t of e.Provider.Addrs){const e=Wt(t);r.push(e)}return{id:t,multiaddrs:r,protocols:[]}}async provide(){}async put(){}async get(){throw new m.sv("Not found","ERR_NOT_FOUND")}}function Br(e,t={}){return()=>new Mr(e,t)}},62298:function(e,t,r){"use strict";r.d(t,{p7:function(){return Tu}});var n={};r.r(n),r.d(n,{base32:function(){return he},base32hex:function(){return ye},base32hexpad:function(){return me},base32hexpadupper:function(){return be},base32hexupper:function(){return ge},base32pad:function(){return fe},base32padupper:function(){return pe},base32upper:function(){return de},base32z:function(){return we}});var i={};r.r(i),r.d(i,{base58btc:function(){return ve},base58flickr:function(){return Ee}});var s={};r.r(s),r.d(s,{base64:function(){return _e},base64pad:function(){return Ae},base64url:function(){return Se},base64urlpad:function(){return Re}});var o={};r.r(o),r.d(o,{base10:function(){return Je}});var a={};r.r(a),r.d(a,{base16:function(){return Ze},base16upper:function(){return Xe}});var c={};r.r(c),r.d(c,{base2:function(){return et}});var u={};r.r(u),r.d(u,{base256emoji:function(){return it}});var l={};r.r(l),r.d(l,{base36:function(){return st},base36upper:function(){return ot}});var h={};r.r(h),r.d(h,{base8:function(){return at}});var d={};r.r(d),r.d(d,{identity:function(){return ct}});var f={};r.r(f),r.d(f,{code:function(){return dt},decode:function(){return pt},encode:function(){return ft},name:function(){return ht}});var p={};r.r(p),r.d(p,{code:function(){return gt},decode:function(){return bt},encode:function(){return mt},name:function(){return yt}});var y={};r.r(y),r.d(y,{identity:function(){return zt}});var g={};r.r(g),r.d(g,{sha256:function(){return Ht},sha512:function(){return Wt}});var m={};r.r(m),r.d(m,{identity:function(){return Tr}});var b={};r.r(b),r.d(b,{base2:function(){return kr}});var w={};r.r(w),r.d(w,{base8:function(){return Dr}});var v={};r.r(v),r.d(v,{base10:function(){return Or}});var E={};r.r(E),r.d(E,{base16:function(){return Nr},base16upper:function(){return Lr}});var _={};r.r(_),r.d(_,{base32:function(){return Ur},base32hex:function(){return $r},base32hexpad:function(){return jr},base32hexpadupper:function(){return zr},base32hexupper:function(){return Vr},base32pad:function(){return Br},base32padupper:function(){return Kr},base32upper:function(){return Mr},base32z:function(){return qr}});var A={};r.r(A),r.d(A,{base36:function(){return Fr},base36upper:function(){return Gr}});var S={};r.r(S),r.d(S,{base58btc:function(){return Hr},base58flickr:function(){return Wr}});var R={};r.r(R),r.d(R,{base64:function(){return Yr},base64pad:function(){return Qr},base64url:function(){return Jr},base64urlpad:function(){return Zr}});var I={};r.r(I),r.d(I,{base256emoji:function(){return rn}});var x={};r.r(x),r.d(x,{sha256:function(){return Pn},sha512:function(){return Cn}});var P={};r.r(P),r.d(P,{identity:function(){return kn}});var C={};r.r(C),r.d(C,{code:function(){return On},decode:function(){return Ln},encode:function(){return Nn},name:function(){return Dn}});var T={};r.r(T),r.d(T,{code:function(){return Kn},decode:function(){return Vn},encode:function(){return $n},name:function(){return Bn}});var k={};r.r(k),r.d(k,{identity:function(){return bs}});var D={};r.r(D),r.d(D,{base2:function(){return ws}});var O={};r.r(O),r.d(O,{base8:function(){return vs}});var N={};r.r(N),r.d(N,{base10:function(){return Es}});var L={};r.r(L),r.d(L,{base16:function(){return _s},base16upper:function(){return As}});var U={};r.r(U),r.d(U,{base32:function(){return Ss},base32hex:function(){return Ps},base32hexpad:function(){return Ts},base32hexpadupper:function(){return ks},base32hexupper:function(){return Cs},base32pad:function(){return Is},base32padupper:function(){return xs},base32upper:function(){return Rs},base32z:function(){return Ds}});var M={};r.r(M),r.d(M,{base36:function(){return Os},base36upper:function(){return Ns}});var B={};r.r(B),r.d(B,{base58btc:function(){return Ls},base58flickr:function(){return Us}});var K={};r.r(K),r.d(K,{base64:function(){return Ms},base64pad:function(){return Bs},base64url:function(){return Ks},base64urlpad:function(){return $s}});var $={};r.r($),r.d($,{base256emoji:function(){return qs}});var V={};r.r(V),r.d(V,{sha256:function(){return go},sha512:function(){return mo}});var j={};r.r(j),r.d(j,{identity:function(){return wo}});var z={};r.r(z),r.d(z,{code:function(){return Eo},decode:function(){return Ao},encode:function(){return _o},name:function(){return vo}});var q={};r.r(q),r.d(q,{code:function(){return xo},decode:function(){return Co},encode:function(){return Po},name:function(){return Io}});var F={};r.r(F),r.d(F,{Ed25519PrivateKey:function(){return va},Ed25519PublicKey:function(){return wa},generateKeyPair:function(){return Aa},generateKeyPairFromSeed:function(){return Sa},unmarshalEd25519PrivateKey:function(){return Ea},unmarshalEd25519PublicKey:function(){return _a}});var G={};r.r(G),r.d(G,{MAX_KEY_SIZE:function(){return Ba},RsaPrivateKey:function(){return $a},RsaPublicKey:function(){return Ka},fromJwk:function(){return za},generateKeyPair:function(){return qa},unmarshalRsaPrivateKey:function(){return Va},unmarshalRsaPublicKey:function(){return ja}});var H={};r.r(H),r.d(H,{Secp256k1PrivateKey:function(){return Wa},Secp256k1PublicKey:function(){return Ha},generateKeyPair:function(){return Ja},unmarshalSecp256k1PrivateKey:function(){return Ya},unmarshalSecp256k1PublicKey:function(){return Qa}});var W=r(27710),Y=r(49541),Q=r(23247),J=r(85521),Z=r(77309),X=r(11227);var ee=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},te=ee;new Uint8Array(0);const re=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class ne{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ie{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return oe(this,e)}}class se{constructor(e){this.decoders=e}or(e){return oe(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const oe=(e,t)=>new se({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class ae{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new ne(e,t,r),this.decoder=new ie(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ce=({name:e,prefix:t,encode:r,decode:n})=>new ae(e,t,r,n),ue=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=te(r,t);return ce({prefix:e,name:t,encode:n,decode:e=>re(i(e))})},le=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>ce({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),he=le({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),de=le({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fe=le({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pe=le({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ye=le({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ge=le({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),me=le({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),be=le({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),we=le({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ve=ue({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ee=ue({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),_e=le({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ae=le({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Se=le({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Re=le({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Ie(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return X.enabled(`${e}:trace`)&&null!=X.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=X(`${e}:trace`)),Object.assign(X(e),{error:X(`${e}:error`),trace:t})}X.formatters.b=e=>null==e?"undefined":ve.baseEncode(e),X.formatters.t=e=>null==e?"undefined":he.baseEncode(e),X.formatters.m=e=>null==e?"undefined":_e.baseEncode(e),X.formatters.p=e=>null==e?"undefined":e.toString(),X.formatters.c=e=>null==e?"undefined":e.toString(),X.formatters.k=e=>null==e?"undefined":e.toString(),X.formatters.a=e=>null==e?"undefined":e.toString();var xe=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);},Pe=r(85275);class Ce{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Te{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Ce(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Ce(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class ke extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function De(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new Te,a=(0,Pe.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},l=e=>i?r:(i=!0,null!=e?(e=>(o=new Te,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,Pe.Z)()}))}},return:()=>(o=new Te,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:u,end:l,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new ke)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const h=r;return r={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(h.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(h.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return h.readableLength}},r}var Oe=function(...e){const t=[];for(const r of e)null==r[Symbol.asyncIterator]&&t.push(r);return t.length===e.length?function*(){for(const e of t)yield*e}():async function*(){const t=function(e={}){return De((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}})),yield*t}()},Ne=r(53749);const Le=1e3,Ue="/dht/provider",Me=20,Be=3,Ke=Number(3e5),$e=Number(Number(Le)),Ve=Number(5e3),je=Number(3e5),ze=Number(3e4),qe=Number(3e4);var Fe=r(75671);var Ge=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)yield t(r)}();const r=(0,Fe.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){yield await s;for await(const e of r)yield t(e)}();const o=t;return function*(){yield s;for(const e of r)yield o(e)}()},He=r(69849),We=r(32629);function Ye(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}var Qe=r(5681);const Je=ue({prefix:"9",name:"base10",alphabet:"0123456789"}),Ze=le({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Xe=le({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),et=le({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),tt=Array.from(""),rt=tt.reduce(((e,t,r)=>(e[r]=t,e)),[]),nt=tt.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const it=ce({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=rt[t]),"")},decode:function(e){const t=[];for(const r of e){const e=nt[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),st=ue({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ot=ue({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),at=le({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ct=ce({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),ut=new TextEncoder,lt=new TextDecoder,ht="json",dt=512,ft=e=>ut.encode(JSON.stringify(e)),pt=e=>JSON.parse(lt.decode(e)),yt="raw",gt=85,mt=e=>re(e),bt=e=>re(e);var wt=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=_t;)r[n++]=255&t|vt,t/=128;for(;t&Et;)r[n++]=255&t|vt,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},vt=128,Et=-128,_t=Math.pow(2,31);var At=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Rt)<<s:(n&Rt)*Math.pow(2,s),s+=7}while(n>=St);return e.bytes=o-r,i},St=128,Rt=127;var It=Math.pow(2,7),xt=Math.pow(2,14),Pt=Math.pow(2,21),Ct=Math.pow(2,28),Tt=Math.pow(2,35),kt=Math.pow(2,42),Dt=Math.pow(2,49),Ot=Math.pow(2,56),Nt=Math.pow(2,63),Lt={encode:wt,decode:At,encodingLength:function(e){return e<It?1:e<xt?2:e<Pt?3:e<Ct?4:e<Tt?5:e<kt?6:e<Dt?7:e<Ot?8:e<Nt?9:10}};const Ut=(e,t=0)=>[Lt.decode(e,t),Lt.decode.bytes],Mt=(e,t,r=0)=>(Lt.encode(e,t,r),t),Bt=e=>Lt.encodingLength(e),Kt=(e,t)=>{const r=t.byteLength,n=Bt(e),i=n+Bt(r),s=new Uint8Array(i+r);return Mt(e,s,0),Mt(r,s,n),s.set(t,i),new Vt(e,r,t,s)},$t=e=>{const t=re(e),[r,n]=Ut(t),[i,s]=Ut(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Vt(r,i,o,t)};class Vt{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const jt=re,zt={code:0,name:"identity",encode:jt,digest:e=>Kt(0,jt(e))},qt=({name:e,code:t,encode:r})=>new Ft(e,t,r);class Ft{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Kt(this.code,t):t.then((e=>Kt(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Gt=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ht=qt({name:"sha2-256",code:18,encode:Gt("SHA-256")}),Wt=qt({name:"sha2-512",code:19,encode:Gt("SHA-512")}),Yt=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?er(r,Jt(e),t||ve.encoder):tr(r,Jt(e),t||he.encoder)},Qt=new WeakMap,Jt=e=>{const t=Qt.get(e);if(null==t){const t=new Map;return Qt.set(e,t),t}return t};class Zt{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==rr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==nr)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Zt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Kt(e,t);return Zt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Zt.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return Yt(this,e)}toJSON(){return{"/":Yt(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Zt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Zt(e,r,n,i||ir(e,r,n.bytes))}if(!0===t[sr]){const{version:e,multihash:r,code:n}=t,i=$t(r);return Zt.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==rr)throw new Error(`Version 0 CID must use dag-pb (code: ${rr}) block encoding`);return new Zt(e,t,r,r.bytes);case 1:{const n=ir(e,t,r.bytes);return new Zt(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Zt.create(0,rr,e)}static createV1(e,t){return Zt.create(1,e,t)}static decode(e){const[t,r]=Zt.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Zt.inspectBytes(e),r=t.size-t.multihashSize,n=re(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Vt(t.multihashCode,t.digestSize,i,n);return[0===t.version?Zt.createV0(s):Zt.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Ut(e.subarray(t));return t+=n,r};let n=r(),i=rr;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Xt(e,t),i=Zt.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Jt(i).set(r,e),i}}const Xt=(e,t)=>{switch(e[0]){case"Q":{const r=t||ve;return[ve.prefix,r.decode(`${ve.prefix}${e}`)]}case ve.prefix:{const r=t||ve;return[ve.prefix,r.decode(e)]}case he.prefix:{const r=t||he;return[he.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},er=(e,t,r)=>{const{prefix:n}=r;if(n!==ve.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},tr=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},rr=112,nr=18,ir=(e,t,r)=>{const n=Bt(e),i=n+Bt(t),s=new Uint8Array(i+r.byteLength);return Mt(e,s,0),Mt(t,s,n),s.set(r,i),s},sr=Symbol.for("@ipld/js-cid/CID"),or={...d,...c,...h,...o,...a,...n,...l,...i,...s,...u},ar=Symbol.for("nodejs.util.inspect.custom"),cr=Object.values(or).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),or.identity.decoder),ur=114,lr=36,hr=37;class dr{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Qe.N]=!0;toString(){return null==this.string&&(this.string=ve.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Zt.createV1(ur,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Ye(this.multihash.bytes,e);if("string"==typeof e)return gr(e).equals(this);if(null!=e?.multihash?.bytes)return Ye(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[ar](){return`PeerId(${this.toString()})`}}class fr extends dr{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class pr extends dr{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class yr extends dr{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function gr(e,t){if(t=t??cr,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=$t(ve.decode(`z${e}`));return e.startsWith("12D")?new pr({multihash:t}):e.startsWith("16U")?new yr({multihash:t}):new fr({multihash:t})}return mr(cr.decode(e))}function mr(e){try{const t=$t(e);if(t.code===zt.code){if(t.digest.length===lr)return new pr({multihash:t});if(t.digest.length===hr)return new yr({multihash:t})}if(t.code===Ht.code)return new fr({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==ur)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Ht.code)return new fr({multihash:e.multihash});if(t.code===zt.code){if(t.digest.length===lr)return new pr({multihash:e.multihash});if(t.digest.length===hr)return new yr({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Zt.decode(e))}throw new Error("Supplied PeerID CID is invalid")}async function br(e,t){return e.length===lr?new pr({multihash:Kt(zt.code,e),privateKey:t}):e.length===hr?new yr({multihash:Kt(zt.code,e),privateKey:t}):new fr({multihash:await Ht.digest(e),publicKey:e,privateKey:t})}var wr=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},vr=wr;new Uint8Array(0);const Er=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class _r{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ar{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Rr(this,e)}}class Sr{constructor(e){this.decoders=e}or(e){return Rr(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Rr=(e,t)=>new Sr({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Ir{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new _r(e,t,r),this.decoder=new Ar(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const xr=({name:e,prefix:t,encode:r,decode:n})=>new Ir(e,t,r,n),Pr=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=vr(r,t);return xr({prefix:e,name:t,encode:n,decode:e=>Er(i(e))})},Cr=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>xr({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Tr=xr({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),kr=Cr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Dr=Cr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Or=Pr({prefix:"9",name:"base10",alphabet:"0123456789"}),Nr=Cr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Lr=Cr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ur=Cr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Mr=Cr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Br=Cr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Kr=Cr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$r=Cr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Vr=Cr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),jr=Cr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zr=Cr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qr=Cr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Fr=Pr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gr=Pr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Hr=Pr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Wr=Pr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Yr=Cr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qr=Cr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jr=Cr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Zr=Cr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Xr=Array.from(""),en=Xr.reduce(((e,t,r)=>(e[r]=t,e)),[]),tn=Xr.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const rn=xr({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=en[t]),"")},decode:function(e){const t=[];for(const r of e){const e=tn[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var nn=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=an;)r[n++]=255&t|sn,t/=128;for(;t&on;)r[n++]=255&t|sn,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},sn=128,on=-128,an=Math.pow(2,31);var cn=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&ln)<<s:(n&ln)*Math.pow(2,s),s+=7}while(n>=un);return e.bytes=o-r,i},un=128,ln=127;var hn=Math.pow(2,7),dn=Math.pow(2,14),fn=Math.pow(2,21),pn=Math.pow(2,28),yn=Math.pow(2,35),gn=Math.pow(2,42),mn=Math.pow(2,49),bn=Math.pow(2,56),wn=Math.pow(2,63),vn={encode:nn,decode:cn,encodingLength:function(e){return e<hn?1:e<dn?2:e<fn?3:e<pn?4:e<yn?5:e<gn?6:e<mn?7:e<bn?8:e<wn?9:10}};const En=(e,t,r=0)=>(vn.encode(e,t,r),t),_n=e=>vn.encodingLength(e),An=(e,t)=>{const r=t.byteLength,n=_n(e),i=n+_n(r),s=new Uint8Array(i+r);return En(e,s,0),En(r,s,n),s.set(t,i),new Sn(e,r,t,s)};class Sn{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Rn=({name:e,code:t,encode:r})=>new In(e,t,r);class In{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?An(this.code,t):t.then((e=>An(this.code,e)))}throw Error("Unknown type, must be binary type")}}const xn=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Pn=Rn({name:"sha2-256",code:18,encode:xn("SHA-256")}),Cn=Rn({name:"sha2-512",code:19,encode:xn("SHA-512")}),Tn=Er,kn={code:0,name:"identity",encode:Tn,digest:e=>An(0,Tn(e))},Dn="raw",On=85,Nn=e=>Er(e),Ln=e=>Er(e),Un=new TextEncoder,Mn=new TextDecoder,Bn="json",Kn=512,$n=e=>Un.encode(JSON.stringify(e)),Vn=e=>JSON.parse(Mn.decode(e));new WeakMap;class jn{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return jn.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return jn.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return jn.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return cid_format(this,e)}toJSON(){return{"/":cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof jn)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new jn(e,r,n,i||cid_encodeCID(e,r,n.bytes))}if(!0===t[cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return jn.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new jn(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new jn(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return jn.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return jn.create(1,e,t)}static decode(e){const[t,r]=jn.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=jn.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?jn.createV0(s):jn.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),i=jn.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const zn={...m,...b,...w,...v,...E,..._,...A,...S,...R,...I};function qn(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Fn(e=0){return null!=globalThis.Buffer?.allocUnsafe?qn(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Gn(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Hn=Gn("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Wn=Gn("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Fn((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Yn={utf8:Hn,"utf-8":Hn,hex:zn.base16,latin1:Wn,ascii:Wn,binary:Wn,...zn};function Qn(e,t="utf8"){const r=Yn[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var Jn=r(57050);function Zn(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Fn(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return qn(r)}r(9839);function Xn(e,t="utf8"){const r=Yn[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):qn(globalThis.Buffer.from(e,"utf-8"))}var ei=r(49736);const ti=ei.C,ri=ei.aY,ni=function(e){let t=0;if(e=e.toString().trim(),ti(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(ri(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;ti(r[n])&&(e=ni(r[n]),r[n]=Qn(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,Qn(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},ii=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},si=-1,oi={},ai={};function ci(e){if("number"==typeof e){if(null!=ai[e])return ai[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=oi[e])return oi[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,si,"ip6zone"],[43,8,"ipcidr"],[53,si,"dns",!0],[54,si,"dns4",!0],[55,si,"dns6",!0],[56,si,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,si,"unix",!1,!0],[421,si,"ipfs"],[421,si,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,si,"garlic64"],[448,0,"tls"],[449,si,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,si,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,si,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);ai[t.code]=t,oi[t.name]=t}));ci("ip4"),ci("ip6"),ci("ipcidr");function ui(e,t){switch(ci(e).code){case 4:case 41:return function(e){const t=ii(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!ei.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return mi(t);case 6:case 273:case 33:case 132:return yi(t).toString();case 421:return function(e){const t=Jn.Jx(e),r=e.slice(Jn.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return Qn(r,"base58btc")}(t);case 444:case 445:return bi(t);case 466:return function(e){const t=Jn.Jx(e),r=e.slice(Jn.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+Qn(r,"base64url")}(t);default:return Qn(t,"base16")}}function li(e,t){switch(ci(e).code){case 4:case 41:return fi(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return gi(t);case 6:case 273:case 33:case 132:return pi(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?$t(ve.decode(`z${e}`)).bytes:Zt.parse(e).multihash.bytes;const r=Uint8Array.from(Jn.cv(t.length));return Zn([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=he.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=pi(n);return Zn([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=he.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=pi(n);return Zn([r,i],r.length+i.length)}(t);case 466:return function(e){const t=di.decode(e),r=Uint8Array.from(Jn.cv(t.length));return Zn([r,t],r.length+t.length)}(t);default:return Xn(t,"base16")}}const hi=Object.values(or).map((e=>e.decoder)),di=function(){let e=hi[0].or(hi[1]);return hi.slice(2).forEach((t=>e=e.or(t))),e}();function fi(e){if(!ei.h6(e))throw new Error("invalid ip address");return ni(e)}function pi(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function yi(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function gi(e){const t=Xn(e),r=Uint8Array.from(Jn.cv(t.length));return Zn([r,t],r.length+t.length)}function mi(e){const t=Jn.Jx(e);if((e=e.slice(Jn.P$(t))).length!==t)throw new Error("inconsistent lengths");return Qn(e)}function bi(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${Qn(t,"base32")}:${yi(r)}`}function wi(e){const t=[],r=[];let n=null,i=0;for(;i<e.length;){const s=Jn.Jx(e,i),o=Jn.P$(s),a=ci(s),c=_i(a,e.slice(i+o));if(0===c){t.push([s]),r.push([s]),i+=o;continue}const u=e.slice(i+o,i+o+c);if(i+=c+o,i>e.length)throw Si("Invalid address Uint8Array: "+Qn(e,"base16"));t.push([s,u]);const l=ui(s,u);if(r.push([s,l]),!0===a.path){n=l;break}}return{bytes:Uint8Array.from(e),string:vi(r),tuples:t,stringTuples:r,path:n}}function vi(e){const t=[];return e.map((e=>{const r=ci(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),Ai(t.join("/"))}function Ei(e){return Zn(e.map((e=>{const t=ci(e[0]);let r=Uint8Array.from(Jn.cv(t.code));return e.length>1&&null!=e[1]&&(r=Zn([r,e[1]])),r})))}function _i(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=Jn.Jx(t instanceof Uint8Array?t:Uint8Array.from(t));return e+Jn.P$(e)}}function Ai(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Si(e){return new Error("Error parsing address: "+e)}const Ri=Symbol.for("nodejs.util.inspect.custom"),Ii=[ci("dns").code,ci("dns4").code,ci("dns6").code,ci("dnsaddr").code],xi=new Map,Pi=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Ci(e){return Boolean(e?.[Pi])}class Ti{bytes;#e;#t;#r;#n;[Pi]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=wi(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);t=function(e){const t=[],r=[];let n=null;const i=(e=Ai(e)).split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=ci(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(s++,s>=i.length)throw Si("invalid address: "+e);if(!0===o.path){n=Ai(i.slice(s).join("/")),t.push([o.code,li(o.code,n)]),r.push([o.code,n]);break}const a=li(o.code,i[s]);t.push([o.code,a]),r.push([o.code,ui(o.code,a)])}return{string:vi(r),bytes:Ei(t),tuples:t,stringTuples:r,path:n}}(e)}else{if(!Ci(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");t=wi(e.bytes)}this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=ci("tcp"),o=ci("udp"),a=ci("ip4"),c=ci("ip6"),u=ci("dns6"),l=ci("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),Ii.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=ci(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=ci(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#t.map((([e])=>Object.assign({},ci(e))))}protoCodes(){return this.#t.map((([e])=>e))}protoNames(){return this.#t.map((([e])=>ci(e).name))}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(e){return e=new Ti(e),new Ti(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Ti(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new Ti(Ei(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach((([t,r])=>{t===oi.p2p.code&&e.push([t,r]),t===oi["p2p-circuit"].code&&(e=[])}));const t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?Qn(ve.decode(`z${e}`),"base58btc"):Qn(Zt.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#n}equals(e){return function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=xi.get(t.name);if(null==r)throw new Y.sv(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new Ti(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[Ri](){return`Multiaddr(${this.#e})`}}var ki,Di,Oi,Ni=r(46888);function Li(e){const t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0"),i=String(e.getUTCHours()).padStart(2,"0"),s=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0"),a=e.getUTCMilliseconds();return`${t}-${r}-${n}T${i}:${s}:${o}.${String(1e3*a*1e3).padStart(9,"0")}Z`}!function(e){let t;e.codec=()=>(null==t&&(t=(0,Ni.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&e.key.byteLength>0&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),null!=e.timeReceived&&""!==e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.bytes();break;case 2:r.value=e.bytes();break;case 5:r.timeReceived=e.string();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Ni.LE)(t,e.codec()),e.decode=t=>(0,Ni.C6)(t,e.codec())}(ki||(ki={}));class Ui{key;value;timeReceived;constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return ki.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Li(this.timeReceived)}}static deserialize(e){const t=ki.decode(e);return new Ui(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw new Error("Invalid format");const n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),u=parseInt(r[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}(e.timeReceived);if(null==e.key)throw new Error("key missing from deserialized object");if(null==e.value)throw new Error("value missing from deserialized object");return new Ui(e.key,e.value,t)}}!function(e){let t;e.codec=()=>(null==t&&(t=(0,Ni.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&(t.uint32(18),t.bytes(e.value)),null!=e.author&&(t.uint32(26),t.bytes(e.author)),null!=e.signature&&(t.uint32(34),t.bytes(e.signature)),null!=e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.bytes();break;case 2:r.value=e.bytes();break;case 3:r.author=e.bytes();break;case 4:r.signature=e.bytes();break;case 5:r.timeReceived=e.string();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Ni.LE)(t,e.codec()),e.decode=t=>(0,Ni.C6)(t,e.codec())}(Di||(Di={})),function(e){let t,r,n,i,s,o;!function(e){e.PUT_VALUE="PUT_VALUE",e.GET_VALUE="GET_VALUE",e.ADD_PROVIDER="ADD_PROVIDER",e.GET_PROVIDERS="GET_PROVIDERS",e.FIND_NODE="FIND_NODE",e.PING="PING"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(r||(r={})),function(e){e.codec=()=>(0,Ni.Ji)(r)}(t=e.MessageType||(e.MessageType={})),function(e){e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTED="CONNECTED",e.CAN_CONNECT="CAN_CONNECT",e.CANNOT_CONNECT="CANNOT_CONNECT"}(n=e.ConnectionType||(e.ConnectionType={})),function(e){e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTED=1]="CONNECTED",e[e.CAN_CONNECT=2]="CAN_CONNECT",e[e.CANNOT_CONNECT=3]="CANNOT_CONNECT"}(i||(i={})),function(e){e.codec=()=>(0,Ni.Ji)(i)}(n=e.ConnectionType||(e.ConnectionType={})),function(t){let r;t.codec=()=>(null==r&&(r=(0,Ni.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.id&&(r.uint32(10),r.bytes(t.id)),null!=t.addrs)for(const e of t.addrs)r.uint32(18),r.bytes(e);null!=t.connection&&(r.uint32(24),e.ConnectionType.codec().encode(t.connection,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={addrs:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.id=t.bytes();break;case 2:n.addrs.push(t.bytes());break;case 3:n.connection=e.ConnectionType.codec().decode(t);break;default:t.skipType(7&r)}}return n}))),r),t.encode=e=>(0,Ni.LE)(e,t.codec()),t.decode=e=>(0,Ni.C6)(e,t.codec())}(s=e.Peer||(e.Peer={})),e.codec=()=>(null==o&&(o=(0,Ni.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.MessageType.codec().encode(t.type,r)),null!=t.clusterLevelRaw&&(r.uint32(80),r.int32(t.clusterLevelRaw)),null!=t.key&&(r.uint32(18),r.bytes(t.key)),null!=t.record&&(r.uint32(26),r.bytes(t.record)),null!=t.closerPeers)for(const n of t.closerPeers)r.uint32(66),e.Peer.codec().encode(n,r);if(null!=t.providerPeers)for(const n of t.providerPeers)r.uint32(74),e.Peer.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={closerPeers:[],providerPeers:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.MessageType.codec().decode(t);break;case 10:n.clusterLevelRaw=t.int32();break;case 2:n.key=t.bytes();break;case 3:n.record=t.bytes();break;case 8:n.closerPeers.push(e.Peer.codec().decode(t,t.uint32()));break;case 9:n.providerPeers.push(e.Peer.codec().decode(t,t.uint32()));break;default:t.skipType(7&r)}}return n}))),o),e.encode=t=>(0,Ni.LE)(t,e.codec()),e.decode=t=>(0,Ni.C6)(t,e.codec())}(Oi||(Oi={}));const Mi=Oi.MessageType,Bi=Oi.ConnectionType,Ki=Object.keys(Mi);class $i{type;key;clusterLevelRaw;closerPeers;providerPeers;record;constructor(e,t,r){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=r,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){const e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return Oi.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(Vi),providerPeers:this.providerPeers.map(Vi),record:null==this.record?void 0:this.record.serialize().subarray()})}static deserialize(e){const t=Oi.decode(e),r=new $i(t.type??Oi.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return r.closerPeers=t.closerPeers.map(ji),r.providerPeers=t.providerPeers.map(ji),null!=t.record?.length&&(r.record=Ui.deserialize(t.record)),r}}function Vi(e){return{id:e.id.toBytes(),addrs:(e.multiaddrs??[]).map((e=>e.bytes)),connection:Bi.CONNECTED}}function ji(e){if(null==e.id)throw new Error("Invalid peer in message");return{id:mr(e.id),multiaddrs:(e.addrs??[]).map((e=>new Ti(e))),protocols:[]}}function zi(e,t={}){const r={...e,name:"SEND_QUERY",type:0,messageName:e.type,messageType:Ki.indexOf(e.type.toString())};return t.onProgress?.(new Q.A("kad-dht:query:send-query",{detail:r})),r}function qi(e,t={}){const r={...e,name:"PEER_RESPONSE",type:1,messageName:e.messageType,closer:null!=e.closer?e.closer:[],providers:null!=e.providers?e.providers:[]};return t.onProgress?.(new Q.A("kad-dht:query:peer-response",{detail:r})),r}function Fi(e,t={}){const r={...e,name:"FINAL_PEER",type:2};return t.onProgress?.(new Q.A("kad-dht:query:final-peer",{detail:r})),r}function Gi(e,t={}){const r={...e,name:"QUERY_ERROR",type:3};return t.onProgress?.(new Q.A("kad-dht:query:query-error",{detail:r})),r}function Hi(e,t={}){const r={...e,name:"PROVIDER",type:4};return t.onProgress?.(new Q.A("kad-dht:query:provider",{detail:r})),r}function Wi(e,t={}){const r={...e,name:"VALUE",type:5};return t.onProgress?.(new Q.A("kad-dht:query:value",{detail:r})),r}function Yi(e,t={}){const r={...e,name:"DIAL_PEER",type:7};return t.onProgress?.(new Q.A("kad-dht:query:dial-peer",{detail:r})),r}function Qi(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Ji(e=0){return null!=globalThis.Buffer?.allocUnsafe?Qi(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Zi(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Xi=Zi("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),es=Zi("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Ji((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var ts={utf8:Xi,"utf-8":Xi,hex:or.base16,latin1:es,ascii:es,binary:es,...or};function rs(e,t="utf8"){const r=ts[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}const ns={pk:function(e,t){return 0}};async function is(e,t){const r=t.key,n=rs(r).split("/");if(n.length<3)return;const i=e[n[1].toString()];if(null==i){const e="Invalid record keytype";throw new Y.sv(e,"ERR_INVALID_RECORD_KEY_TYPE")}await i(r,t.value)}const ss={pk:async(e,t)=>{if(!(e instanceof Uint8Array))throw new Y.sv('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(e.byteLength<5)throw new Y.sv("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if("/pk/"!==rs(e.subarray(0,4)))throw new Y.sv("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");if(!Ye(e.slice(4),(await Ht.digest(t)).bytes))throw new Y.sv("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")}};var os=r(53416);var as=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},cs=as;new Uint8Array(0);const us=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class ls{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class hs{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return fs(this,e)}}class ds{constructor(e){this.decoders=e}or(e){return fs(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const fs=(e,t)=>new ds({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class ps{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new ls(e,t,r),this.decoder=new hs(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ys=({name:e,prefix:t,encode:r,decode:n})=>new ps(e,t,r,n),gs=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=cs(r,t);return ys({prefix:e,name:t,encode:n,decode:e=>us(i(e))})},ms=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>ys({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),bs=ys({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),ws=ms({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),vs=ms({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Es=gs({prefix:"9",name:"base10",alphabet:"0123456789"}),_s=ms({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),As=ms({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ss=ms({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Rs=ms({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Is=ms({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xs=ms({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ps=ms({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Cs=ms({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ts=ms({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ks=ms({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ds=ms({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Os=gs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ns=gs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ls=gs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Us=gs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ms=ms({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Bs=ms({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ks=ms({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$s=ms({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Vs=Array.from(""),js=Vs.reduce(((e,t,r)=>(e[r]=t,e)),[]),zs=Vs.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const qs=ys({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=js[t]),"")},decode:function(e){const t=[];for(const r of e){const e=zs[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var Fs=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Ws;)r[n++]=255&t|Gs,t/=128;for(;t&Hs;)r[n++]=255&t|Gs,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Gs=128,Hs=-128,Ws=Math.pow(2,31);var Ys=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Js)<<s:(n&Js)*Math.pow(2,s),s+=7}while(n>=Qs);return e.bytes=o-r,i},Qs=128,Js=127;var Zs=Math.pow(2,7),Xs=Math.pow(2,14),eo=Math.pow(2,21),to=Math.pow(2,28),ro=Math.pow(2,35),no=Math.pow(2,42),io=Math.pow(2,49),so=Math.pow(2,56),oo=Math.pow(2,63),ao={encode:Fs,decode:Ys,encodingLength:function(e){return e<Zs?1:e<Xs?2:e<eo?3:e<to?4:e<ro?5:e<no?6:e<io?7:e<so?8:e<oo?9:10}};const co=(e,t,r=0)=>(ao.encode(e,t,r),t),uo=e=>ao.encodingLength(e),lo=(e,t)=>{const r=t.byteLength,n=uo(e),i=n+uo(r),s=new Uint8Array(i+r);return co(e,s,0),co(r,s,n),s.set(t,i),new ho(e,r,t,s)};class ho{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const fo=({name:e,code:t,encode:r})=>new po(e,t,r);class po{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?lo(this.code,t):t.then((e=>lo(this.code,e)))}throw Error("Unknown type, must be binary type")}}const yo=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),go=fo({name:"sha2-256",code:18,encode:yo("SHA-256")}),mo=fo({name:"sha2-512",code:19,encode:yo("SHA-512")}),bo=us,wo={code:0,name:"identity",encode:bo,digest:e=>lo(0,bo(e))},vo="raw",Eo=85,_o=e=>us(e),Ao=e=>us(e),So=new TextEncoder,Ro=new TextDecoder,Io="json",xo=512,Po=e=>So.encode(JSON.stringify(e)),Co=e=>JSON.parse(Ro.decode(e));new WeakMap;class To{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return To.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return To.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return To.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return src_cid_format(this,e)}toJSON(){return{"/":src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof To)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new To(e,r,n,i||src_cid_encodeCID(e,r,n.bytes))}if(!0===t[src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return To.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new To(e,t,r,r.bytes);case 1:{const n=src_cid_encodeCID(e,t,r.bytes);return new To(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return To.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return To.create(1,e,t)}static decode(e){const[t,r]=To.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=To.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?To.createV0(s):To.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=src_cid_parseCIDtoBytes(e,t),i=To.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const ko={...k,...D,...O,...N,...L,...U,...M,...B,...K,...$};function Do(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Oo(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const No=Oo("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Lo=Oo("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer?.allocUnsafe?Do(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Uo={utf8:No,"utf-8":No,hex:ko.base16,latin1:Lo,ascii:Lo,binary:Lo,...ko};const Mo="/",Bo=(new TextEncoder).encode(Mo),Ko=Bo[0];class $o{_buf;constructor(e,t){if("string"==typeof e)this._buf=function(e,t="utf8"){const r=Uo[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Do(globalThis.Buffer.from(e,"utf-8"))}(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==Ko)throw new Error("Invalid key")}toString(e="utf8"){return function(e,t="utf8"){const r=Uo[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new $o(e.join(Mo))}static random(){return new $o((0,os.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new $o(e):"function"==typeof e.uint8Array?new $o(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Bo),this._buf[0]!==Ko){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Ko,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Ko;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return $o.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Mo).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new $o(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Mo)||(e+=Mo),e+=this.type(),new $o(e)}parent(){const e=this.list();return 1===e.length?new $o(Mo):new $o(e.slice(0,-1).join(Mo))}child(e){return this.toString()===Mo?e:e.toString()===Mo?this:new $o(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return $o.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}function Vo(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Ji(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return Qi(r)}function jo(e,t="utf8"){const r=ts[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Qi(globalThis.Buffer.from(e,"utf-8"))}const zo=jo("/pk/");function qo(e){return{...e,multiaddrs:e.multiaddrs.filter((e=>{const[[t,r]]=e.stringTuples();if(53===t||54===t||55===t)return"localhost"!==r;if(4!==t&&6!==t)return!1;if(null==r)return!1;const n=(0,Ne.Z)(r);return null==n||!n}))}}function Fo(e){return{...e,multiaddrs:e.multiaddrs.filter((e=>{const[[t,r]]=e.stringTuples();if("localhost"===r)return!0;if(4!==t&&6!==t)return!1;if(null==r)return!1;const n=(0,Ne.Z)(r);return null!=n&&n}))}}async function Go(e){return(await Ht.digest(e)).digest}async function Ho(e){return Go(e.toBytes())}function Wo(e){return new $o(`/dht/record/${rs(e,"base32")}`,!1)}function Yo(e,t){const r=new Date;return new Ui(e,t,r).serialize()}class Qo{log;components;validators;selectors;peerRouting;queryManager;network;constructor(e,t){const{validators:r,selectors:n,peerRouting:i,queryManager:s,network:o,lan:a}=t;this.components=e,this.log=Ie(`libp2p:kad-dht:${a?"lan":"wan"}:content-fetching`),this.validators=r,this.selectors=n,this.peerRouting=i,this.queryManager=s,this.network=o}async putLocal(e,t){const r=Wo(e);await this.components.datastore.put(r,t)}async getLocal(e){this.log("getLocal %b",e);const t=Wo(e);this.log("fetching record for key %k",t);const r=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const n=Ui.deserialize(r);return await is(this.validators,n),n}async*sendCorrectionRecord(e,t,r,n={}){this.log("sendCorrection for %b",e);const i=Yo(e,r);for(const{value:s,from:o}of t){if(Ye(s,r)){this.log("record was ok");continue}if(this.components.peerId.equals(o)){try{const t=Wo(e);this.log(`Storing corrected record for key ${t.toString()}`),await this.components.datastore.put(t,i.subarray())}catch(e){this.log.error("Failed error correcting self",e)}continue}let t=!1;const a=new $i(Mi.PUT_VALUE,e,0);a.record=Ui.deserialize(i);for await(const e of this.network.sendRequest(o,a,n))"PEER_RESPONSE"===e.name&&null!=e.record&&Ye(e.record.value,Ui.deserialize(i).value)&&(t=!0),yield e;t||(yield Gi({from:o,error:new Y.sv("value not put correctly","ERR_PUT_VALUE_INVALID")},n)),this.log.error("Failed error correcting entry")}}async*put(e,t,r={}){this.log("put key %b value %b",e,t);const n=Yo(e,t),i=Wo(e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,n.subarray()),yield*(0,We.z)(this.peerRouting.getClosestPeers(e,{signal:r.signal}),(t=>Ge(t,(t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const i=[],s=new $i(Mi.PUT_VALUE,e,0);s.record=Ui.deserialize(n),this.log("send put to %p",t.peer.id);for await(const e of this.network.sendRequest(t.peer.id,s,r))i.push(e),"PEER_RESPONSE"===e.name&&(null!=e.record&&Ye(e.record.value,Ui.deserialize(n).value)||i.push(Gi({from:t.peer.id,error:new Y.sv("value not put correctly","ERR_PUT_VALUE_INVALID")},r)));return i}))),(e=>(0,He.Z)(e,{ordered:!1,concurrency:Be})),(async function*(e){for await(const t of e)yield*t}))}async*get(e,t={}){this.log("get %b",e);const r=[];for await(const n of this.getMany(e,t))"VALUE"===n.name&&r.push(n),yield n;if(0===r.length)return;const n=r.map((e=>e.value));let i=0;try{i=function(e,t,r){if(0===r.length){const e="No records given";throw new Y.sv(e,"ERR_NO_RECORDS_RECEIVED")}const n=rs(t).split("/");if(n.length<3){const e="Record key does not have a selector function";throw new Y.sv(e,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const i=e[n[1].toString()];if(null==i){const e=`Unrecognized key prefix: ${n[1]}`;throw new Y.sv(e,"ERR_UNRECOGNIZED_KEY_PREFIX")}return 1===r.length?0:i(t,r)}(this.selectors,e,n)}catch(e){if("ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY"!==e.code)throw e}const s=n[i];if(this.log("GetValue %b %b",e,s),null==s)throw new Y.sv("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,r,s,t),yield r[i]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const r=await this.getLocal(e);yield Wi({value:r.value,from:this.components.peerId},t)}catch(t){this.log("error getting local value for %b",e,t)}const r=this;yield*this.queryManager.run(e,(async function*({peer:n,signal:i}){for await(const s of r.peerRouting.getValueOrPeers(n,e,{signal:i}))yield s,"PEER_RESPONSE"===s.name&&null!=s.record&&(yield Wi({from:n,value:s.record.value},t))}),t)}}class Jo{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){const{network:r,peerRouting:n,queryManager:i,routingTable:s,providers:o,lan:a}=t;this.components=e,this.log=Ie(`libp2p:kad-dht:${a?"lan":"wan"}:content-routing`),this.network=r,this.peerRouting=n,this.queryManager=i,this.routingTable=s,this.providers=o}async*provide(e,t,r={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);const n=new $i(Mi.ADD_PROVIDER,e.multihash.bytes,0);n.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let i=0;const s=t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const s=[];this.log("putProvider %s to %p",e,t.peer.id);try{this.log("sending provider record for %s to %p",e,t.peer.id);for await(const o of this.network.sendMessage(t.peer.id,n,r))"PEER_RESPONSE"===o.name&&(this.log("sent provider record for %s to %p",e,t.peer.id),i++),s.push(o)}catch(e){this.log.error("error sending provide record to peer %p",t.peer.id,e),s.push(Gi({from:t.peer.id,error:e},r))}return s};yield*(0,We.z)(this.peerRouting.getClosestPeers(e.multihash.bytes,r),(e=>Ge(e,(e=>s(e)))),(e=>(0,He.Z)(e,{ordered:!1,concurrency:Be})),(async function*(e){for await(const t of e)yield*t})),this.log("sent provider records to %d peers",i)}async*findProviders(e,t){const r=this.routingTable.kBucketSize,n=e.multihash.bytes,i=this;this.log("findProviders %c",e);const s=await this.providers.getProviders(e);if(s.length>0){const e=[];for(const t of s.slice(0,r))try{const r=await this.components.peerStore.get(t);e.push({id:t,multiaddrs:r.addresses.map((({multiaddr:e})=>e)),protocols:r.protocols})}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e;this.log("no peer store entry for %p",t)}yield qi({from:this.components.peerId,messageType:Mi.GET_PROVIDERS,providers:e},t),yield Hi({from:this.components.peerId,providers:e},t)}if(s.length>=r)return;const o=async function*({peer:e,signal:r}){const s=new $i(Mi.GET_PROVIDERS,n,0);yield*i.network.sendRequest(e,s,{...t,signal:r})},a=new Set(s.map((e=>e.toString())));for await(const i of this.queryManager.run(n,o,t))if(yield i,"PEER_RESPONSE"===i.name){this.log("Found %d provider entries for %c and %d closer peers",i.providers.length,e,i.closer.length);const n=[];for(const e of i.providers)a.has(e.id.toString())||(a.add(e.id.toString()),n.push(e));if(n.length>0&&(yield Hi({from:i.from,providers:n},t)),a.size===r)return}}}class Zo extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Xo(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new Zo(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new Zo(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}function ea(e,t,r){return n=>e(Xo(n,t,r))}function ta(e,t,r){return{sink:ea(e.sink,t,{...r,onAbort:void 0}),source:Xo(e.source,t,r)}}var ra=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t},na=r(9202);class ia extends Q.v{log;protocol;running;components;constructor(e,t){super();const{protocol:r,lan:n}=t;this.components=e,this.log=Ie(`libp2p:kad-dht:${n?"lan":"wan"}:network`),this.running=!1,this.protocol=r}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,r={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield Yi({peer:e},r),yield zi({to:e,type:t.type},r);try{const n=await this.components.connectionManager.openConnection(e,r),i=await n.newStream(this.protocol,r),s=await this._writeReadMessage(i,t.serialize(),r);yield qi({from:e,messageType:s.type,closer:s.closerPeers,providers:s.providerPeers,record:s.record},r)}catch(t){yield Gi({from:e,error:t},r)}finally{0}}async*sendMessage(e,t,r={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield Yi({peer:e},r),yield zi({to:e,type:t.type},r);try{const n=await this.components.connectionManager.openConnection(e,r),i=await n.newStream(this.protocol,r);await this._writeMessage(i,t.serialize(),r),yield qi({from:e,messageType:t.type},r)}catch(t){yield Gi({from:e,error:t},r)}finally{0}}async _writeMessage(e,t,r){null!=r.signal&&(e=ta(e,r.signal)),await(0,We.z)([t],(e=>na.c(e)),e,xe)}async _writeReadMessage(e,t,r){null!=r.signal&&(e=ta(e,r.signal));const n=await(0,We.z)([t],(e=>na.c(e)),e,(e=>na.J(e)),(async e=>{const t=await ra(e);if(null!=t)return t;throw new Y.sv("No message received","ERR_NO_MESSAGE_RECEIVED")})),i=$i.deserialize(n);return i.closerPeers.forEach((e=>{this.dispatchEvent(new Q.A("peer",{detail:e}))})),i.providerPeers.forEach((e=>{this.dispatchEvent(new Q.A("peer",{detail:e}))})),i}}r(8925);var sa=r(3832);var oa={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};r(3068),r(97450);var aa=r(4101);const ca=32,ua=64,la=32;function ha(e,t){const r=new Uint8Array(ua);for(let n=0;n<la;n++)r[n]=e[n],r[la+n]=t[n];return r}const da={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function fa(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=oa.get();r*=8;return{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),l=a.getRandomValues(new Uint8Array(n)),h={name:t,iv:l};let d;if("string"==typeof c&&(c=jo(c)),0===c.length){d=await a.subtle.importKey("jwk",da,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{d=await a.subtle.importKey("jwk",da,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const f=await a.subtle.encrypt(h,d,e);return Vo([u,h.iv,new Uint8Array(f)])},decrypt:async function(e,c){const u=e.subarray(0,s),l=e.subarray(s,s+n),h=e.subarray(s+n),d={name:t,iv:l};let f;if("string"==typeof c&&(c=jo(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{f=await a.subtle.importKey("jwk",da,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(d,f,h);return new Uint8Array(p)}}}async function pa(e,t){const r=fa(),n=await r.encrypt(e,t);return _e.encode(n)}var ya,ga,ma,ba;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(ya||(ya={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(ga||(ga={})),function(e){e.codec=()=>(0,Ni.Ji)(ga)}(ya||(ya={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Ni.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),ya.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=ya.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Ni.LE)(t,e.codec()),e.decode=t=>(0,Ni.C6)(t,e.codec())}(ma||(ma={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Ni.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),ya.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=ya.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Ni.LE)(t,e.codec()),e.decode=t=>(0,Ni.C6)(t,e.codec())}(ba||(ba={}));class wa{_key;constructor(e){this._key=Ra(e,ca)}async verify(e,t){return async function(e,t,r){return aa.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return ma.encode({Type:ya.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ye(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ht.digest(this.bytes);return e}}class va{_key;_publicKey;constructor(e,t){this._key=Ra(e,ua),this._publicKey=Ra(t,ca)}async sign(e){return async function(e,t){const r=e.subarray(0,la);return aa.UN.sign(t,r)}(this._key,e)}get public(){return new wa(this._publicKey)}marshal(){return this._key}get bytes(){return ba.encode({Type:ya.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ye(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ht.digest(this.bytes);return e}async id(){const e=zt.digest(this.public.bytes);return ve.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return pa(this.bytes,e);throw new Y.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Ea(e){if(e.length>ua){const t=(e=Ra(e,ua+ca)).subarray(0,ua),r=e.subarray(ua,e.length);return new va(t,r)}const t=(e=Ra(e,ua)).subarray(0,ua),r=e.subarray(ca);return new va(t,r)}function _a(e){return e=Ra(e,ca),new wa(e)}async function Aa(){const{privateKey:e,publicKey:t}=await async function(){const e=aa.UN.utils.randomPrivateKey(),t=aa.UN.getPublicKey(e);return{privateKey:ha(e,t),publicKey:t}}();return new va(e,t)}async function Sa(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==la)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=aa.UN.getPublicKey(t);return{privateKey:ha(t,r),publicKey:r}}(e);return new va(t,r)}function Ra(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new Y.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}r(97116),r(15764);function Ia(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Vo([new Uint8Array(t-r.length),r])}return rs(r,"base64url")}function xa(e){const t=Pa(e);return new sa.jsbn.BigInteger(rs(t,"base16"),16)}function Pa(e,t){let r=jo(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Vo([new Uint8Array(t-r.length),r])}return r}const Ca={"P-256":256,"P-384":384,"P-521":521};Object.keys(Ca).join(" / ");r(63219);const Ta="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function ka(e){if(isNaN(e)||e<=0)throw new Y.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(Ta&&"function"==typeof Ta.getRandomValues)return Ta.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}r(28095);function Da(e,t){return t.map((t=>xa(e[t])))}async function Oa(e){const t=[await oa.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await La(e)],r=await Na({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function Na(e){if(null==e.privateKey||null==e.publicKey)throw new Y.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([oa.get().subtle.exportKey("jwk",e.privateKey),oa.get().subtle.exportKey("jwk",e.publicKey)])}async function La(e){return oa.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Ua(e,t,r,n){const i=t?function(e){return sa.pki.setRsaPublicKey(...Da(e,["n","e"]))}(e):function(e){return sa.pki.setRsaPrivateKey(...Da(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return jo(n(rs(Uint8Array.from(r),"ascii"),i),"ascii")}function Ma(e){if("RSA"!==e.kty)throw new Y.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new Y.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*jo(e.n,"base64url").length}const Ba=8192;class Ka{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await oa.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return oa.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new Y.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=sa.pki.publicKeyToAsn1({n:xa(e.n),e:xa(e.e)});return jo(sa.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return ma.encode({Type:ya.RSA,Data:this.marshal()}).subarray()}encrypt(e){return Ua(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Ye(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ht.digest(this.bytes);return e}}class $a{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return ka(16)}async sign(e){return async function(e,t){const r=await oa.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await oa.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new Y.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Ka(this._publicKey)}decrypt(e){return Ua(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new Y.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=sa.pki.privateKeyToAsn1({n:xa(e.n),e:xa(e.e),d:xa(e.d),p:xa(e.p),q:xa(e.q),dP:xa(e.dp),dQ:xa(e.dq),qInv:xa(e.qi)});return jo(sa.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return ba.encode({Type:ya.RSA,Data:this.marshal()}).subarray()}equals(e){return Ye(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ht.digest(this.bytes);return e}async id(){return rs(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new sa.util.ByteBuffer(this.marshal()),r=sa.asn1.fromDer(t),n=sa.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return sa.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return pa(this.bytes,e);throw new Y.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Va(e){const t=function(e){const t=sa.asn1.fromDer(rs(e,"ascii")),r=sa.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Ia(r.n),e:Ia(r.e),d:Ia(r.d),p:Ia(r.p),q:Ia(r.q),dp:Ia(r.dP),dq:Ia(r.dQ),qi:Ia(r.qInv),alg:"RS256"}}(e);if(Ma(t)>Ba)throw new Y.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await Oa(t);return new $a(r.privateKey,r.publicKey)}function ja(e){const t=function(e){const t=sa.asn1.fromDer(rs(e,"ascii")),r=sa.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Ia(r.n),e:Ia(r.e)}}(e);if(Ma(t)>Ba)throw new Y.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Ka(t)}async function za(e){if(Ma(e)>Ba)throw new Y.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Oa(e);return new $a(t.privateKey,t.publicKey)}async function qa(e){if(e>Ba)throw new Y.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await oa.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await Na(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new $a(t.privateKey,t.publicKey)}var Fa=r(60533);function Ga(e){try{Fa.kA.ProjectivePoint.fromHex(e)}catch(e){throw new Y.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Ha{_key;constructor(e){Ga(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await Ht.digest(r);return Fa.kA.verify(t,n,e)}catch(e){throw new Y.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Fa.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return ma.encode({Type:ya.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ye(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ht.digest(this.bytes);return e}}class Wa{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return Fa.kA.getPublicKey(e,!0)}catch(e){throw new Y.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Fa.kA.getPublicKey(e,!0)}catch(e){throw new Y.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Ga(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await Ht.digest(t);try{return Fa.kA.sign(r,e).toDERRawBytes()}catch(e){throw new Y.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Ha(this._publicKey)}marshal(){return this._key}get bytes(){return ba.encode({Type:ya.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ye(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ht.digest(this.bytes);return e}async id(){return rs(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return pa(this.bytes,e);throw new Y.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Ya(e){return new Wa(e)}function Qa(e){return new Ha(e)}async function Ja(){const e=Fa.kA.utils.randomPrivateKey();return new Wa(e)}const Za={rsa:G,ed25519:F,secp256k1:H};function Xa(e){const t=Object.keys(Za).join(" / ");return new Y.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function ec(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return Za[e];throw Xa(e)}r(98960);function tc(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function rc(e,t){if(e.length!==t.length)throw new Error("Inputs should have the same length");const r=Ji(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return Qi(r)}class nc{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map((e=>e.peerId))}async add(e){if(null!=this.peerDistances.find((t=>t.peerId.equals(e))))return;const t=await Ho(e),r={peerId:e,distance:rc(this.originDhtKey,t)};this.peerDistances.push(r),this.peerDistances.sort(((e,t)=>tc(e.distance,t.distance))),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(0===e.length)return!1;if(0===this.length)return!0;const t=await Promise.all(e.map(Ho)),r=this.peerDistances[this.peerDistances.length-1].distance;for(const e of t){if(tc(rc(this.originDhtKey,e),r)<0)return!0}return!1}}class ic{components;log;routingTable;network;validators;queryManager;constructor(e,t){const{routingTable:r,network:n,validators:i,queryManager:s,lan:o}=t;this.components=e,this.routingTable=r,this.network=n,this.validators=i,this.queryManager=s,this.log=Ie(`libp2p:kad-dht:${o?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t;const r=await this.routingTable.find(e);if(null!=r){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(r)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}}if(null==t)try{t=await this.components.peerStore.get(e)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}if(null!=t)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map((e=>e.multiaddr)),protocols:[]}}async*_getValueSingle(e,t,r={}){const n=new $i(Mi.GET_VALUE,t,0);yield*this.network.sendRequest(e,n,r)}async*getPublicKeyFromNode(e,t={}){const r=function(e){return Vo([zo,e.toBytes()])}(e);for await(const s of this._getValueSingle(e,r,t))if(yield s,"PEER_RESPONSE"===s.name&&null!=s.record){const r=await br((n={bytes:s.record.value},i=void 0,ec(i=(i??"rsa").toLowerCase()),n.bytes));if(!r.equals(e))throw new Y.sv("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(null==r.publicKey)throw new Y.sv("public key missing","ERR_PUBLIC_KEY_MISSING");yield Wi({from:e,value:r.publicKey},t)}var n,i;throw new Y.sv(`Node not responding with its public key: ${e.toString()}`,"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);const r=await this.findPeerLocal(e);if(null!=r)return this.log("found local"),void(yield Fi({from:this.components.peerId,peer:r},t));const n=this,i=async function*({peer:r,signal:i}){const s=new $i(Mi.FIND_NODE,e.toBytes(),0);for await(const o of n.network.sendRequest(r,s,{...t,signal:i}))if(yield o,"PEER_RESPONSE"===o.name){const r=o.closer.find((t=>t.id.equals(e)));null!=r&&(yield Fi({from:o.from,peer:r},t))}};let s=!1;for await(const r of this.queryManager.run(e.toBytes(),i,t))"FINAL_PEER"===r.name&&(s=!0),yield r;s||(yield Gi({from:this.components.peerId,error:new Y.sv("Not found","ERR_NOT_FOUND")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const r=await Go(e),n=this.routingTable.closestPeers(r),i=this,s=new nc(r,this.routingTable.kBucketSize);await Promise.all(n.map((async e=>{await s.add(e)})));const o=async function*({peer:r,signal:n}){i.log("closerPeersSingle %s from %p",rs(e,"base32"),r);const s=new $i(Mi.FIND_NODE,e,0);yield*i.network.sendRequest(r,s,{...t,signal:n})};for await(const r of this.queryManager.run(e,o,t))yield r,"PEER_RESPONSE"===r.name&&await Promise.all(r.closer.map((async e=>{await s.add(e.id)})));this.log("found %d peers close to %b",s.length,e);for(const e of s.peers)try{const r=await this.components.peerStore.get(e);yield Fi({from:this.components.peerId,peer:{id:e,multiaddrs:r.addresses.map((({multiaddr:e})=>e)),protocols:r.protocols}},t)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}}async*getValueOrPeers(e,t,r={}){for await(const n of this._getValueSingle(e,t,r)){if("PEER_RESPONSE"===n.name&&null!=n.record)try{await this._verifyRecordOnline(n.record)}catch(e){const t="invalid record received, discarded";this.log(t),yield Gi({from:n.from,error:new Y.sv(t,"ERR_INVALID_RECORD")},r);continue}yield n}}async _verifyRecordOnline(e){if(null==e.timeReceived)throw new Y.sv("invalid record received","ERR_INVALID_RECORD");await is(this.validators,new Ui(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const r=await Go(e),n=this.routingTable.closestPeers(r),i=[];for(const e of n)if(!e.equals(t))try{const t=await this.components.peerStore.get(e);i.push({id:e,multiaddrs:t.addresses.map((({multiaddr:e})=>e)),protocols:t.protocols})}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return i.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",i.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),i}}var sc=r(70248),oc=r(36026),ac=r.n(oc),cc=r(71198);var uc,lc=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};uc=new WeakMap;var hc,dc,fc,pc,yc,gc,mc,bc,wc,vc,Ec,_c,Ac,Sc,Rc,Ic,xc,Pc,Cc,Tc,kc,Dc,Oc,Nc,Lc,Uc,Mc=class{constructor(){uc.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&lc(this,uc,"f")[this.size-1].priority>=t.priority)return void lc(this,uc,"f").push(r);const n=function(e,t,r){let n=0,i=e.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}(lc(this,uc,"f"),r,((e,t)=>t.priority-e.priority));lc(this,uc,"f").splice(n,0,r)}dequeue(){const e=lc(this,uc,"f").shift();return null==e?void 0:e.run}filter(e){return lc(this,uc,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return lc(this,uc,"f").length}},Bc=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},Kc=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class $c extends Error{}class Vc extends(ac()){constructor(e){var t,r,n,i;if(super(),hc.add(this),dc.set(this,void 0),fc.set(this,void 0),pc.set(this,0),yc.set(this,void 0),gc.set(this,void 0),mc.set(this,0),bc.set(this,void 0),wc.set(this,void 0),vc.set(this,void 0),Ec.set(this,void 0),_c.set(this,0),Ac.set(this,void 0),Sc.set(this,void 0),Rc.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Mc,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);Bc(this,dc,e.carryoverConcurrencyCount,"f"),Bc(this,fc,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),Bc(this,yc,e.intervalCap,"f"),Bc(this,gc,e.interval,"f"),Bc(this,vc,new e.queueClass,"f"),Bc(this,Ec,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Bc(this,Rc,!0===e.throwOnTimeout,"f"),Bc(this,Sc,!1===e.autoStart,"f")}get concurrency(){return Kc(this,Ac,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Bc(this,Ac,e,"f"),Kc(this,hc,"m",Nc).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:Kc(this,Rc,"f"),...t},new Promise(((r,n)=>{Kc(this,vc,"f").enqueue((async()=>{var i,s,o;Bc(this,_c,(s=Kc(this,_c,"f"),++s),"f"),Bc(this,pc,(o=Kc(this,pc,"f"),++o),"f");try{if(null===(i=t.signal)||void 0===i?void 0:i.aborted)throw new $c("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=(0,cc.ZP)(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,Kc(this,hc,"m",Lc).call(this,t.signal)]));const s=await n;r(s),this.emit("completed",s)}catch(e){if(e instanceof cc.W5&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{Kc(this,hc,"m",Pc).call(this)}}),t),this.emit("add"),Kc(this,hc,"m",kc).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return Kc(this,Sc,"f")?(Bc(this,Sc,!1,"f"),Kc(this,hc,"m",Nc).call(this),this):this}pause(){Bc(this,Sc,!0,"f")}clear(){Bc(this,vc,new(Kc(this,Ec,"f")),"f")}async onEmpty(){0!==Kc(this,vc,"f").size&&await Kc(this,hc,"m",Uc).call(this,"empty")}async onSizeLessThan(e){Kc(this,vc,"f").size<e||await Kc(this,hc,"m",Uc).call(this,"next",(()=>Kc(this,vc,"f").size<e))}async onIdle(){0===Kc(this,_c,"f")&&0===Kc(this,vc,"f").size||await Kc(this,hc,"m",Uc).call(this,"idle")}get size(){return Kc(this,vc,"f").size}sizeBy(e){return Kc(this,vc,"f").filter(e).length}get pending(){return Kc(this,_c,"f")}get isPaused(){return Kc(this,Sc,"f")}}dc=new WeakMap,fc=new WeakMap,pc=new WeakMap,yc=new WeakMap,gc=new WeakMap,mc=new WeakMap,bc=new WeakMap,wc=new WeakMap,vc=new WeakMap,Ec=new WeakMap,_c=new WeakMap,Ac=new WeakMap,Sc=new WeakMap,Rc=new WeakMap,hc=new WeakSet,Ic=function(){return Kc(this,fc,"f")||Kc(this,pc,"f")<Kc(this,yc,"f")},xc=function(){return Kc(this,_c,"f")<Kc(this,Ac,"f")},Pc=function(){var e;Bc(this,_c,(e=Kc(this,_c,"f"),--e),"f"),Kc(this,hc,"m",kc).call(this),this.emit("next")},Cc=function(){Kc(this,hc,"m",Oc).call(this),Kc(this,hc,"m",Dc).call(this),Bc(this,wc,void 0,"f")},Tc=function(){const e=Date.now();if(void 0===Kc(this,bc,"f")){const t=Kc(this,mc,"f")-e;if(!(t<0))return void 0===Kc(this,wc,"f")&&Bc(this,wc,setTimeout((()=>{Kc(this,hc,"m",Cc).call(this)}),t),"f"),!0;Bc(this,pc,Kc(this,dc,"f")?Kc(this,_c,"f"):0,"f")}return!1},kc=function(){if(0===Kc(this,vc,"f").size)return Kc(this,bc,"f")&&clearInterval(Kc(this,bc,"f")),Bc(this,bc,void 0,"f"),this.emit("empty"),0===Kc(this,_c,"f")&&this.emit("idle"),!1;if(!Kc(this,Sc,"f")){const e=!Kc(this,hc,"a",Tc);if(Kc(this,hc,"a",Ic)&&Kc(this,hc,"a",xc)){const t=Kc(this,vc,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&Kc(this,hc,"m",Dc).call(this),!0)}}return!1},Dc=function(){Kc(this,fc,"f")||void 0!==Kc(this,bc,"f")||(Bc(this,bc,setInterval((()=>{Kc(this,hc,"m",Oc).call(this)}),Kc(this,gc,"f")),"f"),Bc(this,mc,Date.now()+Kc(this,gc,"f"),"f"))},Oc=function(){0===Kc(this,pc,"f")&&0===Kc(this,_c,"f")&&Kc(this,bc,"f")&&(clearInterval(Kc(this,bc,"f")),Bc(this,bc,void 0,"f")),Bc(this,pc,Kc(this,dc,"f")?Kc(this,_c,"f"):0,"f"),Kc(this,hc,"m",Nc).call(this)},Nc=function(){for(;Kc(this,hc,"m",kc).call(this););},Lc=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new $c("The task was aborted."))}),{once:!0})}))},Uc=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var jc=Vc;const zc=Ie("libp2p:kad-dht:providers");class qc{components;cache;cleanupInterval;provideValidity;syncQueue;started;cleaner;constructor(e,t={}){const{cacheSize:r,cleanupInterval:n,provideValidity:i}=t;this.components=e,this.cleanupInterval=n??36e5,this.provideValidity=i??864e5,this.cache=sc(r??256),this.syncQueue=new jc({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval((()=>{this._cleanup().catch((e=>{zc.error(e)}))}),this.cleanupInterval))}async stop(){this.started=!1,null!=this.cleaner&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add((async()=>{const e=Date.now();let t=0,r=0;const n=new Map,i=this.components.datastore.batch(),s=this.components.datastore.query({prefix:Ue});for await(const e of s)try{const{cid:s,peerId:o}=Gc(e.key),a=Hc(e.value).getTime(),c=Date.now(),u=c-a,l=u>this.provideValidity;if(zc("comparing: %d - %d = %d > %d %s",c,a,u,this.provideValidity,l?"(expired)":""),l){r++,i.delete(e.key);const t=n.get(s)??new Set;t.add(o),n.set(s,t)}t++}catch(e){zc.error(e.message)}n.size>0?(zc("deleting %d / %d entries",r,t),await i.commit()):zc("nothing to delete");for(const[e,t]of n){const r=Fc(e),n=this.cache.get(r);if(null!=n){for(const e of t)n.delete(e);0===n.size?this.cache.remove(r):this.cache.set(r,n)}}zc("Cleanup successful (%dms)",Date.now()-e)}))}async _getProvidersMap(e){const t=Fc(e);let r=this.cache.get(t);return null==r&&(r=await async function(e,t){const r=new Map,n=e.query({prefix:Fc(t)});for await(const e of n){const{peerId:t}=Gc(e.key);r.set(t,Hc(e.value))}return r}(this.components.datastore,e),this.cache.set(t,r)),r}async addProvider(e,t){await this.syncQueue.add((async()=>{zc("%p provides %s",t,e);const r=await this._getProvidersMap(e);zc("loaded %s provs",r.size);const n=new Date;r.set(t.toString(),n);const i=Fc(e);this.cache.set(i,r),await async function(e,t,r,n){const i=[Fc(t),"/",r.toString()].join(""),s=new $o(i),o=Jn.cv(n.getTime());await e.put(s,o)}(this.components.datastore,e,t,n)}))}async getProviders(e){return this.syncQueue.add((async()=>{zc("get providers for %s",e);return[...(await this._getProvidersMap(e)).keys()].map((e=>gr(e)))}),{throwOnTimeout:!0})}}function Fc(e){const t="string"==typeof e?e:rs(e.multihash.bytes,"base32");return`${Ue}/${t}`}function Gc(e){const t=e.toString().split("/");if(5!==t.length)throw new Error(`incorrectly formatted provider entry key in datastore: ${e.toString()}`);return{cid:t[3],peerId:t[4]}}function Hc(e){return new Date(Jn.Jx(e))}var Wc=r(17187),Yc=r(25975);function Qc(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e){if(!0===t?.aborted){r();break}null!=t?.addEventListener&&t.addEventListener("abort",r)}const n=t.signal;return n.clear=function(){for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)},n}const Jc=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*Zc(e){const{key:t,startingPeer:r,ourPeerId:n,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,cleanUp:u,queryFuncTimeout:l,log:h,peersSeen:d}=e,f=new jc({concurrency:o}),p=await Go(t);!function r(o,u){if(null==o)return;d.add(o);const y=BigInt("0x"+rs(rc(u,p),"base16"));f.add((async()=>{const u=[i];null!=l&&u.push(AbortSignal.timeout(l));const g=Qc(u);try{for await(const e of s({key:t,peer:o,signal:g,pathIndex:a,numPaths:c})){if(g.aborted)return;if("PEER_RESPONSE"===e.name)for(const i of e.closer){if(d.has(i.id)){h("already seen %p in query",i.id);continue}if(n.equals(i.id)){h("not querying ourselves");continue}const e=await Ho(i.id);BigInt("0x"+rs(rc(e,p),"base16"))>y?h("skipping %p as they are not closer to %b than %p",i.id,t,o):(h("querying closer peer %p",i.id),r(i.id,e))}f.emit("completed",e)}}catch(t){if(!i.aborted)return Gi({from:o,error:t},e)}finally{g.clear()}}),{priority:Jc-y}).catch((e=>{h.error(e)}))}(r,await Ho(r)),yield*async function*(e,t,r,n){let i=(0,Pe.Z)(),s=!0;const o=[],a=()=>{s&&(n("clean up queue, results %d, queue size %d, pending tasks %d",o.length,e.size,e.pending),s=!1,e.clear(),o.splice(0,o.length))};e.on("completed",(e=>{o.push(e),i.resolve()})),e.on("error",(e=>{n("queue error",e),a(),i.reject(e)})),e.on("idle",(()=>{n("queue idle"),s=!1,i.resolve()})),t.addEventListener("abort",(()=>{n("abort queue");const e=s;a(),e&&i.reject(new Y.sv("Query aborted","ERR_QUERY_ABORTED"))})),r.addEventListener("cleanup",(()=>{a(),i.resolve()}));for(;s;)for(await i.promise,i=(0,Pe.Z)();o.length>0;){const e=o.shift();null!=e&&(yield e)}yield*o}(f,i,u,h)}class Xc{components;lan;disjointPaths;alpha;shutDownController;running;queries;metrics;routingTable;initialQuerySelfHasRun;constructor(e,t){const{lan:r=!1,disjointPaths:n=Me,alpha:i=Be}=t;this.components=e,this.disjointPaths=n??Me,this.running=!1,this.alpha=i??Be,this.lan=r,this.queries=0,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.shutDownController=new AbortController;try{null!=Wc.setMaxListeners&&(0,Wc.setMaxListeners)(1/0,this.shutDownController.signal)}catch{}}isStarted(){return this.running}async start(){this.running=!0,null!=this.components.metrics&&null==this.metrics&&(this.metrics={runningQueries:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_running_queries`),queryTime:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_query_time_seconds`)})}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,r={}){if(!this.running)throw new Error("QueryManager not started");const n=this.metrics?.queryTime.timer();if(null==r.signal){r.signal=AbortSignal.timeout(qe);try{null!=Wc.setMaxListeners&&(0,Wc.setMaxListeners)(1/0,r.signal)}catch{}}const i=Qc([this.shutDownController.signal,r.signal]);try{null!=Wc.setMaxListeners&&(0,Wc.setMaxListeners)(1/0,i)}catch{}const s=Ie(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+rs(e,"base58btc")),o=Date.now(),a=new Q.v;try{!0!==r.isSelfQuery&&null!=this.initialQuerySelfHasRun&&(s("waiting for initial query-self query before continuing"),await Promise.race([new Promise(((e,t)=>{i.addEventListener("abort",(()=>{t(new Y._L("Query was aborted before self-query ran"))}))})),this.initialQuerySelfHasRun.promise]),this.initialQuerySelfHasRun=void 0),s("query:start"),this.queries++,this.metrics?.runningQueries.update(this.queries);const n=await Go(e),o=this.routingTable.closestPeers(n),c=o.slice(0,Math.min(this.disjointPaths,o.length));if(0===o.length)return void s.error("Running query with no peers");const u=new Yc.fd,l=c.map(((n,o)=>Zc({key:e,startingPeer:n,ourPeerId:this.components.peerId,signal:i,query:t,pathIndex:o,numPaths:c.length,alpha:this.alpha,cleanUp:a,queryFuncTimeout:r.queryFuncTimeout,log:s,peersSeen:u,onProgress:r.onProgress})));for await(const e of Oe(...l))yield e,"QUERY_ERROR"===e.name&&s("error",e.error)}catch(e){if(this.running||"ERR_QUERY_ABORTED"!==e.code)throw e}finally{i.clear(),this.queries--,this.metrics?.runningQueries.update(this.queries),null!=n&&n(),a.dispatchEvent(new Q.A("cleanup")),s("query:done in %dms",Date.now()-o)}}}var eu=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t=0;for await(const r of e)t++;return t})();{let t=0;for(const r of e)t++;return t}};var tu=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}():function*(){let r=0;if(!(t<1))for(const n of e)if(yield n,r++,r===t)return}()},ru=r(90954);class nu{log;components;peerRouting;routingTable;count;interval;initialInterval;queryTimeout;started;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){const{peerRouting:r,lan:n,count:i,interval:s,queryTimeout:o,routingTable:a}=t;this.components=e,this.log=Ie(`libp2p:kad-dht:${n?"lan":"wan"}:query-self`),this.started=!1,this.peerRouting=r,this.routingTable=a,this.count=i??Me,this.interval=s??Ke,this.initialInterval=t.initialInterval??$e,this.queryTimeout=o??Ve,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun}isStarted(){return this.started}start(){this.started||(this.started=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>{this.querySelf().catch((e=>{this.log.error("error running self-query",e)}))}),this.initialInterval))}stop(){this.started=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}async querySelf(){if(this.started){if(null!=this.querySelfPromise)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=(0,Pe.Z)(),0===this.routingTable.size&&await(0,ru.yM)(this.routingTable,"peer:add"),this.started){this.controller=new AbortController;const e=Qc([this.controller.signal,AbortSignal.timeout(this.queryTimeout)]);try{null!=Wc.setMaxListeners&&(0,Wc.setMaxListeners)(1/0,e)}catch{}try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const t=await(0,We.z)(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:e,isSelfQuery:!0}),(e=>tu(e,this.count)),(async e=>eu(e)));this.log("self-query ran successfully - found %d peers",t),null!=this.initialQuerySelfHasRun&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}catch(e){this.log.error("self-query error",e)}finally{e.clear()}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.started&&(this.timeoutId=setTimeout((()=>{this.querySelf().catch((e=>{this.log.error("error running self-query",e)}))}),this.interval))}else this.log("skip self-query because we are not started")}}function iu(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function su(e,t){if(!(t instanceof Uint8Array))throw new TypeError(e+" is not a Uint8Array")}class ou extends Q.v{localNodeId;root;numberOfNodesPerKBucket;numberOfNodesToPing;distance;arbiter;constructor(e){super(),this.localNodeId=e.localNodeId,this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket??20,this.numberOfNodesToPing=e.numberOfNodesToPing??3,this.distance=e.distance??ou.distance,this.arbiter=e.arbiter??ou.arbiter,su("option.localNodeId as parameter 1",this.localNodeId),this.root={contacts:[],dontSplit:!1,left:null,right:null}}static arbiter(e,t){return(e.vectorClock??0)>(t.vectorClock??0)?e:t}static distance(e,t){let r=0,n=0;const i=Math.min(e.length,t.length),s=Math.max(e.length,t.length);for(;n<i;++n)r=256*r+(e[n]^t[n]);for(;n<s;++n)r=256*r+255;return r}add(e){su("contact.id",e?.id);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e.id,t++);const n=this._indexOf(r,e.id);return n>=0?(this._update(r,n,e),this):r.contacts.length<this.numberOfNodesPerKBucket?(r.contacts.push(e),this.safeDispatchEvent("added",{detail:e}),this):r.dontSplit?(this.safeDispatchEvent("ping",{detail:{oldContacts:r.contacts.slice(0,this.numberOfNodesToPing),newContact:e}}),this):(this._split(r,t),this.add(e))}closest(e,t=1/0){if(su("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let r=[];for(let n=[this.root],i=0;n.length>0&&r.length<t;){const t=n.pop();if(null!=t)if(null===t.contacts){const r=this._determineNode(t,e,i++);n.push(t.left===r?t.right:t.left),n.push(r)}else r=r.concat(t.contacts)}return r.map((t=>({distance:this.distance(t.id,e),contact:t}))).sort(((e,t)=>e.distance-t.distance)).slice(0,t).map((e=>e.contact))}count(){let e=0;for(const t=[this.root];t.length>0;){const r=t.pop();null!=r&&(null===r.contacts?t.push(r.right,r.left):e+=r.contacts.length)}return e}_determineNode(e,t,r){const n=r>>3,i=r%8;if(t.length<=n&&0!==i)return e.left;return 0!=(t[n]&1<<7-i)?e.right:e.left}get(e){su("id",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);return n>=0?r.contacts[n]:void 0}_indexOf(e,t){for(let r=0;r<e.contacts.length;++r)if(iu(e.contacts[r].id,t))return r;return-1}remove(e){su("the id as parameter 1",e);let t=0,r=this.root;for(;null===r.contacts;)r=this._determineNode(r,e,t++);const n=this._indexOf(r,e);if(n>=0){const e=r.contacts.splice(n,1)[0];this.safeDispatchEvent("removed",{detail:e})}return this}_split(e,t){e.left={contacts:[],dontSplit:!1,left:null,right:null},e.right={contacts:[],dontSplit:!1,left:null,right:null};for(const r of e.contacts)this._determineNode(e,r.id,t).contacts.push(r);e.contacts=null;const r=this._determineNode(e,this.localNodeId,t);(e.left===r?e.right:e.left).dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const r=t.pop();null!=r&&(null===r.contacts?t.push(r.right,r.left):e=e.concat(r.contacts))}return e}*toIterable(){for(const e=[this.root];e.length>0;){const t=e.pop();null!=t&&(null===t.contacts?e.push(t.right,t.left):yield*t.contacts)}}_update(e,t,r){if(!iu(e.contacts[t].id,r.id))throw new Error("wrong index for _update");const n=e.contacts[t],i=this.arbiter(n,r);i===n&&n!==r||(e.contacts.splice(t,1),e.contacts.push(i),this.safeDispatchEvent("updated",{detail:{incumbent:n,selection:i}}))}}class au extends Q.v{kBucketSize;kb;pingQueue;log;components;lan;pingTimeout;pingConcurrency;running;protocol;tagName;tagValue;metrics;constructor(e,t){super();const{kBucketSize:r,pingTimeout:n,lan:i,pingConcurrency:s,protocol:o,tagName:a,tagValue:c}=t;this.components=e,this.log=Ie(`libp2p:kad-dht:${i?"lan":"wan"}:routing-table`),this.kBucketSize=r??20,this.pingTimeout=n??1e4,this.pingConcurrency=s??10,this.lan=i,this.running=!1,this.protocol=o,this.tagName=a??"kad-close",this.tagValue=c??50;const u=()=>{this.metrics?.pingQueueSize.update(this.pingQueue.size),this.metrics?.pingRunning.update(this.pingQueue.pending)};this.pingQueue=new jc({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",u),this.pingQueue.addListener("next",u),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0,null!=this.components.metrics&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_routing_table_size`),pingQueueSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_queue_size`),pingRunning:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_running`)});const e=new ou({localNodeId:await Ho(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.addEventListener("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new Yc.fd;const r=function(e,t=100){let r;return()=>{clearTimeout(r),r=setTimeout((()=>{e()}),t)}}((()=>{const r=new Yc.fd(e.closest(e.localNodeId,20).map((e=>e.peer))),n=r.difference(t),i=t.difference(r);Promise.resolve().then((async()=>{for(const e of n)await this.components.peerStore.merge(e,{tags:{[this.tagName]:{value:this.tagValue}}});for(const e of i)await this.components.peerStore.merge(e,{tags:{[this.tagName]:void 0}})})).catch((e=>{this.log.error("Could not update peer tags",e)})),t=r}));e.addEventListener("added",(e=>{r(),this.safeDispatchEvent("peer:add",{detail:e.detail.peer})})),e.addEventListener("removed",(e=>{r(),this.safeDispatchEvent("peer:remove",{detail:e.detail.peer})}))}_onPing(e){const{oldContacts:t,newContact:r}=e.detail;this.pingQueue.add((async()=>{if(!this.running)return;let e=0;try{await Promise.all(t.map((async t=>{try{const r={signal:AbortSignal.timeout(this.pingTimeout)};this.log("pinging old contact %p",t.peer);const n=await this.components.connectionManager.openConnection(t.peer,r),i=await n.newStream(this.protocol,r);await i.close(),e++}catch(e){this.running&&null!=this.kb&&(this.log.error("could not ping peer %p",t.peer,e),this.log("evicting old contact after ping failed %p",t.peer),this.kb.remove(t.id))}finally{this.metrics?.routingTableSize.update(this.size)}}))),this.running&&e<t.length&&null!=this.kb&&(this.log("adding new contact %p",r.peer),this.kb.add(r))}catch(e){this.log.error("could not process k-bucket ping event",e)}})).catch((e=>{this.log.error("could not process k-bucket ping event",e)}))}get size(){return null==this.kb?0:this.kb.count()}async find(e){const t=await Ho(e),r=this.closestPeer(t);if(null!=r&&e.equals(r))return r}closestPeer(e){const t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){if(null==this.kb)return[];return this.kb.closest(e,t).map((e=>e.peer))}async add(e){if(null==this.kb)throw new Error("RoutingTable is not started");const t=await Ho(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),this.metrics?.routingTableSize.update(this.size)}async remove(e){if(null==this.kb)throw new Error("RoutingTable is not started");const t=await Ho(e);this.kb.remove(t),this.metrics?.routingTableSize.update(this.size)}}var cu=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];class uu{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e){const{peerRouting:t,routingTable:r,refreshInterval:n,refreshQueryTimeout:i,lan:s}=e;this.log=Ie(`libp2p:kad-dht:${s?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=r,this.refreshInterval=n??je,this.refreshQueryTimeout=i??ze,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),r=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${r.map((e=>e.toISOString())).join(", ")} ]`),Promise.all(r.map((async(n,i)=>{try{if(await this._refreshCommonPrefixLength(i,n,e),0===this._numPeersForCpl(t)){const t=Math.min(2*(i+1),r.length-1);for(let r=i+1;r<t+1;r++)try{await this._refreshCommonPrefixLength(r,n,e)}catch(e){this.log.error(e)}}}catch(e){this.log.error(e)}}))).catch((e=>{this.log.error(e)})).then((()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()})).catch((e=>{this.log.error(e)}))}async _refreshCommonPrefixLength(e,t,r){if(!r&&t.getTime()>Date.now()-this.refreshInterval)return void this.log("not running refresh for cpl %s as time since last refresh not above interval",e);const n=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,n,this.routingTable.size);const i=await eu(this.peerRouting.getClosestPeers(n.toBytes(),{signal:AbortSignal.timeout(this.refreshQueryTimeout)}));this.log(`found ${i} peers that were close to imaginary peer %p`,n),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,n,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>15&&(e=15);const t=[];for(let r=0;r<=e;r++)t[r]=this.commonPrefixLengthRefreshedAt[r]??new Date;return t}async _generateRandomPeerId(e){if(null==this.routingTable.kb)throw new Error("Routing table not started");const t=ka(2),r=(t[1]<<8)+t[0];return mr(await this._makePeerId(this.routingTable.kb.localNodeId,r,e))}async _makePeerId(e,t,r){if(r>15)throw new Error("Cannot generate peer ID for common prefix length greater than 15");const n=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1),i=65535<<16-(r+1),s=cu[(n^32768>>r)&i|t&~i],o=new ArrayBuffer(34),a=new DataView(o,0,o.byteLength);return a.setUint8(0,Ht.code),a.setUint8(1,32),a.setUint32(2,s,!1),new Uint8Array(a.buffer,a.byteOffset,a.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const r of this._prefixLengths())r===e&&t++;return t}*_prefixLengths(){if(null!=this.routingTable.kb)for(const{id:e}of this.routingTable.kb.toIterable()){const t=rc(this.routingTable.kb.localNodeId,e);let r=0;for(const e of t){if(0!==e)break;r++}yield r}}}const lu=Ie("libp2p:kad-dht:rpc:handlers:add-provider");class hu{providers;constructor(e){const{providers:t}=e;this.providers=t}async handle(e,t){if(lu("start"),null==t.key||0===t.key.length)throw new Y.sv("Missing key","ERR_MISSING_KEY");let r;try{r=Zt.decode(t.key)}catch(e){throw new Y.sv("Invalid CID","ERR_INVALID_CID")}null!=t.providerPeers&&0!==t.providerPeers.length||lu.error("no providers found in message"),await Promise.all(t.providerPeers.map((async t=>{t.id.equals(e)?t.multiaddrs.length<1?lu("no valid addresses for provider %p. Ignore",e):(lu("received provider %p for %s (addrs %s)",e,r,t.multiaddrs.map((e=>e.toString()))),await this.providers.addProvider(r,t.id)):lu("invalid provider peer %p from %p",t.id,e)})))}}const du=Ie("libp2p:kad-dht:rpc:handlers:find-node");class fu{peerRouting;lan;components;constructor(e,t){const{peerRouting:r,lan:n}=t;this.components=e,this.peerRouting=r,this.lan=Boolean(n)}async handle(e,t){du("incoming request from %p for peers closer to %b",e,t.key);let r=[];r=Ye(this.components.peerId.toBytes(),t.key)?[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(ci("p2p").code))),protocols:[]}]:await this.peerRouting.getCloserPeersOffline(t.key,e),r=r.map(this.lan?Fo:qo).filter((({multiaddrs:e})=>e.length));const n=new $i(t.type,new Uint8Array(0),t.clusterLevel);return r.length>0?n.closerPeers=r:du("could not find any peers closer to %b than %p",t.key,e),n}}const pu=Ie("libp2p:kad-dht:rpc:handlers:get-providers");class yu{components;peerRouting;providers;lan;constructor(e,t){const{peerRouting:r,providers:n,lan:i}=t;this.components=e,this.peerRouting=r,this.providers=n,this.lan=Boolean(i)}async handle(e,t){let r;try{r=Zt.decode(t.key)}catch(e){throw new Y.sv("Invalid CID","ERR_INVALID_CID")}pu("%p asking for providers for %s",e,r);const[n,i]=await Promise.all([this.providers.getProviders(r),this.peerRouting.getCloserPeersOffline(t.key,e)]),s=await this._getPeers(n),o=await this._getPeers(i.map((({id:e})=>e))),a=new $i(t.type,t.key,t.clusterLevel);return s.length>0&&(a.providerPeers=s),o.length>0&&(a.closerPeers=o),pu("got %s providers %s closerPeers",s.length,o.length),a}async _getAddresses(e){return[]}async _getPeers(e){const t=[],r=this.lan?Fo:qo;for(const n of e)try{const e=await this.components.peerStore.get(n),i=r({id:n,multiaddrs:e.addresses.map((({multiaddr:e})=>e)),protocols:e.protocols});i.multiaddrs.length>0&&t.push(i)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return t}}const gu=Ie("libp2p:kad-dht:rpc:handlers:get-value");class mu{components;peerRouting;constructor(e,t){const{peerRouting:r}=t;this.components=e,this.peerRouting=r}async handle(e,t){const r=t.key;if(gu("%p asked for key %b",e,r),null==r||0===r.length)throw new Y.sv("Invalid key","ERR_INVALID_KEY");const n=new $i(Mi.GET_VALUE,r,t.clusterLevel);if(function(e){return"/pk/"===rs(e.subarray(0,4))}(r)){gu("is public key");const e=function(e){return mr(e.subarray(4))}(r);let t;try{const r=await this.components.peerStore.get(e);if(null==r.id.publicKey)throw new Y.sv("No public key found in key book","ERR_NOT_FOUND");t=r.id.publicKey}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}if(null!=t)return gu("returning found public key"),n.record=new Ui(r,t,new Date),n}const[i,s]=await Promise.all([this._checkLocalDatastore(r),this.peerRouting.getCloserPeersOffline(t.key,e)]);return null!=i&&(gu("had record for %b in local datastore",r),n.record=i),s.length>0&&(gu("had %s closer peers in routing table",s.length),n.closerPeers=s),n}async _checkLocalDatastore(e){gu("checkLocalDatastore looking for %b",e);const t=Wo(e);let r;try{r=await this.components.datastore.get(t)}catch(e){if("ERR_NOT_FOUND"===e.code)return;throw e}const n=Ui.deserialize(r);if(null==n)throw new Y.sv("Invalid record","ERR_INVALID_RECORD");if(!(null==n.timeReceived||Date.now()-n.timeReceived.getTime()>1296e5))return n;await this.components.datastore.delete(t)}}const bu=Ie("libp2p:kad-dht:rpc:handlers:ping");class wu{async handle(e,t){return bu("ping from %p",e),t}}class vu{log;components;validators;constructor(e,t){const{validators:r}=t;this.components=e,this.log=Ie("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=r}async handle(e,t){const r=t.key;this.log("%p asked us to store value for key %b",e,r);const n=t.record;if(null==n){const t=`Empty record from: ${e.toString()}`;throw this.log.error(t),new Y.sv(t,"ERR_EMPTY_RECORD")}try{await is(this.validators,n),n.timeReceived=new Date;const e=Wo(n.key);await this.components.datastore.put(e,n.serialize().subarray()),this.log("put record for %b into datastore under key %k",r,e)}catch(e){this.log("did not put record for key %b into datastore %o",r,e)}return t}}class Eu{handlers;routingTable;log;constructor(e,t){const{providers:r,peerRouting:n,validators:i,lan:s}=t;this.log=Ie("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[Mi.GET_VALUE]:new mu(e,{peerRouting:n}),[Mi.PUT_VALUE]:new vu(e,{validators:i}),[Mi.FIND_NODE]:new fu(e,{peerRouting:n,lan:s}),[Mi.ADD_PROVIDER]:new hu({providers:r}),[Mi.GET_PROVIDERS]:new yu(e,{peerRouting:n,providers:r,lan:s}),[Mi.PING]:new wu}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(e){this.log.error("Failed to update the kbucket store",e)}const r=this.handlers[t.type];if(null!=r)return r.handle(e,t);this.log.error(`no handler found for message type: ${t.type}`)}onIncomingStream(e){Promise.resolve().then((async()=>{const{stream:t,connection:r}=e,n=r.remotePeer;try{await this.routingTable.add(n)}catch(e){this.log.error(e)}const i=this;await(0,We.z)(t,(e=>na.J(e)),(async function*(e){for await(const t of e){const e=$i.deserialize(t);i.log("incoming %s from %p",e.type,n);const r=await i.handleMessage(n,e);null!=r&&(yield r.serialize())}}),(e=>na.c(e)),t)})).catch((e=>{this.log.error(e)}))}}class _u extends Q.v{log;components;protocol;running;registrarId;constructor(e,t){super();const{protocol:r,lan:n}=t;this.components=e,this.log=Ie("libp2p:kad-dht:topology-listener:"+(n?"lan":"wan")),this.running=!1,this.protocol=r}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new Q.A("peer",{detail:e}))}}))}async stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class Au extends Q.v{protocol;routingTable;providers;network;peerRouting;components;log;running;kBucketSize;clientMode;lan;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;constructor(e,t){super();const{kBucketSize:r,clientMode:n,validators:i,selectors:s,querySelfInterval:o,lan:a,protocolPrefix:c,pingTimeout:u,pingConcurrency:l,maxInboundStreams:h,maxOutboundStreams:d,providers:f}=t;this.running=!1,this.components=e,this.lan=Boolean(a),this.log=Ie("libp2p:kad-dht:"+(!0===a?"lan":"wan")),this.protocol=`${c??"/ipfs"}${!0===a?"/lan":""}/kad/1.0.0`,this.kBucketSize=r??20,this.clientMode=n??!0,this.maxInboundStreams=h??32,this.maxOutboundStreams=d??64,this.routingTable=new au(e,{kBucketSize:r,lan:this.lan,pingTimeout:u,pingConcurrency:l,protocol:this.protocol}),this.providers=new qc(e,f??{}),this.validators={...ss,...i},this.selectors={...ns,...s},this.network=new ia(e,{protocol:this.protocol,lan:this.lan});const p=(0,Pe.Z)();!0===t.allowQueryWithZeroPeers&&p.resolve(),this.queryManager=new Xc(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:a,initialQuerySelfHasRun:p,routingTable:this.routingTable}),this.peerRouting=new ic(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new Qo(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,lan:this.lan}),this.contentRouting=new Jo(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new uu({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new Eu(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new _u(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new nu(e,{peerRouting:this.peerRouting,interval:o,initialInterval:t.initialQuerySelfInterval,lan:this.lan,initialQuerySelfHasRun:p,routingTable:this.routingTable}),this.network.addEventListener("peer",(e=>{const t=e.detail;this.onPeerConnect(t).catch((e=>{this.log.error("could not add %p to routing table",t.id,e)})),this.dispatchEvent(new Q.A("peer",{detail:t}))})),this.topologyListener.addEventListener("peer",(e=>{const t=e.detail;Promise.resolve().then((async()=>{const e=await this.components.peerStore.get(t),r={id:t,multiaddrs:e.addresses.map((({multiaddr:e})=>e)),protocols:e.protocols};await this.onPeerConnect(r)})).catch((e=>{this.log.error("could not add %p to routing table",t,e)}))}))}async onPeerConnect(e){if(this.log("peer %p connected with protocols",e.id,e.protocols),0!==(e=this.lan?Fo(e):qo(e)).multiaddrs.length)try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}else this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map((e=>e.toString())))}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),"client"===e?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start()]),this.querySelf.start(),await this.routingTableRefresh.start()}async stop(){this.running=!1,this.querySelf.stop(),await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop()])}async*put(e,t,r={}){yield*this.contentFetching.put(e,t,r)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}const Su=Ie("libp2p:kad-dht");class Ru{dht;constructor(e){this.dht=e}async provide(e,t={}){await xe(this.dht.provide(e,t))}async*findProviders(e,t={}){for await(const r of this.dht.findProviders(e,t))"PROVIDER"===r.name&&(yield*r.providers)}async put(e,t,r){await xe(this.dht.put(e,t,r))}async get(e,t){for await(const r of this.dht.get(e,t))if("VALUE"===r.name)return r.value;throw new Y.sv("Not found","ERR_NOT_FOUND")}}class Iu{dht;constructor(e){this.dht=e}async findPeer(e,t={}){for await(const r of this.dht.findPeer(e,t))if("FINAL_PEER"===r.name)return r.peer;throw new Y.sv("Not found","ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){for await(const r of this.dht.getClosestPeers(e,t))"FINAL_PEER"===r.name&&(yield r.peer)}}class xu extends Q.v{wan;lan;components;contentRouting;peerRouting;constructor(e,t={}){super(),this.components=e,this.wan=new Au(e,{protocolPrefix:"/ipfs",...t,lan:!1}),this.lan=new Au(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}),this.contentRouting=new Ru(this),this.peerRouting=new Iu(this),this.wan.addEventListener("peer",(e=>{this.dispatchEvent(new Q.A("peer",{detail:e.detail}))})),this.lan.addEventListener("peer",(e=>{this.dispatchEvent(new Q.A("peer",{detail:e.detail}))})),null==t.clientMode&&e.events.addEventListener("self:peer:update",(e=>{Su("received update of self-peer info");const t=e.detail.peer.addresses.some((({multiaddr:e})=>{const t=function(e){const t=e.stringTuples();for(const e of t)if(290===e[0])return!1;if(54===t[0][0]||55===t[0][0]||56===t[0][0])return Su("%m is public %s",e,!0),!0;if(4===t[0][0]||41===t[0][0]){const r=(0,Ne.Z)(`${t[0][1]}`),n=null==r||!r;return Su("%m is public %s",e,n),n}return!1}(e);return Su("%m is public %s",e,t),t}));this.getMode().then((async e=>{t&&"client"===e?await this.setMode("server"):"server"!==e||t||await this.setMode("client")})).catch((e=>{Su.error("error setting dht server mode",e)}))}))}[Symbol.toStringTag]="@libp2p/dual-kad-dht";get[W.J](){return this.contentRouting}get[Z.z](){return this.peerRouting}get[J.O](){return this}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,r={}){for await(const n of Oe(this.lan.put(e,t,r),this.wan.put(e,t,r)))yield n}async*get(e,t={}){let r=!1,n=!1;for await(const i of Oe(this.lan.get(e,t),this.wan.get(e,t)))yield i,"DIAL_PEER"===i.name&&(r=!0),"VALUE"===i.name&&(r=!0,null!=i.value&&(n=!0)),"SEND_QUERY"===i.name&&(r=!0);if(!r)throw new Y.sv("No peers found in routing table!","ERR_NO_PEERS_IN_ROUTING_TABLE");n||(yield Gi({from:this.components.peerId,error:new Y.sv("Not found","ERR_NOT_FOUND")},t))}async*provide(e,t={}){let r=0,n=0;const i=[],s=[this.lan];"server"===await this.wan.getMode()&&s.push(this.wan);for await(const o of Oe(...s.map((r=>r.provide(e,t)))))yield o,"SEND_QUERY"===o.name&&r++,"QUERY_ERROR"===o.name&&i.push(o.error),"PEER_RESPONSE"===o.name&&"ADD_PROVIDER"===o.messageName&&(Su("sent provider record for %s to %p",e,o.from),n++);if(0===n){if(i.length>0)throw new Y.sv(`Failed to provide to ${i.length} of ${r} peers`,"ERR_PROVIDES_FAILED",{errors:i});throw new Y.sv("Failed to provide - no peers found","ERR_PROVIDES_FAILED")}}async*findProviders(e,t={}){yield*Oe(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let r=!1;for await(const n of Oe(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield n,"SEND_QUERY"!==n.name&&"FINAL_PEER"!==n.name||(r=!0);if(!r)throw new Y.sv("Peer lookup failed","ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*Oe(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}}var Pu,Cu;function Tu(e){return t=>new xu(t,e)}!function(e){e[e.SEND_QUERY=0]="SEND_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADD_PEER=6]="ADD_PEER",e[e.DIAL_PEER=7]="DIAL_PEER"}(Pu||(Pu={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(Cu||(Cu={}))},69860:function(e,t,r){"use strict";r.d(t,{kg:function(){return a}});var n=r(11227),i=r(81653),s=r(14249),o=r(99382);function a(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return n.enabled(`${e}:trace`)&&null!=n.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=n(`${e}:trace`)),Object.assign(n(e),{error:n(`${e}:error`),trace:t})}n.formatters.b=e=>null==e?"undefined":i.base58btc.baseEncode(e),n.formatters.t=e=>null==e?"undefined":s.base32.baseEncode(e),n.formatters.m=e=>null==e?"undefined":o.base64.baseEncode(e),n.formatters.p=e=>null==e?"undefined":e.toString(),n.formatters.c=e=>null==e?"undefined":e.toString(),n.formatters.k=e=>null==e?"undefined":e.toString()},75306:function(e,t,r){"use strict";r.d(t,{R:function(){return D}});var n,i=r(37430),s=r(28391),o=r(59379),a=r(62308);function c(e){return new Uint8Array(e)}!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(n||(n={}));const u=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),l=Object.freeze({NEW_STREAM:n.NEW_STREAM,MESSAGE:n.MESSAGE_INITIATOR,CLOSE:n.CLOSE_INITIATOR,RESET:n.RESET_INITIATOR}),h=Object.freeze({MESSAGE:n.MESSAGE_RECEIVER,CLOSE:n.CLOSE_RECEIVER,RESET:n.RESET_RECEIVER});var d=r(61063);const f=10240;const p=new class{constructor(){this._pool=c(f),this._poolOffset=0}write(e,t){const r=this._pool;let i=this._poolOffset;o.encode(e.id<<3|e.type,r,i),i+=o.encode.bytes??0,e.type!==n.NEW_STREAM&&e.type!==n.MESSAGE_INITIATOR&&e.type!==n.MESSAGE_RECEIVER||null==e.data?o.encode(0,r,i):o.encode(e.data.length,r,i),i+=o.encode.bytes??0;const s=r.subarray(this._poolOffset,i);f-i<100?(this._pool=c(f),this._poolOffset=0):this._poolOffset=i,t.append(s),e.type!==n.NEW_STREAM&&e.type!==n.MESSAGE_INITIATOR&&e.type!==n.MESSAGE_RECEIVER||null==e.data||t.append(e.data)}};const y=1<<20;class g{constructor(e=y,t=4194304){this._buffer=new a.H,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){if("ERR_MSG_TOO_BIG"===e.code)throw e;break}const{id:e,type:r,length:i,offset:s}=this._headerInfo;if(this._buffer.length-s<i)break;const o={id:e,type:r};r!==n.NEW_STREAM&&r!==n.MESSAGE_INITIATOR&&r!==n.MESSAGE_RECEIVER||(o.data=this._buffer.sublist(s,s+i)),t.push(o),this._buffer.consume(s+i),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:r}=w(e),{value:n,offset:i}=w(e,r),s=7&t;if(null==u[s])throw new Error(`Invalid type received: ${s}`);if(n>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:s,offset:r+i,length:n}}}const m=128,b=127;function w(e,t=0){let r,n=0,i=0,s=t;const o=e.length;do{if(s>=o||i>49)throw t=0,new RangeError("Could not decode varint");r=e.get(s++),n+=i<28?(r&b)<<i:(r&b)*Math.pow(2,i),i+=7}while(r>=m);return{value:n,offset:t=s-t}}var v=r(52770),E=r(32044),_=r(77408),A=r(69860);const S=(0,A.kg)("libp2p:mplex:stream"),R="ERR_STREAM_RESET";var I=r(738),x=r(8558);const P=(0,A.kg)("libp2p:mplex");function C(e){const t={...e,type:`${u[e.type]} (${e.type})`};return e.type===n.NEW_STREAM&&(t.data=(0,I.BB)(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==n.MESSAGE_INITIATOR&&e.type!==n.MESSAGE_RECEIVER||(t.data=(0,I.BB)(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class T{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();const t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new x.RateLimiterMemory({points:e.disconnectThreshold??5,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}close(e){this.closeController.signal.aborted||(null!=e?this.streams.forEach((t=>{t.abort(e)})):this.streams.forEach((e=>{e.close()})),this.closeController.abort())}_newReceiverStream(e){const{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){const{id:t,name:r,type:n,registry:o}=e;if(P("new %s stream %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??1024))throw new v.s("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(o.has(t))throw new Error(`${n} stream ${t} already exists!`);const c=function(e){const{id:t,name:r,send:n,onEnd:o,type:c="initiator",maxMsgSize:u=y}=e,d=new AbortController,f=new AbortController,p=new AbortController,g="initiator"===c?l:h,m="initiator"===c?`i${t}`:`r${t}`,b=`${null==r?t:r}`;let w,A=!1,I=!1,x=!1;const P={open:Date.now()},C=e=>{I||(I=!0,S.trace("%s stream %s sink end - err: %o",c,b,e),null!=e&&null==w&&(w=e),A&&(P.close=Date.now(),null!=o&&o(w)))},T=(0,i.d)({onEnd:e=>{A||(A=!0,S.trace("%s stream %s source end - err: %o",c,b,e),null!=e&&null==w&&(w=e),I&&(k.stat.timeline.close=Date.now(),null!=o&&o(w)))}}),k={close:()=>{S.trace("%s stream %s close",c,b),k.closeRead(),k.closeWrite()},closeRead:()=>{S.trace("%s stream %s closeRead",c,b),A||T.end()},closeWrite:()=>{if(S.trace("%s stream %s closeWrite",c,b),!I){p.abort();try{n({id:t,type:g.CLOSE})}catch(e){S.trace("%s stream %s error sending close",c,r,e)}C()}},abort:e=>{S.trace("%s stream %s abort",c,b,e),T.end(e),d.abort(),C(e)},reset:()=>{const e=new v.s("stream reset",R);f.abort(),T.end(e),C(e)},sink:async e=>{if(x)throw new v.s("sink already called on stream","ERR_DOUBLE_SINK");if(x=!0,I)throw new v.s("stream closed for writing","ERR_SINK_ENDED");e=(0,s.wJ)(e,(0,E.anySignal)([d.signal,f.signal,p.signal]));try{"initiator"===c&&n({id:t,type:l.NEW_STREAM,data:new a.H((0,_.m)(b))});for await(let r of e)for(;r.length>0;){if(r.length<=u){n({id:t,type:g.MESSAGE,data:r instanceof Uint8Array?new a.H(r):r});break}r=r instanceof Uint8Array?new a.H(r):r,n({id:t,type:g.MESSAGE,data:r.sublist(0,u)}),r.consume(u)}}catch(e){if("aborted"===e.type&&"The operation was aborted"===e.message){if(p.signal.aborted)return;f.signal.aborted&&(e.message="stream reset",e.code=R),d.signal.aborted&&(e.message="stream aborted",e.code="ERR_STREAM_ABORT")}if(e.code===R)S.trace("%s stream %s reset",c,r);else{S.trace("%s stream %s error",c,r,e);try{n({id:t,type:g.RESET})}catch(e){S.trace("%s stream %s error sending reset",c,r,e)}}return T.end(e),void C(e)}try{n({id:t,type:g.CLOSE})}catch(e){S.trace("%s stream %s error sending close",c,r,e)}C()},source:T,sourcePush:e=>{T.push(e)},sourceReadableLength:()=>T.readableLength,stat:{direction:"initiator"===c?"outbound":"inbound",timeline:P},metadata:{},id:m};return k}({id:t,name:r,send:e=>{P.enabled&&P.trace("%s stream %s send",n,t,C(e)),this._source.push(e)},type:n,onEnd:()=>{P("%s stream with id %s and protocol %s ended",n,t,c.stat.protocol),o.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize});return o.set(t,c),c}_createSink(){return async e=>{const t=[this.closeController.signal];null!=this._init.signal&&t.push(this._init.signal),e=(0,s.wJ)(e,E(t));try{const t=new g(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const r of e)for(const e of t.write(r))await this._handleIncoming(e);this._source.end()}catch(e){P("error in sink",e),this._source.end(e)}}}_createSource(){const e=(0,i.e)({objectMode:!0,onEnd:e=>{this.close(e)}});return Object.assign(async function*(e,t=0){if(null!=t&&0!==t)yield*(0,d.Z)(e,{size:t,serialize:(e,t)=>{for(const r of e)p.write(r,t)}});else for await(const t of e){const e=new a.H;for(const r of t)p.write(r,e);yield e.subarray()}}(e,this._init.minSendBytes),{push:e.push,end:e.end,return:e.return})}async _handleIncoming(e){const{id:t,type:r}=e;if(P.enabled&&P.trace("incoming message",C(e)),e.type===n.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??1024)){P("too many inbound streams open"),this._source.push({id:t,type:n.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return P("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this._source.end(new Error("Too many open streams"))}return}const r=this._newReceiverStream({id:t,name:(0,I.BB)(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(r))}const i=(1==(1&r)?this._streams.initiators:this._streams.receivers).get(t);if(null==i)return void P("missing stream %s for message type %s",t,u[r]);const s=this._init.maxStreamBufferSize??4194304;switch(r){case n.MESSAGE_INITIATOR:case n.MESSAGE_RECEIVER:if(i.sourceReadableLength()>s){this._source.push({id:e.id,type:r===n.MESSAGE_INITIATOR?n.RESET_RECEIVER:n.RESET_INITIATOR});const t=new v.s("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");return void i.abort(t)}i.sourcePush(e.data);break;case n.CLOSE_INITIATOR:case n.CLOSE_RECEIVER:i.closeRead();break;case n.RESET_INITIATOR:case n.RESET_RECEIVER:i.reset();break;default:P("unknown message type %s",r)}}}class k{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new T({...e,...this._init})}}function D(e={}){return()=>new k(e)}},25975:function(e,t,r){"use strict";r.d(t,{ji:function(){return ht},fd:function(){return dt}});var n={};r.r(n),r.d(n,{base58btc:function(){return P},base58flickr:function(){return C}});var i={};r.r(i),r.d(i,{base10:function(){return T}});var s={};r.r(s),r.d(s,{base16:function(){return k},base16upper:function(){return D}});var o={};r.r(o),r.d(o,{base2:function(){return O}});var a={};r.r(a),r.d(a,{base256emoji:function(){return M}});var c={};r.r(c),r.d(c,{base32:function(){return B},base32hex:function(){return j},base32hexpad:function(){return q},base32hexpadupper:function(){return F},base32hexupper:function(){return z},base32pad:function(){return $},base32padupper:function(){return V},base32upper:function(){return K},base32z:function(){return G}});var u={};r.r(u),r.d(u,{base36:function(){return H},base36upper:function(){return W}});var l={};r.r(l),r.d(l,{base64:function(){return Y},base64pad:function(){return Q},base64url:function(){return J},base64urlpad:function(){return Z}});var h={};r.r(h),r.d(h,{base8:function(){return X}});var d={};r.r(d),r.d(d,{identity:function(){return ee}});var f={};r.r(f),r.d(f,{code:function(){return ie},decode:function(){return oe},encode:function(){return se},name:function(){return ne}});var p={};r.r(p),r.d(p,{code:function(){return ce},decode:function(){return le},encode:function(){return ue},name:function(){return ae}});var y={};r.r(y),r.d(y,{identity:function(){return Le}});var g={};r.r(g),r.d(g,{sha256:function(){return Ke},sha512:function(){return $e}});r(49541);var m=r(5681);var b=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const w=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class v{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class E{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return A(this,e)}}class _{constructor(e){this.decoders=e}or(e){return A(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const A=(e,t)=>new _({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class S{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new v(e,t,r),this.decoder=new E(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const R=({name:e,prefix:t,encode:r,decode:n})=>new S(e,t,r,n),I=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=b(r,t);return R({prefix:e,name:t,encode:n,decode:e=>w(i(e))})},x=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>R({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),P=I({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),C=I({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),T=I({prefix:"9",name:"base10",alphabet:"0123456789"}),k=x({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),D=x({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),O=x({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),N=Array.from(""),L=N.reduce(((e,t,r)=>(e[r]=t,e)),[]),U=N.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const M=R({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=L[t]),"")},decode:function(e){const t=[];for(const r of e){const e=U[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),B=x({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),K=x({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$=x({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),V=x({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),j=x({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),z=x({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),q=x({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),F=x({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),G=x({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),H=I({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),W=I({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Y=x({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Q=x({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),J=x({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Z=x({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),X=x({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ee=R({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),te=new TextEncoder,re=new TextDecoder,ne="json",ie=512,se=e=>te.encode(JSON.stringify(e)),oe=e=>JSON.parse(re.decode(e)),ae="raw",ce=85,ue=e=>w(e),le=e=>w(e);var he=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=pe;)r[n++]=255&t|de,t/=128;for(;t&fe;)r[n++]=255&t|de,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},de=128,fe=-128,pe=Math.pow(2,31);var ye=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&me)<<s:(n&me)*Math.pow(2,s),s+=7}while(n>=ge);return e.bytes=o-r,i},ge=128,me=127;var be=Math.pow(2,7),we=Math.pow(2,14),ve=Math.pow(2,21),Ee=Math.pow(2,28),_e=Math.pow(2,35),Ae=Math.pow(2,42),Se=Math.pow(2,49),Re=Math.pow(2,56),Ie=Math.pow(2,63),xe={encode:he,decode:ye,encodingLength:function(e){return e<be?1:e<we?2:e<ve?3:e<Ee?4:e<_e?5:e<Ae?6:e<Se?7:e<Re?8:e<Ie?9:10}};const Pe=(e,t=0)=>[xe.decode(e,t),xe.decode.bytes],Ce=(e,t,r=0)=>(xe.encode(e,t,r),t),Te=e=>xe.encodingLength(e),ke=(e,t)=>{const r=t.byteLength,n=Te(e),i=n+Te(r),s=new Uint8Array(i+r);return Ce(e,s,0),Ce(r,s,n),s.set(t,i),new Oe(e,r,t,s)},De=e=>{const t=w(e),[r,n]=Pe(t),[i,s]=Pe(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Oe(r,i,o,t)};class Oe{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Ne=w,Le={code:0,name:"identity",encode:Ne,digest:e=>ke(0,Ne(e))},Ue=({name:e,code:t,encode:r})=>new Me(e,t,r);class Me{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ke(this.code,t):t.then((e=>ke(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Be=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ke=Ue({name:"sha2-256",code:18,encode:Be("SHA-256")}),$e=Ue({name:"sha2-512",code:19,encode:Be("SHA-512")}),Ve=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Ge(r,ze(e),t||P.encoder):He(r,ze(e),t||B.encoder)},je=new WeakMap,ze=e=>{const t=je.get(e);if(null==t){const t=new Map;return je.set(e,t),t}return t};class qe{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==We)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ye)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return qe.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=ke(e,t);return qe.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return qe.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return Ve(this,e)}toJSON(){return{"/":Ve(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof qe)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new qe(e,r,n,i||Qe(e,r,n.bytes))}if(!0===t[Je]){const{version:e,multihash:r,code:n}=t,i=De(r);return qe.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==We)throw new Error(`Version 0 CID must use dag-pb (code: ${We}) block encoding`);return new qe(e,t,r,r.bytes);case 1:{const n=Qe(e,t,r.bytes);return new qe(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return qe.create(0,We,e)}static createV1(e,t){return qe.create(1,e,t)}static decode(e){const[t,r]=qe.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=qe.inspectBytes(e),r=t.size-t.multihashSize,n=w(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Oe(t.multihashCode,t.digestSize,i,n);return[0===t.version?qe.createV0(s):qe.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Pe(e.subarray(t));return t+=n,r};let n=r(),i=We;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Fe(e,t),i=qe.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return ze(i).set(r,e),i}}const Fe=(e,t)=>{switch(e[0]){case"Q":{const r=t||P;return[P.prefix,r.decode(`${P.prefix}${e}`)]}case P.prefix:{const r=t||P;return[P.prefix,r.decode(e)]}case B.prefix:{const r=t||B;return[B.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Ge=(e,t,r)=>{const{prefix:n}=r;if(n!==P.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},He=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},We=112,Ye=18,Qe=(e,t,r)=>{const n=Te(e),i=n+Te(t),s=new Uint8Array(i+r.byteLength);return Ce(e,s,0),Ce(t,s,n),s.set(r,i),s},Je=Symbol.for("@ipld/js-cid/CID"),Ze={...d,...o,...h,...i,...s,...c,...u,...n,...l,...a};function Xe(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const et=Symbol.for("nodejs.util.inspect.custom"),tt=Object.values(Ze).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Ze.identity.decoder),rt=114,nt=36,it=37;class st{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[m.N]=!0;toString(){return null==this.string&&(this.string=P.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return qe.createV1(rt,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Xe(this.multihash.bytes,e);if("string"==typeof e)return ut(e).equals(this);if(null!=e?.multihash?.bytes)return Xe(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[et](){return`PeerId(${this.toString()})`}}class ot extends st{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class at extends st{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class ct extends st{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function ut(e,t){if(t=t??tt,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=De(P.decode(`z${e}`));return e.startsWith("12D")?new at({multihash:t}):e.startsWith("16U")?new ct({multihash:t}):new ot({multihash:t})}return function(e){try{const t=De(e);if(t.code===Le.code){if(t.digest.length===nt)return new at({multihash:t});if(t.digest.length===it)return new ct({multihash:t})}if(t.code===Ke.code)return new ot({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==rt)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Ke.code)return new ot({multihash:e.multihash});if(t.code===Le.code){if(t.digest.length===nt)return new at({multihash:e.multihash});if(t.digest.length===it)return new ct({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(qe.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(tt.decode(e))}function lt(e,t){const r={[Symbol.iterator]:()=>r,next:()=>{const r=e.next(),n=r.value;if(!0===r.done||null==n){return{done:!0,value:void 0}}return{done:!1,value:t(n)}}};return r}class ht{map;constructor(e){if(this.map=new Map,null!=e)for(const[t,r]of e.entries())this.map.set(t.toString(),r)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return lt(this.map.entries(),(e=>[ut(e[0]),e[1]]))}forEach(e){this.map.forEach(((t,r)=>{e(t,ut(r),this)}))}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return lt(this.map.keys(),(e=>ut(e)))}values(){return this.map.values()}get size(){return this.map.size}}class dt{set;constructor(e){if(this.set=new Set,null!=e)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return lt(this.set.entries(),(e=>{const t=ut(e[0]);return[t,t]}))}forEach(e){this.set.forEach((t=>{const r=ut(t);e(r,r,this)}))}has(e){return this.set.has(e.toString())}values(){return lt(this.set.values(),(e=>ut(e)))}intersection(e){const t=new dt;for(const r of e)this.has(r)&&t.add(r);return t}difference(e){const t=new dt;for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=new dt;for(const r of e)t.add(r);for(const e of this)t.add(e);return t}}class ft{list;constructor(e){if(this.list=[],null!=e)for(const t of e)this.list.push(t.toString())}[Symbol.iterator](){return mapIterable(this.list.entries(),(e=>peerIdFromString(e[1])))}concat(e){const t=new ft(this);for(const r of e)t.push(r);return t}entries(){return mapIterable(this.list.entries(),(e=>[e[0],peerIdFromString(e[1])]))}every(e){return this.list.every(((t,r)=>e(peerIdFromString(t),r,this)))}filter(e){const t=new ft;return this.list.forEach(((r,n)=>{const i=peerIdFromString(r);e(i,n,this)&&t.push(i)})),t}find(e){const t=this.list.find(((t,r)=>e(peerIdFromString(t),r,this)));if(null!=t)return peerIdFromString(t)}findIndex(e){return this.list.findIndex(((t,r)=>e(peerIdFromString(t),r,this)))}forEach(e){this.list.forEach(((t,r)=>{e(peerIdFromString(t),r,this)}))}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){const e=this.list.pop();if(null!=e)return peerIdFromString(e)}push(...e){for(const t of e)this.list.push(t.toString())}shift(){const e=this.list.shift();if(null!=e)return peerIdFromString(e)}unshift(...e){let t=this.list.length;for(let t=e.length-1;t>-1;t--)this.list.unshift(e[t].toString());return t}get length(){return this.list.length}}},21017:function(e,t,r){"use strict";r.d(t,{n9:function(){return a},W$:function(){return c}});var n,i=r(8394),s=(r(77408),r(23366)),o=r(46888);!function(e){let t;e.codec=()=>(null==t&&(t=(0,o.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.pubKey&&(t.uint32(18),t.bytes(e.pubKey)),null!=e.privKey&&(t.uint32(26),t.bytes(e.privKey)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.pubKey=e.bytes();break;case 3:r.privKey=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,o.LE)(t,e.codec()),e.decode=t=>(0,o.C6)(t,e.codec())}(n||(n={}));const a=async()=>{const e=await(0,i.generateKeyPair)("Ed25519"),t=await u(e);if("Ed25519"===t.type)return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)},c=async e=>{const t=await(0,i.generateKeyPair)("RSA",e?.bits??2048),r=await u(t);if("RSA"===r.type)return r;throw new Error(`Generated unexpected PeerId type "${r.type}"`)};async function u(e){return await(0,s.y5)((0,i.marshalPublicKey)(e.public),(0,i.marshalPrivateKey)(e))}},23366:function(e,t,r){"use strict";r.d(t,{cv:function(){return A},jE:function(){return _},vL:function(){return E},y5:function(){return S}});var n=r(38161),i=r(97098),s=r(81653),o=r(29094),a=r(38566),c=r(73062),u=r(27353),l=r(52770),h=r(682);const d=Symbol.for("nodejs.util.inspect.custom"),f=Object.values(i.gh).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),i.gh.identity.decoder),p=114,y=36,g=37;class m{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[h.N](){return!0}toString(){return null==this.string&&(this.string=s.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return n.k0.createV1(p,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return(0,c.f)(this.multihash.bytes,e);if("string"==typeof e)return _(e).equals(this);if(null!=e?.multihash?.bytes)return(0,c.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[d](){return`PeerId(${this.toString()})`}}class b extends m{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}}class w extends m{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}}class v extends m{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}}function E(e){if("RSA"===e.type)return new b(e);if("Ed25519"===e.type)return new w(e);if("secp256k1"===e.type)return new v(e);throw new l.s("Not a PeerId","ERR_INVALID_PARAMETERS")}function _(e,t){if(t=t??f,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=o.Jx(s.base58btc.decode(`z${e}`));return e.startsWith("12D")?new w({multihash:t}):e.startsWith("16U")?new v({multihash:t}):new b({multihash:t})}return A(f.decode(e))}function A(e){try{const t=o.Jx(e);if(t.code===a.identity.code){if(t.digest.length===y)return new w({multihash:t});if(t.digest.length===g)return new v({multihash:t})}if(t.code===u.sha256.code)return new b({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==p)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===u.sha256.code)return new b({multihash:e.multihash});if(t.code===a.identity.code){if(t.digest.length===y)return new w({multihash:e.multihash});if(t.digest.length===g)return new v({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(n.k0.decode(e))}throw new Error("Supplied PeerID CID is invalid")}async function S(e,t){return e.length===y?new w({multihash:o.Ue(a.identity.code,e),privateKey:t}):e.length===g?new v({multihash:o.Ue(a.identity.code,e),privateKey:t}):new b({multihash:await u.sha256.digest(e),publicKey:e,privateKey:t})}},64306:function(e,t,r){"use strict";r.d(t,{K:function(){return Re},X:function(){return S}});var n=r(52770),i=r(77408),s=r(73062),o=r(8394);const a="ERR_SIGNATURE_NOT_VALID";var c,u=r(46888);!function(e){let t;e.codec=()=>(null==t&&(t=(0,u.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,u.LE)(t,e.codec()),e.decode=t=>(0,u.C6)(t,e.codec())}(c||(c={}));var l=r(23366),h=r(62308),d=r(72004),f=r(66574);const p=Math.pow(2,7),y=Math.pow(2,14),g=Math.pow(2,21),m=Math.pow(2,28),b=Math.pow(2,35),w=Math.pow(2,42),v=Math.pow(2,49),E=Math.pow(2,56),_=Math.pow(2,63),A={encodingLength:e=>e<p?1:e<y?2:e<g?3:e<m?4:e<b?5:e<w?6:e<v?7:e<E?8:e<_?9:10,encode(e,t,r=0){if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return null==t&&(t=(0,f.E)(A.encodingLength(e))),d.Z.fromNumber(e).toBytes(t,r),t},decode:(e,t=0)=>d.Z.fromBytes(e,t).toNumber(!0)};class S{constructor(e){const{peerId:t,payloadType:r,payload:n,signature:i}=e;this.peerId=t,this.payloadType=r,this.payload=n,this.signature=i}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=c.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return(0,s.f)(this.marshal(),e.marshal())}async validate(e){const t=R(e,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");const r=(0,o.unmarshalPublicKey)(this.peerId.publicKey);return await r.verify(t.subarray(),this.signature)}}S.createFromProtobuf=async e=>{const t=c.decode(e),r=await(0,l.y5)(t.publicKey);return new S({peerId:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})},S.seal=async(e,t)=>{if(null==t.privateKey)throw new Error("Missing private key");const r=e.domain,n=e.codec,i=e.marshal(),s=R(r,n,i),a=await(0,o.unmarshalPrivateKey)(t.privateKey),c=await a.sign(s.subarray());return new S({peerId:t,payloadType:n,payload:i,signature:c})},S.openAndCertify=async(e,t)=>{const r=await S.createFromProtobuf(e);if(!await r.validate(t))throw new n.s("envelope signature is not valid for the given domain",a);return r};const R=(e,t,r)=>{const n=(0,i.m)(e),s=A.encode(n.byteLength),o=A.encode(t.length),a=A.encode(r.length);return new h.H(s,n,o,t,a,r)};var I=r(49736),x=r(49784);const P=I.C,C=I.aY,T=function(e){let t=0;if(e=e.toString().trim(),P(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(C(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;P(r[n])&&(e=T(r[n]),r[n]=(0,x.B)(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,(0,x.B)(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},k=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},D=-1,O={},N={};function L(e){if("number"==typeof e){if(null!=N[e])return N[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=O[e])return O[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,D,"ip6zone"],[43,8,"ipcidr"],[53,D,"dns",!0],[54,D,"dns4",!0],[55,D,"dns6",!0],[56,D,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,D,"unix",!1,!0],[421,D,"ipfs"],[421,D,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,D,"garlic64"],[448,0,"tls"],[449,D,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,D,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,D,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);N[t.code]=t,O[t.name]=t}));var U=r(38161),M=r(14249),B=r(81653),K=r(97098),$=r(29094),V=r(31617),j=r(41690);r(9839);L("ip4"),L("ip6"),L("ipcidr");function z(e,t){switch(L(e).code){case 4:case 41:return function(e){const t=k(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!I.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return J(t);case 6:case 273:case 33:case 132:return Y(t).toString();case 421:return function(e){const t=V.decode(e),r=e.slice(V.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return(0,x.B)(r,"base58btc")}(t);case 444:case 445:return Z(t);case 466:return function(e){const t=V.decode(e),r=e.slice(V.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return"u"+(0,x.B)(r,"base64url")}(t);default:return(0,x.B)(t,"base16")}}function q(e,t){switch(L(e).code){case 4:case 41:return H(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Q(t);case 6:case 273:case 33:case 132:return W(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?$.Jx(B.base58btc.decode(`z${e}`)).bytes:U.k0.parse(e).multihash.bytes;const r=Uint8Array.from(V.encode(t.length));return(0,j.z)([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=M.base32.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=W(n);return(0,j.z)([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=M.base32.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=W(n);return(0,j.z)([r,i],r.length+i.length)}(t);case 466:return function(e){const t=G.decode(e),r=Uint8Array.from(V.encode(t.length));return(0,j.z)([r,t],r.length+t.length)}(t);default:return(0,i.m)(t,"base16")}}const F=Object.values(K.gh).map((e=>e.decoder)),G=function(){let e=F[0].or(F[1]);return F.slice(2).forEach((t=>e=e.or(t))),e}();function H(e){if(!I.h6(e))throw new Error("invalid ip address");return T(e)}function W(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function Y(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Q(e){const t=(0,i.m)(e),r=Uint8Array.from(V.encode(t.length));return(0,j.z)([r,t],r.length+t.length)}function J(e){const t=V.decode(e);if((e=e.slice(V.decode.bytes)).length!==t)throw new Error("inconsistent lengths");return(0,x.B)(e)}function Z(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${(0,x.B)(t,"base32")}:${Y(r)}`}function X(e){return e.map((e=>{const t=ue(e);return null!=e[1]?[t.code,z(t.code,e[1])]:[t.code]}))}function ee(e){return se((0,j.z)(e.map((e=>{const t=ue(e);let r=Uint8Array.from(V.encode(t.code));return e.length>1&&null!=e[1]&&(r=(0,j.z)([r,e[1]])),r}))))}function te(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;return V.decode(t)+(V.decode.bytes??0)}function re(e){const t=[];let r=0;for(;r<e.length;){const n=V.decode(e,r),i=V.decode.bytes??0,s=te(L(n),e.slice(r+i));if(0===s){t.push([n]),r+=i;continue}const o=e.slice(r+i,r+i+s);if(r+=s+i,r>e.length)throw ce("Invalid address Uint8Array: "+(0,x.B)(e,"base16"));t.push([n,o])}return t}function ne(e){return function(e){const t=[];return e.map((e=>{const r=ue(e);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),ae(t.join("/"))}(X(re(e)))}function ie(e){const t=function(e){const t=[],r=e.split("/").slice(1);if(1===r.length&&""===r[0])return[];for(let n=0;n<r.length;n++){const i=r[n],s=L(i);if(0!==s.size){if(n++,n>=r.length)throw ce("invalid address: "+e);if(!0===s.path){t.push([i,ae(r.slice(n).join("/"))]);break}t.push([i,r[n]])}else t.push([i])}return t}(e=ae(e));return ee(t.map((e=>{Array.isArray(e)||(e=[e]);const t=ue(e);return e.length>1?[t.code,q(t.code,e[1])]:[t.code]})))}function se(e){const t=oe(e);if(null!=t)throw t;return Uint8Array.from(e)}function oe(e){try{re(e)}catch(e){return e}}function ae(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function ce(e){return new Error("Error parsing address: "+e)}function ue(e){return L(e[0])}var le=r(32114);var he,de,fe,pe,ye=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},ge=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const me=Symbol.for("nodejs.util.inspect.custom"),be=[L("dns").code,L("dns4").code,L("dns6").code,L("dnsaddr").code],we=new Map,ve=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Ee(e){return Boolean(e?.[ve])}class _e{constructor(e){if(he.set(this,void 0),de.set(this,void 0),fe.set(this,void 0),this[pe]=!0,null==e&&(e=""),e instanceof Uint8Array)this.bytes=se(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=ie(e)}else{if(!Ee(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=se(e.bytes)}}toString(){return null==ye(this,he,"f")&&ge(this,he,ne(this.bytes),"f"),ye(this,he,"f")}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=L("tcp"),o=L("udp"),a=L("ip4"),c=L("ip6"),u=L("dns6"),l=L("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),be.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=L(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=L(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.protoCodes().map((e=>Object.assign({},L(e))))}protoCodes(){const e=[],t=this.bytes;let r=0;for(;r<t.length;){const n=V.decode(t,r),i=V.decode.bytes??0;r+=te(L(n),t.slice(r+i))+i,e.push(n)}return e}protoNames(){return this.protos().map((e=>e.name))}tuples(){return null==ye(this,de,"f")&&ge(this,de,re(this.bytes),"f"),ye(this,de,"f")}stringTuples(){return null==ye(this,fe,"f")&&ge(this,fe,X(this.tuples()),"f"),ye(this,fe,"f")}encapsulate(e){return e=new _e(e),new _e(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new _e(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new _e(ee(t.slice(0,r)));return this}getPeerId(){try{const e=this.stringTuples().filter((e=>e[0]===O.ipfs.code)),t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?(0,x.B)(B.base58btc.decode(`z${e}`),"base58btc"):(0,x.B)(U.k0.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){let e=null;try{e=this.stringTuples().filter((e=>!0===L(e[0]).path))[0][1],null==e&&(e=null)}catch{e=null}return e}equals(e){return(0,s.f)(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=we.get(t.name);if(null==r)throw le(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new _e(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[(he=new WeakMap,de=new WeakMap,fe=new WeakMap,pe=ve,me)](){return`Multiaddr(${ne(this.bytes)})`}}var Ae;!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=(0,u.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.multiaddr=e.bytes();else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,u.LE)(t,e.codec()),e.decode=t=>(0,u.C6)(t,e.codec())}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=(0,u.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.peerId&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),null!=t.seq&&0n!==t.seq&&(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(const n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={peerId:new Uint8Array(0),seq:0n,addresses:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.peerId=t.bytes();break;case 2:n.seq=t.uint64();break;case 3:n.addresses.push(e.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(7&r)}}return n}))),r),e.encode=t=>(0,u.LE)(t,e.codec()),e.decode=t=>(0,u.C6)(t,e.codec())}(Ae||(Ae={}));const Se=Uint8Array.from([3,1]);class Re{constructor(e){this.domain=Re.DOMAIN,this.codec=Re.CODEC;const{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=Ae.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))})),this.marshaled}equals(e){return e instanceof Re&&(!!this.peerId.equals(e.peerId)&&(this.seqNumber===e.seqNumber&&!!function(e,t){const r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every(((e,r)=>t[r].equals(e))))}(this.multiaddrs,e.multiaddrs)))}}Re.createFromProtobuf=e=>{const t=Ae.decode(e),r=(0,l.cv)(t.peerId),n=(t.addresses??[]).map((e=>{return t=e.multiaddr,new _e(t);var t})),i=t.seq;return new Re({peerId:r,multiaddrs:n,seqNumber:i})},Re.DOMAIN="libp2p-peer-record",Re.CODEC=Se},86257:function(e,t,r){"use strict";r.d(t,{Pc:function(){return i}});r(79944);var n=r(77408);r(49784),r(27353),r(23366);r(52770);const i=(e,t)=>{const r=(0,n.m)(t.toString(16).padStart(16,"0"),"base16"),i=new Uint8Array(e.length+r.length);return i.set(e,0),i.set(r,e.length),i}},21177:function(e,t,r){"use strict";r.d(t,{Y:function(){return o}});var n,i=r(46888);function s(e){const t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0"),i=String(e.getUTCHours()).padStart(2,"0"),s=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0"),a=e.getUTCMilliseconds();return`${t}-${r}-${n}T${i}:${s}:${o}.${String(1e3*a*1e3).padStart(9,"0")}Z`}!function(e){let t;e.codec=()=>(null==t&&(t=(0,i.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&e.key.byteLength>0&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),null!=e.timeReceived&&""!==e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.bytes();break;case 2:r.value=e.bytes();break;case 5:r.timeReceived=e.string();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,i.LE)(t,e.codec()),e.decode=t=>(0,i.C6)(t,e.codec())}(n||(n={}));class o{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return n.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:s(this.timeReceived)}}static deserialize(e){const t=n.decode(e);return new o(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw new Error("Invalid format");const n=parseInt(r[1],10),i=parseInt(r[2],10)-1,s=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),u=parseInt(r[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,u))}(e.timeReceived);if(null==e.key)throw new Error("key missing from deserialized object");if(null==e.value)throw new Error("value missing from deserialized object");return new o(e.key,e.value,t)}}},90153:function(e,t,r){"use strict";r.d(t,{o:function(){return s},w:function(){return o}});var n=r(52770),i=r(49784);function s(e,t,r){if(0===r.length){const e="No records given";throw new n.s(e,"ERR_NO_RECORDS_RECEIVED")}const s=(0,i.B)(t).split("/");if(s.length<3){const e="Record key does not have a selector function";throw new n.s(e,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const o=e[s[1].toString()];if(null==o){const e=`Unrecognized key prefix: ${s[1]}`;throw new n.s(e,"ERR_UNRECOGNIZED_KEY_PREFIX")}return 1===r.length?0:o(t,r)}const o={pk:function(e,t){return 0}}},69256:function(e,t,r){"use strict";r.d(t,{c:function(){return a},z:function(){return c}});var n=r(52770),i=r(49784),s=r(27353),o=r(73062);async function a(e,t){const r=t.key,s=(0,i.B)(r).split("/");if(s.length<3)return;const o=e[s[1].toString()];if(null==o){const e="Invalid record keytype";throw new n.s(e,"ERR_INVALID_RECORD_KEY_TYPE")}await o(r,t.value)}const c={pk:async(e,t)=>{if(!(e instanceof Uint8Array))throw new n.s('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(e.byteLength<5)throw new n.s("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if("/pk/"!==(0,i.B)(e.subarray(0,4)))throw new n.s("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");const r=e.slice(4),a=await s.sha256.digest(t);if(!(0,o.f)(r,a.bytes))throw new n.s("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")}}},55305:function(e,t,r){"use strict";r.d(t,{a:function(){return o}});var n=r(1388);const i=()=>{};class s{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??i,this.onDisconnect=e.onDisconnect??i}get[Symbol.toStringTag](){return n.d.toString()}get[n.d](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}}function o(e){return new s(e)}},20199:function(e,t,r){"use strict";r.d(t,{s:function(){return i}});class n extends Map{constructor(e){super();const{name:t,metrics:r}=e;this.metric=r.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function i(e){const{name:t,metrics:r}=e;let i;return i=null!=r?new n({name:t,metrics:r}):new Map,i}},37706:function(e,t,r){"use strict";r.d(t,{F:function(){return s}});var n=r(53749);function i(e){try{const{address:t}=e.nodeAddress();return Boolean((0,n.Z)(t))}catch{return!0}}function s(e,t){const r=i(e.multiaddr),n=i(t.multiaddr);return r&&!n?1:!r&&n||e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}},72265:function(e,t,r){"use strict";r.d(t,{Y:function(){return i}});var n=r(67031);function i(e){const{address:t}=e.nodeAddress();return(0,n.B)(t)}},66146:function(e,t,r){"use strict";r.d(t,{j:function(){return s}});var n=r(28391);const i=(0,r(69860).kg)("libp2p:stream:converter");function s(e,t={}){const{stream:r,remoteAddr:s}=e,{sink:o,source:a}=r,c=async function*(){for await(const e of a)yield*e}(),u={async sink(e){null!=t.signal&&(e=(0,n.wJ)(e,t.signal));try{await o(e),await l()}catch(e){"aborted"!==e.type&&i(e)}},source:null!=t.signal?(0,n.wJ)(c,t.signal):c,remoteAddr:s,timeline:{open:Date.now(),close:void 0},async close(){await o(async function*(){yield new Uint8Array(0)}()),await l()}};async function l(){null==u.timeline.close&&(u.timeline.close=Date.now()),await Promise.resolve()}return u}},17346:function(e,t,r){"use strict";r.d(t,{n:function(){return ft}});var n=r(69860),i=r(32114),s=r(28391),o=r(91026),a=r(49736),c=r(49784);const u=a.C,l=a.aY,h=function(e){let t=0;if(e=e.toString().trim(),u(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(l(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;u(r[n])&&(e=h(r[n]),r[n]=(0,c.B)(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,(0,c.B)(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},d=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},f=-1,p={},y={};function g(e){if("number"==typeof e){if(null!=y[e])return y[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=p[e])return p[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,f,"ip6zone"],[43,8,"ipcidr"],[53,f,"dns",!0],[54,f,"dns4",!0],[55,f,"dns6",!0],[56,f,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,f,"unix",!1,!0],[421,f,"ipfs"],[421,f,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,f,"garlic64"],[448,0,"tls"],[449,f,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,f,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,f,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);y[t.code]=t,p[t.name]=t}));var m=r(38161),b=r(14249),w=r(81653),v=r(97098),E=r(29094),_=r(9027),A=r(77408),S=r(41690);r(9839);g("ip4"),g("ip6"),g("ipcidr");function R(e,t){switch(g(e).code){case 4:case 41:return function(e){const t=d(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!a.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return O(t);case 6:case 273:case 33:case 132:return k(t).toString();case 421:return function(e){const t=_.decode(e),r=e.slice(_.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return(0,c.B)(r,"base58btc")}(t);case 444:case 445:return N(t);case 466:return function(e){const t=_.decode(e),r=e.slice(_.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return"u"+(0,c.B)(r,"base64url")}(t);default:return(0,c.B)(t,"base16")}}function I(e,t){switch(g(e).code){case 4:case 41:return C(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return D(t);case 6:case 273:case 33:case 132:return T(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?E.Jx(w.base58btc.decode(`z${e}`)).bytes:m.k0.parse(e).multihash.bytes;const r=Uint8Array.from(_.encode(t.length));return(0,S.z)([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=b.base32.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=T(n);return(0,S.z)([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=b.base32.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=T(n);return(0,S.z)([r,i],r.length+i.length)}(t);case 466:return function(e){const t=P.decode(e),r=Uint8Array.from(_.encode(t.length));return(0,S.z)([r,t],r.length+t.length)}(t);default:return(0,A.m)(t,"base16")}}const x=Object.values(v.gh).map((e=>e.decoder)),P=function(){let e=x[0].or(x[1]);return x.slice(2).forEach((t=>e=e.or(t))),e}();function C(e){if(!a.h6(e))throw new Error("invalid ip address");return h(e)}function T(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function k(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function D(e){const t=(0,A.m)(e),r=Uint8Array.from(_.encode(t.length));return(0,S.z)([r,t],r.length+t.length)}function O(e){const t=_.decode(e);if((e=e.slice(_.decode.bytes)).length!==t)throw new Error("inconsistent lengths");return(0,c.B)(e)}function N(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${(0,c.B)(t,"base32")}:${k(r)}`}function L(e){return e.map((e=>{const t=F(e);return null!=e[1]?[t.code,R(t.code,e[1])]:[t.code]}))}function U(e){return V((0,S.z)(e.map((e=>{const t=F(e);let r=Uint8Array.from(_.encode(t.code));return e.length>1&&null!=e[1]&&(r=(0,S.z)([r,e[1]])),r}))))}function M(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;return _.decode(t)+(_.decode.bytes??0)}function B(e){const t=[];let r=0;for(;r<e.length;){const n=_.decode(e,r),i=_.decode.bytes??0,s=M(g(n),e.slice(r+i));if(0===s){t.push([n]),r+=i;continue}const o=e.slice(r+i,r+i+s);if(r+=s+i,r>e.length)throw q("Invalid address Uint8Array: "+(0,c.B)(e,"base16"));t.push([n,o])}return t}function K(e){return function(e){const t=[];return e.map((e=>{const r=F(e);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),z(t.join("/"))}(L(B(e)))}function $(e){const t=function(e){const t=[],r=e.split("/").slice(1);if(1===r.length&&""===r[0])return[];for(let n=0;n<r.length;n++){const i=r[n],s=g(i);if(0!==s.size){if(n++,n>=r.length)throw q("invalid address: "+e);if(!0===s.path){t.push([i,z(r.slice(n).join("/"))]);break}t.push([i,r[n]])}else t.push([i])}return t}(e=z(e));return U(t.map((e=>{Array.isArray(e)||(e=[e]);const t=F(e);return e.length>1?[t.code,I(t.code,e[1])]:[t.code]})))}function V(e){const t=j(e);if(null!=t)throw t;return Uint8Array.from(e)}function j(e){try{B(e)}catch(e){return e}}function z(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function q(e){return new Error("Error parsing address: "+e)}function F(e){return g(e[0])}var G=r(73062);var H,W,Y,Q,J=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},Z=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const X=Symbol.for("nodejs.util.inspect.custom"),ee=[g("dns").code,g("dns4").code,g("dns6").code,g("dnsaddr").code],te=new Map,re=Symbol.for("@multiformats/js-multiaddr/multiaddr");function ne(e){return Boolean(e?.[re])}class ie{constructor(e){if(H.set(this,void 0),W.set(this,void 0),Y.set(this,void 0),this[Q]=!0,null==e&&(e=""),e instanceof Uint8Array)this.bytes=V(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=$(e)}else{if(!ne(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=V(e.bytes)}}toString(){return null==J(this,H,"f")&&Z(this,H,K(this.bytes),"f"),J(this,H,"f")}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=g("tcp"),o=g("udp"),a=g("ip4"),c=g("ip6"),u=g("dns6"),l=g("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),ee.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=g(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=g(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.protoCodes().map((e=>Object.assign({},g(e))))}protoCodes(){const e=[],t=this.bytes;let r=0;for(;r<t.length;){const n=_.decode(t,r),i=_.decode.bytes??0;r+=M(g(n),t.slice(r+i))+i,e.push(n)}return e}protoNames(){return this.protos().map((e=>e.name))}tuples(){return null==J(this,W,"f")&&Z(this,W,B(this.bytes),"f"),J(this,W,"f")}stringTuples(){return null==J(this,Y,"f")&&Z(this,Y,L(this.tuples()),"f"),J(this,Y,"f")}encapsulate(e){return e=new ie(e),new ie(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ie(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new ie(U(t.slice(0,r)));return this}getPeerId(){try{const e=this.stringTuples().filter((e=>e[0]===p.ipfs.code)),t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?(0,c.B)(w.base58btc.decode(`z${e}`),"base58btc"):(0,c.B)(m.k0.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){let e=null;try{e=this.stringTuples().filter((e=>!0===g(e[0]).path))[0][1],null==e&&(e=null)}catch{e=null}return e}equals(e){return(0,G.f)(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=te.get(t.name);if(null==r)throw i(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new ie(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[(H=new WeakMap,W=new WeakMap,Y=new WeakMap,Q=re,X)](){return`Multiaddr(${K(this.bytes)})`}}function se(e){return new ie(e)}const oe=ke("dns4"),ae=ke("dns6"),ce=ke("dnsaddr"),ue=Te(ke("dns"),ce,oe,ae),le=Te(ke("ip4"),ke("ip6")),he=Te(Ce(le,ke("tcp")),Ce(ue,ke("tcp"))),de=Ce(le,ke("udp")),fe=Ce(de,ke("utp")),pe=Ce(de,ke("quic")),ye=Te(Ce(he,ke("ws")),Ce(ue,ke("ws"))),ge=Te(Ce(he,ke("wss")),Ce(ue,ke("wss")),Ce(he,ke("tls"),ke("ws")),Ce(ue,ke("tls"),ke("ws"))),me=Te(Ce(he,ke("http")),Ce(le,ke("http")),Ce(ue,ke("http"))),be=Te(Ce(he,ke("https")),Ce(le,ke("https")),Ce(ue,ke("https"))),we=Ce(de,ke("webrtc"),ke("certhash")),ve=Te(Ce(we,ke("p2p")),we),Ee=Te(Ce(ye,ke("p2p-webrtc-star"),ke("p2p")),Ce(ge,ke("p2p-webrtc-star"),ke("p2p")),Ce(ye,ke("p2p-webrtc-star")),Ce(ge,ke("p2p-webrtc-star"))),_e=(Te(Ce(ye,ke("p2p-websocket-star"),ke("p2p")),Ce(ge,ke("p2p-websocket-star"),ke("p2p")),Ce(ye,ke("p2p-websocket-star")),Ce(ge,ke("p2p-websocket-star"))),Te(Ce(me,ke("p2p-webrtc-direct"),ke("p2p")),Ce(be,ke("p2p-webrtc-direct"),ke("p2p")),Ce(me,ke("p2p-webrtc-direct")),Ce(be,ke("p2p-webrtc-direct")))),Ae=Te(ye,ge,me,be,Ee,_e,he,fe,pe,ue,ve),Se=(Te(Ce(Ae,ke("p2p-stardust"),ke("p2p")),Ce(Ae,ke("p2p-stardust"))),Te(Ce(Ae,ke("p2p")),Ee,_e,ve,ke("p2p"))),Re=Te(Ce(Se,ke("p2p-circuit"),Se),Ce(Se,ke("p2p-circuit")),Ce(ke("p2p-circuit"),Se),Ce(Ae,ke("p2p-circuit")),Ce(ke("p2p-circuit"),Ae),ke("p2p-circuit")),Ie=()=>Te(Ce(Re,Ie),Re),xe=Ie();Te(Ce(xe,Se,xe),Ce(Se,xe),Ce(xe,Se),xe,Se);function Pe(e){return function(t){let r;try{r=se(t)}catch(e){return!1}const n=e(r.protoNames());return null!==n&&(!0===n||!1===n?n:0===n.length)}}function Ce(...e){function t(t){if(t.length<e.length)return null;let r=t;return e.some((e=>(r="function"==typeof e?e().partialMatch(t):e.partialMatch(t),Array.isArray(r)&&(t=r),null===r))),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Pe(t),partialMatch:t}}function Te(...e){function t(t){let r=null;return e.some((e=>{const n="function"==typeof e?e().partialMatch(t):e.partialMatch(t);return null!=n&&(r=n,!0)})),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Pe(t),partialMatch:t}}function ke(e){const t=e;return{toString:function(){return t},matches:function(e){let r;try{r=se(e)}catch(e){return!1}const n=r.protoNames();return 1===n.length&&n[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}var De=r(33559),Oe=r(85275),Ne=r(46857),Le=r(1914),Ue=r(37430);class Me{constructor(e,t){this.label=e.label,this.open=(0,Oe.Z)(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,"number"==typeof this.channel.bufferedAmountLowThreshold&&(this.channel.bufferedAmountLowThreshold=65536),e.addEventListener("message",(e=>{t.onMessage(e)})),e.addEventListener("bufferedamountlow",(()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()})),e.addEventListener("open",(()=>{this.open.resolve(),t.onOpen()})),e.addEventListener("close",(()=>{t.onClose()})),e.addEventListener("error",(r=>{if("Transport channel closed"===r.error?.message)return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,r.error?.message,r.error?.errorDetail);const n=r.error instanceof Error?r.error:new Error(`datachannel error: ${r.error?.message} ${r.error?.errorDetail}`);t.onError(i(n,"ERR_DATA_CHANNEL"))}));let r=!1;this.closingInterval=setInterval((()=>{"closing"===e.readyState?(r&&t.onClose(),r=!0):r=!1}),5e3)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>65536&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=(0,Oe.Z)())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}}var Be=r(65780);const Ke={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};class $e extends Ne.v{constructor(e){super(),this.id=e.id??(0,c.B)(Le(4),"hex").slice(0,7),this.log=(0,n.kg)(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??function(){if("undefined"==typeof globalThis)throw i(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");const e={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(null==e.RTCPeerConnection)throw i(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return e}(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},Ke,e.peerConnectionConfig)),this.closed=!1,this.connected=(0,Oe.Z)(),this.source=(0,Ue.d)(),this.sink=async e=>{if(await this.connected.promise,null==this.channel)throw i(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(const t of e)await this.channel.send(t);await this.close()}}handleDataChannelEvent(e){const t=e.channel;null!=t?this.channel=new Me(t,{log:this.log,onMessage:e=>{this.source.push(new Uint8Array(e.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new Ne.A("ready"))},onClose:()=>{this.close().catch((e=>{this.log("error closing connection after channel close",e)}))},onError:e=>{this.close(e).catch((e=>{this.log("error closing connection after channel error",e)}))}}):this.close(i(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch((e=>{this.log("Error closing after event channel was found to be null",e)}))}async close(e){if(this.closed=!0,null==e&&null!=this.channel)for(;this.channel.bufferedAmount>0;)await Be(100);this.channel?.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new Ne.A("close"))}}class Ve extends Ne.v{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",(()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch((e=>{this.log.error("could not renegotiate %o",e)}))}))}async handleSignal(e){return this.log('incoming signal "%s"',e.type),"offer"===e.type?await this.handleOffer(e):"answer"===e.type?await this.handleAnswer(e):"candidate"===e.type?await this.handleCandidate(e):"renegotiate"===e.type?await this.handleRenegotiate(e):"goodbye"===e.type?await this.handleGoodye(e):void this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){const t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(e){if(null!=t.address&&!t.address.endsWith(".local"))throw i(e,"ERR_ADD_ICE_CANDIDATE");this.log("ignoring unsupported ICE candidate.")}}}const je=(0,n.kg)("libp2p:webrtc-peer:receiver");class ze extends $e{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new qe({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",(e=>this.dispatchEvent(new Ne.A("signal",{detail:e.detail})))),this.peerConnection.addEventListener("datachannel",(e=>{this.handleDataChannelEvent(e)}))}handleSignal(e){this.handshake.handleSignal(e).catch((t=>{this.log("error handling signal %o %o",e,t)}))}}class qe extends Ve{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){je.trace("renegotiate"),this.dispatchEvent(new Ne.A("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(const e of this.iceCandidates)await this.handleCandidate(e);this.iceCandidates=[];const t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),je.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new Ne.A("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){null!=this.peerConnection.remoteDescription&&null!=this.peerConnection.remoteDescription.type?await super.handleCandidate(e):this.iceCandidates.push(e)}}var Fe=r(71198);const Ge=e=>{const t=e.on||e.addListener||e.addEventListener,r=e.off||e.removeListener||e.removeEventListener;if(!t||!r)throw new TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:r.bind(e)}};function He(e,t,r){"function"==typeof r&&(r={filter:r});const n=function(e,t,r){let n;const i=new Promise(((i,s)=>{if(!((r={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...r}).count>=0)||r.count!==Number.POSITIVE_INFINITY&&!Number.isInteger(r.count))throw new TypeError("The `count` option should be at least 0 or more");const o=[t].flat(),a=[],{addListener:c,removeListener:u}=Ge(e),l=(...e)=>{const t=r.multiArgs?e:e[0];r.filter&&!r.filter(t)||(a.push(t),r.count===a.length&&(n(),i(a)))},h=e=>{n(),s(e)};n=()=>{for(const e of o)u(e,l);for(const e of r.rejectionEvents)u(e,h)};for(const e of o)c(e,l);for(const e of r.rejectionEvents)c(e,h);r.resolveImmediately&&i(a)}));if(i.cancel=n,"number"==typeof r.timeout){const e=(0,Fe.ZP)(i,r.timeout);return e.cancel=n,e}return i}(e,t,r={...r,count:1,resolveImmediately:!1}),i=n.then((e=>e[0]));return i.cancel=n.cancel,i}const We=(0,n.kg)("libp2p:webrtc-peer:initator");class Ye extends $e{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??(0,c.B)(Le(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new Qe({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",(e=>{this.dispatchEvent(new Ne.A("signal",{detail:e.detail}))}))}handleSignal(e){this.handshake.handleSignal(e).catch((t=>{this.log("error handling signal %o %o",e,t)}))}}class Qe extends Ve{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",(e=>{if(null==e.candidate)return;const t={type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}};We.trace("create candidate",t),this.dispatchEvent(new Ne.A("signal",{detail:t})),this.dispatchEvent(new Ne.A("ice-candidate"))}))}async handleRenegotiate(){if("negotiating"===this.status)return void this.log("already negotiating, queueing");this.status="negotiating";const e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await He(this,"ice-candidate"),await Be(1e3),We.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new Ne.A("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){We.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}}const Je=(0,n.kg)("libp2p:webrtc-star:socket");function Ze(e,t){const{sink:r,source:n}=e,i={remoteAddr:t.remoteAddr,async sink(e){null!=t.signal&&(e=(0,s.wJ)(e,t.signal));try{await r(e)}catch(e){"aborted"!==e.type&&Je.error(e)}},source:null!=t.signal?(0,s.wJ)(n,t.signal):n,timeline:{open:Date.now()},async close(){if(e.closed)return;const t=Date.now(),r=setTimeout((()=>{if(null!=i.remoteAddr){const{host:e,port:r}=i.remoteAddr.toOptions();Je("timeout closing socket to %s:%s after %dms, destroying it manually",e,r,Date.now()-t)}e.closed||e.close().catch((e=>{Je.error("could not close socket",e)}))}),2e3);try{await e.close()}finally{clearTimeout(r)}}};return e.addEventListener("close",(()=>{null==i.timeline.close&&(i.timeline.close=Date.now())}),{once:!0}),i}function Xe(e){const t=e.toString().split("/"),r=e.protos()[1].name,n=e.protos()[2].name,i=e.stringTuples()[1][1];if("tcp"!==r||"ws"!==n&&"wss"!==n)throw new Error(`invalid multiaddr: ${e.toString()}`);if(!(0,o.K9)(e))return`http://${t[2]}:${t[4]}`;if("ws"===n)return`http://${t[2]}${null==i||"80"===i?"":`:${i}`}`;if("wss"===n)return`https://${t[2]}${null==i||"443"===i?"":`:${i}`}`;throw new Error("invalid multiaddr: "+e.toString())}const et=(0,n.kg)("libp2p:webrtc-star:listener"),tt={transports:["websocket"],path:"/socket.io-next/"};class rt extends Ne.v{constructor(e,t,r,n,i){super(),this.signallingAddr=t,this.socket=(0,De.$j)(e,tt),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=r,this.handler=n,this.channelOptions=i,this.handleWsHandshake=this.handleWsHandshake.bind(this);let s=!1;this.socket.on("connect_error",(e=>{s&&"TransportError"===e.type||this.dispatchEvent(new Ne.A("error",{detail:e}))})),this.socket.on("error",(e=>{this.dispatchEvent(new Ne.A("error",{detail:e}))})),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",(e=>{this.dispatchEvent(new Ne.A("peer",{detail:e}))})),this.socket.on("connect",(()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),s&&this.dispatchEvent(new Ne.A("reconnect"))})),this.socket.once("connect",(()=>{s=!0,this.dispatchEvent(new Ne.A("listening"))})),this.socket.on("disconnect",(()=>{this.dispatchEvent(new Ne.A("disconnect"))}))}_createChannel(e,t,r){const n={...this.channelOptions},i=new ze(n),s=e=>{const t=e.detail;et.error("incoming connection errored",t)};return i.addEventListener("error",s),i.addEventListener("close",(()=>{i.removeEventListener("error",s)}),{once:!0}),i.addEventListener("signal",(n=>{const i=n.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:r,answer:!0,signal:i})})),i.addEventListener("ready",(()=>{const t=Ze(i,{remoteAddr:this.signallingAddr});et("new inbound connection %s",t.remoteAddr);try{this.upgrader.upgradeInbound(t).then((r=>{et("inbound connection %s upgraded",t.remoteAddr),this.connections.push(t);i.addEventListener("close",(()=>{this.connections=this.connections.filter((e=>e!==t)),this.channels.delete(e),this.pendingSignals.delete(e)}),{once:!0}),this.dispatchEvent(new Ne.A("connection",{detail:r})),this.handler(r)})).catch((e=>{et.error("inbound connection failed to upgrade",e),t.close().catch((e=>{et.error("inbound connection failed to close after failing to upgrade",e)}))}))}catch(e){et.error("inbound connection failed to upgrade",e),t.close().catch((e=>{et.error("inbound connection failed to close after failing to upgrade",e)}))}}),{once:!0}),i}handleWsHandshake(e){if(et('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),!0===e.answer||null!=e.err||null==e.intentId)return;const t=e.intentId;let r=this.pendingSignals.get(t);null==r&&(r=[],this.pendingSignals.set(t,r)),r.push(e);let n=this.channels.get(t);if(null==n){if("offer"!==e.signal.type)return void et("handshake is not an offer and channel does not exist, buffering until we receive an offer");et("creating new channel to handle offer handshake"),n=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,n)}else et("channel already exists, using it to handle handshake");for(;r.length>0;){const e=r.shift();null!=e?.signal&&n.handleSignal(e.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map((async e=>await e.close())),...Array.from(this.channels.values()).map((async e=>await e.close()))]),this.dispatchEvent(new Ne.A("close"))}}class nt extends Ne.v{constructor(e,t,r,n,i){super(),this.upgrader=e,this.handler=t,this.peerId=r,this.transport=n,this.options=i}async listen(e){if(null!=this.listeningAddr)throw i(new Error("listener already in use"),"ERR_ALREADY_LISTENING");const t=(0,Oe.Z)();let r;this.listeningAddr=e,r=e.protoCodes().includes(421)?e:e.encapsulate(`/p2p/${this.peerId.toString()}`);const n=this.signallingUrl=Xe(e);et("connecting to signalling server on: %s",this.signallingUrl);const s=new rt(this.signallingUrl,r,this.upgrader,this.handler,this.options.channelOptions);return s.addEventListener("error",(e=>{const r=e.detail;et("error connecting to signalling server %o",r),s.close().catch((e=>{et.error("error closing server after error",e)})),t.reject(r)})),s.addEventListener("listening",(()=>{et("connected to signalling server"),this.dispatchEvent(new Ne.A("listening")),t.resolve()})),s.addEventListener("peer",(e=>{this.transport.peerDiscovered(e.detail)})),s.addEventListener("connection",(t=>{const r=t.detail;if(null==r.remoteAddr)try{r.remoteAddr=e.decapsulateCode(421).encapsulate(`/p2p/${r.remotePeer.toString()}`)}catch(e){et.error("could not determine remote address",e)}this.dispatchEvent(new Ne.A("connection",{detail:r}))})),s.addEventListener("disconnect",(()=>{this.transport.sigServers.delete(n)})),s.addEventListener("reconnect",(()=>{this.transport.sigServers.set(n,s)})),this.transport.sigServers.set(this.signallingUrl,s),await t.promise}async close(){if(null!=this.signallingUrl){const e=this.transport.sigServers.get(this.signallingUrl);null!=e&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new Ne.A("close")),this.listeningAddr=void 0}getAddrs(){return null!=this.listeningAddr?[this.listeningAddr]:[]}}var it=r(738),st=r(23366),ot=r(12348),at=r(59769);const ct="RTCPeerConnection"in globalThis,ut=(0,n.kg)("libp2p:webrtc-star"),lt=()=>{};class ht extends Ne.v{constructor(){super(...arguments),this.started=!1}get[at.N](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return!!this.isStarted()&&super.dispatchEvent(e)}}class dt{constructor(e){null!=e?.wrtc&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new ht,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[ot.NA](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){const r=Ze(await this._connect(e,t),{remoteAddr:e,signal:t.signal});ut("new outbound connection %s",r.remoteAddr);const n=await t.upgrader.upgradeOutbound(r);return ut("outbound connection %s upgraded",r.remoteAddr),n}async _connect(e,t){if(!0===t.signal?.aborted)throw new s._L;const r={...t.channelOptions??{}};null!=this.wrtc&&(r.wrtc=this.wrtc);const n=e.toOptions(),o=(0,it.BB)(Le(36),"hex");return await new Promise(((a,c)=>{const u=this.sigServers.get(Xe(e));if(null==u?.socket)return c(i(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let l=!1;ut("dialing %s:%s",n.host,n.port);const h=new Ye(r),d=e=>{const t=e.detail;if(!l){const e=`connection error ${n.host}:${n.port}: ${t.message}`;ut.error(e),y(t)}},f=()=>{l=!0,ut("connection opened %s:%s",n.host,n.port),y()},p=()=>{ut.error("connection aborted %s:%s",n.host,n.port),h.close().finally((()=>{y(new s._L)}))},y=e=>{h.removeEventListener("ready",f),t.signal?.removeEventListener("abort",p),null==e?a(h):c(e)};h.addEventListener("ready",f,{once:!0}),h.addEventListener("close",(()=>{h.removeEventListener("error",d)})),t.signal?.addEventListener("abort",p),h.addEventListener("signal",(t=>{const r=t.detail;u.socket.emit("ss-handshake",{intentId:o,srcMultiaddr:u.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:r})})),u.socket.on("ws-handshake",(e=>{e.intentId===o&&null!=e.err&&h.close().finally((()=>{c(i(new Error(e.err),"ERR_SIGNALLING_FAILED"))})),e.intentId!==o||null==e.answer||h.closed||h.handleSignal(e.signal)}))}))}createListener(e){if(!ct&&null==this.wrtc)throw i(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},null!=this.wrtc&&(e.channelOptions.wrtc=this.wrtc),null==this.peerId)throw i(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return function(e,t,r,n,i){return new nt(e,t,r,n,i)}(e.upgrader,e.handler??lt,this.peerId,this,e)}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>!e.protoCodes().includes(290)&&Ee.matches(e)))}peerDiscovered(e){ut("peer discovered: %s",e),e=function(e){const t="/libp2p-webrtc-star";if(e.startsWith(t)){e=e.substring(t.length,e.length);let r=(0,o.HM)(e);const n=r.stringTuples().filter((e=>421===e[0]))[0];if(null==n[1])throw new Error("invalid multiaddr: "+e);r=r.decapsulate("p2p"),r=r.encapsulate("/p2p-webrtc-star"),r=r.encapsulate(`/p2p/${n[1]}`),e=r.toString()}return e}(e);const t=(0,o.HM)(e),r=t.getPeerId();if(null==r)return;const n=(0,st.jE)(r);this._discovery.dispatchEvent(new Ne.A("peer",{detail:{id:n,multiaddrs:[t],protocols:[]}}))}}function ft(e={}){const t=new dt(e);return{transport:e=>(t.peerId=e.peerId,t),discovery:t.discovery}}},46177:function(e,t,r){"use strict";r.d(t,{Z:function(){return fs},R:function(){return ds}});var n={};r.r(n),r.d(n,{base32:function(){return F},base32hex:function(){return Y},base32hexpad:function(){return J},base32hexpadupper:function(){return Z},base32hexupper:function(){return Q},base32pad:function(){return H},base32padupper:function(){return W},base32upper:function(){return G},base32z:function(){return X}});var i={};r.r(i),r.d(i,{base58btc:function(){return ee},base58flickr:function(){return te}});var s={};r.r(s),r.d(s,{base64:function(){return re},base64pad:function(){return ne},base64url:function(){return ie},base64urlpad:function(){return se}});var o={};r.r(o),r.d(o,{base10:function(){return ce}});var a={};r.r(a),r.d(a,{base16:function(){return ue},base16upper:function(){return le}});var c={};r.r(c),r.d(c,{base2:function(){return he}});var u={};r.r(u),r.d(u,{base256emoji:function(){return ye}});var l={};r.r(l),r.d(l,{base36:function(){return ge},base36upper:function(){return me}});var h={};r.r(h),r.d(h,{base8:function(){return be}});var d={};r.r(d),r.d(d,{identity:function(){return we}});var f={};r.r(f),r.d(f,{code:function(){return Ae},decode:function(){return Re},encode:function(){return Se},name:function(){return _e}});var p={};r.r(p),r.d(p,{code:function(){return xe},decode:function(){return Ce},encode:function(){return Pe},name:function(){return Ie}});var y={};r.r(y),r.d(y,{identity:function(){return et}});var g={};r.r(g),r.d(g,{sha256:function(){return it},sha512:function(){return st}});var m={};r.r(m),r.d(m,{identity:function(){return $t}});var b={};r.r(b),r.d(b,{base2:function(){return Vt}});var w={};r.r(w),r.d(w,{base8:function(){return jt}});var v={};r.r(v),r.d(v,{base10:function(){return zt}});var E={};r.r(E),r.d(E,{base16:function(){return qt},base16upper:function(){return Ft}});var _={};r.r(_),r.d(_,{base32:function(){return Gt},base32hex:function(){return Qt},base32hexpad:function(){return Zt},base32hexpadupper:function(){return Xt},base32hexupper:function(){return Jt},base32pad:function(){return Wt},base32padupper:function(){return Yt},base32upper:function(){return Ht},base32z:function(){return er}});var A={};r.r(A),r.d(A,{base36:function(){return tr},base36upper:function(){return rr}});var S={};r.r(S),r.d(S,{base58btc:function(){return nr},base58flickr:function(){return ir}});var R={};r.r(R),r.d(R,{base64:function(){return sr},base64pad:function(){return or},base64url:function(){return ar},base64urlpad:function(){return cr}});var I={};r.r(I),r.d(I,{base256emoji:function(){return dr}});var x={};r.r(x),r.d(x,{sha256:function(){return Mr},sha512:function(){return Br}});var P={};r.r(P),r.d(P,{identity:function(){return $r}});var C={};r.r(C),r.d(C,{code:function(){return jr},decode:function(){return qr},encode:function(){return zr},name:function(){return Vr}});var T={};r.r(T),r.d(T,{code:function(){return Wr},decode:function(){return Qr},encode:function(){return Yr},name:function(){return Hr}});var k=r(49541),D=r(55265),O=r(11227);var N=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},L=N;new Uint8Array(0);const U=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class M{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class B{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return $(this,e)}}class K{constructor(e){this.decoders=e}or(e){return $(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const $=(e,t)=>new K({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class V{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new M(e,t,r),this.decoder=new B(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const j=({name:e,prefix:t,encode:r,decode:n})=>new V(e,t,r,n),z=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=L(r,t);return j({prefix:e,name:t,encode:n,decode:e=>U(i(e))})},q=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>j({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),F=q({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),G=q({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),H=q({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),W=q({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Y=q({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Q=q({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),J=q({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Z=q({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),X=q({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ee=z({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),te=z({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),re=q({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ne=q({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ie=q({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),se=q({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function oe(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return O.enabled(`${e}:trace`)&&null!=O.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=O(`${e}:trace`)),Object.assign(O(e),{error:O(`${e}:error`),trace:t})}O.formatters.b=e=>null==e?"undefined":ee.baseEncode(e),O.formatters.t=e=>null==e?"undefined":F.baseEncode(e),O.formatters.m=e=>null==e?"undefined":re.baseEncode(e),O.formatters.p=e=>null==e?"undefined":e.toString(),O.formatters.c=e=>null==e?"undefined":e.toString(),O.formatters.k=e=>null==e?"undefined":e.toString(),O.formatters.a=e=>null==e?"undefined":e.toString();var ae=r(5681);const ce=z({prefix:"9",name:"base10",alphabet:"0123456789"}),ue=q({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),le=q({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),he=q({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),de=Array.from(""),fe=de.reduce(((e,t,r)=>(e[r]=t,e)),[]),pe=de.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const ye=j({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=fe[t]),"")},decode:function(e){const t=[];for(const r of e){const e=pe[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),ge=z({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),me=z({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),be=q({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),we=j({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),ve=new TextEncoder,Ee=new TextDecoder,_e="json",Ae=512,Se=e=>ve.encode(JSON.stringify(e)),Re=e=>JSON.parse(Ee.decode(e)),Ie="raw",xe=85,Pe=e=>U(e),Ce=e=>U(e);var Te=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Oe;)r[n++]=255&t|ke,t/=128;for(;t&De;)r[n++]=255&t|ke,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},ke=128,De=-128,Oe=Math.pow(2,31);var Ne=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Ue)<<s:(n&Ue)*Math.pow(2,s),s+=7}while(n>=Le);return e.bytes=o-r,i},Le=128,Ue=127;var Me=Math.pow(2,7),Be=Math.pow(2,14),Ke=Math.pow(2,21),$e=Math.pow(2,28),Ve=Math.pow(2,35),je=Math.pow(2,42),ze=Math.pow(2,49),qe=Math.pow(2,56),Fe=Math.pow(2,63),Ge={encode:Te,decode:Ne,encodingLength:function(e){return e<Me?1:e<Be?2:e<Ke?3:e<$e?4:e<Ve?5:e<je?6:e<ze?7:e<qe?8:e<Fe?9:10}};const He=(e,t=0)=>[Ge.decode(e,t),Ge.decode.bytes],We=(e,t,r=0)=>(Ge.encode(e,t,r),t),Ye=e=>Ge.encodingLength(e),Qe=(e,t)=>{const r=t.byteLength,n=Ye(e),i=n+Ye(r),s=new Uint8Array(i+r);return We(e,s,0),We(r,s,n),s.set(t,i),new Ze(e,r,t,s)},Je=e=>{const t=U(e),[r,n]=He(t),[i,s]=He(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Ze(r,i,o,t)};class Ze{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Xe=U,et={code:0,name:"identity",encode:Xe,digest:e=>Qe(0,Xe(e))},tt=({name:e,code:t,encode:r})=>new rt(e,t,r);class rt{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Qe(this.code,t):t.then((e=>Qe(this.code,e)))}throw Error("Unknown type, must be binary type")}}const nt=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),it=tt({name:"sha2-256",code:18,encode:nt("SHA-256")}),st=tt({name:"sha2-512",code:19,encode:nt("SHA-512")}),ot=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?ht(r,ct(e),t||ee.encoder):dt(r,ct(e),t||F.encoder)},at=new WeakMap,ct=e=>{const t=at.get(e);if(null==t){const t=new Map;return at.set(e,t),t}return t};class ut{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ft)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==pt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ut.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Qe(e,t);return ut.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return ut.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return ot(this,e)}toJSON(){return{"/":ot(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof ut)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new ut(e,r,n,i||yt(e,r,n.bytes))}if(!0===t[gt]){const{version:e,multihash:r,code:n}=t,i=Je(r);return ut.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ft)throw new Error(`Version 0 CID must use dag-pb (code: ${ft}) block encoding`);return new ut(e,t,r,r.bytes);case 1:{const n=yt(e,t,r.bytes);return new ut(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return ut.create(0,ft,e)}static createV1(e,t){return ut.create(1,e,t)}static decode(e){const[t,r]=ut.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=ut.inspectBytes(e),r=t.size-t.multihashSize,n=U(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Ze(t.multihashCode,t.digestSize,i,n);return[0===t.version?ut.createV0(s):ut.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=He(e.subarray(t));return t+=n,r};let n=r(),i=ft;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=lt(e,t),i=ut.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return ct(i).set(r,e),i}}const lt=(e,t)=>{switch(e[0]){case"Q":{const r=t||ee;return[ee.prefix,r.decode(`${ee.prefix}${e}`)]}case ee.prefix:{const r=t||ee;return[ee.prefix,r.decode(e)]}case F.prefix:{const r=t||F;return[F.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},ht=(e,t,r)=>{const{prefix:n}=r;if(n!==ee.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},dt=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},ft=112,pt=18,yt=(e,t,r)=>{const n=Ye(e),i=n+Ye(t),s=new Uint8Array(i+r.byteLength);return We(e,s,0),We(t,s,n),s.set(r,i),s},gt=Symbol.for("@ipld/js-cid/CID"),mt={...d,...c,...h,...o,...a,...n,...l,...i,...s,...u};function bt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const wt=Symbol.for("nodejs.util.inspect.custom"),vt=Object.values(mt).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),mt.identity.decoder),Et=114,_t=36,At=37;class St{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[ae.N]=!0;toString(){return null==this.string&&(this.string=ee.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return ut.createV1(Et,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return bt(this.multihash.bytes,e);if("string"==typeof e)return Pt(e).equals(this);if(null!=e?.multihash?.bytes)return bt(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[wt](){return`PeerId(${this.toString()})`}}class Rt extends St{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class It extends St{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class xt extends St{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function Pt(e,t){if(t=t??vt,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Je(ee.decode(`z${e}`));return e.startsWith("12D")?new It({multihash:t}):e.startsWith("16U")?new xt({multihash:t}):new Rt({multihash:t})}return function(e){try{const t=Je(e);if(t.code===et.code){if(t.digest.length===_t)return new It({multihash:t});if(t.digest.length===At)return new xt({multihash:t})}if(t.code===it.code)return new Rt({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Et)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===it.code)return new Rt({multihash:e.multihash});if(t.code===et.code){if(t.digest.length===_t)return new It({multihash:e.multihash});if(t.digest.length===At)return new xt({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(ut.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(vt.decode(e))}var Ct=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Tt=Ct;new Uint8Array(0);const kt=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Dt{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ot{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Lt(this,e)}}class Nt{constructor(e){this.decoders=e}or(e){return Lt(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Lt=(e,t)=>new Nt({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Ut{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Dt(e,t,r),this.decoder=new Ot(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Mt=({name:e,prefix:t,encode:r,decode:n})=>new Ut(e,t,r,n),Bt=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Tt(r,t);return Mt({prefix:e,name:t,encode:n,decode:e=>kt(i(e))})},Kt=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Mt({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),$t=Mt({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Vt=Kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),jt=Kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),zt=Bt({prefix:"9",name:"base10",alphabet:"0123456789"}),qt=Kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ft=Kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Gt=Kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ht=Kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Wt=Kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Yt=Kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Qt=Kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Jt=Kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Zt=Kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Xt=Kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),er=Kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),tr=Bt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rr=Bt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),nr=Bt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ir=Bt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),sr=Kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),or=Kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ar=Kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),cr=Kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ur=Array.from(""),lr=ur.reduce(((e,t,r)=>(e[r]=t,e)),[]),hr=ur.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const dr=Mt({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=lr[t]),"")},decode:function(e){const t=[];for(const r of e){const e=hr[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var fr=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=gr;)r[n++]=255&t|pr,t/=128;for(;t&yr;)r[n++]=255&t|pr,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},pr=128,yr=-128,gr=Math.pow(2,31);var mr=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&wr)<<s:(n&wr)*Math.pow(2,s),s+=7}while(n>=br);return e.bytes=o-r,i},br=128,wr=127;var vr=Math.pow(2,7),Er=Math.pow(2,14),_r=Math.pow(2,21),Ar=Math.pow(2,28),Sr=Math.pow(2,35),Rr=Math.pow(2,42),Ir=Math.pow(2,49),xr=Math.pow(2,56),Pr=Math.pow(2,63),Cr={encode:fr,decode:mr,encodingLength:function(e){return e<vr?1:e<Er?2:e<_r?3:e<Ar?4:e<Sr?5:e<Rr?6:e<Ir?7:e<xr?8:e<Pr?9:10}};const Tr=(e,t,r=0)=>(Cr.encode(e,t,r),t),kr=e=>Cr.encodingLength(e),Dr=(e,t)=>{const r=t.byteLength,n=kr(e),i=n+kr(r),s=new Uint8Array(i+r);return Tr(e,s,0),Tr(r,s,n),s.set(t,i),new Or(e,r,t,s)};class Or{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Nr=({name:e,code:t,encode:r})=>new Lr(e,t,r);class Lr{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Dr(this.code,t):t.then((e=>Dr(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Ur=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Mr=Nr({name:"sha2-256",code:18,encode:Ur("SHA-256")}),Br=Nr({name:"sha2-512",code:19,encode:Ur("SHA-512")}),Kr=kt,$r={code:0,name:"identity",encode:Kr,digest:e=>Dr(0,Kr(e))},Vr="raw",jr=85,zr=e=>kt(e),qr=e=>kt(e),Fr=new TextEncoder,Gr=new TextDecoder,Hr="json",Wr=512,Yr=e=>Fr.encode(JSON.stringify(e)),Qr=e=>JSON.parse(Gr.decode(e));new WeakMap;class Jr{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Jr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return Jr.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Jr.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return cid_format(this,e)}toJSON(){return{"/":cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Jr)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Jr(e,r,n,i||cid_encodeCID(e,r,n.bytes))}if(!0===t[cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return Jr.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new Jr(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new Jr(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Jr.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return Jr.create(1,e,t)}static decode(e){const[t,r]=Jr.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Jr.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?Jr.createV0(s):Jr.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),i=Jr.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const Zr={...m,...b,...w,...v,...E,..._,...A,...S,...R,...I};function Xr(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function en(e=0){return null!=globalThis.Buffer?.allocUnsafe?Xr(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function tn(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const rn=tn("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),nn=tn("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=en((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var sn={utf8:rn,"utf-8":rn,hex:Zr.base16,latin1:nn,ascii:nn,binary:nn,...Zr};function on(e,t="utf8"){const r=sn[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var an=r(57050);function cn(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=en(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return Xr(r)}r(9839);function un(e,t="utf8"){const r=sn[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Xr(globalThis.Buffer.from(e,"utf-8"))}var ln=r(49736);const hn=ln.C,dn=ln.aY,fn=function(e){let t=0;if(e=e.toString().trim(),hn(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(dn(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;hn(r[n])&&(e=fn(r[n]),r[n]=on(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,on(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},pn=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},yn=-1,gn={},mn={};function bn(e){if("number"==typeof e){if(null!=mn[e])return mn[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=gn[e])return gn[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,yn,"ip6zone"],[43,8,"ipcidr"],[53,yn,"dns",!0],[54,yn,"dns4",!0],[55,yn,"dns6",!0],[56,yn,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,yn,"unix",!1,!0],[421,yn,"ipfs"],[421,yn,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,yn,"garlic64"],[448,0,"tls"],[449,yn,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,yn,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,yn,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);mn[t.code]=t,gn[t.name]=t}));bn("ip4"),bn("ip6"),bn("ipcidr");function wn(e,t){switch(bn(e).code){case 4:case 41:return function(e){const t=pn(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!ln.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return xn(t);case 6:case 273:case 33:case 132:return Rn(t).toString();case 421:return function(e){const t=an.Jx(e),r=e.slice(an.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return on(r,"base58btc")}(t);case 444:case 445:return Pn(t);case 466:return function(e){const t=an.Jx(e),r=e.slice(an.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+on(r,"base64url")}(t);default:return on(t,"base16")}}function vn(e,t){switch(bn(e).code){case 4:case 41:return An(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return In(t);case 6:case 273:case 33:case 132:return Sn(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?Je(ee.decode(`z${e}`)).bytes:ut.parse(e).multihash.bytes;const r=Uint8Array.from(an.cv(t.length));return cn([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=F.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Sn(n);return cn([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=F.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=Sn(n);return cn([r,i],r.length+i.length)}(t);case 466:return function(e){const t=_n.decode(e),r=Uint8Array.from(an.cv(t.length));return cn([r,t],r.length+t.length)}(t);default:return un(t,"base16")}}const En=Object.values(mt).map((e=>e.decoder)),_n=function(){let e=En[0].or(En[1]);return En.slice(2).forEach((t=>e=e.or(t))),e}();function An(e){if(!ln.h6(e))throw new Error("invalid ip address");return fn(e)}function Sn(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function Rn(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function In(e){const t=un(e),r=Uint8Array.from(an.cv(t.length));return cn([r,t],r.length+t.length)}function xn(e){const t=an.Jx(e);if((e=e.slice(an.P$(t))).length!==t)throw new Error("inconsistent lengths");return on(e)}function Pn(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${on(t,"base32")}:${Rn(r)}`}function Cn(e){const t=[],r=[];let n=null,i=0;for(;i<e.length;){const s=an.Jx(e,i),o=an.P$(s),a=bn(s),c=Dn(a,e.slice(i+o));if(0===c){t.push([s]),r.push([s]),i+=o;continue}const u=e.slice(i+o,i+o+c);if(i+=c+o,i>e.length)throw Nn("Invalid address Uint8Array: "+on(e,"base16"));t.push([s,u]);const l=wn(s,u);if(r.push([s,l]),!0===a.path){n=l;break}}return{bytes:Uint8Array.from(e),string:Tn(r),tuples:t,stringTuples:r,path:n}}function Tn(e){const t=[];return e.map((e=>{const r=bn(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),On(t.join("/"))}function kn(e){return cn(e.map((e=>{const t=bn(e[0]);let r=Uint8Array.from(an.cv(t.code));return e.length>1&&null!=e[1]&&(r=cn([r,e[1]])),r})))}function Dn(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=an.Jx(t instanceof Uint8Array?t:Uint8Array.from(t));return e+an.P$(e)}}function On(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Nn(e){return new Error("Error parsing address: "+e)}const Ln=Symbol.for("nodejs.util.inspect.custom"),Un=[bn("dns").code,bn("dns4").code,bn("dns6").code,bn("dnsaddr").code],Mn=new Map,Bn=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Kn(e){return Boolean(e?.[Bn])}class $n{bytes;#e;#t;#r;#n;[Bn]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=Cn(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);t=function(e){const t=[],r=[];let n=null;const i=(e=On(e)).split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=bn(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(s++,s>=i.length)throw Nn("invalid address: "+e);if(!0===o.path){n=On(i.slice(s).join("/")),t.push([o.code,vn(o.code,n)]),r.push([o.code,n]);break}const a=vn(o.code,i[s]);t.push([o.code,a]),r.push([o.code,wn(o.code,a)])}return{string:Tn(r),bytes:kn(t),tuples:t,stringTuples:r,path:n}}(e)}else{if(!Kn(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");t=Cn(e.bytes)}this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=bn("tcp"),o=bn("udp"),a=bn("ip4"),c=bn("ip6"),u=bn("dns6"),l=bn("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),Un.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=bn(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=bn(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#t.map((([e])=>Object.assign({},bn(e))))}protoCodes(){return this.#t.map((([e])=>e))}protoNames(){return this.#t.map((([e])=>bn(e).name))}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(e){return e=new $n(e),new $n(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new $n(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new $n(kn(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach((([t,r])=>{t===gn.p2p.code&&e.push([t,r]),t===gn["p2p-circuit"].code&&(e=[])}));const t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?on(ee.decode(`z${e}`),"base58btc"):on(ut.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#n}equals(e){return function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=Mn.get(t.name);if(null==r)throw new k.sv(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new $n(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[Ln](){return`Multiaddr(${this.#e})`}}function Vn(e){return new $n(e)}var jn,zn=r(1314);!function(e){e.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",e.ERR_DATA_CHANNEL="ERR_DATA_CHANNEL",e.ERR_CONNECTION_CLOSED="ERR_CONNECTION_CLOSED",e.ERR_HASH_NOT_SUPPORTED="ERR_HASH_NOT_SUPPORTED",e.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",e.ERR_INVALID_FINGERPRINT="ERR_INVALID_FINGERPRINT",e.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",e.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",e.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",e.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"}(jn||(jn={}));class qn extends k.sv{constructor(e,t){super(`WebRTC transport error: ${e}`,t??""),this.name="WebRTCTransportError"}}class Fn extends qn{constructor(e,t){super(`[stream: ${e}] data channel error: ${t}`,jn.ERR_DATA_CHANNEL),this.name="WebRTC/DataChannelError"}}function Gn(e,t){return new Fn(e,t)}class Hn extends qn{constructor(e){super(`There was a problem with the Multiaddr which was passed in: ${e}`,jn.ERR_INVALID_MULTIADDR),this.name="WebRTC/InappropriateMultiaddrError"}}function Wn(e){return new Hn(e)}class Yn extends qn{constructor(e){super(`There was a problem with a provided argument: ${e}`,jn.ERR_INVALID_PARAMETERS),this.name="WebRTC/InvalidArgumentError"}}function Qn(e){return new Yn(e)}class Jn extends qn{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`,jn.ERR_INVALID_FINGERPRINT),this.name="WebRTC/InvalidFingerprintError"}}function Zn(e,t){return new Jn(e,t)}class Xn extends qn{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`,jn.ERR_NOT_IMPLEMENTED),this.name="WebRTC/UnimplementedError"}}class ei extends qn{constructor(e){super(`unsupported hash algorithm: ${e}`,jn.ERR_HASH_NOT_SUPPORTED),this.name="WebRTC/UnsupportedHashAlgorithmError"}}const ti=(0,r(43631).qY)(),ri=null!=ti&&"firefox"===ti.name,ni=async function*(){},ii=async e=>{},si=oe("libp2p:webrtc:connection");class oi{peerConnection;remoteAddr;timeline;metrics;source=ni();sink=ii;constructor(e){this.remoteAddr=e.remoteAddr,this.timeline=e.timeline,this.peerConnection=e.peerConnection,this.peerConnection.onconnectionstatechange=()=>{"closed"!==this.peerConnection.connectionState&&"disconnected"!==this.peerConnection.connectionState&&"failed"!==this.peerConnection.connectionState||(this.timeline.close=Date.now())}}async close(e){si.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(e){si.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}const ai=globalThis.RTCPeerConnection,ci=globalThis.RTCSessionDescription,ui=globalThis.RTCIceCandidate;class li extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function hi(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new li(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new li(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}function di(e,t,r){return n=>e(hi(n,t,r))}function fi(e,t,r){return{sink:di(e.sink,t,{...r,onAbort:void 0}),source:hi(e.source,t,r)}}var pi=r(41455),yi=r(85275),gi=r(77399),mi=r(9202);class bi{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class wi{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new bi(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new bi(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class vi extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Ei(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new wi,a=(0,yi.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},l=e=>i?r:(i=!0,null!=e?(e=>(o=new wi,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,yi.Z)()}))}},return:()=>(o=new wi,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:u,end:l,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new vi)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const h=r;return r={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(h.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(h.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return h.readableLength}},r}var _i,Ai=r(90954),Si=r(62308),Ri=r(46888);!function(e){let t,r,n;!function(e){e.FIN="FIN",e.STOP_SENDING="STOP_SENDING",e.RESET="RESET"}(t=e.Flag||(e.Flag={})),function(e){e[e.FIN=0]="FIN",e[e.STOP_SENDING=1]="STOP_SENDING",e[e.RESET=2]="RESET"}(r||(r={})),function(e){e.codec=()=>(0,Ri.Ji)(r)}(t=e.Flag||(e.Flag={})),e.codec=()=>(null==n&&(n=(0,Ri.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.flag&&(r.uint32(8),e.Flag.codec().encode(t.flag,r)),null!=t.message&&(r.uint32(18),r.bytes(t.message)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.flag=e.Flag.codec().decode(t);break;case 2:n.message=t.bytes();break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,Ri.LE)(t,e.codec()),e.decode=t=>(0,Ri.C6)(t,e.codec())}(_i||(_i={}));class Ii extends gi.b{channel;dataChannelOptions;incomingData;messageQueue;maxDataSize;constructor(e){switch(super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=function(e={}){return Ei((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}(),this.messageQueue=new Si.H,this.dataChannelOptions={bufferedAmountLowEventTimeout:e.dataChannelOptions?.bufferedAmountLowEventTimeout??3e4,maxBufferedAmount:e.dataChannelOptions?.maxBufferedAmount??16777216,maxMessageSize:e.dataChannelOptions?.maxMessageSize??e.maxDataSize},this.maxDataSize=e.maxDataSize,this.channel.readyState){case"open":case"connecting":break;case"closed":case"closing":void 0!==this.timeline.close&&0!==this.timeline.close||(this.timeline.close=Date.now());break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new k.sv("Unknown datachannel state","ERR_INVALID_STATE")}this.channel.onopen=e=>{this.timeline.open=(new Date).getTime(),null!=this.messageQueue&&(this._sendMessage(this.messageQueue).catch((e=>{this.abort(e)})),this.messageQueue=void 0)},this.channel.onclose=e=>{this.close().catch((e=>{this.log.error("error closing stream after channel closed",e)}))},this.channel.onerror=e=>{const t=e.error;this.abort(t)};const t=this;this.channel.onmessage=async e=>{const{data:t}=e;null!==t&&0!==t.byteLength&&this.incomingData.push(new Uint8Array(t,0,t.byteLength))},Promise.resolve().then((async()=>{for await(const e of mi.J(this.incomingData)){const r=t.processIncomingProtobuf(e.subarray());null!=r&&t.sourcePush(new Si.H(r))}})).catch((e=>{this.log.error("error processing incoming data channel messages",e)}))}sendNewStream(){}async _sendMessage(e,t=!0){if(t&&this.channel.bufferedAmount>this.dataChannelOptions.maxBufferedAmount)try{await(0,Ai.yM)(this.channel,"bufferedamountlow",{timeout:this.dataChannelOptions.bufferedAmountLowEventTimeout})}catch(e){if(e instanceof Ai.W5)throw new Error("Timed out waiting for DataChannel buffer to clear");throw e}if("closed"===this.channel.readyState||"closing"===this.channel.readyState)throw new k.sv("Invalid datachannel state - closed or closing","ERR_INVALID_STATE");if("open"===this.channel.readyState)for(const t of e)this.channel.send(t);else{if("connecting"!==this.channel.readyState)throw this.log.error("unknown datachannel state %s",this.channel.readyState),new k.sv("Unknown datachannel state","ERR_INVALID_STATE");null==this.messageQueue&&(this.messageQueue=new Si.H),this.messageQueue.append(e)}}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxDataSize),r=e.subarray(0,t),n=_i.encode({message:r}),i=mi.c.single(n);await this._sendMessage(i),e.consume(t)}}async sendReset(){await this._sendFlag(_i.Flag.RESET)}async sendCloseWrite(){await this._sendFlag(_i.Flag.FIN)}async sendCloseRead(){await this._sendFlag(_i.Flag.STOP_SENDING)}processIncomingProtobuf(e){const t=_i.decode(e);return void 0!==t.flag&&(t.flag===_i.Flag.FIN&&(this.incomingData.end(),this.remoteCloseWrite()),t.flag===_i.Flag.RESET&&this.reset(),t.flag===_i.Flag.STOP_SENDING&&this.remoteCloseRead()),t.message}async _sendFlag(e){this.log.trace("Sending flag: %s",e.toString());const t=_i.encode({flag:e}),r=mi.c.single(t);await this._sendMessage(r,!1)}}function xi(e){const{channel:t,direction:r,onEnd:n,dataChannelOptions:i}=e;return new Ii({id:"inbound"===r?`i${t.id}`:`r${t.id}`,direction:r,maxDataSize:(i?.maxMessageSize??16384)-5-2,dataChannelOptions:i,onEnd:n,channel:t,log:oe(`libp2p:webrtc:stream:${r}:${t.id}`)})}const Pi="/webrtc";class Ci{protocol;peerConnection;streamBuffer=[];metrics;dataChannelOptions;constructor(e){this.peerConnection=e.peerConnection,this.metrics=e.metrics,this.protocol=e.protocol??Pi,this.dataChannelOptions=e.dataChannelOptions,this.peerConnection.ondatachannel=({channel:t})=>{const r=xi({channel:t,direction:"inbound",dataChannelOptions:e.dataChannelOptions,onEnd:()=>{this.streamBuffer=this.streamBuffer.filter((e=>e.id!==r.id))}});this.streamBuffer.push(r)}}createStreamMuxer(e){return new Ti({...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.streamBuffer,protocol:this.protocol})}}class Ti{init;streams;protocol;peerConnection;dataChannelOptions;metrics;close=async()=>{};abort=()=>{};source=ni();sink=ii;constructor(e){this.init=e,this.streams=e.streams,this.peerConnection=e.peerConnection,this.protocol=e.protocol??Pi,this.metrics=e.metrics,this.peerConnection.ondatachannel=({channel:t})=>{const r=xi({channel:t,direction:"inbound",dataChannelOptions:this.dataChannelOptions,onEnd:()=>{this.streams=this.streams.filter((e=>e.id!==r.id)),this.metrics?.increment({stream_end:!0}),e?.onStreamEnd?.(r)}});this.streams.push(r),null!=e?.onIncomingStream&&(this.metrics?.increment({incoming_stream:!0}),e.onIncomingStream(r))};const t=e?.onIncomingStream;null!=t&&this.streams.forEach((e=>{t(e)}))}newStream(){const e=this.peerConnection.createDataChannel(""),t=xi({channel:e,direction:"outbound",dataChannelOptions:this.dataChannelOptions,onEnd:()=>{e.close(),this.streams=this.streams.filter((e=>e.id!==t.id)),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(t)}});return this.streams.push(t),this.metrics?.increment({outgoing_stream:!0}),t}}var ki;!function(e){let t,r,n;!function(e){e.SDP_OFFER="SDP_OFFER",e.SDP_ANSWER="SDP_ANSWER",e.ICE_CANDIDATE="ICE_CANDIDATE"}(t=e.Type||(e.Type={})),function(e){e[e.SDP_OFFER=0]="SDP_OFFER",e[e.SDP_ANSWER=1]="SDP_ANSWER",e[e.ICE_CANDIDATE=2]="ICE_CANDIDATE"}(r||(r={})),function(e){e.codec=()=>(0,Ri.Ji)(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=(0,Ri.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.data&&(r.uint32(18),r.string(t.data)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.Type.codec().decode(t);break;case 2:n.data=t.string();break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,Ri.LE)(t,e.codec()),e.decode=t=>(0,Ri.C6)(t,e.codec())}(ki||(ki={}));const Di=oe("libp2p:webrtc:peer:util"),Oi=async(e,t,r)=>{for(;;){const n=await Promise.race([e.promise,r.read()]);if(!(n instanceof Object))break;{const e=n;if(e.type!==ki.Type.ICE_CANDIDATE)throw new Error("expected only ice candidates");if(null==e.data||""===e.data){Di.trace("end-of-candidates received");break}Di.trace("received new ICE candidate: %s",e.data);try{await t.addIceCandidate(new ui(JSON.parse(e.data)))}catch(e){throw Di.error("bad candidate received: ",e),new Error("bad candidate received")}}}await e.promise};function Ni(e,t){e[ri?"oniceconnectionstatechange":"onconnectionstatechange"]=r=>{switch(Di.trace("receiver peerConnectionState state: ",e.connectionState),ri?e.iceConnectionState:e.connectionState){case"connected":t.resolve();break;case"failed":case"disconnected":case"closed":t.reject(new Error("RTCPeerConnection was closed"))}}}const Li=oe("libp2p:webrtc:peer");function Ui(e){const t=e.split("\r\n").filter((e=>e.startsWith("a=candidate"))).pop(),r=t?.split(" ");return null==t||null==r||r.length<5?(Li("could not parse remote address from",t),"/webrtc"):`/dnsaddr/${r[4]}/${r[2].toLowerCase()}/${r[5]}/webrtc`}var Mi=r(23247),Bi=r(61093);class Ki extends Mi.v{peerId;transportManager;constructor(e){super(),this.peerId=e.peerId,this.transportManager=e.transportManager}async listen(){this.safeDispatchEvent("listening",{})}getAddrs(){return this.transportManager.getListeners().filter((e=>e!==this)).map((e=>e.getAddrs().filter((e=>Bi.dx.matches(e))).map((e=>e.encapsulate(`/webrtc/p2p/${this.peerId}`))))).flat()}async close(){this.safeDispatchEvent("close",{})}}const $i=oe("libp2p:webrtc:peer"),Vi="/webrtc",ji="/p2p-circuit",zi="/webrtc-signaling/0.0.1";class qi{components;init;_started=!1;metrics;constructor(e,t={}){this.components=e,this.init=t,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(zi,(e=>{this._onProtocol(e).catch((t=>{$i.error("failed to handle incoming connect from %p",e.connection.remotePeer,t)}))}),{runOnTransientConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(zi),this._started=!1}createListener(e){return new Ki(this.components)}[Symbol.toStringTag]="@libp2p/webrtc";[D.NA]=!0;filter(e){return e.filter(zn.uF.exactMatch)}async dial(e,t){$i.trace("dialing address: ",e);const{baseAddr:r,peerId:n}=function(e){const t=e.toString().split(Vi+"/");if(2!==t.length)throw new k.sv("webrtc protocol was not present in multiaddr",jn.ERR_INVALID_MULTIADDR);if(!t[0].includes(ji))throw new k.sv("p2p-circuit protocol was not present in multiaddr",jn.ERR_INVALID_MULTIADDR);let r=Vn(t[0]);const n=Vn("/"+t[1]).getPeerId();if(null==n)throw new k.sv("destination peer id was missing",jn.ERR_INVALID_MULTIADDR);const i=r.protos().pop();if(void 0===i)throw new k.sv("invalid multiaddr",jn.ERR_INVALID_MULTIADDR);"p2p"!==i.name&&(r=r.encapsulate(`/p2p/${n}`));return{baseAddr:r,peerId:Pt(n)}}(e);if(null==t.signal){const e=new AbortController;t.signal=e.signal}this.metrics?.dialerEvents.increment({open:!0});const i=await this.components.transportManager.dial(r,t),s=await i.newStream(zi,{...t,runOnTransientConnection:!0});try{const{pc:e,muxerFactory:r,remoteAddress:i}=await async function({rtcConfiguration:e,dataChannelOptions:t,signal:r,stream:n}){const i=(0,pi.z)(fi(n,r)).pb(ki),s=new ai(e);try{const e=new Ci({peerConnection:s,dataChannelOptions:t}),n=(0,yi.Z)();Ni(s,n),r.onabort=n.reject;const o=s.createDataChannel("init");s.onicecandidate=({candidate:e})=>{i.write({type:ki.Type.ICE_CANDIDATE,data:null!=e?JSON.stringify(e.toJSON()):""}).catch((e=>{Li.error("error sending ICE candidate",e)}))};const a=await s.createOffer();await i.write({type:ki.Type.SDP_OFFER,data:a.sdp}),await s.setLocalDescription(a).catch((e=>{throw Li.error("could not execute setLocalDescription",e),new Error("Failed to set localDescription")}));const c=await i.read();if(c.type!==ki.Type.SDP_ANSWER)throw new Error("remote should send an SDP answer");const u=new ci({type:"answer",sdp:c.data});return await s.setRemoteDescription(u).catch((e=>{throw Li.error("could not execute setRemoteDescription",e),new Error("Failed to set remoteDescription")})),await Oi(n,s,i),o.close(),{pc:s,muxerFactory:e,remoteAddress:Ui(s.currentRemoteDescription?.sdp??"")}}catch(e){throw s.close(),e}}({stream:s,rtcConfiguration:this.init.rtcConfiguration,dataChannelOptions:this.init.dataChannel,signal:t.signal}),o=await t.upgrader.upgradeOutbound(new oi({peerConnection:e,timeline:{open:Date.now()},remoteAddr:Vn(i).encapsulate(`/p2p/${n.toString()}`),metrics:this.metrics?.dialerEvents}),{skipProtection:!0,skipEncryption:!0,muxerFactory:r});return await s.close(),o}catch(e){throw this.metrics?.dialerEvents.increment({error:!0}),s.abort(e),e}finally{await i.close()}}async _onProtocol({connection:e,stream:t}){try{const{pc:r,muxerFactory:n,remoteAddress:i}=await async function({rtcConfiguration:e,dataChannelOptions:t,stream:r}){const n=AbortSignal.timeout(3e4),i=(0,pi.z)(fi(r,n)).pb(ki),s=new ai(e);try{const e=new Ci({peerConnection:s,dataChannelOptions:t}),r=(0,yi.Z)(),o=(0,yi.Z)();n.onabort=()=>{r.reject(new k.sv("Timed out while trying to connect","ERR_TIMEOUT"))},s.onicecandidate=({candidate:e})=>{o.promise.then((async()=>{await i.write({type:ki.Type.ICE_CANDIDATE,data:null!=e?JSON.stringify(e.toJSON()):""})}),(e=>{Li.error("cannot set candidate since sending answer failed",e),r.reject(e)}))},Ni(s,r);const a=await i.read();if(a.type!==ki.Type.SDP_OFFER)throw new Error(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);const c=new ci({type:"offer",sdp:a.data});await s.setRemoteDescription(c).catch((e=>{throw Li.error("could not execute setRemoteDescription",e),new Error("Failed to set remoteDescription")}));const u=await s.createAnswer().catch((e=>{throw Li.error("could not execute createAnswer",e),o.reject(e),new Error("Failed to create answer")}));return await i.write({type:ki.Type.SDP_ANSWER,data:u.sdp}),await s.setLocalDescription(u).catch((e=>{throw Li.error("could not execute setLocalDescription",e),o.reject(e),new Error("Failed to set localDescription")})),o.resolve(),await Oi(r,s,i),{pc:s,muxerFactory:e,remoteAddress:Ui(s.currentRemoteDescription?.sdp??"")}}catch(e){throw s.close(),e}}({rtcConfiguration:this.init.rtcConfiguration,connection:e,stream:t,dataChannelOptions:this.init.dataChannel});await this.components.upgrader.upgradeInbound(new oi({peerConnection:r,timeline:{open:(new Date).getTime()},remoteAddr:Vn(i).encapsulate(`/p2p/${e.remotePeer.toString()}`),metrics:this.metrics?.listenerEvents}),{skipEncryption:!0,skipProtection:!0,muxerFactory:n})}catch(e){throw t.abort(e),e}finally{await e.close()}}}var Fi=r(99644),Gi=r(9886);function Hi(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Wi(e=0){return null!=globalThis.Buffer?.allocUnsafe?Hi(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Yi(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Qi=Yi("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Ji=Yi("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Wi((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Zi={utf8:Qi,"utf-8":Qi,hex:mt.base16,latin1:Ji,ascii:Ji,binary:Ji,...mt};function Xi(e,t="utf8"){const r=Zi[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):Hi(globalThis.Buffer.from(e,"utf-8"))}const es=oe("libp2p:webrtc:sdp"),ts=Object.values(mt).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)));function rs(e){const t=e.getConfiguration().certificates?.at(0);if(null==t||null==t.getFingerprints){es.trace("fetching fingerprint from local SDP");const t=e.localDescription;if(null==t)return;return function(e){const t=e.match(ns);return t?.groups?.fingerprint}(t.sdp)}if(es.trace("fetching fingerprint from local certificate"),0===t.getFingerprints().length)return;const r=t.getFingerprints()[0].value;if(null==r)throw Zn("","no fingerprint on local certificate");return r}const ns=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function is(e){const t=e.stringTuples().filter((e=>e[0]===ls)).map((e=>e[1]))[0];if(void 0===t||""===t)throw Wn(`Couldn't find a certhash component of multiaddr: ${e.toString()}`);return t}function ss(e){const t=ts.decode(e);return Gi.decode(t)}function os(e){switch(e){case"sha1":return"sha-1";case"sha2-256":return"sha-256";case"sha2-512":return"sha-512";default:throw new ei(e)}}function as(e,t){const{host:r,port:n}=e.toOptions(),i=function(e){for(const t of e.protoNames())if(t.startsWith("ip"))return t.toUpperCase();return es("Warning: multiaddr does not appear to contain IP4 or IP6, defaulting to IP6",e),"IP6"}(e),[s]=function(e){const t=ss(is(e)),r=os(t.name),n=t.digest.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),i=n.match(/.{1,2}/g);if(null==i)throw Zn(n,e.toString());return[`${r.toUpperCase()} ${i.join(":").toUpperCase()}`,n]}(e);return`v=0\no=- 0 0 IN ${i} ${r}\ns=-\nc=IN ${i} ${r}\nt=0 0\na=ice-lite\nm=application ${n} UDP/DTLS/SCTP webrtc-datachannel\na=mid:0\na=setup:passive\na=ice-ufrag:${t}\na=ice-pwd:${t}\na=fingerprint:${s}\na=sctp-port:5000\na=max-message-size:16384\na=candidate:1467250027 1 UDP 1467250027 ${r} ${n} typ host\r\n`}const cs=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),us=oe("libp2p:webrtc:transport"),ls=(bn("webrtc-direct").code,bn("certhash").code);class hs{metrics;components;init;constructor(e,t={}){this.components=e,this.init=t,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async dial(e,t){const r=await this._connect(e,t);return us(`dialing address - ${e.toString()}`),r}createListener(e){throw new Xn("WebRTCTransport.createListener")}filter(e){return e.filter(zn.Ih.exactMatch)}[Symbol.toStringTag]="@libp2p/webrtc-direct";[D.NA]=!0;async _connect(e,t){const r=new AbortController,n=r.signal,i=e.getPeerId();if(null===i)throw Wn("we need to have the remote's PeerId");const s=Pt(i),o=ss(is(e)),a=await ai.generateCertificate({name:"ECDSA",namedCurve:"P-256",hash:os(o.name)}),c=new ai({certificates:[a]});try{const i=new Promise(((e,t)=>{const r=c.createDataChannel("",{negotiated:!0,id:0}),n=setTimeout((()=>{const e=`Data channel was never opened: state: ${r.readyState}`;us.error(e),this.metrics?.dialerEvents.increment({open_error:!0}),t(Gn("data",e))}),1e4);r.onopen=t=>{clearTimeout(n),e(r)},r.onerror=e=>{clearTimeout(n);const r=`Error opening a data channel for handshaking: ${e.target?.toString()??"not specified"}`;us.error(r),this.metrics?.dialerEvents.increment({unknown_error:!0}),t(Gn("data",r))}})),a="libp2p+webrtc+v1/"+[...Array(32)].map((()=>cs.at(Math.floor(Math.random()*cs.length)))).join(""),u=function(e,t){if(void 0===e.sdp)throw Qn("Can't munge a missing SDP");return e.sdp=e.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,"\na=ice-ufrag:"+t+"\n").replace(/\na=ice-pwd:[^\n]*\n/,"\na=ice-pwd:"+t+"\n"),e}(await c.createOffer(),a);await c.setLocalDescription(u);const l=function(e,t){return{type:"answer",sdp:as(e,t)}}(e,a);await c.setRemoteDescription(l);const h=await i,d=this.components.peerId,f=this.generateNoisePrologue(c,o.code,e),p=(0,Fi.t)({prologueBytes:f})(),y=xi({channel:h,direction:"inbound",dataChannelOptions:this.init.dataChannel}),g={...y,sink:y.sink.bind(y),source:async function*(){for await(const e of y.source)for(const t of e)yield t}()},m=new oi({peerConnection:c,remoteAddr:e,timeline:{open:Date.now()},metrics:this.metrics?.dialerEvents}),b=ri?"iceconnectionstatechange":"connectionstatechange";c.addEventListener(b,(()=>{switch(c.connectionState){case"failed":case"disconnected":case"closed":m.close().catch((e=>{us.error("error closing connection",e)})).finally((()=>{r.abort()}))}}),{signal:n}),this.metrics?.dialerEvents.increment({peer_connection:!0});const w=new Ci({peerConnection:c,metrics:this.metrics?.dialerEvents,dataChannelOptions:this.init.dataChannel});return await p.secureInbound(d,g,s),await t.upgrader.upgradeOutbound(m,{skipProtection:!0,skipEncryption:!0,muxerFactory:w})}catch(e){throw c.close(),e}}generateNoisePrologue(e,t,r){if(0===e.getConfiguration().certificates?.length)throw Qn("no local certificate");const n=rs(e);if(null==n)throw Qn("no local fingerprint found");const i=Xi(n.trim().toLowerCase().replaceAll(":",""),"hex"),s=Gi.encode(i,t),o=ts.decode(is(r));return function(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Wi(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return Hi(r)}([Xi("libp2p-webrtc-noise:"),s,o])}}function ds(e){return t=>new hs(t,e)}function fs(e){return t=>new qi(t,e)}},84593:function(e,t,r){"use strict";r.d(t,{E:function(){return i}});var n=r(10034);function i(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?(0,n.P)(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}},47:function(e,t,r){"use strict";r.r(t),r.d(t,{concat:function(){return s}});var n=r(84593),i=r(10034);function s(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const r=(0,n.E)(t);let s=0;for(const t of e)r.set(t,s),s+=t.length;return(0,i.P)(r)}},81848:function(e,t,r){"use strict";r.r(t),r.d(t,{fromString:function(){return s}});var n=r(32290),i=r(10034);function s(e,t="utf8"){const r=n.Z[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):(0,i.P)(globalThis.Buffer.from(e,"utf-8"))}},26467:function(e,t,r){"use strict";r.r(t),r.d(t,{toString:function(){return i}});var n=r(32290);function i(e,t="utf8"){const r=n.Z[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}},10034:function(e,t,r){"use strict";function n(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}r.d(t,{P:function(){return n}})},32290:function(e,t,r){"use strict";r.d(t,{Z:function(){return Fe}});var n={};r.r(n),r.d(n,{identity:function(){return P}});var i={};r.r(i),r.d(i,{base2:function(){return C}});var s={};r.r(s),r.d(s,{base8:function(){return T}});var o={};r.r(o),r.d(o,{base10:function(){return k}});var a={};r.r(a),r.d(a,{base16:function(){return D},base16upper:function(){return O}});var c={};r.r(c),r.d(c,{base32:function(){return N},base32hex:function(){return B},base32hexpad:function(){return $},base32hexpadupper:function(){return V},base32hexupper:function(){return K},base32pad:function(){return U},base32padupper:function(){return M},base32upper:function(){return L},base32z:function(){return j}});var u={};r.r(u),r.d(u,{base36:function(){return z},base36upper:function(){return q}});var l={};r.r(l),r.d(l,{base58btc:function(){return F},base58flickr:function(){return G}});var h={};r.r(h),r.d(h,{base64:function(){return H},base64pad:function(){return W},base64url:function(){return Y},base64urlpad:function(){return Q}});var d={};r.r(d),r.d(d,{base256emoji:function(){return ee}});var f={};r.r(f),r.d(f,{sha256:function(){return Re},sha512:function(){return Ie}});var p={};r.r(p),r.d(p,{identity:function(){return Pe}});var y={};r.r(y),r.d(y,{code:function(){return Te},decode:function(){return De},encode:function(){return ke},name:function(){return Ce}});var g={};r.r(g),r.d(g,{code:function(){return Ue},decode:function(){return Be},encode:function(){return Me},name:function(){return Le}});var m=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},b=m;new Uint8Array(0);const w=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class v{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class E{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return A(this,e)}}class _{constructor(e){this.decoders=e}or(e){return A(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const A=(e,t)=>new _({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class S{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new v(e,t,r),this.decoder=new E(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const R=({name:e,prefix:t,encode:r,decode:n})=>new S(e,t,r,n),I=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=b(r,t);return R({prefix:e,name:t,encode:n,decode:e=>w(i(e))})},x=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>R({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),P=R({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),C=x({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),T=x({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),k=I({prefix:"9",name:"base10",alphabet:"0123456789"}),D=x({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),O=x({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),N=x({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),L=x({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),U=x({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),M=x({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),B=x({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),K=x({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),$=x({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),V=x({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),j=x({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),z=I({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),q=I({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),F=I({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),G=I({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),H=x({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),W=x({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Y=x({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Q=x({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),J=Array.from(""),Z=J.reduce(((e,t,r)=>(e[r]=t,e)),[]),X=J.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const ee=R({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Z[t]),"")},decode:function(e){const t=[];for(const r of e){const e=X[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var te=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=ie;)r[n++]=255&t|re,t/=128;for(;t&ne;)r[n++]=255&t|re,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},re=128,ne=-128,ie=Math.pow(2,31);var se=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&ae)<<s:(n&ae)*Math.pow(2,s),s+=7}while(n>=oe);return e.bytes=o-r,i},oe=128,ae=127;var ce=Math.pow(2,7),ue=Math.pow(2,14),le=Math.pow(2,21),he=Math.pow(2,28),de=Math.pow(2,35),fe=Math.pow(2,42),pe=Math.pow(2,49),ye=Math.pow(2,56),ge=Math.pow(2,63),me={encode:te,decode:se,encodingLength:function(e){return e<ce?1:e<ue?2:e<le?3:e<he?4:e<de?5:e<fe?6:e<pe?7:e<ye?8:e<ge?9:10}};const be=(e,t,r=0)=>(me.encode(e,t,r),t),we=e=>me.encodingLength(e),ve=(e,t)=>{const r=t.byteLength,n=we(e),i=n+we(r),s=new Uint8Array(i+r);return be(e,s,0),be(r,s,n),s.set(t,i),new Ee(e,r,t,s)};class Ee{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const _e=({name:e,code:t,encode:r})=>new Ae(e,t,r);class Ae{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ve(this.code,t):t.then((e=>ve(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Se=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Re=_e({name:"sha2-256",code:18,encode:Se("SHA-256")}),Ie=_e({name:"sha2-512",code:19,encode:Se("SHA-512")}),xe=w,Pe={code:0,name:"identity",encode:xe,digest:e=>ve(0,xe(e))},Ce="raw",Te=85,ke=e=>w(e),De=e=>w(e),Oe=new TextEncoder,Ne=new TextDecoder,Le="json",Ue=512,Me=e=>Oe.encode(JSON.stringify(e)),Be=e=>JSON.parse(Ne.decode(e));r(25108);class Ke{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:cid_hidden,byteLength:cid_hidden,code:readonly,version:readonly,multihash:readonly,bytes:readonly,_baseCache:cid_hidden,asCID:cid_hidden})}toV0(){if(0===this.version)return this;{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ke.createV0(t)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return Ke.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Digest.equals(this.multihash,e.multihash)}toString(e){const{bytes:t,version:r,_baseCache:n}=this;return 0===r?toStringV0(t,n,e||base58btc.encoder):toStringV1(t,n,e||base32.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return deprecate(/^0\.0/,IS_CID_DEPRECATION),!(!e||!e[cidSymbol]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof Ke)return e;if(null!=e&&e.asCID===e){const{version:t,code:r,multihash:n,bytes:i}=e;return new Ke(t,r,n,i||encodeCID(t,r,n.bytes))}if(null!=e&&!0===e[cidSymbol]){const{version:t,multihash:r,code:n}=e,i=Digest.decode(r);return Ke.create(t,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new Ke(e,t,r,r.bytes);case 1:{const n=encodeCID(e,t,r.bytes);return new Ke(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Ke.create(0,DAG_PB_CODE,e)}static createV1(e,t){return Ke.create(1,e,t)}static decode(e){const[t,r]=Ke.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ke.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?Ke.createV0(s):Ke.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=DAG_PB_CODE;if(18===n?(0,0):1===n&&r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=parseCIDtoBytes(e,t),i=Ke.decode(n);return i._baseCache.set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const $e={...n,...i,...s,...o,...a,...c,...u,...l,...h,...d};var Ve=r(84593);function je(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const ze=je("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),qe=je("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{e=e.substring(1);const t=(0,Ve.E)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Fe={utf8:ze,"utf-8":ze,hex:$e.base16,latin1:qe,ascii:qe,binary:qe,...$e}},87960:function(e,t,r){"use strict";r.d(t,{$K:function(){return o},MQ:function(){return s},U1:function(){return i},fJ:function(){return n},fS:function(){return a}});const n=421,i=290,s=6,o=478,a=500},38134:function(e,t,r){"use strict";r.d(t,{$6:function(){return s},FR:function(){return a},xt:function(){return o}});var n=r(61093),i=r(87960);function s(e){return e.filter((e=>{if(e.protoCodes().includes(i.U1))return!1;const t=e.decapsulateCode(i.fJ);return n.Ce.matches(t)||n.th.matches(t)}))}function o(e){return e.filter((e=>{if(e.protoCodes().includes(i.U1))return!1;const t=e.decapsulateCode(i.fJ);return n.th.matches(t)}))}function a(e){return e.filter((e=>{if(e.protoCodes().includes(i.U1))return!1;const t=e.decapsulateCode(i.fJ);return n.th.matches(t)&&n.Rk.matches(t.decapsulateCode(i.MQ).decapsulateCode(i.$K))}))}},57392:function(e,t,r){"use strict";r.d(t,{E:function(){return T}});var n=r(49541),i=r(55265),s=r(11227);var o=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);class a{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class c{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return l(this,e)}}class u{constructor(e){this.decoders=e}or(e){return l(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const l=(e,t)=>new u({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class h{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new a(e,t,r),this.decoder=new c(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const d=({name:e,prefix:t,encode:r,decode:n})=>new h(e,t,r,n),f=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=o(r,t);return d({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(i(e))})},p=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>d({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),y=p({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),g=(p({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),p({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),p({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),p({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),p({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),p({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),p({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),f({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"})),m=(f({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),p({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}));p({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),p({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),p({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function b(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return s.enabled(`${e}:trace`)&&null!=s.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=s(`${e}:trace`)),Object.assign(s(e),{error:s(`${e}:error`),trace:t})}s.formatters.b=e=>null==e?"undefined":g.baseEncode(e),s.formatters.t=e=>null==e?"undefined":y.baseEncode(e),s.formatters.m=e=>null==e?"undefined":m.baseEncode(e),s.formatters.p=e=>null==e?"undefined":e.toString(),s.formatters.c=e=>null==e?"undefined":e.toString(),s.formatters.k=e=>null==e?"undefined":e.toString(),s.formatters.a=e=>null==e?"undefined":e.toString();var w=r(38456),v=r(24143),E=r(85275),_=r(14560),A=r(38134);class S extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function R(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new S(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new S(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}var I=r(87960);const x=b("libp2p:websockets:socket");const P=b("libp2p:websockets");class C{init;constructor(e){this.init=e}[Symbol.toStringTag]="@libp2p/websockets";[i.NA]=!0;async dial(e,t){P("dialing %s",e),t=t??{};const r=function(e,t,r){const i={async sink(t){null!=r?.signal&&(t=R(t,r.signal));try{await e.sink(t)}catch(e){"aborted"!==e.type&&x.error(e)}},source:null!=(r=r??{}).signal?R(e.source,r.signal):e.source,remoteAddr:t,timeline:{open:Date.now()},async close(t={}){const r=Date.now();t.signal=t.signal??AbortSignal.timeout(I.fS);const s=()=>{const{host:e,port:t}=i.remoteAddr.toOptions();x("timeout closing stream to %s:%s after %dms, destroying it manually",e,t,Date.now()-r),this.abort(new n.sv("Socket close timeout","ERR_SOCKET_CLOSE_TIMEOUT"))};t.signal.addEventListener("abort",s);try{await e.close()}catch(e){x.error("error closing WebSocket gracefully",e),this.abort(e)}finally{t.signal.removeEventListener("abort",s),i.timeline.close=Date.now()}},abort(t){const{host:r,port:n}=i.remoteAddr.toOptions();x("timeout closing stream to %s:%s due to error",r,n,t),e.destroy(),i.timeline.close=Date.now()}};return e.socket.addEventListener("close",(()=>{null==i.timeline.close&&(i.timeline.close=Date.now())}),{once:!0}),i}(await this._connect(e,t),e);P("new outbound connection %s",r.remoteAddr);const i=await t.upgrader.upgradeOutbound(r);return P("outbound connection %s upgraded",r.remoteAddr),i}async _connect(e,t){if(!0===t?.signal?.aborted)throw new n._L;const r=e.toOptions();P("dialing %s:%s",r.host,r.port);const i=(0,E.Z)(),s=(0,v.$)((0,w.k)(e),this.init);if(s.socket.addEventListener("error",(()=>{const t=new n.sv(`Could not connect to ${e.toString()}`,"ERR_CONNECTION_FAILED");P.error("connection error:",t),i.reject(t)})),null==t.signal)return await Promise.race([s.connected(),i.promise]),P("connected %s",e),s;let o;const a=new Promise(((e,r)=>{o=()=>{r(new n._L),s.close().catch((e=>{P.error("error closing raw socket",e)}))},!0!==t?.signal?.aborted?t?.signal?.addEventListener("abort",o):o()}));try{await Promise.race([a,i.promise,s.connected()])}finally{null!=o&&t?.signal?.removeEventListener("abort",o)}return P("connected %s",e),s}createListener(e){return function(){throw new Error("WebSocket Servers can not be created in the browser!")}(this.init)}filter(e){return e=Array.isArray(e)?e:[e],null!=this.init?.filter?this.init?.filter(e):_.jU||_.n2?A.xt(e):A.$6(e)}}function T(e={}){return()=>new C(e)}},15624:function(e,t,r){"use strict";r.d(t,{d:function(){return wn}});var n={};r.r(n),r.d(n,{base32:function(){return F},base32hex:function(){return Y},base32hexpad:function(){return J},base32hexpadupper:function(){return Z},base32hexupper:function(){return Q},base32pad:function(){return H},base32padupper:function(){return W},base32upper:function(){return G},base32z:function(){return X}});var i={};r.r(i),r.d(i,{base58btc:function(){return ee},base58flickr:function(){return te}});var s={};r.r(s),r.d(s,{base64:function(){return re},base64pad:function(){return ne},base64url:function(){return ie},base64urlpad:function(){return se}});var o={};r.r(o),r.d(o,{identity:function(){return Xe}});var a={};r.r(a),r.d(a,{base2:function(){return et}});var c={};r.r(c),r.d(c,{base8:function(){return tt}});var u={};r.r(u),r.d(u,{base10:function(){return rt}});var l={};r.r(l),r.d(l,{base16:function(){return nt},base16upper:function(){return it}});var h={};r.r(h),r.d(h,{base32:function(){return st},base32hex:function(){return ut},base32hexpad:function(){return ht},base32hexpadupper:function(){return dt},base32hexupper:function(){return lt},base32pad:function(){return at},base32padupper:function(){return ct},base32upper:function(){return ot},base32z:function(){return ft}});var d={};r.r(d),r.d(d,{base36:function(){return pt},base36upper:function(){return yt}});var f={};r.r(f),r.d(f,{base58btc:function(){return gt},base58flickr:function(){return mt}});var p={};r.r(p),r.d(p,{base64:function(){return bt},base64pad:function(){return wt},base64url:function(){return vt},base64urlpad:function(){return Et}});var y={};r.r(y),r.d(y,{base256emoji:function(){return Rt}});var g={};r.r(g),r.d(g,{sha256:function(){return Qt},sha512:function(){return Jt}});var m={};r.r(m),r.d(m,{identity:function(){return Xt}});var b={};r.r(b),r.d(b,{code:function(){return tr},decode:function(){return nr},encode:function(){return rr},name:function(){return er}});var w={};r.r(w),r.d(w,{code:function(){return ar},decode:function(){return ur},encode:function(){return cr},name:function(){return or}});var v={};r.r(v),r.d(v,{base10:function(){return gr}});var E={};r.r(E),r.d(E,{base16:function(){return mr},base16upper:function(){return br}});var _={};r.r(_),r.d(_,{base2:function(){return wr}});var A={};r.r(A),r.d(A,{base256emoji:function(){return Ar}});var S={};r.r(S),r.d(S,{base36:function(){return Sr},base36upper:function(){return Rr}});var R={};r.r(R),r.d(R,{base8:function(){return Ir}});var I={};r.r(I),r.d(I,{identity:function(){return xr}});var x={};r.r(x),r.d(x,{code:function(){return kr},decode:function(){return Or},encode:function(){return Dr},name:function(){return Tr}});var P={};r.r(P),r.d(P,{code:function(){return Lr},decode:function(){return Mr},encode:function(){return Ur},name:function(){return Nr}});var C={};r.r(C),r.d(C,{identity:function(){return Kr}});var T={};r.r(T),r.d(T,{sha256:function(){return zr},sha512:function(){return qr}});var k=r(99644),D=r(55265),O=r(11227);var N=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},L=N;new Uint8Array(0);const U=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class M{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class B{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return $(this,e)}}class K{constructor(e){this.decoders=e}or(e){return $(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const $=(e,t)=>new K({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class V{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new M(e,t,r),this.decoder=new B(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const j=({name:e,prefix:t,encode:r,decode:n})=>new V(e,t,r,n),z=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=L(r,t);return j({prefix:e,name:t,encode:n,decode:e=>U(i(e))})},q=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>j({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),F=q({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),G=q({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),H=q({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),W=q({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Y=q({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Q=q({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),J=q({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Z=q({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),X=q({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ee=z({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),te=z({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),re=q({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ne=q({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ie=q({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),se=q({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function oe(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return O.enabled(`${e}:trace`)&&null!=O.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=O(`${e}:trace`)),Object.assign(O(e),{error:O(`${e}:error`),trace:t})}O.formatters.b=e=>null==e?"undefined":ee.baseEncode(e),O.formatters.t=e=>null==e?"undefined":F.baseEncode(e),O.formatters.m=e=>null==e?"undefined":re.baseEncode(e),O.formatters.p=e=>null==e?"undefined":e.toString(),O.formatters.c=e=>null==e?"undefined":e.toString(),O.formatters.k=e=>null==e?"undefined":e.toString(),O.formatters.a=e=>null==e?"undefined":e.toString();var ae=r(49541),ce=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=he;)r[n++]=255&t|ue,t/=128;for(;t&le;)r[n++]=255&t|ue,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},ue=128,le=-128,he=Math.pow(2,31);var de=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&pe)<<s:(n&pe)*Math.pow(2,s),s+=7}while(n>=fe);return e.bytes=o-r,i},fe=128,pe=127;var ye=Math.pow(2,7),ge=Math.pow(2,14),me=Math.pow(2,21),be=Math.pow(2,28),we=Math.pow(2,35),ve=Math.pow(2,42),Ee=Math.pow(2,49),_e=Math.pow(2,56),Ae=Math.pow(2,63),Se={encode:ce,decode:de,encodingLength:function(e){return e<ye?1:e<ge?2:e<me?3:e<be?4:e<we?5:e<ve?6:e<Ee?7:e<_e?8:e<Ae?9:10}};const Re=(e,t=0)=>[Se.decode(e,t),Se.decode.bytes],Ie=(e,t,r=0)=>(Se.encode(e,t,r),t),xe=e=>Se.encodingLength(e),Pe=(e,t)=>{const r=t.byteLength,n=xe(e),i=n+xe(r),s=new Uint8Array(i+r);return Ie(e,s,0),Ie(r,s,n),s.set(t,i),new Te(e,r,t,s)},Ce=e=>{const t=U(e),[r,n]=Re(t),[i,s]=Re(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Te(r,i,o,t)};class Te{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const ke=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Ue(r,Oe(e),t||ee.encoder):Me(r,Oe(e),t||F.encoder)},De=new WeakMap,Oe=e=>{const t=De.get(e);if(null==t){const t=new Map;return De.set(e,t),t}return t};class Ne{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Be)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ke)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ne.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Pe(e,t);return Ne.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ne.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return ke(this,e)}toJSON(){return{"/":ke(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Ne)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Ne(e,r,n,i||$e(e,r,n.bytes))}if(!0===t[Ve]){const{version:e,multihash:r,code:n}=t,i=Ce(r);return Ne.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Be)throw new Error(`Version 0 CID must use dag-pb (code: ${Be}) block encoding`);return new Ne(e,t,r,r.bytes);case 1:{const n=$e(e,t,r.bytes);return new Ne(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Ne.create(0,Be,e)}static createV1(e,t){return Ne.create(1,e,t)}static decode(e){const[t,r]=Ne.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ne.inspectBytes(e),r=t.size-t.multihashSize,n=U(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Te(t.multihashCode,t.digestSize,i,n);return[0===t.version?Ne.createV0(s):Ne.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Re(e.subarray(t));return t+=n,r};let n=r(),i=Be;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=Le(e,t),i=Ne.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Oe(i).set(r,e),i}}const Le=(e,t)=>{switch(e[0]){case"Q":{const r=t||ee;return[ee.prefix,r.decode(`${ee.prefix}${e}`)]}case ee.prefix:{const r=t||ee;return[ee.prefix,r.decode(e)]}case F.prefix:{const r=t||F;return[F.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Ue=(e,t,r)=>{const{prefix:n}=r;if(n!==ee.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Me=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},Be=112,Ke=18,$e=(e,t,r)=>{const n=xe(e),i=n+xe(t),s=new Uint8Array(i+r.byteLength);return Ie(e,s,0),Ie(t,s,n),s.set(r,i),s},Ve=Symbol.for("@ipld/js-cid/CID");var je=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},ze=je;new Uint8Array(0);const qe=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Fe{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ge{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return We(this,e)}}class He{constructor(e){this.decoders=e}or(e){return We(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const We=(e,t)=>new He({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Ye{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Fe(e,t,r),this.decoder=new Ge(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Qe=({name:e,prefix:t,encode:r,decode:n})=>new Ye(e,t,r,n),Je=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=ze(r,t);return Qe({prefix:e,name:t,encode:n,decode:e=>qe(i(e))})},Ze=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Qe({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Xe=Qe({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),et=Ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),tt=Ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),rt=Je({prefix:"9",name:"base10",alphabet:"0123456789"}),nt=Ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),it=Ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),st=Ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ot=Ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),at=Ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ct=Ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ut=Ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),lt=Ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ht=Ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),dt=Ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ft=Ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),pt=Je({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),yt=Je({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),gt=Je({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mt=Je({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),bt=Ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),wt=Ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),vt=Ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Et=Ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),_t=Array.from(""),At=_t.reduce(((e,t,r)=>(e[r]=t,e)),[]),St=_t.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Rt=Qe({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=At[t]),"")},decode:function(e){const t=[];for(const r of e){const e=St[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var It=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Ct;)r[n++]=255&t|xt,t/=128;for(;t&Pt;)r[n++]=255&t|xt,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},xt=128,Pt=-128,Ct=Math.pow(2,31);var Tt=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Dt)<<s:(n&Dt)*Math.pow(2,s),s+=7}while(n>=kt);return e.bytes=o-r,i},kt=128,Dt=127;var Ot=Math.pow(2,7),Nt=Math.pow(2,14),Lt=Math.pow(2,21),Ut=Math.pow(2,28),Mt=Math.pow(2,35),Bt=Math.pow(2,42),Kt=Math.pow(2,49),$t=Math.pow(2,56),Vt=Math.pow(2,63),jt={encode:It,decode:Tt,encodingLength:function(e){return e<Ot?1:e<Nt?2:e<Lt?3:e<Ut?4:e<Mt?5:e<Bt?6:e<Kt?7:e<$t?8:e<Vt?9:10}};const zt=(e,t,r=0)=>(jt.encode(e,t,r),t),qt=e=>jt.encodingLength(e),Ft=(e,t)=>{const r=t.byteLength,n=qt(e),i=n+qt(r),s=new Uint8Array(i+r);return zt(e,s,0),zt(r,s,n),s.set(t,i),new Gt(e,r,t,s)};class Gt{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Ht=({name:e,code:t,encode:r})=>new Wt(e,t,r);class Wt{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ft(this.code,t):t.then((e=>Ft(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Yt=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Qt=Ht({name:"sha2-256",code:18,encode:Yt("SHA-256")}),Jt=Ht({name:"sha2-512",code:19,encode:Yt("SHA-512")}),Zt=qe,Xt={code:0,name:"identity",encode:Zt,digest:e=>Ft(0,Zt(e))},er="raw",tr=85,rr=e=>qe(e),nr=e=>qe(e),ir=new TextEncoder,sr=new TextDecoder,or="json",ar=512,cr=e=>ir.encode(JSON.stringify(e)),ur=e=>JSON.parse(sr.decode(e));new WeakMap;class lr{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return lr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return lr.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return lr.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return cid_format(this,e)}toJSON(){return{"/":cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof lr)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new lr(e,r,n,i||cid_encodeCID(e,r,n.bytes))}if(!0===t[cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return lr.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new lr(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new lr(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return lr.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return lr.create(1,e,t)}static decode(e){const[t,r]=lr.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=lr.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?lr.createV0(s):lr.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),i=lr.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const hr={...o,...a,...c,...u,...l,...h,...d,...f,...p,...y};function dr(e=0){return null!=globalThis.Buffer?.allocUnsafe?(t=globalThis.Buffer.allocUnsafe(e),null!=globalThis.Buffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t):new Uint8Array(e);var t}function fr(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const pr=fr("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),yr=fr("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=dr((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));r(57050),r(9839);const gr=z({prefix:"9",name:"base10",alphabet:"0123456789"}),mr=q({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),br=q({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),wr=q({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),vr=Array.from(""),Er=vr.reduce(((e,t,r)=>(e[r]=t,e)),[]),_r=vr.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Ar=j({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Er[t]),"")},decode:function(e){const t=[];for(const r of e){const e=_r[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),Sr=z({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Rr=z({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ir=q({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),xr=j({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Pr=new TextEncoder,Cr=new TextDecoder,Tr="json",kr=512,Dr=e=>Pr.encode(JSON.stringify(e)),Or=e=>JSON.parse(Cr.decode(e)),Nr="raw",Lr=85,Ur=e=>U(e),Mr=e=>U(e),Br=U,Kr={code:0,name:"identity",encode:Br,digest:e=>Pe(0,Br(e))},$r=({name:e,code:t,encode:r})=>new Vr(e,t,r);class Vr{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Pe(this.code,t):t.then((e=>Pe(this.code,e)))}throw Error("Unknown type, must be binary type")}}const jr=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),zr=$r({name:"sha2-256",code:18,encode:jr("SHA-256")}),qr=$r({name:"sha2-512",code:19,encode:jr("SHA-512")}),Fr={...I,..._,...R,...v,...E,...n,...S,...i,...s,...A};r(49736);const Gr=-1,Hr={},Wr={};function Yr(e){if("number"==typeof e){if(null!=Wr[e])return Wr[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=Hr[e])return Hr[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Gr,"ip6zone"],[43,8,"ipcidr"],[53,Gr,"dns",!0],[54,Gr,"dns4",!0],[55,Gr,"dns6",!0],[56,Gr,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Gr,"unix",!1,!0],[421,Gr,"ipfs"],[421,Gr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Gr,"garlic64"],[448,0,"tls"],[449,Gr,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Gr,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Gr,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);Wr[t.code]=t,Hr[t.name]=t}));Yr("ip4"),Yr("ip6"),Yr("ipcidr");const Qr=Object.values(Fr).map((e=>e.decoder));!function(){let e=Qr[0].or(Qr[1]);Qr.slice(2).forEach((t=>e=e.or(t)))}();Symbol.for("nodejs.util.inspect.custom"),Yr("dns").code,Yr("dns4").code,Yr("dns6").code,Yr("dnsaddr").code,new Map,Symbol.for("@multiformats/js-multiaddr/multiaddr");var Jr=r(1314),Zr=r(62308);const Xr=oe("libp2p:webtransport:stream");async function en(e,t,r,n,i){const s=e.writable.getWriter(),o=e.readable.getReader();function a(){const e=n.findIndex((e=>e===h));-1!==e&&(n.splice(e,1),h.timeline.close=Date.now(),i?.(h))}await s.ready;let c=!1,u=!1;(async function(){const e=await s.closed.catch((e=>e));if(null!=e){const r=e.message;r.includes("aborted by the remote server")||r.includes("STOP_SENDING")||Xr.error(`WebTransport writer closed unexpectedly: streamId=${t} err=${e.message}`)}c=!0,c&&u&&a()})().catch((()=>{Xr.error("WebTransport failed to cleanup closed stream")})),async function(){const e=await o.closed.catch((e=>e));null!=e&&Xr.error(`WebTransport reader closed unexpectedly: streamId=${t} err=${e.message}`),u=!0,c&&u&&a()}().catch((()=>{Xr.error("WebTransport failed to cleanup closed stream")}));let l=!1;const h={id:t,status:"open",writeStatus:"ready",readStatus:"ready",abort(e){c||(s.abort(e).catch((e=>{Xr.error("could not abort stream",e)})),c=!0),u=!0,this.status="aborted",this.writeStatus="closed",this.readStatus="closed",this.timeline.reset=this.timeline.close=this.timeline.closeRead=this.timeline.closeWrite=Date.now(),a()},async close(e){this.status="closing",await Promise.all([h.closeRead(e),h.closeWrite(e)]),a(),this.status="closed",this.timeline.close=Date.now()},async closeRead(e){if(!u){this.readStatus="closing";try{await o.cancel()}catch(e){!0===e.toString().includes("RESET_STREAM")&&(c=!0)}this.timeline.closeRead=Date.now(),this.readStatus="closed",u=!0}c&&a()},async closeWrite(e){if(!c){c=!0,this.writeStatus="closing";try{await s.close()}catch(e){!0===e.toString().includes("RESET_STREAM")&&(u=!0)}this.timeline.closeWrite=Date.now(),this.writeStatus="closed"}u&&a()},direction:r,timeline:{open:Date.now()},metadata:{},source:async function*(){for(;;){const e=await o.read();if(e.done)return u=!0,void(c&&a());yield new Zr.H(e.value)}}(),sink:async function(e){if(l)throw new Error("sink already called on stream");l=!0;try{this.writeStatus="writing";for await(const t of e)if(t instanceof Uint8Array)await s.write(t);else for(const e of t)await s.write(e);this.writeStatus="done"}finally{this.timeline.closeWrite=Date.now(),this.writeStatus="closed",await h.closeWrite()}}};return h}function tn(){return{source:{[Symbol.asyncIterator]:()=>({next:async()=>new Promise((()=>{}))})},sink:async e=>new Promise((()=>{}))}}function rn(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}var nn=r(5681);const sn=Symbol.for("nodejs.util.inspect.custom"),on=Object.values(Fr).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Fr.identity.decoder),an=114,cn=36,un=37;class ln{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[nn.N]=!0;toString(){return null==this.string&&(this.string=ee.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Ne.createV1(an,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return rn(this.multihash.bytes,e);if("string"==typeof e)return pn(e).equals(this);if(null!=e?.multihash?.bytes)return rn(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[sn](){return`PeerId(${this.toString()})`}}class hn extends ln{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class dn extends ln{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class fn extends ln{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function pn(e,t){if(t=t??on,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Ce(ee.decode(`z${e}`));return e.startsWith("12D")?new dn({multihash:t}):e.startsWith("16U")?new fn({multihash:t}):new hn({multihash:t})}return function(e){try{const t=Ce(e);if(t.code===Kr.code){if(t.digest.length===cn)return new dn({multihash:t});if(t.digest.length===un)return new fn({multihash:t})}if(t.code===zr.code)return new hn({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==an)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===zr.code)return new hn({multihash:e.multihash});if(t.code===Kr.code){if(t.digest.length===cn)return new dn({multihash:e.multihash});if(t.digest.length===un)return new fn({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Ne.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(on.decode(e))}const yn=Object.values(Fr).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)));function gn(e){if(!Jr.Mk.matches(e))throw new ae.sv("Invalid multiaddr, was not a WebTransport address","ERR_INVALID_MULTIADDR");const t=e.stringTuples(),r=t.filter((([e,t])=>e===Yr("certhash").code)).map((([e,t])=>{return r=t??"",Ce(yn.decode(r));var r})),n=t.filter((([e,t])=>e===Yr("p2p").code)).map((([e,t])=>pn(t??"")))[0],i=e.toOptions();let s=i.host;return 6===i.family&&s?.includes(":")&&(s=`[${s}]`),{url:`https://${s}:${i.port}`,certhashes:r,remotePeer:n}}const mn=oe("libp2p:webtransport");class bn{components;config;metrics;constructor(e,t={}){this.components=e,this.config={maxInboundStreams:t.maxInboundStreams??1e3},null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webtransport_dialer_events_total",{label:"event",help:"Total count of WebTransport dialer events by type"})})}[Symbol.toStringTag]="@libp2p/webtransport";[D.NA]=!0;async dial(e,t){t?.signal?.throwIfAborted(),mn("dialing %s",e);const r=this.components.peerId;if(void 0===r)throw new Error("Need a local peerid");t=t??{};const{url:n,certhashes:i,remotePeer:s}=gn(e);if(null==s)throw new Error("Need a target peerid");if(0===i.length)throw new Error("Expected multiaddr to contain certhashes");let o,a,c=()=>{},u=!1,l=!1,h=!1;try{this.metrics?.dialerEvents.increment({pending:!0});const d=new WebTransport(`${n}/.well-known/libp2p-webtransport?type=noise`,{serverCertificateHashes:i.map((e=>({algorithm:"sha-256",value:e.digest})))});if(c=e=>{if(!u)try{this.metrics?.dialerEvents.increment({[e]:!0}),d.close()}catch(e){mn.error("error closing wt session",e)}finally{null!=a&&(a.timeline.close=Date.now()),u=!0}},o=()=>{c(l?"noise_timeout":"ready_timeout")},t.signal?.addEventListener("abort",o,{once:!0}),await Promise.race([d.closed,d.ready]),l=!0,this.metrics?.dialerEvents.increment({ready:!0}),d.closed.catch((e=>{mn.error("error on remote wt session close",e)})).finally((()=>{c("remote_close")})),!await this.authenticateWebTransport(d,r,s,i))throw new Error("Failed to authenticate webtransport");return this.metrics?.dialerEvents.increment({open:!0}),a={close:async()=>{mn("Closing webtransport"),c("close")},abort:e=>{mn("aborting webtransport due to passed err",e),c("abort")},remoteAddr:e,timeline:{open:Date.now()},...tn()},h=!0,await t.upgrader.upgradeOutbound(a,{skipEncryption:!0,muxerFactory:this.webtransportMuxer(d),skipProtection:!0})}catch(e){throw mn.error("caught wt session err",e),c(h?"upgrade_error":l?"noise_error":"ready_error"),e}finally{null!=o&&t.signal?.removeEventListener("abort",o)}}async authenticateWebTransport(e,t,r,n){const i=await e.createBidirectionalStream(),s=i.writable.getWriter(),o=i.readable.getReader();await s.ready;const a={source:async function*(){for(;;){const e=await o.read();if(null!=e.value&&(yield e.value),e.done)break}}(),sink:async function(e){for await(const t of e)await s.write(t)}},c=(0,k.t)()(),{remoteExtensions:u}=await c.secureOutbound(t,a,r);if(s.close().catch((e=>{mn.error(`Failed to close authentication stream writer: ${e.message}`)})),o.cancel().catch((e=>{mn.error(`Failed to close authentication stream reader: ${e.message}`)})),l=u?.webtransportCerthashes??[],(h=n.map((e=>e.bytes))).filter((e=>Boolean(l.find((t=>rn(e,t)))))).length!==h.length)throw new Error("Our certhashes are not a subset of the remote's reported certhashes");var l,h;return!0}webtransportMuxer(e){let t=0;const r=this.config;return{protocol:"webtransport",createStreamMuxer:n=>{"function"==typeof n&&(n={onIncomingStream:n});const i=[];(async function(){const s=e.incomingBidirectionalStreams.getReader();for(;;){const{done:e,value:o}=await s.read();if(e)break;if(i.length>=r.maxInboundStreams)o.writable.close().catch((e=>{mn.error(`Failed to close inbound stream that crossed our maxInboundStream limit: ${e.message}`)})),o.readable.cancel().catch((e=>{mn.error(`Failed to close inbound stream that crossed our maxInboundStream limit: ${e.message}`)}));else{const e=await en(o,String(t++),"inbound",i,n?.onStreamEnd);i.push(e),n?.onIncomingStream?.(e)}}})().catch((()=>{mn.error("WebTransport failed to receive incoming stream")}));return{protocol:"webtransport",streams:i,newStream:async r=>{const s=await e.createBidirectionalStream(),o=await en(s,String(t++),n?.direction??"outbound",i,n?.onStreamEnd);return i.push(o),o},close:async e=>{mn("Closing webtransport muxer"),await Promise.all(i.map((async t=>t.close(e))))},abort:e=>{mn("Aborting webtransport muxer with err:",e);for(const t of i)t.abort(e)},...tn()}}}}createListener(e){throw new Error("Webtransport servers are not supported in Node or the browser")}filter(e){return e.filter(Jr.Mk.exactMatch)}}function wn(e={}){return t=>new bn(t,e)}},89546:function(e,t,r){"use strict";r.d(t,{Ue:function(){return $r}});var n=r(51392),i=r(52890),s=r(55101),o=r(33808),a=r(90560),c=r(10993),u=r(84296),l=r(38566),h=r(97098),d=r(38161),f=r(91026),p=r(106),y=r(90072),g=r(69860),m=r(67137),b=r(79221),w=r(63181),v=r(97295);const E=(0,g.kg)("js-kubo-rpc-client:lib:error-handler"),_=b.Z.bind({ignoreUndefined:!0}),A=p.isBrowser||p.isWebWorker?location.protocol:"http",S=p.isBrowser||p.isWebWorker?location.hostname:"localhost",R=p.isBrowser||p.isWebWorker?location.port:"5001",I=async e=>{let t;try{if((e.headers.get("Content-Type")||"").startsWith("application/json")){const r=await e.json();E(r),t=r.Message||r.message}else t=await e.text()}catch(e){E("Failed to parse error response",e),t=e.message}let r=new m.HTTPError(e);throw t&&(t.includes("deadline has elapsed")&&(r=new m.TimeoutError),t&&t.includes("context deadline exceeded")&&(r=new m.TimeoutError)),t&&t.includes("request timed out")&&(r=new m.TimeoutError),t&&(r.message=t),r},x=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,P=e=>e.replace(x,(function(e){return"-"+e.toLowerCase()}));class C extends m{constructor(e={}){const t=((e={})=>{let t,r,n={};if("string"==typeof e||(0,f.h2)(e))t=new URL((0,w.d)(e));else if(e instanceof URL)t=e;else if("string"==typeof e.url||(0,f.h2)(e.url))t=new URL((0,w.d)(e.url)),n=e;else if(e.url instanceof URL)t=e.url,n=e;else{n=e||{};const r=(n.protocol||A).replace(":",""),i=(n.host||S).split(":")[0],s=n.port||R;t=new URL(`${r}://${i}:${s}`)}if(n.apiPath?t.pathname=n.apiPath:"/"!==t.pathname&&void 0!==t.pathname||(t.pathname="api/v0"),p.isNode){const e=(0,v.Z)(t);r=n.agent||new e({keepAlive:!0,maxSockets:6})}return{...n,host:t.host,protocol:t.protocol.replace(":",""),port:Number(t.port),apiPath:t.pathname,url:t,agent:r}})(e);var r;super({timeout:(r=t.timeout||0,("string"==typeof r?(0,y.Z)(r):r)||void 0),headers:t.headers,base:`${t.url}`,handleError:I,transformSearchParams:e=>{const t=new URLSearchParams;for(const[r,n]of e)"undefined"!==n&&"null"!==n&&"signal"!==r&&t.append(P(r),n),"timeout"!==r||isNaN(n)||t.append(P(r),n);return t},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;const n=this.fetch;this.fetch=(e,r={})=>("string"!=typeof e||e.startsWith("/")||(e=`${t.url}/${e}`),n.call(this,e,_(r,{method:"POST"})))}}m.HTTPError;const T=e=>t=>e(new C(t),t);function k(e){if(null!=e)return"string"==typeof e?e:e.toString(8).padStart(4,"0")}var D=r(32114);function O(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const r=e.getTime(),n=Math.floor(r/1e3);t={secs:n,nsecs:1e3*(r-1e3*n)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw D(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}function N({arg:e,searchParams:t,hashAlg:r,mtime:n,mode:i,...s}={}){t&&(s={...s,...t}),r&&(s.hash=r),null!=n&&(n=O(n),s.mtime=n.secs,s.mtimeNsecs=n.nsecs),null!=i&&(s.mode=k(i)),s.timeout&&!isNaN(s.timeout)&&(s.timeout=`${s.timeout}ms`),null==e?e=[]:Array.isArray(e)||(e=[e]);const o=new URLSearchParams(s);return e.forEach((e=>o.append("arg",e))),o}const L=T((e=>async function(t={}){return((await(await e.post("bitswap/wantlist",{signal:t.signal,searchParams:N(t),headers:t.headers})).json()).Keys||[]).map((e=>d.k0.parse(e["/"])))})),U=T((e=>async function(t,r={}){return((await(await e.post("bitswap/wantlist",{signal:r.signal,searchParams:N({...r,peer:t.toString()}),headers:r.headers})).json()).Keys||[]).map((e=>d.k0.parse(e["/"])))}));var M=r(23366);const B=T((e=>async function(t={}){const r=await e.post("bitswap/stat",{searchParams:N(t),signal:t.signal,headers:t.headers});return function(e){return{provideBufLen:e.ProvideBufLen,wantlist:(e.Wantlist||[]).map((e=>d.k0.parse(e["/"]))),peers:(e.Peers||[]).map((e=>(0,M.jE)(e))),blocksReceived:BigInt(e.BlocksReceived),dataReceived:BigInt(e.DataReceived),blocksSent:BigInt(e.BlocksSent),dataSent:BigInt(e.DataSent),dupBlksReceived:BigInt(e.DupBlksReceived),dupDataReceived:BigInt(e.DupDataReceived)}}(await r.json())}));const K=T((e=>async function(t,r={}){const n=await e.post("block/get",{signal:r.signal,searchParams:N({arg:t.toString(),...r}),headers:r.headers});return new Uint8Array(await n.arrayBuffer())}));var $=r(47498),V=r(32044);function j(...e){return(0,V.anySignal)(function(e){return e.filter(Boolean)}(e))}const z=T(((e,t)=>async function t(r,n={}){const i=new AbortController,s=j(i.signal,n.signal);let o;try{const t=await e.post("block/put",{signal:s,searchParams:N(n),...await(0,$.x)([r],i,n.headers)});o=await t.json()}catch(e){if("dag-pb"===n.format)return t(r,{...n,format:"protobuf"});if("dag-cbor"===n.format)return t(r,{...n,format:"cbor"});throw e}return d.k0.parse(o.Key)})),q=T((e=>async function*(t,r={}){Array.isArray(t)||(t=[t]);const n=await e.post("block/rm",{signal:r.signal,searchParams:N({arg:t.map((e=>e.toString())),"stream-channels":!0,...r}),headers:r.headers});for await(const e of n.ndjson())yield F(e)}));function F(e){const t={cid:d.k0.parse(e.Hash)};return e.Error&&(t.error=new Error(e.Error)),t}const G=T((e=>async function(t,r={}){const n=await e.post("block/stat",{signal:r.signal,searchParams:N({arg:t.toString(),...r}),headers:r.headers}),i=await n.json();return{cid:d.k0.parse(i.Key),size:i.Size}}));function H(e){return{get:K(e),put:z(e),rm:q(e),stat:G(e)}}const W=T((e=>async function(t,r={}){const n=await e.post("bootstrap/add",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),{Peers:i}=await n.json();return{Peers:i.map((e=>(0,f.HM)(e)))}})),Y=T((e=>async function(t={}){const r=await e.post("bootstrap/list",{signal:t.signal,searchParams:N(t),headers:t.headers}),{Peers:n}=await r.json();return{Peers:n.map((e=>(0,f.HM)(e)))}})),Q=T((e=>async function(t,r={}){const n=await e.post("bootstrap/rm",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),{Peers:i}=await n.json();return{Peers:i.map((e=>(0,f.HM)(e)))}}));function J(e){return{add:W(e),list:Y(e),rm:Q(e)}}const Z=T((e=>async function(t,r={}){const n=await e.post("config/profile/apply",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),i=await n.json();return{original:i.OldCfg,updated:i.NewCfg}}));function X(e){return{apply:Z(e)}}const ee=T((e=>async(t,r={})=>{if(!t)throw new Error("key argument is required");const n=await e.post("config",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers});return(await n.json()).Value})),te=T((e=>async(t={})=>{const r=await e.post("config/show",{signal:t.signal,searchParams:N({...t}),headers:t.headers});return await r.json()}));var re=r(77408);const ne=T((e=>async(t,r={})=>{const n=new AbortController,i=j(n.signal,r.signal),s=await e.post("config/replace",{signal:i,searchParams:N(r),...await(0,$.x)([(0,re.m)(JSON.stringify(t))],n,r.headers)});await s.text()})),ie=T((e=>async(t,r,n={})=>{if("string"!=typeof t)throw new Error("Invalid key type");const i={...n,...se(t,r)},s=await e.post("config",{signal:n.signal,searchParams:N(i),headers:n.headers});await s.text()})),se=(e,t)=>{switch(typeof t){case"boolean":return{arg:[e,t.toString()],bool:!0};case"string":return{arg:[e,t]};default:return{arg:[e,JSON.stringify(t)],json:!0}}};function oe(e){return{getAll:te(e),get:ee(e),set:ie(e),replace:ne(e),profiles:X(e)}}const ae=T((e=>async function*(t,r={}){const n=await e.post("dag/export",{signal:r.signal,searchParams:N({arg:t.toString()}),headers:r.headers});yield*n.iterator()}));async function*ce(e,t,r,n,i){const s=async e=>{const t=await r.getCodec(e.code),s=await n(e,i);return t.decode(s)},o=t.split("/").filter(Boolean);let a=await s(e),c=e;for(;o.length;){const e=o.shift();if(!e)throw D(new Error(`Could not resolve path "${t}"`),"ERR_INVALID_PATH");if(!Object.prototype.hasOwnProperty.call(a,e))throw D(new Error(`no link named "${e}" under ${c}`),"ERR_NO_LINK");a=a[e],yield{value:a,remainderPath:o.join("/")};const r=d.k0.asCID(a);r&&(c=r,a=await s(a))}yield{value:a,remainderPath:""}}var ue=r(91486),le=r(68883);const he=(e,t)=>{const r=T(((t,r)=>{const n=K(r);return async(t,r={})=>{if(r.path){const i=r.localResolve?await(0,ue.Z)(ce(t,r.path,e,n,r)):await(0,le.Z)(ce(t,r.path,e,n,r));if(!i)throw D(new Error("Not found"),"ERR_NOT_FOUND");return i}const i=await e.getCodec(t.code),s=await n(t,r);return{value:i.decode(s),remainderPath:""}}}));return r(t)},de=T((e=>async function*(t,r={}){const n=new AbortController,i=j(n.signal,r.signal),{headers:s,body:o}=await(0,$.x)(t,n,r.headers),a=await e.post("dag/import",{signal:i,headers:s,body:o,searchParams:N({"pin-roots":r.pinRoots})});for await(const{Root:e}of a.ndjson())if(void 0!==e){const{Cid:{"/":t},PinErrorMsg:r}=e;yield{root:{cid:d.k0.parse(t),pinErrorMsg:r}}}})),fe=(e,t)=>{const r=T((t=>async(r,n={})=>{const i={storeCodec:"dag-cbor",hashAlg:"sha2-256",...n};let s;if(i.inputCodec){if(!(r instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");s=r}else{s=(await e.getCodec(i.storeCodec)).encode(r),i.inputCodec=i.storeCodec}const o=new AbortController,a=j(o.signal,i.signal),c=await t.post("dag/put",{timeout:i.timeout,signal:a,searchParams:N(i),...await(0,$.x)([s],o,i.headers)}),u=await c.json();return d.k0.parse(u.Cid["/"])}));return r(t)},pe=T((e=>async(t,r={})=>{const n=await e.post("dag/resolve",{signal:r.signal,searchParams:N({arg:`${t}${r.path?`/${r.path}`.replace(/\/[/]+/g,"/"):""}`,...r}),headers:r.headers}),i=await n.json();return{cid:d.k0.parse(i.Cid["/"]),remainderPath:i.RemPath}}));function ye(e,t){return{export:ae(t),get:he(e,t),import:de(t),put:fe(e,t),resolve:pe(t)}}const ge=e=>{if(0===e.Type)return{name:"SENDING_QUERY",type:e.Type};if(1===e.Type)return{from:(0,M.jE)(e.ID),name:"PEER_RESPONSE",type:e.Type,messageType:0,messageName:"PUT_VALUE",closer:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:(0,M.jE)(e),multiaddrs:t.map((e=>(0,f.HM)(e))),protocols:[]}))),providers:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:(0,M.jE)(e),multiaddrs:t.map((e=>(0,f.HM)(e))),protocols:[]})))};if(2===e.Type){let t={id:e.ID??(0,M.jE)(e.ID),multiaddrs:[],protocols:[]};return e.Responses&&e.Responses.length&&(t={id:(0,M.jE)(e.Responses[0].ID),multiaddrs:e.Responses[0].Addrs.map((e=>(0,f.HM)(e))),protocols:[]}),{name:"FINAL_PEER",type:e.Type,peer:t}}if(3===e.Type)return{name:"QUERY_ERROR",type:e.Type,error:new Error(e.Extra)};if(4===e.Type)return{name:"PROVIDER",type:e.Type,providers:e.Responses.map((({ID:e,Addrs:t})=>({id:(0,M.jE)(e),multiaddrs:t.map((e=>(0,f.HM)(e))),protocols:[]})))};if(5===e.Type)return{name:"VALUE",type:e.Type,value:(0,re.m)(e.Extra,"base64pad")};if(6===e.Type){const t=e.Responses.map((({ID:e})=>(0,M.jE)(e)));if(!t.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:e.Type,peer:t[0]}}if(7===e.Type)return{name:"DIALING_PEER",type:e.Type,peer:(0,M.jE)(e.ID)};throw new Error("Unknown DHT event type")},me=T((e=>async function*(t,r={}){const n=await e.post("dht/findpeer",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers});for await(const e of n.ndjson())yield ge(e)})),be=T((e=>async function*(t,r={}){const n=await e.post("dht/findprovs",{signal:r.signal,searchParams:N({arg:t.toString(),...r}),headers:r.headers});for await(const e of n.ndjson())yield ge(e)}));var we=r(49784);const ve=T((e=>async function*(t,r={}){const n=await e.post("dht/get",{signal:r.signal,searchParams:N({arg:t instanceof Uint8Array?(0,we.B)(t):t.toString(),...r}),headers:r.headers});for await(const e of n.ndjson())yield ge(e)})),Ee=T((e=>async function*(t,r={recursive:!1}){const n=Array.isArray(t)?t:[t],i=await e.post("dht/provide",{signal:r.signal,searchParams:N({arg:n.map((e=>e.toString())),...r}),headers:r.headers});for await(const e of i.ndjson())yield ge(e)})),_e=T((e=>async function*(t,r,n={}){const i=new AbortController,s=j(i.signal,n.signal),o=await e.post("dht/put",{signal:s,searchParams:N({arg:t instanceof Uint8Array?(0,we.B)(t):t.toString(),...n}),...await(0,$.x)([r],i,n.headers)});for await(const e of o.ndjson())yield ge(e)})),Ae=T((e=>async function*(t,r={}){const n=await e.post("dht/query",{signal:r.signal,searchParams:N({arg:t.toString(),...r}),headers:r.headers});for await(const e of n.ndjson())yield ge(e)}));function Se(e){return{findPeer:me(e),findProvs:be(e),get:ve(e),provide:Ee(e),put:_e(e),query:Ae(e)}}const Re=T((e=>async function(t={}){return(await e.post("diag/cmds",{signal:t.signal,searchParams:N(t),headers:t.headers})).json()})),Ie=T((e=>async function(t={}){return(await e.post("diag/net",{signal:t.signal,searchParams:N(t),headers:t.headers})).json()})),xe=T((e=>async function(t={}){return(await e.post("diag/sys",{signal:t.signal,searchParams:N(t),headers:t.headers})).json()}));function Pe(e){return{cmds:Re(e),net:Ie(e),sys:xe(e)}}const Ce=T((e=>async function(t,r,n={}){const i=Array.isArray(t)?t:[t],s=await e.post("files/cp",{signal:n.signal,searchParams:N({arg:i.concat(r).map((e=>d.k0.asCID(e)?`/ipfs/${e}`:e)),...n}),headers:n.headers});await s.text()})),Te=T((e=>async function(t,r={}){if(!t||"string"!=typeof t)throw new Error("ipfs.files.flush requires a path");const n=await e.post("files/flush",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),i=await n.json();return d.k0.parse(i.Cid)}));function ke(e){if(null==e)return e;const t=/^[A-Z]+$/;return Object.keys(e).reduce(((r,n)=>(t.test(n)?r[n.toLowerCase()]=e[n]:t.test(n[0])?r[n[0].toLowerCase()+n.slice(1)]=e[n]:r[n]=e[n],r)),{})}function De(e){const t=ke(e);return Object.prototype.hasOwnProperty.call(t,"mode")&&(t.mode=parseInt(t.mode,8)),Object.prototype.hasOwnProperty.call(t,"mtime")&&(t.mtime={secs:t.mtime,nsecs:t.mtimeNsecs||0},delete t.mtimeNsecs),t}const Oe=T((e=>async function*(t,r={}){if(!t)throw new Error("ipfs.files.ls requires a path");const n=await e.post("files/ls",{signal:r.signal,searchParams:N({arg:d.k0.asCID(t)?`/ipfs/${t}`:t,long:!0,...r,stream:!0}),headers:r.headers});for await(const e of n.ndjson())if("Entries"in e)for(const t of e.Entries||[])yield Ne(De(t));else yield Ne(De(e))}));function Ne(e){return e.hash&&(e.cid=d.k0.parse(e.hash)),delete e.hash,e.type=1===e.type?"directory":"file",e}const Le=T((e=>async function(t,r={}){const n=await e.post("files/mkdir",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers});await n.text()})),Ue=T((e=>async function(t,r,n={}){Array.isArray(t)||(t=[t]);const i=await e.post("files/mv",{signal:n.signal,searchParams:N({arg:t.concat(r),...n}),headers:n.headers});await i.text()}));var Me=r(50590);const Be=T((e=>async function*(t,r={}){const n=await e.post("files/read",{signal:r.signal,searchParams:N({arg:t,count:r.length,...r}),headers:r.headers});yield*Me(n.body)})),Ke=T((e=>async function(t,r={}){const n=await e.post("files/rm",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),i=await n.text();if(""!==i){const e=new m.HTTPError(n);throw e.message=i,e}})),$e=T((e=>async function(t,r={}){const n=await e.post("files/stat",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),i=await n.json();return i.WithLocality=i.WithLocality||!1,(s=De(i)).cid=d.k0.parse(s.hash),delete s.hash,s;var s}));const Ve=T((e=>async function(t,r,n={}){const i=new AbortController,s=j(i.signal,n.signal),o=await e.post("files/write",{signal:s,searchParams:N({arg:t,streamChannels:!0,count:n.length,...n}),...await(0,$.x)([{content:r,path:"arg",mode:k(n.mode),mtime:O(n.mtime)}],i,n.headers)});await o.text()}));function je(e){return{cp:Ce(e),flush:Te(e),ls:Oe(e),mkdir:Le(e),mv:Ue(e),read:Be(e),rm:Ke(e),stat:$e(e),write:Ve(e)}}const ze=T((e=>async(e,t,r={})=>{throw D(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),qe={type:"ed25519"},Fe=T((e=>async function(t,r=qe){const n=await e.post("key/gen",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers});return ke(await n.json())})),Ge=T((e=>async function(t,r,n,i={}){const s=await e.post("key/import",{signal:i.signal,searchParams:N({arg:t,pem:r,password:n,...i}),headers:i.headers});return ke(await s.json())})),He=T((e=>async function(t={}){const r=await e.post("key/list",{signal:t.signal,searchParams:N(t),headers:t.headers});return((await r.json()).Keys||[]).map((e=>ke(e)))})),We=T((e=>async function(t,r,n={}){const i=await e.post("key/rename",{signal:n.signal,searchParams:N({arg:[t,r],...n}),headers:n.headers});return ke(await i.json())})),Ye=T((e=>async function(t,r={}){const n=await e.post("key/rm",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers});return ke((await n.json()).Keys[0])}));function Qe(e){return{export:ze(e),gen:Fe(e),import:Ge(e),list:He(e),rename:We(e),rm:Ye(e)}}const Je=T((e=>async function(t,r,n={}){const i=await e.post("log/level",{signal:n.signal,searchParams:N({arg:[t,r],...n}),headers:n.headers});return ke(await i.json())})),Ze=T((e=>async function(t={}){const r=await e.post("log/ls",{signal:t.signal,searchParams:N(t),headers:t.headers});return(await r.json()).Strings})),Xe=T((e=>async function*(t={}){const r=await e.post("log/tail",{signal:t.signal,searchParams:N(t),headers:t.headers});yield*r.ndjson()}));function et(e){return{level:Je(e),ls:Ze(e),tail:Xe(e)}}const tt=T((e=>async function(t,r={}){const n=await e.post("name/publish",{signal:r.signal,searchParams:N({arg:`${t}`,...r}),headers:r.headers});return ke(await n.json())})),rt=T((e=>async function*(t,r={}){const n=await e.post("name/resolve",{signal:r.signal,searchParams:N({arg:t,stream:!0,...r}),headers:r.headers});for await(const e of n.ndjson())yield e.Path})),nt=T((e=>async function(t,r={}){const n=await e.post("name/pubsub/cancel",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers});return ke(await n.json())})),it=T((e=>async function(t={}){const r=await e.post("name/pubsub/state",{signal:t.signal,searchParams:N(t),headers:t.headers});return ke(await r.json())})),st=T((e=>async function(t={}){const r=await e.post("name/pubsub/subs",{signal:t.signal,searchParams:N(t),headers:t.headers});return(await r.json()).Strings||[]}));function ot(e){return{cancel:nt(e),state:it(e),subs:st(e)}}function at(e){return{publish:tt(e),resolve:rt(e),pubsub:ot(e)}}const ct=T((e=>async function(t,r={}){const n=await e.post("object/data",{signal:r.signal,searchParams:N({arg:`${t instanceof Uint8Array?d.k0.decode(t):t}`,...r}),headers:r.headers}),i=await n.arrayBuffer();return new Uint8Array(i,0,i.byteLength)})),ut=T((e=>async function(t,r={}){const n=await e.post("object/get",{signal:r.signal,searchParams:N({arg:`${t instanceof Uint8Array?d.k0.decode(t):t}`,dataEncoding:"base64",...r}),headers:r.headers}),i=await n.json();return{Data:(0,re.m)(i.Data,"base64pad"),Links:(i.Links||[]).map((e=>({Name:e.Name,Hash:d.k0.parse(e.Hash),Tsize:e.Size})))}})),lt=T((e=>async function(t,r={}){const n=await e.post("object/links",{signal:r.signal,searchParams:N({arg:`${t instanceof Uint8Array?d.k0.decode(t):t}`,...r}),headers:r.headers});return((await n.json()).Links||[]).map((e=>({Name:e.Name,Tsize:e.Size,Hash:d.k0.parse(e.Hash)})))})),ht=T((e=>async function(t={}){const r=await e.post("object/new",{signal:t.signal,searchParams:N({arg:t.template,...t}),headers:t.headers}),{Hash:n}=await r.json();return d.k0.parse(n)})),dt=(e,t)=>{const r=T((r=>{const n=fe(e,t);return async function(e,t={}){return n(e,{...t,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}}));return r(t)},ft=T((e=>async function(t,r={}){const n=await e.post("object/stat",{signal:r.signal,searchParams:N({arg:`${t}`,...r}),headers:r.headers}),i=await n.json();return{...i,Hash:d.k0.parse(i.Hash)}})),pt=T((e=>async function(t,r,n={}){const i=await e.post("object/patch/add-link",{signal:n.signal,searchParams:N({arg:[`${t}`,r.Name||r.name||"",(r.Hash||r.cid||"").toString()||null],...n}),headers:n.headers}),{Hash:s}=await i.json();return d.k0.parse(s)})),yt=T((e=>async function(t,r,n={}){const i=new AbortController,s=j(i.signal,n.signal),o=await e.post("object/patch/append-data",{signal:s,searchParams:N({arg:`${t}`,...n}),...await(0,$.x)([r],i,n.headers)}),{Hash:a}=await o.json();return d.k0.parse(a)})),gt=T((e=>async function(t,r,n={}){const i=await e.post("object/patch/rm-link",{signal:n.signal,searchParams:N({arg:[`${t}`,r.Name||r.name||null],...n}),headers:n.headers}),{Hash:s}=await i.json();return d.k0.parse(s)})),mt=T((e=>async function(t,r,n={}){const i=new AbortController,s=j(i.signal,n.signal),o=await e.post("object/patch/set-data",{signal:s,searchParams:N({arg:[`${t}`],...n}),...await(0,$.x)([r],i,n.headers)}),{Hash:a}=await o.json();return d.k0.parse(a)}));function bt(e){return{addLink:pt(e),appendData:yt(e),rmLink:gt(e),setData:mt(e)}}function wt(e,t){return{data:ct(t),get:ut(t),links:lt(t),new:ht(t),put:dt(e,t),stat:ft(t),patch:bt(t)}}var vt=r(73297);const Et=T((e=>async function*(t,r={}){for await(const{path:n,recursive:i,metadata:s}of(0,vt.f)(t)){const t=await e.post("pin/add",{signal:r.signal,searchParams:N({...r,arg:n,recursive:i,metadata:s?JSON.stringify(s):void 0,stream:!0}),headers:r.headers});for await(const e of t.ndjson())if(e.Pins)for(const t of e.Pins)yield d.k0.parse(t);else yield d.k0.parse(e)}}));function _t(e){const t=Et(e);return T((()=>async function(e,r={}){return(0,le.Z)(t([{path:e,...r}],r))}))(e)}function At(e,t,r){const n={type:e,cid:d.k0.parse(t)};return r&&(n.metadata=r),n}const St=T((e=>async function*(t={}){let r=[];t.paths&&(r=Array.isArray(t.paths)?t.paths:[t.paths]);const n=await e.post("pin/ls",{signal:t.signal,searchParams:N({...t,arg:r.map((e=>`${e}`)),stream:!0}),headers:t.headers});for await(const e of n.ndjson()){if(e.Keys){for(const t of Object.keys(e.Keys))yield At(e.Keys[t].Type,t,e.Keys[t].Metadata);return}yield At(e.Type,e.Cid,e.Metadata)}})),Rt=T((e=>async function*(t,r={}){for await(const{path:n,recursive:i}of(0,vt.f)(t)){const t=new URLSearchParams(r.searchParams);t.append("arg",`${n}`),null!=i&&t.set("recursive",String(i));const s=await e.post("pin/rm",{signal:r.signal,headers:r.headers,searchParams:N({...r,arg:`${n}`,recursive:i})});for await(const e of s.ndjson())e.Pins?yield*e.Pins.map((e=>d.k0.parse(e))):yield d.k0.parse(e)}})),It=e=>{const t=Rt(e);return T((()=>async function(e,r={}){return(0,le.Z)(t([{path:e,...r}],r))}))(e)},xt=({Name:e,Status:t,Cid:r})=>({cid:d.k0.parse(r),name:e,status:t}),Pt=e=>{if("string"==typeof e&&""!==e)return e;throw new TypeError("service name must be passed")},Ct=e=>{if(d.k0.asCID(e))return e.toString();throw new TypeError("CID instance expected instead of "+typeof e)},Tt=({service:e,cid:t,name:r,status:n,all:i})=>{const s=N({service:Pt(e),name:r,force:!!i||void 0});if(t)for(const e of t)s.append("cid",Ct(e));if(n)for(const e of n)s.append("status",e);return s},kt=({cid:e,service:t,background:r,name:n,origins:i})=>{const s=N({arg:Ct(e),service:Pt(t),name:n,background:!!r||void 0});if(i)for(const e of i)s.append("origin",e.toString());return s};function Dt(e){return async function(t,{timeout:r,signal:n,headers:i,...s}){const o=await e.post("pin/remote/add",{timeout:r,signal:n,headers:i,searchParams:kt({cid:t,...s})});return xt(await o.json())}}function Ot(e){return async function*({timeout:t,signal:r,headers:n,...i}){const s=await e.post("pin/remote/ls",{timeout:t,signal:r,headers:n,searchParams:Tt(i)});for await(const e of s.ndjson())yield xt(e)}}function Nt(e){return async function({timeout:t,signal:r,headers:n,...i}){await e.post("pin/remote/rm",{timeout:t,signal:r,headers:n,searchParams:Tt({...i,all:!1})})}}function Lt(e){return async function({timeout:t,signal:r,headers:n,...i}){await e.post("pin/remote/rm",{timeout:t,signal:r,headers:n,searchParams:Tt({...i,all:!0})})}}function Ut(e){const t=String(e);if("undefined"===t)throw Error("endpoint is required");return"/"===t[t.length-1]?t.slice(0,-1):t}function Mt(e){return{service:e.Service,endpoint:new URL(e.ApiEndpoint),...e.Stat&&{stat:Bt(e.Stat)}}}function Bt(e){switch(e.Status){case"valid":{const{Pinning:t,Pinned:r,Queued:n,Failed:i}=e.PinCount;return{status:"valid",pinCount:{queued:n,pinning:t,pinned:r,failed:i}}}case"invalid":return{status:"invalid"};default:return{status:e.Status}}}function Kt(e){return async function(t,r){const{endpoint:n,key:i,headers:s,timeout:o,signal:a}=r;await e.post("pin/remote/service/add",{timeout:o,signal:a,searchParams:N({arg:[t,Ut(n),i]}),headers:s})}}function $t(e){return async function(t={}){const{stat:r,headers:n,timeout:i,signal:s}=t,o=await e.post("pin/remote/service/ls",{timeout:i,signal:s,headers:n,searchParams:!0===r?N({stat:r}):void 0}),{RemoteServices:a}=await o.json();return a.map(Mt)}}function Vt(e){return async function(t,r={}){await e.post("pin/remote/service/rm",{signal:r.signal,headers:r.headers,searchParams:N({arg:t})})}}function jt(e){const t=new C(e);return{add:Kt(t),ls:$t(t),rm:Vt(t)}}function zt(e){const t=new C(e);return{add:Dt(t),ls:Ot(t),rm:Nt(t),rmAll:Lt(t),service:jt(e)}}function qt(e){return{addAll:Et(e),add:_t(e),ls:St(e),rmAll:Rt(e),rm:It(e),remote:zt(e)}}var Ft=r(99382);const Gt=e=>(0,we.B)(Ht(e)),Ht=e=>Ft.base64url.decode(e),Wt=e=>BigInt(`0x${(0,we.B)(Ft.base64url.decode(e),"base16")}`),Yt=e=>Ft.base64url.encode((0,re.m)(e)),Qt=T((e=>async function(t={}){const{Strings:r}=await(await e.post("pubsub/ls",{signal:t.signal,searchParams:N(t),headers:t.headers})).json();return n=r,(Array.isArray(n)?n.map(Gt):n)||[];var n})),Jt=T((e=>async function(t,r={}){const n=await e.post("pubsub/peers",{signal:r.signal,searchParams:N({arg:Yt(t),...r}),headers:r.headers}),{Strings:i}=await n.json();return i||[]})),Zt=T((e=>async function(t,r,n={}){const i=N({arg:Yt(t),...n}),s=new AbortController,o=j(s.signal,n.signal),a=await e.post("pubsub/pub",{signal:o,searchParams:i,...await(0,$.x)([r],s,n.headers)});await a.text()})),Xt=(0,g.kg)("js-kubo-rpc-client:pubsub:subscribe"),er=(e,t)=>T((e=>async function(r,n,i={}){let s,o;i.signal=t.subscribe(r,n,i.signal);const a=new Promise(((e,t)=>{s=e,o=t})),c=setTimeout((()=>s()),1e3);return e.post("pubsub/sub",{signal:i.signal,searchParams:N({arg:Yt(r),...i}),headers:i.headers}).catch((e=>{t.unsubscribe(r,n),o(e)})).then((e=>{clearTimeout(c),e&&(!async function(e,{onMessage:t,onEnd:r,onError:n}){n=n||Xt;try{for await(const r of e.ndjson())try{if(!r.from)continue;null!=r.from&&null!=r.seqno?t({type:"signed",from:(0,M.jE)(r.from),data:Ht(r.data),sequenceNumber:Wt(r.seqno),topic:Gt(r.topicIDs[0]),key:Ht(r.key??"u"),signature:Ht(r.signature??"u")}):t({type:"unsigned",data:Ht(r.data),topic:Gt(r.topicIDs[0])})}catch(e){e.message=`Failed to parse pubsub message: ${e.message}`,n(e,!1,r)}}catch(e){tr(e)||n(e,!0)}finally{r()}}(e,{onMessage:e=>{n&&("function"!=typeof n?"function"==typeof n.handleEvent&&n.handleEvent(e):n(e))},onEnd:()=>t.unsubscribe(r,n),onError:i.onError}),s())})),a}))(e);const tr=e=>{switch(e.type){case"aborted":case"abort":return!0;default:return"AbortError"===e.name}},rr=(e,t)=>async function(e,r){t.unsubscribe(e,r)};class nr{constructor(){this._subs=new Map}subscribe(e,t,r){const n=this._subs.get(e)||[];if(n.find((e=>e.handler===t)))throw new Error(`Already subscribed to ${e} with this handler`);const i=new AbortController;return this._subs.set(e,[{handler:t,controller:i}].concat(n)),r&&r.addEventListener("abort",(()=>this.unsubscribe(e,t))),i.signal}unsubscribe(e,t){const r=this._subs.get(e)||[];let n;t?(this._subs.set(e,r.filter((e=>e.handler!==t))),n=r.filter((e=>e.handler===t))):(this._subs.set(e,[]),n=r),(this._subs.get(e)||[]).length||this._subs.delete(e),n.forEach((e=>e.controller.abort()))}}function ir(e){const t=new nr;return{ls:Qt(e),peers:Jt(e),publish:Zt(e),subscribe:er(e,t),unsubscribe:rr(e,t)}}const sr=T((e=>async function*(t={}){const r=await e.post("refs/local",{signal:t.signal,transform:ke,searchParams:N(t),headers:t.headers});yield*r.ndjson()})),or=T(((e,t)=>Object.assign((async function*(t,r={}){const n=Array.isArray(t)?t:[t],i=await e.post("refs",{signal:r.signal,searchParams:N({arg:n.map((e=>`${e instanceof Uint8Array?d.k0.decode(e):e}`)),...r}),headers:r.headers,transform:ke});yield*i.ndjson()}),{local:sr(t)}))),ar=T((e=>async function*(t={}){const r=await e.post("repo/gc",{signal:t.signal,searchParams:N(t),headers:t.headers,transform:e=>({err:e.Error?new Error(e.Error):null,cid:(e.Key||{})["/"]?d.k0.parse(e.Key["/"]):null})});yield*r.ndjson()})),cr=T((e=>async function(t={}){const r=await e.post("repo/stat",{signal:t.signal,searchParams:N(t),headers:t.headers}),n=await r.json();return{numObjects:BigInt(n.NumObjects),repoSize:BigInt(n.RepoSize),repoPath:n.RepoPath,version:n.Version,storageMax:BigInt(n.StorageMax)}})),ur=T((e=>async function(t={}){return(await(await e.post("repo/version",{signal:t.signal,searchParams:N(t),headers:t.headers})).json()).Version}));function lr(e){return{gc:ar(e),stat:cr(e),version:ur(e)}}const hr=T((e=>async function*(t={}){const r=await e.post("stats/bw",{signal:t.signal,searchParams:N(t),headers:t.headers,transform:e=>({totalIn:BigInt(e.TotalIn),totalOut:BigInt(e.TotalOut),rateIn:parseFloat(e.RateIn),rateOut:parseFloat(e.RateOut)})});yield*r.ndjson()}));function dr(e){return{bitswap:B(e),repo:cr(e),bw:hr(e)}}const fr=T((e=>async function(t={}){const r=await e.post("swarm/addrs",{signal:t.signal,searchParams:N(t),headers:t.headers}),{Addrs:n}=await r.json();return Object.keys(n).map((e=>({id:(0,M.jE)(e),addrs:(n[e]||[]).map((e=>(0,f.HM)(e)))})))})),pr=T((e=>async function(t,r={}){const n=await e.post("swarm/connect",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),{Strings:i}=await n.json();return i||[]})),yr=T((e=>async function(t,r={}){const n=await e.post("swarm/disconnect",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),{Strings:i}=await n.json();return i||[]})),gr=T((e=>async function(t={}){const r=await e.post("swarm/addrs/local",{signal:t.signal,searchParams:N(t),headers:t.headers}),{Strings:n}=await r.json();return(n||[]).map((e=>(0,f.HM)(e)))})),mr=T((e=>async function(t={}){const r=await e.post("swarm/peers",{signal:t.signal,searchParams:N(t),headers:t.headers}),{Peers:n}=await r.json();return(n||[]).map((e=>({addr:(0,f.HM)(e.Addr),peer:(0,M.jE)(e.Peer),muxer:e.Muxer,latency:e.Latency,streams:e.Streams,direction:null==e.Direction?void 0:0===e.Direction?"inbound":"outbound"})))}));function br(e){return{addrs:fr(e),connect:pr(e),disconnect:yr(e),localAddrs:gr(e),peers:mr(e)}}const wr=T((e=>async function*(t,r={}){const n=new AbortController,i=j(n.signal,r.signal),{headers:s,body:o,total:a,parts:c}=await(0,$.x)(t,n,r.headers),[u,l]="function"==typeof r.progress?vr(a,c,r.progress):[void 0,void 0],h=await e.post("add",{searchParams:N({"stream-channels":!0,...r,progress:Boolean(u)}),onUploadProgress:l,signal:i,headers:s,body:o});for await(let e of h.ndjson())e=ke(e),void 0!==e.hash?yield _r(e):u&&u(e.bytes||0,e.name)})),vr=(e,t,r)=>t?[void 0,Er(e,t,r)]:[r,void 0],Er=(e,t,r)=>{let n=0;const i=t.length;return({loaded:s,total:o})=>{const a=Math.floor(s/o*e);for(;n<i;){const{start:e,end:i,name:s}=t[n];if(a<i){r(a-e,s);break}r(i-e,s),n+=1}}};function _r({name:e,hash:t,size:r,mode:n,mtime:i,mtimeNsecs:s}){const o={path:e,cid:d.k0.parse(t),size:parseInt(r)};return null!=n&&(o.mode=parseInt(n,8)),null!=i&&(o.mtime={secs:i,nsecs:s||0}),o}var Ar=r(56740);function Sr(e){const t=wr(e);return T((()=>async function(e,r={}){const n=(0,Ar.f)(e),i=t(n,r);return await(0,le.Z)(i)}))(e)}const Rr=T((e=>async function*(t,r={}){const n=await e.post("cat",{signal:r.signal,searchParams:N({arg:t.toString(),...r}),headers:r.headers});yield*n.iterator()})),Ir=T((e=>async(t={})=>(await e.post("commands",{signal:t.signal,searchParams:N(t),headers:t.headers})).json())),xr=T((e=>async(t,r={})=>{const n=await e.post("dns",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers});return(await n.json()).Path})),Pr=T((e=>()=>{const t=new URL(e.opts.base||"");return{host:t.hostname,port:t.port,protocol:t.protocol,pathname:t.pathname,"api-path":t.pathname}})),Cr=T((e=>async function*(t,r={}){const n={arg:`${t instanceof Uint8Array?d.k0.decode(t):t}`,...r};n.compressionLevel&&(n["compression-level"]=n.compressionLevel,delete n.compressionLevel);const i=await e.post("get",{signal:r.signal,searchParams:N(n),headers:r.headers});yield*i.iterator()})),Tr=T((e=>async function(t={}){const r=await e.post("id",{signal:t.signal,searchParams:N({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers}),n={...ke(await r.json())};return n.id=(0,M.jE)(n.id),n.addresses&&(n.addresses=n.addresses.map((e=>(0,f.HM)(e)))),n})),kr=e=>{const t=Tr(e);return async function(e={}){const r=await t(e);return Boolean(r&&r.addresses&&r.addresses.length)}},Dr=T(((e,t)=>async function*(r,n={}){const i=`${r instanceof Uint8Array?d.k0.decode(r):r}`;async function s(e){let r=e.Hash;if(r.includes("/")){const e=r.startsWith("/ipfs/")?r:`/ipfs/${r}`;r=(await $e(t)(e)).cid}else r=d.k0.parse(r);const n={name:e.Name,path:i+(e.Name?`/${e.Name}`:""),size:e.Size,cid:r,type:Or(e)};return e.Mode&&(n.mode=parseInt(e.Mode,8)),void 0!==e.Mtime&&null!==e.Mtime&&(n.mtime={secs:e.Mtime},void 0!==e.MtimeNsecs&&null!==e.MtimeNsecs&&(n.mtime.nsecs=e.MtimeNsecs)),n}const o=await e.post("ls",{signal:n.signal,searchParams:N({arg:i,...n}),headers:n.headers});for await(let e of o.ndjson()){if(e=e.Objects,!e)throw new Error("expected .Objects in results");if(e=e[0],!e)throw new Error("expected one array in results.Objects");const t=e.Links;if(!Array.isArray(t))throw new Error("expected one array in results.Objects[0].Links");if(!t.length)return void(yield s(e));yield*t.map(s)}}));function Or(e){switch(e.Type){case 1:case 5:return"dir";default:return"file"}}const Nr=T((e=>async function(t={}){const r=await e.post("dns",{signal:t.signal,searchParams:N(t),headers:t.headers});return ke(await r.json())})),Lr=T((e=>async function*(t,r={}){const n=await e.post("ping",{signal:r.signal,searchParams:N({arg:`${t}`,...r}),headers:r.headers,transform:ke});yield*n.ndjson()})),Ur=T((e=>async function(t,r={}){const n=await e.post("resolve",{signal:r.signal,searchParams:N({arg:t,...r}),headers:r.headers}),{Path:i}=await n.json();return i})),Mr=T((e=>async(e={})=>{throw D(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),Br=T((e=>async function(t={}){const r=await e.post("shutdown",{signal:t.signal,searchParams:N(t),headers:t.headers});await r.text()})),Kr=T((e=>async function(t={}){const r=await e.post("version",{signal:t.signal,searchParams:N(t),headers:t.headers});return{...ke(await r.json()),"ipfs-http-client":"1.0.0"}}));r(85104),r(46953);function $r(e={}){const t={name:l.identity.name,code:l.identity.code,encode:e=>e,decode:e=>e},r=Object.values(h.gh);(e.ipld&&e.ipld.bases?e.ipld.bases:[]).forEach((e=>r.push(e)));const d=new n.x({bases:r,loadBase:e.ipld&&e.ipld.loadBase}),f=Object.values(h.QB);[o,a,c,u,t].concat(e.ipld&&e.ipld.codecs||[]).forEach((e=>f.push(e)));const p=new i.w({codecs:f,loadCodec:e.ipld&&e.ipld.loadCodec}),y=Object.values(h.kq);(e.ipld&&e.ipld.hashers?e.ipld.hashers:[]).forEach((e=>y.push(e)));const g=new s.d({hashers:y,loadHasher:e.ipld&&e.ipld.loadHasher});var m;return{add:Sr(e),addAll:wr(e),bitswap:(m=e,{wantlist:L(m),wantlistForPeer:U(m),stat:B(m)}),block:H(e),bootstrap:J(e),cat:Rr(e),commands:Ir(e),config:oe(e),dag:ye(p,e),dht:Se(e),diag:Pe(e),dns:xr(e),files:je(e),get:Cr(e),getEndpointConfig:Pr(e),id:Tr(e),isOnline:kr(e),key:Qe(e),log:et(e),ls:Dr(e),mount:Nr(e),name:at(e),object:wt(p,e),pin:qt(e),ping:Lr(e),pubsub:ir(e),refs:or(e),repo:lr(e),resolve:Ur(e),start:Mr(e),stats:dr(e),stop:Br(e),swarm:br(e),version:Kr(e),bases:d,codecs:p,hashers:g}}},76805:function(e,t,r){"use strict";r.d(t,{D:function(){return v}});var n=r(17187),i=r(49541),s=r(38699),o=r(34042),a=r(74803),c=r(59850),u=r(31650),l=r(9202),h=r(34880),d=r(69849),f=r(32629),p=r(53749),y=r(64188);var g,m=r(46888);!function(e){let t,r,n,i,s,o,a,c;!function(e){e.DIAL="DIAL",e.DIAL_RESPONSE="DIAL_RESPONSE"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.DIAL=0]="DIAL",e[e.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(r||(r={})),function(e){e.codec=()=>(0,m.Ji)(r)}(t=e.MessageType||(e.MessageType={})),function(e){e.OK="OK",e.E_DIAL_ERROR="E_DIAL_ERROR",e.E_DIAL_REFUSED="E_DIAL_REFUSED",e.E_BAD_REQUEST="E_BAD_REQUEST",e.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(n=e.ResponseStatus||(e.ResponseStatus={})),function(e){e[e.OK=0]="OK",e[e.E_DIAL_ERROR=100]="E_DIAL_ERROR",e[e.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",e[e.E_BAD_REQUEST=200]="E_BAD_REQUEST",e[e.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(i||(i={})),function(e){e.codec=()=>(0,m.Ji)(i)}(n=e.ResponseStatus||(e.ResponseStatus={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,m.yw)(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={addrs:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,m.LE)(t,e.codec()),e.decode=t=>(0,m.C6)(t,e.codec())}(s=e.PeerInfo||(e.PeerInfo={})),function(t){let r;t.codec=()=>(null==r&&(r=(0,m.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.peer&&(r.uint32(10),e.PeerInfo.codec().encode(t.peer,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();if(r>>>3==1)n.peer=e.PeerInfo.codec().decode(t,t.uint32());else t.skipType(7&r)}return n}))),r),t.encode=e=>(0,m.LE)(e,t.codec()),t.decode=e=>(0,m.C6)(e,t.codec())}(o=e.Dial||(e.Dial={})),function(t){let r;t.codec=()=>(null==r&&(r=(0,m.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.status&&(r.uint32(8),e.ResponseStatus.codec().encode(t.status,r)),null!=t.statusText&&(r.uint32(18),r.string(t.statusText)),null!=t.addr&&(r.uint32(26),r.bytes(t.addr)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.status=e.ResponseStatus.codec().decode(t);break;case 2:n.statusText=t.string();break;case 3:n.addr=t.bytes();break;default:t.skipType(7&r)}}return n}))),r),t.encode=e=>(0,m.LE)(e,t.codec()),t.decode=e=>(0,m.C6)(e,t.codec())}(a=e.DialResponse||(e.DialResponse={})),e.codec=()=>(null==c&&(c=(0,m.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.MessageType.codec().encode(t.type,r)),null!=t.dial&&(r.uint32(18),e.Dial.codec().encode(t.dial,r)),null!=t.dialResponse&&(r.uint32(26),e.DialResponse.codec().encode(t.dialResponse,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.MessageType.codec().decode(t);break;case 2:n.dial=e.Dial.codec().decode(t,t.uint32());break;case 3:n.dialResponse=e.DialResponse.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n}))),c),e.encode=t=>(0,m.LE)(t,e.codec()),e.decode=t=>(0,m.C6)(t,e.codec())}(g||(g={}));const b=(0,s.kg)("libp2p:autonat");class w{components;startupDelay;refreshInterval;protocol;timeout;maxInboundStreams;maxOutboundStreams;verifyAddressTimeout;started;constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix??"libp2p"}/autonat/1.0.0`,this.timeout=t.timeout??3e4,this.maxInboundStreams=t.maxInboundStreams??1,this.maxOutboundStreams=t.maxOutboundStreams??1,this.startupDelay=t.startupDelay??5e3,this.refreshInterval=t.refreshInterval??6e4,this._verifyExternalAddresses=this._verifyExternalAddresses.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,(e=>{this.handleIncomingAutonatStream(e).catch((e=>{b.error("error handling incoming autonat stream",e)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.startupDelay),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),clearTimeout(this.verifyAddressTimeout),this.started=!1}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),r=()=>{e.stream.abort(new i.sv("handleIncomingAutonatStream timeout",y.q.ERR_TIMEOUT))};t.addEventListener("abort",r,{once:!0});try{(0,n.setMaxListeners)?.(1/0,t)}catch{}const s=this.components.addressManager.getAddresses().map((e=>e.toOptions().host));try{const r=this;await(0,f.z)(e.stream,(e=>l.J(e)),(async function*(n){const i=await(0,u.Z)(n);if(null==i)return b("no message received"),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_BAD_REQUEST,statusText:"No message was sent"}}));let a;try{a=g.decode(i)}catch(e){return b.error("could not decode message",e),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_BAD_REQUEST,statusText:"Could not decode message"}}))}const l=a.dial;if(null==l)return b.error("dial was missing from message"),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}}));let h;const d=l.peer;if(null==d||null==d.id)return b.error("PeerId missing from message"),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}}));try{h=(0,o.cv)(d.id)}catch(e){return b.error("invalid PeerId",e),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}))}if(b("incoming request from %p",h),!e.connection.remotePeer.equals(h))return b("target peer %p did not equal sending peer %p",h,e.connection.remotePeer),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}}));const f=d.addrs.map((e=>(0,c.HM)(e))).filter((t=>{const r=t.toOptions().host===e.connection.remoteAddr.toOptions().host;return b.trace("request to dial %a was sent from %a is same host %s",t,e.connection.remoteAddr,r),r})).filter((e=>{const t=e.toOptions().host,r=!(0,p.Z)(t);return b.trace("host %s was public %s",t,r),r})).filter((e=>{const t=e.toOptions().host,r=!s.includes(t);return b.trace("host %s was not our host %s",t,r),r})).filter((e=>{const t=Boolean(r.components.transportManager.transportForMultiaddr(e));return b.trace("transport for %a is supported %s",e,t),t})).map((e=>(null==e.getPeerId()&&(e=e.encapsulate(`/p2p/${h.toString()}`)),e)));if(0===f.length)return b("no valid multiaddrs for %p in message",h),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}}));b("dial multiaddrs %s for peer %p",f.map((e=>e.toString())).join(", "),h);let y="",m=f[0];for await(const e of f){let n;m=e;try{if(n=await r.components.connectionManager.openConnection(e,{signal:t}),!n.remoteAddr.equals(e))throw b.error("tried to dial %a but dialed %a",e,n.remoteAddr),new Error("Unexpected remote address");return b("Success %p",h),void(yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.OK,addr:n.remoteAddr.decapsulateCode((0,c.a_)("p2p").code).bytes}}))}catch(e){b("could not dial %p",h,e),y=e.message}finally{null!=n&&await n.close()}}yield g.encode({type:g.MessageType.DIAL_RESPONSE,dialResponse:{status:g.ResponseStatus.E_DIAL_ERROR,statusText:y,addr:m.bytes}})}),(e=>l.c(e)),e.stream)}catch(e){b.error("error handling incoming autonat stream",e)}finally{t.removeEventListener("abort",r)}}_verifyExternalAddresses(){this.verifyExternalAddresses().catch((e=>{b.error("error verifying external address",e)}))}async verifyExternalAddresses(){if(clearTimeout(this.verifyAddressTimeout),!this.isStarted())return;const e=this.components.addressManager,t=e.getObservedAddrs().filter((e=>{const t=e.toOptions();return!(0,p.Z)(t.host)}));if(0===t.length)return b("no public addresses found, not requesting verification"),void(this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval));const r=AbortSignal.timeout(this.timeout);try{(0,n.setMaxListeners)?.(1/0,r)}catch{}const s=this;try{b("verify multiaddrs %s",t.map((e=>e.toString())).join(", "));const n=g.encode({type:g.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toBytes(),addrs:t.map((e=>e.bytes))}}}),o=(await(0,a.n9)()).toBytes(),p={},m=[],w=async e=>{let t=()=>{};try{b("asking %p to verify multiaddr",e.id);const o=await s.components.connectionManager.openConnection(e.id,{signal:r}),a=await o.newStream(this.protocol,{signal:r});t=()=>{a.abort(new i.sv("verifyAddress timeout",y.q.ERR_TIMEOUT))},r.addEventListener("abort",t,{once:!0});const c=await(0,f.z)([n],(e=>l.c(e)),a,(e=>l.J(e)),(async e=>(0,u.Z)(e)));if(null==c)return void b("no response received from %p",o.remotePeer);const h=g.decode(c);if(h.type!==g.MessageType.DIAL_RESPONSE||null==h.dialResponse)return void b("invalid autonat response from %p",o.remotePeer);if(h.dialResponse.status===g.ResponseStatus.OK){const e=o.remoteAddr.toOptions();let t;if(4===e.family){t=e.host.split(".")[0]}else{if(6!==e.family)return void b('remote address "%s" was not IP4 or IP6?',e.host);t=e.host.split(":")[0]}if(m.includes(t))return void b("already have response from network segment %d - %s",t,e.host);m.push(t)}return h.dialResponse}catch(e){b.error("error asking remote to verify multiaddr",e)}finally{r.removeEventListener("abort",t)}};for await(const n of(0,d.Z)((0,h.Z)(this.components.peerRouting.getClosestPeers(o,{signal:r}),(e=>async()=>w(e))),{concurrency:4}))try{if(null==n)continue;const r=null==n.addr?t[0]:(0,c.HM)(n.addr);if(b("autonat response for %a is %s",r,n.status),n.status===g.ResponseStatus.E_BAD_REQUEST)continue;if(n.status===g.ResponseStatus.E_DIAL_REFUSED)continue;if(null==n.addr&&t.length>1)continue;if(!t.some((e=>e.equals(r)))){b("peer reported %a as %s but it was not in our observed address list",r,n.status);continue}const i=r.toString();if(null==p[i]&&(p[i]={success:0,failure:0}),n.status===g.ResponseStatus.OK?p[i].success++:n.status===g.ResponseStatus.E_DIAL_ERROR&&p[i].failure++,4===p[i].success)return b("%a is externally dialable",r),void e.confirmObservedAddr(r);if(4===p[i].failure)return b("%a is not externally dialable",r),void e.removeObservedAddr(r)}catch(e){b.error("could not verify external address",e)}}finally{this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval)}}}function v(e={}){return t=>new w(t,e)}},69850:function(e,t,r){"use strict";r.d(t,{f:function(){return j}});r(17187);var n=r(23247),i=r(38699),s=r(34042),o=(r(3046),r(59850)),a=r(41455),c=r(12229);BigInt(1<<17);const u="/libp2p/circuit/relay/0.2.0/hop",l="/libp2p/circuit/relay/0.2.0/stop";var h,d,f,p,y,g,m,b,w=r(46888);!function(e){let t,r,n;!function(e){e.RESERVE="RESERVE",e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.RESERVE=0]="RESERVE",e[e.CONNECT=1]="CONNECT",e[e.STATUS=2]="STATUS"}(r||(r={})),function(e){e.codec=()=>(0,w.Ji)(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=(0,w.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),f.codec().encode(t.peer,r)),null!=t.reservation&&(r.uint32(26),p.codec().encode(t.reservation,r)),null!=t.limit&&(r.uint32(34),y.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(40),g.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.Type.codec().decode(t);break;case 2:n.peer=f.codec().decode(t,t.uint32());break;case 3:n.reservation=p.codec().decode(t,t.uint32());break;case 4:n.limit=y.codec().decode(t,t.uint32());break;case 5:n.status=g.codec().decode(t);break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,w.LE)(t,e.codec()),e.decode=t=>(0,w.C6)(t,e.codec())}(h||(h={})),function(e){let t,r,n;!function(e){e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.CONNECT=0]="CONNECT",e[e.STATUS=1]="STATUS"}(r||(r={})),function(e){e.codec=()=>(0,w.Ji)(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=(0,w.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.peer&&(r.uint32(18),f.codec().encode(t.peer,r)),null!=t.limit&&(r.uint32(26),y.codec().encode(t.limit,r)),null!=t.status&&(r.uint32(32),g.codec().encode(t.status,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.Type.codec().decode(t);break;case 2:n.peer=f.codec().decode(t,t.uint32());break;case 3:n.limit=y.codec().decode(t,t.uint32());break;case 4:n.status=g.codec().decode(t);break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,w.LE)(t,e.codec()),e.decode=t=>(0,w.C6)(t,e.codec())}(d||(d={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,w.yw)(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={id:new Uint8Array(0),addrs:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,w.LE)(t,e.codec()),e.decode=t=>(0,w.C6)(t,e.codec())}(f||(f={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,w.yw)(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.expire&&0n!==e.expire&&(t.uint32(8),t.uint64(e.expire)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);null!=e.voucher&&(t.uint32(26),t.bytes(e.voucher)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={expire:0n,addrs:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.expire=e.uint64();break;case 2:r.addrs.push(e.bytes());break;case 3:r.voucher=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,w.LE)(t,e.codec()),e.decode=t=>(0,w.C6)(t,e.codec())}(p||(p={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,w.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.duration&&(t.uint32(8),t.uint32(e.duration)),null!=e.data&&(t.uint32(16),t.uint64(e.data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.duration=e.uint32();break;case 2:r.data=e.uint64();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,w.LE)(t,e.codec()),e.decode=t=>(0,w.C6)(t,e.codec())}(y||(y={})),function(e){e.UNUSED="UNUSED",e.OK="OK",e.RESERVATION_REFUSED="RESERVATION_REFUSED",e.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONNECTION_FAILED="CONNECTION_FAILED",e.NO_RESERVATION="NO_RESERVATION",e.MALFORMED_MESSAGE="MALFORMED_MESSAGE",e.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"}(g||(g={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.OK=100]="OK",e[e.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",e[e.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",e[e.PERMISSION_DENIED=202]="PERMISSION_DENIED",e[e.CONNECTION_FAILED=203]="CONNECTION_FAILED",e[e.NO_RESERVATION=204]="NO_RESERVATION",e[e.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",e[e.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"}(m||(m={})),function(e){e.codec=()=>(0,w.Ji)(m)}(g||(g={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,w.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.relay&&e.relay.byteLength>0&&(t.uint32(10),t.bytes(e.relay)),null!=e.peer&&e.peer.byteLength>0&&(t.uint32(18),t.bytes(e.peer)),null!=e.expiration&&0n!==e.expiration&&(t.uint32(24),t.uint64(e.expiration)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={relay:new Uint8Array(0),peer:new Uint8Array(0),expiration:0n},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.relay=e.bytes();break;case 2:r.peer=e.bytes();break;case 3:r.expiration=e.uint64();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,w.LE)(t,e.codec()),e.decode=t=>(0,w.C6)(t,e.codec())}(b||(b={}));var v=r(49541),E=r(25674),_=r(59425),A=r(64188);(0,i.kg)("libp2p:circuit-relay:utils");async function S(e){const t=(new TextEncoder).encode(e),r=await _.sha256.digest(t);return E.k0.createV0(r)}function R(e){const t=e*BigInt(1e3),r=(new Date).getTime();return Number(t-BigInt(r))}r(99353),r(4250);class I extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}(0,i.kg)("libp2p:circuit-relay:advert-service");var x=r(25975);(0,i.kg)("libp2p:circuit-relay:server"),c.aX;var P=r(55265);const C=(0,i.kg)("libp2p:stream:converter");function T(e){const{stream:t,remoteAddr:r}=e,{sink:n,source:i}=t,s={async sink(e){try{await n(e),o()}catch(e){"aborted"!==e.type&&C(e)}},source:async function*(){for await(const e of i)e instanceof Uint8Array?yield e:yield*e}(),remoteAddr:r,timeline:{open:Date.now(),close:void 0},async close(e){o(),await t.close(e)},abort(e){o(),t.abort(e)}};function o(){null==s.timeline.close&&(s.timeline.close=Date.now())}return s}var k=r(61093);const D=(0,i.kg)("libp2p:circuit-relay:discover-relays");class O extends n.v{peerId;peerStore;contentRouting;registrar;started;topologyId;constructor(e){super(),this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.contentRouting=e.contentRouting,this.registrar=e.registrar}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(u,{onConnect:e=>{this.safeDispatchEvent("relay:discover",{detail:e})}}),this.discover().catch((e=>{D.error("error listening on relays",e)})),this.started=!0}stop(){null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async discover(){D("searching peer store for relays");const e=await this.peerStore.all({filters:[e=>e.protocols.includes(u)],orders:[()=>Math.random()<.5?1:-1]});for(const t of e)D("found relay peer %p in content peer store",t.id),this.safeDispatchEvent("relay:discover",{detail:t.id});D("found %d relay peers in peer store",e.length);try{D("searching content routing for relays");const e=await S("/libp2p/relay");let t=0;for await(const r of this.contentRouting.findProviders(e))if(r.multiaddrs.length>0&&!r.id.equals(this.peerId)){const e=r.id;t++,await this.peerStore.merge(e,{multiaddrs:r.multiaddrs}),D("found relay peer %p in content routing",e),this.safeDispatchEvent("relay:discover",{detail:e})}D("found %d relay peers in content routing",t)}catch(e){D.error("failed when finding relays on the network",e)}}}const N=(0,i.kg)("libp2p:circuit-relay:transport:listener");class L extends n.v{connectionManager;relayStore;listeningAddrs;constructor(e){super(),this.connectionManager=e.connectionManager,this.relayStore=e.relayStore,this.listeningAddrs=new x.ji,this.relayStore.addEventListener("relay:removed",(e=>{this.#s(e.detail)}))}async listen(e){N("listen on %a",e);const t=e.getPeerId();let r;if(null!=t){const e=(0,s.jE)(t),n=this.connectionManager.getConnectionsMap().get(e)??[];n.length>0&&(r=n[0])}if(null==r){const t=e.toString().split("/p2p-circuit").find((e=>""!==e)),n=(0,o.HM)(t);r=await this.connectionManager.openConnection(n)}if(!this.relayStore.hasReservation(r.remotePeer))return void await this.relayStore.addRelay(r.remotePeer,"configured");const n=this.relayStore.getReservation(r.remotePeer);if(null==n)throw new v.sv("Did not have reservation after making reservation","ERR_NO_RESERVATION");this.listeningAddrs.has(r.remotePeer)?N("already listening on relay %p",r.remotePeer):(this.listeningAddrs.set(r.remotePeer,n.addrs.map((e=>(0,o.HM)(e).encapsulate("/p2p-circuit")))),this.safeDispatchEvent("listening",{}))}getAddrs(){return[...this.listeningAddrs.values()].flat()}async close(){}#s(e){const t=this.listeningAddrs.has(e);N("relay peer removed %p - had reservation",e,t),this.listeningAddrs.delete(e),t&&this.safeDispatchEvent("close",{})}}var U=r(95554);const M=(0,i.kg)("libp2p:circuit-relay:transport:reservation-store");class B extends n.v{peerId;connectionManager;transportManager;peerStore;events;reserveQueue;reservations;maxDiscoveredRelays;maxReservationQueueLength;reservationCompletionTimeout;started;constructor(e,t){super(),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new x.ji,this.maxDiscoveredRelays=t?.discoverRelays??0,this.maxReservationQueueLength=t?.maxReservationQueueLength??100,this.reservationCompletionTimeout=t?.reservationCompletionTimeout??1e4,this.started=!1,this.reserveQueue=new U.m({concurrency:t?.reservationConcurrency??1}),this.events.addEventListener("peer:disconnect",(e=>{this.#o(e.detail)}))}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.reserveQueue.clear(),this.reservations.forEach((({timeout:e})=>{clearTimeout(e)})),this.reservations.clear(),this.started=!1}async addRelay(e,t){this.peerId.equals(e)?M("not trying to use self as relay"):this.reserveQueue.size>this.maxReservationQueueLength?M("not adding relay as the queue is full"):this.reserveQueue.hasJob(e)?M("relay peer is already in the reservation queue"):(M("add relay %p",e),await this.reserveQueue.add((async()=>{try{const r=this.reservations.get(e);if(null!=r){if(R(r.reservation.expire)>6e5)return void M("already have reservation on relay peer %p and it expires in more than 10 minutes",e);clearTimeout(r.timeout),this.reservations.delete(e)}if("discovered"===t&&[...this.reservations.values()].reduce(((e,t)=>("discovered"===t.type&&e++,e)),0)>=this.maxDiscoveredRelays)return void M("already have enough discovered relays");const n=AbortSignal.timeout(this.reservationCompletionTimeout),i=await this.connectionManager.openConnection(e,{signal:n});if(i.remoteAddr.protoNames().includes("p2p-circuit"))return void M("not creating reservation over relayed connection");const s=await this.#a(i,{signal:n});M("created reservation on relay peer %p",e);const a=R(s.expire),c=Math.min(Math.max(a-3e5,3e4),Math.pow(2,31)-1),u=setTimeout((()=>{this.addRelay(e,t).catch((t=>{M.error("could not refresh reservation to relay %p",e,t)}))}),c);this.reservations.set(e,{timeout:u,reservation:s,type:t}),await this.peerStore.merge(e,{tags:{"circuit-relay-relay":{value:1,ttl:a}}}),await this.transportManager.listen([(0,o.HM)(`/p2p/${e.toString()}/p2p-circuit`)])}catch(t){M.error("could not reserve slot on %p",e,t);const r=this.reservations.get(e);null!=r&&clearTimeout(r.timeout),this.reservations.delete(e)}}),{peerId:e}))}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}async#a(e,t){t.signal?.throwIfAborted(),M("requesting reservation from %p",e.remotePeer);const r=await e.newStream(u,t),n=(0,a.z)(r).pb(h);let i;await n.write({type:h.Type.RESERVE},t);try{i=await n.read(t)}catch(t){throw M.error("error parsing reserve message response from %p because",e.remotePeer,t),t}finally{await r.close()}if(i.status===g.OK&&null!=i.reservation)return i.reservation;const s=`reservation failed with status ${i.status??"undefined"}`;throw M.error(s),new Error(s)}#o(e){const t=this.reservations.get(e);null!=t&&(M("connection to relay %p closed, removing reservation from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),this.safeDispatchEvent("relay:removed",{detail:e}),this.reservations.size<this.maxDiscoveredRelays&&(M("not enough relays %d/%d",this.reservations.size,this.maxDiscoveredRelays),this.safeDispatchEvent("relay:not-enough-relays",{})))}}const K=(0,i.kg)("libp2p:circuit-relay:transport"),$={maxInboundStopStreams:c.aX,maxOutboundStopStreams:c.aX,stopTimeout:3e4};class V{discovery;registrar;peerStore;connectionManager;peerId;upgrader;addressManager;connectionGater;reservationStore;maxInboundStopStreams;maxOutboundStopStreams;stopTimeout;started;constructor(e,t){this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??$.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??$.maxOutboundStopStreams,this.stopTimeout=t.stopTimeout??$.stopTimeout,null!=t.discoverRelays&&t.discoverRelays>0&&(this.discovery=new O(e),this.discovery.addEventListener("relay:discover",(e=>{this.reservationStore.addRelay(e.detail,"discovered").catch((t=>{K.error("could not add discovered relay %p",e.detail,t)}))}))),this.reservationStore=new B(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",(()=>{this.discovery?.discover().catch((e=>{K.error("could not discover relays",e)}))})),this.started=!1}isStarted(){return this.started}async start(){await this.reservationStore.start(),await(this.discovery?.start()),await this.registrar.handle(l,(e=>{this.onStop(e).catch((t=>{K.error("error while handling STOP protocol",t),e.stream.abort(t)}))}),{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnTransientConnection:!0}),this.started=!0}async stop(){this.discovery?.stop(),await this.reservationStore.stop(),await this.registrar.unhandle(l),this.started=!1}[P.NA]=!0;[Symbol.toStringTag]="libp2p/circuit-relay-v2";async dial(e,t={}){if(1!==e.protoCodes().filter((e=>290===e)).length){const t="Invalid circuit relay address";throw K.error(t,e),new v.sv(t,A.q.ERR_RELAYED_DIAL)}const r=e.toString().split("/p2p-circuit"),n=(0,o.HM)(r[0]),i=(0,o.HM)(r[r.length-1]),a=n.getPeerId(),c=i.getPeerId();if(null==a||null==c){const t=`Circuit relay dial to ${e.toString()} failed as address did not have peer ids`;throw K.error(t),new v.sv(t,A.q.ERR_RELAYED_DIAL)}const l=(0,s.jE)(a),h=(0,s.jE)(c);let d=!1;let f,p=this.connectionManager.getConnections(l)[0];null==p&&(await this.peerStore.merge(l,{multiaddrs:[n]}),p=await this.connectionManager.openConnection(l,t),d=!0);try{return f=await p.newStream([u]),await this.connectV2({stream:f,connection:p,destinationPeer:h,destinationAddr:i,relayAddr:n,ma:e,disconnectOnFailure:d})}catch(e){throw K.error("circuit relay dial to destination %p via relay %p failed",h,l,e),null!=f&&f.abort(e),d&&await p.close(),e}}async connectV2({stream:e,connection:t,destinationPeer:r,destinationAddr:n,relayAddr:i,ma:s,disconnectOnFailure:c}){try{const t=(0,a.z)(e),c=t.pb(h);await c.write({type:h.Type.CONNECT,peer:{id:r.toBytes(),addrs:[(0,o.HM)(n).bytes]}});const u=await c.read();if(u.status!==g.OK)throw new v.sv(`failed to connect via relay with status ${u?.status?.toString()??"undefined"}`,A.q.ERR_HOP_REQUEST_FAILED);const l=T({stream:t.unwrap(),remoteAddr:s,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`)});return K("new outbound transient connection %a",l.remoteAddr),await this.upgrader.upgradeOutbound(l,{transient:!0})}catch(e){throw K.error(`Circuit relay dial to destination ${r.toString()} via relay ${t.remotePeer.toString()} failed`,e),c&&await t.close(),e}}createListener(e){return function(e){return new L(e)}({connectionManager:this.connectionManager,relayStore:this.reservationStore})}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>k.dx.matches(e)))}async onStop({connection:e,stream:t}){const r=AbortSignal.timeout(this.stopTimeout),n=(0,a.z)(t).pb(d),i=await n.read({signal:r});if(K("new circuit relay v2 stop stream from %p with type %s",e.remotePeer,i.type),void 0===i?.type)return K.error("type was missing from circuit v2 stop protocol request from %s",e.remotePeer),await n.write({type:d.Type.STATUS,status:g.MALFORMED_MESSAGE},{signal:r}),void await t.close();if(i.type!==d.Type.CONNECT)return K.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:d.Type.STATUS,status:g.UNEXPECTED_MESSAGE},{signal:r}),void await t.close();if(!(e=>{if(null==e.peer)return!1;try{e.peer.addrs.forEach(o.HM)}catch{return!1}return!0})(i))return K.error("invalid stop connect request via peer %p",e.remotePeer),await n.write({type:d.Type.STATUS,status:g.MALFORMED_MESSAGE},{signal:r}),void await t.close();const c=(0,s.cv)(i.peer.id);if(!0===await(this.connectionGater.denyInboundRelayedConnection?.(e.remotePeer,c)))return K.error("connection gater denied inbound relayed connection from %p",e.remotePeer),await n.write({type:d.Type.STATUS,status:g.PERMISSION_DENIED},{signal:r}),void await t.close();K.trace("sending success response to %p",e.remotePeer),await n.write({type:d.Type.STATUS,status:g.OK},{signal:r});const u=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${c.toString()}`),l=this.addressManager.getAddresses()[0],h=T({stream:n.unwrap().unwrap(),remoteAddr:u,localAddr:l});K("new inbound transient connection %a",h.remoteAddr),await this.upgrader.upgradeInbound(h,{transient:!0}),K("%s connection %a upgraded","inbound",h.remoteAddr)}}function j(e={}){return t=>new V(t,e)}},12229:function(e,t,r){"use strict";r.d(t,{Oq:function(){return o},Ui:function(){return s},aX:function(){return i},iA:function(){return n}});const n=5,i=100,s=50,o=42e4},90704:function(e,t,r){"use strict";r.d(t,{P:function(){return A},O:function(){return _}});var n=r(49541),i=r(38699),s=r(59850),o=r(1314);const a=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},c=new WeakMap;const u=function({clearTimeout:e,setTimeout:t}={}){return(r,{value:n,signal:i}={})=>{if(i?.aborted)return Promise.reject(a());let s,o,u;const l=e??clearTimeout,h=()=>{l(s),u(a())},d=new Promise(((e,a)=>{o=()=>{i&&i.removeEventListener("abort",h),e(n)},u=a,s=(t??setTimeout)(o,r)}));return i&&i.addEventListener("abort",h,{once:!0}),c.set(d,(()=>{l(s),s=null,o()})),d}}();var l=u;var h,d=r(41455),f=r(53749),p=r(64188),y=r(46888);!function(e){let t,r,n;!function(e){e.UNUSED="UNUSED",e.CONNECT="CONNECT",e.SYNC="SYNC"}(t=e.Type||(e.Type={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.CONNECT=100]="CONNECT",e[e.SYNC=300]="SYNC"}(r||(r={})),function(e){e.codec=()=>(0,y.Ji)(r)}(t=e.Type||(e.Type={})),e.codec=()=>(null==n&&(n=(0,y.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.type&&(r.uint32(8),e.Type.codec().encode(t.type,r)),null!=t.observedAddresses)for(const e of t.observedAddresses)r.uint32(18),r.bytes(e);!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={observedAddresses:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.type=e.Type.codec().decode(t);break;case 2:n.observedAddresses.push(t.bytes());break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,y.LE)(t,e.codec()),e.decode=t=>(0,y.C6)(t,e.codec())}(h||(h={}));const g=(0,i.kg)("libp2p:dcutr"),m=5e3,b=3,w=1,v=1;class E{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;constructor(e,t){this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??m,this.retries=t.retries??b,this.maxInboundStreams=t.maxInboundStreams??w,this.maxOutboundStreams=t.maxOutboundStreams??v}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(_,{onConnect:(e,t)=>{t.transient&&"inbound"===t.direction&&this.upgradeInbound(t).catch((e=>{g.error("error during outgoing DCUtR attempt",e)}))}}),await this.registrar.handle(_,(e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch((t=>{g.error("error during incoming DCUtR attempt",t),e.stream.abort(t)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(_),null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let r=0;r<this.retries;r++){const i={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([_],{signal:i.signal,runOnTransientConnection:!0});const r=(0,d.z)(t,{maxDataLength:4096}).pb(h);g("B sending connect to %p",e.remotePeer);const s=Date.now();await r.write({type:h.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map((e=>e.bytes))},i),g("B receiving connect from %p",e.remotePeer);const o=await r.read(i);if(o.type!==h.Type.CONNECT)throw g("A sent wrong message type"),new n.sv("DCUtR message type was incorrect",p.q.ERR_INVALID_MESSAGE);const a=this.getDialableMultiaddrs(o.observedAddresses);if(0===a.length)throw g("A did not have any dialable multiaddrs"),new n.sv("DCUtR connect message had no multiaddrs",p.q.ERR_INVALID_MESSAGE);const c=Date.now()-s;g("A sending sync, rtt %dms",c),await r.write({type:h.Type.SYNC,observedAddresses:[]},i),g("A waiting for half RTT"),await l(c/2),g("B dialing",a);const u=await this.connectionManager.openConnection(a,{signal:i.signal,priority:100});g("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,u.remoteAddr),await e.close(i);break}catch(e){if(g.error("error while attempting DCUtR on attempt %d of %d",r+1,this.retries,e),t?.abort(e),r===this.retries)throw e}finally{null!=t&&await t.close(i)}}}async attemptUnilateralConnectionUpgrade(e){const t=(await this.peerStore.get(e.remotePeer)).addresses.map((t=>{const r=t.multiaddr;return null==r.getPeerId()?r.encapsulate(`/p2p/${e.remotePeer}`):r})).filter((e=>this.isPublicAndDialable(e)));if(t.length>0){const r=AbortSignal.timeout(this.timeout);try{g("attempting unilateral connection upgrade to %a",t);const n=await this.connectionManager.openConnection(t,{signal:r,force:!0});if(n.transient)throw new Error("Could not open a new, non-transient, connection");return g("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,n.remoteAddr),await e.close(),!0}catch(r){g.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,t,r)}}else g("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const r={signal:AbortSignal.timeout(this.timeout)};try{const i=(0,d.z)(e,{maxDataLength:4096}).pb(h);g("A receiving connect");const s=await i.read(r);if(s.type!==h.Type.CONNECT)throw g("B sent wrong message type"),new n.sv("DCUtR message type was incorrect",p.q.ERR_INVALID_MESSAGE);if(0===s.observedAddresses.length)throw g("B sent no multiaddrs"),new n.sv("DCUtR connect message had no multiaddrs",p.q.ERR_INVALID_MESSAGE);const o=this.getDialableMultiaddrs(s.observedAddresses);if(0===o.length)throw g("B had no dialable multiaddrs"),new n.sv("DCUtR connect message had no dialable multiaddrs",p.q.ERR_INVALID_MESSAGE);g("A sending connect"),await i.write({type:h.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map((e=>e.bytes))}),g("A receiving sync");if((await i.read(r)).type!==h.Type.SYNC)throw new n.sv("DCUtR message type was incorrect",p.q.ERR_INVALID_MESSAGE);g("A dialing",o);const a=await this.connectionManager.openConnection(o,{signal:r.signal,priority:100,force:!0});g("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,a.remoteAddr),await t.close(r)}catch(r){g.error("incoming DCUtR from %p failed",t.remotePeer,r),e.abort(r)}finally{await e.close(r)}}getDialableMultiaddrs(e){const t=[];for(const r of e)if(null!=r&&0!==r.length)try{const e=(0,s.HM)(r);if(!this.isPublicAndDialable(e))continue;t.push(e)}catch{}return t}isPublicAndDialable(e){if(o.dx.matches(e))return!1;if(o.Rk.matches(e))return!0;if(!o.IP.matches(e))return!1;if(null==this.transportManager.transportForMultiaddr(e))return!1;const t=e.toOptions();return!1===(0,f.Z)(t.host)}}const _="/libp2p/dcutr";function A(e={}){return t=>new E(t,e)}},64188:function(e,t,r){"use strict";var n,i;r.d(t,{q:function(){return i},s:function(){return n}}),function(e){e.NOT_STARTED_YET="The libp2p node is not started yet",e.DHT_DISABLED="DHT is not available",e.PUBSUB_DISABLED="PubSub is not available",e.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",e.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",e.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",e.NOT_FOUND="Not found"}(n||(n={})),function(e){e.DHT_DISABLED="ERR_DHT_DISABLED",e.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",e.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",e.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",e.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",e.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",e.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",e.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",e.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",e.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",e.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",e.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",e.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",e.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",e.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",e.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",e.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",e.ERR_DIALED_SELF="ERR_DIALED_SELF",e.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",e.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",e.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",e.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",e.ERR_INVALID_KEY="ERR_INVALID_KEY",e.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",e.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",e.ERR_INVALID_PEER="ERR_INVALID_PEER",e.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",e.ERR_NOT_FOUND="ERR_NOT_FOUND",e.ERR_TIMEOUT="ERR_TIMEOUT",e.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",e.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",e.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",e.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",e.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",e.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",e.ERR_FIND_SELF="ERR_FIND_SELF",e.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",e.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",e.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",e.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",e.ERR_INVALID_CMS="ERR_INVALID_CMS",e.ERR_MISSING_KEYS="ERR_MISSING_KEYS",e.ERR_NO_KEY="ERR_NO_KEY",e.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",e.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",e.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",e.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",e.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",e.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",e.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",e.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",e.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",e.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",e.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",e.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",e.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",e.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",e.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",e.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",e.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",e.ERR_INVALID_RECORD="ERR_INVALID_RECORD",e.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",e.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",e.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",e.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",e.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED",e.ERR_TRANSFER_LIMIT_EXCEEDED="ERR_TRANSFER_LIMIT_EXCEEDED"}(i||(i={}))},21141:function(e,t,r){"use strict";r.d(t,{HA:function(){return E}});const n="js-libp2p/0.46.12";var i,s=r(17187),o=r(49541),a=r(38699),c=r(34042),u=r(3046),l=r(59850),h=r(41455),d=r(97858),f=r(2291),p=r(14560),y=r(64188),g=r(46888);!function(e){let t;e.codec=()=>(null==t&&(t=(0,g.yw)(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(const r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(const r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={listenAddrs:[],protocols:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 5:r.protocolVersion=e.string();break;case 6:r.agentVersion=e.string();break;case 1:r.publicKey=e.bytes();break;case 2:r.listenAddrs.push(e.bytes());break;case 4:r.observedAddr=e.bytes();break;case 3:r.protocols.push(e.string());break;case 8:r.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,g.LE)(t,e.codec()),e.decode=t=>(0,g.C6)(t,e.codec())}(i||(i={}));const m=(0,a.kg)("libp2p:identify"),b=8192,w={protocolPrefix:"ipfs",agentVersion:n,timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1,maxObservedAddresses:10,maxIdentifyMessageSize:8192,runOnConnectionOpen:!0,runOnTransientConnection:!0};class v{identifyProtocolStr;identifyPushProtocolStr;host;started;timeout;peerId;peerStore;registrar;connectionManager;addressManager;maxInboundStreams;maxOutboundStreams;maxPushIncomingStreams;maxPushOutgoingStreams;maxIdentifyMessageSize;maxObservedAddresses;events;runOnTransientConnection;constructor(e,t){this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.events=e.events,this.identifyProtocolStr=`/${t.protocolPrefix??w.protocolPrefix}/id/1.0.0`,this.identifyPushProtocolStr=`/${t.protocolPrefix??w.protocolPrefix}/id/push/1.0.0`,this.timeout=t.timeout??w.timeout,this.maxInboundStreams=t.maxInboundStreams??w.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??w.maxOutboundStreams,this.maxPushIncomingStreams=t.maxPushIncomingStreams??w.maxPushIncomingStreams,this.maxPushOutgoingStreams=t.maxPushOutgoingStreams??w.maxPushOutgoingStreams,this.maxIdentifyMessageSize=t.maxIdentifyMessageSize??w.maxIdentifyMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??w.maxObservedAddresses,this.runOnTransientConnection=t.runOnTransientConnection??w.runOnTransientConnection,this.host={protocolVersion:`${t.protocolPrefix??w.protocolPrefix}/0.1.0`,agentVersion:t.agentVersion??w.agentVersion},(t.runOnConnectionOpen??w.runOnConnectionOpen)&&e.events.addEventListener("connection:open",(e=>{const t=e.detail;this.identify(t).catch((e=>{m.error("error during identify trigged by connection:open",e)}))})),e.events.addEventListener("self:peer:update",(e=>{this.push().catch((e=>{m.error(e)}))})),this.host.agentVersion===n&&(p.UG||p.$l?this.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(p.jU||p.n2||p.iP||p.b$)&&(this.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`))}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:(0,d.m)(this.host.agentVersion),ProtocolVersion:(0,d.m)(this.host.protocolVersion)}}),await this.registrar.handle(this.identifyProtocolStr,(e=>{this._handleIdentify(e).catch((e=>{m.error(e)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),await this.registrar.handle(this.identifyPushProtocolStr,(e=>{this._handlePush(e).catch((e=>{m.error(e)}))}),{maxInboundStreams:this.maxPushIncomingStreams,maxOutboundStreams:this.maxPushOutgoingStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.identifyProtocolStr),await this.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async pushToConnections(e){const t=this.addressManager.getAddresses().map((e=>e.decapsulateCode((0,l.a_)("p2p").code))),r=new u.K({peerId:this.peerId,multiaddrs:t}),n=await u.X.seal(r,this.peerId),o=this.registrar.getProtocols(),a=await this.peerStore.get(this.peerId),c=(0,f.B)(a.metadata.get("AgentVersion")??(0,d.m)(this.host.agentVersion)),p=(0,f.B)(a.metadata.get("ProtocolVersion")??(0,d.m)(this.host.protocolVersion)),y=e.map((async e=>{let r;const a=AbortSignal.timeout(this.timeout);try{(0,s.setMaxListeners)?.(1/0,a)}catch{}try{r=await e.newStream([this.identifyPushProtocolStr],{signal:a,runOnTransientConnection:this.runOnTransientConnection});const s=(0,h.z)(r,{maxDataLength:this.maxIdentifyMessageSize??b}).pb(i);await s.write({listenAddrs:t.map((e=>e.bytes)),signedPeerRecord:n.marshal(),protocols:o,agentVersion:c,protocolVersion:p},{signal:a}),await r.close({signal:a})}catch(e){m.error("could not push identify update to peer",e),r?.abort(e)}}));await Promise.all(y)}async push(){if(!this.isStarted())return;const e=[];await Promise.all(this.connectionManager.getConnections().map((async t=>{try{if(!(await this.peerStore.get(t.remotePeer)).protocols.includes(this.identifyPushProtocolStr))return;e.push(t)}catch(e){if(e.code!==y.q.ERR_NOT_FOUND)throw e}}))),await this.pushToConnections(e)}async _identify(e,t={}){let r;t.signal=t.signal??AbortSignal.timeout(this.timeout);try{r=await e.newStream([this.identifyProtocolStr],{...t,runOnTransientConnection:this.runOnTransientConnection});const n=(0,h.z)(r,{maxDataLength:this.maxIdentifyMessageSize??b}).pb(i),s=await n.read(t);return await r.close(t),s}catch(e){throw m.error("error while reading identify message",e),r?.abort(e),e}}async identify(e,t={}){const r=await this._identify(e,t),{publicKey:n,protocols:i,observedAddr:s}=r;if(null==n)throw new o.sv("public key was missing from identify message",y.q.ERR_MISSING_PUBLIC_KEY);const a=await(0,c.y5)(n);if(!e.remotePeer.equals(a))throw new o.sv("identified peer does not match the expected peer",y.q.ERR_INVALID_PEER);if(this.peerId.equals(a))throw new o.sv("identified peer is our own peer id?",y.q.ERR_INVALID_PEER);const u=function(e){if(null!=e&&e.length>0)try{return(0,l.HM)(e)}catch{}}(s);m("identify completed for peer %p and protocols %o",a,i),m("our observed address is %a",u),null!=u&&this.addressManager.getObservedAddrs().length<(this.maxObservedAddresses??1/0)&&(m("storing our observed address %a",u),this.addressManager.addObservedAddr(u));const h=await this.#c(e.remotePeer,r),d={peerId:a,protocolVersion:r.protocolVersion,agentVersion:r.agentVersion,publicKey:r.publicKey,listenAddrs:r.listenAddrs.map((e=>(0,l.HM)(e))),observedAddr:null==r.observedAddr?void 0:(0,l.HM)(r.observedAddr),protocols:r.protocols,signedPeerRecord:h};return this.events.safeDispatchEvent("peer:identify",{detail:d}),d}async _handleIdentify(e){const{connection:t,stream:r}=e,n=AbortSignal.timeout(this.timeout);try{(0,s.setMaxListeners)?.(1/0,n)}catch{}try{const e=this.peerId.publicKey??new Uint8Array(0),s=await this.peerStore.get(this.peerId),o=this.addressManager.getAddresses().map((e=>e.decapsulateCode((0,l.a_)("p2p").code)));let a=s.peerRecordEnvelope;if(o.length>0&&null==a){const e=new u.K({peerId:this.peerId,multiaddrs:o});a=(await u.X.seal(e,this.peerId)).marshal().subarray()}const c=(0,h.z)(r).pb(i);await c.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:e,listenAddrs:o.map((e=>e.bytes)),signedPeerRecord:a,observedAddr:t.remoteAddr.bytes,protocols:s.protocols},{signal:n}),await r.close({signal:n})}catch(e){m.error("could not respond to identify request",e),r.abort(e)}}async _handlePush(e){const{connection:t,stream:r}=e;try{if(this.peerId.equals(t.remotePeer))throw new Error("received push from ourselves?");const e={signal:AbortSignal.timeout(this.timeout)},n=(0,h.z)(r,{maxDataLength:this.maxIdentifyMessageSize??b}).pb(i),s=await n.read(e);await r.close(e),await this.#c(t.remotePeer,s)}catch(e){return m.error("received invalid message",e),void r.abort(e)}m("handled push from %p",t.remotePeer)}async#c(e,t){if(m("received identify from %p",e),null==t)throw new Error("Message was null or undefined");const r={addresses:t.listenAddrs.map((e=>({isCertified:!1,multiaddr:(0,l.HM)(e)}))),protocols:t.protocols,metadata:new Map,peerRecordEnvelope:t.signedPeerRecord};let n;if(null!=t.signedPeerRecord){m("received signedPeerRecord in push from %p",e);let i=t.signedPeerRecord;const s=await u.X.openAndCertify(i,u.K.DOMAIN);let o,a=u.K.createFromProtobuf(s.payload);if(!a.peerId.equals(s.peerId))throw new Error("signing key does not match PeerId in the PeerRecord");if(!e.equals(a.peerId))throw new Error("signing key does not match remote PeerId");try{o=await this.peerStore.get(a.peerId)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}if(null!=o&&(r.metadata=o.metadata,null!=o.peerRecordEnvelope)){const e=await u.X.createFromProtobuf(o.peerRecordEnvelope),t=u.K.createFromProtobuf(e.payload);t.seqNumber>=a.seqNumber&&(m("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,a.seqNumber),a=t,i=o.peerRecordEnvelope)}r.peerRecordEnvelope=i,r.addresses=a.multiaddrs.map((e=>({isCertified:!0,multiaddr:e}))),n={seq:a.seqNumber,addresses:a.multiaddrs}}else m("%p did not send a signed peer record",e);return null!=t.agentVersion&&r.metadata.set("AgentVersion",(0,d.m)(t.agentVersion)),null!=t.protocolVersion&&r.metadata.set("ProtocolVersion",(0,d.m)(t.protocolVersion)),await this.peerStore.patch(e,r),n}}function E(e={}){return t=>new v(t,e)}},63718:function(e,t,r){"use strict";r.d(t,{N:function(){return Dg}});var n={};r.r(n),r.d(n,{base10:function(){return st}});var i={};r.r(i),r.d(i,{base16:function(){return ot},base16upper:function(){return at}});var s={};r.r(s),r.d(s,{base2:function(){return ct}});var o={};r.r(o),r.d(o,{base256emoji:function(){return dt}});var a={};r.r(a),r.d(a,{base32:function(){return ft},base32hex:function(){return mt},base32hexpad:function(){return wt},base32hexpadupper:function(){return vt},base32hexupper:function(){return bt},base32pad:function(){return yt},base32padupper:function(){return gt},base32upper:function(){return pt},base32z:function(){return Et}});var c={};r.r(c),r.d(c,{base36:function(){return _t},base36upper:function(){return At}});var u={};r.r(u),r.d(u,{base58btc:function(){return St},base58flickr:function(){return Rt}});var l={};r.r(l),r.d(l,{base64:function(){return It},base64pad:function(){return xt},base64url:function(){return Pt},base64urlpad:function(){return Ct}});var h={};r.r(h),r.d(h,{base8:function(){return Tt}});var d={};r.r(d),r.d(d,{identity:function(){return kt}});var f={};r.r(f),r.d(f,{code:function(){return Lt},decode:function(){return Mt},encode:function(){return Ut},name:function(){return Nt}});var p={};r.r(p),r.d(p,{code:function(){return Kt},decode:function(){return Vt},encode:function(){return $t},name:function(){return Bt}});var y={};r.r(y),r.d(y,{identity:function(){return dr}});var g={};r.r(g),r.d(g,{sha256:function(){return gr},sha512:function(){return mr}});var m={};r.r(m),r.d(m,{Ed25519PrivateKey:function(){return en},Ed25519PublicKey:function(){return Xr},generateKeyPair:function(){return nn},generateKeyPairFromSeed:function(){return sn},unmarshalEd25519PrivateKey:function(){return tn},unmarshalEd25519PublicKey:function(){return rn}});var b={};r.r(b),r.d(b,{MAX_KEY_SIZE:function(){return wn},RsaPrivateKey:function(){return En},RsaPublicKey:function(){return vn},fromJwk:function(){return Sn},generateKeyPair:function(){return Rn},unmarshalRsaPrivateKey:function(){return _n},unmarshalRsaPublicKey:function(){return An}});var w={};r.r(w),r.d(w,{Secp256k1PrivateKey:function(){return Cn},Secp256k1PublicKey:function(){return Pn},generateKeyPair:function(){return Dn},unmarshalSecp256k1PrivateKey:function(){return Tn},unmarshalSecp256k1PublicKey:function(){return kn}});var v={};r.r(v),r.d(v,{identity:function(){return li}});var E={};r.r(E),r.d(E,{base2:function(){return hi}});var _={};r.r(_),r.d(_,{base8:function(){return di}});var A={};r.r(A),r.d(A,{base10:function(){return fi}});var S={};r.r(S),r.d(S,{base16:function(){return pi},base16upper:function(){return yi}});var R={};r.r(R),r.d(R,{base32:function(){return gi},base32hex:function(){return vi},base32hexpad:function(){return _i},base32hexpadupper:function(){return Ai},base32hexupper:function(){return Ei},base32pad:function(){return bi},base32padupper:function(){return wi},base32upper:function(){return mi},base32z:function(){return Si}});var I={};r.r(I),r.d(I,{base36:function(){return Ri},base36upper:function(){return Ii}});var x={};r.r(x),r.d(x,{base58btc:function(){return xi},base58flickr:function(){return Pi}});var P={};r.r(P),r.d(P,{base64:function(){return Ci},base64pad:function(){return Ti},base64url:function(){return ki},base64urlpad:function(){return Di}});var C={};r.r(C),r.d(C,{base256emoji:function(){return Ui}});var T={};r.r(T),r.d(T,{sha256:function(){return as},sha512:function(){return cs}});var k={};r.r(k),r.d(k,{identity:function(){return ls}});var D={};r.r(D),r.d(D,{code:function(){return ds},decode:function(){return ps},encode:function(){return fs},name:function(){return hs}});var O={};r.r(O),r.d(O,{code:function(){return bs},decode:function(){return vs},encode:function(){return ws},name:function(){return ms}});var N={};r.r(N),r.d(N,{base32:function(){return co},base32hex:function(){return fo},base32hexpad:function(){return yo},base32hexpadupper:function(){return go},base32hexupper:function(){return po},base32pad:function(){return lo},base32padupper:function(){return ho},base32upper:function(){return uo},base32z:function(){return mo}});var L={};r.r(L),r.d(L,{base58btc:function(){return bo},base58flickr:function(){return wo}});var U={};r.r(U),r.d(U,{base64:function(){return vo},base64pad:function(){return Eo},base64url:function(){return _o},base64urlpad:function(){return Ao}});var M={};r.r(M),r.d(M,{base10:function(){return Ro}});var B={};r.r(B),r.d(B,{base16:function(){return Io},base16upper:function(){return xo}});var K={};r.r(K),r.d(K,{base2:function(){return Po}});var $={};r.r($),r.d($,{base256emoji:function(){return Do}});var V={};r.r(V),r.d(V,{base36:function(){return Oo},base36upper:function(){return No}});var j={};r.r(j),r.d(j,{base8:function(){return Lo}});var z={};r.r(z),r.d(z,{identity:function(){return Uo}});var q={};r.r(q),r.d(q,{code:function(){return $o},decode:function(){return jo},encode:function(){return Vo},name:function(){return Ko}});var F={};r.r(F),r.d(F,{code:function(){return qo},decode:function(){return Go},encode:function(){return Fo},name:function(){return zo}});var G={};r.r(G),r.d(G,{identity:function(){return ma}});var H={};r.r(H),r.d(H,{sha256:function(){return Ea},sha512:function(){return _a}});var W={};r.r(W),r.d(W,{Ed25519PrivateKey:function(){return tc},Ed25519PublicKey:function(){return ec},generateKeyPair:function(){return ic},generateKeyPairFromSeed:function(){return sc},unmarshalEd25519PrivateKey:function(){return rc},unmarshalEd25519PublicKey:function(){return nc}});var Y={};r.r(Y),r.d(Y,{MAX_KEY_SIZE:function(){return wc},RsaPrivateKey:function(){return Ec},RsaPublicKey:function(){return vc},fromJwk:function(){return Sc},generateKeyPair:function(){return Rc},unmarshalRsaPrivateKey:function(){return _c},unmarshalRsaPublicKey:function(){return Ac}});var Q={};r.r(Q),r.d(Q,{Secp256k1PrivateKey:function(){return Pc},Secp256k1PublicKey:function(){return xc},generateKeyPair:function(){return kc},unmarshalSecp256k1PrivateKey:function(){return Cc},unmarshalSecp256k1PublicKey:function(){return Tc}});var J={};r.r(J),r.d(J,{identity:function(){return cu}});var Z={};r.r(Z),r.d(Z,{base2:function(){return uu}});var X={};r.r(X),r.d(X,{base8:function(){return lu}});var ee={};r.r(ee),r.d(ee,{base10:function(){return hu}});var te={};r.r(te),r.d(te,{base16:function(){return du},base16upper:function(){return fu}});var re={};r.r(re),r.d(re,{base32:function(){return pu},base32hex:function(){return bu},base32hexpad:function(){return vu},base32hexpadupper:function(){return Eu},base32hexupper:function(){return wu},base32pad:function(){return gu},base32padupper:function(){return mu},base32upper:function(){return yu},base32z:function(){return _u}});var ne={};r.r(ne),r.d(ne,{base36:function(){return Au},base36upper:function(){return Su}});var ie={};r.r(ie),r.d(ie,{base58btc:function(){return Ru},base58flickr:function(){return Iu}});var se={};r.r(se),r.d(se,{base64:function(){return xu},base64pad:function(){return Pu},base64url:function(){return Cu},base64urlpad:function(){return Tu}});var oe={};r.r(oe),r.d(oe,{base256emoji:function(){return Nu}});var ae={};r.r(ae),r.d(ae,{sha256:function(){return sl},sha512:function(){return ol}});var ce={};r.r(ce),r.d(ce,{identity:function(){return cl}});var ue={};r.r(ue),r.d(ue,{code:function(){return ll},decode:function(){return dl},encode:function(){return hl},name:function(){return ul}});var le={};r.r(le),r.d(le,{code:function(){return gl},decode:function(){return bl},encode:function(){return ml},name:function(){return yl}});var he={};r.r(he),r.d(he,{identity:function(){return Ch}});var de={};r.r(de),r.d(de,{base2:function(){return Th}});var fe={};r.r(fe),r.d(fe,{base8:function(){return kh}});var pe={};r.r(pe),r.d(pe,{base10:function(){return Dh}});var ye={};r.r(ye),r.d(ye,{base16:function(){return Oh},base16upper:function(){return Nh}});var ge={};r.r(ge),r.d(ge,{base32:function(){return Lh},base32hex:function(){return Kh},base32hexpad:function(){return Vh},base32hexpadupper:function(){return jh},base32hexupper:function(){return $h},base32pad:function(){return Mh},base32padupper:function(){return Bh},base32upper:function(){return Uh},base32z:function(){return zh}});var me={};r.r(me),r.d(me,{base36:function(){return qh},base36upper:function(){return Fh}});var be={};r.r(be),r.d(be,{base58btc:function(){return Gh},base58flickr:function(){return Hh}});var we={};r.r(we),r.d(we,{base64:function(){return Wh},base64pad:function(){return Yh},base64url:function(){return Qh},base64urlpad:function(){return Jh}});var ve={};r.r(ve),r.d(ve,{base256emoji:function(){return td}});var Ee={};r.r(Ee),r.d(Ee,{sha256:function(){return Id},sha512:function(){return xd}});var _e={};r.r(_e),r.d(_e,{identity:function(){return Cd}});var Ae={};r.r(Ae),r.d(Ae,{code:function(){return kd},decode:function(){return Od},encode:function(){return Dd},name:function(){return Td}});var Se={};r.r(Se),r.d(Se,{code:function(){return Md},decode:function(){return Kd},encode:function(){return Bd},name:function(){return Ud}});var Re={};r.r(Re),r.d(Re,{base32:function(){return Bp},base32hex:function(){return jp},base32hexpad:function(){return qp},base32hexpadupper:function(){return Fp},base32hexupper:function(){return zp},base32pad:function(){return $p},base32padupper:function(){return Vp},base32upper:function(){return Kp},base32z:function(){return Gp}});var Ie={};r.r(Ie),r.d(Ie,{base58btc:function(){return Hp},base58flickr:function(){return Wp}});var xe={};r.r(xe),r.d(xe,{base64:function(){return Yp},base64pad:function(){return Qp},base64url:function(){return Jp},base64urlpad:function(){return Zp}});var Pe={};r.r(Pe),r.d(Pe,{base10:function(){return ay}});var Ce={};r.r(Ce),r.d(Ce,{base16:function(){return cy},base16upper:function(){return uy}});var Te={};r.r(Te),r.d(Te,{base2:function(){return ly}});var ke={};r.r(ke),r.d(ke,{base256emoji:function(){return py}});var De={};r.r(De),r.d(De,{base36:function(){return yy},base36upper:function(){return gy}});var Oe={};r.r(Oe),r.d(Oe,{base8:function(){return my}});var Ne={};r.r(Ne),r.d(Ne,{identity:function(){return by}});var Le={};r.r(Le),r.d(Le,{code:function(){return _y},decode:function(){return Sy},encode:function(){return Ay},name:function(){return Ey}});var Ue={};r.r(Ue),r.d(Ue,{code:function(){return Iy},decode:function(){return Py},encode:function(){return xy},name:function(){return Ry}});var Me={};r.r(Me),r.d(Me,{identity:function(){return Jy}});var Be={};r.r(Be),r.d(Be,{sha256:function(){return tg},sha512:function(){return rg}});var Ke=r(17187),$e=r(43724),Ve=r(27710),je=r(49541),ze=r(23247),qe=r(85521),Fe=r(77309);r(8925);var Ge=r(3832);function He(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}var We=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Ye=We;new Uint8Array(0);const Qe=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Je{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ze{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return et(this,e)}}class Xe{constructor(e){this.decoders=e}or(e){return et(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const et=(e,t)=>new Xe({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class tt{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Je(e,t,r),this.decoder=new Ze(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const rt=({name:e,prefix:t,encode:r,decode:n})=>new tt(e,t,r,n),nt=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Ye(r,t);return rt({prefix:e,name:t,encode:n,decode:e=>Qe(i(e))})},it=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>rt({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),st=nt({prefix:"9",name:"base10",alphabet:"0123456789"}),ot=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),at=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ct=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ut=Array.from(""),lt=ut.reduce(((e,t,r)=>(e[r]=t,e)),[]),ht=ut.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const dt=rt({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=lt[t]),"")},decode:function(e){const t=[];for(const r of e){const e=ht[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),ft=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),pt=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yt=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gt=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mt=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),bt=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wt=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),vt=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Et=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),_t=nt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),At=nt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),St=nt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Rt=nt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),It=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xt=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Pt=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ct=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Tt=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),kt=rt({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Dt=new TextEncoder,Ot=new TextDecoder,Nt="json",Lt=512,Ut=e=>Dt.encode(JSON.stringify(e)),Mt=e=>JSON.parse(Ot.decode(e)),Bt="raw",Kt=85,$t=e=>Qe(e),Vt=e=>Qe(e);var jt=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Ft;)r[n++]=255&t|zt,t/=128;for(;t&qt;)r[n++]=255&t|zt,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},zt=128,qt=-128,Ft=Math.pow(2,31);var Gt=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Wt)<<s:(n&Wt)*Math.pow(2,s),s+=7}while(n>=Ht);return e.bytes=o-r,i},Ht=128,Wt=127;var Yt=Math.pow(2,7),Qt=Math.pow(2,14),Jt=Math.pow(2,21),Zt=Math.pow(2,28),Xt=Math.pow(2,35),er=Math.pow(2,42),tr=Math.pow(2,49),rr=Math.pow(2,56),nr=Math.pow(2,63),ir={encode:jt,decode:Gt,encodingLength:function(e){return e<Yt?1:e<Qt?2:e<Jt?3:e<Zt?4:e<Xt?5:e<er?6:e<tr?7:e<rr?8:e<nr?9:10}};const sr=(e,t=0)=>[ir.decode(e,t),ir.decode.bytes],or=(e,t,r=0)=>(ir.encode(e,t,r),t),ar=e=>ir.encodingLength(e),cr=(e,t)=>{const r=t.byteLength,n=ar(e),i=n+ar(r),s=new Uint8Array(i+r);return or(e,s,0),or(r,s,n),s.set(t,i),new lr(e,r,t,s)},ur=e=>{const t=Qe(e),[r,n]=sr(t),[i,s]=sr(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new lr(r,i,o,t)};class lr{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const hr=Qe,dr={code:0,name:"identity",encode:hr,digest:e=>cr(0,hr(e))},fr=({name:e,code:t,encode:r})=>new pr(e,t,r);class pr{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?cr(this.code,t):t.then((e=>cr(this.code,e)))}throw Error("Unknown type, must be binary type")}}const yr=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),gr=fr({name:"sha2-256",code:18,encode:yr("SHA-256")}),mr=fr({name:"sha2-512",code:19,encode:yr("SHA-512")}),br=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Ar(r,vr(e),t||St.encoder):Sr(r,vr(e),t||ft.encoder)},wr=new WeakMap,vr=e=>{const t=wr.get(e);if(null==t){const t=new Map;return wr.set(e,t),t}return t};class Er{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Rr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ir)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Er.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=cr(e,t);return Er.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Er.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return br(this,e)}toJSON(){return{"/":br(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Er)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Er(e,r,n,i||xr(e,r,n.bytes))}if(!0===t[Pr]){const{version:e,multihash:r,code:n}=t,i=ur(r);return Er.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Rr)throw new Error(`Version 0 CID must use dag-pb (code: ${Rr}) block encoding`);return new Er(e,t,r,r.bytes);case 1:{const n=xr(e,t,r.bytes);return new Er(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Er.create(0,Rr,e)}static createV1(e,t){return Er.create(1,e,t)}static decode(e){const[t,r]=Er.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Er.inspectBytes(e),r=t.size-t.multihashSize,n=Qe(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new lr(t.multihashCode,t.digestSize,i,n);return[0===t.version?Er.createV0(s):Er.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=sr(e.subarray(t));return t+=n,r};let n=r(),i=Rr;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=_r(e,t),i=Er.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return vr(i).set(r,e),i}}const _r=(e,t)=>{switch(e[0]){case"Q":{const r=t||St;return[St.prefix,r.decode(`${St.prefix}${e}`)]}case St.prefix:{const r=t||St;return[St.prefix,r.decode(e)]}case ft.prefix:{const r=t||ft;return[ft.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Ar=(e,t,r)=>{const{prefix:n}=r;if(n!==St.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Sr=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},Rr=112,Ir=18,xr=(e,t,r)=>{const n=ar(e),i=n+ar(t),s=new Uint8Array(i+r.byteLength);return or(e,s,0),or(t,s,n),s.set(r,i),s},Pr=Symbol.for("@ipld/js-cid/CID"),Cr={...d,...s,...h,...n,...i,...a,...c,...u,...l,...o};function Tr(e=0){return null!=globalThis.Buffer?.allocUnsafe?He(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function kr(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Dr=kr("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Or=kr("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Tr((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Nr={utf8:Dr,"utf-8":Dr,hex:Cr.base16,latin1:Or,ascii:Or,binary:Or,...Cr};function Lr(e,t="utf8"){const r=Nr[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):He(globalThis.Buffer.from(e,"utf-8"))}function Ur(e,t="utf8"){const r=Nr[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var Mr={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};r(3068),r(97450);function Br(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}var Kr=r(4101);const $r=32,Vr=64,jr=32;function zr(e,t){const r=new Uint8Array(Vr);for(let n=0;n<jr;n++)r[n]=e[n],r[jr+n]=t[n];return r}function qr(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Tr(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return He(r)}const Fr={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Gr(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=Mr.get();r*=8;return{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),l=a.getRandomValues(new Uint8Array(n)),h={name:t,iv:l};let d;if("string"==typeof c&&(c=Lr(c)),0===c.length){d=await a.subtle.importKey("jwk",Fr,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{d=await a.subtle.importKey("jwk",Fr,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const f=await a.subtle.encrypt(h,d,e);return qr([u,h.iv,new Uint8Array(f)])},decrypt:async function(e,c){const u=e.subarray(0,s),l=e.subarray(s,s+n),h=e.subarray(s+n),d={name:t,iv:l};let f;if("string"==typeof c&&(c=Lr(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{f=await a.subtle.importKey("jwk",Fr,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(d,f,h);return new Uint8Array(p)}}}async function Hr(e,t){const r=Gr(),n=await r.encrypt(e,t);return It.encode(n)}var Wr,Yr,Qr,Jr,Zr=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(Wr||(Wr={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(Yr||(Yr={})),function(e){e.codec=()=>(0,Zr.Ji)(Yr)}(Wr||(Wr={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Wr.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=Wr.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(Qr||(Qr={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Wr.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=Wr.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(Jr||(Jr={}));class Xr{_key;constructor(e){this._key=on(e,$r)}async verify(e,t){return async function(e,t,r){return Kr.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return Qr.encode({Type:Wr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Br(this.bytes,e.bytes)}async hash(){const{bytes:e}=await gr.digest(this.bytes);return e}}class en{_key;_publicKey;constructor(e,t){this._key=on(e,Vr),this._publicKey=on(t,$r)}async sign(e){return async function(e,t){const r=e.subarray(0,jr);return Kr.UN.sign(t,r)}(this._key,e)}get public(){return new Xr(this._publicKey)}marshal(){return this._key}get bytes(){return Jr.encode({Type:Wr.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Br(this.bytes,e.bytes)}async hash(){const{bytes:e}=await gr.digest(this.bytes);return e}async id(){const e=dr.digest(this.public.bytes);return St.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return Hr(this.bytes,e);throw new je.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function tn(e){if(e.length>Vr){const t=(e=on(e,Vr+$r)).subarray(0,Vr),r=e.subarray(Vr,e.length);return new en(t,r)}const t=(e=on(e,Vr)).subarray(0,Vr),r=e.subarray($r);return new en(t,r)}function rn(e){return e=on(e,$r),new Xr(e)}async function nn(){const{privateKey:e,publicKey:t}=await async function(){const e=Kr.UN.utils.randomPrivateKey(),t=Kr.UN.getPublicKey(e);return{privateKey:zr(e,t),publicKey:t}}();return new en(e,t)}async function sn(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==jr)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=Kr.UN.getPublicKey(t);return{privateKey:zr(t,r),publicKey:r}}(e);return new en(t,r)}function on(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new je.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}var an=r(97116);r(15764);function cn(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=qr([new Uint8Array(t-r.length),r])}return Ur(r,"base64url")}function un(e){const t=function(e,t){let r=Lr(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=qr([new Uint8Array(t-r.length),r])}return r}(e);return new Ge.jsbn.BigInteger(Ur(t,"base16"),16)}const ln={"P-256":256,"P-384":384,"P-521":521};Object.keys(ln).join(" / ");r(63219);const hn="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function dn(e){if(isNaN(e)||e<=0)throw new je.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(hn&&"function"==typeof hn.getRandomValues)return hn.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}r(28095);function fn(e,t){return t.map((t=>un(e[t])))}async function pn(e){const t=[await Mr.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await gn(e)],r=await yn({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function yn(e){if(null==e.privateKey||null==e.publicKey)throw new je.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Mr.get().subtle.exportKey("jwk",e.privateKey),Mr.get().subtle.exportKey("jwk",e.publicKey)])}async function gn(e){return Mr.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function mn(e,t,r,n){const i=t?function(e){return Ge.pki.setRsaPublicKey(...fn(e,["n","e"]))}(e):function(e){return Ge.pki.setRsaPrivateKey(...fn(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return Lr(n(Ur(Uint8Array.from(r),"ascii"),i),"ascii")}function bn(e){if("RSA"!==e.kty)throw new je.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new je.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*Lr(e.n,"base64url").length}const wn=8192;class vn{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await Mr.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Mr.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new je.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Ge.pki.publicKeyToAsn1({n:un(e.n),e:un(e.e)});return Lr(Ge.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Qr.encode({Type:Wr.RSA,Data:this.marshal()}).subarray()}encrypt(e){return mn(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Br(this.bytes,e.bytes)}async hash(){const{bytes:e}=await gr.digest(this.bytes);return e}}class En{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return dn(16)}async sign(e){return async function(e,t){const r=await Mr.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Mr.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new je.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new vn(this._publicKey)}decrypt(e){return mn(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new je.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Ge.pki.privateKeyToAsn1({n:un(e.n),e:un(e.e),d:un(e.d),p:un(e.p),q:un(e.q),dP:un(e.dp),dQ:un(e.dq),qInv:un(e.qi)});return Lr(Ge.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Jr.encode({Type:Wr.RSA,Data:this.marshal()}).subarray()}equals(e){return Br(this.bytes,e.bytes)}async hash(){const{bytes:e}=await gr.digest(this.bytes);return e}async id(){return Ur(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new Ge.util.ByteBuffer(this.marshal()),r=Ge.asn1.fromDer(t),n=Ge.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return Ge.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return Hr(this.bytes,e);throw new je.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function _n(e){const t=function(e){const t=Ge.asn1.fromDer(Ur(e,"ascii")),r=Ge.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:cn(r.n),e:cn(r.e),d:cn(r.d),p:cn(r.p),q:cn(r.q),dp:cn(r.dP),dq:cn(r.dQ),qi:cn(r.qInv),alg:"RS256"}}(e);if(bn(t)>wn)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await pn(t);return new En(r.privateKey,r.publicKey)}function An(e){const t=function(e){const t=Ge.asn1.fromDer(Ur(e,"ascii")),r=Ge.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:cn(r.n),e:cn(r.e)}}(e);if(bn(t)>wn)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new vn(t)}async function Sn(e){if(bn(e)>wn)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await pn(e);return new En(t.privateKey,t.publicKey)}async function Rn(e){if(e>wn)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Mr.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await yn(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new En(t.privateKey,t.publicKey)}var In=r(60533);function xn(e){try{In.kA.ProjectivePoint.fromHex(e)}catch(e){throw new je.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class Pn{_key;constructor(e){xn(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await gr.digest(r);return In.kA.verify(t,n,e)}catch(e){throw new je.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,In.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return Qr.encode({Type:Wr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Br(this.bytes,e.bytes)}async hash(){const{bytes:e}=await gr.digest(this.bytes);return e}}class Cn{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return In.kA.getPublicKey(e,!0)}catch(e){throw new je.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{In.kA.getPublicKey(e,!0)}catch(e){throw new je.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),xn(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await gr.digest(t);try{return In.kA.sign(r,e).toDERRawBytes()}catch(e){throw new je.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new Pn(this._publicKey)}marshal(){return this._key}get bytes(){return Jr.encode({Type:Wr.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Br(this.bytes,e.bytes)}async hash(){const{bytes:e}=await gr.digest(this.bytes);return e}async id(){return Ur(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return Hr(this.bytes,e);throw new je.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Tn(e){return new Cn(e)}function kn(e){return new Pn(e)}async function Dn(){const e=In.kA.utils.randomPrivateKey();return new Cn(e)}const On={rsa:b,ed25519:m,secp256k1:w};function Nn(e){const t=Object.keys(On).join(" / ");return new je.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function Ln(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return On[e];throw Nn(e)}async function Un(e){const t=Jr.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case Wr.RSA:return On.rsa.unmarshalRsaPrivateKey(r);case Wr.Ed25519:return On.ed25519.unmarshalEd25519PrivateKey(r);case Wr.Secp256k1:return On.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Nn(t.Type??"RSA")}}async function Mn(e,t){try{const r=await async function(e,t){const r=It.decode(e);return Gr().decrypt(r,t)}(e,t);return await Un(r)}catch(e){}const r=Ge.pki.decryptRsaPrivateKey(e,t);if(null===r)throw new je.sv("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=Ge.asn1.toDer(Ge.pki.privateKeyToAsn1(r));return n=Lr(n.getBytes(),"ascii"),On.rsa.unmarshalRsaPrivateKey(n)}var Bn=r(98960);const Kn={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function $n(e,t,r,n,i){if("sha1"!==i&&"sha2-256"!==i&&"sha2-512"!==i){const e=Object.keys(Kn).join(" / ");throw new je.sv(`Hash '${i}' is unknown or not supported. Must be ${e}`,"ERR_UNSUPPORTED_HASH_TYPE")}const s=Bn(e,t,r,n,Kn[i]);return an.encode64(s,null)}var Vn=r(11227);Vn.formatters.b=e=>null==e?"undefined":St.baseEncode(e),Vn.formatters.t=e=>null==e?"undefined":ft.baseEncode(e),Vn.formatters.m=e=>null==e?"undefined":It.baseEncode(e),Vn.formatters.p=e=>null==e?"undefined":e.toString(),Vn.formatters.c=e=>null==e?"undefined":e.toString(),Vn.formatters.k=e=>null==e?"undefined":e.toString(),Vn.formatters.a=e=>null==e?"undefined":e.toString();var jn=r(5681);const zn=Symbol.for("nodejs.util.inspect.custom"),qn=Object.values(Cr).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Cr.identity.decoder),Fn=114,Gn=36,Hn=37;class Wn{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[jn.N]=!0;toString(){return null==this.string&&(this.string=St.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Er.createV1(Fn,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Br(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??qn,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=ur(St.decode(`z${e}`));return e.startsWith("12D")?new Qn({multihash:t}):e.startsWith("16U")?new Jn({multihash:t}):new Yn({multihash:t})}return function(e){try{const t=ur(e);if(t.code===dr.code){if(t.digest.length===Gn)return new Qn({multihash:t});if(t.digest.length===Hn)return new Jn({multihash:t})}if(t.code===gr.code)return new Yn({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Fn)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===gr.code)return new Yn({multihash:e.multihash});if(t.code===dr.code){if(t.digest.length===Gn)return new Qn({multihash:e.multihash});if(t.digest.length===Hn)return new Jn({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Er.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(qn.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return Br(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[zn](){return`PeerId(${this.toString()})`}}class Yn extends Wn{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Qn extends Wn{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class Jn extends Wn{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}var Zn=r(53416);var Xn=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},ei=Xn;new Uint8Array(0);const ti=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class ri{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ni{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return si(this,e)}}class ii{constructor(e){this.decoders=e}or(e){return si(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const si=(e,t)=>new ii({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class oi{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new ri(e,t,r),this.decoder=new ni(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ai=({name:e,prefix:t,encode:r,decode:n})=>new oi(e,t,r,n),ci=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=ei(r,t);return ai({prefix:e,name:t,encode:n,decode:e=>ti(i(e))})},ui=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>ai({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),li=ai({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),hi=ui({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),di=ui({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fi=ci({prefix:"9",name:"base10",alphabet:"0123456789"}),pi=ui({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),yi=ui({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),gi=ui({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mi=ui({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bi=ui({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wi=ui({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vi=ui({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ei=ui({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_i=ui({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ai=ui({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Si=ui({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Ri=ci({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ii=ci({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),xi=ci({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Pi=ci({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ci=ui({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ti=ui({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ki=ui({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Di=ui({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Oi=Array.from(""),Ni=Oi.reduce(((e,t,r)=>(e[r]=t,e)),[]),Li=Oi.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Ui=ai({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Ni[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Li[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var Mi=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=$i;)r[n++]=255&t|Bi,t/=128;for(;t&Ki;)r[n++]=255&t|Bi,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Bi=128,Ki=-128,$i=Math.pow(2,31);var Vi=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&zi)<<s:(n&zi)*Math.pow(2,s),s+=7}while(n>=ji);return e.bytes=o-r,i},ji=128,zi=127;var qi=Math.pow(2,7),Fi=Math.pow(2,14),Gi=Math.pow(2,21),Hi=Math.pow(2,28),Wi=Math.pow(2,35),Yi=Math.pow(2,42),Qi=Math.pow(2,49),Ji=Math.pow(2,56),Zi=Math.pow(2,63),Xi={encode:Mi,decode:Vi,encodingLength:function(e){return e<qi?1:e<Fi?2:e<Gi?3:e<Hi?4:e<Wi?5:e<Yi?6:e<Qi?7:e<Ji?8:e<Zi?9:10}};const es=(e,t,r=0)=>(Xi.encode(e,t,r),t),ts=e=>Xi.encodingLength(e),rs=(e,t)=>{const r=t.byteLength,n=ts(e),i=n+ts(r),s=new Uint8Array(i+r);return es(e,s,0),es(r,s,n),s.set(t,i),new ns(e,r,t,s)};class ns{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const is=({name:e,code:t,encode:r})=>new ss(e,t,r);class ss{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?rs(this.code,t):t.then((e=>rs(this.code,e)))}throw Error("Unknown type, must be binary type")}}const os=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),as=is({name:"sha2-256",code:18,encode:os("SHA-256")}),cs=is({name:"sha2-512",code:19,encode:os("SHA-512")}),us=ti,ls={code:0,name:"identity",encode:us,digest:e=>rs(0,us(e))},hs="raw",ds=85,fs=e=>ti(e),ps=e=>ti(e),ys=new TextEncoder,gs=new TextDecoder,ms="json",bs=512,ws=e=>ys.encode(JSON.stringify(e)),vs=e=>JSON.parse(gs.decode(e));new WeakMap;class Es{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Es.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return Es.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Es.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return cid_format(this,e)}toJSON(){return{"/":cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Es)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Es(e,r,n,i||cid_encodeCID(e,r,n.bytes))}if(!0===t[cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return Es.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new Es(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new Es(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Es.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return Es.create(1,e,t)}static decode(e){const[t,r]=Es.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Es.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?Es.createV0(s):Es.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),i=Es.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const _s={...v,...E,..._,...A,...S,...R,...I,...x,...P,...C};function As(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Ss(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Rs=Ss("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Is=Ss("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer?.allocUnsafe?As(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var xs={utf8:Rs,"utf-8":Rs,hex:_s.base16,latin1:Is,ascii:Is,binary:Is,..._s};const Ps="/",Cs=(new TextEncoder).encode(Ps),Ts=Cs[0];class ks{_buf;constructor(e,t){if("string"==typeof e)this._buf=function(e,t="utf8"){const r=xs[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):As(globalThis.Buffer.from(e,"utf-8"))}(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==Ts)throw new Error("Invalid key")}toString(e="utf8"){return function(e,t="utf8"){const r=xs[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new ks(e.join(Ps))}static random(){return new ks((0,Zn.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new ks(e):"function"==typeof e.uint8Array?new ks(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Cs),this._buf[0]!==Ts){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Ts,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Ts;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return ks.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Ps).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new ks(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Ps)||(e+=Ps),e+=this.type(),new ks(e)}parent(){const e=this.list();return 1===e.length?new ks(Ps):new ks(e.slice(0,-1).join(Ps))}child(e){return this.toString()===Ps?e:e.toString()===Ps?this:new ks(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return ks.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}var Ds,Os=r(79221),Ns=r(50202);!function(e){e.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",e.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",e.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",e.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",e.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",e.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",e.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",e.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",e.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",e.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",e.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",e.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",e.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",e.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",e.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH"}(Ds||(Ds={}));const Ls=function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return Vn.enabled(`${e}:trace`)&&null!=Vn.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=Vn(`${e}:trace`)),Object.assign(Vn(e),{error:Vn(`${e}:error`),trace:t})}("libp2p:keychain"),Us="/info/",Ms=new WeakMap,Bs=14,Ks=16,$s=1e3,Vs={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function js(e){return null!=e&&("string"==typeof e&&(e===Ns(e.trim())&&e.length>0))}async function zs(){const e=800*Math.random()+200;await new Promise((t=>setTimeout(t,e)))}function qs(e){return new ks("/pkcs8/"+e)}function Fs(e){return new ks(Us+e)}class Gs{components;init;constructor(e,t){if(this.components=e,this.init=(0,Os.Z)(Vs,t),null!=this.init.pass&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(null!=this.init.dek?.keyLength&&this.init.dek.keyLength<Bs)throw new Error(`dek.keyLength must be least ${Bs} bytes`);if(null!=this.init.dek?.salt?.length&&this.init.dek.salt.length<Ks)throw new Error(`dek.saltLength must be least ${Ks} bytes`);if(null!=this.init.dek?.iterationCount&&this.init.dek.iterationCount<$s)throw new Error(`dek.iterationCount must be least ${$s}`);const r=null!=this.init.pass&&null!=this.init.dek?.salt?$n(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Ms.set(this,{dek:r})}static generateOptions(){const e=Object.assign({},Vs),t=3*Math.ceil(Ks/3);return e.dek.salt=Ur(dn(t),"base64"),e}static get options(){return Vs}async createKey(e,t,r=2048){if(!js(e)||"self"===e)throw await zs(),new je.sv("Invalid key name",Ds.ERR_INVALID_KEY_NAME);if("string"!=typeof t)throw await zs(),new je.sv("Invalid key type",Ds.ERR_INVALID_KEY_TYPE);const n=qs(e);if(await this.components.datastore.has(n))throw await zs(),new je.sv("Key name already exists",Ds.ERR_KEY_ALREADY_EXISTS);if("rsa"===t.toLowerCase())if(!Number.isSafeInteger(r)||r<2048)throw await zs(),new je.sv("Invalid RSA key size",Ds.ERR_INVALID_KEY_SIZE);let i;try{const s=await async function(e,t){return Ln(e).generateKeyPair(t??2048)}(t,r),o=await s.id(),a=Ms.get(this);if(null==a)throw new je.sv("dek missing",Ds.ERR_INVALID_PARAMETERS);const c=a.dek,u=await s.export(c);i={name:e,id:o};const l=this.components.datastore.batch();l.put(n,Lr(u)),l.put(Fs(e),Lr(JSON.stringify(i))),await l.commit()}catch(e){throw await zs(),e}return i}async listKeys(){const e={prefix:Us},t=[];for await(const r of this.components.datastore.query(e))t.push(JSON.parse(Ur(r.value)));return t}async findKeyById(e){try{const t=(await this.listKeys()).find((t=>t.id===e));if(null==t)throw new je.sv(`Key with id '${e}' does not exist.`,Ds.ERR_KEY_NOT_FOUND);return t}catch(e){throw await zs(),e}}async findKeyByName(e){if(!js(e))throw await zs(),new je.sv(`Invalid key name '${e}'`,Ds.ERR_INVALID_KEY_NAME);const t=Fs(e);try{const e=await this.components.datastore.get(t);return JSON.parse(Ur(e))}catch(t){throw await zs(),Ls.error(t),new je.sv(`Key '${e}' does not exist.`,Ds.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!js(e)||"self"===e)throw await zs(),new je.sv(`Invalid key name '${e}'`,Ds.ERR_INVALID_KEY_NAME);const t=qs(e),r=await this.findKeyByName(e),n=this.components.datastore.batch();return n.delete(t),n.delete(Fs(e)),await n.commit(),r}async renameKey(e,t){if(!js(e)||"self"===e)throw await zs(),new je.sv(`Invalid old key name '${e}'`,Ds.ERR_OLD_KEY_NAME_INVALID);if(!js(t)||"self"===t)throw await zs(),new je.sv(`Invalid new key name '${t}'`,Ds.ERR_NEW_KEY_NAME_INVALID);const r=qs(e),n=qs(t),i=Fs(e),s=Fs(t);if(await this.components.datastore.has(n))throw await zs(),new je.sv(`Key '${t}' already exists`,Ds.ERR_KEY_ALREADY_EXISTS);try{const e=await this.components.datastore.get(r),o=await this.components.datastore.get(i),a=JSON.parse(Ur(o));a.name=t;const c=this.components.datastore.batch();return c.put(n,e),c.put(s,Lr(JSON.stringify(a))),c.delete(r),c.delete(i),await c.commit(),a}catch(e){throw await zs(),e}}async exportKey(e,t){if(!js(e))throw await zs(),new je.sv(`Invalid key name '${e}'`,Ds.ERR_INVALID_KEY_NAME);if(null==t)throw await zs(),new je.sv("Password is required",Ds.ERR_PASSWORD_REQUIRED);const r=qs(e);try{const e=Ur(await this.components.datastore.get(r)),n=Ms.get(this);if(null==n)throw new je.sv("dek missing",Ds.ERR_INVALID_PARAMETERS);const i=n.dek,s=await Mn(e,i);return await s.export(t)}catch(e){throw await zs(),e}}async exportPeerId(e){const t="temporary-password",r=await this.exportKey(e,t),n=await Mn(r,t);return async function(e,t){return e.length===Gn?new Qn({multihash:cr(dr.code,e),privateKey:t}):e.length===Hn?new Jn({multihash:cr(dr.code,e),privateKey:t}):new Yn({multihash:await gr.digest(e),publicKey:e,privateKey:t})}(n.public.bytes,n.bytes)}async importKey(e,t,r){if(!js(e)||"self"===e)throw await zs(),new je.sv(`Invalid key name '${e}'`,Ds.ERR_INVALID_KEY_NAME);if(null==t)throw await zs(),new je.sv("PEM encoded key is required",Ds.ERR_PEM_REQUIRED);const n=qs(e);if(await this.components.datastore.has(n))throw await zs(),new je.sv(`Key '${e}' already exists`,Ds.ERR_KEY_ALREADY_EXISTS);let i,s;try{i=await Mn(t,r)}catch(e){throw await zs(),new je.sv("Cannot read the key, most likely the password is wrong",Ds.ERR_CANNOT_READ_KEY)}try{s=await i.id();const e=Ms.get(this);if(null==e)throw new je.sv("dek missing",Ds.ERR_INVALID_PARAMETERS);const r=e.dek;t=await i.export(r)}catch(e){throw await zs(),e}const o={name:e,id:s},a=this.components.datastore.batch();return a.put(n,Lr(t)),a.put(Fs(e),Lr(JSON.stringify(o))),await a.commit(),o}async importPeer(e,t){try{if(!js(e))throw new je.sv(`Invalid key name '${e}'`,Ds.ERR_INVALID_KEY_NAME);if(null==t)throw new je.sv("PeerId is required",Ds.ERR_MISSING_PRIVATE_KEY);if(null==t.privateKey)throw new je.sv("PeerId.privKey is required",Ds.ERR_MISSING_PRIVATE_KEY);const r=await Un(t.privateKey),n=qs(e);if(await this.components.datastore.has(n))throw await zs(),new je.sv(`Key '${e}' already exists`,Ds.ERR_KEY_ALREADY_EXISTS);const i=Ms.get(this);if(null==i)throw new je.sv("dek missing",Ds.ERR_INVALID_PARAMETERS);const s=i.dek,o=await r.export(s),a={name:e,id:t.toString()},c=this.components.datastore.batch();return c.put(n,Lr(o)),c.put(Fs(e),Lr(JSON.stringify(a))),await c.commit(),a}catch(e){throw await zs(),e}}async getPrivateKey(e){if(!js(e))throw await zs(),new je.sv(`Invalid key name '${e}'`,Ds.ERR_INVALID_KEY_NAME);try{const t=qs(e);return Ur(await this.components.datastore.get(t))}catch(t){throw await zs(),Ls.error(t),new je.sv(`Key '${e}' does not exist.`,Ds.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){if("string"!=typeof e)throw await zs(),new je.sv(`Invalid old pass type '${typeof e}'`,Ds.ERR_INVALID_OLD_PASS_TYPE);if("string"!=typeof t)throw await zs(),new je.sv(`Invalid new pass type '${typeof t}'`,Ds.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await zs(),new je.sv(`Invalid pass length ${t.length}`,Ds.ERR_INVALID_PASS_LENGTH);Ls("recreating keychain");const r=Ms.get(this);if(null==r)throw new je.sv("dek missing",Ds.ERR_INVALID_PARAMETERS);const n=r.dek;this.init.pass=t;const i=null!=t&&null!=this.init.dek?.salt?$n(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Ms.set(this,{dek:i});const s=await this.listKeys();for(const e of s){const t=Ur(await this.components.datastore.get(qs(e.name))),r=await Mn(t,n),s=i.toString(),o=await r.export(s),a=this.components.datastore.batch(),c={name:e.name,id:e.id};a.put(qs(e.name),Lr(o)),a.put(Fs(e.name),Lr(JSON.stringify(c))),await a.commit()}Ls("keychain reconstructed")}}var Hs=r(38699),Ws=r(25975),Ys=r(34042),Qs=r(74803);var Js=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Zs=Js;new Uint8Array(0);const Xs=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class eo{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class to{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return no(this,e)}}class ro{constructor(e){this.decoders=e}or(e){return no(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const no=(e,t)=>new ro({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class io{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new eo(e,t,r),this.decoder=new to(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const so=({name:e,prefix:t,encode:r,decode:n})=>new io(e,t,r,n),oo=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Zs(r,t);return so({prefix:e,name:t,encode:n,decode:e=>Xs(i(e))})},ao=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>so({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),co=ao({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),uo=ao({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lo=ao({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ho=ao({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),fo=ao({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),po=ao({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yo=ao({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),go=ao({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mo=ao({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),bo=oo({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),wo=oo({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),vo=ao({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Eo=ao({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),_o=ao({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ao=ao({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function So(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}Vn.formatters.b=e=>null==e?"undefined":bo.baseEncode(e),Vn.formatters.t=e=>null==e?"undefined":co.baseEncode(e),Vn.formatters.m=e=>null==e?"undefined":vo.baseEncode(e),Vn.formatters.p=e=>null==e?"undefined":e.toString(),Vn.formatters.c=e=>null==e?"undefined":e.toString(),Vn.formatters.k=e=>null==e?"undefined":e.toString(),Vn.formatters.a=e=>null==e?"undefined":e.toString();const Ro=oo({prefix:"9",name:"base10",alphabet:"0123456789"}),Io=ao({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xo=ao({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Po=ao({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Co=Array.from(""),To=Co.reduce(((e,t,r)=>(e[r]=t,e)),[]),ko=Co.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Do=so({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=To[t]),"")},decode:function(e){const t=[];for(const r of e){const e=ko[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),Oo=oo({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),No=oo({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Lo=ao({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Uo=so({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Mo=new TextEncoder,Bo=new TextDecoder,Ko="json",$o=512,Vo=e=>Mo.encode(JSON.stringify(e)),jo=e=>JSON.parse(Bo.decode(e)),zo="raw",qo=85,Fo=e=>Xs(e),Go=e=>Xs(e);var Ho=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Qo;)r[n++]=255&t|Wo,t/=128;for(;t&Yo;)r[n++]=255&t|Wo,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Wo=128,Yo=-128,Qo=Math.pow(2,31);var Jo=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Xo)<<s:(n&Xo)*Math.pow(2,s),s+=7}while(n>=Zo);return e.bytes=o-r,i},Zo=128,Xo=127;var ea=Math.pow(2,7),ta=Math.pow(2,14),ra=Math.pow(2,21),na=Math.pow(2,28),ia=Math.pow(2,35),sa=Math.pow(2,42),oa=Math.pow(2,49),aa=Math.pow(2,56),ca=Math.pow(2,63),ua={encode:Ho,decode:Jo,encodingLength:function(e){return e<ea?1:e<ta?2:e<ra?3:e<na?4:e<ia?5:e<sa?6:e<oa?7:e<aa?8:e<ca?9:10}};const la=(e,t=0)=>[ua.decode(e,t),ua.decode.bytes],ha=(e,t,r=0)=>(ua.encode(e,t,r),t),da=e=>ua.encodingLength(e),fa=(e,t)=>{const r=t.byteLength,n=da(e),i=n+da(r),s=new Uint8Array(i+r);return ha(e,s,0),ha(r,s,n),s.set(t,i),new ya(e,r,t,s)},pa=e=>{const t=Xs(e),[r,n]=la(t),[i,s]=la(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new ya(r,i,o,t)};class ya{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const ga=Xs,ma={code:0,name:"identity",encode:ga,digest:e=>fa(0,ga(e))},ba=({name:e,code:t,encode:r})=>new wa(e,t,r);class wa{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?fa(this.code,t):t.then((e=>fa(this.code,e)))}throw Error("Unknown type, must be binary type")}}const va=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ea=ba({name:"sha2-256",code:18,encode:va("SHA-256")}),_a=ba({name:"sha2-512",code:19,encode:va("SHA-512")}),Aa=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?Pa(r,Ra(e),t||bo.encoder):Ca(r,Ra(e),t||co.encoder)},Sa=new WeakMap,Ra=e=>{const t=Sa.get(e);if(null==t){const t=new Map;return Sa.set(e,t),t}return t};class Ia{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Ta)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ka)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ia.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=fa(e,t);return Ia.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ia.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return Aa(this,e)}toJSON(){return{"/":Aa(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Ia)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new Ia(e,r,n,i||Da(e,r,n.bytes))}if(!0===t[Oa]){const{version:e,multihash:r,code:n}=t,i=pa(r);return Ia.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Ta)throw new Error(`Version 0 CID must use dag-pb (code: ${Ta}) block encoding`);return new Ia(e,t,r,r.bytes);case 1:{const n=Da(e,t,r.bytes);return new Ia(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return Ia.create(0,Ta,e)}static createV1(e,t){return Ia.create(1,e,t)}static decode(e){const[t,r]=Ia.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ia.inspectBytes(e),r=t.size-t.multihashSize,n=Xs(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new ya(t.multihashCode,t.digestSize,i,n);return[0===t.version?Ia.createV0(s):Ia.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=la(e.subarray(t));return t+=n,r};let n=r(),i=Ta;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=xa(e,t),i=Ia.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Ra(i).set(r,e),i}}const xa=(e,t)=>{switch(e[0]){case"Q":{const r=t||bo;return[bo.prefix,r.decode(`${bo.prefix}${e}`)]}case bo.prefix:{const r=t||bo;return[bo.prefix,r.decode(e)]}case co.prefix:{const r=t||co;return[co.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Pa=(e,t,r)=>{const{prefix:n}=r;if(n!==bo.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},Ca=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},Ta=112,ka=18,Da=(e,t,r)=>{const n=da(e),i=n+da(t),s=new Uint8Array(i+r.byteLength);return ha(e,s,0),ha(t,s,n),s.set(r,i),s},Oa=Symbol.for("@ipld/js-cid/CID"),Na={...z,...K,...j,...M,...B,...N,...V,...L,...U,...$};function La(e=0){return null!=globalThis.Buffer?.allocUnsafe?So(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Ua(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Ma=Ua("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Ba=Ua("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=La((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Ka={utf8:Ma,"utf-8":Ma,hex:Na.base16,latin1:Ba,ascii:Ba,binary:Ba,...Na};function $a(e,t="utf8"){const r=Ka[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):So(globalThis.Buffer.from(e,"utf-8"))}function Va(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}const ja=32,za=64,qa=32;function Fa(e,t){const r=new Uint8Array(za);for(let n=0;n<qa;n++)r[n]=e[n],r[qa+n]=t[n];return r}function Ga(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=La(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return So(r)}var Ha={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const Wa={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function Ya(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=Ha.get();return r*=8,{encrypt:async function(e,c){const u=a.getRandomValues(new Uint8Array(s)),l=a.getRandomValues(new Uint8Array(n)),h={name:t,iv:l};let d;if("string"==typeof c&&(c=$a(c)),0===c.length){d=await a.subtle.importKey("jwk",Wa,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{d=await a.subtle.importKey("jwk",Wa,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);d=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const f=await a.subtle.encrypt(h,d,e);return Ga([u,h.iv,new Uint8Array(f)])},decrypt:async function(e,c){const u=e.subarray(0,s),l=e.subarray(s,s+n),h=e.subarray(s+n),d={name:t,iv:l};let f;if("string"==typeof c&&(c=$a(c)),0===c.length)try{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{f=await a.subtle.importKey("jwk",Wa,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:u,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const p=await a.subtle.decrypt(d,f,h);return new Uint8Array(p)}}}(),n=await r.encrypt(e,t);return vo.encode(n)}var Qa,Ja,Za,Xa;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(Qa||(Qa={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(Ja||(Ja={})),function(e){e.codec=()=>(0,Zr.Ji)(Ja)}(Qa||(Qa={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Qa.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=Qa.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(Za||(Za={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Qa.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=Qa.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(Xa||(Xa={}));class ec{_key;constructor(e){this._key=oc(e,ja)}async verify(e,t){return async function(e,t,r){return Kr.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return Za.encode({Type:Qa.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Va(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ea.digest(this.bytes);return e}}class tc{_key;_publicKey;constructor(e,t){this._key=oc(e,za),this._publicKey=oc(t,ja)}async sign(e){return async function(e,t){const r=e.subarray(0,qa);return Kr.UN.sign(t,r)}(this._key,e)}get public(){return new ec(this._publicKey)}marshal(){return this._key}get bytes(){return Xa.encode({Type:Qa.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Va(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ea.digest(this.bytes);return e}async id(){const e=ma.digest(this.public.bytes);return bo.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return Ya(this.bytes,e);throw new je.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function rc(e){if(e.length>za){const t=(e=oc(e,za+ja)).subarray(0,za),r=e.subarray(za,e.length);return new tc(t,r)}const t=(e=oc(e,za)).subarray(0,za),r=e.subarray(ja);return new tc(t,r)}function nc(e){return e=oc(e,ja),new ec(e)}async function ic(){const{privateKey:e,publicKey:t}=await async function(){const e=Kr.UN.utils.randomPrivateKey(),t=Kr.UN.getPublicKey(e);return{privateKey:Fa(e,t),publicKey:t}}();return new tc(e,t)}async function sc(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==qa)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=Kr.UN.getPublicKey(t);return{privateKey:Fa(t,r),publicKey:r}}(e);return new tc(t,r)}function oc(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new je.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}function ac(e,t="utf8"){const r=Ka[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function cc(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Ga([new Uint8Array(t-r.length),r])}return ac(r,"base64url")}function uc(e){const t=function(e,t){let r=$a(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=Ga([new Uint8Array(t-r.length),r])}return r}(e);return new Ge.jsbn.BigInteger(ac(t,"base16"),16)}const lc={"P-256":256,"P-384":384,"P-521":521};Object.keys(lc).join(" / ");const hc="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function dc(e){if(isNaN(e)||e<=0)throw new je.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(hc&&"function"==typeof hc.getRandomValues)return hc.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}function fc(e,t){return t.map((t=>uc(e[t])))}async function pc(e){const t=[await Ha.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await gc(e)],r=await yc({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function yc(e){if(null==e.privateKey||null==e.publicKey)throw new je.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Ha.get().subtle.exportKey("jwk",e.privateKey),Ha.get().subtle.exportKey("jwk",e.publicKey)])}async function gc(e){return Ha.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function mc(e,t,r,n){const i=t?function(e){return Ge.pki.setRsaPublicKey(...fc(e,["n","e"]))}(e):function(e){return Ge.pki.setRsaPrivateKey(...fc(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return $a(n(ac(Uint8Array.from(r),"ascii"),i),"ascii")}function bc(e){if("RSA"!==e.kty)throw new je.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new je.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*$a(e.n,"base64url").length}const wc=8192;class vc{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await Ha.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Ha.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new je.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Ge.pki.publicKeyToAsn1({n:uc(e.n),e:uc(e.e)});return $a(Ge.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Za.encode({Type:Qa.RSA,Data:this.marshal()}).subarray()}encrypt(e){return mc(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Va(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ea.digest(this.bytes);return e}}class Ec{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return dc(16)}async sign(e){return async function(e,t){const r=await Ha.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Ha.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new je.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new vc(this._publicKey)}decrypt(e){return mc(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new je.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=Ge.pki.privateKeyToAsn1({n:uc(e.n),e:uc(e.e),d:uc(e.d),p:uc(e.p),q:uc(e.q),dP:uc(e.dp),dQ:uc(e.dq),qInv:uc(e.qi)});return $a(Ge.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Xa.encode({Type:Qa.RSA,Data:this.marshal()}).subarray()}equals(e){return Va(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ea.digest(this.bytes);return e}async id(){return ac(await this.public.hash(),"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new Ge.util.ByteBuffer(this.marshal()),r=Ge.asn1.fromDer(t),n=Ge.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return Ge.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return Ya(this.bytes,e);throw new je.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function _c(e){const t=function(e){const t=Ge.asn1.fromDer(ac(e,"ascii")),r=Ge.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:cc(r.n),e:cc(r.e),d:cc(r.d),p:cc(r.p),q:cc(r.q),dp:cc(r.dP),dq:cc(r.dQ),qi:cc(r.qInv),alg:"RS256"}}(e);if(bc(t)>wc)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await pc(t);return new Ec(r.privateKey,r.publicKey)}function Ac(e){const t=function(e){const t=Ge.asn1.fromDer(ac(e,"ascii")),r=Ge.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:cc(r.n),e:cc(r.e)}}(e);if(bc(t)>wc)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new vc(t)}async function Sc(e){if(bc(e)>wc)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await pc(e);return new Ec(t.privateKey,t.publicKey)}async function Rc(e){if(e>wc)throw new je.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Ha.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await yc(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new Ec(t.privateKey,t.publicKey)}function Ic(e){try{In.kA.ProjectivePoint.fromHex(e)}catch(e){throw new je.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class xc{_key;constructor(e){Ic(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await Ea.digest(r);return In.kA.verify(t,n,e)}catch(e){throw new je.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,In.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return Za.encode({Type:Qa.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Va(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ea.digest(this.bytes);return e}}class Pc{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return In.kA.getPublicKey(e,!0)}catch(e){throw new je.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{In.kA.getPublicKey(e,!0)}catch(e){throw new je.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Ic(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await Ea.digest(t);try{return In.kA.sign(r,e).toDERRawBytes()}catch(e){throw new je.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new xc(this._publicKey)}marshal(){return this._key}get bytes(){return Xa.encode({Type:Qa.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Va(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Ea.digest(this.bytes);return e}async id(){return ac(await this.public.hash(),"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return Ya(this.bytes,e);throw new je.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Cc(e){return new Pc(e)}function Tc(e){return new xc(e)}async function kc(){const e=In.kA.utils.randomPrivateKey();return new Pc(e)}const Dc={rsa:Y,ed25519:W,secp256k1:Q};function Oc(e){const t=Object.keys(Dc).join(" / ");return new je.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}async function Nc(e){const t=Xa.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case Qa.RSA:return Dc.rsa.unmarshalRsaPrivateKey(r);case Qa.Ed25519:return Dc.ed25519.unmarshalEd25519PrivateKey(r);case Qa.Secp256k1:return Dc.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Oc(t.Type??"RSA")}}const Lc=Symbol.for("nodejs.util.inspect.custom"),Uc=Object.values(Na).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Na.identity.decoder),Mc=114,Bc=36,Kc=37;class $c{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[jn.N]=!0;toString(){return null==this.string&&(this.string=bo.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Ia.createV1(Mc,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Va(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??Uc,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=pa(bo.decode(`z${e}`));return e.startsWith("12D")?new jc({multihash:t}):e.startsWith("16U")?new zc({multihash:t}):new Vc({multihash:t})}return qc(Uc.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return Va(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Lc](){return`PeerId(${this.toString()})`}}class Vc extends $c{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class jc extends $c{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class zc extends $c{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function qc(e){try{const t=pa(e);if(t.code===ma.code){if(t.digest.length===Bc)return new jc({multihash:t});if(t.digest.length===Kc)return new zc({multihash:t})}if(t.code===Ea.code)return new Vc({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Mc)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Ea.code)return new Vc({multihash:e.multihash});if(t.code===ma.code){if(t.digest.length===Bc)return new jc({multihash:e.multihash});if(t.digest.length===Kc)return new zc({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Ia.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var Fc=r(57050),Gc=r(62308);const Hc="ERR_SIGNATURE_NOT_VALID";var Wc;!function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(Wc||(Wc={}));class Yc{static createFromProtobuf=async e=>{const t=Wc.decode(e),r=await async function(e,t){return e.length===Bc?new jc({multihash:fa(ma.code,e),privateKey:t}):e.length===Kc?new zc({multihash:fa(ma.code,e),privateKey:t}):new Vc({multihash:await Ea.digest(e),publicKey:e,privateKey:t})}(t.publicKey);return new Yc({peerId:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})};static seal=async(e,t)=>{if(null==t.privateKey)throw new Error("Missing private key");const r=e.domain,n=e.codec,i=e.marshal(),s=Qc(r,n,i),o=await Nc(t.privateKey),a=await o.sign(s.subarray());return new Yc({peerId:t,payloadType:n,payload:i,signature:a})};static openAndCertify=async(e,t)=>{const r=await Yc.createFromProtobuf(e);if(!await r.validate(t))throw new je.sv("envelope signature is not valid for the given domain",Hc);return r};peerId;payloadType;payload;signature;marshaled;constructor(e){const{peerId:t,payloadType:r,payload:n,signature:i}=e;this.peerId=t,this.payloadType=r,this.payload=n,this.signature=i}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=Wc.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Va(this.marshal(),e.marshal())}async validate(e){const t=Qc(e,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");return function(e){const t=Za.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case Qa.RSA:return Dc.rsa.unmarshalRsaPublicKey(r);case Qa.Ed25519:return Dc.ed25519.unmarshalEd25519PublicKey(r);case Qa.Secp256k1:return Dc.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Oc(t.Type??"unknown")}}(this.peerId.publicKey).verify(t.subarray(),this.signature)}}const Qc=(e,t,r)=>{const n=$a(e),i=Fc.cv(n.byteLength),s=Fc.cv(t.length),o=Fc.cv(r.length);return new Gc.H(i,n,s,t,o,r)};var Jc=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Zc=Jc;new Uint8Array(0);const Xc=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class eu{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class tu{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return nu(this,e)}}class ru{constructor(e){this.decoders=e}or(e){return nu(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const nu=(e,t)=>new ru({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class iu{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new eu(e,t,r),this.decoder=new tu(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const su=({name:e,prefix:t,encode:r,decode:n})=>new iu(e,t,r,n),ou=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Zc(r,t);return su({prefix:e,name:t,encode:n,decode:e=>Xc(i(e))})},au=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>su({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),cu=su({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),uu=au({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),lu=au({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),hu=ou({prefix:"9",name:"base10",alphabet:"0123456789"}),du=au({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),fu=au({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),pu=au({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yu=au({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),gu=au({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mu=au({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),bu=au({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wu=au({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),vu=au({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Eu=au({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_u=au({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Au=ou({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Su=ou({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ru=ou({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Iu=ou({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),xu=au({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Pu=au({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Cu=au({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Tu=au({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ku=Array.from(""),Du=ku.reduce(((e,t,r)=>(e[r]=t,e)),[]),Ou=ku.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const Nu=su({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Du[t]),"")},decode:function(e){const t=[];for(const r of e){const e=Ou[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var Lu=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Bu;)r[n++]=255&t|Uu,t/=128;for(;t&Mu;)r[n++]=255&t|Uu,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Uu=128,Mu=-128,Bu=Math.pow(2,31);var Ku=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Vu)<<s:(n&Vu)*Math.pow(2,s),s+=7}while(n>=$u);return e.bytes=o-r,i},$u=128,Vu=127;var ju=Math.pow(2,7),zu=Math.pow(2,14),qu=Math.pow(2,21),Fu=Math.pow(2,28),Gu=Math.pow(2,35),Hu=Math.pow(2,42),Wu=Math.pow(2,49),Yu=Math.pow(2,56),Qu=Math.pow(2,63),Ju={encode:Lu,decode:Ku,encodingLength:function(e){return e<ju?1:e<zu?2:e<qu?3:e<Fu?4:e<Gu?5:e<Hu?6:e<Wu?7:e<Yu?8:e<Qu?9:10}};const Zu=(e,t,r=0)=>(Ju.encode(e,t,r),t),Xu=e=>Ju.encodingLength(e),el=(e,t)=>{const r=t.byteLength,n=Xu(e),i=n+Xu(r),s=new Uint8Array(i+r);return Zu(e,s,0),Zu(r,s,n),s.set(t,i),new tl(e,r,t,s)};class tl{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const rl=({name:e,code:t,encode:r})=>new nl(e,t,r);class nl{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?el(this.code,t):t.then((e=>el(this.code,e)))}throw Error("Unknown type, must be binary type")}}const il=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),sl=rl({name:"sha2-256",code:18,encode:il("SHA-256")}),ol=rl({name:"sha2-512",code:19,encode:il("SHA-512")}),al=Xc,cl={code:0,name:"identity",encode:al,digest:e=>el(0,al(e))},ul="raw",ll=85,hl=e=>Xc(e),dl=e=>Xc(e),fl=new TextEncoder,pl=new TextDecoder,yl="json",gl=512,ml=e=>fl.encode(JSON.stringify(e)),bl=e=>JSON.parse(pl.decode(e));new WeakMap;class wl{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==multiformats_src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==multiformats_src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return wl.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return wl.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return wl.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return multiformats_src_cid_format(this,e)}toJSON(){return{"/":multiformats_src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof wl)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new wl(e,r,n,i||multiformats_src_cid_encodeCID(e,r,n.bytes))}if(!0===t[multiformats_src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return wl.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==multiformats_src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${multiformats_src_cid_DAG_PB_CODE}) block encoding`);return new wl(e,t,r,r.bytes);case 1:{const n=multiformats_src_cid_encodeCID(e,t,r.bytes);return new wl(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return wl.create(0,multiformats_src_cid_DAG_PB_CODE,e)}static createV1(e,t){return wl.create(1,e,t)}static decode(e){const[t,r]=wl.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=wl.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?wl.createV0(s):wl.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=multiformats_src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=multiformats_src_cid_parseCIDtoBytes(e,t),i=wl.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return multiformats_src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const vl={...J,...Z,...X,...ee,...te,...re,...ne,...ie,...se,...oe};function El(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function _l(e=0){return null!=globalThis.Buffer?.allocUnsafe?El(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Al(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const Sl=Al("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Rl=Al("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=_l((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Il={utf8:Sl,"utf-8":Sl,hex:vl.base16,latin1:Rl,ascii:Rl,binary:Rl,...vl};function xl(e,t="utf8"){const r=Il[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function Pl(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=_l(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return El(r)}r(9839);function Cl(e,t="utf8"){const r=Il[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):El(globalThis.Buffer.from(e,"utf-8"))}var Tl=r(49736);const kl=Tl.C,Dl=Tl.aY,Ol=function(e){let t=0;if(e=e.toString().trim(),kl(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(Dl(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;kl(r[n])&&(e=Ol(r[n]),r[n]=xl(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,xl(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},Nl=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},Ll=-1,Ul={},Ml={};function Bl(e){if("number"==typeof e){if(null!=Ml[e])return Ml[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=Ul[e])return Ul[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Ll,"ip6zone"],[43,8,"ipcidr"],[53,Ll,"dns",!0],[54,Ll,"dns4",!0],[55,Ll,"dns6",!0],[56,Ll,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Ll,"unix",!1,!0],[421,Ll,"ipfs"],[421,Ll,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Ll,"garlic64"],[448,0,"tls"],[449,Ll,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Ll,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,Ll,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);Ml[t.code]=t,Ul[t.name]=t}));Bl("ip4"),Bl("ip6"),Bl("ipcidr");function Kl(e,t){switch(Bl(e).code){case 4:case 41:return function(e){const t=Nl(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!Tl.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Hl(t);case 6:case 273:case 33:case 132:return Fl(t).toString();case 421:return function(e){const t=Fc.Jx(e),r=e.slice(Fc.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return xl(r,"base58btc")}(t);case 444:case 445:return Wl(t);case 466:return function(e){const t=Fc.Jx(e),r=e.slice(Fc.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+xl(r,"base64url")}(t);default:return xl(t,"base16")}}function $l(e,t){switch(Bl(e).code){case 4:case 41:return zl(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Gl(t);case 6:case 273:case 33:case 132:return ql(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?pa(bo.decode(`z${e}`)).bytes:Ia.parse(e).multihash.bytes;const r=Uint8Array.from(Fc.cv(t.length));return Pl([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=co.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ql(n);return Pl([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=co.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ql(n);return Pl([r,i],r.length+i.length)}(t);case 466:return function(e){const t=jl.decode(e),r=Uint8Array.from(Fc.cv(t.length));return Pl([r,t],r.length+t.length)}(t);default:return Cl(t,"base16")}}const Vl=Object.values(Na).map((e=>e.decoder)),jl=function(){let e=Vl[0].or(Vl[1]);return Vl.slice(2).forEach((t=>e=e.or(t))),e}();function zl(e){if(!Tl.h6(e))throw new Error("invalid ip address");return Ol(e)}function ql(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function Fl(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Gl(e){const t=Cl(e),r=Uint8Array.from(Fc.cv(t.length));return Pl([r,t],r.length+t.length)}function Hl(e){const t=Fc.Jx(e);if((e=e.slice(Fc.P$(t))).length!==t)throw new Error("inconsistent lengths");return xl(e)}function Wl(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${xl(t,"base32")}:${Fl(r)}`}function Yl(e){const t=[],r=[];let n=null,i=0;for(;i<e.length;){const s=Fc.Jx(e,i),o=Fc.P$(s),a=Bl(s),c=Zl(a,e.slice(i+o));if(0===c){t.push([s]),r.push([s]),i+=o;continue}const u=e.slice(i+o,i+o+c);if(i+=c+o,i>e.length)throw eh("Invalid address Uint8Array: "+xl(e,"base16"));t.push([s,u]);const l=Kl(s,u);if(r.push([s,l]),!0===a.path){n=l;break}}return{bytes:Uint8Array.from(e),string:Ql(r),tuples:t,stringTuples:r,path:n}}function Ql(e){const t=[];return e.map((e=>{const r=Bl(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),Xl(t.join("/"))}function Jl(e){return Pl(e.map((e=>{const t=Bl(e[0]);let r=Uint8Array.from(Fc.cv(t.code));return e.length>1&&null!=e[1]&&(r=Pl([r,e[1]])),r})))}function Zl(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=Fc.Jx(t instanceof Uint8Array?t:Uint8Array.from(t));return e+Fc.P$(e)}}function Xl(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function eh(e){return new Error("Error parsing address: "+e)}const th=Symbol.for("nodejs.util.inspect.custom"),rh=[Bl("dns").code,Bl("dns4").code,Bl("dns6").code,Bl("dnsaddr").code],nh=new Map,ih=Symbol.for("@multiformats/js-multiaddr/multiaddr");function sh(e){return Boolean(e?.[ih])}class oh{bytes;#e;#t;#r;#n;[ih]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=Yl(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);t=function(e){const t=[],r=[];let n=null;const i=(e=Xl(e)).split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=Bl(i[s]);if(0===o.size){t.push([o.code]),r.push([o.code]);continue}if(s++,s>=i.length)throw eh("invalid address: "+e);if(!0===o.path){n=Xl(i.slice(s).join("/")),t.push([o.code,$l(o.code,n)]),r.push([o.code,n]);break}const a=$l(o.code,i[s]);t.push([o.code,a]),r.push([o.code,Kl(o.code,a)])}return{string:Ql(r),bytes:Jl(t),tuples:t,stringTuples:r,path:n}}(e)}else{if(!sh(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");t=Yl(e.bytes)}this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=Bl("tcp"),o=Bl("udp"),a=Bl("ip4"),c=Bl("ip6"),u=Bl("dns6"),l=Bl("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),rh.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=Bl(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=Bl(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#t.map((([e])=>Object.assign({},Bl(e))))}protoCodes(){return this.#t.map((([e])=>e))}protoNames(){return this.#t.map((([e])=>Bl(e).name))}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(e){return e=new oh(e),new oh(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new oh(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new oh(Jl(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach((([t,r])=>{t===Ul.p2p.code&&e.push([t,r]),t===Ul["p2p-circuit"].code&&(e=[])}));const t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?xl(bo.decode(`z${e}`),"base58btc"):xl(Ia.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#n}equals(e){return function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=nh.get(t.name);if(null==r)throw new je.sv(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new oh(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[th](){return`Multiaddr(${this.#e})`}}function ah(e){return new oh(e)}const ch=Uint8Array.from([3,1]);var uh;!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.multiaddr=e.bytes();else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=(0,Zr.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.peerId&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),null!=t.seq&&0n!==t.seq&&(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(const n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={peerId:new Uint8Array(0),seq:0n,addresses:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.peerId=t.bytes();break;case 2:n.seq=t.uint64();break;case 3:n.addresses.push(e.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(7&r)}}return n}))),r),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(uh||(uh={}));class lh{static createFromProtobuf=e=>{const t=uh.decode(e),r=qc(t.peerId),n=(t.addresses??[]).map((e=>ah(e.multiaddr))),i=t.seq;return new lh({peerId:r,multiaddrs:n,seqNumber:i})};static DOMAIN="libp2p-peer-record";static CODEC=ch;peerId;multiaddrs;seqNumber;domain=lh.DOMAIN;codec=lh.CODEC;marshaled;constructor(e){const{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=uh.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))})),this.marshaled}equals(e){return e instanceof lh&&(!!this.peerId.equals(e.peerId)&&(this.seqNumber===e.seqNumber&&!!function(e,t){const r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every(((e,r)=>t[r].equals(e))))}(this.multiaddrs,e.multiaddrs)))}}var hh=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t},dh=r(95155);const fh={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS"};var ph,yh,gh;function mh(e,t){const r=ph.decode(t);null!=r.publicKey&&null==e.publicKey&&(e=function(e){if("RSA"===e.type)return new Vc(e);if("Ed25519"===e.type)return new jc(e);if("secp256k1"===e.type)return new zc(e);throw new je.sv("Not a PeerId","ERR_INVALID_PARAMETERS")}({...e,publicKey:e.publicKey}));const n=new Map,i=BigInt(Date.now());for(const[e,t]of r.tags.entries())null!=t.expiry&&t.expiry<i||n.set(e,t);return{...r,id:e,addresses:r.addresses.map((({multiaddr:e,isCertified:t})=>({multiaddr:ah(e),isCertified:t??!1}))),metadata:r.metadata,peerRecordEnvelope:r.peerRecordEnvelope??void 0,tags:n}}!function(e){let t,r,n;!function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={key:"",value:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.string();break;case 2:r.value=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(t=e.Peer$metadataEntry||(e.Peer$metadataEntry={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&(t.uint32(18),gh.codec().encode(e.value,t)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={key:""},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.key=e.string();break;case 2:r.value=gh.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(r=e.Peer$tagsEntry||(e.Peer$tagsEntry={})),e.codec=()=>(null==n&&(n=(0,Zr.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.addresses)for(const e of t.addresses)r.uint32(10),yh.codec().encode(e,r);if(null!=t.protocols)for(const e of t.protocols)r.uint32(18),r.string(e);if(null!=t.publicKey&&(r.uint32(34),r.bytes(t.publicKey)),null!=t.peerRecordEnvelope&&(r.uint32(42),r.bytes(t.peerRecordEnvelope)),null!=t.metadata&&0!==t.metadata.size)for(const[n,i]of t.metadata.entries())r.uint32(50),e.Peer$metadataEntry.codec().encode({key:n,value:i},r);if(null!=t.tags&&0!==t.tags.size)for(const[n,i]of t.tags.entries())r.uint32(58),e.Peer$tagsEntry.codec().encode({key:n,value:i},r);!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={addresses:[],protocols:[],metadata:new Map,tags:new Map},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.addresses.push(yh.codec().decode(t,t.uint32()));break;case 2:n.protocols.push(t.string());break;case 4:n.publicKey=t.bytes();break;case 5:n.peerRecordEnvelope=t.bytes();break;case 6:{const r=e.Peer$metadataEntry.codec().decode(t,t.uint32());n.metadata.set(r.key,r.value);break}case 7:{const r=e.Peer$tagsEntry.codec().decode(t,t.uint32());n.tags.set(r.key,r.value);break}default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(ph||(ph={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.multiaddr=e.bytes();break;case 2:r.isCertified=e.bool();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(yh||(yh={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,Zr.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.value&&0!==e.value&&(t.uint32(8),t.uint32(e.value)),null!=e.expiry&&(t.uint32(16),t.uint64(e.expiry)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={value:0},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.value=e.uint32();break;case 2:r.expiry=e.uint64();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,Zr.LE)(t,e.codec()),e.decode=t=>(0,Zr.C6)(t,e.codec())}(gh||(gh={}));var bh=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},wh=bh;new Uint8Array(0);const vh=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Eh{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class _h{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Sh(this,e)}}class Ah{constructor(e){this.decoders=e}or(e){return Sh(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Sh=(e,t)=>new Ah({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Rh{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Eh(e,t,r),this.decoder=new _h(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ih=({name:e,prefix:t,encode:r,decode:n})=>new Rh(e,t,r,n),xh=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=wh(r,t);return Ih({prefix:e,name:t,encode:n,decode:e=>vh(i(e))})},Ph=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Ih({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Ch=Ih({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Th=Ph({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),kh=Ph({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Dh=xh({prefix:"9",name:"base10",alphabet:"0123456789"}),Oh=Ph({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Nh=Ph({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Lh=Ph({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Uh=Ph({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Mh=Ph({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Bh=Ph({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Kh=Ph({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$h=Ph({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Vh=Ph({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jh=Ph({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),zh=Ph({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),qh=xh({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Fh=xh({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Gh=xh({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Hh=xh({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Wh=Ph({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Yh=Ph({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Qh=Ph({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Jh=Ph({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Zh=Array.from(""),Xh=Zh.reduce(((e,t,r)=>(e[r]=t,e)),[]),ed=Zh.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const td=Ih({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Xh[t]),"")},decode:function(e){const t=[];for(const r of e){const e=ed[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var rd=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=sd;)r[n++]=255&t|nd,t/=128;for(;t&id;)r[n++]=255&t|nd,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},nd=128,id=-128,sd=Math.pow(2,31);var od=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&cd)<<s:(n&cd)*Math.pow(2,s),s+=7}while(n>=ad);return e.bytes=o-r,i},ad=128,cd=127;var ud=Math.pow(2,7),ld=Math.pow(2,14),hd=Math.pow(2,21),dd=Math.pow(2,28),fd=Math.pow(2,35),pd=Math.pow(2,42),yd=Math.pow(2,49),gd=Math.pow(2,56),md=Math.pow(2,63),bd={encode:rd,decode:od,encodingLength:function(e){return e<ud?1:e<ld?2:e<hd?3:e<dd?4:e<fd?5:e<pd?6:e<yd?7:e<gd?8:e<md?9:10}};const wd=(e,t,r=0)=>(bd.encode(e,t,r),t),vd=e=>bd.encodingLength(e),Ed=(e,t)=>{const r=t.byteLength,n=vd(e),i=n+vd(r),s=new Uint8Array(i+r);return wd(e,s,0),wd(r,s,n),s.set(t,i),new _d(e,r,t,s)};class _d{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Ad=({name:e,code:t,encode:r})=>new Sd(e,t,r);class Sd{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ed(this.code,t):t.then((e=>Ed(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Rd=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Id=Ad({name:"sha2-256",code:18,encode:Rd("SHA-256")}),xd=Ad({name:"sha2-512",code:19,encode:Rd("SHA-512")}),Pd=vh,Cd={code:0,name:"identity",encode:Pd,digest:e=>Ed(0,Pd(e))},Td="raw",kd=85,Dd=e=>vh(e),Od=e=>vh(e),Nd=new TextEncoder,Ld=new TextDecoder,Ud="json",Md=512,Bd=e=>Nd.encode(JSON.stringify(e)),Kd=e=>JSON.parse(Ld.decode(e));new WeakMap;class $d{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==node_modules_multiformats_src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==node_modules_multiformats_src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $d.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return $d.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $d.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return node_modules_multiformats_src_cid_format(this,e)}toJSON(){return{"/":node_modules_multiformats_src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof $d)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new $d(e,r,n,i||node_modules_multiformats_src_cid_encodeCID(e,r,n.bytes))}if(!0===t[node_modules_multiformats_src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return $d.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==node_modules_multiformats_src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${node_modules_multiformats_src_cid_DAG_PB_CODE}) block encoding`);return new $d(e,t,r,r.bytes);case 1:{const n=node_modules_multiformats_src_cid_encodeCID(e,t,r.bytes);return new $d(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return $d.create(0,node_modules_multiformats_src_cid_DAG_PB_CODE,e)}static createV1(e,t){return $d.create(1,e,t)}static decode(e){const[t,r]=$d.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=$d.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?$d.createV0(s):$d.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=node_modules_multiformats_src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=node_modules_multiformats_src_cid_parseCIDtoBytes(e,t),i=$d.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return node_modules_multiformats_src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const Vd={...he,...de,...fe,...pe,...ye,...ge,...me,...be,...we,...ve};function jd(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function zd(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const qd=zd("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Fd=zd("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer?.allocUnsafe?jd(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Gd={utf8:qd,"utf-8":qd,hex:Vd.base16,latin1:Fd,ascii:Fd,binary:Fd,...Vd};const Hd="/",Wd=(new TextEncoder).encode(Hd),Yd=Wd[0];class Qd{_buf;constructor(e,t){if("string"==typeof e)this._buf=function(e,t="utf8"){const r=Gd[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):jd(globalThis.Buffer.from(e,"utf-8"))}(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==Yd)throw new Error("Invalid key")}toString(e="utf8"){return function(e,t="utf8"){const r=Gd[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Qd(e.join(Hd))}static random(){return new Qd((0,Zn.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new Qd(e):"function"==typeof e.uint8Array?new Qd(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Wd),this._buf[0]!==Yd){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Yd,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Yd;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return Qd.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Hd).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new Qd(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Hd)||(e+=Hd),e+=this.type(),new Qd(e)}parent(){const e=this.list();return 1===e.length?new Qd(Hd):new Qd(e.slice(0,-1).join(Hd))}child(e){return this.toString()===Hd?e:e.toString()===Hd?this:new Qd(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return Qd.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}const Jd="/peers/";function Zd(e){if(!(0,jn.I)(e)||null==e.type)throw new je.sv("Invalid PeerId",fh.ERR_INVALID_PARAMETERS);const t=e.toCID().toString();return new Qd(`${Jd}${t}`)}async function Xd(e,t,r){const n=new Map;for(const i of r){if(null==i)continue;if(i.multiaddr instanceof Uint8Array&&(i.multiaddr=ah(i.multiaddr)),!sh(i.multiaddr))throw new je.sv("Multiaddr was invalid",fh.ERR_INVALID_PARAMETERS);if(!await t(e,i.multiaddr))continue;const r=i.isCertified??!1,s=i.multiaddr.toString(),o=n.get(s);null!=o?i.isCertified=o.isCertified||r:n.set(s,{multiaddr:i.multiaddr,isCertified:r})}return[...n.values()].sort(((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString()))).map((({isCertified:e,multiaddr:t})=>({isCertified:e,multiaddr:t.bytes})))}async function ef(e,t,r,n){if(null==t)throw new je.sv("Invalid PeerData",fh.ERR_INVALID_PARAMETERS);if(null!=t.publicKey&&null!=e.publicKey&&!Va(t.publicKey,e.publicKey))throw new je.sv("publicKey bytes do not match peer id publicKey bytes",fh.ERR_INVALID_PARAMETERS);const i=n.existingPeer;if(null!=i&&!e.equals(i.id))throw new je.sv("peer id did not match existing peer id",fh.ERR_INVALID_PARAMETERS);let s=i?.addresses??[],o=new Set(i?.protocols??[]),a=i?.metadata??new Map,c=i?.tags??new Map,u=i?.peerRecordEnvelope;if("patch"===r){if(null==t.multiaddrs&&null==t.addresses||(s=[],null!=t.multiaddrs&&s.push(...t.multiaddrs.map((e=>({isCertified:!1,multiaddr:e})))),null!=t.addresses&&s.push(...t.addresses)),null!=t.protocols&&(o=new Set(t.protocols)),null!=t.metadata){a=tf(t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata),{validate:rf})}if(null!=t.tags){c=tf(t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),{validate:nf,map:sf})}null!=t.peerRecordEnvelope&&(u=t.peerRecordEnvelope)}if("merge"===r){if(null!=t.multiaddrs&&s.push(...t.multiaddrs.map((e=>({isCertified:!1,multiaddr:e})))),null!=t.addresses&&s.push(...t.addresses),null!=t.protocols&&(o=new Set([...o,...t.protocols])),null!=t.metadata){const e=t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata);for(const[t,r]of e)null==r?a.delete(t):a.set(t,r);a=tf([...a.entries()],{validate:rf})}if(null!=t.tags){const e=t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),r=new Map(c);for(const[t,n]of e)null==n?r.delete(t):r.set(t,n);c=tf([...r.entries()],{validate:nf,map:sf})}null!=t.peerRecordEnvelope&&(u=t.peerRecordEnvelope)}const l={addresses:await Xd(e,n.addressFilter??(async()=>!0),s),protocols:[...o.values()].sort(((e,t)=>e.localeCompare(t))),metadata:a,tags:c,publicKey:i?.id.publicKey??t.publicKey??e.publicKey,peerRecordEnvelope:u};return"RSA"!==e.type&&delete l.publicKey,l}function tf(e,t){const r=new Map;for(const[r,n]of e)null!=n&&t.validate(r,n);for(const[n,i]of e.sort((([e],[t])=>e.localeCompare(t))))null!=i&&r.set(n,t.map?.(n,i)??i);return r}function rf(e,t){if("string"!=typeof e)throw new je.sv("Metadata key must be a string",fh.ERR_INVALID_PARAMETERS);if(!(t instanceof Uint8Array))throw new je.sv("Metadata value must be a Uint8Array",fh.ERR_INVALID_PARAMETERS)}function nf(e,t){if("string"!=typeof e)throw new je.sv("Tag name must be a string",fh.ERR_INVALID_PARAMETERS);if(null!=t.value){if(parseInt(`${t.value}`,10)!==t.value)throw new je.sv("Tag value must be an integer",fh.ERR_INVALID_PARAMETERS);if(t.value<0||t.value>100)throw new je.sv("Tag value must be between 0-100",fh.ERR_INVALID_PARAMETERS)}if(null!=t.ttl){if(parseInt(`${t.ttl}`,10)!==t.ttl)throw new je.sv("Tag ttl must be an integer",fh.ERR_INVALID_PARAMETERS);if(t.ttl<0)throw new je.sv("Tag ttl must be between greater than 0",fh.ERR_INVALID_PARAMETERS)}}function sf(e,t){let r;return null!=t.expiry&&(r=t.expiry),null!=t.ttl&&(r=BigInt(Date.now()+Number(t.ttl))),{value:t.value??0,expiry:r}}function of(e,t,r){const n=e.toString().split("/")[2],i=qc(co.decode(n)),s=r.get(i);if(null!=s)return s;const o=mh(i,t);return r.set(i,o),o}class af{peerId;datastore;lock;addressFilter;constructor(e,t={}){this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=(0,dh.Z)({name:"peer-store",singleProcess:!0})}async has(e){return this.datastore.has(Zd(e))}async delete(e){if(this.peerId.equals(e))throw new je.sv("Cannot delete self peer",fh.ERR_INVALID_PARAMETERS);await this.datastore.delete(Zd(e))}async load(e){return mh(e,await this.datastore.get(Zd(e)))}async save(e,t){const{existingBuf:r,existingPeer:n}=await this.#u(e),i=await ef(e,t,"patch",{addressFilter:this.addressFilter});return this.#l(e,i,r,n)}async patch(e,t){const{existingBuf:r,existingPeer:n}=await this.#u(e),i=await ef(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:n});return this.#l(e,i,r,n)}async merge(e,t){const{existingBuf:r,existingPeer:n}=await this.#u(e),i=await ef(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:n});return this.#l(e,i,r,n)}async*all(e){const t=new Ws.ji;for await(const{key:r,value:n}of this.datastore.query(function(e,t){return null==e?{}:{prefix:Jd,filters:(e.filters??[]).map((e=>({key:r,value:n})=>e(of(r,n,t)))),orders:(e.orders??[]).map((e=>(r,n)=>e(of(r.key,r.value,t),of(n.key,n.value,t))))}}(e??{},t))){const e=of(r,n,t);e.id.equals(this.peerId)||(yield e)}}async#u(e){try{const t=await this.datastore.get(Zd(e));return{existingBuf:t,existingPeer:mh(e,t)}}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return{}}async#l(e,t,r,n){const i=ph.encode(t);return null!=r&&Va(i,r)?{peer:mh(e,i),previous:n,updated:!1}:(await this.datastore.put(Zd(e),i),{peer:mh(e,i),previous:n,updated:!0})}}const cf=function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return Vn.enabled(`${e}:trace`)&&null!=Vn.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=Vn(`${e}:trace`)),Object.assign(Vn(e),{error:Vn(`${e}:error`),trace:t})}("libp2p:peer-store");class uf{store;events;peerId;constructor(e,t={}){this.events=e.events,this.peerId=e.peerId,this.store=new af(e,t)}async forEach(e,t){cf.trace("forEach await read lock");const r=await this.store.lock.readLock();cf.trace("forEach got read lock");try{for await(const r of this.store.all(t))e(r)}finally{cf.trace("forEach release read lock"),r()}}async all(e){cf.trace("all await read lock");const t=await this.store.lock.readLock();cf.trace("all got read lock");try{return await hh(this.store.all(e))}finally{cf.trace("all release read lock"),t()}}async delete(e){cf.trace("delete await write lock");const t=await this.store.lock.writeLock();cf.trace("delete got write lock");try{await this.store.delete(e)}finally{cf.trace("delete release write lock"),t()}}async has(e){cf.trace("has await read lock");const t=await this.store.lock.readLock();cf.trace("has got read lock");try{return await this.store.has(e)}finally{cf.trace("has release read lock"),t()}}async get(e){cf.trace("get await read lock");const t=await this.store.lock.readLock();cf.trace("get got read lock");try{return await this.store.load(e)}finally{cf.trace("get release read lock"),t()}}async save(e,t){cf.trace("save await write lock");const r=await this.store.lock.writeLock();cf.trace("save got write lock");try{const r=await this.store.save(e,t);return this.#h(e,r),r.peer}finally{cf.trace("save release write lock"),r()}}async patch(e,t){cf.trace("patch await write lock");const r=await this.store.lock.writeLock();cf.trace("patch got write lock");try{const r=await this.store.patch(e,t);return this.#h(e,r),r.peer}finally{cf.trace("patch release write lock"),r()}}async merge(e,t){cf.trace("merge await write lock");const r=await this.store.lock.writeLock();cf.trace("merge got write lock");try{const r=await this.store.merge(e,t);return this.#h(e,r),r.peer}finally{cf.trace("merge release write lock"),r()}}async consumePeerRecord(e,t){const r=await Yc.openAndCertify(e,lh.DOMAIN);if(!1===t?.equals(r.peerId))return cf("envelope peer id was not the expected peer id - expected: %p received: %p",t,r.peerId),!1;const n=lh.createFromProtobuf(r.payload);let i;try{i=await this.get(r.peerId)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}if(null!=i?.peerRecordEnvelope){const e=await Yc.createFromProtobuf(i.peerRecordEnvelope),t=lh.createFromProtobuf(e.payload);if(t.seqNumber>=n.seqNumber)return cf("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,n.seqNumber),!1}return await this.patch(n.peerId,{peerRecordEnvelope:e,addresses:n.multiaddrs.map((e=>({isCertified:!0,multiaddr:e})))}),!0}#h(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}}var lf=r(59850),hf=r(92291),df=r(29124),ff=r(97858);const pf=(0,Hs.kg)("libp2p:address-manager"),yf=e=>e;function gf(e,t){const r=e.getPeerId();if(null!=r){(0,Ys.jE)(r).equals(t)&&(e=e.decapsulate((0,lf.HM)(`/p2p/${t.toString()}`)))}return e}class mf{components;listen;announce;observed;announceFilter;constructor(e,t={}){const{listen:r=[],announce:n=[]}=t;this.components=e,this.listen=r.map((e=>e.toString())),this.announce=new Set(n.map((e=>e.toString()))),this.observed=new Map,this.announceFilter=t.announceFilter??yf,this._updatePeerStoreAddresses=function(e,t){let r;return function(){clearTimeout(r),r=setTimeout((function(){r=void 0,e()}),t)}}(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",(()=>{this._updatePeerStoreAddresses()})),e.events.addEventListener("transport:close",(()=>{this._updatePeerStoreAddresses()}))}_updatePeerStoreAddresses(){const e=this.getAnnounceAddrs().concat(this.components.transportManager.getAddrs()).concat([...this.observed.entries()].filter((([e,t])=>t.confident)).map((([e])=>(0,lf.HM)(e)))).map((e=>e.getPeerId()===this.components.peerId.toString()?e.decapsulate(`/p2p/${this.components.peerId.toString()}`):e));this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch((e=>{pf.error("error updating addresses",e)}))}getListenAddrs(){return Array.from(this.listen).map((e=>(0,lf.HM)(e)))}getAnnounceAddrs(){return Array.from(this.announce).map((e=>(0,lf.HM)(e)))}getObservedAddrs(){return Array.from(this.observed).map((([e])=>(0,lf.HM)(e)))}addObservedAddr(e){const t=(e=gf(e,this.components.peerId)).toString();this.observed.has(t)||this.observed.set(t,{confident:!1})}confirmObservedAddr(e){const t=(e=gf(e,this.components.peerId)).toString(),r=(this.observed.get(t)??{confident:!1}).confident;this.observed.set(t,{confident:!0}),r||this._updatePeerStoreAddresses()}removeObservedAddr(e){const t=(e=gf(e,this.components.peerId)).toString();this.observed.delete(t)}getAddresses(){let e=this.getAnnounceAddrs().map((e=>e.toString()));0===e.length&&(e=this.components.transportManager.getAddrs().map((e=>e.toString()))),e=e.concat(Array.from(this.observed).filter((([e,t])=>t.confident)).map((([e])=>e)));const t=new Set(e);return this.announceFilter(Array.from(t).map((e=>(0,lf.HM)(e)))).map((e=>!0===e.protos().pop()?.path||e.getPeerId()===this.components.peerId.toString()?e:e.encapsulate(`/p2p/${this.components.peerId.toString()}`)))}}function bf(e){return null!=e&&"function"==typeof e.start&&"function"==typeof e.stop}class wf{components={};_started=!1;constructor(e={}){this.components={};for(const[t,r]of Object.entries(e))this.components[t]=r}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter((e=>bf(e))).map((async t=>{await(t[e]?.())})))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const vf=["metrics","connectionProtector"],Ef=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];var _f=r(53749);function Af(e={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{const t=e.stringTuples();return(4===t[0][0]||41===t[0][0])&&Boolean((0,_f.Z)(`${t[0][1]}`))},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...e}}var Sf=r(55265),Rf=r(1314);function If(e){try{const{address:t}=e.nodeAddress();return Boolean((0,_f.Z)(t))}catch{return!0}}function xf(e,t){const r=function(e,t){const r=If(e.multiaddr),n=If(t.multiaddr);return r&&!n?1:!r&&n?-1:0}(e,t);if(0!==r)return r;const n=function(e,t){const r=Rf.dx.exactMatch(e.multiaddr),n=Rf.dx.exactMatch(t.multiaddr);return r&&!n?1:!r&&n?-1:0}(e,t);if(0!==n)return n;const i=function(e,t){return e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}(e,t);return i}var Pf=r(66907),Cf=r(41309).Z;const{code:Tf}=(0,Pf.Ev)("dnsaddr");async function kf(e,t={}){const r=new Cf;null!=t.signal&&t.signal.addEventListener("abort",(()=>{r.cancel()}));const n=e.getPeerId(),[,i]=e.stringTuples().find((([e])=>e===Tf))??[];if(null==i)throw new Error("No hostname found in multiaddr");let s=(await r.resolveTxt(`_dnsaddr.${i}`)).flat().map((e=>e.split("=")[1])).filter(Boolean);return null!=n&&(s=s.filter((e=>e.includes(n)))),s}var Df=r(64188);const Of={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{resolvers:{dnsaddr:kf},addressSorter:xf},transportManager:{faultTolerance:Sf.P7.FATAL_ALL}};var Nf=r(60644);const Lf=(0,Hs.kg)("libp2p:get-peer");function Uf(e){if((0,jn.I)(e))return{peerId:e,multiaddrs:[]};let t;if(Array.isArray(e)||(e=[e]),e.length>0){const r=e[0].getPeerId();t=null==r?void 0:(0,Ys.jE)(r),e.forEach((e=>{if(!(0,lf.h2)(e))throw Lf.error("multiaddr %s was invalid",e),new je.sv("Invalid Multiaddr",Df.q.ERR_INVALID_MULTIADDR);const r=e.getPeerId();if(null==r){if(null!=t)throw new je.sv("Multiaddrs must all have the same peer id or have no peer id",Df.q.ERR_INVALID_PARAMETERS)}else{const e=(0,Ys.jE)(r);if(null==t||!t.equals(e))throw new je.sv("Multiaddrs must all have the same peer id or have no peer id",Df.q.ERR_INVALID_PARAMETERS)}}))}return{peerId:t,multiaddrs:e}}var Mf=r(2291),Bf=r(95554),Kf=r(12229);const $f="last-dial-failure",Vf=(0,Hs.kg)("libp2p:connection-manager:auto-dial"),jf={minConnections:Kf.iA,maxQueueLength:100,autoDialConcurrency:25,autoDialPriority:0,autoDialInterval:5e3,autoDialPeerRetryThreshold:Kf.Oq,autoDialDiscoveredPeersDebounce:10};class zf{connectionManager;peerStore;queue;minConnections;autoDialPriority;autoDialIntervalMs;autoDialMaxQueueLength;autoDialPeerRetryThresholdMs;autoDialDiscoveredPeersDebounce;autoDialInterval;started;running;constructor(e,t){let r;this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.minConnections=t.minConnections??jf.minConnections,this.autoDialPriority=t.autoDialPriority??jf.autoDialPriority,this.autoDialIntervalMs=t.autoDialInterval??jf.autoDialInterval,this.autoDialMaxQueueLength=t.maxQueueLength??jf.maxQueueLength,this.autoDialPeerRetryThresholdMs=t.autoDialPeerRetryThreshold??jf.autoDialPeerRetryThreshold,this.autoDialDiscoveredPeersDebounce=t.autoDialDiscoveredPeersDebounce??jf.autoDialDiscoveredPeersDebounce,this.started=!1,this.running=!1,this.queue=new Bf.m({concurrency:t.autoDialConcurrency??jf.autoDialConcurrency}),this.queue.addListener("error",(e=>{Vf.error("error during auto-dial",e)})),e.events.addEventListener("connection:close",(()=>{this.autoDial().catch((e=>{Vf.error(e)}))})),e.events.addEventListener("peer:discovery",(()=>{clearTimeout(r),r=setTimeout((()=>{this.autoDial().catch((e=>{Vf.error(e)}))}),this.autoDialDiscoveredPeersDebounce)}))}isStarted(){return this.started}start(){this.autoDialInterval=setTimeout((()=>{this.autoDial().catch((e=>{Vf.error("error while autodialing",e)}))}),this.autoDialIntervalMs),this.started=!0}afterStart(){this.autoDial().catch((e=>{Vf.error("error while autodialing",e)}))}stop(){this.queue.clear(),clearTimeout(this.autoDialInterval),this.started=!1,this.running=!1}async autoDial(){if(!this.started)return;const e=this.connectionManager.getConnectionsMap(),t=e.size;if(t>=this.minConnections)return void(this.minConnections>0&&Vf.trace("have enough connections %d/%d",t,this.minConnections));if(this.queue.size>this.autoDialMaxQueueLength)return void Vf("not enough connections %d/%d but auto dial queue is full",t,this.minConnections);if(this.running)return void Vf("not enough connections %d/%d - but skipping autodial as it is already running",t,this.minConnections);this.running=!0,Vf("not enough connections %d/%d - will dial peers to increase the number of connections",t,this.minConnections);const r=new Ws.fd(this.connectionManager.getDialQueue().map((e=>e.peerId)).filter(Boolean)),n=await this.peerStore.all({filters:[t=>0===t.addresses.length?(Vf.trace("not autodialing %p because they have no addresses",t.id),!1):e.has(t.id)?(Vf.trace("not autodialing %p because they are already connected",t.id),!1):r.has(t.id)?(Vf.trace("not autodialing %p because they are already being dialed",t.id),!1):!this.queue.hasJob(t.id)||(Vf.trace("not autodialing %p because they are already being autodialed",t.id),!1)]}),i=n.sort((()=>Math.random()>.5?1:-1)),s=new Ws.ji;for(const e of i)s.has(e.id)||s.set(e.id,[...e.tags.values()].reduce(((e,t)=>e+t.value),0));const o=i.sort(((e,t)=>{const r=s.get(e.id)??0,n=s.get(t.id)??0;return r>n?-1:r<n?1:0})).filter((e=>{const t=e.metadata.get($f);if(null==t)return!0;const r=parseInt((0,Mf.B)(t));return!!isNaN(r)||Date.now()-r>this.autoDialPeerRetryThresholdMs}));Vf("selected %d/%d peers to dial",o.length,n.length);for(const e of o)this.queue.add((async()=>{const t=this.connectionManager.getConnectionsMap().size;if(t>=this.minConnections)return Vf("got enough connections now %d/%d",t,this.minConnections),void this.queue.clear();Vf("connecting to a peerStore stored peer %p",e.id),await this.connectionManager.openConnection(e.id,{priority:this.autoDialPriority})}),{peerId:e.id}).catch((e=>{Vf.error("could not connect to peerStore stored peer",e)}));this.running=!1,this.started&&(this.autoDialInterval=setTimeout((()=>{this.autoDial().catch((e=>{Vf.error("error while autodialing",e)}))}),this.autoDialIntervalMs))}}const qf=(0,Hs.kg)("libp2p:connection-manager:connection-pruner"),Ff={maxConnections:Kf.aX,allow:[]};class Gf{maxConnections;connectionManager;peerStore;allow;events;constructor(e,t={}){this.maxConnections=t.maxConnections??Ff.maxConnections,this.allow=t.allow??Ff.allow,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,e.events.addEventListener("connection:open",(()=>{this.maybePruneConnections().catch((e=>{qf.error(e)}))}))}async maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length,r=Math.max(t-this.maxConnections,0);if(qf("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;qf("max connections limit exceeded %d/%d, pruning %d connection(s)",t,this.maxConnections,r);const n=new Ws.ji;for(const t of e){const e=t.remotePeer;if(!n.has(e)){n.set(e,0);try{const t=await this.peerStore.get(e);n.set(e,[...t.tags.values()].reduce(((e,t)=>e+t.value),0))}catch(e){"ERR_NOT_FOUND"!==e.code&&qf.error("error loading peer tags",e)}}}const i=e.sort(((e,t)=>{const r=n.get(e.remotePeer)??0,i=n.get(t.remotePeer)??0;if(r>i)return 1;if(r<i)return-1;const s=e.timeline.open,o=t.timeline.open;return s<o?1:s>o?-1:0})),s=[];for(const e of i){qf("too many connections open - closing a connection to %p",e.remotePeer);if(this.allow.some((t=>e.remoteAddr.toString().startsWith(t.toString())))||s.push(e),s.length===r)break}await Promise.all(s.map((async e=>{try{await e.close()}catch(e){qf.error(e)}}))),this.events.safeDispatchEvent("connection:prune",{detail:s})}}function Hf(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e){if(!0===t?.aborted){r();break}null!=t?.addEventListener&&t.addEventListener("abort",r)}const n=t.signal;return n.clear=function(){for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)},n}var Wf=r(85275),Yf=r(9398);const Qf=(0,Hs.kg)("libp2p:connection-manager:utils");async function Jf(e,t){if(!e.protoNames().includes("dnsaddr"))return[e];const r=await async function(e,t){try{e=(0,lf.HM)(e.toString());return await e.resolve(t)}catch(t){return Qf.error(`multiaddr ${e.toString()} could not be resolved`,t),[]}}(e,t),n=(await Promise.all(r.map((async e=>Jf(e,t))))).flat().reduce(((e,t)=>(null==e.find((e=>e.equals(t)))&&e.push(t),e)),[]);return Qf("resolved %s to",e,n.map((e=>e.toString()))),n}const Zf=(0,Hs.kg)("libp2p:connection-manager:dial-queue"),Xf={addressSorter:xf,maxParallelDials:Kf.Ui,maxPeerAddrsToDial:25,maxParallelDialsPerPeer:1,dialTimeout:3e4,resolvers:{dnsaddr:kf}};class ep{pendingDials;queue;peerId;peerStore;connectionGater;transportManager;addressSorter;maxPeerAddrsToDial;maxParallelDialsPerPeer;dialTimeout;inProgressDialCount;pendingDialCount;shutDownController;constructor(e,t={}){this.addressSorter=t.addressSorter??Xf.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??Xf.maxPeerAddrsToDial,this.maxParallelDialsPerPeer=t.maxParallelDialsPerPeer??Xf.maxParallelDialsPerPeer,this.dialTimeout=t.dialTimeout??Xf.dialTimeout,this.peerId=e.peerId,this.peerStore=e.peerStore,this.connectionGater=e.connectionGater,this.transportManager=e.transportManager,this.shutDownController=new AbortController;try{(0,Ke.setMaxListeners)?.(1/0,this.shutDownController.signal)}catch{}this.pendingDialCount=e.metrics?.registerMetric("libp2p_dialler_pending_dials"),this.inProgressDialCount=e.metrics?.registerMetric("libp2p_dialler_in_progress_dials"),this.pendingDials=[];for(const[e,r]of Object.entries(t.resolvers??{}))lf.s_.set(e,r);this.queue=new Yf.Z({concurrency:t.maxParallelDials??Xf.maxParallelDials}),this.queue.on("add",(()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)})),this.queue.on("active",(()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)})),this.queue.on("completed",(()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)})),this.queue.on("error",(e=>{Zf.error("error in dial queue",e),this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)})),this.queue.on("empty",(()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)})),this.queue.on("idle",(()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}))}stop(){this.shutDownController.abort()}async dial(e,t={}){const{peerId:r,multiaddrs:n}=Uf(e),i=n.map((e=>({multiaddr:e,isCertified:!1}))),s=this.createDialAbortControllers(t.signal);let o;try{o=await this.calculateMultiaddrs(r,i,{...t,signal:s})}catch(e){throw s.clear(),e}const a=this.pendingDials.find((e=>!(null==e.peerId||null==r||!e.peerId.equals(r))||o.map((({multiaddr:e})=>e.toString())).join()===e.multiaddrs.map((e=>e.toString())).join()));if(null!=a)return Zf("joining existing dial target for %p",r),s.clear(),a.promise;Zf("creating dial target for",o.map((({multiaddr:e})=>e.toString())));const c={id:`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,status:"queued",peerId:r,multiaddrs:o.map((({multiaddr:e})=>e))};return c.promise=this.performDial(c,{...t,signal:s}).finally((()=>{this.pendingDials=this.pendingDials.filter((e=>e.id!==c.id)),s.clear()})).catch((async e=>{if(Zf.error("dial failed to %s",c.multiaddrs.map((e=>e.toString())).join(", "),e),null!=r)try{await this.peerStore.patch(r,{metadata:{[$f]:(0,ff.m)(Date.now().toString())}})}catch(e){Zf.error("could not update last dial failure key for %p",r,e)}if(s.aborted){throw new je.sv(e.message,Df.q.ERR_TIMEOUT)}throw e})),this.pendingDials.push(c),c.promise}createDialAbortControllers(e){const t=Hf([AbortSignal.timeout(this.dialTimeout),this.shutDownController.signal,e]);try{(0,Ke.setMaxListeners)?.(1/0,t)}catch{}return t}async calculateMultiaddrs(e,t=[],r={}){if(null!=e){if(this.peerId.equals(e))throw new je.sv("Tried to dial self",Df.q.ERR_DIALED_SELF);if(!0===await(this.connectionGater.denyDialPeer?.(e)))throw new je.sv("The dial request is blocked by gater.allowDialPeer",Df.q.ERR_PEER_DIAL_INTERCEPTED);if(0===t.length){Zf("loading multiaddrs for %p",e);try{const r=await this.peerStore.get(e);t.push(...r.addresses),Zf("loaded multiaddrs for %p",e,t.map((({multiaddr:e})=>e.toString())))}catch(e){if(e.code!==Df.q.ERR_NOT_FOUND)throw e}}}const n=(await Promise.all(t.map((async e=>{const t=await Jf(e.multiaddr,r);return 1===t.length&&t[0].equals(e.multiaddr)?e:t.map((e=>({multiaddr:e,isCertified:!1})))})))).flat(),i=n.filter((t=>{if(null==this.transportManager.transportForMultiaddr(t.multiaddr))return!1;const r=t.multiaddr.getPeerId();return null==e||null==r||e.equals(r)})),s=new Map;for(const e of i){const t=e.multiaddr.toString(),r=s.get(t);null==r?s.set(t,e):r.isCertified=r.isCertified||e.isCertified||!1}let o=[...s.values()];if((0===o.length||o.length>this.maxPeerAddrsToDial)&&(Zf("addresses for %p before filtering",e??"unknown peer",n.map((({multiaddr:e})=>e.toString()))),Zf("addresses for %p after filtering",e??"unknown peer",o.map((({multiaddr:e})=>e.toString())))),0===o.length)throw new je.sv("The dial request has no valid addresses",Df.q.ERR_NO_VALID_ADDRESSES);if(o.length>this.maxPeerAddrsToDial)throw new je.sv("dial with more addresses than allowed",Df.q.ERR_TOO_MANY_ADDRESSES);if(null!=e){const t=`/p2p/${e.toString()}`;o=o.map((r=>{const n=r.multiaddr.getPeerId(),i=r.multiaddr.protos().pop();return!0===i?.path?r:n!==e.toString()?{multiaddr:r.multiaddr.encapsulate(t),isCertified:r.isCertified}:r}))}const a=[];for(const e of o)null!=this.connectionGater.denyDialMultiaddr&&await this.connectionGater.denyDialMultiaddr(e.multiaddr)||a.push(e);const c=a.sort(this.addressSorter);if(0===c.length)throw new je.sv("The connection gater denied all addresses in the dial request",Df.q.ERR_NO_VALID_ADDRESSES);return c}async performDial(e,t={}){const r=e.multiaddrs.map((()=>new AbortController));try{const n=new Yf.Z({concurrency:this.maxParallelDialsPerPeer});n.on("error",(e=>{Zf.error("error dialling",e)}));const i=await Promise.any(e.multiaddrs.map((async(i,s)=>{const o=r[s];if(null==o)throw new je.sv("dialAction did not come with an AbortController",Df.q.ERR_INVALID_PARAMETERS);const a=function(...e){const t=[];for(const r of e)if(null!=r){try{(0,Ke.setMaxListeners)?.(1/0,r)}catch{}t.push(r)}const r=Hf(t);try{(0,Ke.setMaxListeners)?.(1/0,r)}catch{}return r}(o.signal,t.signal);a.addEventListener("abort",(()=>{Zf("dial to %a aborted",i)}));const c=(0,Wf.Z)();return await n.add((async()=>{if(a.aborted)return Zf("dial to %a was aborted before reaching the head of the peer dial queue",i),void c.reject(new je._L);await this.queue.add((async()=>{try{if(a.aborted)return Zf("dial to %a was aborted before reaching the head of the dial queue",i),void c.reject(new je._L);e.status="active";const n=await this.transportManager.dial(i,{...t,signal:a});if(o.signal.aborted)return Zf("multiple dials succeeded, closing superfluous connection"),n.close().catch((e=>{Zf.error("error closing superfluous connection",e)})),void c.reject(new je._L);r[s]=void 0,r.forEach((e=>{void 0!==e&&e.abort()})),Zf("dial to %a succeeded",i),c.resolve(n)}catch(e){Zf.error("error during dial of %a",i,e),c.reject(e)}}),{...t,signal:a}).catch((e=>{c.reject(e)}))}),{signal:a}).catch((e=>{c.reject(e)})).finally((()=>{a.clear()})),c.promise})));if(null==i)throw new je.sv("successful dial led to empty object returned from peer dial queue",Df.q.ERR_TRANSPORT_DIAL_FAILED);return e.status="success",i}catch(t){if(e.status="error",1===e.multiaddrs.length&&"AggregateError"===t.name)throw t.errors[0];throw t}}}const tp=(0,Hs.kg)("libp2p:connection-manager"),rp={minConnections:Kf.iA,maxConnections:Kf.aX,inboundConnectionThreshold:5,maxIncomingPendingConnections:10,autoDialConcurrency:25,autoDialPriority:0,autoDialMaxQueueLength:100};class np{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;maxConnections;dialQueue;autoDial;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;constructor(e,t={}){this.maxConnections=t.maxConnections??rp.maxConnections;const r=t.minConnections??rp.minConnections;if(this.maxConnections<r)throw new je.sv("Connection Manager maxConnections must be greater than minConnections",Df.q.ERR_INVALID_PARAMETERS);this.connections=new Ws.ji,this.started=!1,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),this.allow=(t.allow??[]).map((e=>(0,lf.HM)(e))),this.deny=(t.deny??[]).map((e=>(0,lf.HM)(e))),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??rp.maxIncomingPendingConnections,this.inboundConnectionRateLimiter=new Nf.RateLimiterMemory({points:t.inboundConnectionThreshold??rp.inboundConnectionThreshold,duration:1}),this.autoDial=new zf({connectionManager:this,peerStore:e.peerStore,events:e.events},{minConnections:r,autoDialConcurrency:t.autoDialConcurrency??rp.autoDialConcurrency,autoDialPriority:t.autoDialPriority??rp.autoDialPriority,maxQueueLength:t.autoDialMaxQueueLength??rp.autoDialMaxQueueLength}),this.connectionPruner=new Gf({connectionManager:this,peerStore:e.peerStore,events:e.events},{maxConnections:this.maxConnections,allow:this.allow}),this.dialQueue=new ep({peerId:e.peerId,metrics:e.metrics,peerStore:e.peerStore,transportManager:e.transportManager,connectionGater:e.connectionGater},{addressSorter:t.addressSorter??xf,maxParallelDials:t.maxParallelDials??Kf.Ui,maxPeerAddrsToDial:t.maxPeerAddrsToDial??25,maxParallelDialsPerPeer:t.maxParallelDialsPerPeer??1,dialTimeout:t.dialTimeout??3e4,resolvers:t.resolvers??{dnsaddr:kf}})}isStarted(){return this.started}async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,outbound:0};for(const t of this.connections.values())for(const r of t)"inbound"===r.direction?e.inbound++:e.outbound++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const r of t)for(const t of r.streams){const r=`${t.direction} ${t.protocol??"unnegotiated"}`;e[r]=(e[r]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const r of t){const t={};for(const e of r.streams){const r=`${e.direction} ${e.protocol??"unnegotiated"}`;t[r]=(t[r]??0)+1}for(const[r,n]of Object.entries(t))e[r]=e[r]??[],e[r].push(n)}const t={};for(let[r,n]of Object.entries(e)){n=n.sort(((e,t)=>e-t));const e=Math.floor(.9*n.length);t[r]=n[e]}return t}}),this.autoDial.start(),this.started=!0,tp("started")}async afterStart(){Promise.resolve().then((async()=>{const e=await this.peerStore.all({filters:[e=>e.tags.has("keep-alive")]});await Promise.all(e.map((async e=>{await this.openConnection(e.id).catch((e=>{tp.error(e)}))})))})).catch((e=>{tp.error(e)})),this.autoDial.afterStart()}async stop(){this.dialQueue.stop(),this.autoDial.stop();const e=[];for(const t of this.connections.values())for(const r of t)e.push((async()=>{try{await r.close()}catch(e){tp.error(e)}})());tp("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),tp("stopped")}onConnect(e){this._onConnect(e).catch((e=>{tp.error(e)}))}async _onConnect(e){const{detail:t}=e;if(!this.started)return void await t.close();const r=t.remotePeer,n=this.connections.get(r);let i=!1;null!=n?n.push(t):(i=!0,this.connections.set(r,[t])),null!=r.publicKey&&"RSA"===r.type&&await this.peerStore.patch(r,{publicKey:r.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e;if(!this.started)return;const r=t.remotePeer;let n=this.connections.get(r);null!=n&&n.length>1?(n=n.filter((e=>e.id!==t.id)),this.connections.set(r,n)):null!=n&&(this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(null!=e)return this.connections.get(e)??[];let t=[];for(const e of this.connections.values())t=t.concat(e);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.isStarted())throw new je.sv("Not started",Df.q.ERR_NODE_NOT_STARTED);t.signal?.throwIfAborted();const{peerId:r}=Uf(e);if(null!=r&&!0!==t.force){tp("dial %p",r);const e=this.getConnections(r);if(e.length>0)return tp("had an existing connection to %p",r),e[0]}const n=await this.dialQueue.dial(e,{...t,priority:t.priority??50});let i=this.connections.get(n.remotePeer);null==i&&(i=[],this.connections.set(n.remotePeer,i));let s=!1;for(const e of i)e.id===n.id&&(s=!0);return s||i.push(n),n}async closeConnections(e,t={}){const r=this.connections.get(e)??[];await Promise.all(r.map((async e=>{try{await e.close(t)}catch(t){e.abort(t)}})))}async acceptIncomingConnection(e){if(this.deny.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return tp("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return tp("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return tp("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,t),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(tp("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){return this.dialQueue.pendingDials}}class ip{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class sp{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new ip(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new ip(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}class op extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function ap(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new sp,a=(0,Wf.Z)();const c=e=>null!=n?n(e):(o.push(e),r),u=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},l=e=>i?r:(i=!0,null!=e?(e=>(o=new sp,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,Wf.Z)()}))}},return:()=>(o=new sp,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:u,end:l,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new op)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==s)return r;const h=r;return r={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(h.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(h.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return h.readableLength}},r}var cp=function(...e){const t=[];for(const r of e)null==r[Symbol.asyncIterator]&&t.push(r);return t.length===e.length?function*(){for(const e of t)yield*e}():async function*(){const t=function(e={}){return ap((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}})),yield*t}()},up=r(32629),lp=r(75671);var hp=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,lp.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const s=t(n);if("function"==typeof s.then)return async function*(){await s&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===s&&(yield n);for(const e of r)o(e)&&(yield e)}()},dp=r(34880);async function*fp(e,t){yield*(0,dp.Z)(e,(async e=>(await t.merge(e.id,{multiaddrs:e.multiaddrs}),e)))}function pp(e){const t=new Set;return hp(e,(e=>!t.has(e.id.toString())&&(t.add(e.id.toString()),!0)))}async function*yp(e,t=1){let r=0;for await(const t of e)r++,yield t;if(r<t)throw new je.sv(`more peers required, seen: ${r}  min: ${t}`,"NOT_FOUND")}class gp{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(0===this.routers.length)throw new je.sv("No content routers available",Df.q.ERR_NO_ROUTERS_AVAILABLE);yield*(0,up.z)(cp(...this.routers.map((r=>r.findProviders(e,t)))),(e=>fp(e,this.components.peerStore)),(e=>pp(e)),(e=>yp(e)))}async provide(e,t={}){if(0===this.routers.length)throw new je.sv("No content routers available",Df.q.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map((async r=>{await r.provide(e,t)})))}async put(e,t,r){if(!this.isStarted())throw new je.sv(Df.s.NOT_STARTED_YET,Df.q.DHT_NOT_STARTED);await Promise.all(this.routers.map((async n=>{await n.put(e,t,r)})))}async get(e,t){if(!this.isStarted())throw new je.sv(Df.s.NOT_STARTED_YET,Df.q.DHT_NOT_STARTED);return Promise.any(this.routers.map((async r=>r.get(e,t))))}}var mp=r(31650);const bp=(0,Hs.kg)("libp2p:peer-routing");class wp{components;routers;constructor(e,t){this.components=e,this.routers=t.routers??[]}async findPeer(e,t){if(0===this.routers.length)throw new je.sv("No peer routers available",Df.q.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw new je.sv("Should not try to find self",Df.q.ERR_FIND_SELF);const r=await(0,up.z)(cp(...this.routers.map((r=>async function*(){try{yield await r.findPeer(e,t)}catch(e){bp.error(e)}}()))),(e=>hp(e,Boolean)),(e=>fp(e,this.components.peerStore)),(async e=>(0,mp.Z)(e)));if(null!=r)return r;throw new je.sv(Df.s.NOT_FOUND,Df.q.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(0===this.routers.length)throw new je.sv("No peer routers available",Df.q.ERR_NO_ROUTERS_AVAILABLE);yield*(0,up.z)(cp(...this.routers.map((r=>r.getClosestPeers(e,t)))),(e=>fp(e,this.components.peerStore)),(e=>pp(e)),(e=>yp(e)))}}const vp=(0,Hs.kg)("libp2p:registrar");class Ep{topologies;handlers;components;constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onConnect=this._onConnect.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:connect",this._onConnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(null==t)throw new je.sv(`No handler registered for protocol ${e}`,Df.q.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){const t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e))throw new je.sv(`Handler already registered for protocol ${e}`,Df.q.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const n=Os.Z.bind({ignoreUndefined:!0})({maxInboundStreams:32,maxOutboundStreams:64},r);this.handlers.set(e,{handler:t,options:n}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach((e=>{this.handlers.delete(e)})),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(null==t)throw new je.sv("invalid topology",Df.q.ERR_INVALID_PARAMETERS);const r=`${(1e9*Math.random()).toString(36)}${Date.now()}`;let n=this.topologies.get(e);return null==n&&(n=new Map,this.topologies.set(e,n)),n.set(r,t),r}unregister(e){for(const[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),0===r.size&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then((e=>{for(const r of e.protocols){const e=this.topologies.get(r);if(null!=e)for(const r of e.values())r.onDisconnect?.(t)}})).catch((e=>{e.code!==Df.q.ERR_NOT_FOUND&&vp.error("could not inform topologies of disconnecting peer %p",t,e)}))}_onConnect(e){const t=e.detail;this.components.peerStore.get(t).then((e=>{const r=this.components.connectionManager.getConnections(e.id)[0];if(null!=r)for(const n of e.protocols){const e=this.topologies.get(n);if(null!=e)for(const n of e.values())n.onConnect?.(t,r)}else vp("peer %p connected but the connection manager did not have a connection",e)})).catch((e=>{e.code!==Df.q.ERR_NOT_FOUND&&vp.error("could not inform topologies of connecting peer %p",t,e)}))}_onPeerUpdate(e){const{peer:t,previous:r}=e.detail,n=(r?.protocols??[]).filter((e=>!t.protocols.includes(e))),i=t.protocols.filter((e=>!(r?.protocols??[]).includes(e)));for(const e of n){const r=this.topologies.get(e);if(null!=r)for(const e of r.values())e.onDisconnect?.(t.id)}for(const e of i){const r=this.topologies.get(e);if(null!=r)for(const e of r.values()){const r=this.components.connectionManager.getConnections(t.id)[0];null!=r&&e.onConnect?.(t.id,r)}}}}var _p=r(40480);const Ap=(0,Hs.kg)("libp2p:transports");class Sp{components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.components=e,this.started=!1,this.transports=new Map,this.listeners=(0,_p.s)({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Sf.P7.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(null==t)throw new je.sv("Transport must have a valid tag",Df.q.ERR_INVALID_KEY);if(this.transports.has(t))throw new je.sv(`There is already a transport with the tag ${t}`,Df.q.ERR_DUPLICATE_TRANSPORT);Ap("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,r]of this.listeners)for(Ap("closing listeners for %s",t);r.length>0;){const t=r.pop();null!=t&&e.push(t.close())}await Promise.all(e),Ap("all listeners closed");for(const e of this.listeners.keys())this.listeners.set(e,[]);this.started=!1}async dial(e,t){const r=this.transportForMultiaddr(e);if(null==r)throw new je.sv(`No transport available for address ${String(e)}`,Df.q.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(e,{...t,upgrader:this.components.upgrader})}catch(e){throw null==e.code&&(e.code=Df.q.ERR_TRANSPORT_DIAL_FAILED),e}}getAddrs(){let e=[];for(const t of this.listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}transportForMultiaddr(e){for(const t of this.transports.values()){if(t.filter([e]).length>0)return t}}async listen(e){if(!this.isStarted())throw new je.sv("Not started",Df.q.ERR_NODE_NOT_STARTED);if(null==e||0===e.length)return void Ap("no addresses were provided for listening, this node is dial only");const t=[];for(const[r,n]of this.transports.entries()){const i=n.filter(e),s=[];for(const e of i){Ap("creating listener for %s on %a",r,e);const t=n.createListener({upgrader:this.components.upgrader});let i=this.listeners.get(r)??[];null==i&&(i=[],this.listeners.set(r,i)),i.push(t),t.addEventListener("listening",(()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:t})})),t.addEventListener("close",(()=>{const e=i.findIndex((e=>e===t));i.splice(e,1),this.components.events.safeDispatchEvent("transport:close",{detail:t})})),s.push(t.listen(e))}if(0===s.length){t.push(r);continue}if(null==(await Promise.allSettled(s)).find((e=>"fulfilled"===e.status))&&this.faultTolerance!==Sf.P7.NO_FATAL)throw new je.sv(`Transport (${r}) could not listen on any available address`,Df.q.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){const e=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===Sf.P7.FATAL_ALL)throw new je.sv(e,Df.q.ERR_NO_VALID_ADDRESSES);Ap(`libp2p in dial mode only: ${e}`)}}async remove(e){const t=this.listeners.get(e)??[];Ap.trace("removing transport %s",e);const r=[];for(Ap.trace("closing listeners for %s",e);t.length>0;){const e=t.pop();null!=e&&r.push(e.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const Rp="/multistream/1.0.0",Ip=1024;var xp=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},Pp=xp;new Uint8Array(0);const Cp=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Tp{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class kp{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Op(this,e)}}class Dp{constructor(e){this.decoders=e}or(e){return Op(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Op=(e,t)=>new Dp({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Np{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Tp(e,t,r),this.decoder=new kp(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Lp=({name:e,prefix:t,encode:r,decode:n})=>new Np(e,t,r,n),Up=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=Pp(r,t);return Lp({prefix:e,name:t,encode:n,decode:e=>Cp(i(e))})},Mp=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Lp({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),Bp=Mp({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Kp=Mp({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$p=Mp({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Vp=Mp({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jp=Mp({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zp=Mp({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qp=Mp({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fp=Mp({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Gp=Mp({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Hp=Up({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Wp=Up({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Yp=Mp({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qp=Mp({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jp=Mp({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Zp=Mp({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Xp(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return Vn.enabled(`${e}:trace`)&&null!=Vn.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=Vn(`${e}:trace`)),Object.assign(Vn(e),{error:Vn(`${e}:error`),trace:t})}Vn.formatters.b=e=>null==e?"undefined":Hp.baseEncode(e),Vn.formatters.t=e=>null==e?"undefined":Bp.baseEncode(e),Vn.formatters.m=e=>null==e?"undefined":Yp.baseEncode(e),Vn.formatters.p=e=>null==e?"undefined":e.toString(),Vn.formatters.c=e=>null==e?"undefined":e.toString(),Vn.formatters.k=e=>null==e?"undefined":e.toString(),Vn.formatters.a=e=>null==e?"undefined":e.toString();var ey=r(93489);class ty{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class ry{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new ty(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new ty(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}function ny(e,t){let r,n,i,s=(t=t??{}).onEnd,o=new ry;const a=e=>null!=n?n(e):(o.push(e),r),c=e=>{if(i)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return a({done:!1,value:e})},u=e=>i?r:(i=!0,null!=e?(e=>(o=new ry,null!=n?n({error:e}):(o.push({error:e}),r)))(e):a({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{n=s=>{n=null,o.push(s);try{t(e(o))}catch(e){i(e)}return r}})):e(o),return:()=>(o=new ry,u(),{done:!0}),throw:e=>(u(e),{done:!0}),push:c,end:u,get readableLength(){return o.size}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:c,end:e=>(l.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return l.readableLength}},r}function iy(e){const t=function(e={}){return ny((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}(),r=(0,ey.r)(e.source),n=(0,Wf.Z)();let i;const s=e.sink(async function*(){yield*t;const e=await n.promise;yield*e}());s.catch((e=>{i=e}));return{reader:r,writer:t,stream:{sink:async e=>{null==i?(n.resolve(e),await s):await Promise.reject(i)},source:r},rest:()=>t.end(),write:t.push,read:async()=>{const e=await r.next();if(null!=e.value)return e.value}}}class sy extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function oy(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}const ay=Up({prefix:"9",name:"base10",alphabet:"0123456789"}),cy=Mp({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uy=Mp({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ly=Mp({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),hy=Array.from(""),dy=hy.reduce(((e,t,r)=>(e[r]=t,e)),[]),fy=hy.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const py=Lp({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=dy[t]),"")},decode:function(e){const t=[];for(const r of e){const e=fy[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}}),yy=Up({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gy=Up({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),my=Mp({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),by=Lp({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),wy=new TextEncoder,vy=new TextDecoder,Ey="json",_y=512,Ay=e=>wy.encode(JSON.stringify(e)),Sy=e=>JSON.parse(vy.decode(e)),Ry="raw",Iy=85,xy=e=>Cp(e),Py=e=>Cp(e);var Cy=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=Dy;)r[n++]=255&t|Ty,t/=128;for(;t&ky;)r[n++]=255&t|Ty,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},Ty=128,ky=-128,Dy=Math.pow(2,31);var Oy=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&Ly)<<s:(n&Ly)*Math.pow(2,s),s+=7}while(n>=Ny);return e.bytes=o-r,i},Ny=128,Ly=127;var Uy=Math.pow(2,7),My=Math.pow(2,14),By=Math.pow(2,21),Ky=Math.pow(2,28),$y=Math.pow(2,35),Vy=Math.pow(2,42),jy=Math.pow(2,49),zy=Math.pow(2,56),qy=Math.pow(2,63),Fy={encode:Cy,decode:Oy,encodingLength:function(e){return e<Uy?1:e<My?2:e<By?3:e<Ky?4:e<$y?5:e<Vy?6:e<jy?7:e<zy?8:e<qy?9:10}};const Gy=(e,t,r=0)=>(Fy.encode(e,t,r),t),Hy=e=>Fy.encodingLength(e),Wy=(e,t)=>{const r=t.byteLength,n=Hy(e),i=n+Hy(r),s=new Uint8Array(i+r);return Gy(e,s,0),Gy(r,s,n),s.set(t,i),new Yy(e,r,t,s)};class Yy{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Qy=Cp,Jy={code:0,name:"identity",encode:Qy,digest:e=>Wy(0,Qy(e))},Zy=({name:e,code:t,encode:r})=>new Xy(e,t,r);class Xy{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Wy(this.code,t):t.then((e=>Wy(this.code,e)))}throw Error("Unknown type, must be binary type")}}const eg=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),tg=Zy({name:"sha2-256",code:18,encode:eg("SHA-256")}),rg=Zy({name:"sha2-512",code:19,encode:eg("SHA-512")});new WeakMap;class ng{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==multistream_select_node_modules_multiformats_src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==multistream_select_node_modules_multiformats_src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ng.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return ng.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return ng.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return multistream_select_node_modules_multiformats_src_cid_format(this,e)}toJSON(){return{"/":multistream_select_node_modules_multiformats_src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof ng)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new ng(e,r,n,i||multistream_select_node_modules_multiformats_src_cid_encodeCID(e,r,n.bytes))}if(!0===t[multistream_select_node_modules_multiformats_src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return ng.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==multistream_select_node_modules_multiformats_src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${multistream_select_node_modules_multiformats_src_cid_DAG_PB_CODE}) block encoding`);return new ng(e,t,r,r.bytes);case 1:{const n=multistream_select_node_modules_multiformats_src_cid_encodeCID(e,t,r.bytes);return new ng(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return ng.create(0,multistream_select_node_modules_multiformats_src_cid_DAG_PB_CODE,e)}static createV1(e,t){return ng.create(1,e,t)}static decode(e){const[t,r]=ng.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=ng.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?ng.createV0(s):ng.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=multistream_select_node_modules_multiformats_src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=multistream_select_node_modules_multiformats_src_cid_parseCIDtoBytes(e,t),i=ng.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return multistream_select_node_modules_multiformats_src_cid_baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const ig={...Ne,...Te,...Oe,...Pe,...Ce,...Re,...De,...Ie,...xe,...ke};function sg(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const og=sg("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),ag=sg("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=function(e=0){return null!=globalThis.Buffer?.allocUnsafe?oy(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var cg={utf8:og,"utf-8":og,hex:ig.base16,latin1:ag,ascii:ag,binary:ag,...ig};function ug(e,t="utf8"){const r=cg[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):oy(globalThis.Buffer.from(e,"utf-8"))}class lg extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function hg(e,t,r){const n=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const s=()=>{null!=r&&r()};for(t.addEventListener("abort",s);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new lg(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new lg(e,r))}}));o=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",s);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",s)}()}var dg=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t},fg=r(9202);const pg=Xp("libp2p:mss"),yg=ug("\n");function gg(e){const t=new Gc.H(e,yg);return fg.c.single(t)}function mg(e,t,r={}){const n=gg(t);!0===r.writeBytes?e.push(n.subarray()):e.push(n)}async function bg(e,t){const r=await async function(e,t){let r=1;const n={[Symbol.asyncIterator]:()=>n,next:async()=>e.next(r)};let i=n;null!=t?.signal&&(i=hg(n,t.signal));const s=e=>{r=e},o=await(0,up.z)(i,(e=>fg.J(e,{onLength:s,maxDataLength:Ip})),(async e=>dg(e)));if(null==o||0===o.length)throw new je.sv("no buffer returned","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(o.get(o.byteLength-1)!==yg[0])throw pg.error("Invalid mss message - missing newline - %s",o.subarray()),new je.sv("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.sublist(0,-1)}(e,t);return function(e,t="utf8"){const r=cg[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}(r.subarray())}const wg=Xp("libp2p:mss:select");async function vg(e,t,r={}){t=Array.isArray(t)?[...t]:[t];const{reader:n,writer:i,rest:s,stream:o}=iy(e),a=t.shift();if(null==a)throw new Error("At least one protocol must be specified");wg.trace('select: write ["%s", "%s"]',Rp,a);!function(e,t,r={}){const n=new Gc.H;for(const e of t)n.append(gg(e));!0===r.writeBytes?e.push(n.subarray()):e.push(n)}(i,[ug(Rp),ug(a)],r);let c=await bg(n,r);if(wg.trace('select: read "%s"',c),c===Rp&&(c=await bg(n,r),wg.trace('select: read "%s"',c)),c===a)return s(),{stream:o,protocol:a};for(const e of t){wg.trace('select: write "%s"',e),mg(i,ug(e),r);const t=await bg(n,r);if(wg.trace('select: read "%s" for "%s"',t,e),t===e)return s(),{stream:o,protocol:e}}throw s(),new je.sv("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}const Eg=Xp("libp2p:mss:handle");async function _g(e,t,r){t=Array.isArray(t)?t:[t];const{writer:n,reader:i,rest:s,stream:o}=iy(e);for(;;){const e=await bg(i,r);if(Eg.trace('read "%s"',e),e!==Rp){if(t.includes(e))return mg(n,ug(e),r),Eg.trace('respond with "%s" for "%s"',e,e),s(),{stream:o,protocol:e};"ls"!==e?(mg(n,ug("na"),r),Eg('respond with "na" for "%s"',e)):(mg(n,new Gc.H(...t.map((e=>gg(ug(e))))),r),Eg.trace('respond with "%s" for %s',t,e))}else Eg.trace('respond with "%s" for "%s"',Rp,e),mg(n,ug(Rp),r)}}const Ag=Symbol.for("@libp2p/connection");const Sg=(0,Hs.kg)("libp2p:connection");class Rg{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;transient;tags;_newStream;_close;_abort;_getStreams;constructor(e){const{remoteAddr:t,remotePeer:r,newStream:n,close:i,abort:s,getStreams:o}=e;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.transient=e.transient??!1,this._newStream=n,this._close=i,this._abort=s,this._getStreams=o,this.tags=[]}[Symbol.toStringTag]="Connection";[Ag]=!0;get streams(){return this._getStreams()}async newStream(e,t){if("closing"===this.status)throw new je.sv("the connection is being closed","ERR_CONNECTION_BEING_CLOSED");if("closed"===this.status)throw new je.sv("the connection is closed","ERR_CONNECTION_CLOSED");if(Array.isArray(e)||(e=[e]),this.transient&&!0!==t?.runOnTransientConnection)throw new je.sv("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");const r=await this._newStream(e,t);return r.direction="outbound",r}async close(e={}){if("closed"!==this.status&&"closing"!==this.status){Sg("closing connection to %a",this.remoteAddr),this.status="closing",e.signal=e?.signal??AbortSignal.timeout(500);try{(0,Ke.setMaxListeners)?.(1/0,e.signal)}catch{}try{await Promise.all(this.streams.map((async t=>t.close(e)))),await this._close(e),this.timeline.close=Date.now(),this.status="closed"}catch(e){Sg.error("error encountered during graceful close of connection to %a",this.remoteAddr,e),this.abort(e)}}}abort(e){Sg.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this.streams.forEach((t=>{t.abort(e)})),Sg.error("all streams aborted",this.streams.length),this._abort(e),this.timeline.close=Date.now(),this.status="closed"}}const Ig=(0,Hs.kg)("libp2p:upgrader");function xg(e,t,r){let n=0;return r.streams.forEach((r=>{r.direction===t&&r.protocol===e&&n++})),n}class Pg{components;connectionEncryption;muxers;inboundUpgradeTimeout;events;constructor(e,t){this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach((e=>{this.connectionEncryption.set(e.protocol,e)})),this.muxers=new Map,t.muxers.forEach((e=>{this.muxers.set(e.protocol,e)})),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??3e4,this.events=e.events}async shouldBlockConnection(e,t,r){const n=this.components.connectionGater[r];if(void 0!==n&&await n(e,t))throw new je.sv(`The multiaddr connection is blocked by gater.${r}`,Df.q.ERR_CONNECTION_INTERCEPTED)}async upgradeInbound(e,t){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw new je.sv("connection denied",Df.q.ERR_CONNECTION_DENIED);let r,n,i,s,o;const a=AbortSignal.timeout(this.inboundUpgradeTimeout),c=()=>{e.abort(new je.sv("inbound upgrade timeout",Df.q.ERR_TIMEOUT))};a.addEventListener("abort",c,{once:!0});try{(0,Ke.setMaxListeners)?.(1/0,a)}catch{}try{if(!0===await(this.components.connectionGater.denyInboundConnection?.(e)))throw new je.sv("The multiaddr connection is blocked by gater.acceptConnection",Df.q.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(e),Ig("starting the inbound connection upgrade");let a=e;if(!0!==t?.skipProtection){const t=this.components.connectionProtector;null!=t&&(Ig("protecting the inbound connection"),a=await t.protect(e))}try{if(r=a,!0!==t?.skipEncryption){({conn:r,remotePeer:n,protocol:o}=await this._encryptInbound(a));const e={...a,...r};await this.shouldBlockConnection(n,e,"denyInboundEncryptedConnection")}else{const t=e.remoteAddr.getPeerId();if(null==t)throw new je.sv("inbound connection that skipped encryption must have a peer id",Df.q.ERR_INVALID_MULTIADDR);const r=(0,Ys.jE)(t);o="native",n=r}if(i=r,null!=t?.muxerFactory)s=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexInbound({...a,...r},this.muxers);s=e.muxerFactory,i=e.stream}}catch(e){throw Ig.error("Failed to upgrade inbound connection",e),e}return await this.shouldBlockConnection(n,e,"denyInboundUpgradedConnection"),Ig("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:o,direction:"inbound",maConn:e,upgradedConn:i,muxerFactory:s,remotePeer:n,transient:t?.transient})}finally{a.removeEventListener("abort",c),this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){const r=e.remoteAddr.getPeerId();let n,i,s,o,a,c;null!=r&&(n=(0,Ys.jE)(r),await this.shouldBlockConnection(n,e,"denyOutboundConnection")),this.components.metrics?.trackMultiaddrConnection(e),Ig("Starting the outbound connection upgrade");let u=e;if(!0!==t?.skipProtection){const t=this.components.connectionProtector;null!=t&&(u=await t.protect(e))}try{if(i=u,!0!==t?.skipEncryption){({conn:i,remotePeer:s,protocol:a}=await this._encryptOutbound(u,n));const e={...u,...i};await this.shouldBlockConnection(s,e,"denyOutboundEncryptedConnection")}else{if(null==n)throw new je.sv("Encryption was skipped but no peer id was passed",Df.q.ERR_INVALID_PEER);a="native",s=n}if(o=i,null!=t?.muxerFactory)c=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexOutbound({...u,...i},this.muxers);c=e.muxerFactory,o=e.stream}}catch(t){throw Ig.error("Failed to upgrade outbound connection",t),await e.close(t),t}return await this.shouldBlockConnection(s,e,"denyOutboundUpgradedConnection"),Ig("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:a,direction:"outbound",maConn:e,upgradedConn:o,muxerFactory:c,remotePeer:s,transient:t?.transient})}_createConnection(e){const{cryptoProtocol:t,direction:r,maConn:n,upgradedConn:i,remotePeer:s,muxerFactory:o,transient:a}=e;let c,u,l;null!=o&&(c=o.createStreamMuxer({direction:r,onIncomingStream:e=>{null!=l&&Promise.resolve().then((async()=>{const t=this.components.registrar.getProtocols(),{stream:n,protocol:i}=await _g(e,t);if(Ig("%s: incoming stream opened on %s",r,i),null==l)return;const o=function(e,t){try{const{options:r}=t.getHandler(e);return r.maxInboundStreams}catch(e){if(e.code!==Df.q.ERR_NO_HANDLER_FOR_PROTOCOL)throw e}return 32}(i,this.components.registrar);if(xg(i,"inbound",l)===o){const t=new je.sv(`Too many inbound protocol streams for protocol "${i}" - limit ${o}`,Df.q.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS);throw e.abort(t),t}e.source=n.source,e.sink=n.sink,e.protocol=i,await this.components.peerStore.merge(s,{protocols:[i]}),this.components.metrics?.trackProtocolStream(e,l),this._onStream({connection:l,stream:e,protocol:i})})).catch((async t=>{Ig.error(t),null==e.timeline.close&&await e.close()}))}}),u=async(e,t={})=>{if(null==c)throw new je.sv("Stream is not multiplexed",Df.q.ERR_MUXER_UNAVAILABLE);Ig("%s: starting new stream on %s",r,e);const n=await c.newStream();try{if(null==t.signal){Ig("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",e),t.signal=AbortSignal.timeout(3e4);try{(0,Ke.setMaxListeners)?.(1/0,t.signal)}catch{}}const{stream:r,protocol:i}=await vg(n,e,t),o=function(e,t,r={}){try{const{options:r}=t.getHandler(e);if(null!=r.maxOutboundStreams)return r.maxOutboundStreams}catch(e){if(e.code!==Df.q.ERR_NO_HANDLER_FOR_PROTOCOL)throw e}return r.maxOutboundStreams??64}(i,this.components.registrar,t);if(xg(i,"outbound",l)>=o){const e=new je.sv(`Too many outbound protocol streams for protocol "${i}" - limit ${o}`,Df.q.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw n.abort(e),e}return await this.components.peerStore.merge(s,{protocols:[i]}),n.source=r.source,n.sink=r.sink,n.protocol=i,this.components.metrics?.trackProtocolStream(n,l),n}catch(t){if(Ig.error("could not create new stream for protocols %s on connection with address %a",e,l.remoteAddr,t),null==n.timeline.close&&n.abort(t),null!=t.code)throw t;throw new je.sv(String(t),Df.q.ERR_UNSUPPORTED_PROTOCOL)}},Promise.all([c.sink(i.source),i.sink(c.source)]).catch((e=>{Ig.error(e)})));const h=n.timeline;n.timeline=new Proxy(h,{set:(...e)=>(null!=l&&"close"===e[1]&&null!=e[2]&&null==h.close&&(async()=>{try{"open"===l.status&&await l.close()}catch(e){Ig.error(e)}finally{this.events.safeDispatchEvent("connection:close",{detail:l})}})().catch((e=>{Ig.error(e)})),Reflect.set(...e))}),n.timeline.upgraded=Date.now();var d;return d={remoteAddr:n.remoteAddr,remotePeer:s,status:"open",direction:r,timeline:n.timeline,multiplexer:c?.protocol,encryption:t,transient:a,newStream:u??(()=>{throw new je.sv("connection is not multiplexed",Df.q.ERR_CONNECTION_NOT_MULTIPLEXED)}),getStreams:()=>null!=c?c.streams:[],close:async e=>{await n.close(e),null!=c&&await c.close(e)},abort:e=>{n.abort(e),null!=c&&c.abort(e)}},l=new Rg(d),this.events.safeDispatchEvent("connection:open",{detail:l}),l}_onStream(e){const{connection:t,stream:r,protocol:n}=e,{handler:i,options:s}=this.components.registrar.getHandler(n);if(t.transient&&!0!==s.runOnTransientConnection)throw new je.sv("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");i({connection:t,stream:r})}async _encryptInbound(e){const t=Array.from(this.connectionEncryption.keys());Ig("handling inbound crypto protocol selection",t);try{const{stream:r,protocol:n}=await _g(e,t,{writeBytes:!0}),i=this.connectionEncryption.get(n);if(null==i)throw new Error(`no crypto module found for ${n}`);return Ig("encrypting inbound connection..."),{...await i.secureInbound(this.components.peerId,r),protocol:n}}catch(e){throw new je.sv(String(e),Df.q.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){const r=Array.from(this.connectionEncryption.keys());Ig("selecting outbound crypto protocol",r);try{const{stream:n,protocol:i}=await vg(e,r,{writeBytes:!0}),s=this.connectionEncryption.get(i);if(null==s)throw new Error(`no crypto module found for ${i}`);return Ig("encrypting outbound connection to %p",t),{...await s.secureOutbound(this.components.peerId,n,t),protocol:i}}catch(e){throw new je.sv(String(e),Df.q.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const r=Array.from(t.keys());Ig("outbound selecting muxer %s",r);try{const{stream:n,protocol:i}=await vg(e,r,{writeBytes:!0});Ig("%s selected as muxer protocol",i);return{stream:n,muxerFactory:t.get(i)}}catch(e){throw Ig.error("error multiplexing outbound stream",e),new je.sv(String(e),Df.q.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const r=Array.from(t.keys());Ig("inbound handling muxers %s",r);try{const{stream:n,protocol:i}=await _g(e,r,{writeBytes:!0});return{stream:n,muxerFactory:t.get(i)}}catch(e){throw Ig.error("error multiplexing inbound stream",e),new je.sv(String(e),Df.q.ERR_MUXER_UNAVAILABLE)}}}const Cg=(0,Hs.kg)("libp2p");class Tg extends ze.v{peerId;peerStore;contentRouting;peerRouting;keychain;metrics;services;components;#d;constructor(e){super();const t=new ze.v,r=t.dispatchEvent.bind(t);t.dispatchEvent=e=>{const t=r(e),n=this.dispatchEvent(new ze.A(e.type,{detail:e.detail}));return t||n};try{(0,Ke.setMaxListeners)?.(1/0,t)}catch{}this.#d=!1,this.peerId=e.peerId,this.services={};const n=this.components=function(e={}){const t=new wf(e);return new Proxy(t,{get(e,r,n){if("string"==typeof r&&!Ef.includes(r)){const e=t.components[r];if(null==e&&!vf.includes(r))throw new je.sv(`${r} not set`,"ERR_SERVICE_MISSING");return e}return Reflect.get(e,r,n)},set:(e,r,n)=>("string"==typeof r?t.components[r]=n:Reflect.set(e,r,n),!0)})}({peerId:e.peerId,events:t,datastore:e.datastore??new hf.a,connectionGater:Af(e.connectionGater)});this.peerStore=this.configureComponent("peerStore",new uf(n,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),null!=e.metrics&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),n.events.addEventListener("peer:update",(e=>{if(null==e.detail.previous){const t={id:e.detail.peer.id,multiaddrs:e.detail.peer.addresses.map((e=>e.multiaddr)),protocols:e.detail.peer.protocols};n.events.safeDispatchEvent("peer:discovery",{detail:t})}})),null!=e.connectionProtector&&this.configureComponent("connectionProtector",e.connectionProtector(n)),this.components.upgrader=new Pg(this.components,{connectionEncryption:(e.connectionEncryption??[]).map(((e,t)=>this.configureComponent(`connection-encryption-${t}`,e(this.components)))),muxers:(e.streamMuxers??[]).map(((e,t)=>this.configureComponent(`stream-muxers-${t}`,e(this.components)))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.configureComponent("transportManager",new Sp(this.components,e.transportManager)),this.configureComponent("connectionManager",new np(this.components,e.connectionManager)),this.configureComponent("registrar",new Ep(this.components)),this.configureComponent("addressManager",new mf(this.components,e.addresses));const i=Gs.generateOptions();this.keychain=this.configureComponent("keyChain",new Gs(this.components,{...i,...e.keychain}));const s=(e.peerRouters??[]).map(((e,t)=>this.configureComponent(`peer-router-${t}`,e(this.components))));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new wp(this.components,{routers:s}));const o=(e.contentRouters??[]).map(((e,t)=>this.configureComponent(`content-router-${t}`,e(this.components))));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new gp(this.components,{routers:o})),(e.peerDiscovery??[]).forEach(((e,t)=>{this.configureComponent(`peer-discovery-${t}`,e(this.components)).addEventListener("peer",(e=>{this.#f(e)}))})),e.transports.forEach(((e,t)=>{this.components.transportManager.add(this.configureComponent(`transport-${t}`,e(this.components)))})),null!=e.services)for(const t of Object.keys(e.services)){const r=(0,e.services[t])(this.components);null!=r?(this.services[t]=r,this.configureComponent(t,r),null!=r[Ve.J]&&(Cg("registering service %s for content routing",t),o.push(r[Ve.J])),null!=r[Fe.z]&&(Cg("registering service %s for peer routing",t),s.push(r[Fe.z])),null!=r[qe.O]&&(Cg("registering service %s for peer discovery",t),r[qe.O].addEventListener("peer",(e=>{this.#f(e)})))):Cg.error("service factory %s returned null or undefined instance",t)}}configureComponent(e,t){return null==t&&Cg.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if(this.#d)return;this.#d=!0,Cg("libp2p is starting");null==(await this.keychain.listKeys()).find((e=>"self"===e.name))&&(Cg("importing self key into keychain"),await this.keychain.importPeer("self",this.components.peerId));try{await(this.components.beforeStart?.()),await this.components.start(),await(this.components.afterStart?.()),this.safeDispatchEvent("start",{detail:this}),Cg("libp2p has started")}catch(e){throw Cg.error("An error occurred starting libp2p",e),await this.stop(),e}}async stop(){this.#d&&(Cg("libp2p is stopping"),this.#d=!1,await(this.components.beforeStop?.()),await this.components.stop(),await(this.components.afterStop?.()),this.safeDispatchEvent("stop",{detail:this}),Cg("libp2p has stopped"))}isStarted(){return this.#d}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const e=new Ws.fd;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return this.components.connectionManager.openConnection(e,t)}async dialProtocol(e,t,r={}){if(null==t)throw new je.sv("no protocols were provided to open a stream",Df.q.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(0===(t=Array.isArray(t)?t:[t]).length)throw new je.sv("no protocols were provided to open a stream",Df.q.ERR_INVALID_PROTOCOLS_FOR_STREAM);return(await this.dial(e,r)).newStream(t,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e,t={}){(0,lf.h2)(e)&&(e=(0,Ys.jE)(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e,t)}async getPublicKey(e,t={}){if(Cg("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;const r=await this.peerStore.get(e);if(null!=r.id.publicKey)return r.id.publicKey;const n=(0,df.z)([(0,ff.m)("/pk/"),e.multihash.digest]),i=await this.contentRouting.get(n,t);return(0,$e.lR)(i),await this.peerStore.patch(e,{publicKey:i}),i}async handle(e,t,r){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.handle(e,t,r)})))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.unhandle(e)})))}async register(e,t){return this.components.registrar.register(e,t)}unregister(e){this.components.registrar.unregister(e)}#f(e){const{detail:t}=e;t.id.toString()!==this.peerId.toString()?this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs,protocols:t.protocols}).catch((e=>{Cg.error(e)})):Cg.error(new Error(Df.q.ERR_DISCOVERED_SELF))}}async function kg(e){if(null==e.peerId){const t=e.datastore;if(null!=t)try{const r=new Gs({datastore:t},(0,Os.Z)(Gs.generateOptions(),e.keychain));e.peerId=await r.exportPeerId("self")}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}}return null==e.peerId&&(e.peerId=await(0,Qs.n9)()),new Tg(function(e){const t=(0,Os.Z)(Of,e);if(null==t.transports||t.transports.length<1)throw new je.sv(Df.s.ERR_TRANSPORTS_REQUIRED,Df.q.ERR_TRANSPORTS_REQUIRED);if(null===t.connectionProtector&&null!=globalThis.process?.env?.LIBP2P_FORCE_PNET)throw new je.sv(Df.s.ERR_PROTECTOR_REQUIRED,Df.q.ERR_PROTECTOR_REQUIRED);return t}(e))}async function Dg(e){const t=await kg(e);return!1!==e.start&&await t.start(),t}},70036:function(e,t,r){"use strict";r.d(t,{J:function(){return d}});var n=r(49541);r(8925),r(3832),r(97858),r(2291);r(23352),r(43724),r(98960),r(97116);var i=r(16587),s=r(38699),o=r(31650),a=r(32629),c=r(8611),u=r(64188);const l=(0,s.kg)("libp2p:ping");class h{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnTransientConnection;constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix??"ipfs"}/ping/1.0.0`,this.timeout=t.timeout??1e4,this.maxInboundStreams=t.maxInboundStreams??2,this.maxOutboundStreams=t.maxOutboundStreams??1,this.runOnTransientConnection=t.runOnTransientConnection??!0}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){l("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,r=Date.now();(0,a.z)(t,t).catch((t=>{l.error("incoming ping from %p failed with error",e.connection.remotePeer,t)})).finally((()=>{const t=Date.now()-r;l("incoming ping from %p complete in %dms",e.connection.remotePeer,t)}))}async ping(e,t={}){l("pinging %p",e);const r=Date.now(),s=(0,i.Z)(32),h=await this.components.connectionManager.openConnection(e,t);let d,f=()=>{};t.signal=t.signal??AbortSignal.timeout(this.timeout);try{d=await h.newStream(this.protocol,{...t,runOnTransientConnection:this.runOnTransientConnection}),f=()=>{d?.abort(new n.sv("ping timeout",u.q.ERR_TIMEOUT))},t.signal.addEventListener("abort",f,{once:!0});const e=await(0,a.z)([s],d,(async e=>(0,o.Z)(e))),i=Date.now()-r;if(null==e)throw new n.sv(`Did not receive a ping ack after ${i}ms`,u.q.ERR_WRONG_PING_ACK);if(!(0,c.f)(s,e.subarray()))throw new n.sv(`Received wrong ping ack after ${i}ms`,u.q.ERR_WRONG_PING_ACK);return l("ping %p complete in %dms",h.remotePeer,i),i}catch(e){throw l.error("error while pinging %p",h.remotePeer,e),d?.abort(e),e}finally{t.signal.removeEventListener("abort",f),null!=d&&await d.close()}}}function d(e={}){return t=>new h(t,e)}},95554:function(e,t,r){"use strict";r.d(t,{m:function(){return a}});var n=r(49541),i=r(9398),s=r(64188);class o{#p=[];enqueue(e,t){const r=t?.peerId,i=t?.priority??0;if(null==r)throw new n.sv("missing peer id",s.q.ERR_INVALID_PARAMETERS);const o={priority:i,peerId:r,run:e};if(this.size>0&&this.#p[this.size-1].priority>=i)return void this.#p.push(o);const a=function(e,t,r){let n=0,i=e.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}(this.#p,o,((e,t)=>t.priority-e.priority));this.#p.splice(a,0,o)}dequeue(){const e=this.#p.shift();return e?.run}filter(e){if(null!=e.peerId){const t=e.peerId;return this.#p.filter((e=>t.equals(e.peerId))).map((e=>e.run))}return this.#p.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this.#p.length}}class a extends i.Z{constructor(e={}){super({...e,queueClass:o})}hasJob(e){return this.sizeBy({peerId:e})>0}}},23352:function(e,t,r){"use strict";r(66281)},43724:function(e,t,r){"use strict";r.d(t,{Au:function(){return ue},m2:function(){return fe},Re:function(){return he},r3:function(){return de},lR:function(){return le}});var n={};r.r(n),r.d(n,{Ed25519PrivateKey:function(){return C},Ed25519PublicKey:function(){return P},generateKeyPair:function(){return D},generateKeyPairFromSeed:function(){return O},unmarshalEd25519PrivateKey:function(){return T},unmarshalEd25519PublicKey:function(){return k}});var i={};r.r(i),r.d(i,{MAX_KEY_SIZE:function(){return G},RsaPrivateKey:function(){return W},RsaPublicKey:function(){return H},fromJwk:function(){return J},generateKeyPair:function(){return Z},unmarshalRsaPrivateKey:function(){return Y},unmarshalRsaPublicKey:function(){return Q}});var s={};r.r(s),r.d(s,{Secp256k1PrivateKey:function(){return re},Secp256k1PublicKey:function(){return te},generateKeyPair:function(){return se},unmarshalSecp256k1PrivateKey:function(){return ne},unmarshalSecp256k1PublicKey:function(){return ie}});r(3068),r(97450);var o=r(49541),a=r(3832),c=r(97858),u=r(55729),l=r(60150),h=r(59425),d=r(8611),f=r(4101);const p=32,y=64,g=32;function m(e,t){const r=new Uint8Array(y);for(let n=0;n<g;n++)r[n]=e[n],r[g+n]=t[n];return r}var b=r(35615),w=r(29124),v=r(66281);const E={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function _(e,t){const r=function(e){const t=e?.algorithm??"AES-GCM";let r=e?.keyLength??16;const n=e?.nonceLength??12,i=e?.digest??"SHA-256",s=e?.saltLength??16,o=e?.iterations??32767,a=v.Z.get();return r*=8,{encrypt:async function(e,u){const l=a.getRandomValues(new Uint8Array(s)),h=a.getRandomValues(new Uint8Array(n)),d={name:t,iv:h};let f;if("string"==typeof u&&(u=(0,c.m)(u)),0===u.length){f=await a.subtle.importKey("jwk",E,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",u,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}catch{f=await a.subtle.importKey("jwk",E,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",u,{name:"PBKDF2"},!1,["deriveKey"]);f=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["encrypt"])}const p=await a.subtle.encrypt(d,f,e);return(0,w.z)([l,d.iv,new Uint8Array(p)])},decrypt:async function(e,u){const l=e.subarray(0,s),h=e.subarray(s,s+n),d=e.subarray(s+n),f={name:t,iv:h};let p;if("string"==typeof u&&(u=(0,c.m)(u)),0===u.length)try{const e={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",u,{name:"PBKDF2"},!1,["deriveKey"]);p=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}catch{p=await a.subtle.importKey("jwk",E,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},n=await a.subtle.importKey("raw",u,{name:"PBKDF2"},!1,["deriveKey"]);p=await a.subtle.deriveKey(e,n,{name:t,length:r},!0,["decrypt"])}const y=await a.subtle.decrypt(f,p,d);return new Uint8Array(y)}}}(),n=await r.encrypt(e,t);return b.base64.encode(n)}var A,S,R,I,x=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(A||(A={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(S||(S={})),function(e){e.codec=()=>(0,x.Ji)(S)}(A||(A={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,x.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),A.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=A.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,x.LE)(t,e.codec()),e.decode=t=>(0,x.C6)(t,e.codec())}(R||(R={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,x.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),A.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Type=A.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,x.LE)(t,e.codec()),e.decode=t=>(0,x.C6)(t,e.codec())}(I||(I={}));class P{_key;constructor(e){this._key=N(e,p)}async verify(e,t){return async function(e,t,r){return f.UN.verify(t,r,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return R.encode({Type:A.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,d.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await h.sha256.digest(this.bytes);return e}}class C{_key;_publicKey;constructor(e,t){this._key=N(e,y),this._publicKey=N(t,p)}async sign(e){return async function(e,t){const r=e.subarray(0,g);return f.UN.sign(t,r)}(this._key,e)}get public(){return new P(this._publicKey)}marshal(){return this._key}get bytes(){return I.encode({Type:A.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,d.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await h.sha256.digest(this.bytes);return e}async id(){const e=l.identity.digest(this.public.bytes);return u.base58btc.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return _(this.bytes,e);throw new o.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function T(e){if(e.length>y){const t=(e=N(e,y+p)).subarray(0,y),r=e.subarray(y,e.length);return new C(t,r)}const t=(e=N(e,y)).subarray(0,y),r=e.subarray(p);return new C(t,r)}function k(e){return e=N(e,p),new P(e)}async function D(){const{privateKey:e,publicKey:t}=await async function(){const e=f.UN.utils.randomPrivateKey(),t=f.UN.getPublicKey(e);return{privateKey:m(e,t),publicKey:t}}();return new C(e,t)}async function O(e){const{privateKey:t,publicKey:r}=await async function(e){if(e.length!==g)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,r=f.UN.getPublicKey(t);return{privateKey:m(t,r),publicKey:r}}(e);return new C(t,r)}function N(e,t){if((e=Uint8Array.from(e??[])).length!==t)throw new o.sv(`Key must be a Uint8Array of length ${t}, got ${e.length}`,"ERR_INVALID_KEY_TYPE");return e}var L=r(2291);r(97116),r(15764);function U(e,t){let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.subarray(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=(0,w.z)([new Uint8Array(t-r.length),r])}return(0,L.B)(r,"base64url")}function M(e){const t=function(e,t){let r=(0,c.m)(e,"base64urlpad");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=(0,w.z)([new Uint8Array(t-r.length),r])}return r}(e);return new a.jsbn.BigInteger((0,L.B)(t,"base16"),16)}const B={"P-256":256,"P-384":384,"P-521":521};Object.keys(B).join(" / ");r(23352);r(63219);var K=r(16587);r(28095);function $(e,t){return t.map((t=>M(e[t])))}async function V(e){const t=[await v.Z.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await z(e)],r=await j({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function j(e){if(null==e.privateKey||null==e.publicKey)throw new o.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([v.Z.get().subtle.exportKey("jwk",e.privateKey),v.Z.get().subtle.exportKey("jwk",e.publicKey)])}async function z(e){return v.Z.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function q(e,t,r,n){const i=t?function(e){return a.pki.setRsaPublicKey(...$(e,["n","e"]))}(e):function(e){return a.pki.setRsaPrivateKey(...$(e,["n","e","d","p","q","dp","dq","qi"]))}(e),s=n((0,L.B)(Uint8Array.from(r),"ascii"),i);return(0,c.m)(s,"ascii")}function F(e){if("RSA"!==e.kty)throw new o.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new o.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*(0,c.m)(e.n,"base64url").length}const G=8192;class H{_key;constructor(e){this._key=e}async verify(e,t){return async function(e,t,r){const n=await v.Z.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return v.Z.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new o.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=a.pki.publicKeyToAsn1({n:M(e.n),e:M(e.e)});return(0,c.m)(a.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return R.encode({Type:A.RSA,Data:this.marshal()}).subarray()}encrypt(e){return q(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,d.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await h.sha256.digest(this.bytes);return e}}class W{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return K.Z(16)}async sign(e){return async function(e,t){const r=await v.Z.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await v.Z.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,0,n.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new o.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new H(this._publicKey)}decrypt(e){return q(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new o.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=a.pki.privateKeyToAsn1({n:M(e.n),e:M(e.e),d:M(e.d),p:M(e.p),q:M(e.q),dP:M(e.dp),dQ:M(e.dq),qInv:M(e.qi)});return(0,c.m)(a.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return I.encode({Type:A.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,d.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await h.sha256.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,L.B)(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new a.util.ByteBuffer(this.marshal()),r=a.asn1.fromDer(t),n=a.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return a.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return _(this.bytes,e);throw new o.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function Y(e){const t=function(e){const t=a.asn1.fromDer((0,L.B)(e,"ascii")),r=a.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:U(r.n),e:U(r.e),d:U(r.d),p:U(r.p),q:U(r.q),dp:U(r.dP),dq:U(r.dQ),qi:U(r.qInv),alg:"RS256"}}(e);if(F(t)>G)throw new o.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const r=await V(t);return new W(r.privateKey,r.publicKey)}function Q(e){const t=function(e){const t=a.asn1.fromDer((0,L.B)(e,"ascii")),r=a.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:U(r.n),e:U(r.e)}}(e);if(F(t)>G)throw new o.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new H(t)}async function J(e){if(F(e)>G)throw new o.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await V(e);return new W(t.privateKey,t.publicKey)}async function Z(e){if(e>G)throw new o.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await v.Z.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await j(t);return{privateKey:r[0],publicKey:r[1]}}(e);return new W(t.privateKey,t.publicKey)}var X=r(60533);function ee(e){try{X.kA.ProjectivePoint.fromHex(e)}catch(e){throw new o.sv(String(e),"ERR_INVALID_PUBLIC_KEY")}}class te{_key;constructor(e){ee(e),this._key=e}async verify(e,t){return async function(e,t,r){try{const{digest:n}=await h.sha256.digest(r);return X.kA.verify(t,n,e)}catch(e){throw new o.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,X.kA.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return R.encode({Type:A.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,d.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await h.sha256.digest(this.bytes);return e}}class re{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??function(e){try{return X.kA.getPublicKey(e,!0)}catch(e){throw new o.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{X.kA.getPublicKey(e,!0)}catch(e){throw new o.sv(String(e),"ERR_INVALID_PRIVATE_KEY")}}(this._key),ee(this._publicKey)}async sign(e){return async function(e,t){const{digest:r}=await h.sha256.digest(t);try{return X.kA.sign(r,e).toDERRawBytes()}catch(e){throw new o.sv(String(e),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new te(this._publicKey)}marshal(){return this._key}get bytes(){return I.encode({Type:A.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,d.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await h.sha256.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,L.B)(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return _(this.bytes,e);throw new o.sv(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function ne(e){return new re(e)}function ie(e){return new te(e)}async function se(){const e=X.kA.utils.randomPrivateKey();return new re(e)}const oe={rsa:i,ed25519:n,secp256k1:s};function ae(e){const t=Object.keys(oe).join(" / ");return new o.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function ce(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return oe[e];throw ae(e)}async function ue(e,t){return ce(e).generateKeyPair(t??2048)}function le(e){const t=R.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case A.RSA:return oe.rsa.unmarshalRsaPublicKey(r);case A.Ed25519:return oe.ed25519.unmarshalEd25519PublicKey(r);case A.Secp256k1:return oe.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw ae(t.Type??"unknown")}}function he(e,t){return ce(t=(t??"rsa").toLowerCase()),e.bytes}async function de(e){const t=I.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case A.RSA:return oe.rsa.unmarshalRsaPrivateKey(r);case A.Ed25519:return oe.ed25519.unmarshalEd25519PrivateKey(r);case A.Secp256k1:return oe.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw ae(t.Type??"RSA")}}function fe(e,t){return ce(t=(t??"rsa").toLowerCase()),e.bytes}},16587:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(49541);const i="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function s(e){if(isNaN(e)||e<=0)throw new n.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return function(e=32){if(i&&"function"==typeof i.getRandomValues)return i.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(e)}},66281:function(e,t){"use strict";t.Z={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}}},38699:function(e,t,r){"use strict";r.d(t,{kg:function(){return a}});var n=r(11227),i=r(10430),s=r(55729),o=r(35615);function a(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return n.enabled(`${e}:trace`)&&null!=n.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=n(`${e}:trace`)),Object.assign(n(e),{error:n(`${e}:error`),trace:t})}n.formatters.b=e=>null==e?"undefined":s.base58btc.baseEncode(e),n.formatters.t=e=>null==e?"undefined":i.base32.baseEncode(e),n.formatters.m=e=>null==e?"undefined":o.base64.baseEncode(e),n.formatters.p=e=>null==e?"undefined":e.toString(),n.formatters.c=e=>null==e?"undefined":e.toString(),n.formatters.k=e=>null==e?"undefined":e.toString(),n.formatters.a=e=>null==e?"undefined":e.toString()},74803:function(e,t,r){"use strict";r.d(t,{n9:function(){return a}});var n,i=r(43724),s=r(34042),o=(r(97858),r(46888));!function(e){let t;e.codec=()=>(null==t&&(t=(0,o.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.pubKey&&(t.uint32(18),t.bytes(e.pubKey)),null!=e.privKey&&(t.uint32(26),t.bytes(e.privKey)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.id=e.bytes();break;case 2:r.pubKey=e.bytes();break;case 3:r.privKey=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,o.LE)(t,e.codec()),e.decode=t=>(0,o.C6)(t,e.codec())}(n||(n={}));const a=async()=>{const e=await(0,i.Au)("Ed25519"),t=await c(e);if("Ed25519"===t.type)return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)};async function c(e){return(0,s.y5)((0,i.Re)(e.public),(0,i.m2)(e))}},34042:function(e,t,r){"use strict";r.d(t,{cv:function(){return E},jE:function(){return v},y5:function(){return _}});r(49541);var n=r(5681),i=r(55729),s=r(13351),o=r(25674),a=r(62550),c=r(60150),u=r(59425),l=r(8611);const h=Symbol.for("nodejs.util.inspect.custom"),d=Object.values(s.gh).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),s.gh.identity.decoder),f=114,p=36,y=37;class g{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[n.N]=!0;toString(){return null==this.string&&(this.string=i.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return o.k0.createV1(f,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return(0,l.f)(this.multihash.bytes,e);if("string"==typeof e)return v(e).equals(this);if(null!=e?.multihash?.bytes)return(0,l.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[h](){return`PeerId(${this.toString()})`}}class m extends g{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class b extends g{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class w extends g{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function v(e,t){if(t=t??d,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=a.Jx(i.base58btc.decode(`z${e}`));return e.startsWith("12D")?new b({multihash:t}):e.startsWith("16U")?new w({multihash:t}):new m({multihash:t})}return E(d.decode(e))}function E(e){try{const t=a.Jx(e);if(t.code===c.identity.code){if(t.digest.length===p)return new b({multihash:t});if(t.digest.length===y)return new w({multihash:t})}if(t.code===u.sha256.code)return new m({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==f)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===u.sha256.code)return new m({multihash:e.multihash});if(t.code===c.identity.code){if(t.digest.length===p)return new b({multihash:e.multihash});if(t.digest.length===y)return new w({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(o.k0.decode(e))}throw new Error("Supplied PeerID CID is invalid")}async function _(e,t){return e.length===p?new b({multihash:a.Ue(c.identity.code,e),privateKey:t}):e.length===y?new w({multihash:a.Ue(c.identity.code,e),privateKey:t}):new m({multihash:await u.sha256.digest(e),publicKey:e,privateKey:t})}},3046:function(e,t,r){"use strict";r.d(t,{K:function(){return b},X:function(){return f}});var n=r(43724),i=r(49541),s=r(34042),o=r(57050),a=r(62308),c=r(8611),u=r(97858);const l="ERR_SIGNATURE_NOT_VALID";var h,d=r(46888);!function(e){let t;e.codec=()=>(null==t&&(t=(0,d.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,d.LE)(t,e.codec()),e.decode=t=>(0,d.C6)(t,e.codec())}(h||(h={}));class f{static createFromProtobuf=async e=>{const t=h.decode(e),r=await(0,s.y5)(t.publicKey);return new f({peerId:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})};static seal=async(e,t)=>{if(null==t.privateKey)throw new Error("Missing private key");const r=e.domain,i=e.codec,s=e.marshal(),o=p(r,i,s),a=await(0,n.r3)(t.privateKey),c=await a.sign(o.subarray());return new f({peerId:t,payloadType:i,payload:s,signature:c})};static openAndCertify=async(e,t)=>{const r=await f.createFromProtobuf(e);if(!await r.validate(t))throw new i.sv("envelope signature is not valid for the given domain",l);return r};peerId;payloadType;payload;signature;marshaled;constructor(e){const{peerId:t,payloadType:r,payload:n,signature:i}=e;this.peerId=t,this.payloadType=r,this.payload=n,this.signature=i}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=h.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return(0,c.f)(this.marshal(),e.marshal())}async validate(e){const t=p(e,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");return(0,n.lR)(this.peerId.publicKey).verify(t.subarray(),this.signature)}}const p=(e,t,r)=>{const n=(0,u.m)(e),i=o.cv(n.byteLength),s=o.cv(t.length),c=o.cv(r.length);return new a.H(i,n,s,t,c,r)};var y=r(59850);const g=Uint8Array.from([3,1]);var m;!function(e){let t,r;!function(e){let t;e.codec=()=>(null==t&&(t=(0,d.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={multiaddr:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.multiaddr=e.bytes();else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,d.LE)(t,e.codec()),e.decode=t=>(0,d.C6)(t,e.codec())}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==r&&(r=(0,d.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.peerId&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),null!=t.seq&&0n!==t.seq&&(r.uint32(16),r.uint64(t.seq)),null!=t.addresses)for(const n of t.addresses)r.uint32(26),e.AddressInfo.codec().encode(n,r);!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={peerId:new Uint8Array(0),seq:0n,addresses:[]},i=null==r?t.len:t.pos+r;for(;t.pos<i;){const r=t.uint32();switch(r>>>3){case 1:n.peerId=t.bytes();break;case 2:n.seq=t.uint64();break;case 3:n.addresses.push(e.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(7&r)}}return n}))),r),e.encode=t=>(0,d.LE)(t,e.codec()),e.decode=t=>(0,d.C6)(t,e.codec())}(m||(m={}));class b{static createFromProtobuf=e=>{const t=m.decode(e),r=(0,s.cv)(t.peerId),n=(t.addresses??[]).map((e=>(0,y.HM)(e.multiaddr))),i=t.seq;return new b({peerId:r,multiaddrs:n,seqNumber:i})};static DOMAIN="libp2p-peer-record";static CODEC=g;peerId;multiaddrs;seqNumber;domain=b.DOMAIN;codec=b.CODEC;marshaled;constructor(e){const{peerId:t,multiaddrs:r,seqNumber:n}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=n??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=m.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))})),this.marshaled}equals(e){return e instanceof b&&(!!this.peerId.equals(e.peerId)&&(this.seqNumber===e.seqNumber&&!!function(e,t){const r=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(r),e.sort(r).every(((e,r)=>t[r].equals(e))))}(this.multiaddrs,e.multiaddrs)))}}},59850:function(e,t,r){"use strict";r.d(t,{h2:function(){return Ct},HM:function(){return kt},a_:function(){return ct.Ev},s_:function(){return xt}});var n={};r.r(n),r.d(n,{identity:function(){return k}});var i={};r.r(i),r.d(i,{base2:function(){return D}});var s={};r.r(s),r.d(s,{base8:function(){return O}});var o={};r.r(o),r.d(o,{base10:function(){return N}});var a={};r.r(a),r.d(a,{base16:function(){return L},base16upper:function(){return U}});var c={};r.r(c),r.d(c,{base32:function(){return M},base32hex:function(){return V},base32hexpad:function(){return z},base32hexpadupper:function(){return q},base32hexupper:function(){return j},base32pad:function(){return K},base32padupper:function(){return $},base32upper:function(){return B},base32z:function(){return F}});var u={};r.r(u),r.d(u,{base36:function(){return G},base36upper:function(){return H}});var l={};r.r(l),r.d(l,{base58btc:function(){return W},base58flickr:function(){return Y}});var h={};r.r(h),r.d(h,{base64:function(){return Q},base64pad:function(){return J},base64url:function(){return Z},base64urlpad:function(){return X}});var d={};r.r(d),r.d(d,{base256emoji:function(){return ne}});var f={};r.r(f),r.d(f,{sha256:function(){return Pe},sha512:function(){return Ce}});var p={};r.r(p),r.d(p,{identity:function(){return ke}});var y={};r.r(y),r.d(y,{code:function(){return Oe},decode:function(){return Le},encode:function(){return Ne},name:function(){return De}});var g={};r.r(g),r.d(g,{code:function(){return Ke},decode:function(){return Ve},encode:function(){return $e},name:function(){return Be}});var m=r(49541),b=r(55729),w=r(25674);var v=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},E=v;new Uint8Array(0);const _=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class A{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class S{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return I(this,e)}}class R{constructor(e){this.decoders=e}or(e){return I(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const I=(e,t)=>new R({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class x{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new A(e,t,r),this.decoder=new S(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const P=({name:e,prefix:t,encode:r,decode:n})=>new x(e,t,r,n),C=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=E(r,t);return P({prefix:e,name:t,encode:n,decode:e=>_(i(e))})},T=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>P({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),k=P({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),D=T({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),O=T({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),N=C({prefix:"9",name:"base10",alphabet:"0123456789"}),L=T({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),U=T({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),M=T({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),B=T({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),K=T({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$=T({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),V=T({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),j=T({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),z=T({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),q=T({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),F=T({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),G=C({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),H=C({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),W=C({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Y=C({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Q=T({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),J=T({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Z=T({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),X=T({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ee=Array.from(""),te=ee.reduce(((e,t,r)=>(e[r]=t,e)),[]),re=ee.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const ne=P({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=te[t]),"")},decode:function(e){const t=[];for(const r of e){const e=re[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var ie=function e(t,r,n){r=r||[];var i=n=n||0;for(;t>=ae;)r[n++]=255&t|se,t/=128;for(;t&oe;)r[n++]=255&t|se,t>>>=7;return r[n]=0|t,e.bytes=n-i+1,r},se=128,oe=-128,ae=Math.pow(2,31);var ce=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&le)<<s:(n&le)*Math.pow(2,s),s+=7}while(n>=ue);return e.bytes=o-r,i},ue=128,le=127;var he=Math.pow(2,7),de=Math.pow(2,14),fe=Math.pow(2,21),pe=Math.pow(2,28),ye=Math.pow(2,35),ge=Math.pow(2,42),me=Math.pow(2,49),be=Math.pow(2,56),we=Math.pow(2,63),ve={encode:ie,decode:ce,encodingLength:function(e){return e<he?1:e<de?2:e<fe?3:e<pe?4:e<ye?5:e<ge?6:e<me?7:e<be?8:e<we?9:10}};const Ee=(e,t,r=0)=>(ve.encode(e,t,r),t),_e=e=>ve.encodingLength(e),Ae=(e,t)=>{const r=t.byteLength,n=_e(e),i=n+_e(r),s=new Uint8Array(i+r);return Ee(e,s,0),Ee(r,s,n),s.set(t,i),new Se(e,r,t,s)};class Se{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const Re=({name:e,code:t,encode:r})=>new Ie(e,t,r);class Ie{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ae(this.code,t):t.then((e=>Ae(this.code,e)))}throw Error("Unknown type, must be binary type")}}const xe=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Pe=Re({name:"sha2-256",code:18,encode:xe("SHA-256")}),Ce=Re({name:"sha2-512",code:19,encode:xe("SHA-512")}),Te=_,ke={code:0,name:"identity",encode:Te,digest:e=>Ae(0,Te(e))},De="raw",Oe=85,Ne=e=>_(e),Le=e=>_(e),Ue=new TextEncoder,Me=new TextDecoder,Be="json",Ke=512,$e=e=>Ue.encode(JSON.stringify(e)),Ve=e=>JSON.parse(Me.decode(e));new WeakMap;class je{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return je.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return je.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return je.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return format(this,e)}toJSON(){return{"/":format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof je)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new je(e,r,n,i||encodeCID(e,r,n.bytes))}if(!0===t[cidSymbol]){const{version:e,multihash:r,code:n}=t,i=Digest.decode(r);return je.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new je(e,t,r,r.bytes);case 1:{const n=encodeCID(e,t,r.bytes);return new je(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return je.create(0,DAG_PB_CODE,e)}static createV1(e,t){return je.create(1,e,t)}static decode(e){const[t,r]=je.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=je.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest.Digest(t.multihashCode,t.digestSize,i,n);return[0===t.version?je.createV0(s):je.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),i=DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),c=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:c-s,size:c}}static parse(e,t){const[r,n]=parseCIDtoBytes(e,t),i=je.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return baseCache(i).set(r,e),i}}Symbol.for("@ipld/js-cid/CID");const ze={...n,...i,...s,...o,...a,...c,...u,...l,...h,...d};function qe(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Fe(e=0){return null!=globalThis.Buffer?.allocUnsafe?qe(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Ge(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const He=Ge("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),We=Ge("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{const t=Fe((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var Ye={utf8:He,"utf-8":He,hex:ze.base16,latin1:We,ascii:We,binary:We,...ze};function Qe(e,t="utf8"){const r=Ye[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var Je=r(57050);function Ze(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=Fe(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return qe(r)}r(9839);var Xe=r(10430),et=r(13351),tt=r(62550);function rt(e,t="utf8"){const r=Ye[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):qe(globalThis.Buffer.from(e,"utf-8"))}var nt=r(49736);const it=nt.C,st=nt.aY,ot=function(e){let t=0;if(e=e.toString().trim(),it(e)){const r=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{r[t++]=255&parseInt(e,10)})),r}if(st(e)){const r=e.split(":",8);let n;for(n=0;n<r.length;n++){let e;it(r[n])&&(e=ot(r[n]),r[n]=Qe(e.slice(0,2),"base16")),null!=e&&++n<8&&r.splice(n,0,Qe(e.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&""!==r[n];n++);const e=[n,1];for(n=9-r.length;n>0;n--)e.push("0");r.splice.apply(r,e)}const i=new Uint8Array(t+16);for(n=0;n<r.length;n++){const e=parseInt(r[n],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},at=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let i=0;i<r;i++)n.push(e[t+i]);return n.join(".")}if(16===r){const e=[];for(let i=0;i<r;i+=2)e.push(n.getUint16(t+i).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var ct=r(66907);(0,ct.Ev)("ip4"),(0,ct.Ev)("ip6"),(0,ct.Ev)("ipcidr");function ut(e,t){switch((0,ct.Ev)(e).code){case 4:case 41:return function(e){const t=at(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!nt.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return mt(t);case 6:case 273:case 33:case 132:return yt(t).toString();case 421:return function(e){const t=Je.Jx(e),r=e.slice(Je.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return Qe(r,"base58btc")}(t);case 444:case 445:return bt(t);case 466:return function(e){const t=Je.Jx(e),r=e.slice(Je.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+Qe(r,"base64url")}(t);default:return Qe(t,"base16")}}function lt(e,t){switch((0,ct.Ev)(e).code){case 4:case 41:return ft(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return gt(t);case 6:case 273:case 33:case 132:return pt(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?tt.Jx(b.base58btc.decode(`z${e}`)).bytes:w.k0.parse(e).multihash.bytes;const r=Uint8Array.from(Je.cv(t.length));return Ze([r,t],r.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const r=Xe.base32.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=pt(n);return Ze([r,i],r.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const r=Xe.base32.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=pt(n);return Ze([r,i],r.length+i.length)}(t);case 466:return function(e){const t=dt.decode(e),r=Uint8Array.from(Je.cv(t.length));return Ze([r,t],r.length+t.length)}(t);default:return rt(t,"base16")}}const ht=Object.values(et.gh).map((e=>e.decoder)),dt=function(){let e=ht[0].or(ht[1]);return ht.slice(2).forEach((t=>e=e.or(t))),e}();function ft(e){if(!nt.h6(e))throw new Error("invalid ip address");return ot(e)}function pt(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function yt(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function gt(e){const t=rt(e),r=Uint8Array.from(Je.cv(t.length));return Ze([r,t],r.length+t.length)}function mt(e){const t=Je.Jx(e);if((e=e.slice(Je.P$(t))).length!==t)throw new Error("inconsistent lengths");return Qe(e)}function bt(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${Qe(t,"base32")}:${yt(r)}`}function wt(e){const t=[],r=[];let n=null,i=0;for(;i<e.length;){const s=Je.Jx(e,i),o=Je.P$(s),a=(0,ct.Ev)(s),c=_t(a,e.slice(i+o));if(0===c){t.push([s]),r.push([s]),i+=o;continue}const u=e.slice(i+o,i+o+c);if(i+=c+o,i>e.length)throw St("Invalid address Uint8Array: "+Qe(e,"base16"));t.push([s,u]);const l=ut(s,u);if(r.push([s,l]),!0===a.path){n=l;break}}return{bytes:Uint8Array.from(e),string:vt(r),tuples:t,stringTuples:r,path:n}}function vt(e){const t=[];return e.map((e=>{const r=(0,ct.Ev)(e[0]);return t.push(r.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),At(t.join("/"))}function Et(e){return Ze(e.map((e=>{const t=(0,ct.Ev)(e[0]);let r=Uint8Array.from(Je.cv(t.code));return e.length>1&&null!=e[1]&&(r=Ze([r,e[1]])),r})))}function _t(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=Je.Jx(t instanceof Uint8Array?t:Uint8Array.from(t));return e+Je.P$(e)}}function At(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function St(e){return new Error("Error parsing address: "+e)}const Rt=Symbol.for("nodejs.util.inspect.custom"),It=[(0,ct.Ev)("dns").code,(0,ct.Ev)("dns4").code,(0,ct.Ev)("dns6").code,(0,ct.Ev)("dnsaddr").code],xt=new Map,Pt=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Ct(e){return Boolean(e?.[Pt])}class Tt{bytes;#e;#t;#r;#n;[Pt]=!0;constructor(e){let t;if(null==e&&(e=""),e instanceof Uint8Array)t=wt(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);t=function(e){const t=[],r=[];let n=null;const i=(e=At(e)).split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<i.length;s++){const o=i[s],a=(0,ct.Ev)(o);if(0===a.size){t.push([a.code]),r.push([a.code]);continue}if(s++,s>=i.length)throw St("invalid address: "+e);if(!0===a.path){n=At(i.slice(s).join("/")),t.push([a.code,lt(a.code,n)]),r.push([a.code,n]);break}const c=lt(a.code,i[s]);t.push([a.code,c]),r.push([a.code,ut(a.code,c)])}return{string:vt(r),bytes:Et(t),tuples:t,stringTuples:r,path:n}}(e)}else{if(!Ct(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");t=wt(e.bytes)}this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,r,n,i="";const s=(0,ct.Ev)("tcp"),o=(0,ct.Ev)("udp"),a=(0,ct.Ev)("ip4"),c=(0,ct.Ev)("ip6"),u=(0,ct.Ev)("dns6"),l=(0,ct.Ev)("ip6zone");for(const[h,d]of this.stringTuples())h===l.code&&(i=`%${d??""}`),It.includes(h)&&(t=s.name,n=443,r=`${d??""}${i}`,e=h===u.code?6:4),h!==s.code&&h!==o.code||(t=(0,ct.Ev)(h).name,n=parseInt(d??"")),h!==a.code&&h!==c.code||(t=(0,ct.Ev)(h).name,r=`${d??""}${i}`,e=h===c.code?6:4);if(null==e||null==t||null==r||null==n)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:n}}protos(){return this.#t.map((([e])=>Object.assign({},(0,ct.Ev)(e))))}protoCodes(){return this.#t.map((([e])=>e))}protoNames(){return this.#t.map((([e])=>(0,ct.Ev)(e).name))}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(e){return e=new Tt(e),new Tt(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Tt(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new Tt(Et(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach((([t,r])=>{t===ct.R5.p2p.code&&e.push([t,r]),t===ct.R5["p2p-circuit"].code&&(e=[])}));const t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?Qe(b.base58btc.decode(`z${e}`),"base58btc"):Qe(w.k0.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return this.#n}equals(e){return function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const r=xt.get(t.name);if(null==r)throw new m.sv(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await r(this,e)).map((e=>new Tt(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[Rt](){return`Multiaddr(${this.#e})`}}function kt(e){return new Tt(e)}},66907:function(e,t,r){"use strict";r.d(t,{Ev:function(){return o},R5:function(){return i}});const n=-1,i={},s={};function o(e){if("number"==typeof e){if(null!=s[e])return s[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=i[e])return i[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,n,"ip6zone"],[43,8,"ipcidr"],[53,n,"dns",!0],[54,n,"dns4",!0],[55,n,"dns6",!0],[56,n,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,n,"unix",!1,!0],[421,n,"ipfs"],[421,n,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,n,"garlic64"],[448,0,"tls"],[449,n,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,n,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,n,"memory"]].forEach((e=>{const t=function(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}(...e);s[t.code]=t,i[t.name]=t}))},31650:function(e,t){"use strict";t.Z=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t}},34880:function(e,t,r){"use strict";var n=r(75671);t.Z=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)yield t(r)}();const r=(0,n.Z)(e),{value:i,done:s}=r.next();if(!0===s)return function*(){}();const o=t(i);if("function"==typeof o.then)return async function*(){yield await o;for await(const e of r)yield t(e)}();const a=t;return function*(){yield o;for(const e of r)yield a(e)}()}},86317:function(e,t,r){"use strict";r.d(t,{kU:function(){return h},Dp:function(){return l},ET:function(){return d}});var n=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===c;)n++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,u=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===u[p];)p++;for(var y=c.repeat(r);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}},i=r(59081);class s{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class o{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return c(this,e)}}class a{constructor(e){this.decoders=e}or(e){return c(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const c=(e,t)=>new a({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class u{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new s(e,t,r),this.decoder=new o(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const l=({name:e,prefix:t,encode:r,decode:n})=>new u(e,t,r,n),h=({prefix:e,name:t,alphabet:r})=>{const{encode:s,decode:o}=n(r,t);return l({prefix:e,name:t,encode:s,decode:e=>(0,i.oQ)(o(e))})},d=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>l({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s})(e,n,r),decode:t=>((e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);c=c<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)})},10430:function(e,t,r){"use strict";r.r(t),r.d(t,{base32:function(){return i},base32hex:function(){return c},base32hexpad:function(){return l},base32hexpadupper:function(){return h},base32hexupper:function(){return u},base32pad:function(){return o},base32padupper:function(){return a},base32upper:function(){return s},base32z:function(){return d}});var n=r(86317);const i=(0,n.ET)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),s=(0,n.ET)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o=(0,n.ET)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a=(0,n.ET)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),c=(0,n.ET)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),u=(0,n.ET)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),l=(0,n.ET)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),h=(0,n.ET)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d=(0,n.ET)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},55729:function(e,t,r){"use strict";r.r(t),r.d(t,{base58btc:function(){return i},base58flickr:function(){return s}});var n=r(86317);const i=(0,n.kU)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),s=(0,n.kU)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},35615:function(e,t,r){"use strict";r.r(t),r.d(t,{base64:function(){return i},base64pad:function(){return s},base64url:function(){return o},base64urlpad:function(){return a}});var n=r(86317);const i=(0,n.ET)({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),s=(0,n.ET)({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),o=(0,n.ET)({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),a=(0,n.ET)({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})},13351:function(e,t,r){"use strict";r.d(t,{gh:function(){return V}});var n={};r.r(n),r.d(n,{base10:function(){return f}});var i={};r.r(i),r.d(i,{base16:function(){return p},base16upper:function(){return y}});var s={};r.r(s),r.d(s,{base2:function(){return g}});var o={};r.r(o),r.d(o,{base256emoji:function(){return v}});var a={};r.r(a),r.d(a,{base36:function(){return _},base36upper:function(){return A}});var c={};r.r(c),r.d(c,{base8:function(){return I}});var u={};r.r(u),r.d(u,{identity:function(){return P}});var l={};r.r(l),r.d(l,{code:function(){return D},decode:function(){return N},encode:function(){return O},name:function(){return k}});var h={};r.r(h),r.d(h,{code:function(){return U},decode:function(){return B},encode:function(){return M},name:function(){return L}});var d=r(86317);const f=(0,d.kU)({prefix:"9",name:"base10",alphabet:"0123456789"}),p=(0,d.ET)({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),y=(0,d.ET)({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),g=(0,d.ET)({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),m=Array.from(""),b=m.reduce(((e,t,r)=>(e[r]=t,e)),[]),w=m.reduce(((e,t,r)=>(e[t.codePointAt(0)]=r,e)),[]);const v=(0,d.Dp)({prefix:"",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=b[t]),"")},decode:function(e){const t=[];for(const r of e){const e=w[r.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}});var E=r(10430);const _=(0,d.kU)({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),A=(0,d.kU)({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var S=r(55729),R=r(35615);const I=(0,d.ET)({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var x=r(59081);const P=(0,d.Dp)({prefix:"\0",name:"identity",encode:e=>(0,x.BB)(e),decode:e=>(0,x.mL)(e)}),C=new TextEncoder,T=new TextDecoder,k="json",D=512,O=e=>C.encode(JSON.stringify(e)),N=e=>JSON.parse(T.decode(e)),L="raw",U=85,M=e=>(0,x.oQ)(e),B=e=>(0,x.oQ)(e);var K=r(60150),$=r(59425);r(25674),r(62550),r(48378),r(24231);const V={...u,...s,...c,...n,...i,...E,...a,...S,...R,...o}},59081:function(e,t,r){"use strict";r.d(t,{BB:function(){return o},fS:function(){return n},mL:function(){return s},oQ:function(){return i}});new Uint8Array(0);const n=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},i=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},s=e=>(new TextEncoder).encode(e),o=e=>(new TextDecoder).decode(e)},25674:function(e,t,r){"use strict";r.d(t,{k0:function(){return h}});var n=r(10430),i=r(55729),s=r(59081),o=r(62550),a=r(24231);const c=(e,t)=>{const{bytes:r,version:s}=e;return 0===s?f(r,l(e),t||i.base58btc.encoder):p(r,l(e),t||n.base32.encoder)},u=new WeakMap,l=e=>{const t=u.get(e);if(null==t){const t=new Map;return u.set(e,t),t}return t};class h{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==y)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==g)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return h.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=o.Ue(e,t);return h.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return h.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&o.fS(e.multihash,r.multihash)}toString(e){return c(this,e)}toJSON(){return{"/":c(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof h)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:i}=t;return new h(e,r,n,i||m(e,r,n.bytes))}if(!0===t[b]){const{version:e,multihash:r,code:n}=t,i=o.Jx(r);return h.create(e,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==y)throw new Error(`Version 0 CID must use dag-pb (code: ${y}) block encoding`);return new h(e,t,r,r.bytes);case 1:{const n=m(e,t,r.bytes);return new h(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return h.create(0,y,e)}static createV1(e,t){return h.create(1,e,t)}static decode(e){const[t,r]=h.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=h.inspectBytes(e),r=t.size-t.multihashSize,n=(0,s.oQ)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),a=new o.zZ(t.multihashCode,t.digestSize,i,n);return[0===t.version?h.createV0(a):h.createV1(t.codec,a),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=a.Jx(e.subarray(t));return t+=n,r};let n=r(),i=y;if(18===n?(n=0,t=0):i=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),c=r(),u=t+c;return{version:n,codec:i,multihashCode:o,digestSize:c,multihashSize:u-s,size:u}}static parse(e,t){const[r,n]=d(e,t),i=h.decode(n);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return l(i).set(r,e),i}}const d=(e,t)=>{switch(e[0]){case"Q":{const r=t||i.base58btc;return[i.base58btc.prefix,r.decode(`${i.base58btc.prefix}${e}`)]}case i.base58btc.prefix:{const r=t||i.base58btc;return[i.base58btc.prefix,r.decode(e)]}case n.base32.prefix:{const r=t||n.base32;return[n.base32.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},f=(e,t,r)=>{const{prefix:n}=r;if(n!==i.base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const i=r.encode(e).slice(1);return t.set(n,i),i}return s},p=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},y=112,g=18,m=(e,t,r)=>{const n=a.P$(e),i=n+a.P$(t),s=new Uint8Array(i+r.byteLength);return a.mL(e,s,0),a.mL(t,s,n),s.set(r,i),s},b=Symbol.for("@ipld/js-cid/CID")},62550:function(e,t,r){"use strict";r.d(t,{Jx:function(){return o},Ue:function(){return s},fS:function(){return a},zZ:function(){return c}});var n=r(59081),i=r(24231);const s=(e,t)=>{const r=t.byteLength,n=i.P$(e),s=n+i.P$(r),o=new Uint8Array(s+r);return i.mL(e,o,0),i.mL(r,o,n),o.set(t,s),new c(e,r,t,o)},o=e=>{const t=(0,n.oQ)(e),[r,s]=i.Jx(t),[o,a]=i.Jx(t.subarray(s)),u=t.subarray(s+a);if(u.byteLength!==o)throw new Error("Incorrect length");return new c(r,o,u,t)},a=(e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,n.fS)(e.bytes,r.bytes)}};class c{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}},48378:function(e,t,r){"use strict";r.d(t,{D:function(){return i}});var n=r(62550);const i=({name:e,code:t,encode:r})=>new s(e,t,r);class s{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?n.Ue(this.code,t):t.then((e=>n.Ue(this.code,e)))}throw Error("Unknown type, must be binary type")}}},60150:function(e,t,r){"use strict";r.r(t),r.d(t,{identity:function(){return o}});var n=r(59081),i=r(62550);const s=n.oQ,o={code:0,name:"identity",encode:s,digest:e=>i.Ue(0,s(e))}},59425:function(e,t,r){"use strict";r.r(t),r.d(t,{sha256:function(){return s},sha512:function(){return o}});var n=r(48378);const i=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),s=(0,n.D)({name:"sha2-256",code:18,encode:i("SHA-256")}),o=(0,n.D)({name:"sha2-512",code:19,encode:i("SHA-512")})},24231:function(e,t,r){"use strict";r.d(t,{Jx:function(){return v},mL:function(){return E},P$:function(){return _}});var n=function e(t,r,n){r=r||[];var a=n=n||0;for(;t>=o;)r[n++]=255&t|i,t/=128;for(;t&s;)r[n++]=255&t|i,t>>>=7;return r[n]=0|t,e.bytes=n-a+1,r},i=128,s=-128,o=Math.pow(2,31);var a=function e(t,r){var n,i=0,s=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],i+=s<28?(n&u)<<s:(n&u)*Math.pow(2,s),s+=7}while(n>=c);return e.bytes=o-r,i},c=128,u=127;var l=Math.pow(2,7),h=Math.pow(2,14),d=Math.pow(2,21),f=Math.pow(2,28),p=Math.pow(2,35),y=Math.pow(2,42),g=Math.pow(2,49),m=Math.pow(2,56),b=Math.pow(2,63),w={encode:n,decode:a,encodingLength:function(e){return e<l?1:e<h?2:e<d?3:e<f?4:e<p?5:e<y?6:e<g?7:e<m?8:e<b?9:10}};const v=(e,t=0)=>[w.decode(e,t),w.decode.bytes],E=(e,t,r=0)=>(w.encode(e,t,r),t),_=e=>w.encodingLength(e)},9398:function(e,t,r){"use strict";r.d(t,{Z:function(){return K}});var n=r(72287),i=r.n(n),s=r(71198);var o,a=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};o=new WeakMap;var c,u,l,h,d,f,p,y,g,m,b,w,v,E,_,A,S,R,I,x,P,C,T,k,D,O,N=class{constructor(){o.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&a(this,o,"f")[this.size-1].priority>=t.priority)return void a(this,o,"f").push(r);const n=function(e,t,r){let n=0,i=e.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}(a(this,o,"f"),r,((e,t)=>t.priority-e.priority));a(this,o,"f").splice(n,0,r)}dequeue(){const e=a(this,o,"f").shift();return null==e?void 0:e.run}filter(e){return a(this,o,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return a(this,o,"f").length}},L=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},U=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class M extends Error{}class B extends(i()){constructor(e){var t,r,n,i;if(super(),c.add(this),u.set(this,void 0),l.set(this,void 0),h.set(this,0),d.set(this,void 0),f.set(this,void 0),p.set(this,0),y.set(this,void 0),g.set(this,void 0),m.set(this,void 0),b.set(this,void 0),w.set(this,0),v.set(this,void 0),E.set(this,void 0),_.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:N,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);L(this,u,e.carryoverConcurrencyCount,"f"),L(this,l,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),L(this,d,e.intervalCap,"f"),L(this,f,e.interval,"f"),L(this,m,new e.queueClass,"f"),L(this,b,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,L(this,_,!0===e.throwOnTimeout,"f"),L(this,E,!1===e.autoStart,"f")}get concurrency(){return U(this,v,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);L(this,v,e,"f"),U(this,c,"m",k).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:U(this,_,"f"),...t},new Promise(((r,n)=>{U(this,m,"f").enqueue((async()=>{var i,o,a;L(this,w,(o=U(this,w,"f"),++o),"f"),L(this,h,(a=U(this,h,"f"),++a),"f");try{if(null===(i=t.signal)||void 0===i?void 0:i.aborted)throw new M("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=(0,s.ZP)(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,U(this,c,"m",D).call(this,t.signal)]));const o=await n;r(o),this.emit("completed",o)}catch(e){if(e instanceof s.W5&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{U(this,c,"m",R).call(this)}}),t),this.emit("add"),U(this,c,"m",P).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return U(this,E,"f")?(L(this,E,!1,"f"),U(this,c,"m",k).call(this),this):this}pause(){L(this,E,!0,"f")}clear(){L(this,m,new(U(this,b,"f")),"f")}async onEmpty(){0!==U(this,m,"f").size&&await U(this,c,"m",O).call(this,"empty")}async onSizeLessThan(e){U(this,m,"f").size<e||await U(this,c,"m",O).call(this,"next",(()=>U(this,m,"f").size<e))}async onIdle(){0===U(this,w,"f")&&0===U(this,m,"f").size||await U(this,c,"m",O).call(this,"idle")}get size(){return U(this,m,"f").size}sizeBy(e){return U(this,m,"f").filter(e).length}get pending(){return U(this,w,"f")}get isPaused(){return U(this,E,"f")}}u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,y=new WeakMap,g=new WeakMap,m=new WeakMap,b=new WeakMap,w=new WeakMap,v=new WeakMap,E=new WeakMap,_=new WeakMap,c=new WeakSet,A=function(){return U(this,l,"f")||U(this,h,"f")<U(this,d,"f")},S=function(){return U(this,w,"f")<U(this,v,"f")},R=function(){var e;L(this,w,(e=U(this,w,"f"),--e),"f"),U(this,c,"m",P).call(this),this.emit("next")},I=function(){U(this,c,"m",T).call(this),U(this,c,"m",C).call(this),L(this,g,void 0,"f")},x=function(){const e=Date.now();if(void 0===U(this,y,"f")){const t=U(this,p,"f")-e;if(!(t<0))return void 0===U(this,g,"f")&&L(this,g,setTimeout((()=>{U(this,c,"m",I).call(this)}),t),"f"),!0;L(this,h,U(this,u,"f")?U(this,w,"f"):0,"f")}return!1},P=function(){if(0===U(this,m,"f").size)return U(this,y,"f")&&clearInterval(U(this,y,"f")),L(this,y,void 0,"f"),this.emit("empty"),0===U(this,w,"f")&&this.emit("idle"),!1;if(!U(this,E,"f")){const e=!U(this,c,"a",x);if(U(this,c,"a",A)&&U(this,c,"a",S)){const t=U(this,m,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&U(this,c,"m",C).call(this),!0)}}return!1},C=function(){U(this,l,"f")||void 0!==U(this,y,"f")||(L(this,y,setInterval((()=>{U(this,c,"m",T).call(this)}),U(this,f,"f")),"f"),L(this,p,Date.now()+U(this,f,"f"),"f"))},T=function(){0===U(this,h,"f")&&0===U(this,w,"f")&&U(this,y,"f")&&(clearInterval(U(this,y,"f")),L(this,y,void 0,"f")),L(this,h,U(this,u,"f")?U(this,w,"f"):0,"f"),U(this,c,"m",k).call(this)},k=function(){for(;U(this,c,"m",P).call(this););},D=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new M("The task was aborted."))}),{once:!0})}))},O=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var K=B},77539:function(e,t,r){"use strict";r.d(t,{E:function(){return i}});var n=r(26175);function i(e=0){return null!=globalThis.Buffer?.allocUnsafe?(0,n.P)(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}},29124:function(e,t,r){"use strict";r.d(t,{z:function(){return s}});var n=r(77539),i=r(26175);function s(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const r=(0,n.E)(t);let s=0;for(const t of e)r.set(t,s),s+=t.length;return(0,i.P)(r)}},8611:function(e,t,r){"use strict";function n(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}r.d(t,{f:function(){return n}})},97858:function(e,t,r){"use strict";r.d(t,{m:function(){return s}});var n=r(26175),i=r(7394);function s(e,t="utf8"){const r=i.Z[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):(0,n.P)(globalThis.Buffer.from(e,"utf-8"))}},2291:function(e,t,r){"use strict";r.d(t,{B:function(){return i}});var n=r(7394);function i(e,t="utf8"){const r=n.Z[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}},26175:function(e,t,r){"use strict";function n(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}r.d(t,{P:function(){return n}})},7394:function(e,t,r){"use strict";var n=r(13351),i=r(77539);function s(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const o=s("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),a=s("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{e=e.substring(1);const t=(0,i.E)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),c={utf8:o,"utf-8":o,hex:n.gh.base16,latin1:a,ascii:a,binary:a,...n.gh};t.Z=c},72004:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(11067);const i=4294967296;class s{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(!0===e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){const e=-(1&this.lo),t=((this.lo>>>1|this.hi<<31)^e)>>>0,r=(this.hi>>>1^e)>>>0;return new s(r,t)}zzEncode(){const e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,r=(this.lo<<1^e)>>>0;return new s(t,r)}toBytes(e,t=0){const r=(0,n.Z)(e);for(;this.hi>0;)r.set(t++,127&this.lo|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)r.set(t++,127&this.lo|128),this.lo=this.lo>>>7;r.set(t++,this.lo)}static fromBigInt(e){if(0n===e)return new s;const t=e<0;t&&(e=-e);let r=0|Number(e>>32n),n=0|Number(e-(BigInt(r)<<32n));return t&&(r=~r>>>0,n=~n>>>0,++n>i&&(n=0,++r>i&&(r=0))),new s(r,n)}static fromNumber(e){if(0===e)return new s;const t=e<0;t&&(e=-e);let r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new s(n,r)}static fromBytes(e,t=0){const r=(0,n.Z)(e),i=new s;let o=0;if(e.length-t>4){for(;o<4;++o)if(i.lo=(i.lo|(127&r.get(t))<<7*o)>>>0,r.get(t++)<128)return i;if(i.lo=(i.lo|(127&r.get(t))<<28)>>>0,i.hi=(i.hi|(127&r.get(t))>>4)>>>0,r.get(t++)<128)return i;o=0}else for(;o<4;++o){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.lo=(i.lo|(127&r.get(t))<<7*o)>>>0,r.get(t++)<128)return i}if(e.length-t>4){for(;o<5;++o)if(i.hi=(i.hi|(127&r.get(t))<<7*o+3)>>>0,r.get(t++)<128)return i}else if(t<e.byteLength)for(;o<5;++o){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(i.hi=(i.hi|(127&r.get(t))<<7*o+3)>>>0,r.get(t++)<128)return i}throw RangeError("invalid varint encoding")}}},95155:function(e,t,r){"use strict";r.d(t,{Z:function(){return R}});var n=r(28364);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}class s extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const o=e=>void 0===globalThis.DOMException?new s(e):new DOMException(e),a=e=>{const t=void 0===e.reason?o("This operation was aborted."):e.reason;return t instanceof Error?t:o(t)};var c=r(53416);const u="lock:worker:request-read",l="lock:worker:release-read",h="lock:master:grant-read",d="lock:worker:request-write",f="lock:worker:release-write",p="lock:master:grant-write";var y=r(19348);const g=(e,t,r,n,i)=>(s,o)=>{if(o.data.type!==r)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>(s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise((e=>{const t=r=>{if(null==r||null==r.data)return;const i=r.data.type,o=(r.data.name,r.data.identifier);i===n&&o===a.identifier&&(s.removeEventListener("message",t),e())};s.addEventListener("message",t)})))}}))},m=(e,t,r,n)=>async()=>{const i=(0,c.x0)();return globalThis.postMessage({type:t,identifier:i,name:e}),await new Promise((t=>{const s=o=>{if(null==o||null==o.data)return;const a=o.data.type,c=o.data.identifier;a===r&&c===i&&(globalThis.removeEventListener("message",s),t((()=>{globalThis.postMessage({type:n,identifier:i,name:e})})))};globalThis.addEventListener("message",s)}))},b={singleProcess:!1};var w=e=>{e=Object.assign({},b,e);if(Boolean(globalThis.document)||e.singleProcess){const e=new EventTarget;return y.Z.addEventListener("message",g(e,"requestReadLock",u,l,h)),y.Z.addEventListener("message",g(e,"requestWriteLock",d,f,p)),e}return{isWorker:!0,readLock:e=>m(e,u,h,l),writeLock:e=>m(e,d,p,f)}};const v={};let E;async function _(e,t){let r;const n=new Promise((e=>{r=e}));return e.add((async()=>await function(e,t){const{milliseconds:r,fallback:n,message:s,customTimers:o={setTimeout:setTimeout,clearTimeout:clearTimeout}}=t;let c;const u=new Promise(((u,l)=>{if("number"!=typeof r||1!==Math.sign(r))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(r===Number.POSITIVE_INFINITY)return void u(e);if(t.signal){const{signal:e}=t;e.aborted&&l(a(e)),e.addEventListener("abort",(()=>{l(a(e))}))}const h=new i;c=o.setTimeout.call(void 0,(()=>{if(n)try{u(n())}catch(e){l(e)}else"function"==typeof e.cancel&&e.cancel(),!1===s?u():s instanceof Error?l(s):(h.message=s??`Promise timed out after ${r} milliseconds`,l(h))}),r),(async()=>{try{u(await e)}catch(e){l(e)}finally{o.clearTimeout.call(void 0,c)}})()}));return u.clear=()=>{o.clearTimeout.call(void 0,c),c=void 0},u}((async()=>await new Promise((e=>{r((()=>{e()}))})))(),{milliseconds:t.timeout}))),await n}const A=(e,t)=>{if(!0===E.isWorker)return{readLock:E.readLock(e,t),writeLock:E.writeLock(e,t)};const r=new n.Z({concurrency:1});let i;return{async readLock(){if(null!=i)return await _(i,t);i=new n.Z({concurrency:t.concurrency,autoStart:!1});const e=i,s=_(i,t);return r.add((async()=>(e.start(),await e.onIdle().then((()=>{i===e&&(i=null)}))))),await s},writeLock:async()=>(i=null,await _(r,t))}},S={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function R(e){const t=Object.assign({},S,e);return null==E&&(E=w(t),!0!==E.isWorker&&(E.addEventListener("requestReadLock",(e=>{null!=v[e.data.name]&&v[e.data.name].readLock().then((async t=>await e.data.handler().finally((()=>t()))))})),E.addEventListener("requestWriteLock",(async e=>{null!=v[e.data.name]&&v[e.data.name].writeLock().then((async t=>await e.data.handler().finally((()=>t()))))})))),null==v[t.name]&&(v[t.name]=A(t.name,t)),v[t.name]}}}]);
//# sourceMappingURL=698.d0b17df8.chunk.js.map