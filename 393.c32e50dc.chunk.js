/*! For license information please see 393.c32e50dc.chunk.js.LICENSE.txt */
(self.webpackChunkcyb=self.webpackChunkcyb||[]).push([[393],{19824:function(e,t,r){"use strict";var n=r(25108);const s=-8,i=-4,o=0,a=1,c=1,h=2,u=5,l=1024,d=2048,f=8192,p=0,g=4,m=8,y=12,b=12,w=16,v="undefined"!=typeof BigUint64Array,_=Symbol(),E=1024;function k(e,t){const r=new Uint32Array(e),n=new Uint16Array(e);var s=r[t+i>>>2]>>>1,o=t>>>1;if(s<=E)return String.fromCharCode.apply(String,n.subarray(o,o+s));const a=[];do{const e=n[o+E-1],t=e>=55296&&e<56320?E-1:E;a.push(String.fromCharCode.apply(String,n.subarray(o,o+=t))),s-=t}while(s>E);return a.join("")+String.fromCharCode.apply(String,n.subarray(o,o+s))}function S(e){const t={};function r(e,t){return e?k(e.buffer,t):"<yet unknown>"}const s=e.env=e.env||{};return s.abort=s.abort||function(e,n,i,o){const a=t.memory||s.memory;throw Error("abort: "+r(a,e)+" at "+r(a,n)+":"+i+":"+o)},s.trace=s.trace||function(e,i){const o=t.memory||s.memory;n.log("trace: "+r(o,e)+(i?" ":"")+Array.prototype.slice.call(arguments,2,2+i).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function x(e,t){const r=t.exports,n=r.memory,_=r.table,E=r.__alloc,S=r.__retain,x=r.__rtti_base||-1;function I(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[x>>>2])throw Error("invalid id: "+e);return t[(x+4>>>2)+2*e]}function T(e){const t=new Uint32Array(n.buffer);if((e>>>=0)>=t[x>>>2])throw Error("invalid id: "+e);return t[(x+4>>>2)+2*e+1]}function A(e){return 31-Math.clz32(e>>>u&31)}function P(e,t,r){const s=n.buffer;if(r)switch(e){case 2:return new Float32Array(s);case 3:return new Float64Array(s)}else switch(e){case 0:return new(t?Int8Array:Uint8Array)(s);case 1:return new(t?Int16Array:Uint16Array)(s);case 2:return new(t?Int32Array:Uint32Array)(s);case 3:return new(t?BigInt64Array:BigUint64Array)(s)}throw Error("unsupported align: "+e)}function C(e){const t=new Uint32Array(n.buffer),r=t[e+s>>>2],o=I(r);if(!(o&c))throw Error("not an array: "+r);const a=A(o);var u=t[e+g>>>2];const f=o&h?t[e+b>>>2]:t[u+i>>>2]>>>a;return P(a,o&l,o&d).subarray(u>>>=a,u+f)}function M(e,t,r){return new e(R(e,t,r))}function R(e,t,r){const s=n.buffer,o=new Uint32Array(s),a=o[r+g>>>2];return new e(s,a,o[a+i>>>2]>>>t)}return e.__allocString=function(e){const t=e.length,r=E(t<<1,a),s=new Uint16Array(n.buffer);for(var i=0,o=r>>>1;i<t;++i)s[o+i]=e.charCodeAt(i);return r},e.__getString=function(e){const t=n.buffer;if(new Uint32Array(t)[e+s>>>2]!==a)throw Error("not a string: "+e);return k(t,e)},e.__allocArray=function(e,t){const r=I(e);if(!(r&(c|h)))throw Error("not an array: "+e+" @ "+r);const s=A(r),i=t.length,a=E(i<<s,o),u=E(r&h?w:y,e),v=new Uint32Array(n.buffer);v[u+p>>>2]=S(a),v[u+g>>>2]=a,v[u+m>>>2]=i<<s,r&h&&(v[u+b>>>2]=i);const _=P(s,r&l,r&d);if(r&f)for(let e=0;e<i;++e)_[(a>>>s)+e]=S(t[e]);else _.set(t,a>>>s);return u},e.__getArrayView=C,e.__getArray=function(e){const t=C(e),r=t.length,n=new Array(r);for(let e=0;e<r;e++)n[e]=t[e];return n},e.__getArrayBuffer=function(e){const t=n.buffer,r=new Uint32Array(t)[e+i>>>2];return t.slice(e,e+r)},e.__getInt8Array=M.bind(null,Int8Array,0),e.__getInt8ArrayView=R.bind(null,Int8Array,0),e.__getUint8Array=M.bind(null,Uint8Array,0),e.__getUint8ArrayView=R.bind(null,Uint8Array,0),e.__getUint8ClampedArray=M.bind(null,Uint8ClampedArray,0),e.__getUint8ClampedArrayView=R.bind(null,Uint8ClampedArray,0),e.__getInt16Array=M.bind(null,Int16Array,1),e.__getInt16ArrayView=R.bind(null,Int16Array,1),e.__getUint16Array=M.bind(null,Uint16Array,1),e.__getUint16ArrayView=R.bind(null,Uint16Array,1),e.__getInt32Array=M.bind(null,Int32Array,2),e.__getInt32ArrayView=R.bind(null,Int32Array,2),e.__getUint32Array=M.bind(null,Uint32Array,2),e.__getUint32ArrayView=R.bind(null,Uint32Array,2),v&&(e.__getInt64Array=M.bind(null,BigInt64Array,3),e.__getInt64ArrayView=R.bind(null,BigInt64Array,3),e.__getUint64Array=M.bind(null,BigUint64Array,3),e.__getUint64ArrayView=R.bind(null,BigUint64Array,3)),e.__getFloat32Array=M.bind(null,Float32Array,2),e.__getFloat32ArrayView=R.bind(null,Float32Array,2),e.__getFloat64Array=M.bind(null,Float64Array,3),e.__getFloat64ArrayView=R.bind(null,Float64Array,3),e.__instanceof=function(e,t){const r=new Uint32Array(n.buffer);var i=r[e+s>>>2];if(i<=r[x>>>2])do{if(i==t)return!0}while(i=T(i));return!1},e.memory=e.memory||n,e.table=e.table||_,D(r,e)}function I(e){return"undefined"!=typeof Response&&e instanceof Response}async function T(e,t){return I(e=await e)?A(e,t):x(S(t||(t={})),await WebAssembly.instantiate(e instanceof WebAssembly.Module?e:await WebAssembly.compile(e),t))}async function A(e,t){return WebAssembly.instantiateStreaming?x(S(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance):T(I(e=await e)?e.arrayBuffer():e,t)}function D(e,t){var r=t?Object.create(t):{},n=e.__argumentsLength?function(t){e.__argumentsLength.value=t}:e.__setArgumentsLength||e.__setargc||function(){};for(let t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const s=e[t];let i=t.split("."),o=r;for(;i.length>1;){let e=i.shift();Object.prototype.hasOwnProperty.call(o,e)||(o[e]={}),o=o[e]}let a=i[0],c=a.indexOf("#");if(c>=0){let r=a.substring(0,c),i=o[r];if(void 0===i||!i.prototype){let e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={valueOf:function(){return this[_]}},e.wrap=function(t){return Object.create(e.prototype,{[_]:{value:t,writable:!1}})},i&&Object.getOwnPropertyNames(i).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t)))),o[r]=e}if(a=a.substring(c+1),o=o[r].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let r=e[t.replace("set:","get:")],n=e[t.replace("get:","set:")];Object.defineProperty(o,a,{get:function(){return r(this[_])},set:function(e){n(this[_],e)},enumerable:!0})}}else"constructor"===a?(o[a]=(...e)=>(n(e.length),s(...e))).original=s:(o[a]=function(...e){return n(e.length),s(this[_],...e)}).original=s}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:e[t.replace("set:","get:")],set:e[t.replace("get:","set:")],enumerable:!0}):"function"==typeof s&&s!==n?(o[a]=(...e)=>(n(e.length),s(...e))).original=s:o[a]=s}return r}t.instantiate=T,t.instantiateSync=function(e,t){return x(S(t||(t={})),new WebAssembly.Instance(e instanceof WebAssembly.Module?e:new WebAssembly.Module(e),t))},t.instantiateStreaming=A,t.demangle=D},42450:function(e,t,r){"use strict";e.exports=r(10077)},19464:function(e,t,r){"use strict";const{fromCallback:n}=r(16957),s=r(31648),{getCallback:i,getOptions:o}=r(92520),a=Symbol("promise"),c=Symbol("status"),h=Symbol("operations"),u=Symbol("finishClose"),l=Symbol("closeCallbacks");t.AbstractChainedBatch=class{constructor(e){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}this[h]=[],this[l]=[],this[c]="open",this[u]=this[u].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[h].length}put(e,t,r){if("open"!==this[c])throw new s("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;const i=r&&null!=r.sublevel?r.sublevel:this.db,o=r,a=i.keyEncoding(r&&r.keyEncoding),u=i.valueEncoding(r&&r.valueEncoding),l=a.format;r={...r,keyEncoding:l,valueEncoding:u.format},i!==this.db&&(r.sublevel=null);const d=i.prefixKey(a.encode(e),l),f=u.encode(t);return this._put(d,f,r),this[h].push({...o,type:"put",key:e,value:t}),this}_put(e,t,r){}del(e,t){if("open"!==this[c])throw new s("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(e);if(r)throw r;const n=t&&null!=t.sublevel?t.sublevel:this.db,i=t,o=n.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},n!==this.db&&(t.sublevel=null),this._del(n.prefixKey(o.encode(e),a),t),this[h].push({...i,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[c])throw new s("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[h]=[],this}_clear(){}write(e,t){return t=i(e,t),t=n(t,a),e=o(e),"open"!==this[c]?this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[c]="writing",this._write(e,(e=>{this[c]="closing",this[l].push((()=>t(e))),e||this.db.emit("batch",this[h]),this._close(this[u])}))),t[a]}_write(e,t){}close(e){return e=n(e,a),"closing"===this[c]?this[l].push(e):"closed"===this[c]?this.nextTick(e):(this[l].push(e),"writing"!==this[c]&&(this[c]="closing",this._close(this[u]))),e[a]}_close(e){this.nextTick(e)}[u](){this[c]="closed",this.db.detachResource(this);const e=this[l];this[l]=[];for(const t of e)t()}}},33961:function(e,t,r){"use strict";var n=r(25108);const{fromCallback:s}=r(16957),i=r(31648),{getOptions:o,getCallback:a}=r(92520),c=Symbol("promise"),h=Symbol("callback"),u=Symbol("working"),l=Symbol("handleOne"),d=Symbol("handleMany"),f=Symbol("autoClose"),p=Symbol("finishWork"),g=Symbol("returnMany"),m=Symbol("closing"),y=Symbol("handleClose"),b=Symbol("closed"),w=Symbol("closeCallbacks"),v=Symbol("keyEncoding"),_=Symbol("valueEncoding"),E=Symbol("abortOnClose"),k=Symbol("legacy"),S=Symbol("keys"),x=Symbol("values"),I=Symbol("limit"),T=Symbol("count"),A=Object.freeze({}),D=()=>{};let P=!1;class C{constructor(e,t,r){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}if("object"!=typeof t||null===t)throw new TypeError("The second argument must be an options object");this[b]=!1,this[w]=[],this[u]=!1,this[m]=!1,this[f]=!1,this[h]=null,this[l]=this[l].bind(this),this[d]=this[d].bind(this),this[y]=this[y].bind(this),this[v]=t[v],this[_]=t[_],this[k]=r,this[I]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[T]=0,this[E]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[T]}get limit(){return this[I]}next(e){let t;if(void 0===e)t=new Promise(((t,r)=>{e=(e,n,s)=>{e?r(e):this[k]?void 0===n&&void 0===s?t():t([n,s]):t(n)}}));else if("function"!=typeof e)throw new TypeError("Callback must be a function");return this[m]?this.nextTick(e,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[u]?this.nextTick(e,new i("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[u]=!0,this[h]=e,this[T]>=this[I]?this.nextTick(this[l],null):this._next(this[l])),t}_next(e){this.nextTick(e)}nextv(e,t,r){return r=a(t,r),r=s(r,c),t=o(t,A),Number.isInteger(e)?(this[m]?this.nextTick(r,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[u]?this.nextTick(r,new i("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[I]<1/0&&(e=Math.min(e,this[I]-this[T])),this[u]=!0,this[h]=r,e<=0?this.nextTick(this[d],null,[]):this._nextv(e,t,this[d])),r[c]):(this.nextTick(r,new TypeError("The first argument 'size' must be an integer")),r[c])}_nextv(e,t,r){const n=[],s=(t,i,o)=>t?r(t):(this[k]?void 0===i&&void 0===o:void 0===i)?r(null,n):(n.push(this[k]?[i,o]:i),void(n.length===e?r(null,n):this._next(s)));this._next(s)}all(e,t){return t=a(e,t),t=s(t,c),e=o(e,A),this[m]?this.nextTick(t,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[u]?this.nextTick(t,new i("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[u]=!0,this[h]=t,this[f]=!0,this[T]>=this[I]?this.nextTick(this[d],null,[]):this._all(e,this[d])),t[c]}_all(e,t){let r=this[T];const n=[],s=()=>{const e=this[I]<1/0?Math.min(1e3,this[I]-r):1e3;e<=0?this.nextTick(t,null,n):this._nextv(e,A,i)},i=(e,i)=>{e?t(e):0===i.length?t(null,n):(n.push.apply(n,i),r+=i.length,s())};s()}[p](){const e=this[h];return this[E]&&null===e?D:(this[u]=!1,this[h]=null,this[m]&&this._close(this[y]),e)}[g](e,t,r){this[f]?this.close(e.bind(null,t,r)):e(t,r)}seek(e,t){if(t=o(t,A),this[m]);else{if(this[u])throw new i("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const r=this.db.keyEncoding(t.keyEncoding||this[v]),n=r.format;t.keyEncoding!==n&&(t={...t,keyEncoding:n});const s=this.db.prefixKey(r.encode(e),n);this._seek(s,t)}}}_seek(e,t){throw new i("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){if(e=s(e,c),this[b])this.nextTick(e);else if(this[m])this[w].push(e);else if(this[m]=!0,this[w].push(e),this[u]){if(this[E]){this[p]()(new i("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))}}else this._close(this[y]);return e[c]}_close(e){this.nextTick(e)}[y](){this[b]=!0,this.db.detachResource(this);const e=this[w];this[w]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[b]||await this.close()}}}class M extends C{constructor(e,t){super(e,t,!0),this[S]=!1!==t.keys,this[x]=!1!==t.values}[l](e,t,r){const n=this[p]();if(e)return n(e);try{t=this[S]&&void 0!==t?this[v].decode(t):void 0,r=this[x]&&void 0!==r?this[_].decode(r):void 0}catch(e){return n(new R("entry",e))}void 0===t&&void 0===r||this[T]++,n(null,t,r)}[d](e,t){const r=this[p]();if(e)return this[g](r,e);try{for(const e of t){const t=e[0],r=e[1];e[0]=this[S]&&void 0!==t?this[v].decode(t):void 0,e[1]=this[x]&&void 0!==r?this[_].decode(r):void 0}}catch(e){return this[g](r,new R("entries",e))}this[T]+=t.length,this[g](r,null,t)}end(e){return P||void 0===n||(P=!0,n.warn(new i("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class R extends i{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const e of["_ended property","_nexting property","_end method"])Object.defineProperty(M.prototype,e.split(" ")[0],{get(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})}});M.keyEncoding=v,M.valueEncoding=_,t.AbstractIterator=M,t.AbstractKeyIterator=class extends C{constructor(e,t){super(e,t,!1)}[l](e,t){const r=this[p]();if(e)return r(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return r(new R("key",e))}void 0!==t&&this[T]++,r(null,t)}[d](e,t){const r=this[p]();if(e)return this[g](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[v].decode(r):void 0}}catch(e){return this[g](r,new R("keys",e))}this[T]+=t.length,this[g](r,null,t)}},t.AbstractValueIterator=class extends C{constructor(e,t){super(e,t,!1)}[l](e,t){const r=this[p]();if(e)return r(e);try{t=void 0!==t?this[_].decode(t):void 0}catch(e){return r(new R("value",e))}void 0!==t&&this[T]++,r(null,t)}[d](e,t){const r=this[p]();if(e)return this[g](r,e);try{for(let e=0;e<t.length;e++){const r=t[e];t[e]=void 0!==r?this[_].decode(r):void 0}}catch(e){return this[g](r,new R("values",e))}this[T]+=t.length,this[g](r,null,t)}}},69071:function(e,t,r){"use strict";const{supports:n}=r(80724),{Transcoder:s}=r(58499),{EventEmitter:i}=r(17187),{fromCallback:o}=r(16957),a=r(31648),{AbstractIterator:c}=r(33961),{DefaultKeyIterator:h,DefaultValueIterator:u}=r(95429),{DeferredIterator:l,DeferredKeyIterator:d,DeferredValueIterator:f}=r(30593),{DefaultChainedBatch:p}=r(4765),{getCallback:g,getOptions:m}=r(92520),y=r(70056),b=Symbol("promise"),w=Symbol("landed"),v=Symbol("resources"),_=Symbol("closeResources"),E=Symbol("operations"),k=Symbol("undefer"),S=Symbol("deferOpen"),x=Symbol("options"),I=Symbol("status"),T=Symbol("defaultOptions"),A=Symbol("transcoder"),D=Symbol("keyEncoding"),P=Symbol("valueEncoding"),C=()=>{};class M extends i{constructor(e,t){if(super(),"object"!=typeof e||null===e)throw new TypeError("The first argument 'manifest' must be an object");t=m(t);const{keyEncoding:r,valueEncoding:i,passive:o,...a}=t;this[v]=new Set,this[E]=[],this[S]=!0,this[x]=a,this[I]="opening",this.supports=n(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[A]=new s(N(this)),this[D]=this[A].encoding(r||"utf8"),this[P]=this[A].encoding(i||"utf8");for(const e of this[A].encodings())this.supports.encodings[e.commonName]||(this.supports.encodings[e.commonName]=!0);this[T]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[D].commonName,valueEncoding:this[P].commonName}),key:Object.freeze({keyEncoding:this[D].commonName})},this.nextTick((()=>{this[S]&&this.open({passive:!1},C)}))}get status(){return this[I]}keyEncoding(e){return this[A].encoding(null!=e?e:this[D])}valueEncoding(e){return this[A].encoding(null!=e?e:this[P])}open(e,t){t=g(e,t),t=o(t,b),(e={...this[x],...m(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;const r=e=>{"closing"===this[I]||"opening"===this[I]?this.once(w,e?()=>r(e):r):"open"!==this[I]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[I]?this.once(w,r):this.nextTick(r):"closed"===this[I]||this[S]?(this[S]=!1,this[I]="opening",this.emit("opening"),this._open(e,(e=>{if(e)return this[I]="closed",this[_]((()=>{this.emit(w),r(e)})),void this[k]();this[I]="open",this[k](),this.emit(w),"open"===this[I]&&this.emit("open"),"open"===this[I]&&this.emit("ready"),r()}))):"open"===this[I]?this.nextTick(r):this.once(w,(()=>this.open(e,t))),t[b]}_open(e,t){this.nextTick(t)}close(e){e=o(e,b);const t=r=>{"opening"===this[I]||"closing"===this[I]?this.once(w,r?t(r):t):"closed"!==this[I]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):e()};if("open"===this[I]){this[I]="closing",this.emit("closing");const e=e=>{this[I]="open",this[k](),this.emit(w),t(e)};this[_]((()=>{this._close((r=>{if(r)return e(r);this[I]="closed",this[k](),this.emit(w),"closed"===this[I]&&this.emit("closed"),t()}))}))}else"closed"===this[I]?this.nextTick(t):this.once(w,(()=>this.close(e)));return e[b]}[_](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,r=!0;const n=()=>{0==--t&&(r?this.nextTick(e):e())};for(const e of this[v])e.close(n);r=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,r){if(r=g(t,r),r=o(r,b),t=m(t,this[T].entry),"opening"===this[I])return this.defer((()=>this.get(e,t,r))),r[b];if(O(this,r))return r[b];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];const s=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),c=s.format,h=i.format;return t.keyEncoding===c&&t.valueEncoding===h||(t=Object.assign({},t,{keyEncoding:c,valueEncoding:h})),this._get(this.prefixKey(s.encode(e),c),t,((e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),r(e);try{t=i.decode(t)}catch(e){return r(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[b]}_get(e,t,r){this.nextTick(r,new Error("NotFound"))}getMany(e,t,r){if(r=g(t,r),r=o(r,b),t=m(t,this[T].entry),"opening"===this[I])return this.defer((()=>this.getMany(e,t,r))),r[b];if(O(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'keys' must be an array")),r[b];if(0===e.length)return this.nextTick(r,null,[]),r[b];const n=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),i=n.format,c=s.format;t.keyEncoding===i&&t.valueEncoding===c||(t=Object.assign({},t,{keyEncoding:i,valueEncoding:c}));const h=new Array(e.length);for(let t=0;t<e.length;t++){const s=e[t],o=this._checkKey(s);if(o)return this.nextTick(r,o),r[b];h[t]=this.prefixKey(n.encode(s),i)}return this._getMany(h,t,((e,t)=>{if(e)return r(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=s.decode(t[e]))}catch(e){return r(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}r(null,t)})),r[b]}_getMany(e,t,r){this.nextTick(r,null,new Array(e.length).fill(void 0))}put(e,t,r,n){if(n=g(r,n),n=o(n,b),r=m(r,this[T].entry),"opening"===this[I])return this.defer((()=>this.put(e,t,r,n))),n[b];if(O(this,n))return n[b];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(n,s),n[b];const i=this.keyEncoding(r.keyEncoding),a=this.valueEncoding(r.valueEncoding),c=i.format,h=a.format;r.keyEncoding===c&&r.valueEncoding===h||(r=Object.assign({},r,{keyEncoding:c,valueEncoding:h}));const u=this.prefixKey(i.encode(e),c),l=a.encode(t);return this._put(u,l,r,(r=>{if(r)return n(r);this.emit("put",e,t),n()})),n[b]}_put(e,t,r,n){this.nextTick(n)}del(e,t,r){if(r=g(t,r),r=o(r,b),t=m(t,this[T].key),"opening"===this[I])return this.defer((()=>this.del(e,t,r))),r[b];if(O(this,r))return r[b];const n=this._checkKey(e);if(n)return this.nextTick(r,n),r[b];const s=this.keyEncoding(t.keyEncoding),i=s.format;return t.keyEncoding!==i&&(t=Object.assign({},t,{keyEncoding:i})),this._del(this.prefixKey(s.encode(e),i),t,(t=>{if(t)return r(t);this.emit("del",e),r()})),r[b]}_del(e,t,r){this.nextTick(r)}batch(e,t,r){if(!arguments.length){if("opening"===this[I])return new p(this);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(r="function"==typeof e?e:g(t,r),r=o(r,b),t=m(t,this[T].empty),"opening"===this[I])return this.defer((()=>this.batch(e,t,r))),r[b];if(O(this,r))return r[b];if(!Array.isArray(e))return this.nextTick(r,new TypeError("The first argument 'operations' must be an array")),r[b];if(0===e.length)return this.nextTick(r),r[b];const n=new Array(e.length),{keyEncoding:s,valueEncoding:i,...c}=t;for(let t=0;t<e.length;t++){if("object"!=typeof e[t]||null===e[t])return this.nextTick(r,new TypeError("A batch operation must be an object")),r[b];const o=Object.assign({},e[t]);if("put"!==o.type&&"del"!==o.type)return this.nextTick(r,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[b];const a=this._checkKey(o.key);if(a)return this.nextTick(r,a),r[b];const c=null!=o.sublevel?o.sublevel:this,h=c.keyEncoding(o.keyEncoding||s),u=h.format;if(o.key=c.prefixKey(h.encode(o.key),u),o.keyEncoding=u,"put"===o.type){const e=this._checkValue(o.value);if(e)return this.nextTick(r,e),r[b];const t=c.valueEncoding(o.valueEncoding||i);o.value=t.encode(o.value),o.valueEncoding=t.format}c!==this&&(o.sublevel=null),n[t]=o}return this._batch(n,c,(t=>{if(t)return r(t);this.emit("batch",e),r()})),r[b]}_batch(e,t,r){this.nextTick(r)}sublevel(e,t){return this._sublevel(e,R.defaults(t))}_sublevel(e,t){return new R(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=g(e,t),t=o(t,b),e=m(e,this[T].empty),"opening"===this[I])return this.defer((()=>this.clear(e,t))),t[b];if(O(this,t))return t[b];const r=e,n=this.keyEncoding(e.keyEncoding);return(e=y(e,n)).keyEncoding=n.format,0===e.limit?this.nextTick(t):this._clear(e,(e=>{if(e)return t(e);this.emit("clear",r),t()})),t[b]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[I])return new l(this,e);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new c(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[I])return new d(this,e);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new h(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),r=this.valueEncoding(e&&e.valueEncoding);if((e=y(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=r,e.keyEncoding=t.format,e.valueEncoding=r.format,"opening"===this[I])return new f(this,e);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new u(this,e)}defer(e){if("function"!=typeof e)throw new TypeError("The first argument must be a function");this[E].push(e)}[k](){if(0===this[E].length)return;const e=this[E];this[E]=[];for(const t of e)t()}attachResource(e){if("object"!=typeof e||null===e||"function"!=typeof e.close)throw new TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new p(this)}_checkKey(e){if(null==e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null==e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}M.prototype.nextTick=r(56909);const{AbstractSublevel:R}=r(59650)({AbstractLevel:M});t.AbstractLevel=M,t.AbstractSublevel=R;const O=function(e,t){return"open"!==e[I]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},N=function(e){return Object.keys(e.supports.encodings).filter((t=>!!e.supports.encodings[t]))}},50875:function(e,t,r){"use strict";t.AbstractLevel=r(69071).AbstractLevel,t.AbstractSublevel=r(69071).AbstractSublevel,t.AbstractIterator=r(33961).AbstractIterator,t.AbstractKeyIterator=r(33961).AbstractKeyIterator,t.AbstractValueIterator=r(33961).AbstractValueIterator,t.AbstractChainedBatch=r(19464).AbstractChainedBatch},82970:function(e,t,r){"use strict";const{AbstractIterator:n,AbstractKeyIterator:s,AbstractValueIterator:i}=r(33961),o=Symbol("unfix"),a=Symbol("iterator"),c=Symbol("handleOne"),h=Symbol("handleMany"),u=Symbol("callback");class l extends n{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[h]=this[h].bind(this),this[u]=null}[c](e,t,r){const n=this[u];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t,r)}[h](e,t){const r=this[u];if(e)return r(e);for(const e of t){const t=e[0];void 0!==t&&(e[0]=this[o](t))}r(e,t)}}class d extends s{constructor(e,t,r,n){super(e,t),this[a]=r,this[o]=n,this[c]=this[c].bind(this),this[h]=this[h].bind(this),this[u]=null}[c](e,t){const r=this[u];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t)}[h](e,t){const r=this[u];if(e)return r(e);for(let e=0;e<t.length;e++){const r=t[e];void 0!==r&&(t[e]=this[o](r))}r(e,t)}}class f extends i{constructor(e,t,r){super(e,t),this[a]=r}}for(const e of[l,d])e.prototype._next=function(e){this[u]=e,this[a].next(this[c])},e.prototype._nextv=function(e,t,r){this[u]=r,this[a].nextv(e,t,this[h])},e.prototype._all=function(e,t){this[u]=t,this[a].all(e,this[h])};for(const e of[f])e.prototype._next=function(e){this[a].next(e)},e.prototype._nextv=function(e,t,r){this[a].nextv(e,t,r)},e.prototype._all=function(e,t){this[a].all(e,t)};for(const e of[l,d,f])e.prototype._seek=function(e,t){this[a].seek(e,t)},e.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=l,t.AbstractSublevelKeyIterator=d,t.AbstractSublevelValueIterator=f},59650:function(e,t,r){"use strict";const n=r(31648),{Buffer:s}=r(96451)||{},{AbstractSublevelIterator:i,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=r(82970),c=Symbol("prefix"),h=Symbol("upperBound"),u=Symbol("prefixRange"),l=Symbol("parent"),d=Symbol("unfix"),f=new TextEncoder,p={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"==typeof e)throw new n("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new n("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?p:e.separator?e:{...e,separator:"!"}}constructor(e,r,s){const{separator:i,manifest:o,...a}=t.defaults(s);r=w(r,i);const u=i.charCodeAt(0)+1,p=e[l]||e;if(!f.encode(r).every((e=>e>u&&e<127)))throw new n(`Prefix must use bytes > ${u} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(g(p,o),a);const m=(e.prefix||"")+i+r+i,v=m.slice(0,-1)+String.fromCharCode(u);this[l]=p,this[c]=new y(m),this[h]=new y(v),this[d]=new b,this.nextTick=p.nextTick}prefixKey(e,t){if("utf8"===t)return this[c].utf8+e;if(0===e.byteLength)return this[c][t];if("view"===t){const t=this[c].view,r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r}{const t=this[c].buffer;return s.concat([t,e],t.byteLength+e.byteLength)}}[u](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[c][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[h][t]}get prefix(){return this[c].utf8}get db(){return this[l]}_open(e,t){this[l].open({passive:!0},t)}_put(e,t,r,n){this[l].put(e,t,r,n)}_get(e,t,r){this[l].get(e,t,r)}_getMany(e,t,r){this[l].getMany(e,t,r)}_del(e,t,r){this[l].del(e,t,r)}_batch(e,t,r){this[l].batch(e,t,r)}_clear(e,t){this[u](e,e.keyEncoding),this[l].clear(e,t)}_iterator(e){this[u](e,e.keyEncoding);const t=this[l].iterator(e),r=this[d].get(this[c].utf8.length,e.keyEncoding);return new i(this,e,t,r)}_keys(e){this[u](e,e.keyEncoding);const t=this[l].keys(e),r=this[d].get(this[c].utf8.length,e.keyEncoding);return new o(this,e,t,r)}_values(e){this[u](e,e.keyEncoding);const t=this[l].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};const g=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:m(e,"utf8"),buffer:m(e,"buffer"),view:m(e,"view")}}},m=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class y{constructor(e){this.utf8=e,this.view=f.encode(e),this.buffer=s?s.from(this.view.buffer,0,this.view.byteLength):{}}}class b{constructor(){this.cache=new Map}get(e,t){let r=this.cache.get(t);return void 0===r&&(r="view"===t?function(e,t){return t.subarray(e)}.bind(null,e):function(e,t){return t.slice(e)}.bind(null,e),this.cache.set(t,r)),r}}const w=function(e,t){let r=0,n=e.length;for(;r<n&&e[r]===t;)r++;for(;n>r&&e[n-1]===t;)n--;return e.slice(r,n)}},92520:function(e,t){"use strict";t.getCallback=function(e,t){return"function"==typeof e?e:t},t.getOptions=function(e,t){return"object"==typeof e&&null!==e?e:void 0!==t?t:{}}},4765:function(e,t,r){"use strict";const{AbstractChainedBatch:n}=r(19464),s=r(31648),i=Symbol("encoded");t.DefaultChainedBatch=class extends n{constructor(e){super(e),this[i]=[]}_put(e,t,r){this[i].push({...r,type:"put",key:e,value:t})}_del(e,t){this[i].push({...t,type:"del",key:e})}_clear(){this[i]=[]}_write(e,t){"opening"===this.db.status?this.db.defer((()=>this._write(e,t))):"open"===this.db.status?0===this[i].length?this.nextTick(t):this.db._batch(this[i],e,t):this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}},95429:function(e,t,r){"use strict";const{AbstractKeyIterator:n,AbstractValueIterator:s}=r(33961),i=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),c=Symbol("handleMany");class h extends n{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}class u extends s{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}for(const e of[h,u]){const t=e===h,r=t?e=>e[0]:e=>e[1];e.prototype._next=function(e){this[o]=e,this[i].next(this[a])},e.prototype[a]=function(e,r,n){const s=this[o];e?s(e):s(null,t?r:n)},e.prototype._nextv=function(e,t,r){this[o]=r,this[i].nextv(e,t,this[c])},e.prototype._all=function(e,t){this[o]=t,this[i].all(e,this[c])},e.prototype[c]=function(e,t){const n=this[o];e?n(e):n(null,t.map(r))},e.prototype._seek=function(e,t){this[i].seek(e,t)},e.prototype._close=function(e){this[i].close(e)}}t.DefaultKeyIterator=h,t.DefaultValueIterator=u},30593:function(e,t,r){"use strict";const{AbstractIterator:n,AbstractKeyIterator:s,AbstractValueIterator:i}=r(33961),o=r(31648),a=Symbol("nut"),c=Symbol("undefer"),h=Symbol("factory");class u extends n{constructor(e,t){super(e,t),this[a]=null,this[h]=()=>e.iterator(t),this.db.defer((()=>this[c]()))}}class l extends s{constructor(e,t){super(e,t),this[a]=null,this[h]=()=>e.keys(t),this.db.defer((()=>this[c]()))}}class d extends i{constructor(e,t){super(e,t),this[a]=null,this[h]=()=>e.values(t),this.db.defer((()=>this[c]()))}}for(const e of[u,l,d])e.prototype[c]=function(){"open"===this.db.status&&(this[a]=this[h]())},e.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer((()=>this._next(e))):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._nextv=function(e,t,r){null!==this[a]?this[a].nextv(e,t,r):"opening"===this.db.status?this.db.defer((()=>this._nextv(e,t,r))):this.nextTick(r,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer((()=>this._all(e,t))):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer((()=>this._seek(e,t)))},e.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer((()=>this._close(e))):this.nextTick(e)};t.DeferredIterator=u,t.DeferredKeyIterator=l,t.DeferredValueIterator=d},56909:function(e,t,r){"use strict";const n=r(54375);e.exports=function(e,...t){0===t.length?n(e):n((()=>e(...t)))}},70056:function(e,t,r){"use strict";const n=r(31648),s=Object.prototype.hasOwnProperty,i=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){const r={};for(const o in e)if(s.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new n(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new n("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});i.has(o)?r[o]=t.encode(e[o]):r[o]=e[o]}return r.reverse=!!r.reverse,r.limit=Number.isInteger(r.limit)&&r.limit>=0?r.limit:-1,r}},96451:function(e,t,r){"use strict";var n=r(25108);const s=r(79742),i=r(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=h,t.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},t.INSPECT_MAX_BYTES=50;const a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,h.prototype),t}function h(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!h.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|m(e,t);let n=c(r);const s=n.write(e,t);s!==r&&(n=n.slice(0,s));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Z(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Z(e,ArrayBuffer)||e&&Z(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(Z(e,SharedArrayBuffer)||e&&Z(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return h.from(n,t,r);const s=function(e){if(h.isBuffer(e)){const t=0|g(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||Q(e.length)?c(0):f(e);if("Buffer"===e.type&&Array.isArray(e.data))return f(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return h.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return l(e),c(e<0?0:0|g(e))}function f(e){const t=e.length<0?0:0|g(e.length),r=c(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,h.prototype),n}function g(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function m(e,t){if(h.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let s=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(s)return n?-1:H(e).length;t=(""+t).toLowerCase(),s=!0}}function y(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return T(this,t,r);case"ascii":return D(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return I(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,s){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Q(r=+r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof t&&(t=h.from(t,n)),h.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,s);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,s){let i,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){let n=-1;for(i=r;i<a;i++)if(h(e,i)===h(t,-1===n?0:i-n)){if(-1===n&&(n=i),i-n+1===c)return n*o}else-1!==n&&(i-=i-n),n=-1}else for(r+c>a&&(r=a-c),i=r;i>=0;i--){let r=!0;for(let n=0;n<c;n++)if(h(e,i+n)!==h(t,n)){r=!1;break}if(r)return i}return-1}function _(e,t,r,n){r=Number(r)||0;const s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;const i=t.length;let o;for(n>i/2&&(n=i/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(Q(n))return o;e[r+o]=n}return o}function E(e,t,r,n){return J(H(t,e.length-r),e,r,n)}function k(e,t,r,n){return J(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return J(G(t),e,r,n)}function x(e,t,r,n){return J(function(e,t){let r,n,s;const i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,s=r%256,i.push(s),i.push(n);return i}(t,e.length-r),e,r,n)}function I(e,t,r){return 0===t&&r===e.length?s.fromByteArray(e):s.fromByteArray(e.slice(t,r))}function T(e,t,r){r=Math.min(e.length,r);const n=[];let s=t;for(;s<r;){const t=e[s];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(s+o<=r){let r,n,a,c;switch(o){case 1:t<128&&(i=t);break;case 2:r=e[s+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(i=c));break;case 3:r=e[s+1],n=e[s+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[s+1],n=e[s+2],a=e[s+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),s+=o}return function(e){const t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=A));return r}(n)}t.kMaxLength=a,h.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),h.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),h.poolSize=8192,h.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array),h.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},h.allocUnsafe=function(e){return d(e)},h.allocUnsafeSlow=function(e){return d(e)},h.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==h.prototype},h.compare=function(e,t){if(Z(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),Z(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let s=0,i=Math.min(r,n);s<i;++s)if(e[s]!==t[s]){r=e[s],n=t[s];break}return r<n?-1:n<r?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=h.allocUnsafe(t);let s=0;for(r=0;r<e.length;++r){let t=e[r];if(Z(t,Uint8Array))s+t.length>n.length?(h.isBuffer(t)||(t=h.from(t)),t.copy(n,s)):Uint8Array.prototype.set.call(n,t,s);else{if(!h.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,s)}s+=t.length}return n},h.byteLength=m,h.prototype._isBuffer=!0,h.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)b(this,t,t+1);return this},h.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},h.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},h.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):y.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(h.prototype[o]=h.prototype.inspect),h.prototype.compare=function(e,t,r,n,s){if(Z(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||r>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=r)return 0;if(n>=s)return-1;if(t>=r)return 1;if(this===e)return 0;let i=(s>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const a=Math.min(i,o),c=this.slice(n,s),u=e.slice(t,r);for(let e=0;e<a;++e)if(c[e]!==u[e]){i=c[e],o=u[e];break}return i<o?-1:o<i?1:0},h.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},h.prototype.indexOf=function(e,t,r){return w(this,e,t,r,!0)},h.prototype.lastIndexOf=function(e,t,r){return w(this,e,t,r,!1)},h.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const s=this.length-t;if((void 0===r||r>s)&&(r=s),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let i=!1;for(;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":case"latin1":case"binary":return k(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const A=4096;function D(e,t,r){let n="";r=Math.min(e.length,r);for(let s=t;s<r;++s)n+=String.fromCharCode(127&e[s]);return n}function P(e,t,r){let n="";r=Math.min(e.length,r);for(let s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}function C(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let s="";for(let n=t;n<r;++n)s+=Y[e[n]];return s}function M(e,t,r){const n=e.slice(t,r);let s="";for(let e=0;e<n.length-1;e+=2)s+=String.fromCharCode(n[e]+256*n[e+1]);return s}function R(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,r,n,s,i){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function N(e,t,r,n,s){W(t,n,s,e,r,7);let i=Number(t&BigInt(4294967295));e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function B(e,t,r,n,s){W(t,n,s,e,r,7);let i=Number(t&BigInt(4294967295));e[r+7]=i,i>>=8,e[r+6]=i,i>>=8,e[r+5]=i,i>>=8,e[r+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function L(e,t,r,n,s,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function z(e,t,r,n,s){return t=+t,r>>>=0,s||L(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function U(e,t,r,n,s){return t=+t,r>>>=0,s||L(e,0,r,8),i.write(e,t,r,n,52,8),r+8}h.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,h.prototype),n},h.prototype.readUintLE=h.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e],s=1,i=0;for(;++i<t&&(s*=256);)n+=this[e+i]*s;return n},h.prototype.readUintBE=h.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e+--t],s=1;for(;t>0&&(s*=256);)n+=this[e+--t]*s;return n},h.prototype.readUint8=h.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readBigUInt64LE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,s=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(s)<<BigInt(32))})),h.prototype.readBigUInt64BE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],s=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(s)})),h.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e],s=1,i=0;for(;++i<t&&(s*=256);)n+=this[e+i]*s;return s*=128,n>=s&&(n-=Math.pow(2,8*t)),n},h.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=t,s=1,i=this[e+--n];for(;n>0&&(s*=256);)i+=this[e+--n]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i},h.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readBigInt64LE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),h.prototype.readBigInt64BE=X((function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||q(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),h.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!1,52,8)},h.prototype.writeUintLE=h.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){O(this,e,t,r,Math.pow(2,8*r)-1,0)}let s=1,i=0;for(this[t]=255&e;++i<r&&(s*=256);)this[t+i]=e/s&255;return t+r},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){O(this,e,t,r,Math.pow(2,8*r)-1,0)}let s=r-1,i=1;for(this[t+s]=255&e;--s>=0&&(i*=256);)this[t+s]=e/i&255;return t+r},h.prototype.writeUint8=h.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,255,0),this[t]=255&e,t+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeBigUInt64LE=X((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),h.prototype.writeBigUInt64BE=X((function(e,t=0){return B(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),h.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,e,t,r,n-1,-n)}let s=0,i=1,o=0;for(this[t]=255&e;++s<r&&(i*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+r},h.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,e,t,r,n-1,-n)}let s=r-1,i=1,o=0;for(this[t+s]=255&e;--s>=0&&(i*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+r},h.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},h.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeBigInt64LE=X((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),h.prototype.writeBigInt64BE=X((function(e,t=0){return B(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),h.prototype.writeFloatLE=function(e,t,r){return z(this,e,t,!0,r)},h.prototype.writeFloatBE=function(e,t,r){return z(this,e,t,!1,r)},h.prototype.writeDoubleLE=function(e,t,r){return U(this,e,t,!0,r)},h.prototype.writeDoubleBE=function(e,t,r){return U(this,e,t,!1,r)},h.prototype.copy=function(e,t,r,n){if(!h.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const s=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),s},h.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{const i=h.isBuffer(e)?e:h.from(e,n),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=i[s%o]}return this};const F={};function j(e,t,r){F[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function V(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function W(e,t,r,n,s,i){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let s;throw s=i>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(i+1)}${n}`:`>= -(2${n} ** ${8*(i+1)-1}${n}) and < 2 ** ${8*(i+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new F.ERR_OUT_OF_RANGE("value",s,e)}!function(e,t,r){$(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||q(t,e.length-(r+1))}(n,s,i)}function $(e,t){if("number"!=typeof e)throw new F.ERR_INVALID_ARG_TYPE(t,"number",e)}function q(e,t,r){if(Math.floor(e)!==e)throw $(e,r),new F.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}j("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),j("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),j("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,s=r;return Number.isInteger(r)&&Math.abs(r)>2**32?s=V(String(r)):"bigint"==typeof r&&(s=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(s=V(s)),s+="n"),n+=` It must be ${t}. Received ${s}`,n}),RangeError);const K=/[^+/0-9A-Za-z-_]/g;function H(e,t){let r;t=t||1/0;const n=e.length;let s=null;const i=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function G(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(K,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function J(e,t,r,n){let s;for(s=0;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}function Z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Q(e){return e!=e}const Y=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let s=0;s<16;++s)t[n+s]=e[r]+e[s]}return t}();function X(e){return"undefined"==typeof BigInt?ee:e}function ee(){throw new Error("BigInt not supported")}},32044:function(e){function t(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e)if(t&&t.addEventListener){if(t.aborted){r();break}t.addEventListener("abort",r)}return t.signal}e.exports=t,e.exports.anySignal=t},11708:function(e,t,r){"use strict";const{AbstractLevel:n}=r(50875),s=r(31648),i=r(29967),{fromCallback:o}=r(16957),{Iterator:a}=r(8212),c=r(89687),h=r(89968),u=r(21217),l="level-js-",d=Symbol("idb"),f=Symbol("namePrefix"),p=Symbol("location"),g=Symbol("version"),m=Symbol("store"),y=Symbol("onComplete"),b=Symbol("promise");class w extends n{constructor(e,t,r){if("function"==typeof t||"function"==typeof r)throw new s("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:n,version:i,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof e)throw new Error("constructor requires a location string argument");this[p]=e,this[f]=null==n?l:n,this[g]=parseInt(i||1,10),this[d]=null}get location(){return this[p]}get namePrefix(){return this[f]}get version(){return this[g]}get db(){return this[d]}get type(){return"browser-level"}_open(e,t){const r=indexedDB.open(this[f]+this[p],this[g]);r.onerror=function(){t(r.error||new Error("unknown error"))},r.onsuccess=()=>{this[d]=r.result,t()},r.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this[p])||t.createObjectStore(this[p])}}[m](e){return this[d].transaction([this[p]],e).objectStore(this[p])}[y](e,t){const r=e.transaction;r.onabort=function(){t(r.error||new Error("aborted by user"))},r.oncomplete=function(){t(null,e.result)}}_get(e,t,r){const n=this[m]("readonly");let i;try{i=n.get(e)}catch(e){return this.nextTick(r,e)}this[y](i,(function(e,t){return e?r(e):void 0===t?r(new s("Entry not found",{code:"LEVEL_NOT_FOUND"})):void r(null,c(t))}))}_getMany(e,t,r){const n=this[m]("readonly"),s=e.map((e=>t=>{let r;try{r=n.get(e)}catch(e){return t(e)}r.onsuccess=()=>{const e=r.result;t(null,void 0===e?e:c(e))},r.onerror=e=>{e.stopPropagation(),t(r.error)}}));i(s,16,r)}_del(e,t,r){const n=this[m]("readwrite");let s;try{s=n.delete(e)}catch(e){return this.nextTick(r,e)}this[y](s,r)}_put(e,t,r,n){const s=this[m]("readwrite");let i;try{i=s.put(t,e)}catch(e){return this.nextTick(n,e)}this[y](i,n)}_iterator(e){return new a(this,this[p],e)}_batch(e,t,r){const n=this[m]("readwrite"),s=n.transaction;let i,o=0;s.onabort=function(){r(i||s.error||new Error("aborted by user"))},s.oncomplete=function(){r()},function t(){const r=e[o++],a=r.key;let c;try{c="del"===r.type?n.delete(a):n.put(r.value,a)}catch(e){return i=e,void s.abort()}o<e.length?c.onsuccess=t:"function"==typeof s.commit&&s.commit()}()}_clear(e,t){let r,n;try{r=u(e)}catch(e){return this.nextTick(t)}if(e.limit>=0)return h(this,this[p],r,e,t);try{const e=this[m]("readwrite");n=r?e.delete(r):e.clear()}catch(e){return this.nextTick(t,e)}this[y](n,t)}_close(e){this[d].close(),this.nextTick(e)}}w.destroy=function(e,t,r){"function"==typeof t&&(r=t,t=l),r=o(r,b);const n=indexedDB.deleteDatabase(t+e);return n.onsuccess=function(){r()},n.onerror=function(e){r(e)},r[b]},t.BrowserLevel=w},8212:function(e,t,r){"use strict";const{AbstractIterator:n}=r(50875),s=r(21217),i=r(89687),o=Symbol("cache"),a=Symbol("finished"),c=Symbol("options"),h=Symbol("currentOptions"),u=Symbol("position"),l=Symbol("location"),d=Symbol("first"),f={};function p(e){"function"==typeof e.commit&&e.commit()}t.Iterator=class extends n{constructor(e,t,r){super(e,r),this[o]=[],this[a]=0===this.limit,this[c]=r,this[h]={...r},this[u]=void 0,this[l]=t,this[d]=!0}_nextv(e,t,r){if(this[d]=!1,this[a])return this.nextTick(r,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(r,null,this[o].splice(0,e));let n;void 0!==this[u]&&(this[c].reverse?(this[h].lt=this[u],this[h].lte=void 0):(this[h].gt=this[u],this[h].gte=void 0));try{n=s(this[h])}catch(e){return this[a]=!0,this.nextTick(r,null,[])}const f=this.db.db.transaction([this[l]],"readonly"),g=f.objectStore(this[l]),m=[];if(this[c].reverse){g[!this[c].values&&g.openKeyCursor?"openKeyCursor":"openCursor"](n,"prev").onsuccess=t=>{const r=t.target.result;if(r){const{key:t,value:n}=r;this[u]=t,m.push([this[c].keys&&void 0!==t?i(t):void 0,this[c].values&&void 0!==n?i(n):void 0]),m.length<e?r.continue():p(f)}else this[a]=!0}}else{let t,r;const s=()=>{if(void 0===t||void 0===r)return;const n=Math.max(t.length,r.length);0===n||e===1/0?this[a]=!0:this[u]=t[n-1],m.length=n;for(let e=0;e<n;e++){const n=t[e],s=r[e];m[e]=[this[c].keys&&void 0!==n?i(n):void 0,this[c].values&&void 0!==s?i(s):void 0]}p(f)};this[c].keys||e<1/0?g.getAllKeys(n,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,s()}:(t=[],this.nextTick(s)),this[c].values?g.getAll(n,e<1/0?e:void 0).onsuccess=e=>{r=e.target.result,s()}:(r=[],this.nextTick(s))}f.onabort=()=>{r(f.error||new Error("aborted by user")),r=null},f.oncomplete=()=>{r(null,m),r=null}}_next(e){if(this[o].length>0){const[t,r]=this[o].shift();this.nextTick(e,null,t,r)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[d]&&(this[d]=!1,t=1),this._nextv(t,f,((t,r)=>{if(t)return e(t);this[o]=r,this._next(e)}))}}_all(e,t){this[d]=!1;const r=this[o].splice(0,this[o].length),n=this.limit-this.count-r.length;if(n<=0)return this.nextTick(t,null,r);this._nextv(n,f,((e,n)=>{if(e)return t(e);r.length>0&&(n=r.concat(n)),t(null,n)}))}_seek(e,t){let r;this[d]=!0,this[o]=[],this[a]=!1,this[u]=void 0,this[h]={...this[c]};try{r=s(this[c])}catch(e){return void(this[a]=!0)}null===r||r.includes(e)?this[c].reverse?this[h].lte=e:this[h].gte=e:this[a]=!0}}},89968:function(e){"use strict";e.exports=function(e,t,r,n,s){if(0===n.limit)return e.nextTick(s);const i=e.db.transaction([t],"readwrite"),o=i.objectStore(t);let a=0;i.oncomplete=function(){s()},i.onabort=function(){s(i.error||new Error("aborted by user"))};const c=o.openKeyCursor?"openKeyCursor":"openCursor",h=n.reverse?"prev":"next";o[c](r,h).onsuccess=function(e){const t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(n.limit<=0||++a<n.limit)&&t.continue()})}}},89687:function(e){"use strict";const t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},21217:function(e){"use strict";e.exports=function(e){const t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,r=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,n=void 0===e.gte,s=void 0===e.lte;return void 0!==t&&void 0!==r?IDBKeyRange.bound(t,r,n,s):void 0!==t?IDBKeyRange.lowerBound(t,n):void 0!==r?IDBKeyRange.upperBound(r,s):null}},48764:function(e,t,r){"use strict";var n=r(25108),s=r(79742),i=r(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=h,t.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},t.INSPECT_MAX_BYTES=50;var a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,h.prototype),t}function h(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!h.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|m(e,t),n=c(r),s=n.write(e,t);s!==r&&(n=n.slice(0,s));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(V(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(V(e,ArrayBuffer)||e&&V(e.buffer,ArrayBuffer))return p(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(V(e,SharedArrayBuffer)||e&&V(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return h.from(n,t,r);var s=function(e){if(h.isBuffer(e)){var t=0|g(e.length),r=c(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||W(e.length)?c(0):f(e);if("Buffer"===e.type&&Array.isArray(e.data))return f(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return h.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return l(e),c(e<0?0:0|g(e))}function f(e){for(var t=e.length<0?0:0|g(e.length),r=c(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,h.prototype),n}function g(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function m(e,t){if(h.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||V(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var s=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(s)return n?-1:U(e).length;t=(""+t).toLowerCase(),s=!0}}function y(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return T(this,t,r);case"ascii":return D(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return I(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function w(e,t,r,n,s){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),W(r=+r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof t&&(t=h.from(t,n)),h.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,s);throw new TypeError("val must be string, number or Buffer")}function v(e,t,r,n,s){var i,o=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,r/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){var u=-1;for(i=r;i<a;i++)if(h(e,i)===h(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===c)return u*o}else-1!==u&&(i-=i-u),u=-1}else for(r+c>a&&(r=a-c),i=r;i>=0;i--){for(var l=!0,d=0;d<c;d++)if(h(e,i+d)!==h(t,d)){l=!1;break}if(l)return i}return-1}function _(e,t,r,n){r=Number(r)||0;var s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;var i=t.length;n>i/2&&(n=i/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(W(a))return o;e[r+o]=a}return o}function E(e,t,r,n){return j(U(t,e.length-r),e,r,n)}function k(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return j(F(t),e,r,n)}function x(e,t,r,n){return j(function(e,t){for(var r,n,s,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,s=r%256,i.push(s),i.push(n);return i}(t,e.length-r),e,r,n)}function I(e,t,r){return 0===t&&r===e.length?s.fromByteArray(e):s.fromByteArray(e.slice(t,r))}function T(e,t,r){r=Math.min(e.length,r);for(var n=[],s=t;s<r;){var i,o,a,c,h=e[s],u=null,l=h>239?4:h>223?3:h>191?2:1;if(s+l<=r)switch(l){case 1:h<128&&(u=h);break;case 2:128==(192&(i=e[s+1]))&&(c=(31&h)<<6|63&i)>127&&(u=c);break;case 3:i=e[s+1],o=e[s+2],128==(192&i)&&128==(192&o)&&(c=(15&h)<<12|(63&i)<<6|63&o)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:i=e[s+1],o=e[s+2],a=e[s+3],128==(192&i)&&128==(192&o)&&128==(192&a)&&(c=(15&h)<<18|(63&i)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,l=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),s+=l}return function(e){var t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=A));return r}(n)}t.kMaxLength=a,h.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),h.TYPED_ARRAY_SUPPORT||void 0===n||"function"!=typeof n.error||n.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),h.poolSize=8192,h.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array),h.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?c(e):void 0!==t?"string"==typeof r?c(e).fill(t,r):c(e).fill(t):c(e)}(e,t,r)},h.allocUnsafe=function(e){return d(e)},h.allocUnsafeSlow=function(e){return d(e)},h.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==h.prototype},h.compare=function(e,t){if(V(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),V(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,s=0,i=Math.min(r,n);s<i;++s)if(e[s]!==t[s]){r=e[s],n=t[s];break}return r<n?-1:n<r?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=h.allocUnsafe(t),s=0;for(r=0;r<e.length;++r){var i=e[r];if(V(i,Uint8Array))s+i.length>n.length?h.from(i).copy(n,s):Uint8Array.prototype.set.call(n,i,s);else{if(!h.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,s)}s+=i.length}return n},h.byteLength=m,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},h.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):y.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(h.prototype[o]=h.prototype.inspect),h.prototype.compare=function(e,t,r,n,s){if(V(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||r>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=r)return 0;if(n>=s)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(s>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(i,o),c=this.slice(n,s),u=e.slice(t,r),l=0;l<a;++l)if(c[l]!==u[l]){i=c[l],o=u[l];break}return i<o?-1:o<i?1:0},h.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},h.prototype.indexOf=function(e,t,r){return w(this,e,t,r,!0)},h.prototype.lastIndexOf=function(e,t,r){return w(this,e,t,r,!1)},h.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var s=this.length-t;if((void 0===r||r>s)&&(r=s),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":case"latin1":case"binary":return k(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function D(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(127&e[s]);return n}function P(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var s="",i=t;i<r;++i)s+=$[e[i]];return s}function M(e,t,r){for(var n=e.slice(t,r),s="",i=0;i<n.length-1;i+=2)s+=String.fromCharCode(n[i]+256*n[i+1]);return s}function R(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,r,n,s,i){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function N(e,t,r,n,s,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function B(e,t,r,n,s){return t=+t,r>>>=0,s||N(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,s){return t=+t,r>>>=0,s||N(e,0,r,8),i.write(e,t,r,n,52,8),r+8}h.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,h.prototype),n},h.prototype.readUintLE=h.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n},h.prototype.readUintBE=h.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e+--t],s=1;t>0&&(s*=256);)n+=this[e+--t]*s;return n},h.prototype.readUint8=h.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*t)),n},h.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var n=t,s=1,i=this[e+--n];n>0&&(s*=256);)i+=this[e+--n]*s;return i>=(s*=128)&&(i-=Math.pow(2,8*t)),i},h.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!1,52,8)},h.prototype.writeUintLE=h.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||O(this,e,t,r,Math.pow(2,8*r)-1,0);var s=1,i=0;for(this[t]=255&e;++i<r&&(s*=256);)this[t+i]=e/s&255;return t+r},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||O(this,e,t,r,Math.pow(2,8*r)-1,0);var s=r-1,i=1;for(this[t+s]=255&e;--s>=0&&(i*=256);)this[t+s]=e/i&255;return t+r},h.prototype.writeUint8=h.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,255,0),this[t]=255&e,t+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var s=Math.pow(2,8*r-1);O(this,e,t,r,s-1,-s)}var i=0,o=1,a=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},h.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var s=Math.pow(2,8*r-1);O(this,e,t,r,s-1,-s)}var i=r-1,o=1,a=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},h.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},h.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},h.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},h.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},h.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},h.prototype.copy=function(e,t,r,n){if(!h.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var s=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),s},h.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var o=h.isBuffer(e)?e:h.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%a]}return this};var z=/[^+/0-9A-Za-z-_]/g;function U(e,t){var r;t=t||1/0;for(var n=e.length,s=null,i=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function F(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,n){for(var s=0;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}function V(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function W(e){return e!=e}var $=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,s=0;s<16;++s)t[n+s]=e[r]+e[s];return t}()},79830:function(e){"use strict";e.exports=function(e,t){if("string"==typeof e)return o(e);if("number"==typeof e)return i(e,t);return null},e.exports.format=i,e.exports.parse=o;var t=/\B(?=(\d{3})+(?!\d))/g,r=/(?:\.0*|(\.[^0]+)0+)$/,n={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},s=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function i(e,s){if(!Number.isFinite(e))return null;var i=Math.abs(e),o=s&&s.thousandsSeparator||"",a=s&&s.unitSeparator||"",c=s&&void 0!==s.decimalPlaces?s.decimalPlaces:2,h=Boolean(s&&s.fixedDecimals),u=s&&s.unit||"";u&&n[u.toLowerCase()]||(u=i>=n.pb?"PB":i>=n.tb?"TB":i>=n.gb?"GB":i>=n.mb?"MB":i>=n.kb?"KB":"B");var l=(e/n[u.toLowerCase()]).toFixed(c);return h||(l=l.replace(r,"$1")),o&&(l=l.split(".").map((function(e,r){return 0===r?e.replace(t,o):e})).join(".")),l+a+u}function o(e){if("number"==typeof e&&!isNaN(e))return e;if("string"!=typeof e)return null;var t,r=s.exec(e),i="b";return r?(t=parseFloat(r[1]),i=r[4].toLowerCase()):(t=parseInt(e,10),i="b"),isNaN(t)?null:Math.floor(n[i]*t)}},16957:function(e,t,r){"use strict";var n=r(90886);t.fromCallback=function(e,t){if(void 0===e){var r=new Promise((function(t,r){e=function(e,n){e?r(e):t(n)}}));e[void 0!==t?t:"promise"]=r}else if("function"!=typeof e)throw new TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then((function(e){n((()=>t(null,e)))})).catch((function(e){n((()=>t(e)))}))}},90886:function(e){e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},99870:function(e,t,r){"use strict";r.d(t,{Jj:function(){return l},Y6:function(){return u},sj:function(){return v}});var n=r(25108);const s=Symbol("Comlink.proxy"),i=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),a=Symbol("Comlink.finalizer"),c=Symbol("Comlink.thrown"),h=e=>"object"==typeof e&&null!==e||"function"==typeof e,u=new Map([["proxy",{canHandle:e=>h(e)&&e[s],serialize(e){const{port1:t,port2:r}=new MessageChannel;return l(e,t),[r,[r]]},deserialize(e){return e.start(),y(e,[],t);var t}}],["throw",{canHandle:e=>h(e)&&c in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function l(e,t=globalThis,r=["*"]){t.addEventListener("message",(function s(i){if(!i||!i.data)return;if(!function(e,t){for(const r of e){if(t===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}return!1}(r,i.origin))return void n.warn(`Invalid origin '${i.origin}' for comlink proxy`);const{id:o,type:h,path:u}=Object.assign({path:[]},i.data),f=(i.data.argumentList||[]).map(E);let p;try{const t=u.slice(0,-1).reduce(((e,t)=>e[t]),e),r=u.reduce(((e,t)=>e[t]),e);switch(h){case"GET":p=r;break;case"SET":t[u.slice(-1)[0]]=E(i.data.value),p=!0;break;case"APPLY":p=r.apply(t,f);break;case"CONSTRUCT":p=v(new r(...f));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;l(e,r),p=function(e,t){return w.set(e,t),e}(t,[t])}break;case"RELEASE":p=void 0;break;default:return}}catch(e){p={value:e,[c]:0}}Promise.resolve(p).catch((e=>({value:e,[c]:0}))).then((r=>{const[n,i]=_(r);t.postMessage(Object.assign(Object.assign({},n),{id:o}),i),"RELEASE"===h&&(t.removeEventListener("message",s),d(t),a in e&&"function"==typeof e[a]&&e[a]())})).catch((e=>{const[r,n]=_({value:new TypeError("Unserializable return value"),[c]:0});t.postMessage(Object.assign(Object.assign({},r),{id:o}),n)}))})),t.start&&t.start()}function d(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function f(e){if(e)throw new Error("Proxy has been released and is not useable")}function p(e){return k(e,{type:"RELEASE"}).then((()=>{d(e)}))}const g=new WeakMap,m="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(g.get(e)||0)-1;g.set(e,t),0===t&&p(e)}));function y(e,t=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(r,i){if(f(n),i===o)return()=>{!function(e){m&&m.unregister(e)}(s),p(e),n=!0};if("then"===i){if(0===t.length)return{then:()=>s};const r=k(e,{type:"GET",path:t.map((e=>e.toString()))}).then(E);return r.then.bind(r)}return y(e,[...t,i])},set(r,s,i){f(n);const[o,a]=_(i);return k(e,{type:"SET",path:[...t,s].map((e=>e.toString())),value:o},a).then(E)},apply(r,s,o){f(n);const a=t[t.length-1];if(a===i)return k(e,{type:"ENDPOINT"}).then(E);if("bind"===a)return y(e,t.slice(0,-1));const[c,h]=b(o);return k(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:c},h).then(E)},construct(r,s){f(n);const[i,o]=b(s);return k(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:i},o).then(E)}});return function(e,t){const r=(g.get(t)||0)+1;g.set(t,r),m&&m.register(e,t,e)}(s,e),s}function b(e){const t=e.map(_);return[t.map((e=>e[0])),(r=t.map((e=>e[1])),Array.prototype.concat.apply([],r))];var r}const w=new WeakMap;function v(e){return Object.assign(e,{[s]:!0})}function _(e){for(const[t,r]of u)if(r.canHandle(e)){const[n,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},s]}return[{type:"RAW",value:e},w.get(e)||[]]}function E(e){switch(e.type){case"HANDLER":return u.get(e.name).deserialize(e.value);case"RAW":return e.value}}function k(e,t,r){return new Promise((n=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(r){r.data&&r.data.id&&r.data.id===s&&(e.removeEventListener("message",t),n(r.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),r)}))}},74077:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(r.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};function i(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function o(e){return"string"!=typeof e&&(e=String(e)),e}function a(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r.iterable&&(t[Symbol.iterator]=function(){return t}),t}function c(e){this.map={},e instanceof c?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function u(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function l(e){var t=new FileReader,r=u(t);return t.readAsArrayBuffer(e),r}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:r.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():r.arrayBuffer&&r.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||s(e))?this._bodyArrayBuffer=d(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(l)}),this.text=function(){var e,t,r,n=h(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=u(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}c.prototype.append=function(e,t){e=i(e),t=o(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},c.prototype.delete=function(e){delete this.map[i(e)]},c.prototype.get=function(e){return e=i(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(i(e))},c.prototype.set=function(e,t){this.map[i(e)]=o(t)},c.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},c.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),a(e)},c.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),a(e)},c.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),a(e)},r.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function g(e,t){var r,n,s=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),p.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function m(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}})),t}function y(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},f.call(g.prototype),f.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];y.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function w(e,n){return new Promise((function(s,i){var o=new g(e,n);if(o.signal&&o.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function h(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new c,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();t.append(n,s)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var n="response"in a?a.response:a.responseText;s(new y(n,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r.blob&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",h),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",h)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}w.polyfill=!0,e.fetch||(e.fetch=w,e.Headers=c,e.Request=g,e.Response=y),t.Headers=c,t.Request=g,t.Response=y,t.fetch=w,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=n;(t=s.fetch).default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,e.exports=t},65780:function(e){"use strict";const t=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},r=({clearTimeout:e,setTimeout:r,willResolve:n})=>(s,{value:i,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(t());let a,c,h;const u=e||clearTimeout,l=()=>{u(a),h(t())},d=new Promise(((e,t)=>{c=()=>{o&&o.removeEventListener("abort",l),n?e(i):t(i)},h=t,a=(r||setTimeout)(c,s)}));return o&&o.addEventListener("abort",l,{once:!0}),d.clear=()=>{u(a),a=null,c()},d},n=e=>{const t=r({...e,willResolve:!0});return t.reject=r({...e,willResolve:!1}),t.range=(e,r,n)=>t(((e,t)=>Math.floor(Math.random()*(t-e+1)+e))(e,r),n),t},s=n();s.createWithTimers=n,e.exports=s,e.exports.default=s},45001:function(e){"use strict";function t(e,t){t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=new Array(4))}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r||t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(0===arguments.length)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(0===arguments.length)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},t.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var r=this.size(),n=this._list.length;if(!(t>=r||t<-r)){t<0&&(t+=r),t=this._head+t&this._capacityMask;var s,i=this._list[t];if(e<r/2){for(s=e;s>0;s--)this._list[t]=this._list[t=t-1+n&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(s=r-1-e;s>0;s--)this._list[t]=this._list[t=t+1+n&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+n&this._capacityMask}return i}}},t.prototype.remove=function(e,t){var r,n=e,s=t;if(n===(0|n)&&this._head!==this._tail){var i=this.size(),o=this._list.length;if(!(n>=i||n<-i||t<1)){if(n<0&&(n+=i),1===t||!t)return(r=new Array(1))[0]=this.removeOne(n),r;if(0===n&&n+t>=i)return r=this.toArray(),this.clear(),r;var a;for(n+t>i&&(t=i-n),r=new Array(t),a=0;a<t;a++)r[a]=this._list[this._head+n+a&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===i){for(this._tail=this._tail-t+o&this._capacityMask,a=t;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+o&this._capacityMask,a=t-1;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(n<i/2){for(this._head=this._head+e+t+o&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[n=n-1+o&this._capacityMask]);for(n=this._head-1+o&this._capacityMask;s>0;)this._list[n=n-1+o&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+o&this._capacityMask,a=i-(t+e);a>0;a--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+o&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),r}}},t.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n)){if(arguments.length>2){var s,i,o,a=arguments.length,c=this._list.length,h=2;if(!n||r<n/2){for(i=new Array(r),s=0;s<r;s++)i[s]=this._list[this._head+s&this._capacityMask];for(0===t?(o=[],r>0&&(this._head=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._head=this._head+r+c&this._capacityMask);a>h;)this.unshift(arguments[--a]);for(s=r;s>0;s--)this.unshift(i[s-1])}else{var u=(i=new Array(n-(r+t))).length;for(s=0;s<u;s++)i[s]=this._list[this._head+r+t+s&this._capacityMask];for(0===t?(o=[],r!=n&&(this._tail=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._tail=this._tail-u+c&this._capacityMask);h<a;)this.push(arguments[h++]);for(s=0;s<u;s++)this.push(i[s])}return o}return this.remove(r,t)}}},t.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){var t=e.length,r=this._nextPowerOf2(t);this._list=new Array(r),this._capacityMask=r-1,this._tail=t;for(var n=0;n<t;n++)this._list[n]=e[n]},t.prototype._copyArray=function(e,t){var r=this._list,n=r.length,s=this.length;if((t|=s)==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var i,o=new Array(t),a=0;if(e||this._head>this._tail){for(i=this._head;i<n;i++)o[a++]=r[i];for(i=0;i<this._tail;i++)o[a++]=r[i]}else for(i=this._head;i<this._tail;i++)o[a++]=r[i];return o},t.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.prototype._nextPowerOf2=function(e){var t=1<<Math.log(e)/Math.log(2)+1;return Math.max(t,4)},e.exports=t},39387:function(e,t,r){"use strict";r.d(t,{ZP:function(){return Vr}});var n=r(25108);const s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:r.g,i=Object.keys,o=Array.isArray;function a(e,t){return"object"!=typeof t||i(t).forEach((function(r){e[r]=t[r]})),e}"undefined"==typeof Promise||s.Promise||(s.Promise=Promise);const c=Object.getPrototypeOf,h={}.hasOwnProperty;function u(e,t){return h.call(e,t)}function l(e,t){"function"==typeof t&&(t=t(c(e))),("undefined"==typeof Reflect?i:Reflect.ownKeys)(t).forEach((r=>{f(e,r,t[r])}))}const d=Object.defineProperty;function f(e,t,r,n){d(e,t,a(r&&u(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),f(e.prototype,"constructor",e),{extend:l.bind(null,e.prototype)}}}}const g=Object.getOwnPropertyDescriptor;function m(e,t){let r;return g(e,t)||(r=c(e))&&m(r,t)}const y=[].slice;function b(e,t,r){return y.call(e,t,r)}function w(e,t){return t(e)}function v(e){if(!e)throw new Error("Assertion Failed")}function _(e){s.setImmediate?setImmediate(e):setTimeout(e,0)}function E(e,t){return e.reduce(((e,r,n)=>{var s=t(r,n);return s&&(e[s[0]]=s[1]),e}),{})}function k(e,t){if(u(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,s=t.length;n<s;++n){var i=k(e,t[n]);r.push(i)}return r}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:k(a,t.substr(o+1))}}function S(e,t,r){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){v("string"!=typeof r&&"length"in r);for(var n=0,s=t.length;n<s;++n)S(e,t[n],r[n])}else{var i=t.indexOf(".");if(-1!==i){var a=t.substr(0,i),c=t.substr(i+1);if(""===c)void 0===r?o(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=r;else{var h=e[a];h&&u(e,a)||(h=e[a]={}),S(h,c,r)}}else void 0===r?o(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function x(e){var t={};for(var r in e)u(e,r)&&(t[r]=e[r]);return t}const I=[].concat;function T(e){return I.apply([],e)}const A="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(T([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>s[e])),D=A.map((e=>s[e]));E(A,(e=>[e,!0]));let P=null;function C(e){P="undefined"!=typeof WeakMap&&new WeakMap;const t=M(e);return P=null,t}function M(e){if(!e||"object"!=typeof e)return e;let t=P&&P.get(e);if(t)return t;if(o(e)){t=[],P&&P.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(M(e[r]))}else if(D.indexOf(e.constructor)>=0)t=e;else{const r=c(e);for(var s in t=r===Object.prototype?{}:Object.create(r),P&&P.set(e,t),e)u(e,s)&&(t[s]=M(e[s]))}return t}const{toString:R}={};function O(e){return R.call(e).slice(8,-1)}const N="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",B="symbol"==typeof N?function(e){var t;return null!=e&&(t=e[N])&&t.apply(e)}:function(){return null},L={};function z(e){var t,r,n,s;if(1===arguments.length){if(o(e))return e.slice();if(this===L&&"string"==typeof e)return[e];if(s=B(e)){for(r=[];!(n=s.next()).done;)r.push(n.value);return r}if(null==e)return[e];if("number"==typeof(t=e.length)){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const U="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var F="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function j(e,t){F=e,V=t}var V=()=>!0;const W=!new Error("").stack;function $(){if(W)try{throw $.arguments,new Error}catch(e){return e}return new Error}function q(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(V).map((e=>"\n"+e)).join("")):""}var K=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],H=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(K),G={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function J(e,t){this._e=$(),this.name=e,this.message=t}function Z(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,r)=>r.indexOf(e)===t)).join("\n")}function Q(e,t,r,n){this._e=$(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=Z(e,t)}function Y(e,t){this._e=$(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=Z(e,t)}p(J).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+q(this._e,2))}},toString:function(){return this.name+": "+this.message}}),p(Q).from(J),p(Y).from(J);var X=H.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const ee=J;var te=H.reduce(((e,t)=>{var r=t+"Error";function n(e,n){this._e=$(),this.name=r,e?"string"==typeof e?(this.message=`${e}${n?"\n "+n:""}`,this.inner=n||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=G[t]||r,this.inner=null)}return p(n).from(ee),e[t]=n,e}),{});te.Syntax=SyntaxError,te.Type=TypeError,te.Range=RangeError;var re=K.reduce(((e,t)=>(e[t+"Error"]=te[t],e)),{}),ne=H.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=te[t]),e)),{});function se(){}function ie(e){return e}function oe(e,t){return null==e||e===ie?t:function(r){return t(e(r))}}function ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ce(e,t){return e===se?t:function(){var r=e.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ae(n,this.onsuccess):n),s&&(this.onerror=this.onerror?ae(s,this.onerror):s),void 0!==i?i:r}}function he(e,t){return e===se?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ae(r,this.onsuccess):r),n&&(this.onerror=this.onerror?ae(n,this.onerror):n)}}function ue(e,t){return e===se?t:function(r){var n=e.apply(this,arguments);a(r,n);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ae(s,this.onsuccess):s),i&&(this.onerror=this.onerror?ae(i,this.onerror):i),void 0===n?void 0===o?void 0:o:a(n,o)}}function le(e,t){return e===se?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function de(e,t){return e===se?t:function(){var r=e.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return r.then((function(){return t.apply(n,i)}))}return t.apply(this,arguments)}}ne.ModifyError=Q,ne.DexieError=J,ne.BulkError=Y;var fe={};const[pe,ge,me]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,c(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,c(t),e]})(),ye=ge&&ge.then,be=pe&&pe.constructor,we=!!me;var ve=!1,_e=me?()=>{me.then($e)}:s.setImmediate?setImmediate.bind(null,$e):s.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{$e(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout($e,0)},Ee=function(e,t){Ce.push([e,t]),Se&&(_e(),Se=!1)},ke=!0,Se=!0,xe=[],Ie=[],Te=null,Ae=ie,De={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{pt(e[0],e[1])}catch(e){}}))}},Pe=De,Ce=[],Me=0,Re=[];function Oe(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=se,this._lib=!1;var t=this._PSD=Pe;if(F&&(this._stackHolder=$(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==fe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&ze(this,this._value))}this._state=null,this._value=null,++t.ref,Le(this,e)}const Ne={get:function(){var e=Pe,t=et;function r(r,n){var s=!e.global&&(e!==Pe||t!==et);const i=s&&!st();var o=new Oe(((t,o)=>{Fe(this,new Be(dt(r,e,s,i),dt(n,e,s,i),t,o,e))}));return F&&We(o,this),o}return r.prototype=fe,r},set:function(e){f(this,"then",e&&e.prototype===fe?Ne:{get:function(){return e},set:Ne.set})}};function Be(e,t,r,n,s){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=s}function Le(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&qe();t&&"function"==typeof t.then?Le(e,((e,r)=>{t instanceof Oe?t._then(e,r):t.then(e,r)})):(e._state=!0,e._value=t,Ue(e)),r&&Ke()}}),ze.bind(null,e))}catch(t){ze(e,t)}}function ze(e,t){if(Ie.push(t),null===e._state){var r=e._lib&&qe();t=Ae(t),e._state=!1,e._value=t,F&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,r){try{e.apply(null,void 0)}catch(e){}}((()=>{var r=m(t,"stack");t._promise=e,f(t,"stack",{get:()=>ve?r&&(r.get?r.get.apply(t):r.value):e.stack})})),function(e){xe.some((t=>t._value===e._value))||xe.push(e)}(e),Ue(e),r&&Ke()}}function Ue(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)Fe(e,t[r]);var s=e._PSD;--s.ref||s.finalize(),0===Me&&(++Me,Ee((()=>{0==--Me&&He()}),[]))}function Fe(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Me,Ee(je,[r,e,t])}else e._listeners.push(t)}function je(e,t,r){try{Te=t;var n,s=t._value;t._state?n=e(s):(Ie.length&&(Ie=[]),n=e(s),-1===Ie.indexOf(s)&&function(e){for(var t=xe.length;t;)if(xe[--t]._value===e._value)return void xe.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{Te=null,0==--Me&&He(),--r.psd.ref||r.psd.finalize()}}function Ve(e,t,r){if(t.length===r)return t;var n="";if(!1===e._state){var s,i,o=e._value;null!=o?(s=o.name||"Error",i=o.message||o,n=q(o,0)):(s=o,i=""),t.push(s+(i?": "+i:"")+n)}return F&&((n=q(e._stackHolder,2))&&-1===t.indexOf(n)&&t.push(n),e._prev&&Ve(e._prev,t,r)),t}function We(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function $e(){qe()&&Ke()}function qe(){var e=ke;return ke=!1,Se=!1,e}function Ke(){var e,t,r;do{for(;Ce.length>0;)for(e=Ce,Ce=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(Ce.length>0);ke=!0,Se=!0}function He(){var e=xe;xe=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Re.slice(0),r=t.length;r;)t[--r]()}function Ge(e){return new Oe(fe,!1,e)}function Je(e,t){var r=Pe;return function(){var n=qe(),s=Pe;try{return ct(r,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ct(s,!1),n&&Ke()}}}l(Oe.prototype,{then:Ne,_then:function(e,t){Fe(this,new Be(null,null,e,t,Pe))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],r=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?r(e):Ge(e))):this.then(null,(e=>e&&e.name===t?r(e):Ge(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Ge(t))))},stack:{get:function(){if(this._stack)return this._stack;try{ve=!0;var e=Ve(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{ve=!1}}},timeout:function(e,t){return e<1/0?new Oe(((r,n)=>{var s=setTimeout((()=>n(new te.Timeout(t))),e);this.then(r,n).finally(clearTimeout.bind(null,s))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&f(Oe.prototype,Symbol.toStringTag,"Dexie.Promise"),De.env=ht(),l(Oe,{all:function(){var e=z.apply(null,arguments).map(it);return new Oe((function(t,r){0===e.length&&t([]);var n=e.length;e.forEach(((s,i)=>Oe.resolve(s).then((r=>{e[i]=r,--n||t(e)}),r)))}))},resolve:e=>{if(e instanceof Oe)return e;if(e&&"function"==typeof e.then)return new Oe(((t,r)=>{e.then(t,r)}));var t=new Oe(fe,!0,e);return We(t,Te),t},reject:Ge,race:function(){var e=z.apply(null,arguments).map(it);return new Oe(((t,r)=>{e.map((e=>Oe.resolve(e).then(t,r)))}))},PSD:{get:()=>Pe,set:e=>Pe=e},totalEchoes:{get:()=>et},newPSD:rt,usePSD:ut,scheduler:{get:()=>Ee,set:e=>{Ee=e}},rejectionMapper:{get:()=>Ae,set:e=>{Ae=e}},follow:(e,t)=>new Oe(((r,n)=>rt(((t,r)=>{var n=Pe;n.unhandleds=[],n.onunhandled=r,n.finalize=ae((function(){!function(e){Re.push((function t(){e(),Re.splice(Re.indexOf(t),1)})),++Me,Ee((()=>{0==--Me&&He()}),[])}((()=>{0===this.unhandleds.length?t():r(this.unhandleds[0])}))}),n.finalize),e()}),t,r,n)))}),be&&(be.allSettled&&f(Oe,"allSettled",(function(){const e=z.apply(null,arguments).map(it);return new Oe((t=>{0===e.length&&t([]);let r=e.length;const n=new Array(r);e.forEach(((e,s)=>Oe.resolve(e).then((e=>n[s]={status:"fulfilled",value:e}),(e=>n[s]={status:"rejected",reason:e})).then((()=>--r||t(n)))))}))})),be.any&&"undefined"!=typeof AggregateError&&f(Oe,"any",(function(){const e=z.apply(null,arguments).map(it);return new Oe(((t,r)=>{0===e.length&&r(new AggregateError([]));let n=e.length;const s=new Array(n);e.forEach(((e,i)=>Oe.resolve(e).then((e=>t(e)),(e=>{s[i]=e,--n||r(new AggregateError(s))}))))}))})));const Ze={awaits:0,echoes:0,id:0};var Qe=0,Ye=[],Xe=0,et=0,tt=0;function rt(e,t,r,n){var s=Pe,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++tt;var o=De.env;i.env=we?{Promise:Oe,PromiseProp:{value:Oe,configurable:!0,writable:!0},all:Oe.all,race:Oe.race,allSettled:Oe.allSettled,any:Oe.any,resolve:Oe.resolve,reject:Oe.reject,nthen:ft(o.nthen,i),gthen:ft(o.gthen,i)}:{},t&&a(i,t),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var c=ut(i,e,r,n);return 0===i.ref&&i.finalize(),c}function nt(){return Ze.id||(Ze.id=++Qe),++Ze.awaits,Ze.echoes+=100,Ze.id}function st(){return!!Ze.awaits&&(0==--Ze.awaits&&(Ze.id=0),Ze.echoes=100*Ze.awaits,!0)}function it(e){return Ze.echoes&&e&&e.constructor===be?(nt(),e.then((e=>(st(),e)),(e=>(st(),gt(e))))):e}function ot(e){++et,Ze.echoes&&0!=--Ze.echoes||(Ze.echoes=Ze.id=0),Ye.push(Pe),ct(e,!0)}function at(){var e=Ye[Ye.length-1];Ye.pop(),ct(e,!1)}function ct(e,t){var r=Pe;if((t?!Ze.echoes||Xe++&&e===Pe:!Xe||--Xe&&e===Pe)||lt(t?ot.bind(null,e):at),e!==Pe&&(Pe=e,r===De&&(De.env=ht()),we)){var n=De.env.Promise,i=e.env;ge.then=i.nthen,n.prototype.then=i.gthen,(r.global||e.global)&&(Object.defineProperty(s,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function ht(){var e=s.Promise;return we?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ge.then,gthen:e.prototype.then}:{}}function ut(e,t,r,n,s){var i=Pe;try{return ct(e,!0),t(r,n,s)}finally{ct(i,!1)}}function lt(e){ye.call(pe,e)}function dt(e,t,r,n){return"function"!=typeof e?e:function(){var s=Pe;r&&nt(),ct(t,!0);try{return e.apply(this,arguments)}finally{ct(s,!1),n&&lt(st)}}}function ft(e,t){return function(r,n){return e.call(this,dt(r,t),dt(n,t))}}function pt(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var i,o={promise:t,reason:e};if(s.document&&document.createEvent?((i=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),a(i,o)):s.CustomEvent&&a(i=new CustomEvent("unhandledrejection",{detail:o}),o),i&&s.dispatchEvent&&(dispatchEvent(i),!s.PromiseRejectionEvent&&s.onunhandledrejection))try{s.onunhandledrejection(i)}catch(e){}F&&i&&!i.defaultPrevented&&n.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+ye).indexOf("[native code]")&&(nt=st=se);var gt=Oe.reject;function mt(e,t,r,s){if(e.idbdb&&(e._state.openComplete||Pe.letThrough||e._vip)){var i=e._createTransaction(t,r,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(n.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>mt(e,t,r,s)))):gt(i)}return i._promise(t,((e,t)=>rt((()=>(Pe.trans=i,s(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return gt(new te.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return gt(new te.DatabaseClosed);e.open().catch(se)}return e._state.dbReadyPromise.then((()=>mt(e,t,r,s)))}const yt=String.fromCharCode(65535),bt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wt=[],vt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),_t=vt,Et=vt,kt=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function St(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const xt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function It(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=C(t))[e],t)}class Tt{_trans(e,t,r){const n=this._tx||Pe.trans,s=this.name;function i(e,r,n){if(!n.schema[s])throw new te.NotFound("Table "+s+" not part of transaction");return t(n.idbtrans,n)}const o=qe();try{return n&&n.db===this.db?n===Pe.trans?n._promise(e,i,r):rt((()=>n._promise(e,i,r)),{trans:n,transless:Pe.transless||Pe}):mt(this.db,e,[this.name],i)}finally{o&&Ke()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(o(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=i(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(r&&this.db._maxKey!==yt)return this.where(r.name).equals(r.keyPath.map((t=>e[t])));!r&&F&&n.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:s}=this.schema,a=this.db._deps.indexedDB;function c(e,t){try{return 0===a.cmp(e,t)}catch(e){return!1}}const[h,u]=t.reduce((([t,r],n)=>{const i=s[n],a=e[n];return[t||i,t||!i?St(r,i&&i.multi?e=>{const t=k(e,n);return o(t)&&t.some((e=>c(a,e)))}:e=>c(a,k(e,n))):r]}),[null,null]);return h?this.where(h.name).equals(e[h.keyPath]).filter(u):r?this.filter(u):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,o(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const r=Object.create(e.prototype);for(var n in t)if(u(t,n))try{r[n]=t[n]}catch(e){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){a(this,e)}))}add(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let s=e;return n&&r&&(s=It(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[s]}))).then((e=>e.numFailures?Oe.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{S(e,n,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||o(e))return this.where(":id").equals(e).modify(t);{const r=k(e,this.schema.primKey.keyPath);if(void 0===r)return gt(new te.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?i(t).forEach((r=>{S(e,r,t[r])})):t(e,{value:e,primKey:r})}catch(e){}return this.where(":id").equals(r).modify(t)}}put(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let s=e;return n&&r&&(s=It(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[s],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Oe.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{S(e,n,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Oe.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:xt}))).then((e=>e.numFailures?Oe.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,r){const n=Array.isArray(t)?t:void 0,s=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:i}=this.schema.primKey;if(i&&n)throw new te.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=i&&r?e.map(It(i)):e;return this.core.mutate({trans:t,type:"add",keys:n,values:a,wantResults:s}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return s?t:r;throw new Y(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,n)}))}))}bulkPut(e,t,r){const n=Array.isArray(t)?t:void 0,s=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:i}=this.schema.primKey;if(i&&n)throw new te.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=i&&r?e.map(It(i)):e;return this.core.mutate({trans:t,type:"put",keys:n,values:a,wantResults:s}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return s?t:r;throw new Y(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,n)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:r,failures:n})=>{if(0===e)return r;throw new Y(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,n)}))}}function At(e){var t={},r=function(r,n){if(n){for(var s=arguments.length,i=new Array(s-1);--s;)i[s-1]=arguments[s];return t[r].subscribe.apply(null,i),e}if("string"==typeof r)return t[r]};r.addEventType=a;for(var n=1,s=arguments.length;n<s;++n)a(arguments[n]);return r;function a(e,n,s){if("object"==typeof e)return c(e);n||(n=le),s||(s=se);var i={subscribers:[],fire:s,subscribe:function(e){-1===i.subscribers.indexOf(e)&&(i.subscribers.push(e),i.fire=n(i.fire,e))},unsubscribe:function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e})),i.fire=i.subscribers.reduce(n,s)}};return t[e]=r[e]=i,i}function c(e){i(e).forEach((function(t){var r=e[t];if(o(r))a(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new te.InvalidArgument("Invalid event config");var n=a(t,ie,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){_((function(){e.apply(null,t)}))}))}))}}))}}function Dt(e,t){return p(t).from({prototype:e}),t}function Pt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ct(e,t){e.filter=St(e.filter,t)}function Mt(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>St(n(),t()):t,e.justLimit=r&&!n}function Rt(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new te.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Ot(e,t,r){const n=Rt(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function Nt(e,t,r,n){const s=e.replayFilter?St(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},o=(e,r,n)=>{if(!s||s(r,n,(e=>r.stop(e)),(e=>r.fail(e)))){var o=r.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),u(i,a)||(i[a]=!0,t(e,r,n))}};return Promise.all([e.or._iterate(o,r),Bt(Ot(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Bt(Ot(e,n,r),St(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Bt(e,t,r,n){var s=Je(n?(e,t,s)=>r(n(e),t,s):r);return e.then((e=>{if(e)return e.start((()=>{var r=()=>e.continue();t&&!t(e,(e=>r=e),(t=>{e.stop(t),r=se}),(t=>{e.fail(t),r=se}))||s(e.value,e,(e=>r=e)),r()}))}))}function Lt(e,t){try{const r=zt(e),n=zt(t);if(r!==n)return"Array"===r?1:"Array"===n?-1:"binary"===r?1:"binary"===n?-1:"string"===r?1:"string"===n?-1:"Date"===r?1:"Date"!==n?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const r=e.length,n=t.length,s=r<n?r:n;for(let r=0;r<s;++r)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return r===n?0:r<n?-1:1}(Ut(e),Ut(t));case"Array":return function(e,t){const r=e.length,n=t.length,s=r<n?r:n;for(let r=0;r<s;++r){const n=Lt(e[r],t[r]);if(0!==n)return n}return r===n?0:r<n?-1:1}(e,t)}}catch(e){}return NaN}function zt(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const r=O(e);return"ArrayBuffer"===r?"binary":r}function Ut(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Ft{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,gt.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,gt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=St(t.algorithm,e)}_iterate(e,t){return Nt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&a(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((r=>Nt(t,e,r,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,r=t.table.core;if(Pt(t,!0))return r.count({trans:e,query:{index:Rt(t,r.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var n=0;return Nt(t,(()=>(++n,!1)),e,r).then((()=>n))})).then(e)}sortBy(e,t){const r=e.split(".").reverse(),n=r[0],s=r.length-1;function i(e,t){return t?i(e[r[t]],t-1):e[n]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var r=i(e,s),n=i(t,s);return r<n?-o:r>n?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Pt(t,!0)&&t.limit>0){const{valueMapper:r}=t,n=Rt(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:n,range:t.range}}).then((({result:e})=>r?e.map(r):e))}{const r=[];return Nt(t,(e=>r.push(e)),e,t.table.core).then((()=>r))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Pt(t)?Mt(t,(()=>{var t=e;return(e,r)=>0===t||(1===t?(--t,!1):(r((()=>{e.advance(t),t=0})),!1))})):Mt(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Mt(this._ctx,(()=>{var t=e;return function(e,r,n){return--t<=0&&r(n),t>=0}}),!0),this}until(e,t){return Ct(this._ctx,(function(r,n,s){return!e(r.value)||(n(s),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,r;return Ct(this._ctx,(function(t){return e(t.value)})),t=this._ctx,r=e,t.isMatch=St(t.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.key,r)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.primaryKey,r)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.key)})).then((function(){return r})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Pt(t,!0)&&t.limit>0)return this._read((e=>{var r=Rt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return Ct(this._ctx,(function(e){var t=e.primaryKey.toString(),n=u(r,t);return r[t]=!0,!n})),this}modify(e){var t=this._ctx;return this._write((r=>{var n;if("function"==typeof e)n=e;else{var s=i(e),o=s.length;n=function(t){for(var r=!1,n=0;n<o;++n){var i=s[n],a=e[i];k(t,i)!==a&&(S(t,i,a),r=!0)}return r}}const a=t.table.core,{outbound:c,extractKey:h}=a.schema.primaryKey,u=this.db._options.modifyChunkSize||200,l=[];let d=0;const f=[],p=(e,t)=>{const{failures:r,numFailures:n}=t;d+=e-n;for(let e of i(r))l.push(r[e])};return this.clone().primaryKeys().then((s=>{const i=o=>{const l=Math.min(u,s.length-o);return a.getMany({trans:r,keys:s.slice(o,o+l),cache:"immutable"}).then((d=>{const f=[],g=[],m=c?[]:null,y=[];for(let e=0;e<l;++e){const t=d[e],r={value:C(t),primKey:s[o+e]};!1!==n.call(r,r.value,r)&&(null==r.value?y.push(s[o+e]):c||0===Lt(h(t),h(r.value))?(g.push(r.value),c&&m.push(s[o+e])):(y.push(s[o+e]),f.push(r.value)))}const b=Pt(t)&&t.limit===1/0&&("function"!=typeof e||e===jt)&&{index:t.index,range:t.range};return Promise.resolve(f.length>0&&a.mutate({trans:r,type:"add",values:f}).then((e=>{for(let t in e.failures)y.splice(parseInt(t),1);p(f.length,e)}))).then((()=>(g.length>0||b&&"object"==typeof e)&&a.mutate({trans:r,type:"put",keys:m,values:g,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>p(g.length,e))))).then((()=>(y.length>0||b&&e===jt)&&a.mutate({trans:r,type:"delete",keys:y,criteria:b}).then((e=>p(y.length,e))))).then((()=>s.length>o+l&&i(o+u)))}))};return i(0).then((()=>{if(l.length>0)throw new Q("Error modifying one or more objects",l,d,f);return s.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Pt(e)&&(e.isPrimKey&&!Et||3===t.type)?this._write((r=>{const{primaryKey:n}=e.table.core.schema,s=t;return e.table.core.count({trans:r,query:{index:n,range:s}}).then((t=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then((({failures:e,lastResult:r,results:n,numFailures:s})=>{if(s)throw new Q("Could not delete some values",Object.keys(e).map((t=>e[t])),t-s);return t-s}))))})):this.modify(jt)}}const jt=(e,t)=>t.value=null;function Vt(e,t){return e<t?-1:e===t?0:1}function Wt(e,t){return e>t?-1:e===t?0:1}function $t(e,t,r){var n=e instanceof Zt?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function qt(e){return new e.Collection(e,(()=>Jt(""))).limit(0)}function Kt(e,t,r,n,s,i){for(var o=Math.min(e.length,n.length),a=-1,c=0;c<o;++c){var h=t[c];if(h!==n[c])return s(e[c],r[c])<0?e.substr(0,c)+r[c]+r.substr(c+1):s(e[c],n[c])<0?e.substr(0,c)+n[c]+r.substr(c+1):a>=0?e.substr(0,a)+t[a]+r.substr(a+1):null;s(e[c],h)<0&&(a=c)}return o<n.length&&"next"===i?e+r.substr(e.length):o<e.length&&"prev"===i?e.substr(0,r.length):a<0?null:e.substr(0,a)+n[a]+r.substr(a+1)}function Ht(e,t,r,n){var s,i,o,a,c,h,u,l=r.length;if(!r.every((e=>"string"==typeof e)))return $t(e,"String expected.");function d(e){s=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),i=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),o="next"===e?Vt:Wt;var t=r.map((function(e){return{lower:i(e),upper:s(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),h=e,u="next"===e?"":n}d("next");var f=new e.Collection(e,(()=>Gt(a[0],c[l-1]+n)));f._ondirectionchange=function(e){d(e)};var p=0;return f._addAlgorithm((function(e,r,n){var s=e.key;if("string"!=typeof s)return!1;var d=i(s);if(t(d,c,p))return!0;for(var f=null,g=p;g<l;++g){var m=Kt(s,d,a[g],c[g],o,h);null===m&&null===f?p=g+1:(null===f||o(f,m)>0)&&(f=m)}return r(null!==f?function(){e.continue(f+u)}:n),!1})),f}function Gt(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Jt(e){return{type:1,lower:e,upper:e}}class Zt{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,n){r=!1!==r,n=!0===n;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?qt(this):new this.Collection(this,(()=>Gt(e,t,!r,!n)))}catch(e){return $t(this,bt)}}equals(e){return null==e?$t(this,bt):new this.Collection(this,(()=>Jt(e)))}above(e){return null==e?$t(this,bt):new this.Collection(this,(()=>Gt(e,void 0,!0)))}aboveOrEqual(e){return null==e?$t(this,bt):new this.Collection(this,(()=>Gt(e,void 0,!1)))}below(e){return null==e?$t(this,bt):new this.Collection(this,(()=>Gt(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?$t(this,bt):new this.Collection(this,(()=>Gt(void 0,e)))}startsWith(e){return"string"!=typeof e?$t(this,"String expected."):this.between(e,e+yt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):Ht(this,((e,t)=>0===e.indexOf(t[0])),[e],yt)}equalsIgnoreCase(e){return Ht(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=z.apply(L,arguments);return 0===e.length?qt(this):Ht(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=z.apply(L,arguments);return 0===e.length?qt(this):Ht(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,yt)}anyOf(){const e=z.apply(L,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return $t(this,bt)}if(0===e.length)return qt(this);const r=new this.Collection(this,(()=>Gt(e[0],e[e.length-1])));r._ondirectionchange=r=>{t="next"===r?this._ascending:this._descending,e.sort(t)};let n=0;return r._addAlgorithm(((r,s,i)=>{const o=r.key;for(;t(o,e[n])>0;)if(++n,n===e.length)return s(i),!1;return 0===t(o,e[n])||(s((()=>{r.continue(e[n])})),!1)})),r}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=z.apply(L,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return $t(this,bt)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const r=this._cmp,n=this._ascending,s=this._descending,i=this._min,o=this._max;if(0===e.length)return qt(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&n(e[0],e[1])<=0)))return $t(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",te.InvalidArgument);const a=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let h,u=n;function l(e,t){return u(e[0],t[0])}try{h=e.reduce((function(e,t){let n=0,s=e.length;for(;n<s;++n){const s=e[n];if(r(t[0],s[1])<0&&r(t[1],s[0])>0){s[0]=i(s[0],t[0]),s[1]=o(s[1],t[1]);break}}return n===s&&e.push(t),e}),[]),h.sort(l)}catch(e){return $t(this,bt)}let d=0;const f=c?e=>n(e,h[d][1])>0:e=>n(e,h[d][1])>=0,p=a?e=>s(e,h[d][0])>0:e=>s(e,h[d][0])>=0;let g=f;const m=new this.Collection(this,(()=>Gt(h[0][0],h[h.length-1][1],!a,!c)));return m._ondirectionchange=e=>{"next"===e?(g=f,u=n):(g=p,u=s),h.sort(l)},m._addAlgorithm(((e,t,r)=>{for(var s=e.key;g(s);)if(++d,d===h.length)return t(r),!1;return!!function(e){return!f(e)&&!p(e)}(s)||(0===this._cmp(s,h[d][1])||0===this._cmp(s,h[d][0])||t((()=>{u===n?e.continue(h[d][0]):e.continue(h[d][1])})),!1)})),m}startsWithAnyOf(){const e=z.apply(L,arguments);return e.every((e=>"string"==typeof e))?0===e.length?qt(this):this.inAnyRange(e.map((e=>[e,e+yt]))):$t(this,"startsWithAnyOf() only works with strings")}}function Qt(e){return Je((function(t){return Yt(t),e(t.target.error),!1}))}function Yt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Xt=At(null,"storagemutated");class er{_lock(){return v(!Pe.global),++this._reculock,1!==this._reculock||Pe.global||(Pe.lockOwnerFor=this),this}_unlock(){if(v(!Pe.global),0==--this._reculock)for(Pe.global||(Pe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ut(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Pe.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,r=this.db._state.dbOpenError;if(v(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new te.DatabaseClosed(r);case"MissingAPIError":throw new te.MissingAPI(r.message,r);default:throw new te.OpenFailed(r)}if(!this.active)throw new te.TransactionInactive;return v(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Je((t=>{Yt(t),this._reject(e.error)})),e.onabort=Je((t=>{Yt(t),this.active&&this._reject(new te.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Je((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Xt.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,r){if("readwrite"===e&&"readwrite"!==this.mode)return gt(new te.ReadOnly("Transaction is readonly"));if(!this.active)return gt(new te.TransactionInactive);if(this._locked())return new Oe(((n,s)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(n,s)},Pe])}));if(r)return rt((()=>{var e=new Oe(((e,r)=>{this._lock();const n=t(e,r,this);n&&n.then&&n.then(e,r)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var n=new Oe(((e,r)=>{var n=t(e,r,this);n&&n.then&&n.then(e,r)}));return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const r=Oe.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>r));else{t._waitingFor=r,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var s=t._waitingFor;return new Oe(((e,n)=>{r.then((r=>t._waitingQueue.push(Je(e.bind(null,r)))),(e=>t._waitingQueue.push(Je(n.bind(null,e))))).finally((()=>{t._waitingFor===s&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new te.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(u(t,e))return t[e];const r=this.schema[e];if(!r)throw new te.NotFound("Table "+e+" not part of transaction");const n=new this.db.Table(e,r,this);return n.core=this.db.core.table(e),t[e]=n,n}}function tr(e,t,r,n,s,i,o){return{name:e,keyPath:t,unique:r,multi:n,auto:s,compound:i,src:(r&&!o?"&":"")+(n?"*":"")+(s?"++":"")+rr(t)}}function rr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function nr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:E(r,(e=>[e.name,e]))}}let sr=e=>{try{return e.only([[]]),sr=()=>[[]],[[]]}catch(e){return sr=()=>yt,yt}};function ir(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>k(t,e)}(e):t=>k(t,e)}function or(e){return[].slice.call(e)}let ar=0;function cr(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function hr(e,t,r){function n(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:r,upper:n,lowerOpen:s,upperOpen:i}=e;return void 0===r?void 0===n?null:t.upperBound(n,!!i):void 0===n?t.lowerBound(r,!!s):t.bound(r,n,!!s,!!i)}const{schema:s,hasGetAll:i}=function(e,t){const r=or(e.objectStoreNames);return{schema:{name:e.name,tables:r.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:r}=e,n=o(t),s=null==t,i={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:s,compound:n,keyPath:t,autoIncrement:r,unique:!0,extractKey:ir(t)},indexes:or(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:r,multiEntry:n,keyPath:s}=e,a={name:t,compound:o(s),keyPath:s,unique:r,multiEntry:n,extractKey:ir(s)};return i[cr(s)]=a,a})),getIndexByKeyPath:e=>i[cr(e)]};return i[":id"]=a.primaryKey,null!=t&&(i[cr(t)]=a.primaryKey),a}))},hasGetAll:r.length>0&&"getAll"in t.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),a=s.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:r,keys:s,values:i,range:o}){return new Promise(((a,c)=>{a=Je(a);const h=e.objectStore(t),u=null==h.keyPath,l="put"===r||"add"===r;if(!l&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);const{length:d}=s||i||{length:1};if(s&&i&&s.length!==i.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let f;const p=[],g=[];let m=0;const y=e=>{++m,Yt(e)};if("deleteRange"===r){if(4===o.type)return a({numFailures:m,failures:g,results:[],lastResult:void 0});3===o.type?p.push(f=h.clear()):p.push(f=h.delete(n(o)))}else{const[e,t]=l?u?[i,s]:[i,null]:[s,null];if(l)for(let n=0;n<d;++n)p.push(f=t&&void 0!==t[n]?h[r](e[n],t[n]):h[r](e[n])),f.onerror=y;else for(let t=0;t<d;++t)p.push(f=h[r](e[t])),f.onerror=y}const b=e=>{const t=e.target.result;p.forEach(((e,t)=>null!=e.error&&(g[t]=e.error))),a({numFailures:m,failures:g,results:"delete"===r?s:p.map((e=>e.result)),lastResult:t})};f.onerror=e=>{y(e),b(e)},f.onsuccess=b}))},getMany:({trans:e,keys:r})=>new Promise(((n,s)=>{n=Je(n);const i=e.objectStore(t),o=r.length,a=new Array(o);let c,h=0,u=0;const l=e=>{const t=e.target;a[t._pos]=t.result,++u===h&&n(a)},d=Qt(s);for(let e=0;e<o;++e)null!=r[e]&&(c=i.get(r[e]),c._pos=e,c.onsuccess=l,c.onerror=d,++h);0===h&&n(a)})),get:({trans:e,key:r})=>new Promise(((n,s)=>{n=Je(n);const i=e.objectStore(t).get(r);i.onsuccess=e=>n(e.target.result),i.onerror=Qt(s)})),query:function(e){return r=>new Promise(((s,i)=>{s=Je(s);const{trans:o,values:a,limit:c,query:h}=r,u=c===1/0?void 0:c,{index:l,range:d}=h,f=o.objectStore(t),p=l.isPrimaryKey?f:f.index(l.name),g=n(d);if(0===c)return s({result:[]});if(e){const e=a?p.getAll(g,u):p.getAllKeys(g,u);e.onsuccess=e=>s({result:e.target.result}),e.onerror=Qt(i)}else{let e=0;const t=a||!("openKeyCursor"in p)?p.openCursor(g):p.openKeyCursor(g),r=[];t.onsuccess=n=>{const i=t.result;return i?(r.push(a?i.value:i.primaryKey),++e===c?s({result:r}):void i.continue()):s({result:r})},t.onerror=Qt(i)}}))}(i),openCursor:function({trans:e,values:r,query:s,reverse:i,unique:o}){return new Promise(((a,c)=>{a=Je(a);const{index:h,range:u}=s,l=e.objectStore(t),d=h.isPrimaryKey?l:l.index(h.name),f=i?o?"prevunique":"prev":o?"nextunique":"next",p=r||!("openKeyCursor"in d)?d.openCursor(n(u),f):d.openKeyCursor(n(u),f);p.onerror=Qt(c),p.onsuccess=Je((t=>{const r=p.result;if(!r)return void a(null);r.___id=++ar,r.done=!1;const n=r.continue.bind(r);let s=r.continuePrimaryKey;s&&(s=s.bind(r));const i=r.advance.bind(r),o=()=>{throw new Error("Cursor not stopped")};r.trans=e,r.stop=r.continue=r.continuePrimaryKey=r.advance=()=>{throw new Error("Cursor not started")},r.fail=Je(c),r.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},r.start=e=>{const t=new Promise(((e,t)=>{e=Je(e),p.onerror=Qt(t),r.fail=t,r.stop=t=>{r.stop=r.continue=r.continuePrimaryKey=r.advance=o,e(t)}})),a=()=>{if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=()=>{throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Je((e=>{p.onsuccess=a,a()})),r.continue=n,r.continuePrimaryKey=s,r.advance=i,a(),t},a(r)}),c)}))},count({query:e,trans:r}){const{index:s,range:i}=e;return new Promise(((e,o)=>{const a=r.objectStore(t),c=s.isPrimaryKey?a:a.index(s.name),h=n(i),u=h?c.count(h):c.count();u.onsuccess=Je((t=>e(t.target.result))),u.onerror=Qt(o)}))}}}(e))),c={};return a.forEach((e=>c[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!c[e])throw new Error(`Table '${e}' not found`);return c[e]},MIN_KEY:-1/0,MAX_KEY:sr(t),schema:s}}function ur({_novip:e},t){const r=t.db,n=function(e,t,{IDBKeyRange:r,indexedDB:n},s){const i=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(hr(t,r,s),e.dbcore);return{dbcore:i}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach((t=>{const r=t.name;e.core.schema.tables.some((e=>e.name===r))&&(t.core=e.core.table(r),e[r]instanceof e.Table&&(e[r].core=t.core))}))}function lr({_novip:e},t,r,n){r.forEach((r=>{const s=n[r];t.forEach((t=>{const n=m(t,r);(!n||"value"in n&&void 0===n.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?f(t,r,{get(){return this.table(r)},set(e){d(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[r]=new e.Table(r,s))}))}))}function dr({_novip:e},t){t.forEach((t=>{for(let r in t)t[r]instanceof e.Table&&delete t[r]}))}function fr(e,t){return e._cfg.version-t._cfg.version}function pr(e,t,r,n){const s=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,s);o.create(r),o._completion.catch(n);const a=o._reject.bind(o),c=Pe.transless||Pe;rt((()=>{Pe.trans=o,Pe.transless=c,0===t?(i(s).forEach((e=>{mr(r,e,s[e].primKey,s[e].indexes)})),ur(e,r),Oe.follow((()=>e.on.populate.fire(o))).catch(a)):function({_novip:e},t,r,n){const s=[],o=e._versions;let a=e._dbSchema=br(e,e.idbdb,n),c=!1;return o.filter((e=>e._cfg.version>=t)).forEach((o=>{s.push((()=>{const s=a,h=o._cfg.dbschema;wr(e,s,n),wr(e,h,n),a=e._dbSchema=h;const u=gr(s,h);u.add.forEach((e=>{mr(n,e[0],e[1].primKey,e[1].indexes)})),u.change.forEach((e=>{if(e.recreate)throw new te.Upgrade("Not yet support for changing primary key");{const t=n.objectStore(e.name);e.add.forEach((e=>yr(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),yr(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const l=o._cfg.contentUpgrade;if(l&&o._cfg.version>t){ur(e,n),r._memoizedTables={},c=!0;let t=x(h);u.del.forEach((e=>{t[e]=s[e]})),dr(e,[e.Transaction.prototype]),lr(e,[e.Transaction.prototype],i(t),t),r.schema=t;const o=U(l);let a;o&&nt();const d=Oe.follow((()=>{if(a=l(r),a&&o){var e=st.bind(null,null);a.then(e,e)}}));return a&&"function"==typeof a.then?Oe.resolve(a):d.then((()=>a))}})),s.push((t=>{c&&_t||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((r=>null==e[r]&&t.db.deleteObjectStore(r)))}(o._cfg.dbschema,t),dr(e,[e.Transaction.prototype]),lr(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),r.schema=e._dbSchema}))})),function e(){return s.length?Oe.resolve(s.shift()(r.idbtrans)).then(e):Oe.resolve()}().then((()=>{var e,t;t=n,i(e=a).forEach((r=>{t.db.objectStoreNames.contains(r)||mr(t,r,e[r].primKey,e[r].indexes)}))}))}(e,t,o,r).catch(a)}))}function gr(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const s=e[n],i=t[n];if(s){const e={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!vt)e.recreate=!0,r.change.push(e);else{const t=s.idxByName,n=i.idxByName;let o;for(o in t)n[o]||e.del.push(o);for(o in n){const r=t[o],s=n[o];r?r.src!==s.src&&e.change.push(s):e.add.push(s)}(e.del.length>0||e.add.length>0||e.change.length>0)&&r.change.push(e)}}else r.add.push([n,i])}return r}function mr(e,t,r,n){const s=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((e=>yr(s,e))),s}function yr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function br(e,t,r){const n={};return b(t.objectStoreNames,0).forEach((e=>{const t=r.objectStore(e);let s=t.keyPath;const i=tr(rr(s),s||"",!1,!1,!!t.autoIncrement,s&&"string"!=typeof s,!0),o=[];for(let e=0;e<t.indexNames.length;++e){const r=t.index(t.indexNames[e]);s=r.keyPath;var a=tr(r.name,s,!!r.unique,!!r.multiEntry,!1,s&&"string"!=typeof s,!1);o.push(a)}n[e]=nr(e,i,o)})),n}function wr({_novip:e},t,r){const n=r.db.objectStoreNames;for(let s=0;s<n.length;++s){const i=n[s],o=r.objectStore(i);e._hasGetAll="getAll"in o;for(let e=0;e<o.indexNames.length;++e){const r=o.indexNames[e],n=o.index(r).keyPath,s="string"==typeof n?n:"["+b(n).join("+")+"]";if(t[i]){const e=t[i].idxByName[s];e&&(e.name=r,delete t[i].idxByName[s],t[i].idxByName[r]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class vr{_parseStoresSpec(e,t){i(e).forEach((r=>{if(null!==e[r]){var n=e[r].split(",").map(((e,t)=>{const r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return tr(r,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),o(n),0===t)})),s=n.shift();if(s.multi)throw new te.Schema("Primary key cannot be multi-valued");n.forEach((e=>{if(e.auto)throw new te.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new te.Schema("Index must have a name and cannot be an empty string")})),t[r]=nr(r,s,n)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,e):e;const r=t._versions,n={};let s={};return r.forEach((e=>{a(n,e._cfg.storesSource),s=e._cfg.dbschema={},e._parseStoresSpec(n,s)})),t._dbSchema=s,dr(t,[t._allTables,t,t.Transaction.prototype]),lr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],i(s),s),t._storeNames=i(s),this}upgrade(e){return this._cfg.contentUpgrade=de(this._cfg.contentUpgrade||se,e),this}}function _r(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Vr("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Er(e){return e&&"function"==typeof e.databases}function kr(e){return rt((function(){return Pe.letThrough=!0,e()}))}function Sr(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function xr(e){var t=t=>e.next(t),r=s(t),n=s((t=>e.throw(t)));function s(e){return t=>{var s=e(t),i=s.value;return s.done?i:i&&"function"==typeof i.then?i.then(r,n):o(i)?Promise.all(i).then(r,n):r(i)}}return s(t)()}function Ir(e,t,r){var n=arguments.length;if(n<2)throw new te.InvalidArgument("Too few arguments");for(var s=new Array(n-1);--n;)s[n-1]=arguments[n];return r=s.pop(),[e,T(s),r]}function Tr(e,t,r,s,i){return Oe.resolve().then((()=>{const o=Pe.transless||Pe,a=e._createTransaction(t,r,e._dbSchema,s),c={trans:a,transless:o};if(s)a.idbtrans=s.idbtrans;else try{a.create(),e._state.PR1398_maxLoop=3}catch(s){return s.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(n.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Tr(e,t,r,null,i)))):gt(s)}const h=U(i);let u;h&&nt();const l=Oe.follow((()=>{if(u=i.call(a,a),u)if(h){var e=st.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=xr(u))}),c);return(u&&"function"==typeof u.then?Oe.resolve(u).then((e=>a.active?e:gt(new te.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):l.then((()=>u))).then((e=>(s&&a._resolve(),a._completion.then((()=>e))))).catch((e=>(a._reject(e),gt(e))))}))}function Ar(e,t,r){const n=o(e)?e.slice():[e];for(let e=0;e<r;++e)n.push(t);return n}const Dr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,s={},i=[];function o(e,t,r){const n=cr(e),a=s[n]=s[n]||[],c=null==e?0:"string"==typeof e?1:e.length,h=t>0,u={...r,isVirtual:h,keyTail:t,keyLength:c,extractKey:ir(e),unique:!h&&r.unique};return a.push(u),u.isPrimaryKey||i.push(u),c>1&&o(2===c?e[0]:e.slice(0,c-1),t+1,r),a.sort(((e,t)=>e.keyTail-t.keyTail)),u}const a=o(n.primaryKey.keyPath,0,n.primaryKey);s[":id"]=[a];for(const e of n.indexes)o(e.keyPath,0,e);function c(t){const r=t.query.index;return r.isVirtual?{...t,query:{index:r,range:(n=t.query.range,s=r.keyTail,{type:1===n.type?2:n.type,lower:Ar(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,s),lowerOpen:!0,upper:Ar(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,s),upperOpen:!0})}}:t;var n,s}const h={...r,schema:{...n,primaryKey:a,indexes:i,getIndexByKeyPath:function(e){const t=s[cr(e)];return t&&t[0]}},count:e=>r.count(c(e)),query:e=>r.query(c(e)),openCursor(t){const{keyTail:n,isVirtual:s,keyLength:i}=t.query.index;return s?r.openCursor(c(t)).then((r=>r&&function(r){const s=Object.create(r,{continue:{value:function(s){null!=s?r.continue(Ar(s,t.reverse?e.MAX_KEY:e.MIN_KEY,n)):t.unique?r.continue(r.key.slice(0,i).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,n)):r.continue()}},continuePrimaryKey:{value(t,s){r.continuePrimaryKey(Ar(t,e.MAX_KEY,n),s)}},primaryKey:{get:()=>r.primaryKey},key:{get(){const e=r.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:()=>r.value}});return s}(r))):r.openCursor(t)}};return h}}}};function Pr(e,t,r,n){return r=r||{},n=n||"",i(e).forEach((s=>{if(u(t,s)){var i=e[s],o=t[s];if("object"==typeof i&&"object"==typeof o&&i&&o){const e=O(i);e!==O(o)?r[n+s]=t[s]:"Object"===e?Pr(i,o,r,n+s+"."):i!==o&&(r[n+s]=t[s])}else i!==o&&(r[n+s]=t[s])}else r[n+s]=void 0})),i(t).forEach((s=>{u(e,s)||(r[n+s]=t[s])})),r}const Cr={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema,s={...r,mutate(e){const s=Pe.trans,{deleting:i,creating:o,updating:a}=s.table(t).hook;switch(e.type){case"add":if(o.fire===se)break;return s._promise("readwrite",(()=>c(e)),!0);case"put":if(o.fire===se&&a.fire===se)break;return s._promise("readwrite",(()=>c(e)),!0);case"delete":if(i.fire===se)break;return s._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(i.fire===se)break;return s._promise("readwrite",(()=>function(e){return h(e.trans,e.range,1e4)}(e)),!0)}return r.mutate(e);function c(e){const t=Pe.trans,s=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(n,e);if(!s)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:s}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,r){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:r,cache:"immutable"})}(r,e,s).then((c=>{const h=s.map(((r,s)=>{const h=c[s],l={onerror:null,onsuccess:null};if("delete"===e.type)i.fire.call(l,r,h,t);else if("add"===e.type||void 0===h){const i=o.fire.call(l,r,e.values[s],t);null==r&&null!=i&&(r=i,e.keys[s]=r,n.outbound||S(e.values[s],n.keyPath,r))}else{const n=Pr(h,e.values[s]),i=a.fire.call(l,n,r,h,t);if(i){const t=e.values[s];Object.keys(i).forEach((e=>{u(t,e)?t[e]=i[e]:S(t,e,i[e])}))}}return l}));return r.mutate(e).then((({failures:t,results:r,numFailures:n,lastResult:i})=>{for(let n=0;n<s.length;++n){const i=r?r[n]:s[n],o=h[n];null==i?o.onerror&&o.onerror(t[n]):o.onsuccess&&o.onsuccess("put"===e.type&&c[n]?e.values[n]:i)}return{failures:t,results:r,numFailures:n,lastResult:i}})).catch((e=>(h.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function h(e,t,s){return r.query({trans:e,values:!1,query:{index:n,range:t},limit:s}).then((({result:r})=>c({type:"delete",keys:r,trans:e}).then((n=>n.numFailures>0?Promise.reject(n.failures[0]):r.length<s?{failures:[],numFailures:0,lastResult:void 0}:h(e,{...t,lower:r[r.length-1],lowerOpen:!0},s)))))}}};return s}})};function Mr(e,t,r){try{if(!t)return null;if(t.keys.length<e.length)return null;const n=[];for(let s=0,i=0;s<t.keys.length&&i<e.length;++s)0===Lt(t.keys[s],e[i])&&(n.push(r?C(t.values[s]):t.values[s]),++i);return n.length===e.length?n:null}catch(e){return null}}const Rr={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:e=>{if(!e.cache)return r.getMany(e);const t=Mr(e.keys,e.trans._cache,"clone"===e.cache);return t?Oe.resolve(t):r.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?C(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),r.mutate(e))}}})};function Or(e){return!("from"in e)}const Nr=function(e,t){if(!this){const t=new Nr;return e&&"d"in e&&a(t,e),t}a(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Br(e,t,r){const n=Lt(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(Or(e))return a(e,{from:t,to:r,d:1});const s=e.l,i=e.r;if(Lt(r,e.from)<0)return s?Br(s,t,r):e.l={from:t,to:r,d:1,l:null,r:null},Ur(e);if(Lt(t,e.to)>0)return i?Br(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},Ur(e);Lt(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),Lt(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;s&&!e.l&&Lr(e,s),i&&o&&Lr(e,i)}function Lr(e,t){Or(t)||function e(t,{from:r,to:n,l:s,r:i}){Br(t,r,n),s&&e(t,s),i&&e(t,i)}(e,t)}function zr(e){let t=Or(e)?null:{s:0,n:e};return{next(e){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&Lt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||Lt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Ur(e){var t,r;const n=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),s=n>1?"r":n<-1?"l":"";if(s){const t="r"===s?"l":"r",r={...e},n=e[s];e.from=n.from,e.to=n.to,e[s]=n[s],r[s]=n[t],e[t]=r,r.d=Fr(r)}e.d=Fr(e)}function Fr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}l(Nr.prototype,{add(e){return Lr(this,e),this},addKey(e){return Br(this,e,e),this},addKeys(e){return e.forEach((e=>Br(this,e,e))),this},[N](){return zr(this)}});const jr={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new Nr(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const s=e.table(n),{schema:a}=s,{primaryKey:c}=a,{extractKey:h,outbound:u}=c,l={...s,mutate:e=>{const i=e.trans,c=i.mutatedParts||(i.mutatedParts={}),h=e=>{const r=`idb://${t}/${n}/${e}`;return c[r]||(c[r]=new Nr)},u=h(""),l=h(":dels"),{type:d}=e;let[f,p]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const g=e.trans._cache;return s.mutate(e).then((e=>{if(o(f)){"delete"!==d&&(f=e.results),u.addKeys(f);const t=Mr(f,g);t||"add"===d||l.addKeys(f),(t||p)&&function(e,t,r,n){t.indexes.forEach((function(t){const s=e(t.name||"");function i(e){return null!=e?t.extractKey(e):null}const a=e=>t.multiEntry&&o(e)?e.forEach((e=>s.addKey(e))):s.addKey(e);(r||n).forEach(((e,t)=>{const s=r&&i(r[t]),o=n&&i(n[t]);0!==Lt(s,o)&&(null!=s&&a(s),null!=o&&a(o))}))}))}(h,a,t,p)}else if(f){const e={from:f.lower,to:f.upper};l.add(e),u.add(e)}else u.add(r),l.add(r),a.indexes.forEach((e=>h(e.name).add(r)));return e}))}},d=({query:{index:t,range:r}})=>{var n,s;return[t,new Nr(null!==(n=r.lower)&&void 0!==n?n:e.MIN_KEY,null!==(s=r.upper)&&void 0!==s?s:e.MAX_KEY)]},f={get:e=>[c,new Nr(e.key)],getMany:e=>[c,(new Nr).addKeys(e.keys)],count:d,query:d,openCursor:d};return i(f).forEach((e=>{l[e]=function(i){const{subscr:o}=Pe;if(o){const a=e=>{const r=`idb://${t}/${n}/${e}`;return o[r]||(o[r]=new Nr)},c=a(""),l=a(":dels"),[d,p]=f[e](i);if(a(d.name||"").add(p),!d.isPrimaryKey){if("count"!==e){const t="query"===e&&u&&i.values&&s.query({...i,values:!1});return s[e].apply(this,arguments).then((r=>{if("query"===e){if(u&&i.values)return t.then((({result:e})=>(c.addKeys(e),r)));const e=i.values?r.result.map(h):r.result;i.values?c.addKeys(e):l.addKeys(e)}else if("openCursor"===e){const e=r,t=i.values;return e&&Object.create(e,{key:{get:()=>(l.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return l.addKey(t),t}},value:{get:()=>(t&&c.addKey(e.primaryKey),e.value)}})}return r}))}l.add(r)}}return s[e].apply(this,arguments)}})),l}}}};class Vr{constructor(e,t){this._middlewares={},this.verno=0;const r=Vr.dependencies;this._options=t={addons:Vr.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:s}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:se,dbReadyPromise:null,cancelOpen:se,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new Oe((e=>{i.dbReadyResolve=e})),i.openCanceller=new Oe(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=At(this,"populate","blocked","versionchange","close",{ready:[de,se]}),this.on.ready.subscribe=w(this.on.ready.subscribe,(e=>(t,r)=>{Vr.vip((()=>{const n=this._state;if(n.openComplete)n.dbOpenError||Oe.resolve().then(t),r&&e(t);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(t),r&&e(t);else{e(t);const n=this;r||e((function e(){n.on.ready.unsubscribe(t),n.on.ready.unsubscribe(e)}))}}))})),this.Collection=(o=this,Dt(Ft.prototype,(function(e,t){this.db=o;let r=xt,n=null;if(t)try{r=t()}catch(e){n=e}const s=e._ctx,i=s.table,a=i.hook.reading.fire;this._ctx={table:i,index:s.index,isPrimKey:!s.index||i.schema.primKey.keyPath&&s.index===i.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:s.or,valueMapper:a!==ie?a:null}}))),this.Table=function(e){return Dt(Tt.prototype,(function(t,r,n){this.db=e,this._tx=n,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:At(null,{creating:[ce,se],reading:[oe,ie],updating:[ue,se],deleting:[he,se]})}))}(this),this.Transaction=function(e){return Dt(er.prototype,(function(t,r,n,s,i){this.db=e,this.mode=t,this.storeNames=r,this.schema=n,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=At(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Oe(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),gt(e)}))}))}(this),this.Version=function(e){return Dt(vr.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Dt(Zt.prototype,(function(t,r,n){this.db=e,this._ctx={table:t,index:":id"===r?null:r,or:n};const s=e._deps.indexedDB;if(!s)throw new te.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(e,t)=>s.cmp(t,e),this._max=(e,t)=>s.cmp(e,t)>0?e:t,this._min=(e,t)=>s.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?n.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):n.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?n.warn(`Dexie.delete('${this.name}') was blocked`):n.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=sr(t.IDBKeyRange),this._createTransaction=(e,t,r,n)=>new this.Transaction(e,t,r,this._options.chromeTransactionDurability,n),this._fireOnBlocked=e=>{this.on("blocked").fire(e),wt.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Dr),this.use(Cr),this.use(jr),this.use(Rr),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new te.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new te.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var r=t.filter((t=>t._cfg.version===e))[0];return r||(r=new this.Version(e),t.push(r),t.sort(fr),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Pe.letThrough||this._vip)?e():new Oe(((e,t)=>{if(this._state.openComplete)return t(new te.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new te.DatabaseClosed);this.open().catch(se)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:r,name:n}){n&&this.unuse({stack:e,name:n});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:null==r?10:r,name:n}),s.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>r?e.create!==r:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?gt(t.dbOpenError):e));F&&(t.openCanceller._stackHolder=$()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const s=t.openCanceller;function o(){if(t.openCanceller!==s)throw new te.DatabaseClosed("db.open() was cancelled")}let a=t.dbReadyResolve,c=null,h=!1;return Oe.race([s,("undefined"==typeof navigator?Oe.resolve():Sr()).then((()=>new Oe(((s,a)=>{if(o(),!r)throw new te.MissingAPI;const u=e.name,l=t.autoSchema?r.open(u):r.open(u,Math.round(10*e.verno));if(!l)throw new te.MissingAPI;l.onerror=Qt(a),l.onblocked=Je(e._fireOnBlocked),l.onupgradeneeded=Je((n=>{if(c=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=Yt,c.abort(),l.result.close();const e=r.deleteDatabase(u);e.onsuccess=e.onerror=Je((()=>{a(new te.NoSuchDatabase(`Database ${u} doesnt exist`))}))}else{c.onerror=Qt(a);var s=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;h=s<1,e._novip.idbdb=l.result,pr(e,s/10,c,a)}}),a),l.onsuccess=Je((()=>{c=null;const r=e._novip.idbdb=l.result,o=b(r.objectStoreNames);if(o.length>0)try{const s=r.transaction(1===(a=o).length?a[0]:a,"readonly");t.autoSchema?function({_novip:e},t,r){e.verno=t.version/10;const n=e._dbSchema=br(0,t,r);e._storeNames=b(t.objectStoreNames,0),lr(e,[e._allTables],i(n),n)}(e,r,s):(wr(e,e._dbSchema,s),function(e,t){const r=gr(br(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some((e=>e.add.length||e.change.length)))}(e,s)||n.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ur(e,s)}catch(e){}var a;wt.push(e),r.onversionchange=Je((r=>{t.vcFired=!0,e.on("versionchange").fire(r)})),r.onclose=Je((t=>{e.on("close").fire(t)})),h&&function({indexedDB:e,IDBKeyRange:t},r){!Er(e)&&"__dbnames"!==r&&_r(e,t).put({name:r}).catch(se)}(e._deps,u),s()}),a)}))))]).then((()=>(o(),t.onReadyBeingFired=[],Oe.resolve(kr((()=>e.on.ready.fire(e.vip)))).then((function r(){if(t.onReadyBeingFired.length>0){let n=t.onReadyBeingFired.reduce(de,se);return t.onReadyBeingFired=[],Oe.resolve(kr((()=>n(e.vip)))).then(r)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((r=>{t.dbOpenError=r;try{c&&c.abort()}catch(e){}return s===t.openCanceller&&e._close(),gt(r)})).finally((()=>{t.openComplete=!0,a()}))}(this)}_close(){const e=this._state,t=wt.indexOf(this);if(t>=0&&wt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Oe((t=>{e.dbReadyResolve=t})),e.openCanceller=new Oe(((t,r)=>{e.cancelOpen=r}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new te.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Oe(((r,n)=>{const s=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Je((()=>{!function({indexedDB:e,IDBKeyRange:t},r){!Er(e)&&"__dbnames"!==r&&_r(e,t).delete(r).catch(se)}(this._deps,this.name),r()})),e.onerror=Qt(n),e.onblocked=this._fireOnBlocked};if(e)throw new te.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return i(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Ir.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let n=Pe.trans;n&&n.db===this&&-1===e.indexOf("!")||(n=null);const s=-1!==e.indexOf("?");let i,o;e=e.replace("!","").replace("?","");try{if(o=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)i="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new te.InvalidArgument("Invalid transaction mode: "+e);i="readwrite"}if(n){if("readonly"===n.mode&&"readwrite"===i){if(!s)throw new te.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");n=null}n&&o.forEach((e=>{if(n&&-1===n.storeNames.indexOf(e)){if(!s)throw new te.SubTransaction("Table "+e+" not included in parent transaction.");n=null}})),s&&n&&!n.active&&(n=null)}}catch(e){return n?n._promise(null,((t,r)=>{r(e)})):gt(e)}const a=Tr.bind(null,this,i,o,n,r);return n?n._promise(i,a,"lock"):Pe.trans?ut(Pe.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!u(this._allTables,e))throw new te.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Wr="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class $r{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:r})}[Wr](){return this}}function qr(e,t){return i(t).forEach((r=>{Lr(e[r]||(e[r]=new Nr),t[r])})),e}let Kr;try{Kr={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch(s){Kr={indexedDB:null,IDBKeyRange:null}}const Hr=Vr;function Gr(e){let t=Jr;try{Jr=!0,Xt.storagemutated.fire(e)}finally{Jr=t}}l(Hr,{...ne,delete:e=>new Hr(e,{addons:[]}).delete(),exists:e=>new Hr(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Er(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):_r(e,t).toCollection().primaryKeys()}(Hr.dependencies).then(e)}catch(e){return gt(new te.MissingAPI)}},defineClass:()=>function(e){a(this,e)},ignoreTransaction:e=>Pe.trans?ut(Pe.transless,e):e(),vip:kr,async:function(e){return function(){try{var t=xr(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Oe.resolve(t)}catch(e){return gt(e)}}},spawn:function(e,t,r){try{var n=xr(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:Oe.resolve(n)}catch(e){return gt(e)}},currentTransaction:{get:()=>Pe.trans||null},waitFor:function(e,t){const r=Oe.resolve("function"==typeof e?Hr.ignoreTransaction(e):e).timeout(t||6e4);return Pe.trans?Pe.trans.waitFor(r):r},Promise:Oe,debug:{get:()=>F,set:e=>{j(e,"dexie"===e?()=>!0:kt)}},derive:p,extend:a,props:l,override:w,Events:At,on:Xt,liveQuery:function(e){return new $r((t=>{const r=U(e);let n=!1,s={},o={};const a={get closed(){return n},unsubscribe:()=>{n=!0,Xt.storagemutated.unsubscribe(l)}};t.start&&t.start(a);let c=!1,h=!1;function u(){return i(o).some((e=>s[e]&&function(e,t){const r=zr(t);let n=r.next();if(n.done)return!1;let s=n.value;const i=zr(e);let o=i.next(s.from),a=o.value;for(;!n.done&&!o.done;){if(Lt(a.from,s.to)<=0&&Lt(a.to,s.from)>=0)return!0;Lt(s.from,a.from)<0?s=(n=r.next(a.from)).value:a=(o=i.next(s.from)).value}return!1}(s[e],o[e])))}const l=e=>{qr(s,e),u()&&d()},d=()=>{if(c||n)return;s={};const i={},f=function(t){r&&nt();const n=()=>rt(e,{subscr:t,trans:null}),s=Pe.trans?ut(Pe.transless,n):n();return r&&s.then(st,st),s}(i);h||(Xt("storagemutated",l),h=!0),c=!0,Promise.resolve(f).then((e=>{c=!1,n||(u()?d():(s={},o=i,t.next&&t.next(e)))}),(e=>{c=!1,t.error&&t.error(e),a.unsubscribe()}))};return d(),a}))},extendObservabilitySet:qr,getByKeyPath:k,setByKeyPath:S,delByKeyPath:function(e,t){"string"==typeof t?S(e,t,void 0):"length"in t&&[].map.call(t,(function(t){S(e,t,void 0)}))},shallowClone:x,deepClone:C,getObjectDiff:Pr,cmp:Lt,asap:_,minKey:-1/0,addons:[],connections:wt,errnames:X,dependencies:Kr,semVer:"3.2.3",version:"3.2.3".split(".").map((e=>parseInt(e))).reduce(((e,t,r)=>e+t/Math.pow(10,2*r)))}),Hr.maxKey=sr(Hr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Xt("storagemutated",(e=>{if(!Jr){let t;vt?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Jr=!0,dispatchEvent(t),Jr=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{Jr||Gr(e)})));let Jr=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");"function"==typeof e.unref&&e.unref(),Xt("storagemutated",(t=>{Jr||e.postMessage(t)})),e.onmessage=e=>{e.data&&Gr(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Xt("storagemutated",(e=>{try{Jr||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&Gr(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&Gr(e.changedParts)}))}Oe.rejectionMapper=function(e,t){if(!e||e instanceof J||e instanceof TypeError||e instanceof SyntaxError||!e.name||!re[e.name])return e;var r=new re[e.name](t||e.message,e);return"stack"in e&&f(r,"stack",{get:function(){return this.inner.stack}}),r},j(F,kt)},26905:function(e){e.exports=function(e,t,r,n,s){for(t=t.split?t.split("."):t,n=0;n<t.length;n++)e=e?e[t[n]]:s;return e===s?r:e}},90507:function(e,t,r){"use strict";const n=r(8231);t.zN=n.EventIterator,n.EventIterator},72445:function(e){"use strict";e.exports=function(e){var t=e.uri,r=e.name,n=e.type;this.uri=t,this.name=r,this.type=n}},40804:function(e,t,r){"use strict";var n=r(51268);e.exports=function e(t,r,s){var i;void 0===r&&(r=""),void 0===s&&(s=n);var o=new Map;function a(e,t){var r=o.get(t);r?r.push.apply(r,e):o.set(t,e)}if(s(t))i=null,a([r],t);else{var c=r?r+".":"";if("undefined"!=typeof FileList&&t instanceof FileList)i=Array.prototype.map.call(t,(function(e,t){return a([""+c+t],e),null}));else if(Array.isArray(t))i=t.map((function(t,r){var n=e(t,""+c+r,s);return n.files.forEach(a),n.clone}));else if(t&&t.constructor===Object)for(var h in i={},t){var u=e(t[h],""+c+h,s);u.files.forEach(a),i[h]=u.clone}else i=t}return{clone:i,files:o}}},51268:function(e,t,r){"use strict";var n=r(72445);e.exports=function(e){return"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Blob&&e instanceof Blob||e instanceof n}},3975:function(e){e.exports=class{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},91607:function(e,t,r){const n=r(3975);e.exports=class{constructor(e){this.hwm=e||16,this.head=new n(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},16932:function(e,t,r){"use strict";const n=r(78501),s=r(58844),i=r(41192);e.exports={XMLParser:s,XMLValidator:n,XMLBuilder:i}},17849:function(e,t){"use strict";const r=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+r+"]["+(r+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",s=new RegExp("^"+n+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,r){if(t){const n=Object.keys(t),s=n.length;for(let i=0;i<s;i++)e[n[i]]="strict"===r?[t[n[i]]]:t[n[i]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){const t=s.exec(e);return!(null==t)},t.getAllMatches=function(e,t){const r=[];let n=t.exec(e);for(;n;){const s=[];s.startIndex=t.lastIndex-n[0].length;const i=n.length;for(let e=0;e<i;e++)s.push(n[e]);r.push(s),n=t.exec(e)}return r},t.nameRegexp=n},78501:function(e,t,r){"use strict";const n=r(17849),s={allowBooleanAttributes:!1,unpairedTags:[]};function i(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function o(e,t){const r=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const n=e.substr(r,t-r);if(t>5&&"xml"===n)return p("InvalidXml","XML declaration allowed only at the start of the document.",m(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function a(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let r=1;for(t+=8;t<e.length;t++)if("<"===e[t])r++;else if(">"===e[t]&&(r--,0===r))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},s,t);const r=[];let c=!1,h=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=o(e,s),s.err)return s}else{if("<"!==e[s]){if(i(e[s]))continue;return p("InvalidChar","char '"+e[s]+"' is not expected.",m(e,s))}{let g=s;if(s++,"!"===e[s]){s=a(e,s);continue}{let y=!1;"/"===e[s]&&(y=!0,s++);let b="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)b+=e[s];if(b=b.trim(),"/"===b[b.length-1]&&(b=b.substring(0,b.length-1),s--),l=b,!n.isName(l)){let t;return t=0===b.trim().length?"Invalid space after '<'.":"Tag '"+b+"' is an invalid name.",p("InvalidTag",t,m(e,s))}const w=u(e,s);if(!1===w)return p("InvalidAttr","Attributes for '"+b+"' have open quote.",m(e,s));let v=w.value;if(s=w.index,"/"===v[v.length-1]){const r=s-v.length;v=v.substring(0,v.length-1);const n=d(v,t);if(!0!==n)return p(n.err.code,n.err.msg,m(e,r+n.err.line));c=!0}else if(y){if(!w.tagClosed)return p("InvalidTag","Closing tag '"+b+"' doesn't have proper closing.",m(e,s));if(v.trim().length>0)return p("InvalidTag","Closing tag '"+b+"' can't have attributes or invalid starting.",m(e,g));{const t=r.pop();if(b!==t.tagName){let r=m(e,t.tagStartPos);return p("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+r.line+", col "+r.col+") instead of closing tag '"+b+"'.",m(e,g))}0==r.length&&(h=!0)}}else{const n=d(v,t);if(!0!==n)return p(n.err.code,n.err.msg,m(e,s-v.length+n.err.line));if(!0===h)return p("InvalidXml","Multiple possible root nodes found.",m(e,s));-1!==t.unpairedTags.indexOf(b)||r.push({tagName:b,tagStartPos:g}),c=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=a(e,s);continue}if("?"!==e[s+1])break;if(s=o(e,++s),s.err)return s}else if("&"===e[s]){const t=f(e,s);if(-1==t)return p("InvalidChar","char '&' is not expected.",m(e,s));s=t}else if(!0===h&&!i(e[s]))return p("InvalidXml","Extra text at the end",m(e,s));"<"===e[s]&&s--}}}var l;return c?1==r.length?p("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",m(e,r[0].tagStartPos)):!(r.length>0)||p("InvalidXml","Invalid '"+JSON.stringify(r.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):p("InvalidXml","Start tag expected.",1)};const c='"',h="'";function u(e,t){let r="",n="",s=!1;for(;t<e.length;t++){if(e[t]===c||e[t]===h)""===n?n=e[t]:n!==e[t]||(n="");else if(">"===e[t]&&""===n){s=!0;break}r+=e[t]}return""===n&&{value:r,index:t,tagClosed:s}}const l=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function d(e,t){const r=n.getAllMatches(e,l),s={};for(let e=0;e<r.length;e++){if(0===r[e][1].length)return p("InvalidAttr","Attribute '"+r[e][2]+"' has no space in starting.",y(r[e]));if(void 0!==r[e][3]&&void 0===r[e][4])return p("InvalidAttr","Attribute '"+r[e][2]+"' is without value.",y(r[e]));if(void 0===r[e][3]&&!t.allowBooleanAttributes)return p("InvalidAttr","boolean attribute '"+r[e][2]+"' is not allowed.",y(r[e]));const n=r[e][2];if(!g(n))return p("InvalidAttr","Attribute '"+n+"' is an invalid name.",y(r[e]));if(s.hasOwnProperty(n))return p("InvalidAttr","Attribute '"+n+"' is repeated.",y(r[e]));s[n]=1}return!0}function f(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let r=/\d/;for("x"===e[t]&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(r))break}return-1}(e,++t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(";"===e[t])break;return-1}return t}function p(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function g(e){return n.isName(e)}function m(e,t){const r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function y(e){return e.startIndex+e[1].length}},41192:function(e,t,r){"use strict";const n=r(82592),s={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(e){this.options=Object.assign({},s,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=o,this.options.format?(this.indentate=a,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(e,t,r){const n=this.j2x(e,r+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}function a(e){return this.options.indentBy.repeat(e)}function c(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}i.prototype.build=function(e){return this.options.preserveOrder?n(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},i.prototype.j2x=function(e,t){let r="",n="";for(let s in e)if(void 0===e[s]);else if(null===e[s])"?"===s[0]?n+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)n+=this.buildTextValNode(e[s],s,"",t);else if("object"!=typeof e[s]){const i=this.isAttribute(s);if(i)r+=this.buildAttrPairStr(i,""+e[s]);else if(s===this.options.textNodeName){let t=this.options.tagValueProcessor(s,""+e[s]);n+=this.replaceEntitiesValue(t)}else n+=this.buildTextValNode(e[s],s,"",t)}else if(Array.isArray(e[s])){const r=e[s].length;let i="";for(let o=0;o<r;o++){const r=e[s][o];void 0===r||(null===r?"?"===s[0]?n+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar:"object"==typeof r?this.options.oneListGroup?i+=this.j2x(r,t+1).val:i+=this.processTextOrObjNode(r,s,t):i+=this.buildTextValNode(r,s,"",t))}this.options.oneListGroup&&(i=this.buildObjectNode(i,s,"",t)),n+=i}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const t=Object.keys(e[s]),n=t.length;for(let i=0;i<n;i++)r+=this.buildAttrPairStr(t[i],""+e[s][t[i]])}else n+=this.processTextOrObjNode(e[s],s,t);return{attrStr:r,val:n}},i.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},i.prototype.buildObjectNode=function(e,t,r,n){if(""===e)return"?"===t[0]?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,i="";return"?"===t[0]&&(i="?",s=""),r&&-1===e.indexOf("<")?this.indentate(n)+"<"+t+r+i+">"+e+s:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===i.length?this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(n)+"<"+t+r+i+this.tagEndChar+e+this.indentate(n)+s}},i.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},i.prototype.buildTextValNode=function(e,t,r,n){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(n)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),""===s?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+s+"</"+t+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e},e.exports=i},82592:function(e){function t(e,o,a,c){let h="",u=!1;for(let l=0;l<e.length;l++){const d=e[l],f=r(d);let p="";if(p=0===a.length?f:`${a}.${f}`,f===o.textNodeName){let e=d[f];s(p,o)||(e=o.tagValueProcessor(f,e),e=i(e,o)),u&&(h+=c),h+=e,u=!1;continue}if(f===o.cdataPropName){u&&(h+=c),h+=`<![CDATA[${d[f][0][o.textNodeName]}]]>`,u=!1;continue}if(f===o.commentPropName){h+=c+`\x3c!--${d[f][0][o.textNodeName]}--\x3e`,u=!0;continue}if("?"===f[0]){const e=n(d[":@"],o),t="?xml"===f?"":c;let r=d[f][0][o.textNodeName];r=0!==r.length?" "+r:"",h+=t+`<${f}${r}${e}?>`,u=!0;continue}let g=c;""!==g&&(g+=o.indentBy);const m=c+`<${f}${n(d[":@"],o)}`,y=t(d[f],o,p,g);-1!==o.unpairedTags.indexOf(f)?o.suppressUnpairedNode?h+=m+">":h+=m+"/>":y&&0!==y.length||!o.suppressEmptyNode?y&&y.endsWith(">")?h+=m+`>${y}${c}</${f}>`:(h+=m+">",y&&""!==c&&(y.includes("/>")||y.includes("</"))?h+=c+o.indentBy+y+c:h+=y,h+=`</${f}>`):h+=m+"/>",u=!0}return h}function r(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function n(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){let s=t.attributeValueProcessor(n,e[n]);s=i(s,t),!0===s&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${s}"`}return r}function s(e,t){let r=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function i(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){const n=t.entities[r];e=e.replace(n.regex,n.val)}return e}e.exports=function(e,r){let n="";return r.format&&r.indentBy.length>0&&(n="\n"),t(e,r,"",n)}},74780:function(e,t,r){const n=r(17849);function s(e,t){let r="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)r+=e[t];if(r=r.trim(),-1!==r.indexOf(" "))throw new Error("External entites are not supported");const n=e[t++];let s="";for(;t<e.length&&e[t]!==n;t++)s+=e[t];return[r,s,t]}function i(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function o(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function a(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function c(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function h(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function u(e){if(n.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}e.exports=function(e,t){const r={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let n=1,l=!1,d=!1,f="";for(;t<e.length;t++)if("<"!==e[t]||d)if(">"===e[t]){if(d?"-"===e[t-1]&&"-"===e[t-2]&&(d=!1,n--):n--,0===n)break}else"["===e[t]?l=!0:f+=e[t];else{if(l&&o(e,t))t+=7,[entityName,val,t]=s(e,t+1),-1===val.indexOf("&")&&(r[u(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(l&&a(e,t))t+=8;else if(l&&c(e,t))t+=8;else if(l&&h(e,t))t+=9;else{if(!i)throw new Error("Invalid DOCTYPE");d=!0}n++,f=""}if(0!==n)throw new Error("Unclosed DOCTYPE")}return{entities:r,i:t}}},66745:function(e,t){const r={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}};t.buildOptions=function(e){return Object.assign({},r,e)},t.defaultOptions=r},81078:function(e,t,r){"use strict";const n=r(17849),s=r(36311),i=r(74780),o=r(14153);"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,n.nameRegexp);function a(e){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function c(e,t,r,n,s,i,o){if(void 0!==e&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const n=this.options.tagValueProcessor(t,e,r,s,i);if(null==n)return e;if(typeof n!=typeof e||n!==e)return n;if(this.options.trimValues)return v(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?v(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function h(e){if(this.options.removeNSPrefix){const t=e.split(":"),r="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=r+t[1])}return e}const u=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function l(e,t,r){if(!this.options.ignoreAttributes&&"string"==typeof e){const r=n.getAllMatches(e,u),s=r.length,i={};for(let e=0;e<s;e++){const n=this.resolveNameSpace(r[e][1]);let s=r[e][4],o=this.options.attributeNamePrefix+n;if(n.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),"__proto__"===o&&(o="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(n,s,t);i[o]=null==e?s:typeof e!=typeof s||e!==s?e:v(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[o]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const d=function(e){e=e.replace(/\r\n?/g,"\n");const t=new s("!xml");let r=t,n="",o="";for(let a=0;a<e.length;a++){if("<"===e[a])if("/"===e[a+1]){const t=y(e,">",a,"Closing Tag is not closed.");let s=e.substring(a+2,t).trim();if(this.options.removeNSPrefix){const e=s.indexOf(":");-1!==e&&(s=s.substr(e+1))}this.options.transformTagName&&(s=this.options.transformTagName(s)),r&&(n=this.saveTextToParentTag(n,r,o));const i=o.substring(o.lastIndexOf(".")+1);if(s&&-1!==this.options.unpairedTags.indexOf(s))throw new Error(`Unpaired tag can not be used as closing tag: </${s}>`);let c=0;i&&-1!==this.options.unpairedTags.indexOf(i)?(c=o.lastIndexOf(".",o.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=o.lastIndexOf("."),o=o.substring(0,c),r=this.tagsNodeStack.pop(),n="",a=t}else if("?"===e[a+1]){let t=b(e,a,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,o),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new s(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,o,t.tagName)),this.addChild(r,e,o)}a=t.closeIndex+1}else if("!--"===e.substr(a+1,3)){const t=y(e,"--\x3e",a+4,"Comment is not closed.");if(this.options.commentPropName){const s=e.substring(a+4,t-2);n=this.saveTextToParentTag(n,r,o),r.add(this.options.commentPropName,[{[this.options.textNodeName]:s}])}a=t}else if("!D"===e.substr(a+1,2)){const t=i(e,a);this.docTypeEntities=t.entities,a=t.i}else if("!["===e.substr(a+1,2)){const t=y(e,"]]>",a,"CDATA is not closed.")-2,s=e.substring(a+9,t);if(n=this.saveTextToParentTag(n,r,o),this.options.cdataPropName)r.add(this.options.cdataPropName,[{[this.options.textNodeName]:s}]);else{let e=this.parseTextData(s,r.tagname,o,!0,!1,!0);null==e&&(e=""),r.add(this.options.textNodeName,e)}a=t+2}else{let i=b(e,a,this.options.removeNSPrefix),c=i.tagName,h=i.tagExp,u=i.attrExpPresent,l=i.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),r&&n&&"!xml"!==r.tagname&&(n=this.saveTextToParentTag(n,r,o,!1));const d=r;if(d&&-1!==this.options.unpairedTags.indexOf(d.tagname)&&(r=this.tagsNodeStack.pop(),o=o.substring(0,o.lastIndexOf("."))),c!==t.tagname&&(o+=o?"."+c:c),this.isItStopNode(this.options.stopNodes,o,c)){let t="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)a=i.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(c))a=i.closeIndex;else{const r=this.readStopNodeData(e,c,l+1);if(!r)throw new Error(`Unexpected end of ${c}`);a=r.i,t=r.tagContent}const n=new s(c);c!==h&&u&&(n[":@"]=this.buildAttributesMap(h,o,c)),t&&(t=this.parseTextData(t,c,o,!0,u,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),n.add(this.options.textNodeName,t),this.addChild(r,n,o)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){"/"===c[c.length-1]?(c=c.substr(0,c.length-1),h=c):h=h.substr(0,h.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));const e=new s(c);c!==h&&u&&(e[":@"]=this.buildAttributesMap(h,o,c)),this.addChild(r,e,o),o=o.substr(0,o.lastIndexOf("."))}else{const e=new s(c);this.tagsNodeStack.push(r),c!==h&&u&&(e[":@"]=this.buildAttributesMap(h,o,c)),this.addChild(r,e,o),r=e}n="",a=l}}else n+=e[a]}return t.child};function f(e,t,r){const n=this.options.updateTag(t.tagname,r,t[":@"]);!1===n||("string"==typeof n?(t.tagname=n,e.addChild(t)):e.addChild(t))}const p=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){const r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function g(e,t,r,n){return e&&(void 0===n&&(n=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,r,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,n))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function m(e,t,r){const n="*."+r;for(const r in e){const s=e[r];if(n===s||t===s)return!0}return!1}function y(e,t,r,n){const s=e.indexOf(t,r);if(-1===s)throw new Error(n);return s+t.length-1}function b(e,t,r,n=">"){const s=function(e,t,r=">"){let n,s="";for(let i=t;i<e.length;i++){let t=e[i];if(n)t===n&&(n="");else if('"'===t||"'"===t)n=t;else if(t===r[0]){if(!r[1])return{data:s,index:i};if(e[i+1]===r[1])return{data:s,index:i}}else"\t"===t&&(t=" ");s+=t}}(e,t+1,n);if(!s)return;let i=s.data;const o=s.index,a=i.search(/\s/);let c=i,h=!0;if(-1!==a&&(c=i.substr(0,a).replace(/\s\s*$/,""),i=i.substr(a+1)),r){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),h=c!==s.data.substr(e+1))}return{tagName:c,tagExp:i,closeIndex:o,attrExpPresent:h}}function w(e,t,r){const n=r;let s=1;for(;r<e.length;r++)if("<"===e[r])if("/"===e[r+1]){const i=y(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(s--,0===s))return{tagContent:e.substring(n,r),i:i};r=i}else if("?"===e[r+1]){r=y(e,"?>",r+1,"StopNode is not closed.")}else if("!--"===e.substr(r+1,3)){r=y(e,"--\x3e",r+3,"StopNode is not closed.")}else if("!["===e.substr(r+1,2)){r=y(e,"]]>",r,"StopNode is not closed.")-2}else{const n=b(e,r,">");if(n){(n&&n.tagName)===t&&"/"!==n.tagExp[n.tagExp.length-1]&&s++,r=n.closeIndex}}}function v(e,t,r){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&o(e,r)}return n.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""}},this.addExternalEntities=a,this.parseXml=d,this.parseTextData=c,this.resolveNameSpace=h,this.buildAttributesMap=l,this.isItStopNode=m,this.replaceEntitiesValue=p,this.readStopNodeData=w,this.saveTextToParentTag=g,this.addChild=f}}},58844:function(e,t,r){const{buildOptions:n}=r(66745),s=r(81078),{prettify:i}=r(16997),o=r(78501);e.exports=class{constructor(e){this.externalEntities={},this.options=n(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const r=o.validate(e,t);if(!0!==r)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const r=new s(this.options);r.addExternalEntities(this.externalEntities);const n=r.parseXml(e);return this.options.preserveOrder||void 0===n?n:i(n,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},16997:function(e,t){"use strict";function r(e,t,o){let a;const c={};for(let h=0;h<e.length;h++){const u=e[h],l=n(u);let d="";if(d=void 0===o?l:o+"."+l,l===t.textNodeName)void 0===a?a=u[l]:a+=""+u[l];else{if(void 0===l)continue;if(u[l]){let e=r(u[l],t,d);const n=i(e,t);u[":@"]?s(e,u[":@"],d,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==c[l]&&c.hasOwnProperty(l)?(Array.isArray(c[l])||(c[l]=[c[l]]),c[l].push(e)):t.isArray(l,d,n)?c[l]=[e]:c[l]=e}}}return"string"==typeof a?a.length>0&&(c[t.textNodeName]=a):void 0!==a&&(c[t.textNodeName]=a),c}function n(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const r=t[e];if(":@"!==r)return r}}function s(e,t,r,n){if(t){const s=Object.keys(t),i=s.length;for(let o=0;o<i;o++){const i=s[o];n.isArray(i,r+"."+i,!0,!0)?e[i]=[t[i]]:e[i]=t[i]}}}function i(e,t){const{textNodeName:r}=t,n=Object.keys(e).length;return 0===n||!(1!==n||!e[r]&&"boolean"!=typeof e[r]&&0!==e[r])}t.prettify=function(e,t){return r(e,t)}},36311:function(e){"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},96132:function(e,t){"use strict";function r(e,t=r.BASE){const n=e.length;for(let r=0;r<n;r++)t^=e.charCodeAt(r),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}Object.defineProperty(t,"__esModule",{value:!0}),r.BASE=2166136261,t.default=r,e.exports=r},53458:function(e){e.exports="object"==typeof self?self.FormData:window.FormData},31230:function(e,t,r){"use strict";var n=r(70655),s=r(25202),i=r(25108),o=new Map,a=new Map,c=!0,h=!1;function u(e){return e.replace(/[\s,]+/g," ").trim()}function l(e){var t=new Set,r=[];return e.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var n=e.name.value,s=u((h=e.loc).source.body.substring(h.start,h.end)),o=a.get(n);o&&!o.has(s)?c&&i.warn("Warning: fragment with name "+n+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):o||a.set(n,o=new Set),o.add(s),t.has(s)||(t.add(s),r.push(e))}else r.push(e);var h})),(0,n.pi)((0,n.pi)({},e),{definitions:r})}function d(e){var t=u(e);if(!o.has(t)){var r=(0,s.Qc)(e,{experimentalFragmentVariables:h,allowLegacyFragmentVariables:h});if(!r||"Document"!==r.kind)throw new Error("Not a valid GraphQL document.");o.set(t,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(r){var n=e[r];n&&"object"==typeof n&&t.add(n)}))}));var r=e.loc;return r&&(delete r.startToken,delete r.endToken),e}(l(r)))}return o.get(t)}function f(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];"string"==typeof e&&(e=[e]);var n=e[0];return t.forEach((function(t,r){t&&"Document"===t.kind?n+=t.loc.source.body:n+=t,n+=e[r+1]})),d(n)}var p,g=f,m=function(){o.clear(),a.clear()},y=function(){c=!1},b=function(){h=!0},w=function(){h=!1};(p=f||(f={})).gql=g,p.resetCaches=m,p.disableFragmentWarnings=y,p.enableExperimentalFragmentVariables=b,p.disableExperimentalFragmentVariables=w,f.default=f,t.ZP=f},53767:function(e,t,r){"use strict";function n(e,t){if(!Boolean(e))throw new Error(t)}r.d(t,{a:function(){return n}})},6589:function(e,t,r){"use strict";r.d(t,{X:function(){return i}});const n=10,s=2;function i(e){return o(e,[])}function o(e,t){switch(typeof e){case"string":return JSON.stringify(e);case"function":return e.name?`[function ${e.name}]`:"[function]";case"object":return function(e,t){if(null===e)return"null";if(t.includes(e))return"[Circular]";const r=[...t,e];if(function(e){return"function"==typeof e.toJSON}(e)){const t=e.toJSON();if(t!==e)return"string"==typeof t?t:o(t,r)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>s)return"[Array]";const r=Math.min(n,e.length),i=e.length-r,a=[];for(let n=0;n<r;++n)a.push(o(e[n],t));1===i?a.push("... 1 more item"):i>1&&a.push(`... ${i} more items`);return"["+a.join(", ")+"]"}(e,r);return function(e,t){const r=Object.entries(e);if(0===r.length)return"{}";if(t.length>s)return"["+function(e){const t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){const t=e.constructor.name;if("string"==typeof t&&""!==t)return t}return t}(e)+"]";const n=r.map((([e,r])=>e+": "+o(r,t)));return"{ "+n.join(", ")+" }"}(e,r)}(e,t);default:return String(e)}}},39504:function(e,t,r){"use strict";r.d(t,{UG:function(){return a},WU:function(){return s},Ye:function(){return n},h8:function(){return i},ku:function(){return c}});class n{constructor(e,t,r){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=r}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class s{constructor(e,t,r,n,s,i){this.kind=e,this.start=t,this.end=r,this.line=n,this.column=s,this.value=i,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const i={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},o=new Set(Object.keys(i));function a(e){const t=null==e?void 0:e.kind;return"string"==typeof t&&o.has(t)}var c;!function(e){e.QUERY="query",e.MUTATION="mutation",e.SUBSCRIPTION="subscription"}(c||(c={}))},7420:function(e,t,r){"use strict";r.d(t,{LZ:function(){return o},wv:function(){return s}});var n=r(91022);function s(e){var t;let r=Number.MAX_SAFE_INTEGER,n=null,s=-1;for(let t=0;t<e.length;++t){var o;const a=e[t],c=i(a);c!==a.length&&(n=null!==(o=n)&&void 0!==o?o:t,s=t,0!==t&&c<r&&(r=c))}return e.map(((e,t)=>0===t?e:e.slice(r))).slice(null!==(t=n)&&void 0!==t?t:0,s+1)}function i(e){let t=0;for(;t<e.length&&(0,n.FD)(e.charCodeAt(t));)++t;return t}function o(e,t){const r=e.replace(/"""/g,'\\"""'),s=r.split(/\r\n|[\n\r]/g),i=1===s.length,o=s.length>1&&s.slice(1).every((e=>0===e.length||(0,n.FD)(e.charCodeAt(0)))),a=r.endsWith('\\"""'),c=e.endsWith('"')&&!a,h=e.endsWith("\\"),u=c||h,l=!(null!=t&&t.minimize)&&(!i||e.length>70||u||o||a);let d="";const f=i&&(0,n.FD)(e.charCodeAt(0));return(l&&!f||o)&&(d+="\n"),d+=r,(l||u)&&(d+="\n"),'"""'+d+'"""'}},91022:function(e,t,r){"use strict";function n(e){return 9===e||32===e}function s(e){return e>=48&&e<=57}function i(e){return e>=97&&e<=122||e>=65&&e<=90}function o(e){return i(e)||95===e}function a(e){return i(e)||s(e)||95===e}r.d(t,{FD:function(){return n},HQ:function(){return a},LQ:function(){return o},X1:function(){return s}})},6450:function(e,t,r){"use strict";var n;r.d(t,{h:function(){return n}}),function(e){e.NAME="Name",e.DOCUMENT="Document",e.OPERATION_DEFINITION="OperationDefinition",e.VARIABLE_DEFINITION="VariableDefinition",e.SELECTION_SET="SelectionSet",e.FIELD="Field",e.ARGUMENT="Argument",e.FRAGMENT_SPREAD="FragmentSpread",e.INLINE_FRAGMENT="InlineFragment",e.FRAGMENT_DEFINITION="FragmentDefinition",e.VARIABLE="Variable",e.INT="IntValue",e.FLOAT="FloatValue",e.STRING="StringValue",e.BOOLEAN="BooleanValue",e.NULL="NullValue",e.ENUM="EnumValue",e.LIST="ListValue",e.OBJECT="ObjectValue",e.OBJECT_FIELD="ObjectField",e.DIRECTIVE="Directive",e.NAMED_TYPE="NamedType",e.LIST_TYPE="ListType",e.NON_NULL_TYPE="NonNullType",e.SCHEMA_DEFINITION="SchemaDefinition",e.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",e.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",e.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",e.FIELD_DEFINITION="FieldDefinition",e.INPUT_VALUE_DEFINITION="InputValueDefinition",e.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",e.UNION_TYPE_DEFINITION="UnionTypeDefinition",e.ENUM_TYPE_DEFINITION="EnumTypeDefinition",e.ENUM_VALUE_DEFINITION="EnumValueDefinition",e.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",e.DIRECTIVE_DEFINITION="DirectiveDefinition",e.SCHEMA_EXTENSION="SchemaExtension",e.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",e.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",e.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",e.UNION_TYPE_EXTENSION="UnionTypeExtension",e.ENUM_TYPE_EXTENSION="EnumTypeExtension",e.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"}(n||(n={}))},25202:function(e,t,r){"use strict";function n(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}r.d(t,{Qc:function(){return j}});const s=/\r\n|[\n\r]/g;function i(e,t){let r=0,i=1;for(const o of e.body.matchAll(s)){if("number"==typeof o.index||n(!1),o.index>=t)break;r=o.index+o[0].length,i+=1}return{line:i,column:t+1-r}}function o(e){return a(e.source,i(e.source,e.start))}function a(e,t){const r=e.locationOffset.column-1,n="".padStart(r)+e.body,s=t.line-1,i=e.locationOffset.line-1,o=t.line+i,a=1===t.line?r:0,h=t.column+a,u=`${e.name}:${o}:${h}\n`,l=n.split(/\r\n|[\n\r]/g),d=l[s];if(d.length>120){const e=Math.floor(h/80),t=h%80,r=[];for(let e=0;e<d.length;e+=80)r.push(d.slice(e,e+80));return u+c([[`${o} |`,r[0]],...r.slice(1,e+1).map((e=>["|",e])),["|","^".padStart(t)],["|",r[e+1]]])}return u+c([[o-1+" |",l[s-1]],[`${o} |`,d],["|","^".padStart(h)],[`${o+1} |`,l[s+1]]])}function c(e){const t=e.filter((([e,t])=>void 0!==t)),r=Math.max(...t.map((([e])=>e.length)));return t.map((([e,t])=>e.padStart(r)+(t?" "+t:""))).join("\n")}class h extends Error{constructor(e,...t){var r,n,s;const{nodes:o,source:a,positions:c,path:l,originalError:d,extensions:f}=function(e){const t=e[0];return null==t||"kind"in t||"length"in t?{nodes:t,source:e[1],positions:e[2],path:e[3],originalError:e[4],extensions:e[5]}:t}(t);super(e),this.name="GraphQLError",this.path=null!=l?l:void 0,this.originalError=null!=d?d:void 0,this.nodes=u(Array.isArray(o)?o:o?[o]:void 0);const p=u(null===(r=this.nodes)||void 0===r?void 0:r.map((e=>e.loc)).filter((e=>null!=e)));this.source=null!=a?a:null==p||null===(n=p[0])||void 0===n?void 0:n.source,this.positions=null!=c?c:null==p?void 0:p.map((e=>e.start)),this.locations=c&&a?c.map((e=>i(a,e))):null==p?void 0:p.map((e=>i(e.source,e.start)));const g="object"==typeof(m=null==d?void 0:d.extensions)&&null!==m?null==d?void 0:d.extensions:void 0;var m;this.extensions=null!==(s=null!=f?f:g)&&void 0!==s?s:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),null!=d&&d.stack?Object.defineProperty(this,"stack",{value:d.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,h):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const t of this.nodes)t.loc&&(e+="\n\n"+o(t.loc));else if(this.source&&this.locations)for(const t of this.locations)e+="\n\n"+a(this.source,t);return e}toJSON(){const e={message:this.message};return null!=this.locations&&(e.locations=this.locations),null!=this.path&&(e.path=this.path),null!=this.extensions&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function u(e){return void 0===e||0===e.length?void 0:e}function l(e,t,r){return new h(`Syntax Error: ${r}`,{source:e,positions:[t]})}var d,f=r(39504);!function(e){e.QUERY="QUERY",e.MUTATION="MUTATION",e.SUBSCRIPTION="SUBSCRIPTION",e.FIELD="FIELD",e.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",e.FRAGMENT_SPREAD="FRAGMENT_SPREAD",e.INLINE_FRAGMENT="INLINE_FRAGMENT",e.VARIABLE_DEFINITION="VARIABLE_DEFINITION",e.SCHEMA="SCHEMA",e.SCALAR="SCALAR",e.OBJECT="OBJECT",e.FIELD_DEFINITION="FIELD_DEFINITION",e.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",e.INTERFACE="INTERFACE",e.UNION="UNION",e.ENUM="ENUM",e.ENUM_VALUE="ENUM_VALUE",e.INPUT_OBJECT="INPUT_OBJECT",e.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"}(d||(d={}));var p,g=r(6450),m=r(7420),y=r(91022);!function(e){e.SOF="<SOF>",e.EOF="<EOF>",e.BANG="!",e.DOLLAR="$",e.AMP="&",e.PAREN_L="(",e.PAREN_R=")",e.SPREAD="...",e.COLON=":",e.EQUALS="=",e.AT="@",e.BRACKET_L="[",e.BRACKET_R="]",e.BRACE_L="{",e.PIPE="|",e.BRACE_R="}",e.NAME="Name",e.INT="Int",e.FLOAT="Float",e.STRING="String",e.BLOCK_STRING="BlockString",e.COMMENT="Comment"}(p||(p={}));class b{constructor(e){const t=new f.WU(p.SOF,0,0,0,0);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){this.lastToken=this.token;return this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==p.EOF)do{if(e.next)e=e.next;else{const t=x(this,e.end);e.next=t,t.prev=e,e=t}}while(e.kind===p.COMMENT);return e}}function w(e){return e>=0&&e<=55295||e>=57344&&e<=1114111}function v(e,t){return _(e.charCodeAt(t))&&E(e.charCodeAt(t+1))}function _(e){return e>=55296&&e<=56319}function E(e){return e>=56320&&e<=57343}function k(e,t){const r=e.source.body.codePointAt(t);if(void 0===r)return p.EOF;if(r>=32&&r<=126){const e=String.fromCodePoint(r);return'"'===e?"'\"'":`"${e}"`}return"U+"+r.toString(16).toUpperCase().padStart(4,"0")}function S(e,t,r,n,s){const i=e.line,o=1+r-e.lineStart;return new f.WU(t,r,n,i,o,s)}function x(e,t){const r=e.source.body,n=r.length;let s=t;for(;s<n;){const t=r.charCodeAt(s);switch(t){case 65279:case 9:case 32:case 44:++s;continue;case 10:++s,++e.line,e.lineStart=s;continue;case 13:10===r.charCodeAt(s+1)?s+=2:++s,++e.line,e.lineStart=s;continue;case 35:return I(e,s);case 33:return S(e,p.BANG,s,s+1);case 36:return S(e,p.DOLLAR,s,s+1);case 38:return S(e,p.AMP,s,s+1);case 40:return S(e,p.PAREN_L,s,s+1);case 41:return S(e,p.PAREN_R,s,s+1);case 46:if(46===r.charCodeAt(s+1)&&46===r.charCodeAt(s+2))return S(e,p.SPREAD,s,s+3);break;case 58:return S(e,p.COLON,s,s+1);case 61:return S(e,p.EQUALS,s,s+1);case 64:return S(e,p.AT,s,s+1);case 91:return S(e,p.BRACKET_L,s,s+1);case 93:return S(e,p.BRACKET_R,s,s+1);case 123:return S(e,p.BRACE_L,s,s+1);case 124:return S(e,p.PIPE,s,s+1);case 125:return S(e,p.BRACE_R,s,s+1);case 34:return 34===r.charCodeAt(s+1)&&34===r.charCodeAt(s+2)?N(e,s):D(e,s)}if((0,y.X1)(t)||45===t)return T(e,s,t);if((0,y.LQ)(t))return B(e,s);throw l(e.source,s,39===t?"Unexpected single quote character ('), did you mean to use a double quote (\")?":w(t)||v(r,s)?`Unexpected character: ${k(e,s)}.`:`Invalid character: ${k(e,s)}.`)}return S(e,p.EOF,n,n)}function I(e,t){const r=e.source.body,n=r.length;let s=t+1;for(;s<n;){const e=r.charCodeAt(s);if(10===e||13===e)break;if(w(e))++s;else{if(!v(r,s))break;s+=2}}return S(e,p.COMMENT,t,s,r.slice(t+1,s))}function T(e,t,r){const n=e.source.body;let s=t,i=r,o=!1;if(45===i&&(i=n.charCodeAt(++s)),48===i){if(i=n.charCodeAt(++s),(0,y.X1)(i))throw l(e.source,s,`Invalid number, unexpected digit after 0: ${k(e,s)}.`)}else s=A(e,s,i),i=n.charCodeAt(s);if(46===i&&(o=!0,i=n.charCodeAt(++s),s=A(e,s,i),i=n.charCodeAt(s)),69!==i&&101!==i||(o=!0,i=n.charCodeAt(++s),43!==i&&45!==i||(i=n.charCodeAt(++s)),s=A(e,s,i),i=n.charCodeAt(s)),46===i||(0,y.LQ)(i))throw l(e.source,s,`Invalid number, expected digit but got: ${k(e,s)}.`);return S(e,o?p.FLOAT:p.INT,t,s,n.slice(t,s))}function A(e,t,r){if(!(0,y.X1)(r))throw l(e.source,t,`Invalid number, expected digit but got: ${k(e,t)}.`);const n=e.source.body;let s=t+1;for(;(0,y.X1)(n.charCodeAt(s));)++s;return s}function D(e,t){const r=e.source.body,n=r.length;let s=t+1,i=s,o="";for(;s<n;){const n=r.charCodeAt(s);if(34===n)return o+=r.slice(i,s),S(e,p.STRING,t,s+1,o);if(92!==n){if(10===n||13===n)break;if(w(n))++s;else{if(!v(r,s))throw l(e.source,s,`Invalid character within String: ${k(e,s)}.`);s+=2}}else{o+=r.slice(i,s);const t=117===r.charCodeAt(s+1)?123===r.charCodeAt(s+2)?P(e,s):C(e,s):O(e,s);o+=t.value,s+=t.size,i=s}}throw l(e.source,s,"Unterminated string.")}function P(e,t){const r=e.source.body;let n=0,s=3;for(;s<12;){const e=r.charCodeAt(t+s++);if(125===e){if(s<5||!w(n))break;return{value:String.fromCodePoint(n),size:s}}if(n=n<<4|R(e),n<0)break}throw l(e.source,t,`Invalid Unicode escape sequence: "${r.slice(t,t+s)}".`)}function C(e,t){const r=e.source.body,n=M(r,t+2);if(w(n))return{value:String.fromCodePoint(n),size:6};if(_(n)&&92===r.charCodeAt(t+6)&&117===r.charCodeAt(t+7)){const e=M(r,t+8);if(E(e))return{value:String.fromCodePoint(n,e),size:12}}throw l(e.source,t,`Invalid Unicode escape sequence: "${r.slice(t,t+6)}".`)}function M(e,t){return R(e.charCodeAt(t))<<12|R(e.charCodeAt(t+1))<<8|R(e.charCodeAt(t+2))<<4|R(e.charCodeAt(t+3))}function R(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function O(e,t){const r=e.source.body;switch(r.charCodeAt(t+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:"\n",size:2};case 114:return{value:"\r",size:2};case 116:return{value:"\t",size:2}}throw l(e.source,t,`Invalid character escape sequence: "${r.slice(t,t+2)}".`)}function N(e,t){const r=e.source.body,n=r.length;let s=e.lineStart,i=t+3,o=i,a="";const c=[];for(;i<n;){const n=r.charCodeAt(i);if(34===n&&34===r.charCodeAt(i+1)&&34===r.charCodeAt(i+2)){a+=r.slice(o,i),c.push(a);const n=S(e,p.BLOCK_STRING,t,i+3,(0,m.wv)(c).join("\n"));return e.line+=c.length-1,e.lineStart=s,n}if(92!==n||34!==r.charCodeAt(i+1)||34!==r.charCodeAt(i+2)||34!==r.charCodeAt(i+3))if(10!==n&&13!==n)if(w(n))++i;else{if(!v(r,i))throw l(e.source,i,`Invalid character within String: ${k(e,i)}.`);i+=2}else a+=r.slice(o,i),c.push(a),13===n&&10===r.charCodeAt(i+1)?i+=2:++i,a="",o=i,s=i;else a+=r.slice(o,i),o=i+1,i+=4}throw l(e.source,i,"Unterminated string.")}function B(e,t){const r=e.source.body,n=r.length;let s=t+1;for(;s<n;){const e=r.charCodeAt(s);if(!(0,y.HQ)(e))break;++s}return S(e,p.NAME,t,s,r.slice(t,s))}var L=r(53767),z=r(6589);const U=globalThis.process&&"production"===globalThis.process.env.NODE_ENV?function(e,t){return e instanceof t}:function(e,t){if(e instanceof t)return!0;if("object"==typeof e&&null!==e){var r;const n=t.prototype[Symbol.toStringTag];if(n===(Symbol.toStringTag in e?e[Symbol.toStringTag]:null===(r=e.constructor)||void 0===r?void 0:r.name)){const t=(0,z.X)(e);throw new Error(`Cannot use ${n} "${t}" from another module or realm.\n\nEnsure that there is only one instance of "graphql" in the node_modules\ndirectory. If different versions of "graphql" are the dependencies of other\nrelied on modules, use "resolutions" to ensure only one version is installed.\n\nhttps://yarnpkg.com/en/docs/selective-version-resolutions\n\nDuplicate "graphql" modules cannot be used at the same time since different\nversions may have different capabilities and behavior. The data from one\nversion used in the function from another could produce confusing and\nspurious results.`)}}return!1};class F{constructor(e,t="GraphQL request",r={line:1,column:1}){"string"==typeof e||(0,L.a)(!1,`Body must be a string. Received: ${(0,z.X)(e)}.`),this.body=e,this.name=t,this.locationOffset=r,this.locationOffset.line>0||(0,L.a)(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||(0,L.a)(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function j(e,t){return new V(e,t).parseDocument()}class V{constructor(e,t={}){const r=function(e){return U(e,F)}(e)?e:new F(e);this._lexer=new b(r),this._options=t,this._tokenCounter=0}parseName(){const e=this.expectToken(p.NAME);return this.node(e,{kind:g.h.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:g.h.DOCUMENT,definitions:this.many(p.SOF,this.parseDefinition,p.EOF)})}parseDefinition(){if(this.peek(p.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),t=e?this._lexer.lookahead():this._lexer.token;if(t.kind===p.NAME){switch(t.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw l(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(t.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(t)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(p.BRACE_L))return this.node(e,{kind:g.h.OPERATION_DEFINITION,operation:f.ku.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const t=this.parseOperationType();let r;return this.peek(p.NAME)&&(r=this.parseName()),this.node(e,{kind:g.h.OPERATION_DEFINITION,operation:t,name:r,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(p.NAME);switch(e.value){case"query":return f.ku.QUERY;case"mutation":return f.ku.MUTATION;case"subscription":return f.ku.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(p.PAREN_L,this.parseVariableDefinition,p.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:g.h.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(p.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(p.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(p.DOLLAR),this.node(e,{kind:g.h.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:g.h.SELECTION_SET,selections:this.many(p.BRACE_L,this.parseSelection,p.BRACE_R)})}parseSelection(){return this.peek(p.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,t=this.parseName();let r,n;return this.expectOptionalToken(p.COLON)?(r=t,n=this.parseName()):n=t,this.node(e,{kind:g.h.FIELD,alias:r,name:n,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(p.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(p.PAREN_L,t,p.PAREN_R)}parseArgument(e=!1){const t=this._lexer.token,r=this.parseName();return this.expectToken(p.COLON),this.node(t,{kind:g.h.ARGUMENT,name:r,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(p.SPREAD);const t=this.expectOptionalKeyword("on");return!t&&this.peek(p.NAME)?this.node(e,{kind:g.h.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:g.h.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),!0===this._options.allowLegacyFragmentVariables?this.node(e,{kind:g.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:g.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()}parseValueLiteral(e){const t=this._lexer.token;switch(t.kind){case p.BRACKET_L:return this.parseList(e);case p.BRACE_L:return this.parseObject(e);case p.INT:return this.advanceLexer(),this.node(t,{kind:g.h.INT,value:t.value});case p.FLOAT:return this.advanceLexer(),this.node(t,{kind:g.h.FLOAT,value:t.value});case p.STRING:case p.BLOCK_STRING:return this.parseStringLiteral();case p.NAME:switch(this.advanceLexer(),t.value){case"true":return this.node(t,{kind:g.h.BOOLEAN,value:!0});case"false":return this.node(t,{kind:g.h.BOOLEAN,value:!1});case"null":return this.node(t,{kind:g.h.NULL});default:return this.node(t,{kind:g.h.ENUM,value:t.value})}case p.DOLLAR:if(e){if(this.expectToken(p.DOLLAR),this._lexer.token.kind===p.NAME){const e=this._lexer.token.value;throw l(this._lexer.source,t.start,`Unexpected variable "$${e}" in constant value.`)}throw this.unexpected(t)}return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:g.h.STRING,value:e.value,block:e.kind===p.BLOCK_STRING})}parseList(e){return this.node(this._lexer.token,{kind:g.h.LIST,values:this.any(p.BRACKET_L,(()=>this.parseValueLiteral(e)),p.BRACKET_R)})}parseObject(e){return this.node(this._lexer.token,{kind:g.h.OBJECT,fields:this.any(p.BRACE_L,(()=>this.parseObjectField(e)),p.BRACE_R)})}parseObjectField(e){const t=this._lexer.token,r=this.parseName();return this.expectToken(p.COLON),this.node(t,{kind:g.h.OBJECT_FIELD,name:r,value:this.parseValueLiteral(e)})}parseDirectives(e){const t=[];for(;this.peek(p.AT);)t.push(this.parseDirective(e));return t}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const t=this._lexer.token;return this.expectToken(p.AT),this.node(t,{kind:g.h.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let t;if(this.expectOptionalToken(p.BRACKET_L)){const r=this.parseTypeReference();this.expectToken(p.BRACKET_R),t=this.node(e,{kind:g.h.LIST_TYPE,type:r})}else t=this.parseNamedType();return this.expectOptionalToken(p.BANG)?this.node(e,{kind:g.h.NON_NULL_TYPE,type:t}):t}parseNamedType(){return this.node(this._lexer.token,{kind:g.h.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(p.STRING)||this.peek(p.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");const r=this.parseConstDirectives(),n=this.many(p.BRACE_L,this.parseOperationTypeDefinition,p.BRACE_R);return this.node(e,{kind:g.h.SCHEMA_DEFINITION,description:t,directives:r,operationTypes:n})}parseOperationTypeDefinition(){const e=this._lexer.token,t=this.parseOperationType();this.expectToken(p.COLON);const r=this.parseNamedType();return this.node(e,{kind:g.h.OPERATION_TYPE_DEFINITION,operation:t,type:r})}parseScalarTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");const r=this.parseName(),n=this.parseConstDirectives();return this.node(e,{kind:g.h.SCALAR_TYPE_DEFINITION,description:t,name:r,directives:n})}parseObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");const r=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),i=this.parseFieldsDefinition();return this.node(e,{kind:g.h.OBJECT_TYPE_DEFINITION,description:t,name:r,interfaces:n,directives:s,fields:i})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(p.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(p.BRACE_L,this.parseFieldDefinition,p.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,t=this.parseDescription(),r=this.parseName(),n=this.parseArgumentDefs();this.expectToken(p.COLON);const s=this.parseTypeReference(),i=this.parseConstDirectives();return this.node(e,{kind:g.h.FIELD_DEFINITION,description:t,name:r,arguments:n,type:s,directives:i})}parseArgumentDefs(){return this.optionalMany(p.PAREN_L,this.parseInputValueDef,p.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,t=this.parseDescription(),r=this.parseName();this.expectToken(p.COLON);const n=this.parseTypeReference();let s;this.expectOptionalToken(p.EQUALS)&&(s=this.parseConstValueLiteral());const i=this.parseConstDirectives();return this.node(e,{kind:g.h.INPUT_VALUE_DEFINITION,description:t,name:r,type:n,defaultValue:s,directives:i})}parseInterfaceTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");const r=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),i=this.parseFieldsDefinition();return this.node(e,{kind:g.h.INTERFACE_TYPE_DEFINITION,description:t,name:r,interfaces:n,directives:s,fields:i})}parseUnionTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");const r=this.parseName(),n=this.parseConstDirectives(),s=this.parseUnionMemberTypes();return this.node(e,{kind:g.h.UNION_TYPE_DEFINITION,description:t,name:r,directives:n,types:s})}parseUnionMemberTypes(){return this.expectOptionalToken(p.EQUALS)?this.delimitedMany(p.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");const r=this.parseName(),n=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();return this.node(e,{kind:g.h.ENUM_TYPE_DEFINITION,description:t,name:r,directives:n,values:s})}parseEnumValuesDefinition(){return this.optionalMany(p.BRACE_L,this.parseEnumValueDefinition,p.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,t=this.parseDescription(),r=this.parseEnumValueName(),n=this.parseConstDirectives();return this.node(e,{kind:g.h.ENUM_VALUE_DEFINITION,description:t,name:r,directives:n})}parseEnumValueName(){if("true"===this._lexer.token.value||"false"===this._lexer.token.value||"null"===this._lexer.token.value)throw l(this._lexer.source,this._lexer.token.start,`${W(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");const r=this.parseName(),n=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();return this.node(e,{kind:g.h.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:r,directives:n,fields:s})}parseInputFieldsDefinition(){return this.optionalMany(p.BRACE_L,this.parseInputValueDef,p.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===p.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const t=this.parseConstDirectives(),r=this.optionalMany(p.BRACE_L,this.parseOperationTypeDefinition,p.BRACE_R);if(0===t.length&&0===r.length)throw this.unexpected();return this.node(e,{kind:g.h.SCHEMA_EXTENSION,directives:t,operationTypes:r})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const t=this.parseName(),r=this.parseConstDirectives();if(0===r.length)throw this.unexpected();return this.node(e,{kind:g.h.SCALAR_TYPE_EXTENSION,name:t,directives:r})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const t=this.parseName(),r=this.parseImplementsInterfaces(),n=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(0===r.length&&0===n.length&&0===s.length)throw this.unexpected();return this.node(e,{kind:g.h.OBJECT_TYPE_EXTENSION,name:t,interfaces:r,directives:n,fields:s})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const t=this.parseName(),r=this.parseImplementsInterfaces(),n=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(0===r.length&&0===n.length&&0===s.length)throw this.unexpected();return this.node(e,{kind:g.h.INTERFACE_TYPE_EXTENSION,name:t,interfaces:r,directives:n,fields:s})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const t=this.parseName(),r=this.parseConstDirectives(),n=this.parseUnionMemberTypes();if(0===r.length&&0===n.length)throw this.unexpected();return this.node(e,{kind:g.h.UNION_TYPE_EXTENSION,name:t,directives:r,types:n})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const t=this.parseName(),r=this.parseConstDirectives(),n=this.parseEnumValuesDefinition();if(0===r.length&&0===n.length)throw this.unexpected();return this.node(e,{kind:g.h.ENUM_TYPE_EXTENSION,name:t,directives:r,values:n})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const t=this.parseName(),r=this.parseConstDirectives(),n=this.parseInputFieldsDefinition();if(0===r.length&&0===n.length)throw this.unexpected();return this.node(e,{kind:g.h.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:r,fields:n})}parseDirectiveDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(p.AT);const r=this.parseName(),n=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const i=this.parseDirectiveLocations();return this.node(e,{kind:g.h.DIRECTIVE_DEFINITION,description:t,name:r,arguments:n,repeatable:s,locations:i})}parseDirectiveLocations(){return this.delimitedMany(p.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,t=this.parseName();if(Object.prototype.hasOwnProperty.call(d,t.value))return t;throw this.unexpected(e)}node(e,t){return!0!==this._options.noLocation&&(t.loc=new f.Ye(e,this._lexer.lastToken,this._lexer.source)),t}peek(e){return this._lexer.token.kind===e}expectToken(e){const t=this._lexer.token;if(t.kind===e)return this.advanceLexer(),t;throw l(this._lexer.source,t.start,`Expected ${$(e)}, found ${W(t)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e&&(this.advanceLexer(),!0)}expectKeyword(e){const t=this._lexer.token;if(t.kind!==p.NAME||t.value!==e)throw l(this._lexer.source,t.start,`Expected "${e}", found ${W(t)}.`);this.advanceLexer()}expectOptionalKeyword(e){const t=this._lexer.token;return t.kind===p.NAME&&t.value===e&&(this.advanceLexer(),!0)}unexpected(e){const t=null!=e?e:this._lexer.token;return l(this._lexer.source,t.start,`Unexpected ${W(t)}.`)}any(e,t,r){this.expectToken(e);const n=[];for(;!this.expectOptionalToken(r);)n.push(t.call(this));return n}optionalMany(e,t,r){if(this.expectOptionalToken(e)){const e=[];do{e.push(t.call(this))}while(!this.expectOptionalToken(r));return e}return[]}many(e,t,r){this.expectToken(e);const n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(r));return n}delimitedMany(e,t){this.expectOptionalToken(e);const r=[];do{r.push(t.call(this))}while(this.expectOptionalToken(e));return r}advanceLexer(){const{maxTokens:e}=this._options,t=this._lexer.advance();if(void 0!==e&&t.kind!==p.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw l(this._lexer.source,t.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function W(e){const t=e.value;return $(e.kind)+(null!=t?` "${t}"`:"")}function $(e){return function(e){return e===p.BANG||e===p.DOLLAR||e===p.AMP||e===p.PAREN_L||e===p.PAREN_R||e===p.SPREAD||e===p.COLON||e===p.EQUALS||e===p.AT||e===p.BRACKET_L||e===p.BRACKET_R||e===p.BRACE_L||e===p.PIPE||e===p.BRACE_R}(e)?`"${e}"`:e}},70248:function(e){e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function s(s,i){r[s]=i,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(s(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:s(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}}},85923:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,i||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,s=[];if(0===this._eventsCount)return s;for(n in e=this._events)t.call(e,n)&&s.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,o=new Array(i);s<i;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,s,i,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,h,u=this._events[a],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,i),!0;case 6:return u.fn.call(u.context,t,n,s,i,o),!0}for(h=1,c=new Array(l-1);h<l;h++)c[h-1]=arguments[h];u.fn.apply(u.context,c)}else{var d,f=u.length;for(h=0;h<f;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),l){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,t);break;case 3:u[h].fn.call(u[h].context,t,n);break;case 4:u[h].fn.call(u[h].context,t,n,s);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u[h].fn.apply(u[h].context,c)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,s){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||s&&!a.once||n&&a.context!==n||o(this,i);else{for(var c=0,h=[],u=a.length;c<u;c++)(a[c].fn!==t||s&&!a[c].once||n&&a[c].context!==n)&&h.push(a[c]);h.length?this._events[i]=1===h.length?h[0]:h:o(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},28050:function(e,t,r){const n=r(62800),s=r(8786),i=r(97391),o=r(51385),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:h}=r(8746),u=r(69559),l=r(12566),d=r(52034),f=r(20143),p=r(36596),g=r(42527),m=r(72621);e.exports={RateLimiterRedis:n,RateLimiterMongo:s,RateLimiterMySQL:i,RateLimiterPostgres:o,RateLimiterMemory:u,RateLimiterMemcache:l,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:h,RLWrapperBlackAndWhite:d,RateLimiterUnion:f,RateLimiterQueue:p,BurstyRateLimiter:g,RateLimiterRes:m}},80645:function(e,t){t.read=function(e,t,r,n,s){var i,o,a=8*s-n-1,c=(1<<a)-1,h=c>>1,u=-7,l=r?s-1:0,d=r?-1:1,f=e[t+l];for(l+=d,i=f&(1<<-u)-1,f>>=-u,u+=a;u>0;i=256*i+e[t+l],l+=d,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=n;u>0;o=256*o+e[t+l],l+=d,u-=8);if(0===i)i=1-h;else{if(i===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),i-=h}return(f?-1:1)*o*Math.pow(2,i-n)},t.write=function(e,t,r,n,s,i){var o,a,c,h=8*i-s-1,u=(1<<h)-1,l=u>>1,d=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+l>=1?d/c:d*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=u?(a=0,o=u):o+l>=1?(a=(t*c-1)*Math.pow(2,s),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,s),o=0));s>=8;e[r+f]=255&a,f+=p,a/=256,s-=8);for(o=o<<s|a,h+=s;h>0;e[r+f]=255&o,f+=p,o/=256,h-=8);e[r+f-p]|=128*g}},59594:function(e){"use strict";function t(e,t){t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var r=this.size();if(!(t>=r||t<-r))return t<0&&(t+=r),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(void 0===e)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(void 0===e)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),r}},t.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var r=this.size(),n=this._list.length;if(!(t>=r||t<-r)){t<0&&(t+=r),t=this._head+t&this._capacityMask;var s,i=this._list[t];if(e<r/2){for(s=e;s>0;s--)this._list[t]=this._list[t=t-1+n&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+n&this._capacityMask}else{for(s=r-1-e;s>0;s--)this._list[t]=this._list[t=t+1+n&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+n&this._capacityMask}return i}}},t.prototype.remove=function(e,t){var r,n=e,s=t;if(n===(0|n)&&this._head!==this._tail){var i=this.size(),o=this._list.length;if(!(n>=i||n<-i||t<1)){if(n<0&&(n+=i),1===t||!t)return(r=new Array(1))[0]=this.removeOne(n),r;if(0===n&&n+t>=i)return r=this.toArray(),this.clear(),r;var a;for(n+t>i&&(t=i-n),r=new Array(t),a=0;a<t;a++)r[a]=this._list[this._head+n+a&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===i){for(this._tail=this._tail-t+o&this._capacityMask,a=t;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(0===e){for(this._head=this._head+t+o&this._capacityMask,a=t-1;a>0;a--)this._list[n=n+1+o&this._capacityMask]=void 0;return r}if(n<i/2){for(this._head=this._head+e+t+o&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[n=n-1+o&this._capacityMask]);for(n=this._head-1+o&this._capacityMask;s>0;)this._list[n=n-1+o&this._capacityMask]=void 0,s--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+o&this._capacityMask,a=i-(t+e);a>0;a--)this.push(this._list[n++]);for(n=this._tail;s>0;)this._list[n=n+1+o&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),r}}},t.prototype.splice=function(e,t){var r=e;if(r===(0|r)){var n=this.size();if(r<0&&(r+=n),!(r>n)){if(arguments.length>2){var s,i,o,a=arguments.length,c=this._list.length,h=2;if(!n||r<n/2){for(i=new Array(r),s=0;s<r;s++)i[s]=this._list[this._head+s&this._capacityMask];for(0===t?(o=[],r>0&&(this._head=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._head=this._head+r+c&this._capacityMask);a>h;)this.unshift(arguments[--a]);for(s=r;s>0;s--)this.unshift(i[s-1])}else{var u=(i=new Array(n-(r+t))).length;for(s=0;s<u;s++)i[s]=this._list[this._head+r+t+s&this._capacityMask];for(0===t?(o=[],r!=n&&(this._tail=this._head+r+c&this._capacityMask)):(o=this.remove(r,t),this._tail=this._tail-u+c&this._capacityMask);h<a;)this.push(arguments[h++]);for(s=0;s<u;s++)this.push(i[s])}return o}return this.remove(r,t)}}},t.prototype.clear=function(){this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])},t.prototype._copyArray=function(e){var t,r=[],n=this._list,s=n.length;if(e||this._head>this._tail){for(t=this._head;t<s;t++)r.push(n[t]);for(t=0;t<this._tail;t++)r.push(n[t])}else for(t=this._head;t<this._tail;t++)r.push(n[t]);return r},t.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},e.exports=t},61641:function(e,t,r){"use strict";e.exports=r(24114)},24114:function(e,t,r){"use strict";var n=t;function s(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(5772),n.BufferWriter=r(31994),n.Reader=r(4334),n.BufferReader=r(42395),n.util=r(29790),n.rpc=r(30893),n.roots=r(55332),n.configure=s,s()},4334:function(e,t,r){"use strict";e.exports=c;var n,s=r(29790),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var h,u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},l=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function d(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function f(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}c.create=l(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(h=4294967295,function(){if(h=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return h;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return h}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return f(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|f(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=l(),n._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},42395:function(e,t,r){"use strict";e.exports=i;var n=r(4334);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(29790);function i(e){n.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},55332:function(e){"use strict";e.exports={}},30893:function(e,t,r){"use strict";t.Service=r(971)},971:function(e,t,r){"use strict";e.exports=s;var n=r(29790);function s(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(s.prototype=Object.create(n.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,r,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,r,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof s))try{r=s[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},98441:function(e,t,r){"use strict";e.exports=s;var n=r(29790);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new s(r,n)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(n.isString(e)){if(!n.Long)return s.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},29790:function(e,t,r){"use strict";var n=t;function s(e,t,r){for(var n=Object.keys(t),s=0;s<n.length;++s)void 0!==e[n[s]]&&r||(e[n[s]]=t[n[s]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&s(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(34537),n.base64=r(97419),n.EventEmitter=r(19211),n.float=r(10945),n.inquire=r(67199),n.utf8=r(94997),n.pool=r(76662),n.LongBits=r(98441),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=s,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},5772:function(e,t,r){"use strict";e.exports=l;var n,s=r(29790),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function h(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function l(){this.len=0,this.head=new c(h,0,0),this.tail=this.head,this.states=null}var d=function(){return s.Buffer?function(){return(l.create=function(){return new n})()}:function(){return new l}};function f(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}l.create=d(),l.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(l.alloc=s.pool(l.alloc,s.Array.prototype.subarray)),l.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},p.prototype=Object.create(c.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(g,10,i.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=i.from(e);return this._push(g,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(g,t.length(),t)},l.prototype.bool=function(e){return this._push(f,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=i.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var y=s.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(s.isString(e)){var r=l.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(y,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(f,1,0)},l.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(h,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(h,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},l._configure=function(e){n=e,l.create=d(),n._configure()}},31994:function(e,t,r){"use strict";e.exports=i;var n=r(5772);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(29790);function i(){n.call(this)}function o(e,t,r){e.length<40?s.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},52197:function(e,t,r){"use strict";e.exports=r(50628)},50628:function(e,t,r){"use strict";var n=t;function s(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(5886),n.BufferWriter=r(93079),n.Reader=r(32376),n.BufferReader=r(85333),n.util=r(98380),n.rpc=r(26751),n.roots=r(86849),n.configure=s,s()},32376:function(e,t,r){"use strict";e.exports=c;var n,s=r(98380),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var h,u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},l=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function d(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function f(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}c.create=l(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(h=4294967295,function(){if(h=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return h;if(h=(h|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return h;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return h}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return f(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|f(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){n=e,c.create=l(),n._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},85333:function(e,t,r){"use strict";e.exports=i;var n=r(32376);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(98380);function i(e){n.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},86849:function(e){"use strict";e.exports={}},26751:function(e,t,r){"use strict";t.Service=r(98094)},98094:function(e,t,r){"use strict";e.exports=s;var n=r(98380);function s(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(s.prototype=Object.create(n.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,r,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return n.asPromise(e,a,t,r,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return a.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof s))try{r=s[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",r,t),o(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},26396:function(e,t,r){"use strict";e.exports=s;var n=r(98380);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new s(r,n)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(n.isString(e)){if(!n.Long)return s.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},98380:function(e,t,r){"use strict";var n=t;function s(e,t,r){for(var n=Object.keys(t),s=0;s<n.length;++s)void 0!==e[n[s]]&&r||(e[n[s]]=t[n[s]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&s(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(34537),n.base64=r(97419),n.EventEmitter=r(19211),n.float=r(10945),n.inquire=r(67199),n.utf8=r(94997),n.pool=r(76662),n.LongBits=r(26396),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=s,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},5886:function(e,t,r){"use strict";e.exports=l;var n,s=r(98380),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function h(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function l(){this.len=0,this.head=new c(h,0,0),this.tail=this.head,this.states=null}var d=function(){return s.Buffer?function(){return(l.create=function(){return new n})()}:function(){return new l}};function f(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}l.create=d(),l.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(l.alloc=s.pool(l.alloc,s.Array.prototype.subarray)),l.prototype._push=function(e,t,r){return this.tail=this.tail.next=new c(e,t,r),this.len+=t,this},p.prototype=Object.create(c.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(g,10,i.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=i.from(e);return this._push(g,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(g,t.length(),t)},l.prototype.bool=function(e){return this._push(f,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=i.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var y=s.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(s.isString(e)){var r=l.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(y,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(f,1,0)},l.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(h,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(h,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},l._configure=function(e){n=e,l.create=d(),n._configure()}},93079:function(e,t,r){"use strict";e.exports=i;var n=r(5886);(i.prototype=Object.create(n.prototype)).constructor=i;var s=r(98380);function i(){n.call(this)}function o(e,t,r){e.length<40?s.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},74368:function(e,t,r){var n,s,i;s=[r(61641)],void 0===(i="function"==typeof(n=function(e){"use strict";var t=e.Reader,r=e.Writer,n=e.util,s=e.roots.default||(e.roots.default={});return s.RPC=function(){function i(e){if(this.subscriptions=[],this.messages=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.subscriptions=n.emptyArray,i.prototype.messages=n.emptyArray,i.prototype.control=null,Object.defineProperty(i.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=r.create()),null!=e.subscriptions&&e.subscriptions.length)for(var n=0;n<e.subscriptions.length;++n)s.RPC.SubOpts.encode(e.subscriptions[n],t.uint32(10).fork()).ldelim();if(null!=e.messages&&e.messages.length)for(n=0;n<e.messages.length;++n)s.RPC.Message.encode(e.messages[n],t.uint32(18).fork()).ldelim();return null!=e.control&&Object.hasOwnProperty.call(e,"control")&&s.RPC.ControlMessage.encode(e.control,t.uint32(26).fork()).ldelim(),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.push(s.RPC.SubOpts.decode(e,e.uint32()));break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.push(s.RPC.Message.decode(e,e.uint32()));break;case 3:i.control=s.RPC.ControlMessage.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC)return e;var t=new s.RPC;if(e.subscriptions){if(!Array.isArray(e.subscriptions))throw TypeError(".RPC.subscriptions: array expected");t.subscriptions=[];for(var r=0;r<e.subscriptions.length;++r){if("object"!=typeof e.subscriptions[r])throw TypeError(".RPC.subscriptions: object expected");t.subscriptions[r]=s.RPC.SubOpts.fromObject(e.subscriptions[r])}}if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".RPC.messages: array expected");for(t.messages=[],r=0;r<e.messages.length;++r){if("object"!=typeof e.messages[r])throw TypeError(".RPC.messages: object expected");t.messages[r]=s.RPC.Message.fromObject(e.messages[r])}}if(null!=e.control){if("object"!=typeof e.control)throw TypeError(".RPC.control: object expected");t.control=s.RPC.ControlMessage.fromObject(e.control)}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.subscriptions=[],r.messages=[]),e.subscriptions&&e.subscriptions.length){r.subscriptions=[];for(var n=0;n<e.subscriptions.length;++n)r.subscriptions[n]=s.RPC.SubOpts.toObject(e.subscriptions[n],t)}if(e.messages&&e.messages.length)for(r.messages=[],n=0;n<e.messages.length;++n)r.messages[n]=s.RPC.Message.toObject(e.messages[n],t);return null!=e.control&&e.hasOwnProperty("control")&&(r.control=s.RPC.ControlMessage.toObject(e.control,t),t.oneofs&&(r._control="control")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i.SubOpts=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.subscribe=null,i.prototype.topic=null,Object.defineProperty(i.prototype,"_subscribe",{get:n.oneOfGetter(o=["subscribe"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_topic",{get:n.oneOfGetter(o=["topic"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.subscribe&&Object.hasOwnProperty.call(e,"subscribe")&&t.uint32(8).bool(e.subscribe),null!=e.topic&&Object.hasOwnProperty.call(e,"topic")&&t.uint32(18).string(e.topic),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.SubOpts;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.subscribe=e.bool();break;case 2:i.topic=e.string();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.SubOpts)return e;var t=new s.RPC.SubOpts;return null!=e.subscribe&&(t.subscribe=Boolean(e.subscribe)),null!=e.topic&&(t.topic=String(e.topic)),t},i.toObject=function(e,t){t||(t={});var r={};return null!=e.subscribe&&e.hasOwnProperty("subscribe")&&(r.subscribe=e.subscribe,t.oneofs&&(r._subscribe="subscribe")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic,t.oneofs&&(r._topic="topic")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.Message=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.from=null,i.prototype.data=null,i.prototype.seqno=null,i.prototype.topic="",i.prototype.signature=null,i.prototype.key=null,Object.defineProperty(i.prototype,"_from",{get:n.oneOfGetter(o=["from"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_data",{get:n.oneOfGetter(o=["data"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_seqno",{get:n.oneOfGetter(o=["seqno"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signature",{get:n.oneOfGetter(o=["signature"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_key",{get:n.oneOfGetter(o=["key"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.from&&Object.hasOwnProperty.call(e,"from")&&t.uint32(10).bytes(e.from),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.seqno&&Object.hasOwnProperty.call(e,"seqno")&&t.uint32(26).bytes(e.seqno),t.uint32(34).string(e.topic),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(50).bytes(e.key),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var i=void 0===r?e.len:e.pos+r,o=new s.RPC.Message;e.pos<i;){var a=e.uint32();switch(a>>>3){case 1:o.from=e.bytes();break;case 2:o.data=e.bytes();break;case 3:o.seqno=e.bytes();break;case 4:o.topic=e.string();break;case 5:o.signature=e.bytes();break;case 6:o.key=e.bytes();break;default:e.skipType(7&a)}}if(!o.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:o});return o},i.fromObject=function(e){if(e instanceof s.RPC.Message)return e;var t=new s.RPC.Message;return null!=e.from&&("string"==typeof e.from?n.base64.decode(e.from,t.from=n.newBuffer(n.base64.length(e.from)),0):e.from.length&&(t.from=e.from)),null!=e.data&&("string"==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.seqno&&("string"==typeof e.seqno?n.base64.decode(e.seqno,t.seqno=n.newBuffer(n.base64.length(e.seqno)),0):e.seqno.length&&(t.seqno=e.seqno)),null!=e.topic&&(t.topic=String(e.topic)),null!=e.signature&&("string"==typeof e.signature?n.base64.decode(e.signature,t.signature=n.newBuffer(n.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.key&&("string"==typeof e.key?n.base64.decode(e.key,t.key=n.newBuffer(n.base64.length(e.key)),0):e.key.length&&(t.key=e.key)),t},i.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.topic=""),null!=e.from&&e.hasOwnProperty("from")&&(r.from=t.bytes===String?n.base64.encode(e.from,0,e.from.length):t.bytes===Array?Array.prototype.slice.call(e.from):e.from,t.oneofs&&(r._from="from")),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data,t.oneofs&&(r._data="data")),null!=e.seqno&&e.hasOwnProperty("seqno")&&(r.seqno=t.bytes===String?n.base64.encode(e.seqno,0,e.seqno.length):t.bytes===Array?Array.prototype.slice.call(e.seqno):e.seqno,t.oneofs&&(r._seqno="seqno")),null!=e.topic&&e.hasOwnProperty("topic")&&(r.topic=e.topic),null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?n.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature,t.oneofs&&(r._signature="signature")),null!=e.key&&e.hasOwnProperty("key")&&(r.key=t.bytes===String?n.base64.encode(e.key,0,e.key.length):t.bytes===Array?Array.prototype.slice.call(e.key):e.key,t.oneofs&&(r._key="key")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlMessage=function(){function i(e){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return i.prototype.ihave=n.emptyArray,i.prototype.iwant=n.emptyArray,i.prototype.graft=n.emptyArray,i.prototype.prune=n.emptyArray,i.encode=function(e,t){if(t||(t=r.create()),null!=e.ihave&&e.ihave.length)for(var n=0;n<e.ihave.length;++n)s.RPC.ControlIHave.encode(e.ihave[n],t.uint32(10).fork()).ldelim();if(null!=e.iwant&&e.iwant.length)for(n=0;n<e.iwant.length;++n)s.RPC.ControlIWant.encode(e.iwant[n],t.uint32(18).fork()).ldelim();if(null!=e.graft&&e.graft.length)for(n=0;n<e.graft.length;++n)s.RPC.ControlGraft.encode(e.graft[n],t.uint32(26).fork()).ldelim();if(null!=e.prune&&e.prune.length)for(n=0;n<e.prune.length;++n)s.RPC.ControlPrune.encode(e.prune[n],t.uint32(34).fork()).ldelim();return t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlMessage;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.push(s.RPC.ControlIHave.decode(e,e.uint32()));break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.push(s.RPC.ControlIWant.decode(e,e.uint32()));break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.push(s.RPC.ControlGraft.decode(e,e.uint32()));break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.push(s.RPC.ControlPrune.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlMessage)return e;var t=new s.RPC.ControlMessage;if(e.ihave){if(!Array.isArray(e.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");t.ihave=[];for(var r=0;r<e.ihave.length;++r){if("object"!=typeof e.ihave[r])throw TypeError(".RPC.ControlMessage.ihave: object expected");t.ihave[r]=s.RPC.ControlIHave.fromObject(e.ihave[r])}}if(e.iwant){if(!Array.isArray(e.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");for(t.iwant=[],r=0;r<e.iwant.length;++r){if("object"!=typeof e.iwant[r])throw TypeError(".RPC.ControlMessage.iwant: object expected");t.iwant[r]=s.RPC.ControlIWant.fromObject(e.iwant[r])}}if(e.graft){if(!Array.isArray(e.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");for(t.graft=[],r=0;r<e.graft.length;++r){if("object"!=typeof e.graft[r])throw TypeError(".RPC.ControlMessage.graft: object expected");t.graft[r]=s.RPC.ControlGraft.fromObject(e.graft[r])}}if(e.prune){if(!Array.isArray(e.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");for(t.prune=[],r=0;r<e.prune.length;++r){if("object"!=typeof e.prune[r])throw TypeError(".RPC.ControlMessage.prune: object expected");t.prune[r]=s.RPC.ControlPrune.fromObject(e.prune[r])}}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.ihave=[],r.iwant=[],r.graft=[],r.prune=[]),e.ihave&&e.ihave.length){r.ihave=[];for(var n=0;n<e.ihave.length;++n)r.ihave[n]=s.RPC.ControlIHave.toObject(e.ihave[n],t)}if(e.iwant&&e.iwant.length)for(r.iwant=[],n=0;n<e.iwant.length;++n)r.iwant[n]=s.RPC.ControlIWant.toObject(e.iwant[n],t);if(e.graft&&e.graft.length)for(r.graft=[],n=0;n<e.graft.length;++n)r.graft[n]=s.RPC.ControlGraft.toObject(e.graft[n],t);if(e.prune&&e.prune.length)for(r.prune=[],n=0;n<e.prune.length;++n)r.prune[n]=s.RPC.ControlPrune.toObject(e.prune[n],t);return r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIHave=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.topicID=null,i.prototype.messageIDs=n.emptyArray,Object.defineProperty(i.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(18).bytes(e.messageIDs[n]);return t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlIHave;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes());break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIHave)return e;var t=new s.RPC.ControlIHave;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)r.messageIDs[s]=t.bytes===String?n.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIWant=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return i.prototype.messageIDs=n.emptyArray,i.encode=function(e,t){if(t||(t=r.create()),null!=e.messageIDs&&e.messageIDs.length)for(var n=0;n<e.messageIDs.length;++n)t.uint32(10).bytes(e.messageIDs[n]);return t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlIWant;e.pos<n;){var o=e.uint32();o>>>3==1?(i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes())):e.skipType(7&o)}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIWant)return e;var t=new s.RPC.ControlIWant;if(e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");t.messageIDs=[];for(var r=0;r<e.messageIDs.length;++r)"string"==typeof e.messageIDs[r]?n.base64.decode(e.messageIDs[r],t.messageIDs[r]=n.newBuffer(n.base64.length(e.messageIDs[r])),0):e.messageIDs[r].length&&(t.messageIDs[r]=e.messageIDs[r])}return t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.messageIDs=[]),e.messageIDs&&e.messageIDs.length){r.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)r.messageIDs[s]=t.bytes===String?n.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlGraft=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.topicID=null,Object.defineProperty(i.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlGraft;e.pos<n;){var o=e.uint32();o>>>3==1?i.topicID=e.string():e.skipType(7&o)}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlGraft)return e;var t=new s.RPC.ControlGraft;return null!=e.topicID&&(t.topicID=String(e.topicID)),t},i.toObject=function(e,t){t||(t={});var r={};return null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlPrune=function(){function i(e){if(this.peers=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.topicID=null,i.prototype.peers=n.emptyArray,i.prototype.backoff=null,Object.defineProperty(i.prototype,"_topicID",{get:n.oneOfGetter(o=["topicID"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_backoff",{get:n.oneOfGetter(o=["backoff"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=r.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.peers&&e.peers.length)for(var n=0;n<e.peers.length;++n)s.RPC.PeerInfo.encode(e.peers[n],t.uint32(18).fork()).ldelim();return null!=e.backoff&&Object.hasOwnProperty.call(e,"backoff")&&t.uint32(24).uint64(e.backoff),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.ControlPrune;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),i.peers.push(s.RPC.PeerInfo.decode(e,e.uint32()));break;case 3:i.backoff=e.uint64();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlPrune)return e;var t=new s.RPC.ControlPrune;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.peers){if(!Array.isArray(e.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");t.peers=[];for(var r=0;r<e.peers.length;++r){if("object"!=typeof e.peers[r])throw TypeError(".RPC.ControlPrune.peers: object expected");t.peers[r]=s.RPC.PeerInfo.fromObject(e.peers[r])}}return null!=e.backoff&&(n.Long?(t.backoff=n.Long.fromValue(e.backoff)).unsigned=!0:"string"==typeof e.backoff?t.backoff=parseInt(e.backoff,10):"number"==typeof e.backoff?t.backoff=e.backoff:"object"==typeof e.backoff&&(t.backoff=new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0))),t},i.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.peers=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),e.peers&&e.peers.length){r.peers=[];for(var i=0;i<e.peers.length;++i)r.peers[i]=s.RPC.PeerInfo.toObject(e.peers[i],t)}return null!=e.backoff&&e.hasOwnProperty("backoff")&&("number"==typeof e.backoff?r.backoff=t.longs===String?String(e.backoff):e.backoff:r.backoff=t.longs===String?n.Long.prototype.toString.call(e.backoff):t.longs===Number?new n.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0):e.backoff,t.oneofs&&(r._backoff="backoff")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.PeerInfo=function(){function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var o;return i.prototype.peerID=null,i.prototype.signedPeerRecord=null,Object.defineProperty(i.prototype,"_peerID",{get:n.oneOfGetter(o=["peerID"]),set:n.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signedPeerRecord",{get:n.oneOfGetter(o=["signedPeerRecord"]),set:n.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=r.create()),null!=e.peerID&&Object.hasOwnProperty.call(e,"peerID")&&t.uint32(10).bytes(e.peerID),null!=e.signedPeerRecord&&Object.hasOwnProperty.call(e,"signedPeerRecord")&&t.uint32(18).bytes(e.signedPeerRecord),t},i.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new s.RPC.PeerInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.peerID=e.bytes();break;case 2:i.signedPeerRecord=e.bytes();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.PeerInfo)return e;var t=new s.RPC.PeerInfo;return null!=e.peerID&&("string"==typeof e.peerID?n.base64.decode(e.peerID,t.peerID=n.newBuffer(n.base64.length(e.peerID)),0):e.peerID.length&&(t.peerID=e.peerID)),null!=e.signedPeerRecord&&("string"==typeof e.signedPeerRecord?n.base64.decode(e.signedPeerRecord,t.signedPeerRecord=n.newBuffer(n.base64.length(e.signedPeerRecord)),0):e.signedPeerRecord.length&&(t.signedPeerRecord=e.signedPeerRecord)),t},i.toObject=function(e,t){t||(t={});var r={};return null!=e.peerID&&e.hasOwnProperty("peerID")&&(r.peerID=t.bytes===String?n.base64.encode(e.peerID,0,e.peerID.length):t.bytes===Array?Array.prototype.slice.call(e.peerID):e.peerID,t.oneofs&&(r._peerID="peerID")),null!=e.signedPeerRecord&&e.hasOwnProperty("signedPeerRecord")&&(r.signedPeerRecord=t.bytes===String?n.base64.encode(e.signedPeerRecord,0,e.signedPeerRecord.length):t.bytes===Array?Array.prototype.slice.call(e.signedPeerRecord):e.signedPeerRecord,t.oneofs&&(r._signedPeerRecord="signedPeerRecord")),r},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i}(),s})?n.apply(t,s):n)||(e.exports=i)},73379:function(e,t,r){"use strict";r.d(t,{n:function(){return n}});class n{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(e,t,r){this.gossip=e,this.msgIdToStrFn=r;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,r=!1){const{msgIdStr:n}=e;return!this.msgs.has(n)&&(this.msgs.set(n,{message:t,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),r||this.notValidatedCount++,!0)}observeDuplicate(e,t){const r=this.msgs.get(e);r&&!r.validated&&r.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const r=this.msgs.get(e);if(!r)return null;const n=(r.iwantCounts.get(t)??0)+1;return r.iwantCounts.set(t,n),{msg:r.message,count:n}}getGossipIDs(e){const t=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach((r=>{const n=this.msgs.get(r.msgIdStr);if(n&&n.validated&&e.has(r.topic)){let e=t.get(r.topic);e||(e=[],t.set(r.topic,e)),e.push(r.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;const{message:r,originatingPeers:n}=t;return t.validated=!0,t.originatingPeers=new Set,{message:r,originatingPeers:n}}shift(){this.history[this.history.length-1].forEach((e=>{const t=this.msgs.get(e.msgIdStr);t&&(this.msgs.delete(e.msgIdStr),t.validated||this.notValidatedCount--)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}},85361:function(e,t,r){"use strict";function n(e,t,r,n){let s=0;Object.entries(t.topics).forEach((([e,t])=>{const n=r.topics[e];if(void 0===n)return;let i=0;if(t.inMesh){let e=t.meshTime/n.timeInMeshQuantum;e>n.timeInMeshCap&&(e=n.timeInMeshCap),i+=e*n.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>n.firstMessageDeliveriesCap&&(o=n.firstMessageDeliveriesCap),i+=o*n.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n.meshMessageDeliveriesThreshold){const e=n.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;i+=e*e*n.meshMessageDeliveriesWeight}i+=t.meshFailurePenalty*n.meshFailurePenaltyWeight;i+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*n.invalidMessageDeliveriesWeight,s+=i*n.topicWeight})),r.topicScoreCap>0&&s>r.topicScoreCap&&(s=r.topicScoreCap);const i=r.appSpecificScore(e);if(s+=i*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),i=t?t.size:0;if(i>r.IPColocationFactorThreshold){const e=i-r.IPColocationFactorThreshold;s+=e*e*r.IPColocationFactorWeight}})),t.behaviourPenalty>r.behaviourPenaltyThreshold){const e=t.behaviourPenalty-r.behaviourPenaltyThreshold;s+=e*e*r.behaviourPenaltyWeight}return s}r.d(t,{l:function(){return n}})},64283:function(e,t,r){"use strict";r.d(t,{v:function(){return n}});const n="ERR_INVALID_PEER_SCORE_PARAMS"},19292:function(e,t,r){"use strict";function n(e,t,r,n,s){let i=0;const o=new Map;if(Object.entries(t.topics).forEach((([e,t])=>{const n=s.get(e)??"unknown",a=r.topics[e];if(void 0===a)return;let c=o.get(n);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(n,c));let h=0,u=0,l=0,d=0,f=0;if(t.inMesh){h+=Math.max(t.meshTime/a.timeInMeshQuantum,a.timeInMeshCap)*a.timeInMeshWeight}let p=t.firstMessageDeliveries;if(p>a.firstMessageDeliveriesCap&&(p=a.firstMessageDeliveriesCap),u+=p*a.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const e=a.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;l+=e*e*a.meshMessageDeliveriesWeight}d+=t.meshFailurePenalty*a.meshFailurePenaltyWeight;f+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*a.invalidMessageDeliveriesWeight,i+=(h+u+l+d+f)*a.topicWeight,c.p1w+=h,c.p2w+=u,c.p3w+=l,c.p3bw+=d,c.p4w+=f})),r.topicScoreCap>0&&i>r.topicScoreCap){i=r.topicScoreCap;const e=r.topicScoreCap/i;for(const t of o.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,c=0,h=0;a+=r.appSpecificScore(e)*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),s=t?t.size:0;if(s>r.IPColocationFactorThreshold){const e=s-r.IPColocationFactorThreshold;c+=e*e*r.IPColocationFactorWeight}}));return h+=t.behaviourPenalty*t.behaviourPenalty*r.behaviourPenaltyWeight,i+=a+c+h,{byTopic:o,p5w:a,p6w:c,p7w:h,score:i}}function s(e,t,r,s,i){const o={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const a of e){const e=t.get(a);if(e){const t=n(a,e,r,s,i);for(const[e,r]of t.byTopic){let t=o.byTopic.get(e);t||(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},o.byTopic.set(e,t)),t.p1w.push(r.p1w),t.p2w.push(r.p2w),t.p3w.push(r.p3w),t.p3bw.push(r.p3bw),t.p4w.push(r.p4w)}o.p5w.push(t.p5w),o.p6w.push(t.p6w),o.p7w.push(t.p7w),o.score.push(t.score)}else o.p5w.push(0),o.p6w.push(0),o.p7w.push(0),o.score.push(0)}return o}r.d(t,{i:function(){return s}})},80778:function(e,t,r){"use strict";function n(e){if(e.length<=1)return e;for(let t=0;t<e.length;t++){const r=Math.floor(Math.random()*Math.floor(e.length)),n=e[t];e[t]=e[r],e[r]=n}return e}r.d(t,{T:function(){return n}})},15036:function(e,t,r){"use strict";r.d(t,{p:function(){return n}});class n{entries=new Map;validityMs;constructor(e){this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,r]of this.entries.entries()){if(!(r.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}},95577:function(e,t,r){"use strict";r.d(t,{Jz:function(){return n},_q:function(){return o},nh:function(){return i}});var n,s,i,o,a=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(n||(n={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(s||(s={})),function(e){e.codec=()=>(0,a.Ji)(s)}(n||(n={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,a.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),n.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:r.Type=n.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,a.LE)(t,e.codec()),e.decode=t=>(0,a.C6)(t,e.codec())}(i||(i={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,a.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),n.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:r.Type=n.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,a.LE)(t,e.codec()),e.decode=t=>(0,a.C6)(t,e.codec())}(o||(o={}))},98900:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(49541),s=r(3909);function i(e){if(isNaN(e)||e<=0)throw new n.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return(0,s.O6)(e)}},17610:function(e,t,r){"use strict";var n=r(68603),s=r(46406);function i(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const o=i("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),a=i("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{e=e.substring(1);const t=(0,s.E)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),c={utf8:o,"utf-8":o,hex:n.gh.base16,latin1:a,ascii:a,binary:a,...n.gh};t.Z=c},32433:function(e,t,r){"use strict";function n(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}r.d(t,{A:function(){return n}})},14152:function(e,t,r){"use strict";r.d(t,{u:function(){return s}});class n{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class s{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new n(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}},2018:function(e,t,r){"use strict";r.d(t,{BB:function(){return o},fS:function(){return n},mL:function(){return i},oQ:function(){return s}});new Uint8Array(0);const n=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},s=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},i=e=>(new TextEncoder).encode(e),o=e=>(new TextDecoder).decode(e)},46023:function(e,t,r){"use strict";r.d(t,{k0:function(){return l}});var n=r(17663),s=r(1465),i=r(2018),o=r(46232),a=r(92937);const c=(e,t)=>{const{bytes:r,version:i}=e;return 0===i?f(r,u(e),t||s.base58btc.encoder):p(r,u(e),t||n.base32.encoder)},h=new WeakMap,u=e=>{const t=h.get(e);if(null==t){const t=new Map;return h.set(e,t),t}return t};class l{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==g)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==m)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return l.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=o.Ue(e,t);return l.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return l.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&o.fS(e.multihash,r.multihash)}toString(e){return c(this,e)}toJSON(){return{"/":c(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof l)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new l(e,r,n,s||y(e,r,n.bytes))}if(!0===t[b]){const{version:e,multihash:r,code:n}=t,s=o.Jx(r);return l.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==g)throw new Error(`Version 0 CID must use dag-pb (code: ${g}) block encoding`);return new l(e,t,r,r.bytes);case 1:{const n=y(e,t,r.bytes);return new l(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return l.create(0,g,e)}static createV1(e,t){return l.create(1,e,t)}static decode(e){const[t,r]=l.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=l.inspectBytes(e),r=t.size-t.multihashSize,n=(0,i.oQ)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),a=new o.zZ(t.multihashCode,t.digestSize,s,n);return[0===t.version?l.createV0(a):l.createV1(t.codec,a),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=a.Jx(e.subarray(t));return t+=n,r};let n=r(),s=g;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),c=r(),h=t+c;return{version:n,codec:s,multihashCode:o,digestSize:c,multihashSize:h-i,size:h}}static parse(e,t){const[r,n]=d(e,t),s=l.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return u(s).set(r,e),s}}const d=(e,t)=>{switch(e[0]){case"Q":{const r=t||s.base58btc;return[s.base58btc.prefix,r.decode(`${s.base58btc.prefix}${e}`)]}case s.base58btc.prefix:{const r=t||s.base58btc;return[s.base58btc.prefix,r.decode(e)]}case n.base32.prefix:{const r=t||n.base32;return[n.base32.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},f=(e,t,r)=>{const{prefix:n}=r;if(n!==s.base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const s=r.encode(e).slice(1);return t.set(n,s),s}return i},p=(e,t,r)=>{const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s},g=112,m=18,y=(e,t,r)=>{const n=a.P$(e),s=n+a.P$(t),i=new Uint8Array(s+r.byteLength);return a.mL(e,i,0),a.mL(t,i,n),i.set(r,s),i},b=Symbol.for("@ipld/js-cid/CID")},46232:function(e,t,r){"use strict";r.d(t,{Jx:function(){return o},Ue:function(){return i},fS:function(){return a},zZ:function(){return c}});var n=r(2018),s=r(92937);const i=(e,t)=>{const r=t.byteLength,n=s.P$(e),i=n+s.P$(r),o=new Uint8Array(i+r);return s.mL(e,o,0),s.mL(r,o,n),o.set(t,i),new c(e,r,t,o)},o=e=>{const t=(0,n.oQ)(e),[r,i]=s.Jx(t),[o,a]=s.Jx(t.subarray(i)),h=t.subarray(i+a);if(h.byteLength!==o)throw new Error("Incorrect length");return new c(r,o,h,t)},a=(e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,n.fS)(e.bytes,r.bytes)}};class c{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}},78227:function(e,t,r){"use strict";r.r(t),r.d(t,{identity:function(){return o}});var n=r(2018),s=r(46232);const i=n.oQ,o={code:0,name:"identity",encode:i,digest:e=>s.Ue(0,i(e))}},92937:function(e,t,r){"use strict";r.d(t,{Jx:function(){return v},mL:function(){return _},P$:function(){return E}});var n=function e(t,r,n){r=r||[];var a=n=n||0;for(;t>=o;)r[n++]=255&t|s,t/=128;for(;t&i;)r[n++]=255&t|s,t>>>=7;return r[n]=0|t,e.bytes=n-a+1,r},s=128,i=-128,o=Math.pow(2,31);var a=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&h)<<i:(n&h)*Math.pow(2,i),i+=7}while(n>=c);return e.bytes=o-r,s},c=128,h=127;var u=Math.pow(2,7),l=Math.pow(2,14),d=Math.pow(2,21),f=Math.pow(2,28),p=Math.pow(2,35),g=Math.pow(2,42),m=Math.pow(2,49),y=Math.pow(2,56),b=Math.pow(2,63),w={encode:n,decode:a,encodingLength:function(e){return e<u?1:e<l?2:e<d?3:e<f?4:e<p?5:e<g?6:e<m?7:e<y?8:e<b?9:10}};const v=(e,t=0)=>[w.decode(e,t),w.decode.bytes],_=(e,t,r=0)=>(w.encode(e,t,r),t),E=e=>w.encodingLength(e)},86412:function(e,t,r){"use strict";var n=r(28375),s=r(39860);function i(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const o=i("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),a=i("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{e=e.substring(1);const t=(0,s.E)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),c={utf8:o,"utf-8":o,hex:n.gh.base16,latin1:a,ascii:a,binary:a,...n.gh};t.Z=c},6329:function(e,t,r){"use strict";r.d(t,{t:function(){return ce}});var n=r(91893),s=r(36638),i=r(91921),o=r(90212);const a=65535,c=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var h=r(33869),u=r(4101),l=r(1751),d=r(10013);const f={hashSHA256:e=>(0,d.J)(e),getHKDF(e,t){const r=(0,l.Kl)(d.J,t,e),n=(0,l.jn)(d.J,r,void 0,96);return[n.subarray(0,32),n.subarray(32,64),n.subarray(64,96)]},generateX25519KeyPair(){const e=u.Sg.utils.randomPrivateKey();return{publicKey:u.Sg.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:u.Sg.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>u.Sg.getSharedSecret(e,t),chaCha20Poly1305Encrypt:(e,t,r,n)=>(0,h.CK)(n,t,r).encrypt(e),chaCha20Poly1305Decrypt:(e,t,r,n,s)=>(0,h.CK)(n,t,r).decrypt(e,s)};var p=r(4969);const g=e=>{const t=(r=2,globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r));var r;return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};g.bytes=2;const m=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};m.bytes=2;var y=r(49541),b=(r(3068),r(97450),r(3832),r(9393)),w=r(27484),v=(r(81012),r(24956),r(43108),r(22378));const _={rsa:r(41854),ed25519:w,secp256k1:r(86170)};function E(e){const t=Object.keys(_).join(" / ");return new y.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}async function k(e){const t=v._q.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case v.Jz.RSA:return _.rsa.unmarshalRsaPrivateKey(r);case v.Jz.Ed25519:return _.ed25519.unmarshalEd25519PrivateKey(r);case v.Jz.Secp256k1:return _.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw E(t.Type??"RSA")}}var S=r(5681),x=r(97565),I=r(48882),T=r(85107),A=r(82094),D=r(55443),P=r(43846),C=r(16430);const M=Symbol.for("nodejs.util.inspect.custom"),R=Object.values(I.gh).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),I.gh.identity.decoder),O=114,N=36,B=37;class L{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[S.N]=!0;toString(){return null==this.string&&(this.string=x.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return T.k0.createV1(O,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return(0,C.f)(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??R,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=A.Jx(x.base58btc.decode(`z${e}`));return e.startsWith("12D")?new U({multihash:t}):e.startsWith("16U")?new F({multihash:t}):new z({multihash:t})}return function(e){try{const t=A.Jx(e);if(t.code===D.identity.code){if(t.digest.length===N)return new U({multihash:t});if(t.digest.length===B)return new F({multihash:t})}if(t.code===P.sha256.code)return new z({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==O)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===P.sha256.code)return new z({multihash:e.multihash});if(t.code===D.identity.code){if(t.digest.length===N)return new U({multihash:e.multihash});if(t.digest.length===B)return new F({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(T.k0.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(R.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return(0,C.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[M](){return`PeerId(${this.toString()})`}}class z extends L{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class U extends L{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class F extends L{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}async function j(e,t){return e.length===N?new U({multihash:A.Ue(D.identity.code,e),privateKey:t}):e.length===B?new F({multihash:A.Ue(D.identity.code,e),privateKey:t}):new z({multihash:await P.sha256.digest(e),publicKey:e,privateKey:t})}var V,W,$=r(46888);async function q(e,t,r){const n=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");return(await k(e.privateKey)).sign(t)}(e,G(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,r){return W.encode({identityKey:e,identitySig:t,extensions:r??{webtransportCerthashes:[]}}).subarray()}(e.publicKey,n,r)}async function K(e){return j(e.identityKey)}function H(e){return W.decode(e)}function G(e){const t=(0,b.m)("noise-libp2p-static-key:");return(0,p.z)([t,e],t.length+e.length)}async function J(e,t,r){const n=await j(t.identityKey);if(!n.equals(r))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${r.toString()}`);const s=G(e);if(null==n.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const i=function(e){const t=v.nh.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case v.Jz.RSA:return _.rsa.unmarshalRsaPublicKey(r);case v.Jz.Ed25519:return _.ed25519.unmarshalEd25519PublicKey(r);case v.Jz.Secp256k1:return _.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw E(t.Type??"unknown")}}(n.publicKey);if(!await i.verify(s,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function Z(e){return e instanceof Uint8Array&&32===e.length}!function(e){let t;e.codec=()=>(null==t&&(t=(0,$.yw)(((e,t,r={})=>{if(!1!==r.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={webtransportCerthashes:[]},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.webtransportCerthashes.push(e.bytes());else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,$.LE)(t,e.codec()),e.decode=t=>(0,$.C6)(t,e.codec())}(V||(V={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,$.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),(!0===r.writeDefaults||null!=e.identityKey&&e.identityKey.byteLength>0)&&(t.uint32(10),t.bytes(e.identityKey??new Uint8Array(0))),(!0===r.writeDefaults||null!=e.identitySig&&e.identitySig.byteLength>0)&&(t.uint32(18),t.bytes(e.identitySig??new Uint8Array(0))),null!=e.extensions&&(t.uint32(34),V.codec().encode(e.extensions,t,{writeDefaults:!1})),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.identityKey=e.bytes();break;case 2:r.identitySig=e.bytes();break;case 4:r.extensions=V.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,$.LE)(t,e.codec()),e.decode=t=>(0,$.C6)(t,e.codec())}(W||(W={}));var Q=r(94239);const Y=(0,r(17594).kg)("libp2p:noise");let X;function ee(e){e?(X(`LOCAL_PUBLIC_EPHEMERAL_KEY ${(0,Q.B)(e.publicKey,"hex")}`),X(`LOCAL_PRIVATE_EPHEMERAL_KEY ${(0,Q.B)(e.privateKey,"hex")}`)):X("Missing local ephemeral keys.")}function te(e){X(`REMOTE_EPHEMERAL_PUBLIC_KEY ${(0,Q.B)(e,"hex")}`)}X=c?Y:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});var re=r(78238);class ne{crypto;constructor(e){this.crypto=e}encryptWithAd(e,t,r){const n=this.encrypt(e.k,e.n,t,r);return e.n.increment(),n}decryptWithAd(e,t,r,n){const{plaintext:s,valid:i}=this.decrypt(e.k,e.n,t,r,n);return i&&e.n.increment(),{plaintext:s,valid:i}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){const t=this.createEmptyKey();return(0,C.f)(t,e)}encrypt(e,t,r,n){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(n,t.getBytes(),r,e)}encryptAndHash(e,t){let r;return r=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,r),r}decrypt(e,t,r,n,s){t.assertValue();const i=this.crypto.chaCha20Poly1305Decrypt(n,t.getBytes(),r,e,s);return i?{plaintext:i,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let r,n=!0;return this.hasKey(e.cs)?({plaintext:r,valid:n}=this.decryptWithAd(e.cs,e.h,t)):r=t,this.mixHash(e,t),{plaintext:r,valid:n}}dh(e,t){try{const r=this.crypto.generateX25519SharedKey(e,t);return 32===r.length?r:r.subarray(0,32)}catch(e){const t=e;return Y.error(t),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256((0,p.z)([e,t],e.length+t.length))}mixKey(e,t){const[r,n]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(n),e.ck=r}initializeKey(e){return{k:e,n:new re.pX}}initializeSymmetric(e){const t=(0,b.m)(e,"utf-8"),r=this.hashProtocolName(t),n=r,s=this.createEmptyKey();return{cs:this.initializeKey(s),ck:n,h:r}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}return this.getHash(e,new Uint8Array(0))}split(e){const[t,r]=this.crypto.getHKDF(e.ck,new Uint8Array(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(r)}}writeMessageRegular(e,t){const r=this.encryptWithAd(e,new Uint8Array(0),t);return{ne:this.createEmptyKey(),ns:new Uint8Array(0),ciphertext:r}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class se extends ne{initializeInitiator(e,t,r,n){const s=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(s,e);return{ss:s,s:t,rs:r,psk:n,re:new Uint8Array(32)}}initializeResponder(e,t,r,n){const s=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(s,e);return{ss:s,s:t,rs:r,psk:n,re:new Uint8Array(32)}}writeMessageA(e,t,r){const n=new Uint8Array(0);e.e=void 0!==r?r:this.crypto.generateX25519KeyPair();const s=e.e.publicKey;this.mixHash(e.ss,s);return{ne:s,ns:n,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const n=e.s.publicKey,s=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));return{ne:r,ns:s,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const r=e.s.publicKey,n=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const s=this.encryptAndHash(e.ss,t),i={ne:this.createEmptyKey(),ns:n,ciphertext:s},{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:i,cs1:o,cs2:a}}readMessageA(e,t){return Z(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(Z(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);n&&Z(r)&&(e.rs=r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:s,valid:n&&i}}readMessageC(e,t){const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);if(n&&Z(r)&&(e.rs=r),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:s,valid:n&&i,cs1:o,cs2:a}}initSession(e,t,r){const n=this.createEmptyKey(),s=new Uint8Array(32);let i;return i=e?this.initializeInitiator(t,r,s,n):this.initializeResponder(t,r,s,n),{hs:i,i:e,mc:0}}sendMessage(e,t,r){let n;if(0===e.mc)n=this.writeMessageA(e.hs,t,r);else if(1===e.mc)n=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:r,messageBuffer:s,cs1:i,cs2:o}=this.writeMessageC(e.hs,t);n=s,e.h=r,e.cs1=i,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");n=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");n=this.writeMessageRegular(e.cs2,t)}}return e.mc++,n}recvMessage(e,t){let r=new Uint8Array(0),n=!1;if(0===e.mc)({plaintext:r,valid:n}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:r,valid:n}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:s,plaintext:i,valid:o,cs1:a,cs2:c}=this.readMessageC(e.hs,t);r=i,n=o,e.h=s,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:r,valid:n}}}class ie{isInitiator;session;remotePeer;remoteExtensions={webtransportCerthashes:[]};payload;connection;xx;staticKeypair;prologue;constructor(e,t,r,n,s,i,o,a){this.isInitiator=e,this.payload=t,this.prologue=r,this.staticKeypair=s,this.connection=i,o&&(this.remotePeer=o),this.xx=a??new se(n),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){var e,t;if(e=this.session.hs.s,X(`LOCAL_STATIC_PUBLIC_KEY ${(0,Q.B)(e.publicKey,"hex")}`),X(`LOCAL_STATIC_PRIVATE_KEY ${(0,Q.B)(e.privateKey,"hex")}`),this.isInitiator){Y.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));await this.connection.write((t=e,(0,p.z)([t.ne,t.ciphertext],t.ne.length+t.ciphertext.length))),Y.trace("Stage 0 - Initiator finished sending first message."),ee(this.session.hs.e)}else{Y.trace("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:new Uint8Array(0)}}((await this.connection.read()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new y.kz("xx handshake stage 0 validation fail");Y.trace("Stage 0 - Responder received first message."),te(this.session.hs.re)}}async exchange(){if(this.isInitiator){Y.trace("Stage 1 - Initiator waiting to receive first message from responder...");const e=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.read()).subarray()),{plaintext:r,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new y.kz("xx handshake stage 1 validation fail");Y.trace("Stage 1 - Initiator received the message."),te(this.session.hs.re),t=this.session.hs.rs,X(`REMOTE_STATIC_PUBLIC_KEY ${(0,Q.B)(t,"hex")}`),Y.trace("Initiator going to check remote's signature...");try{const e=H(r);this.remotePeer=this.remotePeer||await K(e),await J(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new y.kT(`Error occurred while verifying signed payload: ${t.message}`)}Y.trace("All good with the signature!")}else{Y.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const t=this.xx.sendMessage(this.session,this.payload);await this.connection.write((e=t,(0,p.z)([e.ne,e.ns,e.ciphertext],e.ne.length+e.ns.length+e.ciphertext.length))),Y.trace("Stage 1 - Responder sent the second handshake message with signed payload."),ee(this.session.hs.e)}var e,t}async finish(){if(this.isInitiator){Y.trace("Stage 2 - Initiator sending third handshake message.");const t=this.xx.sendMessage(this.session,this.payload);await this.connection.write((e=t,(0,p.z)([e.ns,e.ciphertext],e.ns.length+e.ciphertext.length))),Y.trace("Stage 2 - Initiator sent message with signed payload.")}else{Y.trace("Stage 2 - Responder waiting for third handshake message...");const e=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.read()).subarray()),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new y.kz("xx handshake stage 2 validation fail");Y.trace("Stage 2 - Responder received the message, finished handshake.");try{const e=H(t);this.remotePeer=this.remotePeer||await K(e),await J(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new y.kT(`Error occurred while verifying signed payload: ${t.message}`)}}var e,t;(t=this.session).cs1&&t.cs2?(X(`CIPHER_STATE_1 ${t.cs1.n.getUint64()} ${(0,Q.B)(t.cs1.k,"hex")}`),X(`CIPHER_STATE_2 ${t.cs2.n.getUint64()} ${(0,Q.B)(t.cs2.k,"hex")}`)):X("Missing cipher state.")}encrypt(e,t){const r=this.getCS(t);return this.xx.encryptWithAd(r,new Uint8Array(0),e)}decrypt(e,t,r){const n=this.getCS(t,!1);return this.xx.decryptWithAd(n,new Uint8Array(0),e,r)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new y.kz("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}var oe=r(882);class ae{protocol="/noise";crypto;prologue;staticKeys;extensions;metrics;constructor(e={}){const{staticNoiseKey:t,extensions:r,crypto:n,prologueBytes:s,metrics:i}=e;this.crypto=n??f,this.extensions=r,this.metrics=i?(0,oe.J)(i):void 0,this.staticKeys=t?this.crypto.generateX25519KeyPairFromSeed(t):this.crypto.generateX25519KeyPair(),this.prologue=s??new Uint8Array(0)}async secureOutbound(e,t,r){const n=(0,s.p)(t,{lengthEncoder:g,lengthDecoder:m,maxDataLength:a}),i=await this.performHandshake({connection:n,isInitiator:!0,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,r){const n=(0,s.p)(t,{lengthEncoder:g,lengthDecoder:m,maxDataLength:a}),i=await this.performHandshake({connection:n,isInitiator:!1,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){const t=await q(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:r,remotePeer:n,connection:s}=e,i=new ie(r,t,this.prologue,this.crypto,this.staticKeys,s,n);try{await i.propose(),await i.exchange(),await i.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){if(this.metrics?.xxHandshakeErrors.increment(),e instanceof Error)throw e.message=`Error occurred during XX handshake: ${e.message}`,e}return i}async createSecureConnection(e,t){const[r,s]=(0,i.K)(),c=e.unwrap();return await(0,o.z)(r,function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=65519){let s=r+65519;s>n.length&&(s=n.length);const i=e.encrypt(n.subarray(r,s),e.session);t?.encryptedPackets.increment(),yield g(i.byteLength),yield i}}}(t,this.metrics),c,(e=>(0,n.J)(e,{lengthDecoder:m})),function(e,t){return async function*(r){for await(const n of r)for(let r=0;r<n.length;r+=a){let s=r+a;if(s>n.length&&(s=n.length),s-16<r)throw new Error("Invalid chunk");const i=n.subarray(r,s),o=n.subarray(r,s-16),{plaintext:c,valid:h}=e.decrypt(i,e.session,o);if(!h)throw t?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");t?.decryptedPackets.increment(),yield c}}}(t,this.metrics),r),s}}function ce(e={}){return()=>new ae(e)}},882:function(e,t,r){"use strict";function n(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}r.d(t,{J:function(){return n}})},78238:function(e,t,r){"use strict";r.d(t,{pX:function(){return n}});class n{n;bytes;view;constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}},22378:function(e,t,r){"use strict";r.d(t,{Jz:function(){return n},_q:function(){return o},nh:function(){return i}});var n,s,i,o,a=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(n||(n={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(s||(s={})),function(e){e.codec=()=>(0,a.Ji)(s)}(n||(n={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,a.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),n.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:r.Type=n.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,a.LE)(t,e.codec()),e.decode=t=>(0,a.C6)(t,e.codec())}(i||(i={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,a.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),n.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:r.Type=n.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,a.LE)(t,e.codec()),e.decode=t=>(0,a.C6)(t,e.codec())}(o||(o={}))},91921:function(e,t,r){"use strict";r.d(t,{K:function(){return i}});var n=r(85275);function s(){const e=(0,n.Z)();let t=!1;return{sink:async r=>{if(t)throw new Error("already piped");t=!0,e.resolve(r)},source:async function*(){const t=await e.promise;yield*t}()}}function i(){const e=s(),t=s();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}},69350:function(e,t,r){"use strict";r.r(t),r.d(t,{base32:function(){return s},base32hex:function(){return c},base32hexpad:function(){return u},base32hexpadupper:function(){return l},base32hexupper:function(){return h},base32pad:function(){return o},base32padupper:function(){return a},base32upper:function(){return i},base32z:function(){return d}});var n=r(20038);const s=(0,n.ET)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),i=(0,n.ET)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o=(0,n.ET)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a=(0,n.ET)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),c=(0,n.ET)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),h=(0,n.ET)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),u=(0,n.ET)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),l=(0,n.ET)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d=(0,n.ET)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},97565:function(e,t,r){"use strict";r.r(t),r.d(t,{base58btc:function(){return s},base58flickr:function(){return i}});var n=r(20038);const s=(0,n.kU)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),i=(0,n.kU)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},18160:function(e,t,r){"use strict";r.d(t,{BB:function(){return o},fS:function(){return n},mL:function(){return i},oQ:function(){return s}});new Uint8Array(0);const n=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},s=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},i=e=>(new TextEncoder).encode(e),o=e=>(new TextDecoder).decode(e)},85107:function(e,t,r){"use strict";r.d(t,{k0:function(){return l}});var n=r(69350),s=r(97565),i=r(18160),o=r(82094),a=r(52762);const c=(e,t)=>{const{bytes:r,version:i}=e;return 0===i?f(r,u(e),t||s.base58btc.encoder):p(r,u(e),t||n.base32.encoder)},h=new WeakMap,u=e=>{const t=h.get(e);if(null==t){const t=new Map;return h.set(e,t),t}return t};class l{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==g)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==m)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return l.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=o.Ue(e,t);return l.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return l.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&o.fS(e.multihash,r.multihash)}toString(e){return c(this,e)}toJSON(){return{"/":c(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof l)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new l(e,r,n,s||y(e,r,n.bytes))}if(!0===t[b]){const{version:e,multihash:r,code:n}=t,s=o.Jx(r);return l.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==g)throw new Error(`Version 0 CID must use dag-pb (code: ${g}) block encoding`);return new l(e,t,r,r.bytes);case 1:{const n=y(e,t,r.bytes);return new l(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return l.create(0,g,e)}static createV1(e,t){return l.create(1,e,t)}static decode(e){const[t,r]=l.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=l.inspectBytes(e),r=t.size-t.multihashSize,n=(0,i.oQ)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),a=new o.zZ(t.multihashCode,t.digestSize,s,n);return[0===t.version?l.createV0(a):l.createV1(t.codec,a),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=a.Jx(e.subarray(t));return t+=n,r};let n=r(),s=g;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),c=r(),h=t+c;return{version:n,codec:s,multihashCode:o,digestSize:c,multihashSize:h-i,size:h}}static parse(e,t){const[r,n]=d(e,t),s=l.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return u(s).set(r,e),s}}const d=(e,t)=>{switch(e[0]){case"Q":{const r=t||s.base58btc;return[s.base58btc.prefix,r.decode(`${s.base58btc.prefix}${e}`)]}case s.base58btc.prefix:{const r=t||s.base58btc;return[s.base58btc.prefix,r.decode(e)]}case n.base32.prefix:{const r=t||n.base32;return[n.base32.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},f=(e,t,r)=>{const{prefix:n}=r;if(n!==s.base58btc.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const s=r.encode(e).slice(1);return t.set(n,s),s}return i},p=(e,t,r)=>{const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s},g=112,m=18,y=(e,t,r)=>{const n=a.P$(e),s=n+a.P$(t),i=new Uint8Array(s+r.byteLength);return a.mL(e,i,0),a.mL(t,i,n),i.set(r,s),i},b=Symbol.for("@ipld/js-cid/CID")},82094:function(e,t,r){"use strict";r.d(t,{Jx:function(){return o},Ue:function(){return i},fS:function(){return a},zZ:function(){return c}});var n=r(18160),s=r(52762);const i=(e,t)=>{const r=t.byteLength,n=s.P$(e),i=n+s.P$(r),o=new Uint8Array(i+r);return s.mL(e,o,0),s.mL(r,o,n),o.set(t,i),new c(e,r,t,o)},o=e=>{const t=(0,n.oQ)(e),[r,i]=s.Jx(t),[o,a]=s.Jx(t.subarray(i)),h=t.subarray(i+a);if(h.byteLength!==o)throw new Error("Incorrect length");return new c(r,o,h,t)},a=(e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,n.fS)(e.bytes,r.bytes)}};class c{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}},55443:function(e,t,r){"use strict";r.r(t),r.d(t,{identity:function(){return o}});var n=r(18160),s=r(82094);const i=n.oQ,o={code:0,name:"identity",encode:i,digest:e=>s.Ue(0,i(e))}},43846:function(e,t,r){"use strict";r.r(t),r.d(t,{sha256:function(){return i},sha512:function(){return o}});var n=r(66838);const s=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),i=(0,n.D)({name:"sha2-256",code:18,encode:s("SHA-256")}),o=(0,n.D)({name:"sha2-512",code:19,encode:s("SHA-512")})},52762:function(e,t,r){"use strict";r.d(t,{Jx:function(){return v},mL:function(){return _},P$:function(){return E}});var n=function e(t,r,n){r=r||[];var a=n=n||0;for(;t>=o;)r[n++]=255&t|s,t/=128;for(;t&i;)r[n++]=255&t|s,t>>>=7;return r[n]=0|t,e.bytes=n-a+1,r},s=128,i=-128,o=Math.pow(2,31);var a=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&h)<<i:(n&h)*Math.pow(2,i),i+=7}while(n>=c);return e.bytes=o-r,s},c=128,h=127;var u=Math.pow(2,7),l=Math.pow(2,14),d=Math.pow(2,21),f=Math.pow(2,28),p=Math.pow(2,35),g=Math.pow(2,42),m=Math.pow(2,49),y=Math.pow(2,56),b=Math.pow(2,63),w={encode:n,decode:a,encodingLength:function(e){return e<u?1:e<l?2:e<d?3:e<f?4:e<p?5:e<g?6:e<m?7:e<y?8:e<b?9:10}};const v=(e,t=0)=>[w.decode(e,t),w.decode.bytes],_=(e,t,r=0)=>(w.encode(e,t,r),t),E=e=>w.encodingLength(e)},48430:function(e,t,r){"use strict";var n=r(48882),s=r(81613);function i(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const o=i("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),a=i("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{e=e.substring(1);const t=(0,s.E)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),c={utf8:o,"utf-8":o,hex:n.gh.base16,latin1:a,ascii:a,binary:a,...n.gh};t.Z=c},16397:function(e,t,r){"use strict";r.d(t,{P:function(){return K}});var n=r(49541),s=r(11227),i=r(10468),o=r(10360),a=r(40917);function c(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return s.enabled(`${e}:trace`)&&null!=s.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=s(`${e}:trace`)),Object.assign(s(e),{error:s(`${e}:error`),trace:t})}s.formatters.b=e=>null==e?"undefined":o.i.baseEncode(e),s.formatters.t=e=>null==e?"undefined":i.pJ.baseEncode(e),s.formatters.m=e=>null==e?"undefined":a.US.baseEncode(e),s.formatters.p=e=>null==e?"undefined":e.toString(),s.formatters.c=e=>null==e?"undefined":e.toString(),s.formatters.k=e=>null==e?"undefined":e.toString(),s.formatters.a=e=>null==e?"undefined":e.toString();class h extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}var u=r(7326);function l(e,t,r){const n=r??{},s=(0,u.A)(e);return async function*(){let r;const i=()=>{null!=r&&r()};for(t.addEventListener("abort",i);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new h(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new h(e,r))}}));o=await Promise.race([e,s.next()]),r=null}catch(r){t.removeEventListener("abort",i);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",i)}()}var d=r(90212),f=r(85275),p=r(74024);class g extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function m(e,t){let r,n,s,i=(t=t??{}).onEnd,o=new p.u,a=(0,f.Z)();const c=e=>null!=n?n(e):(o.push(e),r),h=e=>{if(s)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},u=e=>s?r:(s=!0,null!=e?(e=>(o=new p.u,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?s?{done:!0}:await new Promise(((t,s)=>{n=i=>{n=null,o.push(i);try{t(e(o))}catch(e){s(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,f.Z)()}))}},return:()=>(o=new p.u,u(),{done:!0}),throw:e=>(u(e),{done:!0}),push:h,end:u,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new g)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==i)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=i&&(i(e),i=void 0),{done:!0}),return:()=>(l.return(),null!=i&&(i(),i=void 0),{done:!0}),push:h,end:e=>(l.end(e),null!=i&&(i(e),i=void 0),r),get readableLength(){return l.readableLength}},r}const y="ERR_INVALID_FRAME",b="ERR_UNREQUESTED_PING",w="ERR_NOT_MATCHING_PING",v="ERR_STREAM_ALREADY_EXISTS",_="ERR_DECODE_INVALID_VERSION",E="ERR_BOTH_CLIENTS",k="ERR_RECV_WINDOW_EXCEEDED",S=new Set([y,b,w,v,_,E,k]),x="ERR_INVALID_CONFIG",I="ERR_MUXER_LOCAL_CLOSED",T="ERR_MUXER_REMOTE_CLOSED",A=262144,D={log:c("libp2p:yamux"),enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:A,maxStreamWindowSize:16777216,maxMessageSize:65536};var P,C,M=r(62308);!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(P||(P={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(C||(C={}));const R=Object.values(C).filter((e=>"string"!=typeof e));var O;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}(O||(O={}));function N(e){const t=R.filter((t=>(e.flag&t)===t)).map((e=>C[e])).join("|");return`streamID=${e.streamID} type=${P[e.type]} flag=${t} length=${e.length}`}const B=2**24;class L{source;buffer;frameInProgress;constructor(e){this.source=function(e){if(void 0!==e[Symbol.iterator]){const t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw new Error("a source must be either an iterable or an async iterable")}(e),this.buffer=new M.H,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const e=this.readHeader();if(void 0===e)break;const{type:t,length:r}=e;t===P.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,r)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new n.sv("decoding frame already in progress","ERR_DECODE_IN_PROGRESS");if(this.buffer.length<12)return;const e=function(e){if(0!==e[0])throw new n.sv("Invalid frame version",_);return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*B+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*B+(e[9]<<16)+(e[10]<<8)+e[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),e}async readBytes(e){if(this.buffer.length<e)for await(const t of this.source)if(this.buffer.append(t),this.buffer.length>=e)break;const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function z(e){const t=new Uint8Array(12);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}var U,F=r(6146),j=r(44263);!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(U||(U={}));class V extends F.b{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(e){super({...e,onEnd:t=>{this.state=U.Finished,e.onEnd?.(t)}}),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=A,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=(0,j.Z)(this.source,(()=>{this.sendWindowUpdate()}))}async sendNewStream(){}async sendData(e,t={}){for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&await this.waitForSendWindowCapacity(t),"open"!==this.status)return;const r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,e.length),n=this.getSendFlags();this.sendFrame({type:P.Data,flag:n,streamID:this._id,length:r},e.subarray(0,r)),this.sendWindowCapacity-=r,e.consume(r)}}async sendReset(){this.sendFrame({type:P.WindowUpdate,flag:C.RST,streamID:this._id,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|C.FIN;this.sendFrame({type:P.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(e={}){if(this.sendWindowCapacity>0)return;let t,r;const s=()=>{"open"===this.status?r(new n.sv("stream aborted","ERR_STREAM_ABORT")):t()};e.signal?.addEventListener("abort",s);try{await new Promise(((e,n)=>{this.sendWindowCapacityUpdate=()=>{e()},r=n,t=e}))}finally{e.signal?.removeEventListener("abort",s)}}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);const t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,0===t&&e.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(e,t){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new n.sv("receive window exceeded",k,{available:this.recvWindowCapacity,recv:e.length});const r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&C.ACK)===C.ACK&&this.state===U.SYNSent&&(this.state=U.Established),(e&C.FIN)===C.FIN&&this.remoteCloseWrite(),(e&C.RST)===C.RST&&this.reset()}getSendFlags(){switch(this.state){case U.Init:return this.state=U.SYNSent,C.SYN;case U.SYNReceived:return this.state=U.Established,C.ACK;default:return 0}}sendWindowUpdate(){const e=this.getSendFlags(),t=Date.now(),r=this.getRTT();if(0===e&&r>0&&t-this.epochStart<4*r&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;const n=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:P.WindowUpdate,flag:e,streamID:this._id,length:n})}}const W="/yamux/1.0.0";class ${protocol=W;_init;constructor(e={}){this._init=e}createStreamMuxer(e){return new q({...this._init,...e})}}class q{protocol=W;source;sink;config;log;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e){this.client="outbound"===e.direction,this.config={...D,...e},this.log=this.config.log,function(e){if(e.keepAliveInterval<=0)throw new n.sv("keep-alive interval must be positive",x);if(e.maxInboundStreams<0)throw new n.sv("max inbound streams must be larger or equal 0",x);if(e.maxOutboundStreams<0)throw new n.sv("max outbound streams must be larger or equal 0",x);if(e.initialStreamWindowSize<A)throw new n.sv("InitialStreamWindowSize must be larger or equal 256 kB",x);if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new n.sv("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",x);if(e.maxStreamWindowSize>2**32-1)throw new n.sv("MaxStreamWindowSize must be less than equal MAX_UINT32",x);if(e.maxMessageSize<1024)throw new n.sv("MaxMessageSize must be greater than a kilobyte",x)}(this.config),this.closeController=new AbortController,this.onIncomingStream=e.onIncomingStream,this.onStreamEnd=e.onStreamEnd,this._streams=new Map,this.source=function(e={}){return m((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach((e=>{e.destroy()}))}}),this.sink=async e=>{let t,r;e=l(e,this.closeController.signal,{returnOnAbort:!0});try{const r=new L(e);await(0,d.z)(r.emitFrames.bind(r),(async e=>{for await(const{header:t,readData:r}of e)await this.handleFrame(t,r)})),t=O.NormalTermination}catch(e){const n=e.code;S.has(n)?(this.log?.error("protocol error in sink",e),t=O.ProtocolError):(this.log?.error("internal error in sink",e),t=O.InternalError),r=e}this.log?.trace("muxer sink ended"),null!=r?this.abort(r,t):await this.close({reason:t})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=0,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch((e=>this.log?.error("keepalive error: %s",e)))}get streams(){return Array.from(this._streams.values())}newStream(e){if(void 0!==this.remoteGoAway)throw new n.sv("muxer closed remotely",T);if(void 0!==this.localGoAway)throw new n.sv("muxer closed locally",I);const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new n.sv("max outbound streams exceeded","ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED");this.log?.trace("new outgoing stream id=%s",t);const r=this._newStream(t,e,U.Init,"outbound");return this._streams.set(t,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new n.sv("muxer closed remotely",T);if(void 0!==this.localGoAway)throw new n.sv("muxer closed locally",I);if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise(((t,r)=>{const s=()=>{r(new n.sv("muxer closed locally",I))};this.closeController.signal.addEventListener("abort",s,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",s),t()}})),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const r=Date.now();this.rtt=r-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.closeController.signal.aborted)return;const t=e?.reason??O.NormalTermination;this.log?.trace("muxer close reason=%s",t),e.signal=e.signal??AbortSignal.timeout(500);try{await Promise.all([...this._streams.values()].map((async t=>t.close(e)))),this.sendGoAway(t),this._closeMuxer()}catch(e){this.abort(e)}}abort(e,t){if(!this.closeController.signal.aborted){t=t??O.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e);for(const t of this._streams.values())t.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,r,s){if(null!=this._streams.get(e))throw new n.sv("Stream already exists",v,{id:e});const i=new V({id:e.toString(),name:t,state:r,direction:s,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(i)},log:c(`libp2p:yamux:${s}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){const e=new Promise(((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})}));for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise((e=>{t=setTimeout(e,this.config.keepAliveInterval)}))]),this.ping().catch((e=>this.log?.error("ping error: %s",e)))}catch(e){return void clearInterval(t)}}}async handleFrame(e,t){const{streamID:r,type:s,length:i}=e;if(this.log?.trace("received frame %s",N(e)),0===r)switch(s){case P.Ping:return void this.handlePing(e);case P.GoAway:return void this.handleGoAway(i);default:throw new n.sv("Invalid frame type",y,{header:e})}else switch(e.type){case P.Data:case P.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new n.sv("Invalid frame type",y,{header:e})}}handlePing(e){if(e.flag===C.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,C.ACK);else{if(e.flag!==C.ACK)throw new n.sv("Invalid frame flag",y,{header:e});this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length)}}handlePingResponse(e){if(void 0===this.activePing)throw new n.sv("ping not requested",b);if(this.activePing.id!==e)throw new n.sv("ping doesn't match our id",w);this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",O[e]??"unknown"),this.remoteGoAway=e;for(const e of this._streams.values())e.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:r,flag:n,type:s}=e;(n&C.SYN)===C.SYN&&this.incomingStream(r);const i=this._streams.get(r);if(void 0!==i)switch(s){case P.WindowUpdate:return void i.handleWindowUpdate(e);case P.Data:if(void 0===t)throw new Error("unreachable");return void await i.handleData(e,t);default:throw new Error("unreachable")}else if(s===P.Data){if(this.log?.("discarding data for stream id=%s",r),void 0===t)throw new Error("unreachable");await t()}else this.log?.("frame for missing stream id=%s",r)}incomingStream(e){if(this.client!==(e%2==0))throw new n.sv("both endpoints are clients",E);if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:P.WindowUpdate,flag:C.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return this.log?.("maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:P.WindowUpdate,flag:C.RST,streamID:e,length:0});const t=this._newStream(e,void 0,U.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %s",N(e)),e.type===P.Data){if(void 0===t)throw new n.sv("invalid frame",y);this.source.push(z(e)),this.source.push(t)}else this.source.push(z(e))}sendPing(e,t=C.SYN){t===C.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:P.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=O.NormalTermination){this.log?.("sending GoAway reason=%s",O[e]),this.localGoAway=e,this.sendFrame({type:P.GoAway,flag:0,streamID:0,length:e})}}function K(e={}){return()=>new $(e)}},7326:function(e,t,r){"use strict";function n(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}r.d(t,{A:function(){return n}})},44263:function(e,t,r){"use strict";var n=r(75671);t.Z=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r),yield r}();const r=(0,n.Z)(e),{value:s,done:i}=r.next();if(!0===i)return function*(){}();const o=t(s);if("function"==typeof o?.then)return async function*(){yield s;for await(const e of r)await t(e),yield e}();const a=t;return function*(){yield s;for(const e of r)a(e),yield e}()}},74024:function(e,t,r){"use strict";r.d(t,{u:function(){return s}});class n{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class s{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new n(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}},53184:function(e,t,r){"use strict";r.d(t,{Y4:function(){return Ss}});var n={};r.r(n),r.d(n,{code:function(){return S},decode:function(){return I},encode:function(){return x},name:function(){return k}});var s=r(32114);var i=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t};var o=function(e,t=1){return t=Number(t),null!=e[Symbol.asyncIterator]?async function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for await(const n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}():function*(){let r=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for(const n of e)for(r.push(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length>0;)yield r.slice(0,t),r=r.slice(t)}()};async function*a(e,t=1){for await(const r of o(e,t)){const e=r.map((async e=>e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const r=await e[t];if(!r.ok)throw r.err;yield r.value}}}var c=r(62308);const h=(e={})=>{const t=e.chunkSize??262144;return async function*(e){let r=new c.H,n=0,s=!1;for await(const i of e)for(r.append(i),n+=i.length;n>=t;)if(yield r.slice(0,t),s=!0,t===r.length)r=new c.H,n=0;else{const e=new c.H;e.append(r.sublist(t)),r=e,n-=t}(!s||n>0)&&(yield r.subarray(0,n))}};var u,l,d,f=r(33808),p=r(46888);!function(e){let t,r,n;!function(e){e.Raw="Raw",e.Directory="Directory",e.File="File",e.Metadata="Metadata",e.Symlink="Symlink",e.HAMTShard="HAMTShard"}(t=e.DataType||(e.DataType={})),function(e){e[e.Raw=0]="Raw",e[e.Directory=1]="Directory",e[e.File=2]="File",e[e.Metadata=3]="Metadata",e[e.Symlink=4]="Symlink",e[e.HAMTShard=5]="HAMTShard"}(r||(r={})),function(e){e.codec=()=>(0,p.Ji)(r)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==n&&(n=(0,p.yw)(((t,r,n={})=>{if(!1!==n.lengthDelimited&&r.fork(),null!=t.Type&&(r.uint32(8),e.DataType.codec().encode(t.Type,r)),null!=t.Data&&(r.uint32(18),r.bytes(t.Data)),null!=t.filesize&&(r.uint32(24),r.uint64(t.filesize)),null!=t.blocksizes)for(const e of t.blocksizes)r.uint32(32),r.uint64(e);null!=t.hashType&&(r.uint32(40),r.uint64(t.hashType)),null!=t.fanout&&(r.uint32(48),r.uint64(t.fanout)),null!=t.mode&&(r.uint32(56),r.uint32(t.mode)),null!=t.mtime&&(r.uint32(66),l.codec().encode(t.mtime,r)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={blocksizes:[]},s=null==r?t.len:t.pos+r;for(;t.pos<s;){const r=t.uint32();switch(r>>>3){case 1:n.Type=e.DataType.codec().decode(t);break;case 2:n.Data=t.bytes();break;case 3:n.filesize=t.uint64();break;case 4:n.blocksizes.push(t.uint64());break;case 5:n.hashType=t.uint64();break;case 6:n.fanout=t.uint64();break;case 7:n.mode=t.uint32();break;case 8:n.mtime=l.codec().decode(t,t.uint32());break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(u||(u={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,p.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(l||(l={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,p.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},n=null==t?e.len:e.pos+t;for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.MimeType=e.string();else e.skipType(7&t)}return r}))),t),e.encode=t=>(0,p.LE)(t,e.codec()),e.decode=t=>(0,p.C6)(t,e.codec())}(d||(d={}));const g={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},m=["directory","hamt-sharded-directory"],y=parseInt("0644",8),b=parseInt("0755",8);class w{static unmarshal(e){const t=u.decode(e),r=new w({type:g[null!=t.Type?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:null!=t.mtime?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return r._originalMode=t.mode??0,r}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){const{type:t,data:r,blockSizes:n,hashType:i,fanout:o,mtime:a,mode:c}=e;if(null!=t&&!Object.values(g).includes(t))throw s(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t??"file",this.data=r,this.hashType=i,this.fanout=o,this.blockSizes=n??[],this._originalMode=0,this.mode=c,this.mtime=a}set mode(e){this._mode=null==e?this.isDirectory()?b:y:4095&e}get mode(){return this._mode}isDirectory(){return m.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach((t=>{e+=t})),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=u.DataType.Raw;break;case"directory":e=u.DataType.Directory;break;case"file":e=u.DataType.File;break;case"metadata":e=u.DataType.Metadata;break;case"symlink":e=u.DataType.Symlink;break;case"hamt-sharded-directory":e=u.DataType.HAMTShard;break;default:throw s(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let t,r,n=this.data;return null!=this.data&&0!==this.data.length||(n=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(this.mode??0),t!==y||this.isDirectory()||(t=void 0),t===b&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(r={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),u.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:r})}}const v=new Uint8Array(0),_=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):v},E=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},k="raw",S=85,x=e=>E(e),I=e=>E(e);var T=r(43905);var A=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*h+1>>>0,o=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var l=0,d=i-1;(0!==u||l<s)&&-1!==d;d--,l++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=l,t++}if(" "!==e[t]){for(var f=i-s;f!==i&&0===o[f];)f++;for(var p=new Uint8Array(n+(i-f)),g=n;f!==i;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*u+1>>>0,h=new Uint8Array(o);s!==i;){for(var l=t[s],d=0,f=o-1;(0!==l||d<n)&&-1!==f;f--,d++)l+=256*h[f]>>>0,h[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=d,s++}for(var p=o-n;p!==o&&0===h[p];)p++;for(var g=c.repeat(r);p<o;++p)g+=e.charAt(h[p]);return g},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class D{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class P{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return M(this,e)}}class C{constructor(e){this.decoders=e}or(e){return M(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const M=(e,t)=>new C({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class R{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new D(e,t,r),this.decoder=new P(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const O=({name:e,prefix:t,encode:r,decode:n})=>new R(e,t,r,n),N=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=A(r,t);return O({prefix:e,name:t,encode:n,decode:e=>E(s(e))})},B=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>O({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,h=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),L=B({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),z=(B({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),B({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),B({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),B({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),B({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),B({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),B({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),B({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),N({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));N({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var U=function e(t,r,n){r=r||[];var s=n=n||0;for(;t>=V;)r[n++]=255&t|F,t/=128;for(;t&j;)r[n++]=255&t|F,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},F=128,j=-128,V=Math.pow(2,31);var W=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&q)<<i:(n&q)*Math.pow(2,i),i+=7}while(n>=$);return e.bytes=o-r,s},$=128,q=127;var K=Math.pow(2,7),H=Math.pow(2,14),G=Math.pow(2,21),J=Math.pow(2,28),Z=Math.pow(2,35),Q=Math.pow(2,42),Y=Math.pow(2,49),X=Math.pow(2,56),ee=Math.pow(2,63),te={encode:U,decode:W,encodingLength:function(e){return e<K?1:e<H?2:e<G?3:e<J?4:e<Z?5:e<Q?6:e<Y?7:e<X?8:e<ee?9:10}};const re=(e,t=0)=>[te.decode(e,t),te.decode.bytes],ne=(e,t,r=0)=>(te.encode(e,t,r),t),se=e=>te.encodingLength(e),ie=(e,t)=>{const r=t.byteLength,n=se(e),s=n+se(r),i=new Uint8Array(s+r);return ne(e,i,0),ne(r,i,n),i.set(t,s),new ae(e,r,t,i)},oe=e=>{const t=E(e),[r,n]=re(t),[s,i]=re(t.subarray(n)),o=t.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new ae(r,s,o,t)};class ae{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const ce=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?fe(r,ue(e),t||z.encoder):pe(r,ue(e),t||L.encoder)},he=new WeakMap,ue=e=>{const t=he.get(e);if(null==t){const t=new Map;return he.set(e,t),t}return t};class le{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ge)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==me)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return le.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=ie(e,t);return le.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return le.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return ce(this,e)}toJSON(){return{"/":ce(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof le)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new le(e,r,n,s||ye(e,r,n.bytes))}if(!0===t[be]){const{version:e,multihash:r,code:n}=t,s=oe(r);return le.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==ge)throw new Error(`Version 0 CID must use dag-pb (code: ${ge}) block encoding`);return new le(e,t,r,r.bytes);case 1:{const n=ye(e,t,r.bytes);return new le(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return le.create(0,ge,e)}static createV1(e,t){return le.create(1,e,t)}static decode(e){const[t,r]=le.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=le.inspectBytes(e),r=t.size-t.multihashSize,n=E(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new ae(t.multihashCode,t.digestSize,s,n);return[0===t.version?le.createV0(i):le.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=re(e.subarray(t));return t+=n,r};let n=r(),s=ge;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=de(e,t),s=le.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return ue(s).set(r,e),s}}const de=(e,t)=>{switch(e[0]){case"Q":{const r=t||z;return[z.prefix,r.decode(`${z.prefix}${e}`)]}case z.prefix:{const r=t||z;return[z.prefix,r.decode(e)]}case L.prefix:{const r=t||L;return[L.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},fe=(e,t,r)=>{const{prefix:n}=r;if(n!==z.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const s=r.encode(e).slice(1);return t.set(n,s),s}return s},pe=(e,t,r)=>{const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s},ge=112,me=18,ye=(e,t,r)=>{const n=se(e),s=n+se(t),i=new Uint8Array(s+r.byteLength);return ne(e,i,0),ne(t,i,n),i.set(r,s),i},be=Symbol.for("@ipld/js-cid/CID"),we=({name:e,code:t,encode:r})=>new ve(e,t,r);class ve{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ie(this.code,t):t.then((e=>ie(this.code,e)))}throw Error("Unknown type, must be binary type")}}const _e=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ee=we({name:"sha2-256",code:18,encode:_e("SHA-256")}),ke=(we({name:"sha2-512",code:19,encode:_e("SHA-512")}),async(e,t,r)=>{null==r.codec&&(r.codec=f);const n=await Ee.digest(e),s=le.create(r.cidVersion,r.codec.code,n);return await t.put(s,e,r),s});function Se(e){return async function*(t,r){let s=0n;for await(let i of t.content)yield async()=>{let o;const a={codec:f,cidVersion:e.cidVersion,onProgress:e.onProgress};e.rawLeaves?(a.codec=n,a.cidVersion=1):(o=new w({type:e.leafType,data:i}),i=f.encode({Data:o.marshal(),Links:[]}));const c=await ke(i,r,a);return s+=BigInt(i.byteLength),e.onProgress?.(new T.V("unixfs:importer:progress:file:write",{bytesWritten:s,cid:c,path:t.path})),{cid:c,unixfs:o,size:BigInt(i.length),block:i}}}}const xe=async(e,t,r)=>{const n=new w({type:"directory",mtime:e.mtime,mode:e.mode}),s=(0,f.encode)((0,f.prepare)({Data:n.marshal()}));return{cid:await ke(s,t,r),path:e.path,unixfs:n,size:BigInt(s.length),originalPath:e.originalPath,block:s}};function Ie(e){return!0===e.single}const Te=async(e,t,r)=>r.layout(async function*(e,t,r){let n,s=-1;for await(const i of a(r.bufferImporter(e,t),r.blockWriteConcurrency))s++,0!==s?(1===s&&null!=n&&(yield{...n,block:void 0,single:void 0},n=void 0),yield{...i,block:void 0}):n={...i,single:!0};null!=n&&(yield n)}(e,t,r),((e,t,r)=>async function(n){if(1===n.length&&Ie(n[0])&&r.reduceSingleLeafToSelf){const s=n[0];let i=s.block;return!Ie(s)||void 0===e.mtime&&void 0===e.mode||(s.unixfs=new w({type:"file",mtime:e.mtime,mode:e.mode,data:s.block}),i={Data:s.unixfs.marshal(),Links:[]},s.block=(0,f.encode)((0,f.prepare)(i)),s.cid=await ke(s.block,t,{...r,cidVersion:r.cidVersion}),s.size=BigInt(s.block.length)),r.onProgress?.(new T.V("unixfs:importer:progress:file:layout",{cid:s.cid,path:s.originalPath})),{cid:s.cid,path:e.path,unixfs:s.unixfs,size:s.size,originalPath:s.originalPath}}const s=new w({type:"file",mtime:e.mtime,mode:e.mode}),i=n.filter((e=>e.cid.code===S&&e.size>0||null!=e.unixfs&&null==e.unixfs.data&&e.unixfs.fileSize()>0n||Boolean(e.unixfs?.data?.length))).map((e=>e.cid.code===S?(s.addBlockSize(e.size),{Name:"",Tsize:Number(e.size),Hash:e.cid}):(null==e.unixfs||null==e.unixfs.data?s.addBlockSize(e.unixfs?.fileSize()??0n):s.addBlockSize(BigInt(e.unixfs.data.length)),{Name:"",Tsize:Number(e.size),Hash:e.cid}))),o={Data:s.marshal(),Links:i},a=(0,f.encode)((0,f.prepare)(o)),c=await ke(a,t,r);return r.onProgress?.(new T.V("unixfs:importer:progress:file:layout",{cid:c,path:e.originalPath})),{cid:c,path:e.path,unixfs:s,size:BigInt(a.length+o.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),originalPath:e.originalPath,block:a}})(e,t,r));function Ae(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(t=e,Symbol.iterator in t)return async function*(){yield*e}();if(function(e){return Symbol.asyncIterator in e}(e))return e}catch{throw s(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}var t;throw s(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function De(e){return null!=e.content}var Pe=r(77408);const Ce=()=>async function*(e){for await(const t of e){if(void 0===t.length)throw s(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"==typeof t||t instanceof String)yield(0,Pe.m)(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw s(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}},Me=174;function Re(e){const t=e?.maxChildrenPerNode??Me;return async function e(r,n){const s=[];for await(const e of o(r,t))s.push(await n(e));return s.length>1?e(s,n):s[0]}}class Oe{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}const Ne=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Be=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class Le extends Oe{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(void 0!==this.nodeSize)return this.nodeSize;this.nodeSize=0;for(const[e,t]of this._children.entries())null!=t.size&&null!=t.cid&&(this.nodeSize+=e.length+(1===this.options.cidVersion?Be.bytes.byteLength:Ne.bytes.byteLength));return this.nodeSize}async*flush(e){const t=[];for(const[r,n]of this._children.entries()){let s=n;if(n instanceof Oe)for await(const t of n.flush(e))s=t,yield t;null!=s.size&&null!=s.cid&&t.push({Name:r,Tsize:Number(s.size),Hash:s.cid})}const r=new w({type:"directory",mtime:this.mtime,mode:this.mode}),n={Data:r.marshal(),Links:t},s=(0,f.encode)((0,f.prepare)(n)),i=await ke(s,e,this.options),o=s.length+n.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=i,this.size=o,yield{cid:i,unixfs:r,path:this.path,size:BigInt(o)}}}const ze=new Uint8Array(0),Ue=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):ze};var Fe=function e(t,r,n){r=r||[];var s=n=n||0;for(;t>=We;)r[n++]=255&t|je,t/=128;for(;t&Ve;)r[n++]=255&t|je,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},je=128,Ve=-128,We=Math.pow(2,31);var $e=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&Ke)<<i:(n&Ke)*Math.pow(2,i),i+=7}while(n>=qe);return e.bytes=o-r,s},qe=128,Ke=127;var He=Math.pow(2,7),Ge=Math.pow(2,14),Je=Math.pow(2,21),Ze=Math.pow(2,28),Qe=Math.pow(2,35),Ye=Math.pow(2,42),Xe=Math.pow(2,49),et=Math.pow(2,56),tt=Math.pow(2,63),rt={encode:Fe,decode:$e,encodingLength:function(e){return e<He?1:e<Ge?2:e<Je?3:e<Ze?4:e<Qe?5:e<Ye?6:e<Xe?7:e<et?8:e<tt?9:10}};const nt=(e,t,r=0)=>(rt.encode(e,t,r),t),st=e=>rt.encodingLength(e),it=(e,t)=>{const r=t.byteLength,n=st(e),s=n+st(r),i=new Uint8Array(s+r);return nt(e,i,0),nt(r,i,n),i.set(t,s),new ot(e,r,t,i)};class ot{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const at=({name:e,code:t,encode:r})=>new ct(e,t,r);class ct{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?it(this.code,t):t.then((e=>it(this.code,e)))}throw Error("Unknown type, must be binary type")}}var ht=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*h+1>>>0,o=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var l=0,d=i-1;(0!==u||l<s)&&-1!==d;d--,l++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=l,t++}if(" "!==e[t]){for(var f=i-s;f!==i&&0===o[f];)f++;for(var p=new Uint8Array(n+(i-f)),g=n;f!==i;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*u+1>>>0,h=new Uint8Array(o);s!==i;){for(var l=t[s],d=0,f=o-1;(0!==l||d<n)&&-1!==f;f--,d++)l+=256*h[f]>>>0,h[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=d,s++}for(var p=o-n;p!==o&&0===h[p];)p++;for(var g=c.repeat(r);p<o;++p)g+=e.charAt(h[p]);return g},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class ut{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class lt{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ft(this,e)}}class dt{constructor(e){this.decoders=e}or(e){return ft(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ft=(e,t)=>new dt({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class pt{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new ut(e,t,r),this.decoder=new lt(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const gt=({name:e,prefix:t,encode:r,decode:n})=>new pt(e,t,r,n),mt=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=ht(r,t);return gt({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(s(e))})},yt=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>gt({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,h=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)});mt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),yt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),yt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),yt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),new WeakMap;class bt{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return bt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return bt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return bt.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return cid_format(this,e)}toJSON(){return{"/":cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof bt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new bt(e,r,n,s||cid_encodeCID(e,r,n.bytes))}if(!0===t[cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,s=Digest.decode(r);return bt.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new bt(e,t,r,r.bytes);case 1:{const n=cid_encodeCID(e,t,r.bytes);return new bt(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return bt.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return bt.create(1,e,t)}static decode(e){const[t,r]=bt.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=bt.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new Digest.Digest(t.multihashCode,t.digestSize,s,n);return[0===t.version?bt.createV0(i):bt.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),s=cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=cid_parseCIDtoBytes(e,t),s=bt.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return cid_baseCache(s).set(r,e),s}}Symbol.for("@ipld/js-cid/CID");var wt=r(40469);at({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const vt=at({name:"murmur3-128",code:34,encode:e=>Ue(wt.x64.hash128(e))});at({name:"murmur3-x64-64",code:34,encode:e=>Ue(wt.x64.hash128(e)).subarray(0,8)});var _t=r(96991);async function Et(e){return(await vt.encode(e)).slice(0,8).reverse()}const kt=BigInt(34);var St=class extends Oe{_bucket;constructor(e,t){super(e,t),this._bucket=(0,_t.$)({hashFn:Et,bits:t.shardFanoutBits??8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=It(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of xt(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*xt(e,t,r,n){const s=e._children,i=(e.tableSize()-1).toString(16).length,o=[];let a=0n;for(let e=0;e<s.length;e++){const r=s.get(e);if(null==r)continue;const c=e.toString(16).toUpperCase().padStart(i,"0");if(r instanceof _t.r){let e;for await(const s of xt(r,t,null,n))e=s;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:c,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;if(null==n)throw new Error("Did not flush dir");const s=c+r.key;o.push({Name:s,Tsize:Number(n.size),Hash:n.cid}),a+=n.size}else{const e=r.value;if(null==e.cid)continue;const t=c+r.key,n=e.size;o.push({Name:t,Tsize:Number(n),Hash:e.cid}),a+=BigInt(n??0)}}const c=Uint8Array.from(s.bitField().reverse()),h=new w({type:"hamt-sharded-directory",data:c,fanout:BigInt(e.tableSize()),hashType:kt,mtime:r?.mtime,mode:r?.mode}),u={Data:h.marshal(),Links:o},l=(0,f.encode)((0,f.prepare)(u)),d=await ke(l,t,n),p=BigInt(l.byteLength)+a;yield{cid:d,unixfs:h,size:p}}function It(e,t,r){const n=e._children,s=(e.tableSize()-1).toString(16).length,i=[];for(let e=0;e<n.length;e++){const t=n.get(e);if(null==t)continue;const o=e.toString(16).toUpperCase().padStart(s,"0");if(t instanceof _t.r){const e=It(t,null,r);i.push({Name:o,Tsize:Number(e),Hash:0===r.cidVersion?Ne:Be})}else if("function"==typeof t.value.flush){const e=t.value.nodeSize();i.push({Name:o+t.key,Tsize:Number(e),Hash:0===r.cidVersion?Ne:Be})}else{const e=t.value;if(null==e.cid)continue;const r=o+t.key,n=e.size;i.push({Name:r,Tsize:Number(n),Hash:e.cid})}}const o=Uint8Array.from(n.bitField().reverse()),a=new w({type:"hamt-sharded-directory",data:o,fanout:BigInt(e.tableSize()),hashType:kt,mtime:t?.mtime,mode:t?.mode});return(0,f.encode)((0,f.prepare)({Data:a.marshal(),Links:i})).length}async function Tt(e,t,r,n){let s=t;t instanceof Le&&t.estimateNodeSize()>r&&(s=await async function(e,t){const r=new St({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(const{key:t,child:n}of e.eachChildSeries())await r.put(t,n);return r}(t,n));const i=s.parent;if(null!=i){if(s!==t){if(null!=e&&(e.parent=s),null==s.parentKey)throw new Error("No parent key found");await i.put(s.parentKey,s)}return Tt(s,i,r,n)}return s}const At=(e="")=>e.split(/(?<!\\)\//).filter(Boolean);async function Dt(e,t,r){const n=At(e.path??""),s=n.length-1;let i=t,o="";for(let a=0;a<n.length;a++){const c=n[a];o+=`${""!==o?"/":""}${c}`;const h=a===s;if(i.dirty=!0,i.cid=void 0,i.size=void 0,h)await i.put(c,e),t=await Tt(null,i,r.shardSplitThresholdBytes,r);else{let e=await i.get(c);null!=e&&e instanceof Oe||(e=new Le({root:!1,dir:!0,parent:i,parentKey:c,path:o,dirty:!0,flat:!0,mtime:e?.unixfs?.mtime,mode:e?.unixfs?.mode},r)),await i.put(c,e),i=e}}return t}async function*Pt(e,t){e instanceof Oe?yield*e.flush(t):!0===e.unixfs?.isDirectory()&&(yield e)}async function*Ct(e,t,r={}){let n;n=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];const s=r.wrapWithDirectory??!1,i=r.shardSplitThresholdBytes??262144,o=r.shardFanoutBits??8,c=r.cidVersion??1,u=r.rawLeaves??!0,l=r.leafType??"file",d=r.fileImportConcurrency??50,f=r.blockWriteConcurrency??10,p=r.reduceSingleLeafToSelf??!0,g=r.chunker??h(),m=r.chunkValidator??Ce(),y=r.dagBuilder??function(e){return async function*(t,r){for await(const n of t){let t;if(null!=n.path&&(t=n.path,n.path=n.path.split("/").filter((e=>null!=e&&"."!==e)).join("/")),De(n)){const s={path:n.path,mtime:n.mtime,mode:n.mode,content:async function*(){let t=0n;for await(const r of e.chunker(e.chunkValidator(Ae(n.content)))){const s=BigInt(r.byteLength);t+=s,e.onProgress?.(new T.V("unixfs:importer:progress:file:read",{bytesRead:t,chunkSize:s,path:n.path})),yield r}}(),originalPath:t};yield async()=>Te(s,r,e)}else{if(null==n.path)throw new Error("Import candidate must have content or path or both");{const s={path:n.path,mtime:n.mtime,mode:n.mode,originalPath:t};yield async()=>xe(s,r,e)}}}}}({chunker:g,chunkValidator:m,wrapWithDirectory:s,layout:r.layout??Re(),bufferImporter:r.bufferImporter??Se({cidVersion:c,rawLeaves:u,leafType:l,onProgress:r.onProgress}),blockWriteConcurrency:f,reduceSingleLeafToSelf:p,cidVersion:c,onProgress:r.onProgress}),b=r.treeBuilder??function(e){return async function*(t,r){let n,s=new Le({root:!0,dir:!0,path:"",dirty:!0,flat:!0},e),i=!1;for await(const r of t){if(null==r)continue;const t=`${r.originalPath??""}`.split("/")[0];null!=t&&""!==t&&(null==n?(n=t,i=!0):n!==t&&(i=!1)),s=await Dt(r,s,e),null!=r.unixfs&&r.unixfs.isDirectory()||(yield r)}if(e.wrapWithDirectory||i&&s.childCount()>1)yield*Pt(s,r);else for await(const e of s.eachChildSeries())null!=e&&(yield*Pt(e.child,r))}}({wrapWithDirectory:s,shardSplitThresholdBytes:i,shardFanoutBits:o,cidVersion:c,onProgress:r.onProgress});for await(const e of b(a(y(n,t),d),t))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}async function Mt(e,t,r={}){const n=await i(Ct([e],t,r));if(null==n)throw s(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return n}r(63060);const Rt={cidVersion:1,rawLeaves:!0,layout:Re({maxChildrenPerNode:1024}),chunker:h({chunkSize:1048576})};async function Ot(e,t,r={}){const{cid:n}=await async function(e,t,r={}){return Mt({content:e},t,r)}(e,t,{...Rt,...r});return n}async function Nt(e,t,r={}){const{cid:n}=await async function(e,t,r={}){return Mt({content:e},t,r)}(e,t,{...Rt,...r});return n}async function Bt(e,t,r={}){const{cid:n}=await async function(e,t,r={}){const n=await i(Ct([e],t,r));if(null==n)throw s(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return n}({...e,path:e.path??"-"},t,{...Rt,...r});return n}var Lt=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t;for await(const r of e)t=r;return t})();let t;for(const r of e)t=r;return t},zt=r(90560);const Ut=0;var Ft=async(e,t,r,n,i,o,a,c)=>{const h=await a.get(e,c),u=zt.decode(h);let l=u,d=r;for(;n.length>0;){const i=n[0];if(!(i in l))throw s(new Error(`No property named ${i} found in cbor node ${e}`),"ERR_NO_PROP");{n.shift(),d=`${d}/${i}`;const s=le.asCID(l[i]);if(null!=s)return{entry:{type:"object",name:t,path:r,cid:e,node:h,depth:o,size:BigInt(h.length),content:async function*(){yield u}},next:{cid:s,name:i,path:d,toResolve:n}};l=l[i]}}return{entry:{type:"object",name:t,path:r,cid:e,node:h,depth:o,size:BigInt(h.length),content:async function*(){yield u}}}};var jt=function(e,t,r,n){const s=BigInt(e.length),i=BigInt(t+s);return r>=i||n<t?new Uint8Array(0):(n>=t&&n<i&&(e=e.subarray(0,Number(n-t))),r>=t&&r<i&&(e=e.subarray(Number(r-t))),e)};var Vt=(e,t=0,r=e)=>{const n=BigInt(e),i=BigInt(t??0);let o=BigInt(r);if(o!==n&&(o=i+o),o>n&&(o=n),i<0n)throw s(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(i>n)throw s(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(o<0n)throw s(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(o>n)throw s(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:i,end:o}};var Wt=async(e,t,r,n,i,o,a,c)=>{if(n.length>0)throw s(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const h=oe(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:(u=h.digest,async function*(e={}){const{start:t,end:r}=Vt(u.length,e.offset,e.length),n=jt(u,0n,t,r);e.onProgress?.(new T.V("unixfs:exporter:progress:identity",{bytesRead:BigInt(n.byteLength),totalBytes:r-t,fileSize:BigInt(u.byteLength)})),yield n}),depth:o,size:BigInt(h.digest.length),node:h.digest}};var u};var $t=async(e,t,r,n,i,o,a,c)=>{if(n.length>0)throw s(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");const h=await a.get(e,c);return{entry:{type:"raw",name:t,path:r,cid:e,content:(u=h,async function*(e={}){const{start:t,end:r}=Vt(u.length,e.offset,e.length),n=jt(u,0n,t,r);e.onProgress?.(new T.V("unixfs:exporter:progress:raw",{bytesRead:BigInt(n.byteLength),totalBytes:r-t,fileSize:BigInt(u.byteLength)})),yield n}),depth:o,size:BigInt(h.length),node:h}};var u};const qt=new Uint8Array(0),Kt=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):qt};var Ht=function e(t,r,n){r=r||[];var s=n=n||0;for(;t>=Zt;)r[n++]=255&t|Gt,t/=128;for(;t&Jt;)r[n++]=255&t|Gt,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},Gt=128,Jt=-128,Zt=Math.pow(2,31);var Qt=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&Xt)<<i:(n&Xt)*Math.pow(2,i),i+=7}while(n>=Yt);return e.bytes=o-r,s},Yt=128,Xt=127;var er=Math.pow(2,7),tr=Math.pow(2,14),rr=Math.pow(2,21),nr=Math.pow(2,28),sr=Math.pow(2,35),ir=Math.pow(2,42),or=Math.pow(2,49),ar=Math.pow(2,56),cr=Math.pow(2,63),hr={encode:Ht,decode:Qt,encodingLength:function(e){return e<er?1:e<tr?2:e<rr?3:e<nr?4:e<sr?5:e<ir?6:e<or?7:e<ar?8:e<cr?9:10}};const ur=(e,t,r=0)=>(hr.encode(e,t,r),t),lr=e=>hr.encodingLength(e),dr=(e,t)=>{const r=t.byteLength,n=lr(e),s=n+lr(r),i=new Uint8Array(s+r);return ur(e,i,0),ur(r,i,n),i.set(t,s),new fr(e,r,t,i)};class fr{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const pr=({name:e,code:t,encode:r})=>new gr(e,t,r);class gr{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?dr(this.code,t):t.then((e=>dr(this.code,e)))}throw Error("Unknown type, must be binary type")}}var mr=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*h+1>>>0,o=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var l=0,d=i-1;(0!==u||l<s)&&-1!==d;d--,l++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=l,t++}if(" "!==e[t]){for(var f=i-s;f!==i&&0===o[f];)f++;for(var p=new Uint8Array(n+(i-f)),g=n;f!==i;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*u+1>>>0,h=new Uint8Array(o);s!==i;){for(var l=t[s],d=0,f=o-1;(0!==l||d<n)&&-1!==f;f--,d++)l+=256*h[f]>>>0,h[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=d,s++}for(var p=o-n;p!==o&&0===h[p];)p++;for(var g=c.repeat(r);p<o;++p)g+=e.charAt(h[p]);return g},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class yr{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class br{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return vr(this,e)}}class wr{constructor(e){this.decoders=e}or(e){return vr(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const vr=(e,t)=>new wr({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class _r{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new yr(e,t,r),this.decoder=new br(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Er=({name:e,prefix:t,encode:r,decode:n})=>new _r(e,t,r,n),kr=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=mr(r,t);return Er({prefix:e,name:t,encode:n,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(s(e))})},Sr=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Er({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,h=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)});kr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Sr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Sr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Sr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Sr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Sr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Sr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Sr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),new WeakMap;class xr{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return xr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Digest.create(e,t);return xr.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return xr.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&Digest.equals(e.multihash,r.multihash)}toString(e){return src_cid_format(this,e)}toJSON(){return{"/":src_cid_format(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof xr)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new xr(e,r,n,s||src_cid_encodeCID(e,r,n.bytes))}if(!0===t[src_cid_cidSymbol]){const{version:e,multihash:r,code:n}=t,s=Digest.decode(r);return xr.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new xr(e,t,r,r.bytes);case 1:{const n=src_cid_encodeCID(e,t,r.bytes);return new xr(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return xr.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return xr.create(1,e,t)}static decode(e){const[t,r]=xr.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=xr.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new Digest.Digest(t.multihashCode,t.digestSize,s,n);return[0===t.version?xr.createV0(i):xr.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=varint.decode(e.subarray(t));return n,r};let n=r(),s=src_cid_DAG_PB_CODE;if(18===n?(0,0):r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=src_cid_parseCIDtoBytes(e,t),s=xr.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return src_cid_baseCache(s).set(r,e),s}}Symbol.for("@ipld/js-cid/CID");pr({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const Ir=pr({name:"murmur3-128",code:34,encode:e=>Kt(wt.x64.hash128(e))}),Tr=(pr({name:"murmur3-x64-64",code:34,encode:e=>Kt(wt.x64.hash128(e)).subarray(0,8)}),async function(e){return(await Ir.encode(e)).slice(0,8).reverse()}),Ar=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),Dr=async(e,t,r,n,i)=>{if(null==n){if(null==e.Data)throw s(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let t;try{t=w.unmarshal(e.Data)}catch(e){throw s(e,"ERR_NOT_UNIXFS")}if("hamt-sharded-directory"!==t.type)throw s(new Error("not a HAMT"),"ERR_NOT_UNIXFS");if(null==t.fanout)throw s(new Error("missing fanout"),"ERR_NOT_UNIXFS");const r=(0,_t.$)({hashFn:Tr,bits:Math.log2(Number(t.fanout))});n={rootBucket:r,hamtDepth:1,lastBucket:r}}const o=(n.lastBucket.tableSize()-1).toString(16).length;await(async(e,t,r)=>{const n=(t.tableSize()-1).toString(16).length;await Promise.all(e.map((async e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(e.Name.length!==n)await r.put(e.Name.substring(2),!0);else{const n=parseInt(e.Name,16);t._putObjectAt(n,new _t.r({hash:r._options.hash,bits:r._options.bits},t,n))}})))})(e.Links,n.lastBucket,n.rootBucket);const a=await n.rootBucket._findNewBucketAndPos(t);let c=Ar(a.pos,o);const h=(e=>{let t=e.bucket;const r=[];for(;null!=t._parent;)r.push(t),t=t._parent;return r.push(t),r.reverse()})(a);h.length>n.hamtDepth&&(n.lastBucket=h[n.hamtDepth],c=Ar(n.lastBucket._posAtParent,o));const u=e.Links.find((e=>{if(null==e.Name)return!1;const r=e.Name.substring(0,o),n=e.Name.substring(o);return r===c&&(""===n||n===t)}));if(null==u)return;if(null!=u.Name&&u.Name.substring(o)===t)return u.Hash;n.hamtDepth++;const l=await r.get(u.Hash,i);return e=(0,f.decode)(l),Dr(e,t,r,n,i)};var Pr=Dr,Cr=r(75671);var Mr=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,Cr.Z)(e),{value:n,done:s}=r.next();if(!0===s)return function*(){}();const i=t(n);if("function"==typeof i.then)return async function*(){await i&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===i&&(yield n);for(const e of r)o(e)&&(yield e)}()};var Rr=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)yield t(r)}();const r=(0,Cr.Z)(e),{value:n,done:s}=r.next();if(!0===s)return function*(){}();const i=t(n);if("function"==typeof i.then)return async function*(){yield await i;for await(const e of r)yield t(e)}();const o=t;return function*(){yield i;for(const e of r)yield o(e)}()},Or=r(69849),Nr=r(90212);var Br=(e,t,r,n,s,i,o)=>async function*(r={}){const a=r.offset??0,c=r.length??t.Links.length,h=t.Links.slice(a,c);r.onProgress?.(new T.V("unixfs:exporter:walk:directory",{cid:e})),yield*(0,Nr.z)(h,(e=>Rr(e,(e=>async()=>{const t=e.Name??"",a=`${n}/${t}`;return(await s(e.Hash,t,a,[],i+1,o,r)).entry}))),(e=>(0,Or.Z)(e,{ordered:!0})),(e=>Mr(e,(e=>null!=e))))},Lr=r(37430),zr=r(95972);async function Ur(e,t,r,n,i,o,a){if(t instanceof Uint8Array){const e=jt(t,n,i,o);return void r.push(e)}if(null==t.Data)throw s(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=w.unmarshal(t.Data)}catch(e){throw s(e,"ERR_NOT_UNIXFS")}if(null!=c.data){const e=c.data,t=jt(e,n,i,o);r.push(t),n+=BigInt(t.byteLength)}const h=[];if(t.Links.length!==c.blockSizes.length)throw s(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let e=0;e<t.Links.length;e++){const r=t.Links[e],s=n,a=s+c.blockSizes[e];if((i>=s&&i<a||o>=s&&o<=a||i<s&&o>a)&&h.push({link:r,blockStart:n}),(n=a)>o)break}await(0,Nr.z)(h,(t=>Rr(t,(t=>async()=>{const r=await e.get(t.link.Hash,a);return{...t,block:r}}))),(e=>(0,Or.Z)(e,{ordered:!0})),(async t=>{for await(const{link:n,block:c,blockStart:h}of t){let t;switch(n.Hash.code){case f.code:t=f.decode(c);break;case S:t=c;break;default:return void r.end(s(new Error(`Unsupported codec: ${n.Hash.code}`),"ERR_NOT_UNIXFS"))}const u=new zr.Z({concurrency:1});u.on("error",(e=>{r.end(e)})),u.add((async()=>{a.onProgress?.(new T.V("unixfs:exporter:walk:file",{cid:n.Hash})),await Ur(e,t,r,h,i,o,a)})),await u.onIdle()}})),n>=o&&r.end()}var Fr=(e,t,r,n,i,o,a)=>async function*(n={}){const i=r.fileSize();if(void 0===i)throw new Error("File was a directory");const{start:o,end:c}=Vt(i,n.offset,n.length);if(0n===c)return;let h=0n;const u=c-o,l=(0,Lr.d)();n.onProgress?.(new T.V("unixfs:exporter:walk:file",{cid:e})),Ur(a,t,l,0n,o,c,n).catch((e=>{l.end(e)}));for await(const e of l)if(null!=e){if(h+=BigInt(e.byteLength),h>u)throw l.end(),s(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");h===u&&l.end(),n.onProgress?.(new T.V("unixfs:exporter:progress:unixfs:file",{bytesRead:h,totalBytes:u,fileSize:i})),yield e}if(h<u)throw s(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")};async function*jr(e,t,r,n,i,o){const a=e.Links;if(null==e.Data)throw s(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=w.unmarshal(e.Data)}catch(e){throw s(e,"ERR_NOT_UNIXFS")}if(null==c.fanout)throw s(new Error("missing fanout"),"ERR_NOT_UNIXFS");const h=(c.fanout-1n).toString(16).length,u=(0,Nr.z)(a,(s=>Rr(s,(s=>async()=>{const a=null!=s.Name?s.Name.substring(h):null;if(null!=a&&""!==a){const e=await r(s.Hash,a,`${t}/${a}`,[],n+1,i,o);return{entries:null==e.entry?[]:[e.entry]}}{const a=await i.get(s.Hash,o);return e=(0,f.decode)(a),o.onProgress?.(new T.V("unixfs:exporter:walk:hamt-sharded-directory",{cid:s.Hash})),{entries:jr(e,t,r,n,i,o)}}}))),(e=>(0,Or.Z)(e,{ordered:!0})));for await(const{entries:e}of u)yield*e}var Vr=(e,t,r,n,s,i,o)=>function(r={}){return r.onProgress?.(new T.V("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),jr(t,n,s,i,o,r)};const Wr={raw:Fr,file:Fr,directory:Br,"hamt-sharded-directory":Vr,metadata:(e,t,r,n,s,i,o)=>()=>[],symlink:(e,t,r,n,s,i,o)=>()=>[]};var $r=async(e,t,r,n,i,o,a,c)=>{const h=await a.get(e,c),u=(0,f.decode)(h);let l,d;if(null==t&&(t=e.toString()),null==u.Data)throw s(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=w.unmarshal(u.Data)}catch(e){throw s(e,"ERR_NOT_UNIXFS")}if(null==r&&(r=t),n.length>0){let e;if(e="hamt-sharded-directory"===l?.type?await Pr(u,n[0],a):((e,t)=>{const r=e.Links.find((e=>e.Name===t));return r?.Hash})(u,n[0]),null==e)throw s(new Error("file does not exist"),"ERR_NOT_FOUND");const t=n.shift();d={cid:e,toResolve:n,name:t??"",path:`${r}/${t}`}}const p=Wr[l.type](e,u,l,r,i,o,a);if(null==p)throw s(new Error("could not find content exporter"),"ERR_NOT_FOUND");return l.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:p,unixfs:l,depth:o,node:u,size:l.fileSize()},next:d}:{entry:{type:"file",name:t,path:r,cid:e,content:p,unixfs:l,depth:o,node:u,size:l.fileSize()},next:d}};const qr={[f.code]:$r,[S]:$t,[zt.code]:Ft,[Ut]:Wt},Kr=async(e,t,r,n,i,o,a)=>{const c=qr[e.code];if(null==c)throw s(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return c(e,t,r,n,Kr,i,o,a)};var Hr=Kr;const Gr=e=>{if(e instanceof Uint8Array)return{cid:le.decode(e),toResolve:[]};const t=le.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=((e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean))(e);return{cid:le.parse(t[0]),toResolve:t.slice(1)}}throw s(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function Jr(e,t,r={}){const n=await Lt(async function*(e,t,r={}){let{cid:n,toResolve:i}=Gr(e),o=n.toString(),a=o;const c=i.length;for(;;){const h=await Hr(n,o,a,i,c,t,r);if(null==h.entry&&null==h.next)throw s(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(null!=h.entry&&(yield h.entry),null==h.next)return;i=h.next.toResolve,n=h.next.cid,o=h.next.name,a=h.next.path}}(e,t,r));if(null==n)throw s(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}async function*Zr(e,t,r={}){const n=await Jr(e,t,r);if(null!=n&&(yield n,"directory"===n.type))for await(const e of async function*e(t,r){for await(const n of t.content(r))yield n,n instanceof Uint8Array||"directory"===n.type&&(yield*e(n,r))}(n,r))yield e}var Qr=r(79221);class Yr extends Error{name;code;constructor(e,t,r){super(e),this.name=t,this.code=r}}class Xr extends Yr{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}}class en extends Yr{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PBNODE")}}class tn extends Yr{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class rn extends Yr{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}}class nn extends Yr{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}class sn extends Yr{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}}class on extends Yr{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}}class an extends Yr{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}}class cn extends Yr{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}}var hn=r(11227);const un=B({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});B({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),B({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),B({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function ln(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return hn.enabled(`${e}:trace`)&&null!=hn.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=hn(`${e}:trace`)),Object.assign(hn(e),{error:hn(`${e}:error`),trace:t})}hn.formatters.b=e=>null==e?"undefined":z.baseEncode(e),hn.formatters.t=e=>null==e?"undefined":L.baseEncode(e),hn.formatters.m=e=>null==e?"undefined":un.baseEncode(e),hn.formatters.p=e=>null==e?"undefined":e.toString(),hn.formatters.c=e=>null==e?"undefined":e.toString(),hn.formatters.k=e=>null==e?"undefined":e.toString(),hn.formatters.a=e=>null==e?"undefined":e.toString();var dn=r(20544),fn=r(41690);function pn(e){return function(t){return t instanceof gn?t:new gn(t,e)}}class gn{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?(0,fn.z)([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new bn(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}const mn=[255,254,252,248,240,224,192,128],yn=[1,3,7,15,31,63,127,255];class bn{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,s=Math.min(n,t);r=(r<<s)+wn(e,n-s,s),t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function wn(e,t,r){const n=function(e,t){return mn[e]&yn[Math.min(t+e-1,7)]}(t,r);return(e&n)>>>t}we({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let r=0;r<4;r++)t[r]=255&e,e>>=8;return new Uint8Array(t)}(wt.x86.hash32(e))});const vn=we({name:"murmur3-128",code:34,encode:e=>_(wt.x64.hash128(e))}),_n=(we({name:"murmur3-x64-64",code:34,encode:e=>_(wt.x64.hash128(e)).subarray(0,8)}),BigInt(vn.code));async function En(e){return(await vn.encode(e)).subarray(0,8).reverse()}const kn=async(e,t,r)=>{null==r.codec&&(r.codec=f);const n=await Ee.digest(e),s=le.create(r.cidVersion,r.codec.code,n);return await t.put(s,e,{...r,signal:r.signal}),s};class Sn{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}class xn extends Sn{_bucket;constructor(e,t){super(e,t),this._bucket=(0,_t.$)({hashFn:En,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=Tn(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of In(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*In(e,t,r,n){const s=e._children,i=[];let o=0n;for(let e=0;e<s.length;e++){const r=s.get(e);if(null==r)continue;const a=e.toString(16).toUpperCase().padStart(2,"0");if(r instanceof _t.r){let e;for await(const s of In(r,t,null,n))e=s;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:a,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else if("function"==typeof r.value.flush){const e=r.value;let n;for await(const r of e.flush(t))n=r,yield n;if(null==n)throw new Error("Did not flush dir");const s=a+r.key;i.push({Name:s,Tsize:Number(n.size),Hash:n.cid}),o+=n.size}else{const e=r.value;if(null==e.cid)continue;const t=a+r.key,n=e.size;i.push({Name:t,Tsize:Number(n),Hash:e.cid}),o+=BigInt(n??0)}}const a=Uint8Array.from(s.bitField().reverse()),c=new w({type:"hamt-sharded-directory",data:a,fanout:BigInt(e.tableSize()),hashType:_n,mtime:r?.mtime,mode:r?.mode}),h={Data:c.marshal(),Links:i},u=(0,f.encode)((0,f.prepare)(h)),l=await kn(u,t,n),d=BigInt(u.byteLength)+o;yield{cid:l,unixfs:c,size:d}}function Tn(e,t,r){const n=e._children,s=[];for(let e=0;e<n.length;e++){const t=n.get(e);if(null==t)continue;const i=e.toString(16).toUpperCase().padStart(2,"0");if(t instanceof _t.r){const e=Tn(t,null,r);s.push({Name:i,Tsize:Number(e),Hash:0===r.cidVersion?An:Dn})}else if("function"==typeof t.value.flush){const e=t.value.nodeSize();s.push({Name:i+t.key,Tsize:Number(e),Hash:0===r.cidVersion?An:Dn})}else{const e=t.value;if(null==e.cid)continue;const r=i+t.key,n=e.size;s.push({Name:r,Tsize:Number(n),Hash:e.cid})}}const i=Uint8Array.from(n.bitField().reverse()),o=new w({type:"hamt-sharded-directory",data:i,fanout:BigInt(e.tableSize()),hashType:_n,mtime:t?.mtime,mode:t?.mode});return(0,f.encode)((0,f.prepare)({Data:o.marshal(),Links:s})).length}const An=le.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Dn=le.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),Pn=ln("helia:unixfs:commands:utils:hamt-utils"),Cn=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Mn=async(e,t,r)=>{const n=w.unmarshal(e[0].node.Data??new Uint8Array(0)),s=BigInt(Math.pow(2,8));let i,o;e.reverse();for(let a=0;a<e.length;a++){const c=a===e.length-1,h=e[a],u=Uint8Array.from(h.children.bitField().reverse()),l=new w({type:"hamt-sharded-directory",data:u,fanout:s,hashType:_n});c&&(l.mtime=n.mtime,l.mode=n.mode),o={Data:l.marshal(),Links:h.node.Links};const d=f.encode(f.prepare(o));if(i=await kn(d,t,r),!c){const t=e[a+1];if(null==t)throw new Error("Was not operating on shard root but also had no parent?");Pn("updating link in parent sub-shard with prefix %s",t.prefix),t.node.Links=t.node.Links.filter((e=>e.Name!==t.prefix)),t.node.Links.push({Name:t.prefix,Hash:i,Tsize:h.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),d.byteLength)})}}if(null==i||null==o)throw new Error("Noting persisted");return{cid:i,node:o}},Rn=async(e,t,r,n)=>{const s=pn(En)((0,Pe.m)(t)),i=[];for(;;){const o=await r.get(e,n),a=f.decode(o),c=new dn,h=await s.take(8),u=Cn(h);let l;i.push({prefix:u,children:c,node:a});for(const e of a.Links){const t=e.Name??"";if(t.length<2)throw new Error("Invalid HAMT - link name was too short");const r=parseInt(t.substring(0,2),16);c.set(r,!0),t.startsWith(u)&&(l=e)}if(null==l){Pn("no link found with prefix %s for %s",u,t);break}const d=l.Name??"";if(d.length<2)throw new Error("Invalid HAMT - link name was too short");if(2!==d.length)break;e=l.Hash,Pn("descend into sub-shard with prefix %s",d)}return{path:i,hash:s}};async function On(e,t,r,n){if(null==e.Data)throw new Error("DagPB node had no data");const s=w.unmarshal(e.Data);let i;if("directory"===s.type)i=function(e){let t=0;for(const r of e.Links)t+=(r.Name??"").length,t+=1===r.Hash.version?Dn.bytes.byteLength:An.bytes.byteLength;return t}(e);else{if("hamt-sharded-directory"!==s.type)throw new Error("Can only estimate the size of directories or shards");i=await Nn(e,0,r,t,n)}return i>r}async function Nn(e,t,r,n,s){if(t>r)return r;if(null==e.Data)return t;if(!w.unmarshal(e.Data).isDirectory())return t;for(const i of e.Links){let e=i.Name??"";if(e=e.substring(2),t+=e.length,t+=i.Hash.bytes.byteLength,i.Hash.code===f.code){const e=await n.get(i.Hash,s),o=f.decode(e);t+=await Nn(o,t,r,n,s)}}return t}const Bn=ln("helia:unixfs:components:utils:add-link");async function Ln(e,t,r,n){if(null==e.node.Data)throw new cn("Invalid parent passed to addLink");if("hamt-sharded-directory"===w.unmarshal(e.node.Data).type)return Bn("adding link to sharded directory"),Fn(e,t,r,n);Bn(`adding ${t.Name} (${t.Hash}) to regular directory`);const s=await Un(e,t,r,n);if(await On(s.node,r,n.shardSplitThresholdBytes,n)){Bn("converting directory to sharded directory");const e=await zn(s,r);s.cid=e.cid,s.node=f.decode(await r.get(e.cid,n))}return s}const zn=async(e,t)=>{if(null==e.node.Data)throw new cn("Invalid parent passed to convertToShardedDirectory");const r=w.unmarshal(e.node.Data),n=await(async(e,t,r)=>{const n=new xn({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:r.mtime,mode:r.mode},r);for(let e=0;e<t.length;e++)await n._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});const s=await Lt(n.flush(e));if(null==s)throw new Error("Flushing shard yielded no result");return s})(t,e.node.Links.map((e=>({name:e.Name??"",size:BigInt(e.Tsize??0),cid:e.Hash}))),{mode:r.mode,mtime:r.mtime,cidVersion:e.cid.version});return Bn(`converted directory to sharded directory ${n.cid}`),n},Un=async(e,t,r,n)=>{const s=e.node.Links.filter((e=>{const r=e.Name===t.Name;if(r&&!n.allowOverwriting)throw new rn;return!r}));if(s.push(t),null==e.node.Data)throw new en("Parent node with no data passed to addToDirectory");const i=w.unmarshal(e.node.Data);let o;if(null!=i.mtime){const e=Date.now(),t=Math.floor(e/1e3);i.mtime={secs:BigInt(t),nsecs:1e3*(e-1e3*t)},o=i.marshal()}else o=e.node.Data;e.node=f.prepare({Data:o,Links:s});const a=f.encode(e.node),c=await Ee.digest(a),h=le.create(e.cid.version,f.code,c);return await r.put(h,a),{node:e.node,cid:h}},Fn=async(e,t,r,n)=>{const{path:s,hash:i}=await Rn(e.cid,t.Name,r,n),o=s[s.length-1];if(null==o)throw new Error("Invalid HAMT, could not generate path");const a=o.prefix,c=parseInt(a,16);Bn("next prefix for %s is %s",t.Name,a);const h=`${a}${t.Name}`,u=o.node.Links.find((e=>(e.Name??"").startsWith(a)));if(null!=u)if(Bn("link %s was present in shard",h),u.Name===h){if(!n.allowOverwriting)throw new rn;Bn("overwriting %s in subshard",t.Name),o.node.Links=o.node.Links.filter((e=>e.Name!==h)),o.node.Links.push({Name:h,Hash:t.Hash,Tsize:t.Tsize})}else{if(2===u.Name?.length)throw new Error("Existing link was subshard?!");{Bn("prefix %s already exists, creating new subshard",a);const e=o.node.Links.findIndex((e=>e.Name?.startsWith(a))),r=o.node.Links.splice(e,1)[0],n=(r.Name??"").substring(2),c=pn(En)((0,Pe.m)(n));for(let e=0;e<s.length;e++)await c.take(8);for(;;){const e=await c.take(8),o=Cn(e);r.Name=`${o}${n}`;const h=await i.take(8),u=Cn(h);if(o===u){const e=new dn;e.set(h,!0),s.push({prefix:u,children:e,node:{Links:[]}});continue}const l=new dn;l.set(h,!0),l.set(e,!0),s.push({prefix:a,children:l,node:{Links:[r,{Name:`${u}${t.Name}`,Hash:t.Hash,Tsize:t.Tsize}]}});break}}}else Bn("link %s was not present in sub-shard",h),t.Name=h,o.node.Links.push(t),o.children.set(c,!0),Bn("adding %s to existing sub-shard",h);return Mn(s,r,n)};async function jn(e,t,r={}){const n=await Jr(e,t,r);if("directory"!==n.type)throw new an(`${e.toString()} was not a UnixFS directory`);return{cid:e,node:n.node}}async function Vn(e,t,r,n){const s=await Jr(e,r,n);if("directory"!==s.type&&"file"!==s.type&&"raw"!==s.type)throw new Xr(`${e.toString()} was not a UnixFS node`);return{Name:t,Tsize:s.node instanceof Uint8Array?s.node.byteLength:Wn(s.node),Hash:e}}function Wn(e){const t=e.Links.reduce(((e,t)=>e+(t.Tsize??0)),0);return f.encode(e).byteLength+t}const $n=ln("helia:unixfs:components:utils:resolve");async function qn(e,t,r,n){if(null==t||""===t)return{cid:e};$n('resolve "%s" under %c',t,e);const s=t.split("/").filter(Boolean),i=[{name:"",cid:e,size:0n}];for(let t=0;t<s.length;t++){const o=s[t],a=await Jr(e,r,n);if($n('resolving "%s"',o,a),"file"===a.type){if(t<s.length-1)throw new cn("Path was invalid");e=a.cid}else{if("directory"!==a.type)throw new cn("Could not resolve path");{let t;for await(const e of a.content())if(e.name===o){t=e.cid;break}if(null==t)throw new nn("Could not find path in directory");e=t,i.push({name:o,cid:e,size:a.size})}}}return $n("resolved %s to %c",t,e),{cid:e,path:t,segments:i}}async function Kn(e,t,r,n){if(null==t.segments||0===t.segments.length)return e;let s=t.segments.pop();if(null==s)throw new Error("Insufficient segments");s.cid=e,t.segments.reverse();for(const i of t.segments){const[t,o]=await Promise.all([jn(i.cid,r,n),Vn(s.cid,s.name,r,n)]);e=(await Ln(t,o,r,{...n,allowOverwriting:!0,cidVersion:e.version})).cid,i.cid=e,s=i}return e}const Hn=Qr.Z.bind({ignoreUndefined:!0}),Gn={};const Jn=262144,Zn=Qr.Z.bind({ignoreUndefined:!0}),Qn=ln("helia:unixfs:chmod"),Yn={recursive:!1,shardSplitThresholdBytes:Jn};const Xn=Qr.Z.bind({ignoreUndefined:!0}),es=ln("helia:unixfs:cp"),ts={force:!1,shardSplitThresholdBytes:Jn};const rs=Qr.Z.bind({ignoreUndefined:!0}),ns={};const ss=Qr.Z.bind({ignoreUndefined:!0}),is=ln("helia:unixfs:mkdir"),os={cidVersion:1,force:!1,shardSplitThresholdBytes:Jn};const as=ln("helia:unixfs:utils:remove-link");const cs=async(e,t,r,n)=>{e.node.Links=e.node.Links.filter((e=>e.Name!==t));const s=f.encode(e.node),i=await kn(s,r,{...n,cidVersion:e.cid.version});return as(`Updated regular directory ${i}`),{node:e.node,cid:i}},hs=async(e,t,r,n)=>{const{path:s}=await Rn(e.cid,t,r,n),i=s[s.length-1];if(null==i)throw new Error("Invalid HAMT, could not generate path");const o=i.node.Links.filter((e=>(e.Name??"").substring(2)===t)).map((e=>e.Name)).pop();if(null==o)throw new Error("File not found");const a=o.substring(0,2),c=parseInt(a,16);if(i.node.Links=i.node.Links.filter((e=>e.Name!==o)),i.children.unset(c),1===i.node.Links.length)for(;1!==s.length;){const e=s[s.length-1];if(null==e||e.node.Links.length>1)break;s.pop();const t=s[s.length-1];if(null==t)break;const r=e.node.Links[0];t.node.Links=t.node.Links.filter((e=>!(e.Name??"").startsWith(t.prefix))),t.node.Links.push({Hash:r.Hash,Name:`${t.prefix}${(r.Name??"").substring(2)}`,Tsize:r.Tsize})}return Mn(s,r,n)},us=async(e,t,r)=>{if(null==e.node.Data)throw new cn("Invalid parent passed to convertToFlatDirectory");const n={Links:[]},s=await Jr(e.cid,t);if("directory"!==s.type)throw new Error("Unexpected node type");for await(const e of s.content()){let t=0;t=e.node instanceof Uint8Array?e.node.byteLength:f.encode(e.node).length,n.Links.push({Hash:e.cid,Name:e.name,Tsize:t})}const i=w.unmarshal(e.node.Data);n.Data=new w({type:"directory",mode:i.mode,mtime:i.mtime}).marshal();const o=f.encode(f.prepare(n));return{cid:await kn(o,t,{codec:f,cidVersion:e.cid.version,signal:r.signal}),node:n}},ls=Qr.Z.bind({ignoreUndefined:!0}),ds=ln("helia:unixfs:rm"),fs={shardSplitThresholdBytes:Jn};async function ps(e,t,r,n={}){const s=ls(fs,n);if(t.includes("/"))throw new cn("Name must not have slashes");const i=await jn(e,r,s);ds("Removing %s from %c",t,e);const o=await async function(e,t,r,n){if(null==e.node.Data)throw new en("Parent node had no data");if("hamt-sharded-directory"===w.unmarshal(e.node.Data).type){as(`removing ${t} from sharded directory`);const s=await hs(e,t,r,n);return await On(s.node,r,n.shardSplitThresholdBytes,n)?s:(as("converting shard to flat directory %c",e.cid),us(s,r,n))}return as(`removing link ${t} regular directory`),cs(e,t,r,n)}(i,t,r,{...s,cidVersion:e.version});return o.cid}const gs=Qr.Z.bind({ignoreUndefined:!0}),ms=ln("helia:unixfs:stat"),ys={};async function bs(e,t,r={}){const n=gs(ys,r),s=await qn(e,r.path,t,n);ms("stat %c",s.cid);const i=await Jr(s.cid,t,n);if("file"!==i.type&&"directory"!==i.type&&"raw"!==i.type)throw new Xr;let o,a,c=0n,h=0n,u=0n,l=0n,d=0;const f=i.type;let p;if("raw"===i.type&&(c=BigInt(i.node.byteLength),h=BigInt(i.node.byteLength),u=BigInt(i.node.byteLength),l=BigInt(i.node.byteLength),d=1),"directory"===i.type&&(c=0n,h=BigInt(i.unixfs.marshal().byteLength),u=0n,l=h,d=1,o=i.unixfs.mode,a=i.unixfs.mtime,p=i.unixfs),"file"===i.type){const e=await ws(s.cid,t,n);c=i.unixfs.fileSize(),h=BigInt((i.node.Data?.byteLength??0)+i.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),u=BigInt(e.localFileSize),l=BigInt(e.localDagSize),d=e.blocks,o=i.unixfs.mode,a=i.unixfs.mtime,p=i.unixfs}return{cid:s.cid,mode:o,mtime:a,fileSize:c,dagSize:h,localFileSize:u,localDagSize:l,blocks:d,type:f,unixfs:p}}async function ws(e,t,r){const n={localFileSize:0,localDagSize:0,blocks:0};if(await t.has(e,r)){const s=await t.get(e,r);if(n.blocks++,n.localDagSize+=s.byteLength,e.code===S)n.localFileSize+=s.byteLength;else{if(e.code!==f.code)throw new tn(`${e.toString()} was neither DAG_PB nor RAW`);{const i=f.decode(s);if(i.Links.length>0)for(const e of i.Links){const s=await ws(e.Hash,t,r);n.localFileSize+=s.localFileSize,n.localDagSize+=s.localDagSize,n.blocks+=s.blocks}else{if(null==i.Data)throw new en(`PBNode ${e.toString()} had no data`);const t=w.unmarshal(i.Data);if(null==t.data)throw new en(`UnixFS node ${e.toString()} had no data`);n.localFileSize+=t.data.byteLength??0}}}}return n}const vs=Qr.Z.bind({ignoreUndefined:!0}),_s=ln("helia:unixfs:touch"),Es={recursive:!1,shardSplitThresholdBytes:Jn};r(67064);class ks{components;constructor(e){this.components=e}async*addAll(e,t={}){yield*async function*(e,t,r={}){yield*Ct(e,t,{...Rt,...r})}(e,this.components.blockstore,t)}async addBytes(e,t={}){return Ot(e,this.components.blockstore,t)}async addByteStream(e,t={}){return Nt(e,this.components.blockstore,t)}async addFile(e,t={}){return async function(e,t,r={}){const{cid:n}=await Mt(e,t,{...Rt,...r});return n}(e,this.components.blockstore,t)}async addDirectory(e={},t={}){return Bt(e,this.components.blockstore,t)}async*cat(e,t={}){yield*async function*(e,t,r={}){const n=Hn(Gn,r),s=await qn(e,n.path,t,n),i=await Jr(s.cid,t,n);if("file"!==i.type&&"raw"!==i.type)throw new on;if(null==i.content)throw new sn;yield*i.content(n)}(e,this.components.blockstore,t)}async chmod(e,t,r={}){return async function(e,t,r,n={}){const s=Zn(Yn,n),i=await qn(e,s.path,r,n);if(Qn("chmod %c %d",i.cid,t),s.recursive){const o=await(0,Nr.z)((async function*(){for await(const e of Zr(i.cid,r,n)){let r,n=[];if("raw"===e.type)r=new w({type:"file",data:e.node});else{if("file"!==e.type&&"directory"!==e.type)throw new Xr;r=e.unixfs,n=e.node.Links}r.mode=t;const s={Data:r.marshal(),Links:n};yield{path:e.path,content:s}}}),(t=>Ct(t,r,{...s,dagBuilder:async function*(t,r){for await(const n of t)yield async function(){const t=n.content,i=f.encode(t),o=await kn(i,r,{...s,cidVersion:e.version});if(null==t.Data)throw new en(`${o} had no data`);const a=w.unmarshal(t.Data);return{cid:o,size:BigInt(i.length),path:n.path,unixfs:a}}}})),(async e=>Lt(e)));if(null==o)throw new tn(`Could not chmod ${i.cid.toString()}`);return Kn(o.cid,i,r,s)}const o=await r.get(i.cid,n);let a,c=[];if(i.cid.code===S)a=new w({type:"file",data:o});else{const e=f.decode(o);if(null==e.Data)throw new en(`${i.cid.toString()} had no data`);c=e.Links,a=w.unmarshal(e.Data)}a.mode=t;const h=f.encode({Data:a.marshal(),Links:c}),u=await Ee.digest(h),l=le.create(i.cid.version,f.code,u);return await r.put(l,h),Kn(l,i,r,s)}(e,t,this.components.blockstore,r)}async cp(e,t,r,n={}){return async function(e,t,r,n,s={}){const i=Xn(ts,s);if(r.includes("/"))throw new cn("Name must not have slashes");const[o,a]=await Promise.all([jn(t,n,i),Vn(e,r,n,i)]);return es('Adding %c as "%s" to %c',e,r,t),(await Ln(o,a,n,{allowOverwriting:i.force,cidVersion:t.version,...i})).cid}(e,t,r,this.components.blockstore,n)}async*ls(e,t={}){yield*async function*(e,t,r={}){const n=rs(ns,r),s=await qn(e,n.path,t,n),i=await Jr(s.cid,t);if("file"!==i.type&&"raw"!==i.type){if(null==i.content)throw new sn;if("directory"!==i.type)throw new an;yield*i.content({offset:r.offset,length:r.length})}else yield i}(e,this.components.blockstore,t)}async mkdir(e,t,r={}){return async function(e,t,r,n={}){const s=ss(os,n);if(t.includes("/"))throw new cn("Path must not have slashes");if("directory"!==(await Jr(e,r,n)).type)throw new an(`${e.toString()} was not a UnixFS directory`);is("creating %s",t);const i={Data:new w({type:"directory",mode:s.mode,mtime:s.mtime}).marshal(),Links:[]},o=f.encode(i),a=await Ee.digest(o),c=le.create(s.cidVersion,f.code,a);await r.put(c,o);const[h,u]=await Promise.all([jn(e,r,s),Vn(c,t,r,s)]);return is("adding empty dir called %s to %c",t,e),(await Ln(h,u,r,{...s,allowOverwriting:s.force})).cid}(e,t,this.components.blockstore,r)}async rm(e,t,r={}){return ps(e,t,this.components.blockstore,r)}async stat(e,t={}){return bs(e,this.components.blockstore,t)}async touch(e,t={}){return async function(e,t,r={}){const n=vs(Es,r),s=await qn(e,n.path,t,n),i=n.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(_s("touch %c %o",s.cid,i),n.recursive){const r=await(0,Nr.z)((async function*(){for await(const e of Zr(s.cid,t)){let t,r;if("raw"===e.type)t=new w({data:e.node}),r=[];else{if("file"!==e.type&&"directory"!==e.type)throw new Xr;t=e.unixfs,r=e.node.Links}t.mtime=i;const n={Data:t.marshal(),Links:r};yield{path:e.path,content:n}}}),(r=>Ct(r,t,{...n,dagBuilder:async function*(t,r){for await(const s of t)yield async function(){const t=s.content,i=f.encode(t),o=await kn(i,r,{...n,cidVersion:e.version});if(null==t.Data)throw new en(`${o} had no data`);const a=w.unmarshal(t.Data);return{cid:o,size:BigInt(i.length),path:s.path,unixfs:a}}}})),(async e=>Lt(e)));if(null==r)throw new tn(`Could not chmod ${s.cid.toString()}`);return Kn(r.cid,s,t,n)}const o=await t.get(s.cid,r);let a,c=[];if(s.cid.code===S)a=new w({data:o});else{const e=f.decode(o);if(c=e.Links,null==e.Data)throw new en(`${s.cid.toString()} had no data`);a=w.unmarshal(e.Data)}a.mtime=i;const h=f.encode({Data:a.marshal(),Links:c}),u=await Ee.digest(h),l=le.create(s.cid.version,f.code,u);return await t.put(l,h),Kn(l,s,t,n)}(e,this.components.blockstore,t)}}function Ss(e){return new ks(e)}},28391:function(e,t,r){"use strict";r.d(t,{_L:function(){return n},D7:function(){return o},wJ:function(){return s}});class n extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function s(e,t,r){const s=r??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let r;const o=()=>{null!=r&&r()};for(t.addEventListener("abort",o);;){let a;try{if(t.aborted){const{abortMessage:e,abortCode:t}=s;throw new n(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=s;t(new n(e,r))}}));a=await Promise.race([e,i.next()]),r=null}catch(r){t.removeEventListener("abort",o);const n="aborted"===r.type&&t.aborted;if(n&&null!=s.onAbort&&await s.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=s.onReturnError&&s.onReturnError(e)}))}catch(e){null!=s.onReturnError&&s.onReturnError(e)}if(n&&!0===s.returnOnAbort)return;throw r}if(!0===a.done)break;yield a.value}t.removeEventListener("abort",o)}()}function i(e,t,r){return n=>e(s(n,t,r))}function o(e,t,r){return{sink:i(e.sink,t,{...r,onAbort:void 0}),source:s(e.source,t,r)}}},7688:function(e,t,r){"use strict";function n(e){if(!Array.isArray(e))throw new TypeError("Expected an array, got "+typeof e);for(let t=(e=[...e]).length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}r.d(t,{Z:function(){return n}})},34298:function(e,t,r){"use strict";r.d(t,{E:function(){return n}});class n{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:r,block:n}of e)await this.put(r,n,t),yield r}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const r of e)yield{cid:r,block:await this.get(r,t)}}async delete(e,t){await Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const r of e)await this.delete(r,t),yield r}async*getAll(e){throw new Error(".getAll is not implemented")}}},48727:function(e,t,r){"use strict";r.r(t),r.d(t,{abortedError:function(){return l},closeFailedError:function(){return i},deleteFailedError:function(){return c},getFailedError:function(){return a},hasFailedError:function(){return h},notFoundError:function(){return u},openFailedError:function(){return s},putFailedError:function(){return o}});var n=r(32114);function s(e){return e=e??new Error("Open failed"),n(e,"ERR_OPEN_FAILED")}function i(e){return e=e??new Error("Close failed"),n(e,"ERR_CLOSE_FAILED")}function o(e){return e=e??new Error("Put failed"),n(e,"ERR_PUT_FAILED")}function a(e){return e=e??new Error("Get failed"),n(e,"ERR_GET_FAILED")}function c(e){return e=e??new Error("Delete failed"),n(e,"ERR_DELETE_FAILED")}function h(e){return e=e??new Error("Has failed"),n(e,"ERR_HAS_FAILED")}function u(e){return e=e??new Error("Not Found"),n(e,"ERR_NOT_FOUND")}function l(e){return e=e??new Error("Aborted"),n(e,"ERR_ABORTED")}},66293:function(e,t,r){"use strict";r.d(t,{Ed:function(){return s.E},D1:function(){return V},DA:function(){return j}});var n=r(48727),s=r(34298),i=r(8589),o=r(44883),a=r(4745),c=function e(t,r,n){r=r||[];var s=n=n||0;for(;t>=l;)r[n++]=255&t|h,t/=128;for(;t&u;)r[n++]=255&t|h,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},h=128,u=-128,l=Math.pow(2,31);var d=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&p)<<i:(n&p)*Math.pow(2,i),i+=7}while(n>=f);return e.bytes=o-r,s},f=128,p=127;var g=Math.pow(2,7),m=Math.pow(2,14),y=Math.pow(2,21),b=Math.pow(2,28),w=Math.pow(2,35),v=Math.pow(2,42),_=Math.pow(2,49),E=Math.pow(2,56),k=Math.pow(2,63),S={encode:c,decode:d,encodingLength:function(e){return e<g?1:e<m?2:e<y?3:e<b?4:e<w?5:e<v?6:e<_?7:e<E?8:e<k?9:10}};const x=(e,t=0)=>[S.decode(e,t),S.decode.bytes],I=(e,t,r=0)=>(S.encode(e,t,r),t),T=e=>S.encodingLength(e),A=e=>{const t=(0,a.oQ)(e),[r,n]=x(t),[s,i]=x(t.subarray(n)),o=t.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new D(r,s,o,t)};class D{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const P=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?N(r,M(e),t||o.i.encoder):B(r,M(e),t||i.pJ.encoder)},C=new WeakMap,M=e=>{const t=C.get(e);if(null==t){const t=new Map;return C.set(e,t),t}return t};class R{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==L)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==z)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return R.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=((e,t)=>{const r=t.byteLength,n=T(e),s=n+T(r),i=new Uint8Array(s+r);return I(e,i,0),I(r,i,n),i.set(t,s),new D(e,r,t,i)})(e,t);return R.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return R.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,a.fS)(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return P(this,e)}toJSON(){return{"/":P(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof R)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new R(e,r,n,s||U(e,r,n.bytes))}if(!0===t[F]){const{version:e,multihash:r,code:n}=t,s=A(r);return R.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==L)throw new Error(`Version 0 CID must use dag-pb (code: ${L}) block encoding`);return new R(e,t,r,r.bytes);case 1:{const n=U(e,t,r.bytes);return new R(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return R.create(0,L,e)}static createV1(e,t){return R.create(1,e,t)}static decode(e){const[t,r]=R.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=R.inspectBytes(e),r=t.size-t.multihashSize,n=(0,a.oQ)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new D(t.multihashCode,t.digestSize,s,n);return[0===t.version?R.createV0(i):R.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=x(e.subarray(t));return t+=n,r};let n=r(),s=L;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=O(e,t),s=R.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return M(s).set(r,e),s}}const O=(e,t)=>{switch(e[0]){case"Q":{const r=t||o.i;return[o.i.prefix,r.decode(`${o.i.prefix}${e}`)]}case o.i.prefix:{const r=t||o.i;return[o.i.prefix,r.decode(e)]}case i.pJ.prefix:{const r=t||i.pJ;return[i.pJ.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},N=(e,t,r)=>{const{prefix:n}=r;if(n!==o.i.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const s=r.encode(e).slice(1);return t.set(n,s),s}return s},B=(e,t,r)=>{const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s},L=112,z=18,U=(e,t,r)=>{const n=T(e),s=n+T(t),i=new Uint8Array(s+r.byteLength);return I(e,i,0),I(t,i,n),i.set(r,s),i},F=Symbol.for("@ipld/js-cid/CID");class j extends s.E{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(i.pJ.encode(e.multihash.bytes),t),e}get(e){const t=this.data.get(i.pJ.encode(e.multihash.bytes));if(null==t)throw n.notFoundError();return t}has(e){return this.data.has(i.pJ.encode(e.multihash.bytes))}async delete(e){this.data.delete(i.pJ.encode(e.multihash.bytes))}async*getAll(){for(const[e,t]of this.data.entries())yield{cid:R.createV1(85,A(i.pJ.decode(e))),block:t}}}r(90067),r(53694);const V={...n}},8589:function(e,t,r){"use strict";r.d(t,{pJ:function(){return s}});var n=r(73994);const s=(0,n.ET)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});(0,n.ET)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),(0,n.ET)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),(0,n.ET)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),(0,n.ET)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),(0,n.ET)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),(0,n.ET)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),(0,n.ET)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),(0,n.ET)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},44883:function(e,t,r){"use strict";r.d(t,{i:function(){return s}});var n=r(73994);const s=(0,n.kU)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});(0,n.kU)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},4745:function(e,t,r){"use strict";r.d(t,{fS:function(){return n},oQ:function(){return s}});new Uint8Array(0);const n=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},s=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}},33634:function(e,t,r){"use strict";r.d(t,{Y:function(){return Q}});var n=r(66293),s=r(4424);var i=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==r[o])throw new TypeError(i+" is ambiguous");r[o]=s}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,s=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*h+1>>>0,o=new Uint8Array(i);e[t];){var u=r[e.charCodeAt(t)];if(255===u)return;for(var l=0,d=i-1;(0!==u||l<s)&&-1!==d;d--,l++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=l,t++}if(" "!==e[t]){for(var f=i-s;f!==i&&0===o[f];)f++;for(var p=new Uint8Array(n+(i-f)),g=n;f!==i;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,s=0,i=t.length;s!==i&&0===t[s];)s++,r++;for(var o=(i-s)*u+1>>>0,h=new Uint8Array(o);s!==i;){for(var l=t[s],d=0,f=o-1;(0!==l||d<n)&&-1!==f;f--,d++)l+=256*h[f]>>>0,h[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=d,s++}for(var p=o-n;p!==o&&0===h[p];)p++;for(var g=c.repeat(r);p<o;++p)g+=e.charAt(h[p]);return g},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};new Uint8Array(0);const o=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class a{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class c{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return u(this,e)}}class h{constructor(e){this.decoders=e}or(e){return u(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const u=(e,t)=>new h({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class l{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new a(e,t,r),this.decoder=new c(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const d=({name:e,prefix:t,encode:r,decode:n})=>new l(e,t,r,n),f=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:s}=i(r,t);return d({prefix:e,name:t,encode:n,decode:e=>o(s(e))})},p=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>d({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],s=(1<<r)-1;let i="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,i+=t[s&a>>o];if(o&&(i+=t[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const s={};for(let e=0;e<t.length;++e)s[t[e]]=e;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,h=0;for(let t=0;t<i;++t){const i=s[e[t]];if(void 0===i)throw new SyntaxError(`Non-${n} character`);c=c<<r|i,a+=r,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,n,r,e)}),g=p({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),m=p({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),y=(p({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),p({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),p({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),p({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),p({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),p({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),f({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));f({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var b=function e(t,r,n){r=r||[];var s=n=n||0;for(;t>=_;)r[n++]=255&t|w,t/=128;for(;t&v;)r[n++]=255&t|w,t>>>=7;return r[n]=0|t,e.bytes=n-s+1,r},w=128,v=-128,_=Math.pow(2,31);var E=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&S)<<i:(n&S)*Math.pow(2,i),i+=7}while(n>=k);return e.bytes=o-r,s},k=128,S=127;var x=Math.pow(2,7),I=Math.pow(2,14),T=Math.pow(2,21),A=Math.pow(2,28),D=Math.pow(2,35),P=Math.pow(2,42),C=Math.pow(2,49),M=Math.pow(2,56),R=Math.pow(2,63),O={encode:b,decode:E,encodingLength:function(e){return e<x?1:e<I?2:e<T?3:e<A?4:e<D?5:e<P?6:e<C?7:e<M?8:e<R?9:10}};const N=(e,t=0)=>[O.decode(e,t),O.decode.bytes],B=(e,t,r=0)=>(O.encode(e,t,r),t),L=e=>O.encodingLength(e),z=e=>{const t=o(e),[r,n]=N(t),[s,i]=N(t.subarray(n)),a=t.subarray(n+i);if(a.byteLength!==s)throw new Error("Incorrect length");return new U(r,s,a,t)};class U{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}const F=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?q(r,V(e),t||y.encoder):K(r,V(e),t||g.encoder)},j=new WeakMap,V=e=>{const t=j.get(e);if(null==t){const t=new Map;return j.set(e,t),t}return t};class W{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==H)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==G)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return W.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=((e,t)=>{const r=t.byteLength,n=L(e),s=n+L(r),i=new Uint8Array(s+r);return B(e,i,0),B(r,i,n),i.set(t,s),new U(e,r,t,i)})(e,t);return W.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return W.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&((e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(e.bytes,r.bytes)}})(e.multihash,r.multihash)}toString(e){return F(this,e)}toJSON(){return{"/":F(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof W)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new W(e,r,n,s||J(e,r,n.bytes))}if(!0===t[Z]){const{version:e,multihash:r,code:n}=t,s=z(r);return W.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==H)throw new Error(`Version 0 CID must use dag-pb (code: ${H}) block encoding`);return new W(e,t,r,r.bytes);case 1:{const n=J(e,t,r.bytes);return new W(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return W.create(0,H,e)}static createV1(e,t){return W.create(1,e,t)}static decode(e){const[t,r]=W.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=W.inspectBytes(e),r=t.size-t.multihashSize,n=o(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new U(t.multihashCode,t.digestSize,s,n);return[0===t.version?W.createV0(i):W.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=N(e.subarray(t));return t+=n,r};let n=r(),s=H;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=$(e,t),s=W.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return V(s).set(r,e),s}}const $=(e,t)=>{switch(e[0]){case"Q":{const r=t||y;return[y.prefix,r.decode(`${y.prefix}${e}`)]}case y.prefix:{const r=t||y;return[y.prefix,r.decode(e)]}case g.prefix:{const r=t||g;return[g.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},q=(e,t,r)=>{const{prefix:n}=r;if(n!==y.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const s=r.encode(e).slice(1);return t.set(n,s),s}return s},K=(e,t,r)=>{const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s},H=112,G=18,J=(e,t,r)=>{const n=L(e),s=n+L(t),i=new Uint8Array(s+r.byteLength);return B(e,i,0),B(t,i,n),i.set(r,s),i},Z=Symbol.for("@ipld/js-cid/CID");class Q extends n.Ed{location;version;db;base;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1,this.base=t.base??m}#e(e){return`/${this.base.encoder.encode(e.multihash.bytes)}`}#t(e){return W.createV1(85,z(this.base.decoder.decode(e.substring(1))))}async open(){try{const e=this.location;this.db=await(0,s.X3)(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw n.D1.openFailedError(e)}}async close(){this.db?.close()}async put(e,t){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return await this.db.put(this.location,t,this.#e(e)),e}catch(e){throw n.D1.putFailedError(e)}}async get(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");let t;try{t=await this.db.get(this.location,this.#e(e))}catch(e){throw n.D1.putFailedError(e)}if(void 0===t)throw n.D1.notFoundError();return t}async delete(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{await this.db.delete(this.location,this.#e(e))}catch(e){throw n.D1.putFailedError(e)}}async has(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return Boolean(await this.db.getKey(this.location,this.#e(e)))}catch(e){throw n.D1.putFailedError(e)}}async*getAll(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");for(const e of await this.db.getAllKeys(this.location)){const t=this.#t(e.toString()),r=await this.get(t);yield{cid:t,block:r}}}async destroy(){await(0,s.Lj)(this.location)}}},53597:function(e,t,r){"use strict";async function*n(e,t={}){const r=e.getReader();try{for(;;){const e=await r.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await r.cancel(),r.releaseLock()}}r.d(t,{Z:function(){return n}})},11067:function(e,t,r){"use strict";function n(e){return e instanceof Uint8Array?{get:t=>e[t],set(t,r){e[t]=r}}:{get:t=>e.get(t),set(t,r){e.set(t,r)}}}r.d(t,{Z:function(){return n}})},64936:function(e,t,r){"use strict";r.d(t,{Dy:function(){return i.D},Jx:function(){return s.Jx},WU:function(){return i.W},cv:function(){return n.cv}});var n=r(37463),s=r(61287),i=r(59787)},22042:function(e,t,r){"use strict";r.d(t,{BB:function(){return c},Dz:function(){return a},Pu:function(){return b},mL:function(){return h},nI:function(){return u},qu:function(){return p},tP:function(){return l},un:function(){return f},zo:function(){return d}});const n=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,s=new TextDecoder,i=new TextEncoder;function o(e){return n&&globalThis.Buffer.isBuffer(e)}function a(e){return e instanceof Uint8Array?o(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const c=n?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):m(e,t,r):(e,t,r)=>r-t>64?s.decode(e.subarray(t,r)):m(e,t,r),h=n?e=>e.length>64?globalThis.Buffer.from(e):g(e):e=>e.length>64?i.encode(e):g(e),u=e=>Uint8Array.from(e),l=n?(e,t,r)=>o(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),d=n?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),a(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},f=n?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function p(e,t){if(o(e)&&o(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function g(e,t=1/0){let r;const n=e.length;let s=null;const i=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function m(e,t,r){const n=[];for(;t<r;){const s=e[t];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:s<128&&(i=s);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&s)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&s)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&s)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=o}return b(n)}const y=4096;function b(e){const t=e.length;if(t<=y)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=y));return r}},85590:function(e,t,r){"use strict";r.d(t,{DO:function(){return o},IR:function(){return n},OO:function(){return s}});const n="CBOR decode error:",s="CBOR encode error:",i=[];function o(e,t,r){if(e.length-t<r)throw new Error(`${n} not enough data for type`)}i[23]=1,i[24]=2,i[25]=3,i[26]=5,i[27]=9},61287:function(e,t,r){"use strict";r.d(t,{Jx:function(){return l}});var n=r(85590),s=r(59787),i=r(53741);const o={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class a{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=i.PS[e];if(void 0===t){const r=i.cW[e];if(!r)throw new Error(`${n.IR} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=31&e;t=r(this.data,this.pos,s,this.options)}return this.pos+=t.encodedLength,t}}const c=Symbol.for("DONE"),h=Symbol.for("BREAK");function u(e,t){if(e.done())return c;const r=e.next();if(r.type===s.D.break)return h;if(r.type.terminal)return r.value;if(r.type===s.D.array)return function(e,t,r){const s=[];for(let i=0;i<e.value;i++){const o=u(t,r);if(o===h){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed array`)}if(o===c)throw new Error(`${n.IR} found array but not enough entries (got ${i}, expected ${e.value})`);s[i]=o}return s}(r,e,t);if(r.type===s.D.map)return function(e,t,r){const s=!0===r.useMaps,i=s?void 0:{},o=s?new Map:void 0;for(let a=0;a<e.value;a++){const l=u(t,r);if(l===h){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed map`)}if(l===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(!0!==s&&"string"!=typeof l)throw new Error(`${n.IR} non-string keys not supported (got ${typeof l})`);if(!0===r.rejectDuplicateMapKeys&&(s&&o.has(l)||!s&&l in i))throw new Error(`${n.IR} found repeat map key "${l}"`);const d=u(t,r);if(d===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no value], expected ${e.value})`);s?o.set(l,d):i[l]=d}return s?o:i}(r,e,t);if(r.type===s.D.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=u(e,t);return t.tags[r.value](n)}throw new Error(`${n.IR} tag not supported (${r.value})`)}throw new Error("unsupported")}function l(e,t){if(!(e instanceof Uint8Array))throw new Error(`${n.IR} data to decode must be a Uint8Array`);const r=(t=Object.assign({},o,t)).tokenizer||new a(e,t),s=u(r,t);if(s===c)throw new Error(`${n.IR} did not find any content to decode`);if(s===h)throw new Error(`${n.IR} got unexpected break`);if(!r.done())throw new Error(`${n.IR} too many terminals, data makes no sense`);return s}},37463:function(e,t,r){"use strict";r.d(t,{cv:function(){return T},w$:function(){return I}});var n=r(50579),s=r(59787),i=r(74320),o=r(85590),a=r(53741),c=r(22042),h=r(55580),u=r(53929),l=r(11560),d=r(50768),f=r(8278),p=r(59283),g=r(82428),m=r(73851),y=r(25108);const b={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const s=r.type.major,i=w[s].compareTokens(r,n);0===i&&y.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return i},quickEncodeToken:a.JN};const w=function(){const e=[];return e[s.D.uint.major]=h.Fh,e[s.D.negint.major]=u.UT,e[s.D.bytes.major]=l.hg,e[s.D.string.major]=d.YW,e[s.D.array.major]=f.HF,e[s.D.map.major]=p.KI,e[s.D.tag.major]=g.xy,e[s.D.float.major]=m.tA,e}(),v=new i.Bl;class _{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${o.OO} object contains circular references`);return new _(t,e)}}const E={null:new s.W(s.D.null,null),undefined:new s.W(s.D.undefined,void 0),true:new s.W(s.D.true,!0),false:new s.W(s.D.false,!1),emptyArray:new s.W(s.D.array,0),emptyMap:new s.W(s.D.map,0)},k={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new s.W(s.D.uint,e):new s.W(s.D.negint,e):new s.W(s.D.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new s.W(s.D.uint,e):new s.W(s.D.negint,e),Uint8Array:(e,t,r,n)=>new s.W(s.D.bytes,e),string:(e,t,r,n)=>new s.W(s.D.string,e),boolean:(e,t,r,n)=>e?E.true:E.false,null:(e,t,r,n)=>E.null,undefined:(e,t,r,n)=>E.undefined,ArrayBuffer:(e,t,r,n)=>new s.W(s.D.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new s.W(s.D.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[E.emptyArray,new s.W(s.D.break)]:E.emptyArray;n=_.createCheck(n,e);const i=[];let o=0;for(const t of e)i[o++]=S(t,r,n);return r.addBreakTokens?[new s.W(s.D.array,e.length),i,new s.W(s.D.break)]:[new s.W(s.D.array,e.length),i]},Object(e,t,r,n){const i="Object"!==t,o=i?e.keys():Object.keys(e),a=i?e.size:o.length;if(!a)return!0===r.addBreakTokens?[E.emptyMap,new s.W(s.D.break)]:E.emptyMap;n=_.createCheck(n,e);const c=[];let h=0;for(const t of o)c[h++]=[S(t,r,n),S(i?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(c,r),r.addBreakTokens?[new s.W(s.D.map,a),c,new s.W(s.D.break)]:[new s.W(s.D.map,a),c]}};k.Map=k.Object,k.Buffer=k.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))k[`${e}Array`]=k.DataView;function S(e,t={},r){const s=(0,n.is)(e),i=t&&t.typeEncoders&&t.typeEncoders[s]||k[s];if("function"==typeof i){const n=i(e,s,t,r);if(null!=n)return n}const a=k[s];if(!a)throw new Error(`${o.OO} unsupported type: ${s}`);return a(e,s,t,r)}function x(e,t,r,n){if(Array.isArray(t))for(const s of t)x(e,s,r,n);else r[t.type.major](e,t,n)}function I(e,t,r){const n=S(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const s=t[n.type.major];if(s.encodedSize){const e=s.encodedSize(n,r),t=new i.Bl(e);if(s(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return(0,c.Dz)(t.chunks[0])}}return v.reset(),x(v,n,t,r),v.toBytes(!0)}function T(e,t){return t=Object.assign({},b,t),I(e,w,t)}},97223:function(e,t,r){"use strict";r.d(t,{d2:function(){return l},Jx:function(){return d},cv:function(){return h}});var n=r(59787),s=r(37463),i=r(85590),o=r(22042);class a extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===n.D.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===n.D.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[n.D.uint.major](e,t){this.prefix(e);const r=String(t.value),n=[];for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);e.push(n)}[n.D.negint.major](e,t){this[n.D.uint.major](e,t)}[n.D.bytes.major](e,t){throw new Error(`${i.OO} unsupported type: Uint8Array`)}[n.D.string.major](e,t){this.prefix(e);const r=(0,o.mL)(JSON.stringify(t.value));e.push(r.length>32?(0,o.Dz)(r):r)}[n.D.array.major](e,t){this.prefix(e),this.inRecursive.push({type:n.D.array,elements:0}),e.push([91])}[n.D.map.major](e,t){this.prefix(e),this.inRecursive.push({type:n.D.map,elements:0}),e.push([123])}[n.D.tag.major](e,t){}[n.D.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===n.D.array)e.push([93]);else{if(t.type!==n.D.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${i.OO} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const r=String(t.value),s=[];let o=!1;for(let e=0;e<r.length;e++)s[e]=r.charCodeAt(e),o||46!==s[e]&&101!==s[e]&&69!==s[e]||(o=!0);o||(s.push(46),s.push(48)),e.push(s)}}const c={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${i.OO} complex map keys are not supported`);const r=e[0],s=t[0];if(r.type!==n.D.string||s.type!==n.D.string)throw new Error(`${i.OO} non-string map keys are not supported`);if(r<s)return-1;if(r>s)return 1;throw new Error(`${i.OO} unexpected duplicate map keys, this is not supported`)}};function h(e,t){return t=Object.assign({},c,t),(0,s.w$)(e,new a,t)}var u=r(61287);class l{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${i.IR} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${i.IR} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,r=!1;const s=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this.pos++}};if(45===this.ch()&&(t=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new n.W(n.D.uint,0,this.pos-e);this.pos++,r=!0}if(s([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${i.IR} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(r)throw new Error(`${i.IR} unexpected token at position ${this.pos}`);r=!0,this.pos++,s([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(r=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,s([48,49,50,51,52,53,54,55,56,57]));const o=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),a=parseFloat(o);return r?new n.W(n.D.float,a,this.pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(a)?new n.W(a>=0?n.D.uint:n.D.negint,a,this.pos-e):new n.W(a>=0?n.D.uint:n.D.negint,BigInt(o),this.pos-e)}parseString(){if(34!==this.ch())throw new Error(`${i.IR} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let e=this.pos,t=0;e<this.data.length&&t<65536;e++,t++){const r=this.data[e];if(92===r||r<32||r>=128)break;if(34===r){const r=String.fromCharCode.apply(null,this.data.subarray(this.pos,e));return this.pos=e+1,new n.W(n.D.string,r,t)}}const e=this.pos,t=[],r=()=>{if(this.pos+4>=this.data.length)throw new Error(`${i.IR} unexpected end of unicode escape sequence at position ${this.pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${i.IR} unexpected unicode escape character at position ${this.pos}`);t=t-65+10}e=16*e+t,this.pos++}return e},s=()=>{const e=this.ch();let r,n,s,o,a=null,c=e>239?4:e>223?3:e>191?2:1;if(this.pos+c>this.data.length)throw new Error(`${i.IR} unexpected unicode sequence at position ${this.pos}`);switch(c){case 1:e<128&&(a=e);break;case 2:r=this.data[this.pos+1],128==(192&r)&&(o=(31&e)<<6|63&r,o>127&&(a=o));break;case 3:r=this.data[this.pos+1],n=this.data[this.pos+2],128==(192&r)&&128==(192&n)&&(o=(15&e)<<12|(63&r)<<6|63&n,o>2047&&(o<55296||o>57343)&&(a=o));break;case 4:r=this.data[this.pos+1],n=this.data[this.pos+2],s=this.data[this.pos+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&(o=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&s,o>65535&&o<1114112&&(a=o))}null===a?(a=65533,c=1):a>65535&&(a-=65536,t.push(a>>>10&1023|55296),a=56320|1023&a),t.push(a),this.pos+=c};for(;!this.done();){const a=this.ch();let c;switch(a){case 92:if(this.pos++,this.done())throw new Error(`${i.IR} unexpected string termination at position ${this.pos}`);switch(c=this.ch(),this.pos++,c){case 34:case 39:case 92:case 47:t.push(c);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${i.IR} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new n.W(n.D.string,(0,o.Pu)(t),this.pos-e);default:if(a<32)throw new Error(`${i.IR} invalid control character at position ${this.pos}`);a<128?(t.push(a),this.pos++):s()}}throw new Error(`${i.IR} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new n.W(n.D.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new n.W(n.D.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new n.W(n.D.null,null,4);case 102:return this.expect([102,97,108,115,101]),new n.W(n.D.false,!1,5);case 116:return this.expect([116,114,117,101]),new n.W(n.D.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${i.IR} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);if(44!==this.ch())throw new Error(`${i.IR} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);if(44!==this.ch())throw new Error(`${i.IR} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new n.W(n.D.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${i.IR} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${i.IR} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function d(e,t){return t=Object.assign({tokenizer:new l(e,t)},t),(0,u.Jx)(e,t)}},53741:function(e,t,r){"use strict";r.d(t,{JN:function(){return b},PS:function(){return y},cW:function(){return m}});var n=r(59787),s=r(55580),i=r(53929),o=r(11560),a=r(50768),c=r(8278),h=r(59283),u=r(82428),l=r(73851),d=r(85590),f=r(22042);function p(e,t,r){throw new Error(`${d.IR} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function g(e){return()=>{throw new Error(`${d.IR} ${e}`)}}const m=[];for(let e=0;e<=23;e++)m[e]=p;m[24]=s.Km,m[25]=s.Zh,m[26]=s.cs,m[27]=s.uN,m[28]=p,m[29]=p,m[30]=p,m[31]=p;for(let e=32;e<=55;e++)m[e]=p;m[56]=i.yr,m[57]=i.r0,m[58]=i.wy,m[59]=i.ec,m[60]=p,m[61]=p,m[62]=p,m[63]=p;for(let e=64;e<=87;e++)m[e]=o.Ii;m[88]=o.UQ,m[89]=o.BS,m[90]=o.zU,m[91]=o.ME,m[92]=p,m[93]=p,m[94]=p,m[95]=g("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)m[e]=a.nt;m[120]=a.Bq,m[121]=a.h,m[122]=a.q0,m[123]=a.bc,m[124]=p,m[125]=p,m[126]=p,m[127]=g("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)m[e]=c.Ju;m[152]=c.h7,m[153]=c.OC,m[154]=c.lY,m[155]=c.a8,m[156]=p,m[157]=p,m[158]=p,m[159]=c.s5;for(let e=160;e<=183;e++)m[e]=h._K;m[184]=h.G,m[185]=h.qe,m[186]=h.IY,m[187]=h.F2,m[188]=p,m[189]=p,m[190]=p,m[191]=h.ng;for(let e=192;e<=215;e++)m[e]=u.qJ;m[216]=u.ZR,m[217]=u.CF,m[218]=u.vP,m[219]=u.MV,m[220]=p,m[221]=p,m[222]=p,m[223]=p;for(let e=224;e<=243;e++)m[e]=g("simple values are not supported");m[244]=p,m[245]=p,m[246]=p,m[247]=l.h1,m[248]=g("simple values are not supported"),m[249]=l.mW,m[250]=l.GI,m[251]=l.vV,m[252]=p,m[253]=p,m[254]=p,m[255]=l.y7;const y=[];for(let e=0;e<24;e++)y[e]=new n.W(n.D.uint,e,1);for(let e=-1;e>=-24;e--)y[31-e]=new n.W(n.D.negint,e,1);function b(e){switch(e.type){case n.D.false:return(0,f.nI)([244]);case n.D.true:return(0,f.nI)([245]);case n.D.null:return(0,f.nI)([246]);case n.D.bytes:return e.value.length?void 0:(0,f.nI)([64]);case n.D.string:return""===e.value?(0,f.nI)([96]):void 0;case n.D.array:return 0===e.value?(0,f.nI)([128]):void 0;case n.D.map:return 0===e.value?(0,f.nI)([160]):void 0;case n.D.uint:return e.value<24?(0,f.nI)([Number(e.value)]):void 0;case n.D.negint:if(e.value>=-24)return(0,f.nI)([31-Number(e.value)])}}y[64]=new n.W(n.D.bytes,new Uint8Array(0),1),y[96]=new n.W(n.D.string,"",1),y[128]=new n.W(n.D.array,0,1),y[160]=new n.W(n.D.map,0,1),y[244]=new n.W(n.D.false,!1,1),y[245]=new n.W(n.D.true,!0,1),y[246]=new n.W(n.D.null,null,1)},59787:function(e,t,r){"use strict";r.d(t,{D:function(){return n},W:function(){return s}});class n{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}n.uint=new n(0,"uint",!0),n.negint=new n(1,"negint",!0),n.bytes=new n(2,"bytes",!0),n.string=new n(3,"string",!0),n.array=new n(4,"array",!1),n.map=new n(5,"map",!1),n.tag=new n(6,"tag",!1),n.float=new n(7,"float",!0),n.false=new n(7,"false",!0),n.true=new n(7,"true",!0),n.null=new n(7,"null",!0),n.undefined=new n(7,"undefined",!0),n.break=new n(7,"break",!0);class s{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}},84296:function(e,t,r){"use strict";r.r(t),r.d(t,{code:function(){return f},decode:function(){return b},encode:function(){return y},name:function(){return d},toGeneral:function(){return m}});var n=r(99382);function s(e){return n.base64url.encode(e).slice(1)}function i(e){return n.base64url.decode(`u${e}`)}var o=r(38161);function a(e){const t={signature:i(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=i(e.protected)),t}function c(e){const t={signature:s(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=s(e.protected)),t}function h(e){const t={};return e.encrypted_key&&(t.encrypted_key=i(e.encrypted_key)),e.header&&(t.header=e.header),t}function u(e){const t={};return e.encrypted_key&&(t.encrypted_key=s(e.encrypted_key)),e.header&&(t.header=e.header),t}var l=r(90560);const d="dag-jose",f=133;function p(e){return"payload"in e&&"string"==typeof e.payload&&"signatures"in e&&Array.isArray(e.signatures)}function g(e){return"ciphertext"in e&&"string"==typeof e.ciphertext&&"iv"in e&&"string"==typeof e.iv&&"protected"in e&&"string"==typeof e.protected&&"tag"in e&&"string"==typeof e.tag}function m(e){if("string"==typeof e){const t=e.split(".");if(3===t.length)return function(e){const[t,r,n]=e;return{payload:r,signatures:[{protected:t,signature:n}],link:o.k0.decode(i(r))}}(t);if(5===t.length)return function(e){const[t,r,n,s,i]=e,o={ciphertext:s,iv:n,protected:t,tag:i};return r&&(o.recipients=[{encrypted_key:r}]),o}(t);throw new Error("Not a valid JOSE string")}if(p(e)||g(e))return e;throw new Error("Not a valid unencoded JOSE object")}function y(e){let t;if("string"==typeof e&&(e=m(e)),p(e))t=function(e){const t=i(e.payload);try{o.k0.decode(t)}catch(e){throw new Error("Not a valid DagJWS")}return{payload:t,signatures:e.signatures.map(a)}}(e);else{if(!g(e))throw new Error("Not a valid JOSE object");t=function(e){const t={ciphertext:i(e.ciphertext),protected:i(e.protected),iv:i(e.iv),tag:i(e.tag)};return e.aad&&(t.aad=i(e.aad)),e.recipients&&(t.recipients=e.recipients.map(h)),e.unprotected&&(t.unprotected=e.unprotected),t}(e)}return new Uint8Array(l.encode(t))}function b(e){let t;try{t=l.decode(e)}catch(e){throw new Error("Not a valid DAG-JOSE object")}if("payload"in(r=t)&&r.payload instanceof Uint8Array&&"signatures"in r&&Array.isArray(r.signatures))return function(e){const t={payload:s(e.payload),signatures:e.signatures.map(c)};return t.link=o.k0.decode(new Uint8Array(e.payload)),t}(t);if(function(e){return"ciphertext"in e&&e.ciphertext instanceof Uint8Array&&"iv"in e&&e.iv instanceof Uint8Array&&"protected"in e&&e.protected instanceof Uint8Array&&"tag"in e&&e.tag instanceof Uint8Array}(t))return function(e){const t={ciphertext:s(e.ciphertext),protected:s(e.protected),iv:s(e.iv),tag:s(e.tag)};return e.aad&&(t.aad=s(e.aad)),e.recipients&&(t.recipients=e.recipients.map(u)),e.unprotected&&(t.unprotected=e.unprotected),t}(t);throw new Error("Not a valid DAG-JOSE object");var r}},54589:function(e,t,r){"use strict";r.d(t,{e:function(){return h}});var n=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);},s=r(75671);var i=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,s.Z)(e),{value:n,done:i}=r.next();if(!0===i)return function*(){}();const o=t(n);if("function"==typeof o.then)return async function*(){await o&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const a=t;return function*(){!0===o&&(yield n);for(const e of r)a(e)&&(yield e)}()};var o=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t};var a=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const r=await o(e);yield*r.sort(t)}():function*(){const r=o(e);yield*r.sort(t)}()};var c=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}():function*(){let r=0;if(!(t<1))for(const n of e)if(yield n,r++,r===t)return}()};class h{put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield r}async*getMany(e,t={}){for await(const r of e)yield{key:r,value:await this.get(r,t)}}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await n(this.putMany(e,r)),e=[],await n(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix){const t=e.prefix;r=i(r,(e=>e.key.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>i(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){let t=0;const n=e.offset;r=i(r,(()=>t++>=n))}return null!=e.limit&&(r=c(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix){const t=e.prefix;r=i(r,(e=>e.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>i(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>a(e,t)),r)),null!=e.offset){const t=e.offset;let n=0;r=i(r,(()=>n++>=t))}return null!=e.limit&&(r=c(r,e.limit)),r}}},66801:function(e,t,r){"use strict";r.r(t),r.d(t,{abortedError:function(){return h},dbDeleteFailedError:function(){return i},dbOpenFailedError:function(){return s},dbReadFailedError:function(){return a},dbWriteFailedError:function(){return o},notFoundError:function(){return c}});var n=r(32114);function s(e){return e=e??new Error("Cannot open database"),n(e,"ERR_DB_OPEN_FAILED")}function i(e){return e=e??new Error("Delete failed"),n(e,"ERR_DB_DELETE_FAILED")}function o(e){return e=e??new Error("Write failed"),n(e,"ERR_DB_WRITE_FAILED")}function a(e){return e=e??new Error("Read failed"),n(e,"ERR_DB_READ_FAILED")}function c(e){return e=e??new Error("Not Found"),n(e,"ERR_NOT_FOUND")}function h(e){return e=e??new Error("Aborted"),n(e,"ERR_ABORTED")}},52292:function(e,t,r){"use strict";r.d(t,{D1:function(){return n},ar:function(){return i.a},eF:function(){return s.e}});var n=r(66801),s=(r(72745),r(54589)),i=r(92291);r(97341),r(24462),r(85865),r(27794),r(47916)},92291:function(e,t,r){"use strict";r.d(t,{a:function(){return o}});var n=r(88309),s=r(54589),i=r(66801);class o extends s.e{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){const t=this.data.get(e.toString());if(null==t)throw i.notFoundError();return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(const[e,t]of this.data.entries())yield{key:new n.s(e),value:t}}*_allKeys(){for(const e of this.data.keys())yield new n.s(e)}}},55472:function(e,t,r){"use strict";r.d(t,{s:function(){return m}});var n=r(52292),s=r(4424),i=r(53416),o=r(49784),a=r(77408);const c="/",h=(new TextEncoder).encode(c),u=h[0];class l{constructor(e,t){if("string"==typeof e)this._buf=(0,a.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==u)throw new Error("Invalid key")}toString(e="utf8"){return(0,o.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new l(e.join(c))}static random(){return new l((0,i.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new l(e):"function"==typeof e.uint8Array?new l(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=h),this._buf[0]!==u){const e=new Uint8Array(this._buf.byteLength+1);e.fill(u,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===u;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],s=r[e];if(n<s)return!0;if(n>s)return!1}return t.length<r.length}reverse(){return l.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(c).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new l(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(c)||(e+=c),e+=this.type(),new l(e)}parent(){const e=this.list();return 1===e.length?new l(c):new l(e.slice(0,-1).join(c))}child(e){return this.toString()===c?e:e.toString()===c?this:new l(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return l.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}var d=r(75671);var f=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,d.Z)(e),{value:n,done:s}=r.next();if(!0===s)return function*(){}();const i=t(n);if("function"==typeof i.then)return async function*(){await i&&(yield n);for await(const e of r)await t(e)&&(yield e)}();const o=t;return function*(){!0===i&&(yield n);for(const e of r)o(e)&&(yield e)}()};var p=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const r of e)t.push(r);return t})();const t=[];for(const r of e)t.push(r);return t};var g=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const r=await p(e);yield*r.sort(t)}():function*(){const r=p(e);yield*r.sort(t)}()};class m extends n.eF{location;version;db;constructor(e,t={}){super(),this.location=`${t.prefix??""}${e}`,this.version=t.version??1}async open(){try{const e=this.location;this.db=await(0,s.X3)(e,this.version,{upgrade(t){t.createObjectStore(e)}})}catch(e){throw n.D1.dbOpenFailedError(e)}}async close(){this.db?.close()}async put(e,t){if(null==this.db)throw new Error("Datastore needs to be opened.");try{return await this.db.put(this.location,t,e.toString()),e}catch(e){throw n.D1.dbWriteFailedError(e)}}async get(e){if(null==this.db)throw new Error("Datastore needs to be opened.");let t;try{t=await this.db.get(this.location,e.toString())}catch(e){throw n.D1.dbReadFailedError(e)}if(void 0===t)throw n.D1.notFoundError();return t}async has(e){if(null==this.db)throw new Error("Blockstore needs to be opened.");try{return Boolean(await this.db.getKey(this.location,e.toString()))}catch(e){throw n.D1.dbReadFailedError(e)}}async delete(e){if(null==this.db)throw new Error("Datastore needs to be opened.");try{await this.db.delete(this.location,e.toString())}catch(e){throw n.D1.dbWriteFailedError(e)}}batch(){const e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async()=>{if(null==this.db)throw new Error("Datastore needs to be opened.");const r=this.db.transaction(this.location,"readwrite");try{const n=e.filter((({key:e})=>null==t.find((t=>t.toString()===e.toString())))).map((e=>async()=>{await r.store.put(e.value,e.key.toString())})).concat(t.map((e=>async()=>{await r.store.delete(e.toString())}))).concat((async()=>{await r.done}));await Promise.all(n.map((async e=>{await e()})))}catch{r.abort()}}}}async*query(e){let t=this.#r(e,((e,t)=>({key:e,value:t})));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>f(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>g(e,t)),t)),yield*t}async*queryKeys(e){let t=this.#r(e,(e=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>f(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>g(e,t)),t)),yield*t}async*#r(e,t){if(null==this.db)throw new Error("Datastore needs to be opened.");let r=0,n=-1;for(const s of await this.db.getAllKeys(this.location)){if(null!=e.prefix&&!s.toString().startsWith(e.prefix))continue;if(null!=e.limit&&r===e.limit)return;if(n++,null!=e.offset&&n<e.offset)continue;const i=new l(s.toString());let o;try{o=await this.get(i)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e;continue}null!=o&&(yield t(i,o),r++)}}async destroy(){await(0,s.Lj)(this.location)}}},61711:function(e,t,r){"use strict";r.d(t,{R:function(){return w}});var n=r(64348);r(32114);r(66699);const s="SHARDING";const i=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();var o=r(93361),a=r(44752),c=r(56635);class h{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,o.Z)(this.putMany(e,r)),e=[],await(0,o.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,a.Z)(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,a.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>i(e,t)),r)),null!=e.offset){let t=0;r=(0,a.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,c.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,a.Z)(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,a.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>i(e,t)),r)),null!=e.offset){let t=0;r=(0,a.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,c.Z)(r,e.limit)),r}}new n.s(s),new n.s("_README");var u=r(69860);(0,u.kg)("datastore:core:tiered");var l=r(52770),d=r(49784),f=r(77408);const p="/record/";function g(e){return(0,d.B)(e,"base32")}function m(e){("string"==typeof e||e instanceof String)&&(e=(0,f.m)(e.toString()));const t=(0,d.B)(e,"base64url");return`${p}${t}`}var y=r(73062);const b=(0,u.kg)("datastore-pubsub:publisher");class w extends h{constructor(e,t,r,n,s,i){if(super(),!n)throw new l.s("missing validator","ERR_INVALID_PARAMETERS");if("function"!=typeof n)throw new l.s("missing validate function","ERR_INVALID_PARAMETERS");if("function"!=typeof s)throw new l.s("missing select function","ERR_INVALID_PARAMETERS");if(i&&"function"!=typeof i)throw new l.s("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=r,this._validator=n,this._selector=s,this._handleSubscriptionKeyFn=i,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,r){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw b.error(e),new l.s(e,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){const e="received value is not a Uint8Array";throw b.error(e),new l.s(e,"ERR_INVALID_VALUE_RECEIVED")}const n=m(e);b(`publish value for topic ${n}`),await this._pubsub.publish(n,t)}async get(e,t){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw b.error(e),new l.s(e,"ERR_INVALID_DATASTORE_KEY")}const r=m(e),n=await this._pubsub.getTopics();if(n&&Array.isArray(n)&&n.indexOf(r)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(r)}catch(e){const t=`cannot subscribe topic ${r}`;throw b.error(t),new l.s(t,"ERR_SUBSCRIBING_TOPIC")}return b(`subscribed values for key ${r}`),this._getLocal(e)}unsubscribe(e){const t=m(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){const r=new n.s("/"+g(e),!1);let s;try{s=await this._datastore.get(r,t)}catch(e){if("ERR_NOT_FOUND"!==e.code){const e=`unexpected error getting the ipns record for ${r.toString()}`;throw b.error(e),new l.s(e,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const t=`local record requested was not found for ${r.toString()}`;throw b.error(t),new l.s(t,"ERR_NOT_FOUND")}if(!(s instanceof Uint8Array)){const e="found record that we couldn't convert to a value";throw b.error(e),new l.s(e,"ERR_INVALID_RECORD_RECEIVED")}return s}async _onMessage(e){const t=e.detail;if("signed"!==t.type)return void b.error("unsigned message received, this module can only work with signed messages");const{data:r,from:n,topic:s}=t;let i;try{i=function(e){if(e.substring(0,p.length)!==p)throw new l.s("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");const t=e.substring(p.length);return(0,f.m)(t,"base64url")}(s)}catch(e){return void b.error(e)}if(b(`message received for topic ${s}`),this._peerId.equals(n))b("message discarded as it is from the same peer");else{if(this._handleSubscriptionKeyFn){let e;try{e=await this._handleSubscriptionKeyFn(i)}catch(e){return void b.error("message discarded by the subscriptionKeyFn")}i=e}try{await this._storeIfSubscriptionIsBetter(i,r)}catch(e){b.error(e)}}}async _storeIfSubscriptionIsBetter(e,t,r){let n=!1;try{n=await this._isBetter(e,t)}catch(e){if("ERR_NOT_VALID_RECORD"!==e.code)throw e}n&&await this._storeRecord(e,t,r)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return 0===await this._selector(e,t)}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch(e){const t="record received through pubsub is not valid";throw b.error(t),new l.s(t,"ERR_NOT_VALID_RECORD")}const r=new n.s(e);let s;try{s=await this._getLocal(r.uint8Array())}catch(e){return!0}return!(0,y.f)(s,t)&&this._selectRecord(e,[s,t])}async _storeRecord(e,t,r){const s=new n.s("/"+g(e),!1);await this._datastore.put(s,t,r),b(`record for ${m(e)} was stored in the datastore`)}}},85965:function(e,t,r){"use strict";r.d(t,{sk:function(){return G},Vq:function(){return E},Y3:function(){return j},Qc:function(){return H}});const n=Object.create(null);n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const s=Object.create(null);Object.keys(n).forEach((e=>{s[n[e]]=e}));const i={type:"error",data:"parser error"},o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,c=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};var h=({type:e,data:t},r,s)=>{return o&&t instanceof Blob?r?s(t):c(t,s):a&&(t instanceof ArrayBuffer||(i=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer))?r?s(t):c(new Blob([t]),s):s(n[e]+(t||""));var i};const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<u.length;e++)l[u.charCodeAt(e)]=e;const d="function"==typeof ArrayBuffer,f=(e,t)=>{if(d){const r=(e=>{let t,r,n,s,i,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const h=new ArrayBuffer(o),u=new Uint8Array(h);for(t=0;t<a;t+=4)r=l[e.charCodeAt(t)],n=l[e.charCodeAt(t+1)],s=l[e.charCodeAt(t+2)],i=l[e.charCodeAt(t+3)],u[c++]=r<<2|n>>4,u[c++]=(15&n)<<4|s>>2,u[c++]=(3&s)<<6|63&i;return h})(e);return p(r,t)}return{base64:!0,data:e}},p=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e;var g=(e,t)=>{if("string"!=typeof e)return{type:"message",data:p(e,t)};const r=e.charAt(0);if("b"===r)return{type:"message",data:f(e.substring(1),t)};return s[r]?e.length>1?{type:s[r],data:e.substring(1)}:{type:s[r]}:i};const m=String.fromCharCode(30);var y=r(99748);const b="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function w(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const v=b.setTimeout,_=b.clearTimeout;function E(e,t){t.useNativeTimers?(e.setTimeoutFn=v.bind(b),e.clearTimeoutFn=_.bind(b)):(e.setTimeoutFn=b.setTimeout.bind(b),e.clearTimeoutFn=b.clearTimeout.bind(b))}class k extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class S extends y.Q{constructor(e){super(),this.writable=!1,E(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new k(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=g(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const x="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),I=64,T={};let A,D=0,P=0;function C(e){let t="";do{t=x[e%I]+t,e=Math.floor(e/I)}while(e>0);return t}function M(){const e=C(+new Date);return e!==A?(D=0,A=e):e+"."+C(D++)}for(;P<I;P++)T[x[P]]=P;function R(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}let O=!1;try{O="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const N=O;function B(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||N))return new XMLHttpRequest}catch(e){}if(!t)try{return new(b[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function L(){}const z=null!=new B({xdomain:!1}).responseType;class U extends y.Q{constructor(e,t){super(),E(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=w(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new B(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=U.requestsCount++,U.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=L,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete U.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(U.requestsCount=0,U.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",F);else if("function"==typeof addEventListener){addEventListener("onpagehide"in b?"pagehide":"unload",F,!1)}function F(){for(let e in U.requests)U.requests.hasOwnProperty(e)&&U.requests[e].abort()}const j="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),V=b.WebSocket||b.MozWebSocket;r(23085).lW;const W="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const $={websocket:class extends S{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=W?{}:w(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=W?new V(e,t,r):t?new V(e,t):new V(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;h(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&j((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=M()),this.supportsBinary||(e.b64=1);const n=R(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!V}},polling:class extends S{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=z&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(m),n=[];for(let e=0;e<r.length;e++){const s=g(r[e],t);if(n.push(s),"error"===s.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let s=0;e.forEach(((e,i)=>{h(e,!1,(e=>{n[i]=e,++s===r&&t(n.join(m))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=M()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=R(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new U(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},q=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,K=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function H(e){const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let s=q.exec(e||""),i={},o=14;for(;o--;)i[K[o]]=s[o]||"";return-1!=r&&-1!=n&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,i.path),i.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,i.query),i}class G extends y.Q{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=H(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=H(t.host).host),E(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new $[e](r)}open(){let e;if(this.opts.rememberUpgrade&&G.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;G.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;G.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function s(){r||(r=!0,h(),t.close(),t=null)}const i=e=>{const r=new Error("probe error: "+e);r.transport=t.name,s(),this.emitReserved("upgradeError",r)};function o(){i("transport closed")}function a(){i("socket closed")}function c(e){t&&e.name!==t.name&&s()}const h=()=>{t.removeListener("open",n),t.removeListener("error",i),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",i),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",G.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,r=0;for(let n=0,s=e.length;n<s;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){G.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}G.protocol=4;G.protocol},95034:function(e,t,r){"use strict";r.d(t,{pM:function(){return a}});r(58090);var n=r(48764),s=r(33606),i=r(94391);const o={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4};async function a(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(t?.length>1)return h(i.FY(t))}function c(e,t,r){r={offset:0,...r};for(const[n,s]of t.entries())if(r.mask){if(s!==(r.mask[n]&e[n+r.offset]))return!1}else if(s!==e[n+r.offset])return!1;return!0}async function h(e){try{return(new u).parse(e)}catch(e){if(!(e instanceof i.dL))throw e}}class u{check(e,t){return c(this.buffer,e,t)}checkString(e,t){return this.check((r=e,[...r].map((e=>e.charCodeAt(0)))),t);var r}async parse(e){if(this.buffer=n.Buffer.alloc(4100),void 0===e.fileInfo.size&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.parse(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const t=await e.readToken(o);return e.position+t>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(t),h(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===this.buffer[0]||70===this.buffer[0])&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(this.buffer,{length:30});const r={compressedSize:this.buffer.readUInt32LE(18),uncompressedSize:this.buffer.readUInt32LE(22),filenameLength:this.buffer.readUInt16LE(26),extraFieldLength:this.buffer.readUInt16LE(28)};if(r.filename=await e.readToken(new s.uW(r.filenameLength,"utf-8")),await e.ignore(r.extraFieldLength),"META-INF/mozilla.rsa"===r.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(r.filename.endsWith(".rels")||r.filename.endsWith(".xml")){switch(r.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}}if(r.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(r.filename.startsWith("3D/")&&r.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===r.filename&&r.compressedSize===r.uncompressedSize){let a=await e.readToken(new s.uW(r.compressedSize,"utf-8"));switch(a=a.trim(),a){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}}if(0===r.compressedSize){let u=-1;for(;u<0&&e.position<e.fileInfo.size;)await e.peekBuffer(this.buffer,{mayBeLess:!0}),u=this.buffer.indexOf("504B0304",0,"hex"),await e.ignore(u>=0?u:this.buffer.length)}else await e.ignore(r.compressedSize)}}catch(l){if(!(l instanceof i.dL))throw l}return{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const d=n.Buffer.alloc(8);return await e.readBuffer(d),c(d,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:c(d,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:c(d,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:c(d,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:c(d,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:c(d,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(3===this.buffer[2]||5===this.buffer[2]||7===this.buffer[2])&&(4===this.buffer[3]||6===this.buffer[3]||8===this.buffer[3]))return{ext:"zip",mime:"application/zip"};if(this.checkString("ftyp",{offset:4})&&0!=(96&this.buffer[8])){const f=this.buffer.toString("binary",8,12).replace("\0"," ").trim();switch(f){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return f.startsWith("3g")?f.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF")){try{await e.ignore(1350);const p=10485760,g=n.Buffer.alloc(Math.min(p,e.fileInfo.size));if(await e.readBuffer(g,{mayBeLess:!0}),g.includes(n.Buffer.from("AIPrivateData")))return{ext:"ai",mime:"application/postscript"}}catch(m){if(!(m instanceof i.dL))throw m}return{ext:"pdf",mime:"application/pdf"}}if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const y=await this.readTiffHeader(!1);if(y)return y}if(this.check([77,77])){const b=await this.readTiffHeader(!0);if(b)return b}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function w(){const t=await e.peekNumber(s.fB);let r=128,i=0;for(;0==(t&r)&&0!==r;)++i,r>>=1;const o=n.Buffer.alloc(i+1);return await e.readBuffer(o),o}async function v(){const e=await w(),t=await w();t[0]^=128>>t.length-1;const r=Math.min(6,t.length);return{id:e.readUIntBE(0,e.length),len:t.readUIntBE(t.length-r,r)}}async function _(t){for(;t>0;){const r=await v();if(17026===r.id){return(await e.readToken(new s.uW(r.len,"utf-8"))).replace(/\00.*$/g,"")}await e.ignore(r.len),--t}}const E=await v();switch(await _(E.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(this.check([82,73,70,70])){if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1"))return{ext:"parquet",mime:"application/x-parquet"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(0===this.buffer[6]||1===this.buffer[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const k=this.buffer.toString("binary",2,6);if(k.match("^d*")&&k>=1e3&&k<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>")){await e.ignore(8);return"debian-binary"===await e.readToken(new s.uW(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"}}if(this.checkString("**ACE",{offset:7})&&(await e.peekBuffer(this.buffer,{length:14,mayBeLess:!0}),this.checkString("**",{offset:12})))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.check([137,80,78,71,13,10,26,10])){async function S(){return{length:await e.readToken(s.ZW),type:await e.readToken(new s.uW(4,"binary"))}}await e.ignore(8);do{const x=await S();if(x.length<0)return;switch(x.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(x.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function I(){const t=n.Buffer.alloc(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(s.zR))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const T=await I();let A=T.size-24;if(c(T.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const D=n.Buffer.alloc(16);if(A-=await e.readBuffer(D),c(D,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(c(D,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(A)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10])){await e.ignore(20);switch(await e.readToken(new s.uW(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const P=this.buffer.readUInt32LE(12);if(P>12&&this.buffer.length>=P+16)try{const C=this.buffer.slice(16,P+16).toString();if(JSON.parse(C).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),function(e,t=0){const r=Number.parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(r))return!1;let n=256;for(let r=t;r<t+148;r++)n+=e[r];for(let r=t+156;r<t+512;r++)n+=e[r];return r===n}(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(this.buffer.length>=2&&this.check([255,224],{offset:0,mask:[255,224]})){if(this.check([16],{offset:1,mask:[22]}))return this.check([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}async readTiffTag(e){const t=await this.tokenizer.readToken(e?s.US:s.p);switch(this.tokenizer.ignore(10),t){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?s.US:s.p);for(let r=0;r<t;++r){const t=await this.readTiffTag(e);if(t)return t}}async readTiffHeader(e){const t=(e?s.US:s.p).get(this.buffer,2),r=(e?s.jj:s.xW).get(this.buffer,4);if(42===t){if(r>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r>=8&&(this.check([28,0,254,0],{offset:8})||this.check([31,0,11,0],{offset:8})))return{ext:"nef",mime:"image/x-nikon-nef"}}await this.tokenizer.ignore(r);return await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(43===t)return{ext:"tif",mime:"image/tiff"}}}new Set(["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace"]),new Set(["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/x-parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed"])},1707:function(e,t,r){"use strict";r.d(t,{WY:function(){return U}});const n={parse:JSON.parse,stringify:JSON.stringify};var s=r(51268),i=r(40804),o=r(53458);const a=e=>s(e)||null!==e&&"object"==typeof e&&"function"==typeof e.pipe;var c=(e,t,r,s=n)=>{const{clone:c,files:h}=i({query:e,variables:t,operationName:r},"",a);if(0===h.size){if(!Array.isArray(e))return s.stringify(c);if(void 0!==t&&!Array.isArray(t))throw new Error("Cannot create request body with given variable type, array expected");const r=e.reduce(((e,r,n)=>(e.push({query:r,variables:t?t[n]:void 0}),e)),[]);return s.stringify(r)}const u=new("undefined"==typeof FormData?o:FormData);u.append("operations",s.stringify(c));const l={};let d=0;return h.forEach((e=>{l[++d]=e})),u.append("map",s.stringify(l)),d=0,h.forEach(((e,t)=>{u.append(""+ ++d,t)})),u};const h=(e,t,...r)=>{const[n,s]=r;return e.document?e:{url:e,document:t,variables:n,requestHeaders:s,signal:void 0}};var u=r(25202),l=r(7420);const d=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function f(e){return p[e.charCodeAt(0)]}const p=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"];var g=r(53767),m=r(6589),y=r(39504),b=r(6450);const w=Object.freeze({});function v(e,t,r=y.h8){const n=new Map;for(const e of Object.values(b.h))n.set(e,_(t,e));let s,i,o,a=Array.isArray(e),c=[e],h=-1,u=[],l=e;const d=[],f=[];do{h++;const e=h===c.length,b=e&&0!==u.length;if(e){if(i=0===f.length?void 0:d[d.length-1],l=o,o=f.pop(),b)if(a){l=l.slice();let e=0;for(const[t,r]of u){const n=t-e;null===r?(l.splice(n,1),e++):l[n]=r}}else{l=Object.defineProperties({},Object.getOwnPropertyDescriptors(l));for(const[e,t]of u)l[e]=t}h=s.index,c=s.keys,u=s.edits,a=s.inArray,s=s.prev}else if(o){if(i=a?h:c[h],l=o[i],null==l)continue;d.push(i)}let _;if(!Array.isArray(l)){var p,v;(0,y.UG)(l)||(0,g.a)(!1,`Invalid AST Node: ${(0,m.X)(l)}.`);const r=e?null===(p=n.get(l.kind))||void 0===p?void 0:p.leave:null===(v=n.get(l.kind))||void 0===v?void 0:v.enter;if(_=null==r?void 0:r.call(t,l,i,o,d,f),_===w)break;if(!1===_){if(!e){d.pop();continue}}else if(void 0!==_&&(u.push([i,_]),!e)){if(!(0,y.UG)(_)){d.pop();continue}l=_}}var E;if(void 0===_&&b&&u.push([i,l]),e)d.pop();else s={inArray:a,index:h,keys:c,edits:u,prev:s},a=Array.isArray(l),c=a?l:null!==(E=r[l.kind])&&void 0!==E?E:[],h=-1,u=[],o&&f.push(o),o=l}while(void 0!==s);return 0!==u.length?u[u.length-1][1]:e}function _(e,t){const r=e[t];return"object"==typeof r?r:"function"==typeof r?{enter:r,leave:void 0}:{enter:e.enter,leave:e.leave}}function E(e){return v(e,k)}const k={Name:{leave:e=>e.value},Variable:{leave:e=>"$"+e.name},Document:{leave:e=>S(e.definitions,"\n\n")},OperationDefinition:{leave(e){const t=I("(",S(e.variableDefinitions,", "),")"),r=S([e.operation,S([e.name,t]),S(e.directives," ")]," ");return("query"===r?"":r+" ")+e.selectionSet}},VariableDefinition:{leave:({variable:e,type:t,defaultValue:r,directives:n})=>e+": "+t+I(" = ",r)+I(" ",S(n," "))},SelectionSet:{leave:({selections:e})=>x(e)},Field:{leave({alias:e,name:t,arguments:r,directives:n,selectionSet:s}){const i=I("",e,": ")+t;let o=i+I("(",S(r,", "),")");return o.length>80&&(o=i+I("(\n",T(S(r,"\n")),"\n)")),S([o,S(n," "),s]," ")}},Argument:{leave:({name:e,value:t})=>e+": "+t},FragmentSpread:{leave:({name:e,directives:t})=>"..."+e+I(" ",S(t," "))},InlineFragment:{leave:({typeCondition:e,directives:t,selectionSet:r})=>S(["...",I("on ",e),S(t," "),r]," ")},FragmentDefinition:{leave:({name:e,typeCondition:t,variableDefinitions:r,directives:n,selectionSet:s})=>`fragment ${e}${I("(",S(r,", "),")")} on ${t} ${I("",S(n," ")," ")}`+s},IntValue:{leave:({value:e})=>e},FloatValue:{leave:({value:e})=>e},StringValue:{leave:({value:e,block:t})=>t?(0,l.LZ)(e):`"${e.replace(d,f)}"`},BooleanValue:{leave:({value:e})=>e?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:e})=>e},ListValue:{leave:({values:e})=>"["+S(e,", ")+"]"},ObjectValue:{leave:({fields:e})=>"{"+S(e,", ")+"}"},ObjectField:{leave:({name:e,value:t})=>e+": "+t},Directive:{leave:({name:e,arguments:t})=>"@"+e+I("(",S(t,", "),")")},NamedType:{leave:({name:e})=>e},ListType:{leave:({type:e})=>"["+e+"]"},NonNullType:{leave:({type:e})=>e+"!"},SchemaDefinition:{leave:({description:e,directives:t,operationTypes:r})=>I("",e,"\n")+S(["schema",S(t," "),x(r)]," ")},OperationTypeDefinition:{leave:({operation:e,type:t})=>e+": "+t},ScalarTypeDefinition:{leave:({description:e,name:t,directives:r})=>I("",e,"\n")+S(["scalar",t,S(r," ")]," ")},ObjectTypeDefinition:{leave:({description:e,name:t,interfaces:r,directives:n,fields:s})=>I("",e,"\n")+S(["type",t,I("implements ",S(r," & ")),S(n," "),x(s)]," ")},FieldDefinition:{leave:({description:e,name:t,arguments:r,type:n,directives:s})=>I("",e,"\n")+t+(A(r)?I("(\n",T(S(r,"\n")),"\n)"):I("(",S(r,", "),")"))+": "+n+I(" ",S(s," "))},InputValueDefinition:{leave:({description:e,name:t,type:r,defaultValue:n,directives:s})=>I("",e,"\n")+S([t+": "+r,I("= ",n),S(s," ")]," ")},InterfaceTypeDefinition:{leave:({description:e,name:t,interfaces:r,directives:n,fields:s})=>I("",e,"\n")+S(["interface",t,I("implements ",S(r," & ")),S(n," "),x(s)]," ")},UnionTypeDefinition:{leave:({description:e,name:t,directives:r,types:n})=>I("",e,"\n")+S(["union",t,S(r," "),I("= ",S(n," | "))]," ")},EnumTypeDefinition:{leave:({description:e,name:t,directives:r,values:n})=>I("",e,"\n")+S(["enum",t,S(r," "),x(n)]," ")},EnumValueDefinition:{leave:({description:e,name:t,directives:r})=>I("",e,"\n")+S([t,S(r," ")]," ")},InputObjectTypeDefinition:{leave:({description:e,name:t,directives:r,fields:n})=>I("",e,"\n")+S(["input",t,S(r," "),x(n)]," ")},DirectiveDefinition:{leave:({description:e,name:t,arguments:r,repeatable:n,locations:s})=>I("",e,"\n")+"directive @"+t+(A(r)?I("(\n",T(S(r,"\n")),"\n)"):I("(",S(r,", "),")"))+(n?" repeatable":"")+" on "+S(s," | ")},SchemaExtension:{leave:({directives:e,operationTypes:t})=>S(["extend schema",S(e," "),x(t)]," ")},ScalarTypeExtension:{leave:({name:e,directives:t})=>S(["extend scalar",e,S(t," ")]," ")},ObjectTypeExtension:{leave:({name:e,interfaces:t,directives:r,fields:n})=>S(["extend type",e,I("implements ",S(t," & ")),S(r," "),x(n)]," ")},InterfaceTypeExtension:{leave:({name:e,interfaces:t,directives:r,fields:n})=>S(["extend interface",e,I("implements ",S(t," & ")),S(r," "),x(n)]," ")},UnionTypeExtension:{leave:({name:e,directives:t,types:r})=>S(["extend union",e,S(t," "),I("= ",S(r," | "))]," ")},EnumTypeExtension:{leave:({name:e,directives:t,values:r})=>S(["extend enum",e,S(t," "),x(r)]," ")},InputObjectTypeExtension:{leave:({name:e,directives:t,fields:r})=>S(["extend input",e,S(t," "),x(r)]," ")}};function S(e,t=""){var r;return null!==(r=null==e?void 0:e.filter((e=>e)).join(t))&&void 0!==r?r:""}function x(e){return I("{\n",T(S(e,"\n")),"\n}")}function I(e,t,r=""){return null!=t&&""!==t?e+t+r:""}function T(e){return I("  ",e.replace(/\n/g,"\n  "))}function A(e){var t;return null!==(t=null==e?void 0:e.some((e=>e.includes("\n"))))&&void 0!==t&&t}const D=e=>{let t;const r=e.definitions.filter((e=>"OperationDefinition"===e.kind));return 1===r.length&&(t=r[0]?.name?.value),t},P=e=>{if("string"==typeof e){let t;try{const r=(0,u.Qc)(e);t=D(r)}catch(e){}return{query:e,operationName:t}}const t=D(e);return{query:E(e),operationName:t}};class C extends Error{constructor(e,t){super(`${C.extractMessage(e)}: ${JSON.stringify({response:e,request:t})}`),Object.setPrototypeOf(this,C.prototype),this.response=e,this.request=t,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,C)}static extractMessage(e){return e.errors?.[0]?.message??`GraphQL Error (Code: ${e.status})`}}var M=r(74077),R=r.t(M,2);r(25108);const O=e=>{let t={};return e&&("undefined"!=typeof Headers&&e instanceof Headers||R&&M.Headers&&e instanceof M.Headers?t=(e=>{const t={};return e.forEach(((e,r)=>{t[r]=e})),t})(e):Array.isArray(e)?e.forEach((([e,r])=>{e&&void 0!==r&&(t[e]=r)})):t=e),t},N=e=>e.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),B=e=>async t=>{const{url:r,query:s,variables:i,operationName:o,fetch:a,fetchOptions:h,middleware:u}=t,l={...t.headers};let d,f="";"POST"===e?(d=c(s,i,o,h.jsonSerializer),"string"==typeof d&&(l["Content-Type"]="application/json")):f=(e=>{if(!Array.isArray(e.query)){const t=e,r=[`query=${encodeURIComponent(N(t.query))}`];return e.variables&&r.push(`variables=${encodeURIComponent(t.jsonSerializer.stringify(t.variables))}`),t.operationName&&r.push(`operationName=${encodeURIComponent(t.operationName)}`),r.join("&")}if(void 0!==e.variables&&!Array.isArray(e.variables))throw new Error("Cannot create query with given variable type, array expected");const t=e,r=e.query.reduce(((e,r,n)=>(e.push({query:N(r),variables:t.variables?t.jsonSerializer.stringify(t.variables[n]):void 0}),e)),[]);return`query=${encodeURIComponent(t.jsonSerializer.stringify(r))}`})({query:s,variables:i,operationName:o,jsonSerializer:h.jsonSerializer??n});const p={method:e,headers:l,body:d,...h};let g=r,m=p;if(u){const e=await Promise.resolve(u({...p,url:r,operationName:o,variables:i})),{url:t,...n}=e;g=t,m=n}return f&&(g=`${g}?${f}`),await a(g,m)};class L{constructor(e,t={}){this.url=e,this.requestConfig=t,this.rawRequest=async(...e)=>{const[t,r,n]=e,s=((e,t,r)=>e.query?e:{query:e,variables:t,requestHeaders:r,signal:void 0})(t,r,n),{headers:i,fetch:o=M,method:a="POST",requestMiddleware:c,responseMiddleware:h,...u}=this.requestConfig,{url:l}=this;void 0!==s.signal&&(u.signal=s.signal);const{operationName:d}=P(s.query);return z({url:l,query:s.query,variables:s.variables,headers:{...O(j(i)),...O(s.requestHeaders)},operationName:d,fetch:o,method:a,fetchOptions:u,middleware:c}).then((e=>(h&&h(e),e))).catch((e=>{throw h&&h(e),e}))}}async request(e,...t){const[r,n]=t,s=((e,t,r)=>e.document?e:{document:e,variables:t,requestHeaders:r,signal:void 0})(e,r,n),{headers:i,fetch:o=M,method:a="POST",requestMiddleware:c,responseMiddleware:h,...u}=this.requestConfig,{url:l}=this;void 0!==s.signal&&(u.signal=s.signal);const{query:d,operationName:f}=P(s.document);return z({url:l,query:d,variables:s.variables,headers:{...O(j(i)),...O(s.requestHeaders)},operationName:f,fetch:o,method:a,fetchOptions:u,middleware:c}).then((e=>(h&&h(e),e.data))).catch((e=>{throw h&&h(e),e}))}batchRequests(e,t){const r=((e,t)=>e.documents?e:{documents:e,requestHeaders:t,signal:void 0})(e,t),{headers:n,...s}=this.requestConfig;void 0!==r.signal&&(s.signal=r.signal);const i=r.documents.map((({document:e})=>P(e).query)),o=r.documents.map((({variables:e})=>e));return z({url:this.url,query:i,variables:o,headers:{...O(j(n)),...O(r.requestHeaders)},operationName:void 0,fetch:this.requestConfig.fetch??M,method:this.requestConfig.method||"POST",fetchOptions:s,middleware:this.requestConfig.requestMiddleware}).then((e=>(this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e.data))).catch((e=>{throw this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e}))}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,t){const{headers:r}=this.requestConfig;return r?r[e]=t:this.requestConfig.headers={[e]:t},this}setEndpoint(e){return this.url=e,this}}const z=async e=>{const{query:t,variables:r,fetchOptions:s}=e,i=B((e.method??"post").toUpperCase());const o=Array.isArray(e.query),a=await i(e),c=await F(a,s.jsonSerializer??n),h=Array.isArray(c)?!c.some((({data:e})=>!e)):Boolean(c.data),u=Array.isArray(c)||!c.errors||Array.isArray(c.errors)&&!c.errors.length||"all"===s.errorPolicy||"ignore"===s.errorPolicy;if(a.ok&&u&&h){const{errors:e,...t}=(Array.isArray(c),c),r="ignore"===s.errorPolicy?t:c;return{...o?{data:r}:r,headers:a.headers,status:a.status}}throw new C({..."string"==typeof c?{error:c}:c,status:a.status,headers:a.headers},{query:t,variables:r})};async function U(e,t,...r){const n=h(e,t,...r);return new L(n.url).request({...n})}const F=async(e,t)=>{let r;return e.headers.forEach(((e,t)=>{"content-type"===t.toLowerCase()&&(r=e)})),r&&(r.toLowerCase().startsWith("application/json")||r.toLowerCase().startsWith("application/graphql+json")||r.toLowerCase().startsWith("application/graphql-response+json"))?t.parse(await e.text()):e.text()},j=e=>"function"==typeof e?e():e},96991:function(e,t,r){"use strict";r.d(t,{r:function(){return i},$:function(){return m}});var n=r(20544),s=r(77408);class i{constructor(e,t,r=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=r,this._children=new n,this.key=null}async put(e,t){const r=await this._findNewBucketAndPos(e);await r.bucket._putAt(r,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);null!=r&&r.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((e,t)=>t instanceof i?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof i?yield*t.eachLeafSeries():yield t}serialize(e,t){return t(this._children.reduce(((r,n,s)=>(null!=n&&(n instanceof i?r.push(n.serialize(e,t)):r.push(e(n,s))),r)),[]))}async asyncTransform(e,t){return await h(this,e,t)}toJSON(){return this.serialize(a,c)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),r=t.bucket._at(t.pos);if(!(r instanceof i))return null!=r&&r.key===e?r:void 0}async _findPlace(e){const t=this._options.hash("string"==typeof e?(0,s.m)(e):e),r=await t.take(this._options.bits),n=this._children.get(r);return n instanceof i?await n._findPlace(t):{bucket:this,pos:r,hash:t,existingChild:n}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){const e=new i(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const r=await e._findPlace(t.existingChild.hash);return r.bucket._putAt(r,t.existingChild.key,t.existingChild.value),await e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,r){this._putObjectAt(e.pos,{key:t,value:r,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(o);if(null!=e&&!(e instanceof i)){const t=e.hash;t.untake(this._options.bits);const r={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(r,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function o(e){return Boolean(e)}function a(e,t){return e.key}function c(e){return e}async function h(e,t,r){const n=[];for(const s of e._children.compactArray())if(s instanceof i)await h(s,t,r);else{const r=await t(s);n.push({bitField:e._children.bitField(),children:r})}return await r(n)}const u=[255,254,252,248,240,224,192,128],l=[1,3,7,15,31,63,127,255];class d{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],n=this._currentBitPos+1,s=Math.min(n,t);r=(r<<s)+f(e,n-s,s),t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function f(e,t,r){const n=function(e,t){return u[e]&l[Math.min(t+e-1,7)]}(t,r);return(e&n)>>>t}var p=r(41690);class g{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.availableBits(),t);r=(r<<n)+e.take(n),t-=n,this._availableBits-=n,0===e.availableBits()&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.totalBits()-e.availableBits(),t);e.untake(r),t-=r,this._availableBits+=r,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?(0,p.z)([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new d(t);this._buffers.push(r),this._availableBits+=r.availableBits()}}function m(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const t={bits:e.bits??8,hash:(r=e.hashFn,function(e){return e instanceof g?e:new g(e,r)})};var r;return new i(t)}},71066:function(e,t,r){"use strict";r.d(t,{F:function(){return Ii}});var n=r(11227),s=r(38578),i=r(16459),o=r(84738);function a(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return n.enabled(`${e}:trace`)&&null!=n.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=n(`${e}:trace`)),Object.assign(n(e),{error:n(`${e}:error`),trace:t})}n.formatters.b=e=>null==e?"undefined":i.base58btc.baseEncode(e),n.formatters.t=e=>null==e?"undefined":s.base32.baseEncode(e),n.formatters.m=e=>null==e?"undefined":o.base64.baseEncode(e),n.formatters.p=e=>null==e?"undefined":e.toString(),n.formatters.c=e=>null==e?"undefined":e.toString(),n.formatters.k=e=>null==e?"undefined":e.toString(),n.formatters.a=e=>null==e?"undefined":e.toString();var c=r(66293),h=r(52292),u=r(30002),l=r(34592),d=r(19446);const f=(0,d.ET)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});(0,d.ET)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),(0,d.ET)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),(0,d.ET)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),(0,d.ET)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),(0,d.ET)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),(0,d.ET)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),(0,d.ET)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),(0,d.ET)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var p=r(77519),g=r(83747),m=r(63468),y=r(43085);const b=(e,t)=>{const{bytes:r,version:n}=e;return 0===n?k(r,v(e),t||p.i.encoder):S(r,v(e),t||f.encoder)},w=new WeakMap,v=e=>{const t=w.get(e);if(null==t){const t=new Map;return w.set(e,t),t}return t};class _{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==x)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==I)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return _.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=m.Ue(e,t);return _.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return _.equals(this,e)}static equals(e,t){const r=t;return r&&e.code===r.code&&e.version===r.version&&m.fS(e.multihash,r.multihash)}toString(e){return b(this,e)}toJSON(){return{"/":b(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof _)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:r,multihash:n,bytes:s}=t;return new _(e,r,n,s||T(e,r,n.bytes))}if(!0===t[A]){const{version:e,multihash:r,code:n}=t,s=m.Jx(r);return _.create(e,n,s)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==x)throw new Error(`Version 0 CID must use dag-pb (code: ${x}) block encoding`);return new _(e,t,r,r.bytes);case 1:{const n=T(e,t,r.bytes);return new _(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return _.create(0,x,e)}static createV1(e,t){return _.create(1,e,t)}static decode(e){const[t,r]=_.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=_.inspectBytes(e),r=t.size-t.multihashSize,n=(0,g.oQ)(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=n.subarray(t.multihashSize-t.digestSize),i=new m.zZ(t.multihashCode,t.digestSize,s,n);return[0===t.version?_.createV0(i):_.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=y.Jx(e.subarray(t));return t+=n,r};let n=r(),s=x;if(18===n?(n=0,t=0):s=r(),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,o=r(),a=r(),c=t+a;return{version:n,codec:s,multihashCode:o,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=E(e,t),s=_.decode(n);if(0===s.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return v(s).set(r,e),s}}const E=(e,t)=>{switch(e[0]){case"Q":{const r=t||p.i;return[p.i.prefix,r.decode(`${p.i.prefix}${e}`)]}case p.i.prefix:{const r=t||p.i;return[p.i.prefix,r.decode(e)]}case f.prefix:{const r=t||f;return[f.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},k=(e,t,r)=>{const{prefix:n}=r;if(n!==p.i.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const s=t.get(n);if(null==s){const s=r.encode(e).slice(1);return t.set(n,s),s}return s},S=(e,t,r)=>{const{prefix:n}=r,s=t.get(n);if(null==s){const s=r.encode(e);return t.set(n,s),s}return s},x=112,I=18,T=(e,t,r)=>{const n=y.P$(e),s=n+y.P$(t),i=new Uint8Array(s+r.byteLength);return y.mL(e,i,0),y.mL(t,i,n),i.set(r,s),i},A=Symbol.for("@ipld/js-cid/CID");var D=r(40480),P=r(49541),C=r(1546),M=r(82838),R=r(56624);n.formatters.b=e=>null==e?"undefined":p.i.baseEncode(e),n.formatters.t=e=>null==e?"undefined":f.baseEncode(e),n.formatters.m=e=>null==e?"undefined":R.US.baseEncode(e),n.formatters.p=e=>null==e?"undefined":e.toString(),n.formatters.c=e=>null==e?"undefined":e.toString(),n.formatters.k=e=>null==e?"undefined":e.toString(),n.formatters.a=e=>null==e?"undefined":e.toString();var O=r(73062),N=r(21787);const B=(e,t)=>{const r=["bitswap"];return null!=t&&r.push(t),null!=e&&r.push(`${e.toString().slice(0,8)}`),function(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return n.enabled(`${e}:trace`)&&null!=n.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=n(`${e}:trace`)),Object.assign(n(e),{error:n(`${e}:error`),trace:t})}(r.join(":"))},L=(e,t)=>{if(e.size!==t.size)return!1;for(const[r,n]of e){const e=t.get(r);if(void 0===e)return!1;if(n instanceof Uint8Array&&e instanceof Uint8Array&&!(0,O.f)(n,e))return!1;if(n instanceof N.b&&e instanceof N.b&&!n.equals(e))return!1}return!0};var z=r(70925),U=r(56880);class F{static Entry=N.b;static WantType={Block:U.v.Wantlist.WantType.Block,Have:U.v.Wantlist.WantType.Have};static BlockPresenceType={Have:U.v.BlockPresenceType.Have,DontHave:U.v.BlockPresenceType.DontHave};static deserialize=async(e,t)=>{const r=U.v.decode(e),n=!0===r.wantlist?.full,s=new F(n);return r.wantlist?.entries.forEach((e=>{if(null==e.block)return;const t=_.decode(e.block);s.addEntry(t,e.priority??0,e.wantType,Boolean(e.cancel),Boolean(e.sendDontHave))})),r.blockPresences.forEach((e=>{if(null==e.cid)return;const t=_.decode(e.cid);e.type===F.BlockPresenceType.Have?s.addHave(t):s.addDontHave(t)})),r.blocks.length>0?(await Promise.all(r.blocks.map((async e=>{const t=await C.J.digest(e),r=_.createV0(t);s.addBlock(r,e)}))),s):r.payload.length>0?(await Promise.all(r.payload.map((async e=>{if(null==e.prefix||null==e.data)return;const r=M(e.prefix),n=r[0],i=r[1],o=r[2],a=o===C.J.code?C.J:await(t?.getHasher(o));if(null==a)throw new P.sv("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");const c=await a.digest(e.data),h=_.create(n,i,c);s.addBlock(h,e.data)}))),s.setPendingBytes(r.pendingBytes),s):s};static blockPresenceSize=e=>e.bytes.length+1;full;wantlist;blocks;blockPresences;pendingBytes;constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}addEntry(e,t,r,n,s){null==r&&(r=F.WantType.Block);const i=e.toString(p.i),o=this.wantlist.get(i);null!=o?(o.wantType===r&&(o.priority=t),!0===n&&(o.cancel=Boolean(n)),!0===s&&(o.sendDontHave=Boolean(s)),r===F.WantType.Block&&o.wantType===F.WantType.Have&&(o.wantType=r)):this.wantlist.set(i,new N.b(e,t,r,n,s))}addBlock(e,t){const r=e.toString(p.i);this.blocks.set(r,t)}addHave(e){const t=e.toString(p.i);this.blockPresences.has(t)||this.blockPresences.set(t,F.BlockPresenceType.Have)}addDontHave(e){const t=e.toString(p.i);this.blockPresences.has(t)||this.blockPresences.set(t,F.BlockPresenceType.DontHave)}cancel(e){const t=e.toString(p.i);this.wantlist.delete(t),this.addEntry(e,0,F.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){return U.v.encode({wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),cancel:Boolean(e.cancel),wantType:U.v.Wantlist.WantType.Block,sendDontHave:!1}))),full:Boolean(this.full)},blocks:Array.from(this.blocks.values())})}serializeToBitswap110(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),wantType:e.wantType,cancel:Boolean(e.cancel),sendDontHave:Boolean(e.sendDontHave)}))),full:Boolean(this.full)},blockPresences:[],payload:[],pendingBytes:this.pendingBytes,blocks:[]};for(const[t,r]of this.blocks.entries()){const n=_.parse(t),s=n.version,i=n.code,o=n.multihash.code,a=n.multihash.digest.length,c=(0,z.Z)([s,i,o,a]);e.payload.push({prefix:c,data:r})}for(const[t,r]of this.blockPresences)e.blockPresences.push({cid:_.parse(t).bytes,type:r});return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),U.v.encode(e)}equals(e){return!!(this.full===e.full&&this.pendingBytes===e.pendingBytes&&L(this.wantlist,e.wantlist)&&L(this.blocks,e.blocks)&&L(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){const e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}}var j=r(28807);const V=U.v.Wantlist.WantType.Block,W=U.v.Wantlist.WantType.Have;class ${static Entry=j.D;set;_stats;constructor(e,t){this.set=null!=t?(0,D.s)({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,r){const n=e.toString(p.i),s=this.set.get(n);null!=s?(s.inc(),s.priority=t,s.wantType===W&&r===V&&(s.wantType=r)):(this.set.set(n,new j.D(e,t,r)),null!=this._stats&&this._stats.push(void 0,"wantListSize",1))}remove(e){const t=e.toString(p.i),r=this.set.get(t);null!=r&&(r.dec(),r.hasRefs()||(this.set.delete(t),null!=this._stats&&this._stats.push(void 0,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map((e=e=>e[1].key,t=Array.from(this.set.entries()),Array.prototype.slice.call(t,0).sort(((t,r)=>{const n=e(t),s=e(r);return n<s?-1:n>s?1:0}))));var e,t}contains(e){const t=e.toString(p.i);return this.set.has(t)}get(e){const t=e.toString(p.i);return this.set.get(t)}}class q{partner;wantlist;exchangeCount;accounting;lastExchange;constructor(e){this.partner=e,this.wantlist=new $,this.exchangeCount=0,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}wants(e,t,r){this.wantlist.add(e,t,r)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class K extends Map{_cmp;_keys;constructor(e,t){super(),this._cmp=t??this._defaultSort,this._keys=[];for(const[t,r]of e??[])this.set(t,r)}update(e){if(e<0||e>=this._keys.length)return;const t=this._keys[e];this._keys.splice(e,1);const r=this._find(t);this._keys.splice(r,0,t)}set(e,t){if(this.has(e)){const t=this.indexOf(e);this._keys.splice(t,1)}super.set(e,t);const r=this._find(e);return this._keys.splice(r,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;const t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;const t=this._find(e);if(this._keys[t]===e)return t;for(let r=1;r<this._keys.length;r++){if(this._keys[t+r]===e)return t+r;if(this._keys[t-r]===e)return t-r}return-1}_find(e){let t=0,r=this._keys.length;for(;t<r;){const n=t+r>>>1,s=this._kCmp(this._keys[n],e);if(s<0)t=n+1;else{if(!(s>0))return n;r=n}}return t}*keys(){for(const e of this._keys)yield e}*values(){for(const e of this._keys)yield this.get(e)}*entries(){for(const e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t=this){if(null!=e)for(const r of this._keys){const n=this.get(r);if(null==n)throw new Error("Value cannot be undefined");e.apply(t,[[r,n]])}}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}}const H={hasNewInfo:()=>!1,merge(){}};class G{_taskMerger;_byPeer;constructor(e=H){this._taskMerger=e,this._byPeer=new K([],J.compare)}pushTasks(e,t){let r=this._byPeer.get(e.toString());null==r&&(r=new J(e,this._taskMerger)),r.pushTasks(t),this._byPeer.set(e.toString(),r)}popTasks(e){const t=this._head();if(void 0===t)return{tasks:[],pendingSize:0};const{tasks:r,pendingSize:n}=t.popTasks(e);if(0===r.length)return{tasks:r,pendingSize:n};const s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toString()):this._byPeer.update(0),{peerId:s,tasks:r,pendingSize:n}}_head(){if(0!==this._byPeer.size)for(const[,e]of this._byPeer)return e}remove(e,t){const r=this._byPeer.get(t.toString());r?.remove(e)}tasksDone(e,t){const r=this._byPeer.get(e.toString());if(null==r)return;const n=this._byPeer.indexOf(e.toString());for(const e of t)r.taskDone(e);this._byPeer.update(n)}}class J{peerId;_taskMerger;_activeTotalSize;_pending;_active;constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new Z,this._active=new Set}pushTasks(e){for(const t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;const t=this._pending.get(e.topic);if(null!=t)return e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),void this._taskMerger.merge(e,t);this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){const t=[];for(const r of this._active)r.topic===e.topic&&t.push(r);return 0===t.length||this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0;const r=[],n=this._pending.tasks();for(let s=0;s<n.length&&t<e;s++){const e=n[s];r.push(e),t+=e.size,this._pending.delete(e.topic),this._activeTotalSize+=e.size,this._active.add(e)}return{tasks:r,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return 0===this._pending.length&&0===this._active.size}static compare(e,t){return 0===e[1]._pending.length?1:0===t[1]._pending.length?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}}class Z{_tasks;constructor(){this._tasks=new K([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce(((e,t)=>e+t.task.size),0)}get(e){return this._tasks?.get(e)?.task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map((e=>e.task))}updatePriority(e,t){const r=this._tasks.get(e);if(null==r)return;const n=this._tasks.indexOf(e);r.task.priority=t,this._tasks.update(n)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}}const Q={hasNewInfo(e,t){let r=!1,n=!1;for(const e of t)e.data.haveBlock&&(r=!0),e.data.isWantBlock&&(n=!0);return!(n||!e.data.isWantBlock)||!(r||!e.data.haveBlock)},merge(e,t){const r=e.data,n=t.data;!n.haveBlock&&r.haveBlock&&(n.haveBlock=r.haveBlock,n.blockSize=r.blockSize),!n.isWantBlock&&r.isWantBlock&&(n.isWantBlock=!0,n.haveBlock&&!r.haveBlock||(n.haveBlock=r.haveBlock,t.size=e.size)),n.isWantBlock&&n.haveBlock&&(t.size=n.blockSize)}},Y=F.WantType;class X{_log;blockstore;network;_stats;_opts;ledgerMap;_running;_requestQueue;constructor(e,t,r,n,s,i={}){this._log=B(e,"engine"),this.blockstore=t,this.network=r,this._stats=n,this._opts=this._processOpts(i),this.ledgerMap=(0,D.s)({name:"ipfs_bitswap_ledger_map",metrics:s.metrics}),this._running=!1,this._requestQueue=new G(Q)}_processOpts(e){return{maxSizeReplaceHasWithBlock:1024,targetMessageSize:16384,...e}}_scheduleProcessTasks(){setTimeout((()=>{this._processTasks().catch((e=>{this._log.error("error processing stats",e)}))}))}async _processTasks(){if(!this._running)return;const{peerId:e,tasks:t,pendingSize:r}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(0===t.length)return;const n=new F(!1);n.setPendingBytes(r);const s=[],i=new Map;for(const e of t){const t=_.parse(e.topic);e.data.haveBlock?e.data.isWantBlock?(s.push(t),i.set(e.topic,e.data)):n.addHave(t):n.addDontHave(t)}const o=await this._getBlocks(s);for(const[e,t]of i){const r=_.parse(e),s=o.get(e);null!=s?n.addBlock(r,s):t.sendDontHave&&n.addDontHave(r)}if(n.empty)return null!=e&&this._requestQueue.tasksDone(e,t),void this._scheduleProcessTasks();try{null!=e&&await this.network.sendMessage(e,n);for(const[t,r]of o.entries())null!=e&&this.messageSent(e,_.parse(t),r)}catch(e){this._log.error(e)}null!=e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){const t=e.toString(),r=this.ledgerMap.get(t);return null!=r?r.wantlist.sortedEntries():new Map}ledgerForPeer(e){const t=e.toString(),r=this.ledgerMap.get(t);if(null!=r)return{peer:r.partner,value:r.debtRatio(),sent:r.accounting.bytesSent,recv:r.accounting.bytesRecv,exchanged:r.exchangeCount}}peers(){return Array.from(this.ledgerMap.values()).map((e=>e.partner))}receivedBlocks(e){if(0!==e.length){for(const t of this.ledgerMap.values())for(const{cid:r,block:n}of e){const e=t.wantlistContains(r);if(null==e)continue;const s=n.length,i=this._sendAsBlock(e.wantType,s);let o=s;i||(o=F.blockPresenceSize(e.cid)),this._requestQueue.pushTasks(t.partner,[{topic:e.cid.toString(p.i),priority:e.priority,size:o,data:{blockSize:s,isWantBlock:i,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){const r=this._findOrCreate(e);if(t.empty)return;if(t.full&&(r.wantlist=new $),this._updateBlockAccounting(t.blocks,r),0===t.wantlist.size)return void this._scheduleProcessTasks();const n=[],s=[];t.wantlist.forEach((e=>{e.cancel?(r.cancelWant(e.cid),n.push(e.cid)):(r.wants(e.cid,e.priority,e.wantType),s.push(e))})),this._cancelWants(e,n),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(const r of t)this._requestQueue.remove(r.toString(p.i),e)}async _addWants(e,t){const r=await this._getBlockSizes(t.map((e=>e.cid))),n=[];for(const s of t){const t=s.cid.toString(p.i),i=r.get(t);if(null==i)s.sendDontHave&&n.push({topic:t,priority:s.priority,size:F.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===Y.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{const e=this._sendAsBlock(s.wantType,i);let r=i;e||(r=F.blockPresenceSize(s.cid)),n.push({topic:t,priority:s.priority,size:r,data:{isWantBlock:e,blockSize:i,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,n)}}_sendAsBlock(e,t){return e===Y.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){const t=await this._getBlocks(e);return new Map([...t].map((([e,t])=>[e,t.length])))}async _getBlocks(e){const t=new Map;return await Promise.all(e.map((async e=>{try{const r=await this.blockstore.get(e);t.set(e.toString(p.i),r)}catch(t){"ERR_NOT_FOUND"!==t.code&&this._log.error("failed to query blockstore for %s: %s",e,t)}}))),t}_updateBlockAccounting(e,t){for(const r of e.values())this._log("got block (%s bytes)",r.length),t.receivedBytes(r.length)}messageSent(e,t,r){const n=this._findOrCreate(e);n.sentBytes(r.length),n.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){const t=e.toString(),r=this.ledgerMap.get(t);if(null!=r)return r;const n=new q(e);return this.ledgerMap.set(t,n),null!=this._stats&&this._stats.push(t,"peerCount",1),n}start(){this._running=!0}stop(){this._running=!1}}var ee=r(93361),te=r(91893),re=r(96932),ne=r(90212),se=r(57514),ie=r(43905),oe=r(10715);const ae=Math.pow(2,31)-1,ce="/ipfs/bitswap/1.0.0",he="/ipfs/bitswap/1.1.0",ue="/ipfs/bitswap/1.2.0";class le{_log;_libp2p;_bitswap;_protocols;_stats;_running;_hashLoader;_maxInboundStreams;_maxOutboundStreams;_incomingStreamTimeout;_registrarIds;constructor(e,t,r,n={}){this._log=B(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[ce],!0!==n.b100Only&&(this._protocols.unshift(he),this._protocols.unshift(ue)),this._stats=r,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=n.hashLoader??{async getHasher(){throw new Error("Not implemented")}},this._maxInboundStreams=n.maxInboundStreams??1024,this._maxOutboundStreams=n.maxOutboundStreams??1024,this._incomingStreamTimeout=n.incomingStreamTimeout??3e4}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});const e={onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect};this._registrarIds=[];for(const t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach((e=>{this._onPeerConnect(e.remotePeer)}))}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),null!=this._registrarIds){for(const e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection(e){if(!this._running)return;const{stream:t,connection:r}=e,n=new oe.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then((async()=>{this._log("incoming new bitswap %s connection from %p",t.protocol,r.remotePeer);const e=()=>{t.abort(new P.sv("Incoming Bitswap stream timed out","ERR_TIMEOUT"))};let n=AbortSignal.timeout(this._incomingStreamTimeout);n.addEventListener("abort",e),await(0,ne.z)(t,(e=>te.J(e)),(async t=>{for await(const s of t){try{const e=await F.deserialize(s.subarray(),this._hashLoader);await this._bitswap._receiveMessage(r.remotePeer,e)}catch(e){this._bitswap._receiveError(e);break}n.removeEventListener("abort",e),n=AbortSignal.timeout(this._incomingStreamTimeout),n.addEventListener("abort",e)}})),await t.close({signal:n})})).catch((e=>{this._log(e),t.abort(e)})).finally((()=>{n.clear()}))}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return t.onProgress?.(new ie.V("bitswap:network:find-providers",e)),this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){await(0,ee.Z)((0,se.Z)((0,re.Z)(this.findProviders(e,t),(async e=>this.connectTo(e.id,t).catch((e=>{this._log.error(e)})))),3)).catch((e=>{this._log.error(e)}))}async provide(e,t={}){t.onProgress?.(new ie.V("bitswap:network:provide",e)),await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t,r={}){if(!this._running)throw new Error("network isn't running");const n=e.toString();this._log("sendMessage to %s",n,t),r.onProgress?.(new ie.V("bitswap:network:send-wantlist",e)),await this._writeMessage(e,t,r),this._updateSentStats(e,t.blocks)}async connectTo(e,t={}){if(!this._running)throw new Error("network isn't running");return t.onProgress?.(new ie.V("bitswap:network:dial",e)),this._libp2p.dial(e,t)}_updateSentStats(e,t){const r=e.toString();if(null!=this._stats){for(const e of t.values())this._stats.push(r,"dataSent",e.length);this._stats.push(r,"blocksSent",t.size)}}async _writeMessage(e,t,r={}){const n=await this._libp2p.dialProtocol(e,[ue,he,ce]);try{let e;switch(n.protocol){case ce:e=t.serializeToBitswap100();break;case he:case ue:e=t.serializeToBitswap110();break;default:throw new Error(`Unknown protocol: ${n.protocol}`)}await(0,ne.z)([e],(e=>te.c(e)),n),await n.close()}catch(t){r.onProgress?.(new ie.V("bitswap:network:send-wantlist:error",{peer:e,error:t})),this._log(t),n.abort(t)}}}var de=r(17187),fe=r(49784);const pe=e=>`unwant:${(0,fe.B)(e.multihash.bytes,"base64")}`,ge=e=>`block:${(0,fe.B)(e.multihash.bytes,"base64")}`;class me extends de.EventEmitter{_log;constructor(e){super(),this.setMaxListeners(1e3),this._log=B(e,"notif")}hasBlock(e,t){const r=ge(e);this._log(r),this.emit(r,t)}async wantBlock(e,t={}){if(null==e)throw new Error("Not a valid cid");const r=ge(e),n=pe(e);return this._log(`wantBlock:${e}`),new Promise(((s,i)=>{const o=()=>{this.removeListener(r,a),t.onProgress?.(new ie.V("bitswap:want-block:unwant",e)),i(new Error(`Block for ${e} unwanted`))},a=r=>{this.removeListener(n,o),t.onProgress?.(new ie.V("bitswap:want-block:block",e)),s(r)};this.once(n,o),this.once(r,a),t.signal?.addEventListener("abort",(()=>{this.removeListener(r,a),this.removeListener(n,o),i(new Error(`Want for ${e} aborted`))}))}))}unwantBlock(e){const t=pe(e);this._log(t),this.emit(t)}}var ye=r(63573);class be extends de.EventEmitter{_options;_queue;_stats;_frequencyLastTime;_frequencyAccumulators;_movingAverages;_enabled;_timeout;constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach((e=>{this._stats[e]=BigInt(0),this._movingAverages[e]={},this._options.movingAverageIntervals.forEach((t=>{(this._movingAverages[e][t]=ye(t)).push(this._frequencyLastTime,0)}))})),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._enabled=!1}stop(){null!=this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=void 0,this._queue.length>0){let e;for(;this._queue.length>0;){const t=e=this._queue.shift();null!=t&&this._applyOp(t)}null!=e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;t>0&&Object.keys(this._stats).forEach((r=>{this._updateFrequencyFor(r,t,e)})),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this._frequencyAccumulators[e]??0;this._frequencyAccumulators[e]=0;const s=n/t*1e3;let i=this._movingAverages[e];null==i&&(i=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach((e=>{let t=i[e];null==t&&(t=i[e]=ye(e)),t.push(r,s)}))}_applyOp(e){const t=e[0],r=e[1];if("number"!=typeof r)throw new Error(`invalid increment number: ${r}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(r),null==this._frequencyAccumulators[t]&&(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}const we={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[6e4,3e5,9e5]};class ve extends de.EventEmitter{_initialCounters;_options;_enabled;_global;_peers;constructor(e,t=[],r=we){super();const n=Object.assign({},we,r);if("number"!=typeof n.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!=typeof n.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=n,this._enabled=this._options.enabled,this._global=new be(t,n),this._global.on("update",(e=>this.emit("update",e))),this._peers=(0,D.s)({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(const e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){const t=e.toString();return this._peers.get(t)}push(e,t,r){if(this._enabled&&(this._global.push(t,r),null!=e)){let n=this._peers.get(e);null==n&&(n=new be(this._initialCounters,this._options),this._peers.set(e,n)),n.push(t,r)}}disconnected(e){const t=e.toString(),r=this._peers.get(t);null!=r&&(r.stop(),this._peers.delete(t))}}var _e=r(24810);class Ee{peerId;refcnt;network;_entries;_log;constructor(e,t,r){this.peerId=t,this.network=r,this.refcnt=1,this._entries=[],this._log=B(e,"msgqueue"),this.sendEntries=(0,_e.Z)(this.sendEntries.bind(this),1)}addMessage(e,t={}){e.empty||this.send(e,t)}addEntries(e,t={}){this._entries=this._entries.concat(e),this.sendEntries(t)}sendEntries(e={}){if(0===this._entries.length)return;const t=new F(!1);this._entries.forEach((e=>{!0===e.cancel?t.cancel(e.cid):t.addEntry(e.cid,e.priority)})),this._entries=[],this.addMessage(t,e)}async send(e,t={}){try{await this.network.connectTo(this.peerId,t)}catch(e){return void this._log.error("cant connect to peer %p: %s",this.peerId,e.message)}this._log("sending message to peer %p",this.peerId),this.network.sendMessage(this.peerId,e,t).catch((e=>{this._log.error("send error",e)}))}}class ke{peers;wantlist;network;_peerId;_log;constructor(e,t,r,n){this.peers=(0,D.s)({name:"ipfs_bitswap_want_manager_peers",metrics:n.metrics}),this.wantlist=new $(r,n),this.network=t,this._peerId=e,this._log=B(e,"want")}_addEntries(e,t,r,n={}){const s=e.map(((e,r)=>new F.Entry(e,ae-r,F.WantType.Block,t)));s.forEach((e=>{e.cancel?!0===r?this.wantlist.removeForce(e.cid.toString(p.i)):this.wantlist.remove(e.cid):(this._log("adding to wantlist"),this.wantlist.add(e.cid,e.priority))}));for(const e of this.peers.values())e.addEntries(s,n)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(null!=t)return void t.refcnt++;t=new Ee(this._peerId,e,this.network);const r=new F(!0);for(const e of this.wantlist.entries())r.addEntry(e[1].cid,e[1].priority);return t.addMessage(r),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toString());null!=t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1,!1,t),t.signal?.addEventListener("abort",(()=>{this.cancelWants(e)}))}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach((e=>{this.disconnected(e.peerId)}))}}const Se={maxInboundStreams:1024,maxOutboundStreams:1024,incomingStreamTimeout:3e4,hashLoader:{async getHasher(){throw new Error("Not implemented")}},statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},xe=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class Ie{_libp2p;_log;stats;network;blockstore;engine;wm;notifications;started;constructor(e,t,r={}){this._libp2p=e,this._log=B(this.peerId),r=Object.assign({},Se,r),this.stats=new ve(e,xe,{enabled:r.statsEnabled,computeThrottleTimeout:r.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:r.statsComputeThrottleMaxQueueSize}),this.network=new le(e,this,this.stats,{hashLoader:r.hashLoader,maxInboundStreams:r.maxInboundStreams,maxOutboundStreams:r.maxOutboundStreams,incomingStreamTimeout:r.incomingStreamTimeout}),this.blockstore=t,this.engine=new X(this.peerId,t,this.network,this.stats,e),this.wm=new ke(this.peerId,this.network,this.stats,e),this.notifications=new me(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(e){this._log("failed to receive message",t)}if(0===t.blocks.size)return;const r=[];for(const[e,n]of t.blocks.entries()){const t=_.parse(e);r.push({wasWanted:this.wm.wantlist.contains(t),cid:t,data:n})}this.wm.cancelWants(r.filter((({wasWanted:e})=>e)).map((({cid:e})=>e))),await Promise.all(r.map((async({cid:t,wasWanted:r,data:n})=>{await this._handleReceivedBlock(e,t,n,r)})))}async _handleReceivedBlock(e,t,r,n){this._log("received block");const s=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,r,s),n&&await this.put(t,r)}_updateReceiveCounters(e,t,r,n){this.stats.push(e,"blocksReceived",1),this.stats.push(e,"dataReceived",r.length),n&&(this.stats.push(e,"dupBlksReceived",1),this.stats.push(e,"dupDataReceived",r.length))}_receiveError(e){this._log.error("ReceiveError",e)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this.stats.disconnected(e)}enableStats(){this.stats.enable()}disableStats(){this.stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async want(e,t={}){const r=async(e,t)=>(this.wm.wantBlocks([e],t),this.notifications.wantBlock(e,t));let n=!1;const s=async(e,t)=>{try{return await this.blockstore.get(e,t)}catch(s){if("ERR_NOT_FOUND"!==s.code)throw s;return n||(n=!0,this.network.findAndConnect(e,t).catch((e=>{this._log.error(e)}))),await r(e,t)}},i=new AbortController,o=(0,u.N)([i.signal,t.signal]);try{return await Promise.race([this.notifications.wantBlock(e,{...t,signal:o}),s(e,{...t,signal:o})])}finally{i.abort(),o.clear()}}unwant(e){const t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach((e=>{this.notifications.unwantBlock(e)}))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,r){await this.blockstore.put(e,t),this.notify(e,t)}async*putMany(e,t){yield*this.blockstore.putMany((0,l.Z)(e,(({cid:e,block:t})=>{this.notify(e,t)})),t)}notify(e,t,r={}){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,block:t}]),this.network.provide(e,r).catch((e=>{this._log.error("Failed to provide: %s",e.message)}))}getWantlist(){return this.wm.wantlist.entries()}get peers(){return this.engine.peers()}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this.stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}}var Te,Ae=r(94688),De=r(5879),Pe=r(96984),Ce=r(8487),Me=r(70306),Re=r(26199),Oe=r(69736),Ne=r(85275),Be=r(85923),Le=r.n(Be),ze=r(71198),Ue=r(5689),Fe=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Te=new WeakMap;var je,Ve,We,$e,qe,Ke,He,Ge,Je,Ze,Qe,Ye,Xe,et,tt,rt,nt,st,it,ot,at,ct,ht,ut,lt,dt,ft=class{constructor(){Te.set(this,[])}enqueue(e,t){const r={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&Fe(this,Te,"f")[this.size-1].priority>=t.priority)return void Fe(this,Te,"f").push(r);const n=(0,Ue.Z)(Fe(this,Te,"f"),r,((e,t)=>t.priority-e.priority));Fe(this,Te,"f").splice(n,0,r)}dequeue(){const e=Fe(this,Te,"f").shift();return null==e?void 0:e.run}filter(e){return Fe(this,Te,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return Fe(this,Te,"f").length}},pt=function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},gt=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class mt extends Error{}class yt extends(Le()){constructor(e){var t,r,n,s;if(super(),je.add(this),Ve.set(this,void 0),We.set(this,void 0),$e.set(this,0),qe.set(this,void 0),Ke.set(this,void 0),He.set(this,0),Ge.set(this,void 0),Je.set(this,void 0),Ze.set(this,void 0),Qe.set(this,void 0),Ye.set(this,0),Xe.set(this,void 0),et.set(this,void 0),tt.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:ft,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(s=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==s?s:""}\` (${typeof e.interval})`);pt(this,Ve,e.carryoverConcurrencyCount,"f"),pt(this,We,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),pt(this,qe,e.intervalCap,"f"),pt(this,Ke,e.interval,"f"),pt(this,Ze,new e.queueClass,"f"),pt(this,Qe,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,pt(this,tt,!0===e.throwOnTimeout,"f"),pt(this,et,!1===e.autoStart,"f")}get concurrency(){return gt(this,Xe,"f")}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);pt(this,Xe,e,"f"),gt(this,je,"m",ut).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:gt(this,tt,"f"),...t},new Promise(((r,n)=>{gt(this,Ze,"f").enqueue((async()=>{var s,i,o;pt(this,Ye,(i=gt(this,Ye,"f"),++i),"f"),pt(this,$e,(o=gt(this,$e,"f"),++o),"f");try{if(null===(s=t.signal)||void 0===s?void 0:s.aborted)throw new mt("The task was aborted.");let n=e({signal:t.signal});t.timeout&&(n=(0,ze.ZP)(Promise.resolve(n),t.timeout)),t.signal&&(n=Promise.race([n,gt(this,je,"m",lt).call(this,t.signal)]));const i=await n;r(i),this.emit("completed",i)}catch(e){if(e instanceof ze.W5&&!t.throwOnTimeout)return void r();n(e),this.emit("error",e)}finally{gt(this,je,"m",st).call(this)}}),t),this.emit("add"),gt(this,je,"m",at).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return gt(this,et,"f")?(pt(this,et,!1,"f"),gt(this,je,"m",ut).call(this),this):this}pause(){pt(this,et,!0,"f")}clear(){pt(this,Ze,new(gt(this,Qe,"f")),"f")}async onEmpty(){0!==gt(this,Ze,"f").size&&await gt(this,je,"m",dt).call(this,"empty")}async onSizeLessThan(e){gt(this,Ze,"f").size<e||await gt(this,je,"m",dt).call(this,"next",(()=>gt(this,Ze,"f").size<e))}async onIdle(){0===gt(this,Ye,"f")&&0===gt(this,Ze,"f").size||await gt(this,je,"m",dt).call(this,"idle")}get size(){return gt(this,Ze,"f").size}sizeBy(e){return gt(this,Ze,"f").filter(e).length}get pending(){return gt(this,Ye,"f")}get isPaused(){return gt(this,et,"f")}}Ve=new WeakMap,We=new WeakMap,$e=new WeakMap,qe=new WeakMap,Ke=new WeakMap,He=new WeakMap,Ge=new WeakMap,Je=new WeakMap,Ze=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,Xe=new WeakMap,et=new WeakMap,tt=new WeakMap,je=new WeakSet,rt=function(){return gt(this,We,"f")||gt(this,$e,"f")<gt(this,qe,"f")},nt=function(){return gt(this,Ye,"f")<gt(this,Xe,"f")},st=function(){var e;pt(this,Ye,(e=gt(this,Ye,"f"),--e),"f"),gt(this,je,"m",at).call(this),this.emit("next")},it=function(){gt(this,je,"m",ht).call(this),gt(this,je,"m",ct).call(this),pt(this,Je,void 0,"f")},ot=function(){const e=Date.now();if(void 0===gt(this,Ge,"f")){const t=gt(this,He,"f")-e;if(!(t<0))return void 0===gt(this,Je,"f")&&pt(this,Je,setTimeout((()=>{gt(this,je,"m",it).call(this)}),t),"f"),!0;pt(this,$e,gt(this,Ve,"f")?gt(this,Ye,"f"):0,"f")}return!1},at=function(){if(0===gt(this,Ze,"f").size)return gt(this,Ge,"f")&&clearInterval(gt(this,Ge,"f")),pt(this,Ge,void 0,"f"),this.emit("empty"),0===gt(this,Ye,"f")&&this.emit("idle"),!1;if(!gt(this,et,"f")){const e=!gt(this,je,"a",ot);if(gt(this,je,"a",rt)&&gt(this,je,"a",nt)){const t=gt(this,Ze,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&gt(this,je,"m",ct).call(this),!0)}}return!1},ct=function(){gt(this,We,"f")||void 0!==gt(this,Ge,"f")||(pt(this,Ge,setInterval((()=>{gt(this,je,"m",ht).call(this)}),gt(this,Ke,"f")),"f"),pt(this,He,Date.now()+gt(this,Ke,"f"),"f"))},ht=function(){0===gt(this,$e,"f")&&0===gt(this,Ye,"f")&&gt(this,Ge,"f")&&(clearInterval(gt(this,Ge,"f")),pt(this,Ge,void 0,"f")),pt(this,$e,gt(this,Ve,"f")?gt(this,Ye,"f"):0,"f"),gt(this,je,"m",ut).call(this)},ut=function(){for(;gt(this,je,"m",at).call(this););},lt=async function(e){return new Promise(((t,r)=>{e.addEventListener("abort",(()=>{r(new mt("The task was aborted."))}),{once:!0})}))},dt=async function(e,t){return new Promise((r=>{const n=()=>{t&&!t()||(this.off(e,n),r())};this.on(e,n)}))};var bt=yt,wt=r(76944);const vt=[wt.Zr,wt.AW,wt.H0,wt.bY,wt.eN],_t="/pin/",Et="/pinned-block/",kt=Re.base36;function St(e){return 0===e.version&&(e=e.toV1()),new Me.s(`${_t}${e.toString(kt)}`)}class xt{datastore;blockstore;dagWalkers;constructor(e,t,r){this.datastore=e,this.blockstore=t,this.dagWalkers={},[...vt,...r].forEach((e=>{this.dagWalkers[e.codec]=e}))}async add(e,t={}){const r=St(e);if(await this.datastore.has(r))throw new Error("Already pinned");const n=Math.round(t.depth??1/0);if(n<0)throw new Error("Depth must be greater than or equal to 0");const s=new bt({concurrency:1});s.add((async()=>{await this.#n(e,s,(t=>{null==t.pinnedBy.find((t=>(0,O.f)(t,e.bytes)))&&(t.pinCount++,t.pinnedBy.push(e.bytes))}),{...t,depth:n})}));const i=(0,Ne.Z)();s.on("error",(e=>{s.clear(),i.reject(e)})),await Promise.race([s.onIdle(),i.promise]);const o={depth:n,metadata:t.metadata??{}};return await this.datastore.put(r,Ce.cv(o),t),{cid:e,...o}}async#n(e,t,r,n){if(-1===n.depth)return;const s=this.dagWalkers[e.code];if(null==s)throw new Error(`No dag walker found for cid codec ${e.code}`);const i=await this.blockstore.get(e,n);await this.#s(e,r,n);for await(const e of s.walk(i))t.add((async()=>{await this.#n(e,t,r,{...n,depth:n.depth-1})}))}async#s(e,t,r){const n=new Me.s(`${Et}${kt.encode(e.multihash.bytes)}`);let s={pinCount:0,pinnedBy:[]};try{s=Ce.Jx(await this.datastore.get(n,r))}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}t(s),0===s.pinCount&&await this.datastore.has(n)?await this.datastore.delete(n):(await this.datastore.put(n,Ce.cv(s),r),r.onProgress?.(new ie.V("helia:pin:add",{detail:e})))}async rm(e,t={}){const r=St(e),n=await this.datastore.get(r,t),s=Ce.Jx(n);await this.datastore.delete(r,t);const i=new bt({concurrency:1});return i.add((async()=>{await this.#n(e,i,(t=>{t.pinCount--,t.pinnedBy=t.pinnedBy.filter((t=>(0,O.f)(t,e.bytes)))}),{...t,depth:s.depth})})),await i.onIdle(),{cid:e,...s}}async*ls(e={}){for await(const{key:t,value:r}of this.datastore.query({prefix:_t+(null!=e.cid?`${e.cid.toString(Re.base36)}`:"")},e)){const e=Oe.k0.parse(t.toString().substring(5),Re.base36),n=Ce.Jx(r);yield{cid:e,...n}}}async isPinned(e,t={}){const r=new Me.s(`${Et}${kt.encode(e.multihash.bytes)}`);return this.datastore.has(r,t)}}var It=r(56027);class Tt{lock;child;pins;constructor(e,t,r={}){this.child=e,this.pins=t,this.lock=(0,It.Z)({singleProcess:r.holdGcLock})}unwrap(){return this.child}async put(e,t,r={}){const n=await this.lock.readLock();try{return await this.child.put(e,t,r)}finally{n()}}async*putMany(e,t={}){const r=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{r()}}async get(e,t={}){const r=await this.lock.readLock();try{return await this.child.get(e,t)}finally{r()}}async*getMany(e,t={}){const r=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{r()}}async delete(e,t={}){const r=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{r()}}async*deleteMany(e,t={}){const r=await this.lock.writeLock();try{const r=this;yield*this.child.deleteMany(async function*(){for await(const t of e){if(await r.pins.isPinned(t))throw new Error("CID was pinned");yield t}}(),t)}finally{r()}}async has(e,t={}){const r=await this.lock.readLock();try{return await this.child.has(e,t)}finally{r()}}async*getAll(e={}){const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}}var At=r(77408);const Dt=new Me.s("/version");var Pt=r(27771),Ct=r(28587);class Mt{child;bitswap;constructor(e,t={}){this.child=e,this.bitswap=t.bitswap}unwrap(){return this.child}async put(e,t,r={}){return await this.child.has(e)?(r.onProgress?.(new ie.V("blocks:put:duplicate",e)),e):(!0===this.bitswap?.isStarted()&&(r.onProgress?.(new ie.V("blocks:put:bitswap:notify",e)),this.bitswap.notify(e,t,r)),r.onProgress?.(new ie.V("blocks:put:blockstore:put",e)),this.child.put(e,t,r))}async*putMany(e,t={}){const r=(0,Pt.Z)(e,(async({cid:e})=>{const r=await this.child.has(e);return r&&t.onProgress?.(new ie.V("blocks:put-many:duplicate",e)),!r})),n=(0,Ct.Z)(r,(({cid:e,block:r})=>{t.onProgress?.(new ie.V("blocks:put-many:bitswap:notify",e)),this.bitswap?.notify(e,r,t)}));t.onProgress?.(new ie.V("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(n,t)}async get(e,t={}){if(!0!==t.offline&&null!=this.bitswap?.isStarted()&&!await this.child.has(e)){t.onProgress?.(new ie.V("blocks:get:bitswap:get",e));const r=await this.bitswap.want(e,t);return t.onProgress?.(new ie.V("blocks:get:blockstore:put",e)),await this.child.put(e,r,t),r}return t.onProgress?.(new ie.V("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){t.onProgress?.(new ie.V("blocks:get-many:blockstore:get-many")),yield*this.child.getMany((0,Ct.Z)(e,(async e=>{if(!0!==t.offline&&!0===this.bitswap?.isStarted()&&!await this.child.has(e)){t.onProgress?.(new ie.V("blocks:get-many:bitswap:get",e));const r=await this.bitswap.want(e,t);t.onProgress?.(new ie.V("blocks:get-many:blockstore:put",e)),await this.child.put(e,r,t)}})))}async delete(e,t={}){t.onProgress?.(new ie.V("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){t.onProgress?.(new ie.V("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(const t of e)yield t}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){e.onProgress?.(new ie.V("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}const Rt=a("helia");class Ot{libp2p;blockstore;datastore;pins;#i;constructor(e){const t=[Pe.sha256,Pe.sha512,De.identity,...e.hashers??[]];this.#i=((e,t,r={})=>new Ie(e,t,r))(e.libp2p,e.blockstore,{hashLoader:{getHasher:async e=>{const r=t.find((t=>t.code===e||t.name===e));if(null!=r)return r;throw new Error(`Could not load hasher for code/name "${e}"`)}}});const r=new Mt(e.blockstore,{bitswap:this.#i});this.pins=new xt(e.datastore,r,e.dagWalkers??[]),this.libp2p=e.libp2p,this.blockstore=new Tt(r,this.pins,{holdGcLock:e.holdGcLock}),this.datastore=e.datastore}async start(){await async function(e){if(!await e.has(Dt))return void await e.put(Dt,(0,At.m)("1"));const t=await e.get(Dt),r=(0,fe.B)(t);if(1!==parseInt(r,10))throw new Error("Unknown datastore version, a datastore migration may be required")}(this.datastore),await(this.#i?.start()),await this.libp2p.start()}async stop(){await this.libp2p.stop(),await(this.#i?.stop())}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const t=this,r=this.blockstore.unwrap();Rt("gc start"),await(0,Ae.Z)(r.deleteMany(async function*(){for await(const{cid:n}of r.getAll())try{if(await t.pins.isPinned(n,e))continue;yield n,e.onProgress?.(new ie.V("helia:gc:deleted",n))}catch(t){Rt.error("Error during gc",t),e.onProgress?.(new ie.V("helia:gc:error",t))}}()))}finally{t()}Rt("gc finished")}}var Nt=r(12021),Bt=r(5681),Lt=r(1465),zt=r(28375),Ut=r(46023),Ft=r(46232),jt=r(78227),Vt=r(49943),Wt=r(88476);const $t=Symbol.for("nodejs.util.inspect.custom"),qt=Object.values(zt.gh).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),zt.gh.identity.decoder),Kt=114,Ht=36,Gt=37;class Jt{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Bt.N]=!0;toString(){return null==this.string&&(this.string=Lt.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Ut.k0.createV1(Kt,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return(0,Wt.f)(this.multihash.bytes,e);if("string"==typeof e)return Xt(e).equals(this);if(null!=e?.multihash?.bytes)return(0,Wt.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[$t](){return`PeerId(${this.toString()})`}}class Zt extends Jt{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Qt extends Jt{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class Yt extends Jt{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function Xt(e,t){if(t=t??qt,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Ft.Jx(Lt.base58btc.decode(`z${e}`));return e.startsWith("12D")?new Qt({multihash:t}):e.startsWith("16U")?new Yt({multihash:t}):new Zt({multihash:t})}return er(qt.decode(e))}function er(e){try{const t=Ft.Jx(e);if(t.code===jt.identity.code){if(t.digest.length===Ht)return new Qt({multihash:t});if(t.digest.length===Gt)return new Yt({multihash:t})}if(t.code===Vt.sha256.code)return new Zt({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Kt)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Vt.sha256.code)return new Zt({multihash:e.multihash});if(t.code===jt.identity.code){if(t.digest.length===Ht)return new Qt({multihash:e.multihash});if(t.digest.length===Gt)return new Yt({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Ut.k0.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var tr=r(17663),rr=r(98924);function nr(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return n.enabled(`${e}:trace`)&&null!=n.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=n(`${e}:trace`)),Object.assign(n(e),{error:n(`${e}:error`),trace:t})}n.formatters.b=e=>null==e?"undefined":Lt.base58btc.baseEncode(e),n.formatters.t=e=>null==e?"undefined":tr.base32.baseEncode(e),n.formatters.m=e=>null==e?"undefined":rr.base64.baseEncode(e),n.formatters.p=e=>null==e?"undefined":e.toString(),n.formatters.c=e=>null==e?"undefined":e.toString(),n.formatters.k=e=>null==e?"undefined":e.toString(),n.formatters.a=e=>null==e?"undefined":e.toString();var sr=r(23247),ir=r(73379),or=r(64482);const{RPC:ar}=or,cr="/floodsub/1.0.0",hr="/meshsub/1.0.0",ur="/meshsub/1.1.0",lr=5e3;var dr=r(80778),fr=r(50786);function pr(e){return(0,fr.B)(e,"base64")}r(3068),r(97450),r(3832);var gr=r(26826),mr=r(77767),yr=(r(17487),r(82596),r(41313),r(95577));const br={rsa:r(51382),ed25519:mr,secp256k1:r(31815)};function wr(e){const t=Object.keys(br).join(" / ");return new P.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function vr(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return br[e];throw wr(e)}function _r(e){const t=yr.nh.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case yr.Jz.RSA:return br.rsa.unmarshalRsaPublicKey(r);case yr.Jz.Ed25519:return br.ed25519.unmarshalEd25519PublicKey(r);case yr.Jz.Secp256k1:return br.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw wr(t.Type??"unknown")}}function Er(e,t){return vr(t=(t??"rsa").toLowerCase()),e.bytes}async function kr(e){const t=yr._q.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case yr.Jz.RSA:return br.rsa.unmarshalRsaPrivateKey(r);case yr.Jz.Ed25519:return br.ed25519.unmarshalEd25519PrivateKey(r);case yr.Jz.Secp256k1:return br.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw wr(t.Type??"RSA")}}var Sr,xr,Ir,Tr,Ar,Dr=r(92679);function Pr(e){switch(e){case Dr.Ct.Ignore:return Ir.Ignore;case Dr.Ct.Reject:return Ir.Reject}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(Sr||(Sr={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(xr||(xr={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(Ir||(Ir={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(Tr||(Tr={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(Ar||(Ar={}));var Cr=r(64283);const Mr={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},Rr={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function Or(e={}){return{...Mr,...e,topics:e.topics?Object.entries(e.topics).reduce(((e,[t,r])=>(e[t]=function(e={}){return{...Rr,...e}}(r),e)),{}):{}}}function Nr(e){if(e.topicWeight<0)throw new P.sv("invalid topic weight; must be >= 0",Cr.v);if(0===e.timeInMeshQuantum)throw new P.sv("invalid TimeInMeshQuantum; must be non zero",Cr.v);if(e.timeInMeshWeight<0)throw new P.sv("invalid TimeInMeshWeight; must be positive (or 0 to disable)",Cr.v);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new P.sv("invalid TimeInMeshQuantum; must be positive",Cr.v);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new P.sv("invalid TimeInMeshCap; must be positive",Cr.v);if(e.firstMessageDeliveriesWeight<0)throw new P.sv("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",Cr.v);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new P.sv("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",Cr.v);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new P.sv("invalid FirstMessageDeliveriesCap; must be positive",Cr.v);if(e.meshMessageDeliveriesWeight>0)throw new P.sv("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",Cr.v);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new P.sv("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",Cr.v);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new P.sv("invalid MeshMessageDeliveriesCap; must be positive",Cr.v);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new P.sv("invalid MeshMessageDeliveriesThreshold; must be positive",Cr.v);if(e.meshMessageDeliveriesWindow<0)throw new P.sv("invalid MeshMessageDeliveriesWindow; must be non-negative",Cr.v);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new P.sv("invalid MeshMessageDeliveriesActivation; must be at least 1s",Cr.v);if(e.meshFailurePenaltyWeight>0)throw new P.sv("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",Cr.v);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new P.sv("invalid MeshFailurePenaltyDecay; must be between 0 and 1",Cr.v);if(e.invalidMessageDeliveriesWeight>0)throw new P.sv("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",Cr.v);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new P.sv("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",Cr.v)}const Br={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function Lr(e={}){return{...Br,...e}}var zr,Ur=r(85361),Fr=r(45001);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(zr||(zr={}));class jr{records;queue;constructor(){this.records=new Map,this.queue=new Fr}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:zr.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const r={msgId:e,expire:Date.now()+12e4};return this.queue.push(r),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function Vr(e,t,r=(()=>!0)){const n=new Set;if(t<=0)return n;for(const s of e){if(n.size>=t)break;r(s)&&(n.add(s),e.delete(s))}return n}class Wr extends Map{getDefault;constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}const $r=nr("libp2p:gossipsub:score");class qr{params;metrics;peerStats=new Map;peerIPs=new Wr((()=>new Set));scoreCache=new Map;deliveryRecords=new jr;_backgroundInterval;scoreCacheValidityMs;computeScore;constructor(e,t,r){this.params=e,this.metrics=t,function(e){for(const[t,r]of Object.entries(e.topics))try{Nr(r)}catch(e){throw new P.sv(`invalid score parameters for topic ${t}: ${e.message}`,Cr.v)}if(e.topicScoreCap<0)throw new P.sv("invalid topic score cap; must be positive (or 0 for no cap)",Cr.v);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new P.sv("missing application specific score function",Cr.v);if(e.IPColocationFactorWeight>0)throw new P.sv("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",Cr.v);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new P.sv("invalid IPColocationFactorThreshold; must be at least 1",Cr.v);if(e.behaviourPenaltyWeight>0)throw new P.sv("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",Cr.v);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new P.sv("invalid BehaviourPenaltyDecay; must be between 0 and 1",Cr.v);if(e.decayInterval<1e3)throw new P.sv("invalid DecayInterval; must be at least 1s",Cr.v);if(e.decayToZero<=0||e.decayToZero>=1)throw new P.sv("invalid DecayToZero; must be between 0 and 1",Cr.v)}(e),this.scoreCacheValidityMs=r.scoreCacheValidityMs,this.computeScore=r.computeScore??Ur.l}get size(){return this.peerStats.size}start(){this._backgroundInterval?$r("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),$r("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),$r("stopped")):$r("Peer score already stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([e,t])=>[e,t])))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((r,n)=>{r.connected?(Object.entries(r.topics).forEach((([r,n])=>{const s=this.params.topics[r];void 0!==s&&(n.firstMessageDeliveries*=s.firstMessageDeliveriesDecay,n.firstMessageDeliveries<t&&(n.firstMessageDeliveries=0),n.meshMessageDeliveries*=s.meshMessageDeliveriesDecay,n.meshMessageDeliveries<t&&(n.meshMessageDeliveries=0),n.meshFailurePenalty*=s.meshFailurePenaltyDecay,n.meshFailurePenalty<t&&(n.meshFailurePenalty=0),n.invalidMessageDeliveries*=s.invalidMessageDeliveriesDecay,n.invalidMessageDeliveries<t&&(n.invalidMessageDeliveries=0),n.inMesh&&(n.meshTime=e-n.graftTime,n.meshTime>s.meshMessageDeliveriesActivation&&(n.meshMessageDeliveriesActive=!0)))})),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<t&&(r.behaviourPenalty=0)):e>r.expire&&(this.removeIPsForPeer(n,r.knownIPs),this.peerStats.delete(n),this.scoreCache.delete(n))}))}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const r=Date.now(),n=this.scoreCache.get(e);if(n&&n.cacheUntil>r)return n.score;this.metrics?.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),i=r+this.scoreCacheValidityMs;return n?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-n.score)),n.score=s,n.cacheUntil=i):this.scoreCache.set(e,{score:s,cacheUntil:i}),s}addPenalty(e,t,r){const n=this.peerStats.get(e);n&&(n.behaviourPenalty+=t,this.metrics?.onScorePenalty(r))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.delete(t);const n=this.peerIPs.get(t);n&&(n.delete(e),0===n.size&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0)return this.removeIPsForPeer(e,t.knownIPs),void this.peerStats.delete(e);Object.entries(t.topics).forEach((([e,t])=>{t.firstMessageDeliveries=0;const r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){const e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){const r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){const t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,r){this.markFirstMessageDelivery(e,r);const n=this.deliveryRecords.ensureRecord(t),s=Date.now();n.status===zr.unknown?(n.status=zr.valid,n.validated=s,n.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,r)}))):$r("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-n.firstSeenTsMs,zr[n.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,r,n){switch(n){case Ir.Error:return void this.markInvalidMessageDelivery(e,r);case Ir.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status===zr.unknown){if(n===Ir.Ignore)return s.status=zr.ignored,void s.peers.clear();s.status=zr.invalid,this.markInvalidMessageDelivery(e,r),s.peers.forEach((e=>{this.markInvalidMessageDelivery(e,r)})),s.peers.clear()}else $r("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeenTsMs,zr[s.status])}duplicateMessage(e,t,r){const n=this.deliveryRecords.ensureRecord(t);if(!n.peers.has(e))switch(n.status){case zr.unknown:n.peers.add(e);break;case zr.valid:n.peers.add(e),this.markDuplicateMessageDelivery(e,r,n.validated);break;case zr.invalid:this.markInvalidMessageDelivery(e,r);case zr.ignored:}}markInvalidMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){let r=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(r,e.firstMessageDeliveries+1),e.inMesh&&(r=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(r,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,r){const n=this.peerStats.get(e);if(n){const e=void 0!==r?Date.now():0,s=this.getPtopicStats(n,t);if(s&&s.inMesh){const n=this.params.topics[t];if(void 0!==r){const s=e-r,i=s>n.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,s,i),i)return}const i=n.meshMessageDeliveriesCap;s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const r of t){const t=this.peerIPs.get(r);t&&(t.delete(e),0===t.size&&this.peerIPs.delete(r))}}getPtopicStats(e,t){let r=e.topics[t];return void 0!==r?r:void 0!==this.params.topics[t]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=r,r):null}}class Kr{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(e,t,r){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=r,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const r=t[Math.floor(Math.random()*t.length)],n=this.msgIdToStrFn(r);let s=this.promises.get(n);s||(s=new Map,this.promises.set(n,s));const i=Date.now();s.has(e)||(s.set(e,i+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(n)||this.requestMsByMsg.set(n,i)))}getBrokenPromises(){const e=Date.now(),t=new Map;let r=0;return this.promises.forEach(((n,s)=>{n.forEach(((s,i)=>{s<e&&(t.set(i,(t.get(i)??0)+1),n.delete(i),r++)})),n.size||this.promises.delete(s)})),this.metrics?.iwantPromiseBroken.inc(r),t}deliverMessage(e,t=!1){this.trackMessage(e);const r=this.promises.get(e);r&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,t){this.trackMessage(e),t!==Ir.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[r,n]of this.requestMsByMsg.entries()){if(!(n<e))break;this.requestMsByMsg.delete(r),t++}this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}var Hr,Gr,Jr,Zr,Qr,Yr,Xr=r(15036);!function(e){e.forward="forward",e.publish="publish"}(Hr||(Hr={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(Gr||(Gr={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Excess="excess"}(Jr||(Jr={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(Zr||(Zr={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(Qr||(Qr={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(Yr||(Yr={}));var en=r(54729),tn=(r(30793),r(26422),r(13412),r(98900));const rn=(0,gr.m)("libp2p-pubsub:");r(69391);function nn(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return((e,t)=>{const r=(0,gr.m)(t.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(e.length+r.length);return n.set(e,0),n.set(r,e.length),n})(e.from.toBytes(),e.sequenceNumber)}async function sn(e){return await Vt.sha256.encode(e.data)}var on=r(19292),an=r(14152);class cn extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function hn(e={}){return un((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function un(e,t){let r,n,s,i=(t=t??{}).onEnd,o=new an.u,a=(0,Ne.Z)();const c=e=>null!=n?n(e):(o.push(e),r),h=e=>{if(s)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},u=e=>s?r:(s=!0,null!=e?(e=>(o=new an.u,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?s?{done:!0}:await new Promise(((t,s)=>{n=i=>{n=null,o.push(i);try{t(e(o))}catch(e){s(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,Ne.Z)()}))}},return:()=>(o=new an.u,u(),{done:!0}),throw:e=>(u(e),{done:!0}),push:h,end:u,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new cn)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==i)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=i&&(i(e),i=void 0),{done:!0}),return:()=>(l.return(),null!=i&&(i(),i=void 0),{done:!0}),push:h,end:e=>(l.end(e),null!=i&&(i(e),i=void 0),r),get readableLength(){return l.readableLength}},r}class ln extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}var dn=r(32433);function fn(e,t,r){const n=r??{},s=(0,dn.A)(e);return async function*(){let r;const i=()=>{null!=r&&r()};for(t.addEventListener("abort",i);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new ln(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new ln(e,r))}}));o=await Promise.race([e,s.next()]),r=null}catch(r){t.removeEventListener("abort",i);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",i)}()}class pn{rawStream;pushable;closeController;maxBufferSize;constructor(e,t,r){this.rawStream=e,this.pushable=hn({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,(0,ne.z)(fn(this.pushable,this.closeController.signal,{returnOnAbort:!0}),(e=>(0,te.c)(e)),this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class gn{source;rawStream;closeController;constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=fn((0,ne.z)(this.rawStream,(e=>(0,te.J)(e,t))),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var mn=r(42450);const yn={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function bn(e,t){t={...t};const r=mn.Reader.create(e),n=e.length,s=void 0===n?r.len:r.pos+n,i={};for(;r.pos<s;){const e=r.uint32();switch(e>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.length<t.maxSubscriptions?i.subscriptions.push(wn(r,r.uint32())):r.skipType(7&e);break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.length<t.maxMessages?i.messages.push(vn(r,r.uint32())):r.skipType(7&e);break;case 3:i.control=_n(r,r.uint32(),t);break;default:r.skipType(7&e)}}return i}function wn(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topic=e.string();break;default:e.skipType(7&t)}}return n}function vn(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topic=e.string();break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&t)}}if(!n.topic)throw Error("missing required 'topic'");return n}function _n(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.length<r.maxControlMessages?s.ihave.push(En(e,e.uint32(),r)):e.skipType(7&t);break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.length<r.maxControlMessages?s.iwant.push(kn(e,e.uint32(),r)):e.skipType(7&t);break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.length<r.maxControlMessages?s.graft.push(Sn(e,e.uint32())):e.skipType(7&t);break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.length<r.maxControlMessages?s.prune.push(xn(e,e.uint32(),r)):e.skipType(7&t);break;default:e.skipType(7&t)}}return s}function En(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:s.topicID=e.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),r.maxIhaveMessageIDs-- >0?s.messageIDs.push(e.bytes()):e.skipType(7&t);break;default:e.skipType(7&t)}}return s}function kn(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),r.maxIwantMessageIDs-- >0?s.messageIDs.push(e.bytes()):e.skipType(7&t);else e.skipType(7&t)}return s}function Sn(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();if(t>>>3==1)n.topicID=e.string();else e.skipType(7&t)}return n}function xn(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:s.topicID=e.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),r.maxPeerInfos-- >0?s.peers.push(In(e,e.uint32())):e.skipType(7&t);break;case 3:s.backoff=e.uint64();break;default:e.skipType(7&t)}}return s}function In(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.peerID=e.bytes();break;case 2:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n}r(9839);var Tn=r(57050),An=(r(72069),r(17610));function Dn(e,t="utf8"){const r=An.Z[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var Pn=r(49736);const Cn=function(e,t=0,r){t=~~t,r=r??e.length-t;const n=new DataView(e.buffer);if(4===r){const n=[];for(let s=0;s<r;s++)n.push(e[t+s]);return n.join(".")}if(16===r){const e=[];for(let s=0;s<r;s+=2)e.push(n.getUint16(t+s).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var Mn=r(62073);(0,Mn.Ev)("ip4"),(0,Mn.Ev)("ip6"),(0,Mn.Ev)("ipcidr");function Rn(e,t){switch((0,Mn.Ev)(e).code){case 4:case 41:return function(e){const t=Cn(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!Pn.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Bn(t);case 6:case 273:case 33:case 132:return Nn(t).toString();case 421:return function(e){const t=Tn.Jx(e),r=e.slice(Tn.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return Dn(r,"base58btc")}(t);case 444:case 445:return Ln(t);case 466:return function(e){const t=Tn.Jx(e),r=e.slice(Tn.P$(t));if(r.length!==t)throw new Error("inconsistent lengths");return"u"+Dn(r,"base64url")}(t);default:return Dn(t,"base16")}}const On=Object.values(zt.gh).map((e=>e.decoder));!function(){let e=On[0].or(On[1]);On.slice(2).forEach((t=>e=e.or(t)))}();function Nn(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Bn(e){const t=Tn.Jx(e);if((e=e.slice(Tn.P$(t))).length!==t)throw new Error("inconsistent lengths");return Dn(e)}function Ln(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return`${Dn(t,"base32")}:${Nn(r)}`}var zn;!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(zn||(zn={}));var Un;!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(Un||(Un={}));class Fn extends sr.v{globalSignaturePolicy;multicodecs=[ur,hr];publishConfig;dataTransform;peers=new Set;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=hn({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;components;directPeerInitial=null;static multicodec=ur;opts;decodeRpcLimits;metrics;status={code:Un.stopped};maxInboundStreams;maxOutboundStreams;allowedTopics;heartbeatTimer=null;constructor(e,t={}){super();const r={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,unsubcribeBackoff:1e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:Or(t.scoreParams),scoreThresholds:Lr(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=r.decodeRpcLimits??yn,this.globalSignaturePolicy=r.globalSignaturePolicy??Dr.xq,r.fallbackToFloodsub&&this.multicodecs.push(cr),this.log=nr(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map((e=>e.id.toString()))),this.seenCache=new Xr.p({validityMs:r.seenTTL}),this.publishedMessageIds=new Xr.p({validityMs:r.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Dr.xq:this.msgIdFn=nn;break;case Dr.Q_:this.msgIdFn=sn}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new Xr.p({validityMs:r.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??pr,this.mcache=t.messageCache||new ir.n(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const e=Math.max(...Object.values(r.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),1e3),n=function(e,t,r){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:e.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:e.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:e.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:e.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:e.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:e.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:e.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:e.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:e.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:e.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",labelNames:["topic"],buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:e.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:e.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:e.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:e.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:e.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:e.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:e.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:e.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:e.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:e.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:e.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:e.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:e.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:e.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:e.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),iwantPromiseUntracked:e.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:e.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,r){const n=this.toTopic(e);switch(t){case Gr.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:n},r);break;case Gr.Random:this.meshPeerInclusionEventsRandom.inc({topic:n},r);break;case Gr.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:n},r);break;case Gr.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:n},r);break;case Gr.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:n},r);break;case Gr.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:n},r);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:n},r)}},onRemoveFromMesh(e,t,r){const n=this.toTopic(e);switch(t){case Jr.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:n},r);break;case Jr.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:n},r);break;case Jr.Prune:this.meshPeerChurnEventsPrune.inc({topic:n},r);break;case Jr.Excess:this.meshPeerChurnEventsExcess.inc({topic:n},r);break;default:this.meshPeerChurnEventsUnknown.inc({topic:n},r)}},onReportValidation(e,t,r){if(this.asyncValidationMcacheHit.inc({hit:null!=e?"hit":"miss"}),null!=e){const r=this.toTopic(e.message.topic);switch(t){case Dr.Ct.Accept:this.acceptedMessagesTotal.inc({topic:r});break;case Dr.Ct.Ignore:this.ignoredMessagesTotal.inc({topic:r});break;case Dr.Ct.Reject:this.rejectedMessagesTotal.inc({topic:r});break;default:this.unknownValidationResultsTotal.inc({topic:r})}}null!=r?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-r)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,r){const n=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:n},t),this.ihaveRcvNotSeenMsgids.inc({topic:n},r)},onIwantRcv(e,t){for(const[t,r]of e){const e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const r=this.toTopic(e);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},t)},onPublishMsg(e,t,r,n,s){const i=this.toTopic(e);this.msgPublishCount.inc({topic:i},1),this.msgPublishBytes.inc({topic:i},r*n),this.msgPublishPeersByTopic.inc({topic:i},r),this.directPeersPublishedTotal.inc({topic:i},t.direct),this.floodsubPeersPublishedTotal.inc({topic:i},t.floodsub),this.meshPeersPublishedTotal.inc({topic:i},t.mesh),this.fanoutPeersPublishedTotal.inc({topic:i},t.fanout),this.msgPublishTime.observe({topic:i},s/1e3)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvError(e){const t=this.toTopic(e);this.msgReceivedError.inc({topic:t},1)},onPrevalidationResult(e,t){const r=this.toTopic(e);switch(t){case Ar.duplicate:this.prevalidationDuplicateTotal.inc({topic:r});break;case Ar.invalid:this.prevalidationInvalidTotal.inc({topic:r});break;case Ar.valid:this.prevalidationValidTotal.inc({topic:r});break;default:this.prevalidationUnknownTotal.inc({topic:r})}},onMsgRecvInvalid(e,t){const r=this.toTopic(e),n=t.reason===Ir.Error?t.error:t.reason;this.msgReceivedInvalid.inc({error:n},1),this.msgReceivedInvalidByTopic.inc({topic:r},1)},onDuplicateMsgDelivery(e,t,r){if(this.duplicateMsgDeliveryDelay.observe(t/1e3),r){const t=this.toTopic(e);this.duplicateMsgLateDelivery.inc({topic:t},1)}},onPublishDuplicateMsg(e){const t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),e.messages&&this.rpcRecvMessage.inc(e.messages.length),e.control&&(this.rpcRecvControl.inc(1),e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),e.messages&&this.rpcSentMessage.inc(e.messages.length),e.control){const t=e.control.ihave?.length??0,r=e.control.iwant?.length??0,n=e.control.graft?.length??0,s=e.control.prune?.length??0;t>0&&this.rpcSentIHave.inc(t),r>0&&this.rpcSentIWant.inc(r),n>0&&this.rpcSentGraft.inc(n),s>0&&this.rpcSentPrune.inc(s),(t>0||r>0||n>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let r=0,n=0,s=0,i=0;for(const o of e)o>=t.graylistThreshold&&r++,o>=t.publishThreshold&&n++,o>=t.gossipThreshold&&s++,o>=0&&i++;this.peersByScoreThreshold.set({threshold:Yr.graylist},r),this.peersByScoreThreshold.set({threshold:Yr.publish},n),this.peersByScoreThreshold.set({threshold:Yr.gossip},s),this.peersByScoreThreshold.set({threshold:Yr.mesh},i),this.score.set(e)},registerScoreWeights(e){for(const[t,r]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},r.p1w),this.scoreWeights.set({topic:t,p:"p2"},r.p2w),this.scoreWeights.set({topic:t,p:"p3"},r.p3w),this.scoreWeights.set({topic:t,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:t,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const r=new Map;e.forEach(((e,t)=>{const n=this.topicStrToLabel.get(t)??"unknown";let s=r.get(n);s||(s=new Set,r.set(n,s)),e.forEach((e=>s?.add(e)))}));for(const[e,n]of r){const r=[];n.forEach((e=>{r.push(t.get(e)??0)})),this.scorePerMesh.set({topic:e},r)}}}}(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});n.mcacheSize.addCollect((()=>this.onScrapeMetrics(n)));for(const e of this.multicodecs)n.protocolsEnabled.set({protocol:e},1);this.metrics=n}else this.metrics=null;this.gossipTracer=new Kr(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new qr(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=r.allowedTopics?new Set(r.allowedTopics):null}getPeers(){return[...this.peers.keys()].map((e=>Xt(e)))}isStarted(){return this.status.code===Un.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await async function(e,t){switch(e){case Dr.xq:{if(!t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await kr(t.privateKey);return{type:xr.Signing,author:t,key:t.publicKey,privateKey:e}}case Dr.Q_:return{type:xr.Anonymous};default:throw new Error(`Unknown signature policy "${e}"`)}}(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=hn({objectMode:!0}),(0,ne.z)(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:r}of e)await this.createOutboundStream(t,r)})).catch((e=>this.log.error("outbound inflight queue error",e))),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.peerStore.merge(e.id,{multiaddrs:e.addrs})})));const e=this.components.registrar;await Promise.all(this.multicodecs.map((t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const t={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)},r=await Promise.all(this.multicodecs.map((r=>e.register(r,t)))),n=setTimeout(this.runHeartbeat,100);this.status={code:Un.started,registrarTopologyIds:r,heartbeatTimeout:n,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>await this.connect(e))))})).catch((e=>{this.log(e)}))}),1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Un.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:Un.stopped};const t=this.components.registrar;await Promise.all(this.multicodecs.map((e=>t.unhandle(e)))),e.forEach((e=>t.unregister(e))),this.outboundInflightQueue.end();for(const e of this.streamsOutbound.values())e.close();this.streamsOutbound.clear();for(const e of this.streamsInbound.values())e.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const r=t.remotePeer;this.addPeer(r,t.direction,t.remoteAddr),this.createInboundStream(r,e),this.outboundInflightQueue.push({peerId:r,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.status}),this.isStarted()&&"open"===t.status&&(this.addPeer(e,t.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{const n=new pn(await t.newStream(this.multicodecs),(e=>this.log.error("outbound pipe error",e)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(r,n);const s=n.protocol;s===cr&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}async createInboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(!this.peers.has(r))return;const n=this.streamsInbound.get(r);void 0!==n&&(this.log("replacing existing inbound steam %s",r),n.close()),this.log("create inbound stream %s",r);const s=new gn(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,s),this.pipePeerReadStream(e,s.source).catch((e=>this.log(e)))}addPeer(e,t,r){const n=e.toString();if(!this.peers.has(n)){this.log("new peer %p",e),this.peers.add(n),this.score.addPeer(n);const s=function(e){for(const t of e.tuples())switch(t[0]){case zn.ip4:case zn.ip6:return Rn(t[0],t[1])}return null}(r);null!==s?this.score.addIP(n,s):this.log("Added peer has no IP in current address %s %s",n,r.toString()),this.outbound.has(n)||this.outbound.set(n,"outbound"===t)}}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const r=this.streamsOutbound.get(t),n=this.streamsInbound.get(t);r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close(),n?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const e of this.topics.values())e.delete(t);for(const[e,r]of this.mesh)!0===r.delete(t)&&this.metrics?.onRemoveFromMesh(e,Jr.Dc,1);for(const e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===Un.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map((e=>Xt(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await(0,ne.z)(t,(async t=>{for await(const r of t)try{const t=r.subarray(),n=bn(t,this.decodeRpcLimits);if(this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,n)}catch(e){this.metrics?.onRpcRecvError(),this.log(e)}else this.handleReceivedRpc(e,n).catch((e=>{this.metrics?.onRpcRecvError(),this.log(e)}))}catch(e){this.metrics?.onRpcDataError(),this.log(e)}}))}catch(t){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(t,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void this.metrics?.rpcRecvNotAccepted.inc();const r=t.subscriptions?t.subscriptions.length:0,n=t.messages?t.messages.length:0;let s=0,i=0,o=0,a=0;if(t.control&&(t.control.ihave&&(s=t.control.ihave.length),t.control.iwant&&(i=t.control.iwant.length),t.control.graft&&(o=t.control.graft.length),t.control.prune&&(a=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${r} messages ${n} ihave ${s} iwant ${i} graft ${o} prune ${a}`),t.subscriptions&&t.subscriptions.length>0){const r=[];t.subscriptions.forEach((t=>{const n=t.topic,s=!0===t.subscribe;if(null!=n){if(this.allowedTopics&&!this.allowedTopics.has(n))return;this.handleReceivedSubscription(e,n,s),r.push({topic:n,subscribe:s})}})),this.dispatchEvent(new sr.A("subscription-change",{detail:{peerId:e,subscriptions:r}}))}if(t.messages)for(const r of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(r.topic))continue;const t=this.handleReceivedMessage(e,r).catch((e=>{this.metrics?.onMsgRecvError(r.topic),this.log(e)}));this.opts.awaitRpcMessageHandler&&await t}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,r){this.log("subscription update from %p topic %s",e,t);let n=this.topics.get(t);null==n&&(n=new Set,this.topics.set(t,n)),r?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const r=await this.validateReceivedMessage(e,t);switch(this.metrics?.onPrevalidationResult(t.topic,r.code),r.code){case Ar.duplicate:return this.score.duplicateMessage(e.toString(),r.msgIdStr,t.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),void this.mcache.observeDuplicate(r.msgIdStr,e.toString());case Ar.invalid:if(r.msgIdStr){const n=r.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,r.reason),this.gossipTracer.rejectMessage(n,r.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void this.metrics?.onMsgRecvInvalid(t.topic,r);case Ar.valid:if(this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)){this.components.peerId.equals(e)&&!this.opts.emitSelf||(super.dispatchEvent(new sr.A("gossipsub:message",{detail:{propagationSource:e,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new sr.A("message",{detail:r.msg})))}this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const r=this.fastMsgIdFn?.(t),n=void 0!==r?this.fastMsgIdCache?.get(r):void 0;if(n)return{code:Ar.duplicate,msgIdStr:n};const s=await async function(e,t){switch(e){case Dr.Q_:return null!=t.signature?{valid:!1,error:Tr.SignaturePresent}:null!=t.seqno?{valid:!1,error:Tr.SeqnoPresent}:null!=t.key?{valid:!1,error:Tr.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case Dr.xq:{if(null==t.seqno)return{valid:!1,error:Tr.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:Tr.InvalidSeqno};if(null==t.signature)return{valid:!1,error:Tr.InvalidSignature};if(null==t.from)return{valid:!1,error:Tr.InvalidPeerId};let e,r;try{e=er(t.from)}catch(e){return{valid:!1,error:Tr.InvalidPeerId}}if(t.key){if(r=_r(t.key),void 0!==e.publicKey&&!(0,Wt.f)(r.bytes,e.publicKey))return{valid:!1,error:Tr.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:Tr.InvalidPeerId};r=_r(e.publicKey)}const n={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},s=(0,en.z)([rn,ar.Message.encode(n).finish()]);return await r.verify(s,t.signature)?{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${(0,fr.B)(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:t.key??Er(r)}}:{valid:!1,error:Tr.InvalidSignature}}}}(this.globalSignaturePolicy,t);if(!s.valid)return{code:Ar.invalid,reason:Ir.Error,error:s.error};const i=s.message;try{this.dataTransform&&(i.data=this.dataTransform.inboundTransform(t.topic,i.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:Ar.invalid,reason:Ir.Error,error:Tr.TransformFailed}}const o=await this.msgIdFn(i),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(void 0!==r&&this.fastMsgIdCache){this.fastMsgIdCache.put(r,a)&&this.metrics?.fastMsgIdCacheCollision.inc()}if(this.seenCache.has(a))return{code:Ar.duplicate,msgIdStr:a};this.seenCache.put(a);const h=this.topicValidators.get(t.topic);if(null!=h){let t;try{t=await h(e,i)}catch(e){const r=e.code;"ERR_TOPIC_VALIDATOR_IGNORE"===r&&(t=Dr.Ct.Ignore),t="ERR_TOPIC_VALIDATOR_REJECT"===r?Dr.Ct.Reject:Dr.Ct.Ignore}if(t!==Dr.Ct.Accept)return{code:Ar.invalid,reason:Pr(t),msgIdStr:a}}return{code:Ar.valid,messageId:c,msg:i}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,r){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:r})))})}async handleControlMessage(e,t){if(void 0===t)return;const r=t.ihave?this.handleIHave(e,t.ihave):[],n=t.iwant?this.handleIWant(e,t.iwant):[],s=t.graft?await this.handleGraft(e,t.graft):[];if(t.prune&&await this.handlePrune(e,t.prune),!r.length&&!n.length&&!s.length)return;const i=this.sendRpc(e,{messages:n,control:{iwant:r,prune:s}}),o=r[0]?.messageIDs;o&&(i?this.gossipTracer.addPromise(e,o):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),r=this.acceptFromWhitelist.get(e);if(r&&r.messagesAccepted<128&&r.acceptUntil>=t)return r.messagesAccepted+=1,!0;const n=this.score.score(e);return n>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),n>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:Qr.LowScore}),[];const n=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,n),n>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:Qr.MaxIhave}),[];const s=this.iasked.get(e)??0;if(s>=lr)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:Qr.MaxIasked}),[];const i=new Map;if(t.forEach((({topicID:e,messageIDs:t})=>{if(!e||!t||!this.mesh.has(e))return;let r=0;t.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(i.set(t,e),r++)})),this.metrics?.onIhaveRcv(e,t.length,r)})),!i.size)return[];let o=i.size;o+s>lr&&(o=lr-s),this.log("IHAVE: Asking for %d out of %d messages from %s",o,i.size,e);let a=Array.from(i.values());return(0,dr.T)(a),a=a.slice(0,o),this.iasked.set(e,s+o),[{messageIDs:a}]}handleIWant(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];const n=new Map,s=new Map;let i=0;return t.forEach((({messageIDs:t})=>{t&&t.forEach((t=>{const r=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(r,e);null!=o?(s.set(o.msg.topic,1+(s.get(o.msg.topic)??0)),o.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):n.set(r,o.msg)):i++}))})),this.metrics?.onIwantRcv(s,i),n.size?(this.log("IWANT: Sending %d messages to %s",n.size,e),Array.from(n.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const r=[],n=this.score.score(e),s=Date.now();let i=this.opts.doPX;if(t.forEach((({topicID:t})=>{if(!t)return;const o=this.mesh.get(t);if(!o)return void(i=!1);if(o.has(e))return;if(this.direct.has(e))return this.log("GRAFT: ignoring request from direct peer %s",e),r.push(t),void(i=!1);const a=this.backoff.get(t)?.get(e);if("number"==typeof a&&s<a){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,Zr.GraftBackoff),i=!1;const n=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return s<n&&this.score.addPenalty(e,1,Zr.GraftBackoff),this.addBackoff(e,t),void r.push(t)}return n<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,n,t),r.push(t),i=!1,void this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(r.push(t),void this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),void this.metrics?.onAddToMesh(t,Gr.Subscribed,1))})),!r.length)return[];return await Promise.all(r.map((t=>this.makePrune(e,t,i,false))))}async handlePrune(e,t){const r=this.score.score(e);for(const{topicID:n,backoff:s,peers:i}of t){if(null==n)continue;const t=this.mesh.get(n);if(!t)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,n),this.score.prune(e,n),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(n,Jr.Prune,1)),"number"==typeof s&&s>0?this.doAddBackoff(e,n,1e3*s):this.addBackoff(e,n),i&&i.length){if(r<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,r,n);continue}await this.pxConnect(i)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,r){let n=this.backoff.get(t);n||(n=new Map,this.backoff.set(t,n));const s=Date.now()+r;(n.get(e)??0)<s&&n.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,Zr.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!=0)return;const e=Date.now();this.backoff.forEach(((t,r)=>{t.forEach(((r,n)=>{r+1*this.opts.heartbeatInterval<e&&t.delete(n)})),0===t.size&&this.backoff.delete(r)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>await this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&((0,dr.T)(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(!e.peerID)return;const r=er(e.peerID),n=r.toString();if(!this.peers.has(n))if(e.signedPeerRecord)try{if(!await this.components.peerStore.consumePeerRecord(e.signedPeerRecord,r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(n)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(n)}))),t.length&&await Promise.all(t.map((async e=>await this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=Xt(e),r=await this.components.connectionManager.openConnection(t);for(const e of this.multicodecs)for(const n of this.components.registrar.getTopologies(e))n.onConnect?.(t,r)}subscribe(e){if(this.status.code!==Un.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Un.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e)}join(e){if(this.status.code!==Un.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,r=this.backoff.get(e),n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach((e=>{this.direct.has(e)||!(this.score.score(e)>=0)||r&&r.has(e)||t.add(e)})),this.metrics?.onAddToMesh(e,Gr.Fanout,t.size)),t.size<this.opts.D){const n=t.size;this.getRandomGossipPeers(e,this.opts.D,(e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0&&(!r||!r.has(e)))).forEach((e=>{t.add(e)})),this.metrics?.onAddToMesh(e,Gr.Random,t.size-n)}this.mesh.set(e,t),t.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}leave(e){if(this.status.code!==Un.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map((async t=>(this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e))))).catch((e=>{this.log("Error sending prunes to mesh peers",e)})),this.mesh.delete(e))}selectPeersToForward(e,t,r){const n=new Set,s=this.topics.get(e);s&&(this.direct.forEach((e=>{s.has(e)&&t!==e&&!r?.has(e)&&n.add(e)})),this.floodsubPeers.forEach((e=>{s.has(e)&&t!==e&&!r?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&n.add(e)})));const i=this.mesh.get(e);return i&&i.size>0&&i.forEach((e=>{t===e||r?.has(e)||n.add(e)})),n}selectPeersToPublish(e){const t=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},n=this.topics.get(e);if(n)if(this.opts.floodPublish)n.forEach((e=>{this.direct.has(e)?(t.add(e),r.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));else{this.direct.forEach((e=>{n.has(e)&&(t.add(e),r.direct++)})),this.floodsubPeers.forEach((e=>{n.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));const s=this.mesh.get(e);if(s&&s.size>0)s.forEach((e=>{t.add(e),r.mesh++}));else{const n=this.fanout.get(e);if(n&&n.size>0)n.forEach((e=>{t.add(e),r.fanout++}));else{const n=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));n.size>0&&(this.fanout.set(e,n),n.forEach((e=>{t.add(e),r.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:r}}forwardMessage(e,t,r,n){r&&this.score.deliverMessage(r,e,t.topic);const s=this.selectPeersToForward(t.topic,r,n);s.forEach((e=>{this.sendRpc(e,{messages:[t]})})),this.metrics?.onForwardMsg(t.topic,s.size)}async publish(e,t,r){const n=Date.now(),s=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:i,msg:o}=await async function(e,t,r,n){switch(e.type){case xr.Signing:{const s={from:e.author.toBytes(),data:n,seqno:(0,tn.Z)(8),topic:t,signature:void 0,key:void 0},i=(0,en.z)([rn,ar.Message.encode(s).finish()]);return s.signature=await e.privateKey.sign(i),s.key=e.key,{raw:s,msg:{type:"signed",from:e.author,data:r,sequenceNumber:BigInt(`0x${(0,fr.B)(s.seqno,"base16")}`),topic:t,signature:s.signature,key:s.key}}}case xr.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:t}}}}(this.publishConfig,e,t,s),a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),h=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(h)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:u,tosendCount:l}=this.selectPeersToPublish(e),d=!0===this.opts.emitSelf&&this.subscriptions.has(e),f=r?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(0===u.size&&!f&&!d)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},i,!0),this.publishedMessageIds.put(c);for(const e of u){this.sendRpc(e,{messages:[i]})||u.delete(e)}const p=Date.now()-n;return this.metrics?.onPublishMsg(e,l,u.size,null!=i.data?i.data.length:0,p),d&&(u.add(this.components.peerId.toString()),super.dispatchEvent(new sr.A("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:o}})),super.dispatchEvent(new sr.A("message",{detail:o}))),{recipients:Array.from(u.values()).map((e=>Xt(e)))}}reportMessageValidationResult(e,t,r){let n;if(r===Dr.Ct.Accept){if(n=this.mcache.validate(e),null!=n){const{message:r,originatingPeers:s}=n;this.score.deliverMessage(t,e,r.topic),this.forwardMessage(e,n.message,t,s)}}else if(n=this.mcache.remove(e),n){const s=Pr(r),{message:i,originatingPeers:o}=n;this.score.rejectMessage(t,e,i.topic,s);for(const t of o)this.score.rejectMessage(t,e,i.topic,s)}const s=this.score.messageFirstSeenTimestampMs(e);this.metrics?.onReportValidation(n,r,s)}sendGraft(e,t){const r=[{topicID:t}];this.sendRpc(e,{control:{graft:r}})}async sendPrune(e,t){const r=[await this.makePrune(e,t,this.opts.doPX,!0)];this.sendRpc(e,{control:{prune:r}})}sendRpc(e,t){const r=this.streamsOutbound.get(e);if(!r)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const n=this.control.get(e);n&&(this.piggybackControl(e,t,n),this.control.delete(e));const s=this.gossip.get(e);s&&(this.piggybackGossip(e,t,s),this.gossip.delete(e));const i=ar.encode(t).finish();try{r.push(i)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),n&&this.control.set(e,n),s&&this.gossip.set(e,s),!1}return this.metrics?.onRpcSent(t,i.length),!0}piggybackControl(e,t,r){if(r.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(const n of r.graft)n.topicID&&this.mesh.get(n.topicID)?.has(e)&&t.control.graft.push(n)}if(r.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(const n of r.prune)n.topicID&&!this.mesh.get(n.topicID)?.has(e)&&t.control.prune.push(n)}}piggybackGossip(e,t,r){t.control||(t.control={}),t.control.ihave=r}async sendGraftPrune(e,t,r){const n=this.opts.doPX;for(const[s,i]of e){const e=i.map((e=>({topicID:e})));let o=[];const a=t.get(s);a&&(o=await Promise.all(a.map((async e=>await this.makePrune(s,e,n&&!r.get(s),false)))),t.delete(s)),this.sendRpc(s,{control:{graft:e,prune:o}})}for(const[e,s]of t){const t=await Promise.all(s.map((async t=>await this.makePrune(e,t,n&&!r.get(e),false))));this.sendRpc(e,{control:{prune:t}})}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[r,n]of e)this.doEmitGossip(r,n,t.get(r)??[])}doEmitGossip(e,t,r){if(!r.length)return;if((0,dr.T)(r),r.length>lr&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),!t.size)return;let n=this.opts.Dlazy;const s=.25*t.size;let i=t;s>n&&(n=s),n>i.size?n=i.size:i=(0,dr.T)(Array.from(i)).slice(0,n),i.forEach((t=>{let n=r;r.length>lr&&(n=(0,dr.T)(n.slice()).slice(0,lr)),this.pushGossip(t,{topicID:e,messageIDs:n})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);const r=this.gossip.get(e)||[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,r,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===hr)return{topicID:t,peers:[]};const s=n?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,i=s/1e3;if(this.doAddBackoff(e,t,s),!r)return{topicID:t,peers:[],backoff:i};const o=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),a=await Promise.all(Array.from(o).map((async e=>{const t=Xt(e);let r;try{r=await this.components.peerStore.get(t)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return{peerID:t.toBytes(),signedPeerRecord:r?.peerRecordEnvelope}})));return{topicID:t,peers:a,backoff:i}}runHeartbeat=()=>{const e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=e&&e(),this.status.code===Un.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}}))};async heartbeat(){const{D:e,Dlo:t,Dhi:r,Dscore:n,Dout:s,fanoutTTL:i}=this.opts;this.heartbeatTicks++;const o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},c=new Map,h=new Map,u=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const l=new Map;this.mesh.forEach(((i,o)=>{const d=this.topics.get(o),f=new Set,p=new Set;if(l.set(o,p),d){const e=(0,dr.T)(Array.from(d)),t=this.backoff.get(o);for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!i.has(r)&&!this.direct.has(r)){const e=a(r);t&&t.has(r)||!(e>=0)||f.add(r),e>=this.opts.scoreThresholds.gossipThreshold&&p.add(r)}}}const g=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),i.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&p.add(e),this.metrics?.onRemoveFromMesh(o,t,1);const r=h.get(e);r?r.push(o):h.set(e,[o])},m=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),i.add(e),p.delete(e),this.metrics?.onAddToMesh(o,t,1);const r=c.get(e);r?r.push(o):c.set(e,[o])};if(i.forEach((e=>{const t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),g(e,Jr.BadScore),u.set(e,!0))})),i.size<t){const t=function(e,t){return Vr(e,t,(()=>!0))}(f,e-i.size);t.forEach((e=>{m(e,Gr.NotEnough)}))}if(i.size>r){let t=Array.from(i);t.sort(((e,t)=>a(t)-a(e))),t=t.slice(0,n).concat((0,dr.T)(t.slice(n)));let r=0;if(t.slice(0,e).forEach((e=>{this.outbound.get(e)&&r++})),r<s){const n=e=>{const r=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=r};if(r>0){let s=r;for(let r=1;r<e&&s>0;r++)this.outbound.get(t[r])&&(n(r),s--)}let s=e-r;for(let r=e;r<t.length&&s>0;r++)this.outbound.get(t[r])&&(n(r),s--)}t.slice(e).forEach((e=>{g(e,Jr.Excess)}))}if(i.size>=t){let e=0;if(i.forEach((t=>{this.outbound.get(t)&&e++})),e<s){Vr(f,s-e,(e=>!0===this.outbound.get(e))).forEach((e=>{m(e,Gr.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&i.size>1){const e=Array.from(i).sort(((e,t)=>a(e)-a(t))),t=Math.floor(i.size/2),r=a(e[t]);if(r<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=Vr(f,this.opts.opportunisticGraftPeers,(e=>a(e)>r));for(const t of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,o),m(t,Gr.Opportunistic)}}}));const d=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+i<d&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((t,r)=>{const n=this.topics.get(r);t.forEach((e=>{(!n.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)}));const s=this.topics.get(r),i=[],o=new Set;if(l.set(r,o),s){const e=(0,dr.T)(Array.from(s));for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!t.has(r)&&!this.direct.has(r)){const e=a(r);e>=this.opts.scoreThresholds.publishThreshold&&i.push(r),e>=this.opts.scoreThresholds.gossipThreshold&&o.add(r)}}}if(t.size<e){const r=e-t.size;i.slice(0,r).forEach((e=>{t.add(e),o?.delete(e)}))}})),this.emitGossip(l),await this.sendGraftPrune(c,h,u),this.flush(),this.mcache.shift(),this.dispatchEvent(new sr.A("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,r=(()=>!0)){const n=this.topics.get(e);if(!n)return new Set;let s=[];return n.forEach((e=>{const t=this.streamsOutbound.get(e);t&&this.multicodecs.includes(t.protocol)&&r(e)&&s.push(e)})),s=(0,dr.T)(s),t>0&&s.length>t&&(s=s.slice(0,t)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;const r=Date.now();e.connectedPeersBackoffSec.reset();for(const n of this.backoff.values()){t+=n.size;for(const[t,s]of n.entries())this.peers.has(t)&&e.connectedPeersBackoffSec.observe(Math.max(0,s-r)/1e3)}e.cacheSize.set({cache:"backoff"},t);for(const[t,r]of this.topics)e.topicPeersCount.set({topicStr:t},r.size);for(const[t,r]of this.mesh)e.meshPeerCounts.set({topicStr:t},r.size);const n=[],s=new Map;e.behaviourPenalty.reset();for(const t of this.peers.keys()){const r=this.score.score(t);n.push(r),s.set(t,r),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,s);const i=(0,on.i)(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(i)}}function jn(e={}){return t=>new Fn(t,e)}var Vn=r(6329),Wn=r(16397),$n=r(75845),qn=r(49796),Kn=r(90391);class Hn extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}var Gn=r(93270);function Jn(e,t,r){const n=r??{},s=(0,Gn.A)(e);return async function*(){let r;const i=()=>{null!=r&&r()};for(t.addEventListener("abort",i);;){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=n;throw new Hn(e,t)}const e=new Promise(((e,t)=>{r=()=>{const{abortMessage:e,abortCode:r}=n;t(new Hn(e,r))}}));o=await Promise.race([e,s.next()]),r=null}catch(r){t.removeEventListener("abort",i);const o="aborted"===r.type&&t.aborted;if(o&&null!=n.onAbort&&n.onAbort(e),"function"==typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=n.onReturnError&&n.onReturnError(e)}))}catch(e){null!=n.onReturnError&&n.onReturnError(e)}if(o&&!0===n.returnOnAbort)return;throw r}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",i)}()}var Zn=r(99688);class Qn extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function Yn(e,t){let r,n,s,i=(t=t??{}).onEnd,o=new Zn.u,a=(0,Ne.Z)();const c=e=>null!=n?n(e):(o.push(e),r),h=e=>{if(s)return r;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},u=e=>s?r:(s=!0,null!=e?(e=>(o=new Zn.u,null!=n?n({error:e}):(o.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?s?{done:!0}:await new Promise(((t,s)=>{n=i=>{n=null,o.push(i);try{t(e(o))}catch(e){s(e)}return r}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=(0,Ne.Z)()}))}},return:()=>(o=new Zn.u,u(),{done:!0}),throw:e=>(u(e),{done:!0}),push:h,end:u,get readableLength(){return o.size},onEmpty:async e=>{const t=e?.signal;if(t?.throwIfAborted(),o.isEmpty())return;let r,n;null!=t&&(r=new Promise(((e,r)=>{n=()=>{r(new Qn)},t.addEventListener("abort",n)})));try{await Promise.race([a.promise,r])}finally{null!=n&&null!=t&&t?.removeEventListener("abort",n)}}},null==i)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:e=>(l.throw(e),null!=i&&(i(e),i=void 0),{done:!0}),return:()=>(l.return(),null!=i&&(i(),i=void 0),{done:!0}),push:h,end:e=>(l.end(e),null!=i&&(i(e),i=void 0),r),get readableLength(){return l.readableLength}},r}var Xn=r(28050),es=r(35506),ts=r(73482),rs=r(99459);function ns(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const ss=ns("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),is=ns("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{e=e.substring(1);const t=(0,rs.E)(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}));var os={utf8:ss,"utf-8":ss,hex:ts.gh.base16,latin1:is,ascii:is,binary:is,...ts.gh};function as(e,t="utf8"){const r=os[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.decoder.decode(`${r.prefix}${e}`):(0,es.P)(globalThis.Buffer.from(e,"utf-8"))}function cs(e,t="utf8"){const r=os[t];if(null==r)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?r.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}var hs,us=r(62308);!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(hs||(hs={}));const ls=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),ds=Object.freeze({NEW_STREAM:hs.NEW_STREAM,MESSAGE:hs.MESSAGE_INITIATOR,CLOSE:hs.CLOSE_INITIATOR,RESET:hs.RESET_INITIATOR}),fs=Object.freeze({MESSAGE:hs.MESSAGE_RECEIVER,CLOSE:hs.CLOSE_RECEIVER,RESET:hs.RESET_RECEIVER}),ps=1<<20;class gs{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=ps,t=4194304){this._buffer=new us.H,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(e){if("ERR_MSG_TOO_BIG"===e.code)throw e;break}const{id:e,type:r,length:n,offset:s}=this._headerInfo;if(this._buffer.length-s<n)break;const i={id:e,type:r};r!==hs.NEW_STREAM&&r!==hs.MESSAGE_INITIATOR&&r!==hs.MESSAGE_RECEIVER||(i.data=this._buffer.sublist(s,s+n)),t.push(i),this._buffer.consume(s+n),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:r}=bs(e),{value:n,offset:s}=bs(e,r),i=7&t;if(null==ls[i])throw new Error(`Invalid type received: ${i}`);if(n>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:i,offset:r+s,length:n}}}const ms=128,ys=127;function bs(e,t=0){let r,n=0,s=0,i=t;const o=e.length;do{if(i>=o||s>49)throw t=0,new RangeError("Could not decode varint");r=e.get(i++),n+=s<28?(r&ys)<<s:(r&ys)*Math.pow(2,s),s+=7}while(r>=ms);return{value:n,offset:t=i-t}}const ws=1048576,vs=(e,t)=>{t.append(e)};var _s=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=new us.H,n=!1,s=(0,Ne.Z)(),i=Number(t?.size??ws);if((isNaN(i)||0===i||i<0)&&(i=ws),i!==Math.round(i))throw new Error("Batch size must be an integer");const o=t?.yieldAfter??0,a=t?.serialize??vs;for(Promise.resolve().then((async()=>{try{let t;for await(const n of e)a(n,r),r.byteLength>=i?(clearTimeout(t),s.resolve()):t=setTimeout((()=>{s.resolve()}),o);clearTimeout(t),s.resolve()}catch(e){s.reject(e)}finally{n=!0}}));!n;)if(await s.promise,s=(0,Ne.Z)(),r.byteLength>0){const e=r;r=new us.H,yield e.subarray()}}():function*(){const r=new us.H;let n=Number(t?.size??ws);if((isNaN(n)||0===n||n<0)&&(n=ws),n!==Math.round(n))throw new Error("Batch size must be an integer");const s=t?.serialize??vs;for(const t of e)s(t,r),r.byteLength>=n&&(yield r.subarray(0,n),r.consume(n));r.byteLength>0&&(yield r.subarray())}()},Es=r(81646);const ks=10240;const Ss=new class{_pool;_poolOffset;constructor(){this._pool=(0,Es.E)(ks),this._poolOffset=0}write(e,t){const r=this._pool;let n=this._poolOffset;Tn.cv(e.id<<3|e.type,r,n),n+=Tn.P$(e.id<<3|e.type),e.type!==hs.NEW_STREAM&&e.type!==hs.MESSAGE_INITIATOR&&e.type!==hs.MESSAGE_RECEIVER||null==e.data?(Tn.cv(0,r,n),n+=Tn.P$(0)):(Tn.cv(e.data.length,r,n),n+=Tn.P$(e.data.length));const s=r.subarray(this._poolOffset,n);ks-n<100?(this._pool=(0,Es.E)(ks),this._poolOffset=0):this._poolOffset=n,t.append(s),e.type!==hs.NEW_STREAM&&e.type!==hs.MESSAGE_INITIATOR&&e.type!==hs.MESSAGE_RECEIVER||null==e.data||t.append(e.data)}};var xs=r(6146);class Is extends xs.b{name;streamId;send;types;maxDataSize;constructor(e){super(e),this.types="outbound"===e.direction?ds:fs,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:ds.NEW_STREAM,data:new us.H(as(this.name))})}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}const Ts=a("libp2p:mplex");function As(e){const t={...e,type:`${ls[e.type]} (${e.type})`};return e.type===hs.NEW_STREAM&&(t.data=cs(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==hs.MESSAGE_INITIATOR&&e.type!==hs.MESSAGE_RECEIVER||(t.data=cs(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class Ds{protocol="/mplex/6.7.0";sink;source;_streamId;_streams;_init;_source;closeController;rateLimiter;closeTimeout;constructor(e){e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.closeTimeout=e.closeTimeout??500,this.sink=this._createSink(),this._source=function(e={}){return Yn((e=>{let t;const r=[];for(;!e.isEmpty()&&(t=e.shift(),null!=t);){if(null!=t.error)throw t.error;!1===t.done&&r.push(t.value)}return null==t?{done:!0}:{done:!0===t.done,value:r}}),e)}({objectMode:!0,onEnd:()=>{for(const e of this._streams.initiators.values())e.destroy();for(const e of this._streams.receivers.values())e.destroy()}}),this.source=(0,ne.z)(this._source,(e=>async function*(e,t=0){if(null!=t&&0!==t)yield*_s(e,{size:t,serialize:(e,t)=>{for(const r of e)Ss.write(r,t)}});else for await(const t of e){const e=new us.H;for(const r of t)Ss.write(r,e);yield e.subarray()}}(e,this._init.minSendBytes))),this.closeController=new AbortController,this.rateLimiter=new Xn.RateLimiterMemory({points:e.disconnectThreshold??5,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}async close(e){if(this.closeController.signal.aborted)return;const t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map((async e=>e.close({signal:t})))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(e){this.abort(e)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach((t=>{t.abort(e)})),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:r}=e,n=this._streams.receivers;return this._newStream({id:t,name:r,type:"receiver",registry:n})}_newStream(e){const{id:t,name:r,type:n,registry:s}=e;if(Ts("new %s stream %s",n,t),"initiator"===n&&this._streams.initiators.size===(this._init.maxOutboundStreams??1024))throw new P.sv("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(s.has(t))throw new Error(`${n} stream ${t} already exists!`);const i=function(e){const{id:t,name:r,send:n,onEnd:s,type:i="initiator",maxMsgSize:o=ps}=e;return new Is({id:"initiator"===i?`i${t}`:`r${t}`,streamId:t,name:`${null==r?t:r}`,direction:"initiator"===i?"outbound":"inbound",maxDataSize:o,onEnd:s,send:n,log:a(`libp2p:mplex:stream:${i}:${t}`)})}({id:t,name:r,send:async e=>{Ts.enabled&&Ts.trace("%s stream %s send",n,t,As(e)),this._source.push(e)},type:n,onEnd:()=>{Ts("%s stream with id %s and protocol %s ended",n,t,i.protocol),s.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(i)},maxMsgSize:this._init.maxMsgSize});return s.set(t,i),i}_createSink(){return async e=>{try{e=Jn(e,this.closeController.signal,{returnOnAbort:!0});const t=new gs(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const r of e)for(const e of t.write(r))await this._handleIncoming(e);this._source.end()}catch(e){Ts("error in sink",e),this._source.end(e)}}}async _handleIncoming(e){const{id:t,type:r}=e;if(Ts.enabled&&Ts.trace("incoming message",As(e)),e.type===hs.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??1024)){Ts("too many inbound streams open"),this._source.push({id:t,type:hs.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return Ts("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this.abort(new Error("Too many open streams"))}return}const r=this._newReceiverStream({id:t,name:cs(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(r))}const n=(1==(1&r)?this._streams.initiators:this._streams.receivers).get(t);if(null==n){Ts("missing stream %s for message type %s",t,ls[r]);try{await this.rateLimiter.consume("missing-stream",1)}catch{return Ts("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),void this.abort(new Error("Too many messages for missing streams"))}return}const s=this._init.maxStreamBufferSize??4194304;try{switch(r){case hs.MESSAGE_INITIATOR:case hs.MESSAGE_RECEIVER:if(n.sourceReadableLength()>s)throw this._source.push({id:e.id,type:r===hs.MESSAGE_INITIATOR?hs.RESET_RECEIVER:hs.RESET_INITIATOR}),new P.sv("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");n.sourcePush(e.data);break;case hs.CLOSE_INITIATOR:case hs.CLOSE_RECEIVER:n.remoteCloseWrite();break;case hs.RESET_INITIATOR:case hs.RESET_RECEIVER:n.reset();break;default:Ts("unknown message type %s",r)}}catch(e){Ts.error("error while processing message",e),n.abort(e)}}}class Ps{protocol="/mplex/6.7.0";_init;constructor(e={}){this._init=e}createStreamMuxer(e={}){return new Ds({...e,...this._init})}}function Cs(e={}){return()=>new Ps(e)}var Ms=r(27734),Rs=r(36985),Os=r(98399),Ns=(r(6568),r(55859)),Bs=(r(63790),r(32562),r(78560),r(59830));const Ls={rsa:r(64460),ed25519:Ns,secp256k1:r(9143)};function zs(e){const t=Object.keys(Ls).join(" / ");return new P.sv(`invalid or unsupported key type ${e}. Must be ${t}`,"ERR_UNSUPPORTED_KEY_TYPE")}function Us(e){const t=Bs.nh.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case Bs.Jz.RSA:return Ls.rsa.unmarshalRsaPublicKey(r);case Bs.Jz.Ed25519:return Ls.ed25519.unmarshalEd25519PublicKey(r);case Bs.Jz.Secp256k1:return Ls.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw zs(t.Type??"unknown")}}var Fs=r(89668),js=r(65415);const Vs=Symbol.for("nodejs.util.inspect.custom"),Ws=Object.values(ts.gh).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),ts.gh.identity.decoder),$s=114,qs=36,Ks=37;class Hs{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Bt.N]=!0;toString(){return null==this.string&&(this.string=i.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Oe.k0.createV1($s,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return(0,js.f)(this.multihash.bytes,e);if("string"==typeof e)return function(e,t){if(t=t??Ws,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Fs.Jx(i.base58btc.decode(`z${e}`));return e.startsWith("12D")?new Js({multihash:t}):e.startsWith("16U")?new Zs({multihash:t}):new Gs({multihash:t})}return Qs(Ws.decode(e))}(e).equals(this);if(null!=e?.multihash?.bytes)return(0,js.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Vs](){return`PeerId(${this.toString()})`}}class Gs extends Hs{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Js extends Hs{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}}class Zs extends Hs{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}}function Qs(e){try{const t=Fs.Jx(e);if(t.code===De.identity.code){if(t.digest.length===qs)return new Js({multihash:t});if(t.digest.length===Ks)return new Zs({multihash:t})}if(t.code===Pe.sha256.code)return new Gs({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==$s)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Pe.sha256.code)return new Gs({multihash:e.multihash});if(t.code===De.identity.code){if(t.digest.length===qs)return new Js({multihash:e.multihash});if(t.digest.length===Ks)return new Zs({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Oe.k0.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var Ys,Xs=r(32114),ei=r(79297),ti=r(41690),ri=r(805),ni=r(46888);!function(e){let t,r,n;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(r||(r={})),function(e){e.codec=()=>(0,ni.Ji)(r)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==n&&(n=(0,ni.yw)(((t,r,n={})=>{!1!==n.lengthDelimited&&r.fork(),null!=t.value&&(r.uint32(10),r.bytes(t.value)),null!=t.signatureV1&&(r.uint32(18),r.bytes(t.signatureV1)),null!=t.validityType&&(r.uint32(24),e.ValidityType.codec().encode(t.validityType,r)),null!=t.validity&&(r.uint32(34),r.bytes(t.validity)),null!=t.sequence&&(r.uint32(40),r.uint64(t.sequence)),null!=t.ttl&&(r.uint32(48),r.uint64(t.ttl)),null!=t.pubKey&&(r.uint32(58),r.bytes(t.pubKey)),null!=t.signatureV2&&(r.uint32(66),r.bytes(t.signatureV2)),null!=t.data&&(r.uint32(74),r.bytes(t.data)),!1!==n.lengthDelimited&&r.ldelim()}),((t,r)=>{const n={},s=null==r?t.len:t.pos+r;for(;t.pos<s;){const r=t.uint32();switch(r>>>3){case 1:n.value=t.bytes();break;case 2:n.signatureV1=t.bytes();break;case 3:n.validityType=e.ValidityType.codec().decode(t);break;case 4:n.validity=t.bytes();break;case 5:n.sequence=t.uint64();break;case 6:n.ttl=t.uint64();break;case 7:n.pubKey=t.bytes();break;case 8:n.signatureV2=t.bytes();break;case 9:n.data=t.bytes();break;default:t.skipType(7&r)}}return n}))),n),e.encode=t=>(0,ni.LE)(t,e.codec()),e.decode=t=>(0,ni.C6)(t,e.codec())}(Ys||(Ys={}));const si=a("ipns:utils"),ii=(0,At.m)("/ipns/");const oi=async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw si.error(e),Xs(e,ri.eb)}let r;if(null!=t.pubKey){try{r=Us(t.pubKey)}catch(e){throw si.error(e),e}if(!(await async function(e,t){return e.length===qs?new Js({multihash:Fs.Ue(De.identity.code,e),privateKey:t}):e.length===Ks?new Zs({multihash:Fs.Ue(De.identity.code,e),privateKey:t}):new Gs({multihash:await Pe.sha256.digest(e),publicKey:e,privateKey:t})}(t.pubKey)).equals(e))throw Xs(new Error("Embedded public key did not match PeerID"),ri.TO)}else null!=e.publicKey&&(r=Us(e.publicKey));if(null!=r)return r;throw Xs(new Error("no public key is available"),ri.eb)};function ai(e){const t=Ys.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw Xs(new Error("missing data or signatureV2"),ri.SY);const r=hi(t.data),n=ui(r.Value);let s;try{s=ei.fromDate(function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),r=String(e).trim().match(t);if(null==r)throw new Error("Invalid format");const n=parseInt(r[1],10),s=parseInt(r[2],10)-1,i=parseInt(r[3],10),o=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),h=parseInt(r[7].padEnd(6,"0").slice(0,3),10);return new Date(Date.UTC(n,s,i,o,a,c,h))}((0,fe.B)(r.Validity)))}catch(e){throw si.error("unrecognized validity format (not an rfc3339 format)"),Xs(new Error("unrecognized validity format (not an rfc3339 format)"),ri.vH)}if(null!=t.value&&null!=t.signatureV1)return li(t),{value:n,validityType:Ys.ValidityType.EOL,validity:s,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:n,validityType:Ys.ValidityType.EOL,validity:s,sequence:r.Sequence,ttl:r.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}const ci=e=>Qs(e.slice(ii.length)),hi=e=>{const t=Ce.Jx(e);if(0!==t.ValidityType)throw Xs(new Error("Unknown validity type"),ri.Fl);return t.ValidityType=Ys.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t},ui=e=>{if(null!=e){if((0,Bt.I)(e))return`/ipns/${e.toCID().toString(Re.base36)}`;if(e instanceof Uint8Array){const t=(0,fe.B)(e);t.startsWith("/")&&(e=t)}const t=e.toString().trim();if(t.startsWith("/")&&t.length>1)return t;const r=Oe.k0.asCID(e);if(null!=r)return 114===r.code?`/ipns/${r.toString(Re.base36)}`:`/ipfs/${r.toV1().toString()}`;try{return e instanceof Uint8Array?`/ipfs/${Oe.k0.decode(e).toV1().toString()}`:`/ipfs/${Oe.k0.parse(t).toV1().toString()}`}catch{}}throw Xs(new Error("Value must be a valid content path starting with /"),ri.rK)},li=e=>{if(null==e.data)throw Xs(new Error("Record data is missing"),ri.BL);const t=hi(e.data);if(!(0,O.f)(t.Value,e.value??new Uint8Array(0)))throw Xs(new Error('Field "value" did not match between protobuf and CBOR'),ri.SY);if(!(0,O.f)(t.Validity,e.validity??new Uint8Array(0)))throw Xs(new Error('Field "validity" did not match between protobuf and CBOR'),ri.SY);if(t.ValidityType!==e.validityType)throw Xs(new Error('Field "validityType" did not match between protobuf and CBOR'),ri.SY);if(t.Sequence!==e.sequence)throw Xs(new Error('Field "sequence" did not match between protobuf and CBOR'),ri.SY);if(t.TTL!==e.ttl)throw Xs(new Error('Field "ttl" did not match between protobuf and CBOR'),ri.SY)};function di(e,t){const r=t.map(((e,t)=>({record:ai(e),index:t})));return r.sort(((e,t)=>{const r=e.record.sequence,n=t.record.sequence;if(r>n)return-1;if(r<n)return 1;const s=e.record.validity.toDate(),i=t.record.validity.toDate();return s.getTime()>i.getTime()?-1:s.getTime()<i.getTime()?1:0})),r[0].index}const fi=a("ipns:validator"),pi=10240,gi=async(e,t)=>{const r=ai(t);let n;try{const t=(e=>{const t=(0,At.m)("ipns-signature:");return(0,ti.z)([t,e])})(r.data);n=await e.verify(t,r.signatureV2)}catch(e){n=!1}if(!n)throw fi.error("record signature verification failed"),Xs(new Error("record signature verification failed"),ri.SY);if(r.validityType===Ys.ValidityType.EOL){if(r.validity.toDate().getTime()<Date.now())throw fi.error("record has expired"),Xs(new Error("record has expired"),ri.L0)}else if(null!=r.validityType)throw fi.error("unrecognized validity type"),Xs(new Error("unrecognized validity type"),ri.Fl);fi("ipns record for %b is valid",r.value)};async function mi(e,t){if(t.byteLength>pi)throw Xs(new Error("record too large"),ri.LQ);const r=ci(e),n=ai(t),s=await oi(r,n);await gi(s,t)}var yi=r(25887),bi=r(537),wi=r(90704),vi=r(31027),_i=r(58541);const Ei={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};async function ki(e,t){const r={addresses:{listen:["/webrtc"]},transports:[(0,bi.f)({discoverRelays:1}),(0,Ms.Z)(),(0,Ms.R)(),(0,Os.d)(),(0,Rs.E)()],connectionEncryption:[(0,Vn.t)()],streamMuxers:[(0,Wn.P)(),Cs()],peerDiscovery:[(0,$n.U)(Ei)],contentRouters:[(0,qn.$)("https://cid.contact")],services:{identify:(0,vi.HA)(),autoNAT:(0,yi.D)(),pubsub:jn(),dcutr:(0,wi.P)(),dht:(0,Kn.p7)({clientMode:!0,validators:{ipns:mi},selectors:{ipns:di}}),ping:(0,_i.J)()}};return t=t??{},(0,Nt.N)({datastore:e,...r,...t,start:!1})}var Si=r(73776);const xi=a("helia");async function Ii(e={}){const t=e.datastore??new h.ar,r=e.blockstore??new c.DA;let n;n=function(e){if(null==e)return!1;return["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every((t=>"function"==typeof e[t]))}(e.libp2p)?e.libp2p:await ki(t,e.libp2p);const s=new Ot({...e,datastore:t,blockstore:r,libp2p:n});return!1!==e.start&&await s.start(),function(e){try{if(null==e.libp2p.services.identify.host.agentVersion.match(/js-libp2p\/\d+\.\d+\.\d+\sUserAgent=/))return;e.libp2p.services.identify.host.agentVersion=`${Si.u}/${Si.i} ${e.libp2p.services.identify.host.agentVersion}`}catch(e){xi.error("could not add Helia to agent version",e)}}(s),s}},73776:function(e,t,r){"use strict";r.d(t,{i:function(){return n},u:function(){return s}});const n="2.0.3",s="helia"},59830:function(e,t,r){"use strict";r.d(t,{Jz:function(){return n},_q:function(){return o},nh:function(){return i}});var n,s,i,o,a=r(46888);!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(n||(n={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(s||(s={})),function(e){e.codec=()=>(0,a.Ji)(s)}(n||(n={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,a.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),n.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:r.Type=n.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,a.LE)(t,e.codec()),e.decode=t=>(0,a.C6)(t,e.codec())}(i||(i={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,a.yw)(((e,t,r={})=>{!1!==r.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),n.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==r.lengthDelimited&&t.ldelim()}),((e,t)=>{const r={},s=null==t?e.len:e.pos+t;for(;e.pos<s;){const t=e.uint32();switch(t>>>3){case 1:r.Type=n.codec().decode(e);break;case 2:r.Data=e.bytes();break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>(0,a.LE)(t,e.codec()),e.decode=t=>(0,a.C6)(t,e.codec())}(o||(o={}))},65415:function(e,t,r){"use strict";function n(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}r.d(t,{f:function(){return n}})},8487:function(e,t,r){"use strict";r.d(t,{Dy:function(){return i.D},Jx:function(){return s.Jx},WU:function(){return i.W},cv:function(){return n.cv}});var n=r(16017),s=r(44608),i=r(3435)},22898:function(e,t,r){"use strict";r.d(t,{BB:function(){return c},Dz:function(){return a},Pu:function(){return b},mL:function(){return h},nI:function(){return u},qu:function(){return p},tP:function(){return l},un:function(){return f},zo:function(){return d}});const n=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,s=new TextDecoder,i=new TextEncoder;function o(e){return n&&globalThis.Buffer.isBuffer(e)}function a(e){return e instanceof Uint8Array?o(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const c=n?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):m(e,t,r):(e,t,r)=>r-t>64?s.decode(e.subarray(t,r)):m(e,t,r),h=n?e=>e.length>64?globalThis.Buffer.from(e):g(e):e=>e.length>64?i.encode(e):g(e),u=e=>Uint8Array.from(e),l=n?(e,t,r)=>o(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),d=n?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),a(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let t of e)n+t.length>r.length&&(t=t.subarray(0,r.length-n)),r.set(t,n),n+=t.length;return r},f=n?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function p(e,t){if(o(e)&&o(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function g(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):55296==(64512&s)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t}function m(e,t,r){const n=[];for(;t<r;){const s=e[t];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(t+o<=r){let r,n,a,c;switch(o){case 1:s<128&&(i=s);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&s)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&s)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&s)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=o}return b(n)}const y=4096;function b(e){const t=e.length;if(t<=y)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=y));return r}},65870:function(e,t,r){"use strict";r.d(t,{DO:function(){return o},IR:function(){return n},OO:function(){return s}});const n="CBOR decode error:",s="CBOR encode error:",i=[];function o(e,t,r){if(e.length-t<r)throw new Error(`${n} not enough data for type`)}i[23]=1,i[24]=2,i[25]=3,i[26]=5,i[27]=9},44608:function(e,t,r){"use strict";r.d(t,{Jx:function(){return l}});var n=r(65870),s=r(3435),i=r(65678);const o={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class a{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=i.PS[e];if(void 0===t){const r=i.cW[e];if(!r)throw new Error(`${n.IR} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=31&e;t=r(this.data,this._pos,s,this.options)}return this._pos+=t.encodedLength,t}}const c=Symbol.for("DONE"),h=Symbol.for("BREAK");function u(e,t){if(e.done())return c;const r=e.next();if(r.type===s.D.break)return h;if(r.type.terminal)return r.value;if(r.type===s.D.array)return function(e,t,r){const s=[];for(let i=0;i<e.value;i++){const o=u(t,r);if(o===h){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed array`)}if(o===c)throw new Error(`${n.IR} found array but not enough entries (got ${i}, expected ${e.value})`);s[i]=o}return s}(r,e,t);if(r.type===s.D.map)return function(e,t,r){const s=!0===r.useMaps,i=s?void 0:{},o=s?new Map:void 0;for(let a=0;a<e.value;a++){const l=u(t,r);if(l===h){if(e.value===1/0)break;throw new Error(`${n.IR} got unexpected break to lengthed map`)}if(l===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(!0!==s&&"string"!=typeof l)throw new Error(`${n.IR} non-string keys not supported (got ${typeof l})`);if(!0===r.rejectDuplicateMapKeys&&(s&&o.has(l)||!s&&l in i))throw new Error(`${n.IR} found repeat map key "${l}"`);const d=u(t,r);if(d===c)throw new Error(`${n.IR} found map but not enough entries (got ${a} [no value], expected ${e.value})`);s?o.set(l,d):i[l]=d}return s?o:i}(r,e,t);if(r.type===s.D.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=u(e,t);return t.tags[r.value](n)}throw new Error(`${n.IR} tag not supported (${r.value})`)}throw new Error("unsupported")}function l(e,t){const[r,s]=function(e,t){if(!(e instanceof Uint8Array))throw new Error(`${n.IR} data to decode must be a Uint8Array`);const r=(t=Object.assign({},o,t)).tokenizer||new a(e,t),s=u(r,t);if(s===c)throw new Error(`${n.IR} did not find any content to decode`);if(s===h)throw new Error(`${n.IR} got unexpected break`);return[s,e.subarray(r.pos())]}(e,t);if(s.length>0)throw new Error(`${n.IR} too many terminals, data makes no sense`);return r}},16017:function(e,t,r){"use strict";r.d(t,{cv:function(){return T}});var n=r(13026),s=r(3435),i=r(48561),o=r(65870),a=r(65678),c=r(22898),h=r(40640),u=r(63625),l=r(28027),d=r(10253),f=r(63789),p=r(7332),g=r(94049),m=r(32763),y=r(25108);const b={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const s=r.type.major,i=w[s].compareTokens(r,n);0===i&&y.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return i},quickEncodeToken:a.JN};const w=function(){const e=[];return e[s.D.uint.major]=h.Fh,e[s.D.negint.major]=u.UT,e[s.D.bytes.major]=l.hg,e[s.D.string.major]=d.YW,e[s.D.array.major]=f.HF,e[s.D.map.major]=p.KI,e[s.D.tag.major]=g.xy,e[s.D.float.major]=m.tA,e}(),v=new i.Bl;class _{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${o.OO} object contains circular references`);return new _(t,e)}}const E={null:new s.W(s.D.null,null),undefined:new s.W(s.D.undefined,void 0),true:new s.W(s.D.true,!0),false:new s.W(s.D.false,!1),emptyArray:new s.W(s.D.array,0),emptyMap:new s.W(s.D.map,0)},k={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new s.W(s.D.uint,e):new s.W(s.D.negint,e):new s.W(s.D.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new s.W(s.D.uint,e):new s.W(s.D.negint,e),Uint8Array:(e,t,r,n)=>new s.W(s.D.bytes,e),string:(e,t,r,n)=>new s.W(s.D.string,e),boolean:(e,t,r,n)=>e?E.true:E.false,null:(e,t,r,n)=>E.null,undefined:(e,t,r,n)=>E.undefined,ArrayBuffer:(e,t,r,n)=>new s.W(s.D.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new s.W(s.D.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[E.emptyArray,new s.W(s.D.break)]:E.emptyArray;n=_.createCheck(n,e);const i=[];let o=0;for(const t of e)i[o++]=S(t,r,n);return r.addBreakTokens?[new s.W(s.D.array,e.length),i,new s.W(s.D.break)]:[new s.W(s.D.array,e.length),i]},Object(e,t,r,n){const i="Object"!==t,o=i?e.keys():Object.keys(e),a=i?e.size:o.length;if(!a)return!0===r.addBreakTokens?[E.emptyMap,new s.W(s.D.break)]:E.emptyMap;n=_.createCheck(n,e);const c=[];let h=0;for(const t of o)c[h++]=[S(t,r,n),S(i?e.get(t):e[t],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(c,r),r.addBreakTokens?[new s.W(s.D.map,a),c,new s.W(s.D.break)]:[new s.W(s.D.map,a),c]}};k.Map=k.Object,k.Buffer=k.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))k[`${e}Array`]=k.DataView;function S(e,t={},r){const s=(0,n.is)(e),i=t&&t.typeEncoders&&t.typeEncoders[s]||k[s];if("function"==typeof i){const n=i(e,s,t,r);if(null!=n)return n}const a=k[s];if(!a)throw new Error(`${o.OO} unsupported type: ${s}`);return a(e,s,t,r)}function x(e,t,r,n){if(Array.isArray(t))for(const s of t)x(e,s,r,n);else r[t.type.major](e,t,n)}function I(e,t,r){const n=S(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const s=t[n.type.major];if(s.encodedSize){const e=s.encodedSize(n,r),t=new i.Bl(e);if(s(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return(0,c.Dz)(t.chunks[0])}}return v.reset(),x(v,n,t,r),v.toBytes(!0)}function T(e,t){return t=Object.assign({},b,t),I(e,w,t)}},65678:function(e,t,r){"use strict";r.d(t,{JN:function(){return b},PS:function(){return y},cW:function(){return m}});var n=r(3435),s=r(40640),i=r(63625),o=r(28027),a=r(10253),c=r(63789),h=r(7332),u=r(94049),l=r(32763),d=r(65870),f=r(22898);function p(e,t,r){throw new Error(`${d.IR} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function g(e){return()=>{throw new Error(`${d.IR} ${e}`)}}const m=[];for(let e=0;e<=23;e++)m[e]=p;m[24]=s.Km,m[25]=s.Zh,m[26]=s.cs,m[27]=s.uN,m[28]=p,m[29]=p,m[30]=p,m[31]=p;for(let e=32;e<=55;e++)m[e]=p;m[56]=i.yr,m[57]=i.r0,m[58]=i.wy,m[59]=i.ec,m[60]=p,m[61]=p,m[62]=p,m[63]=p;for(let e=64;e<=87;e++)m[e]=o.Ii;m[88]=o.UQ,m[89]=o.BS,m[90]=o.zU,m[91]=o.ME,m[92]=p,m[93]=p,m[94]=p,m[95]=g("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)m[e]=a.nt;m[120]=a.Bq,m[121]=a.h,m[122]=a.q0,m[123]=a.bc,m[124]=p,m[125]=p,m[126]=p,m[127]=g("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)m[e]=c.Ju;m[152]=c.h7,m[153]=c.OC,m[154]=c.lY,m[155]=c.a8,m[156]=p,m[157]=p,m[158]=p,m[159]=c.s5;for(let e=160;e<=183;e++)m[e]=h._K;m[184]=h.G,m[185]=h.qe,m[186]=h.IY,m[187]=h.F2,m[188]=p,m[189]=p,m[190]=p,m[191]=h.ng;for(let e=192;e<=215;e++)m[e]=u.qJ;m[216]=u.ZR,m[217]=u.CF,m[218]=u.vP,m[219]=u.MV,m[220]=p,m[221]=p,m[222]=p,m[223]=p;for(let e=224;e<=243;e++)m[e]=g("simple values are not supported");m[244]=p,m[245]=p,m[246]=p,m[247]=l.h1,m[248]=g("simple values are not supported"),m[249]=l.mW,m[250]=l.GI,m[251]=l.vV,m[252]=p,m[253]=p,m[254]=p,m[255]=l.y7;const y=[];for(let e=0;e<24;e++)y[e]=new n.W(n.D.uint,e,1);for(let e=-1;e>=-24;e--)y[31-e]=new n.W(n.D.negint,e,1);function b(e){switch(e.type){case n.D.false:return(0,f.nI)([244]);case n.D.true:return(0,f.nI)([245]);case n.D.null:return(0,f.nI)([246]);case n.D.bytes:return e.value.length?void 0:(0,f.nI)([64]);case n.D.string:return""===e.value?(0,f.nI)([96]):void 0;case n.D.array:return 0===e.value?(0,f.nI)([128]):void 0;case n.D.map:return 0===e.value?(0,f.nI)([160]):void 0;case n.D.uint:return e.value<24?(0,f.nI)([Number(e.value)]):void 0;case n.D.negint:if(e.value>=-24)return(0,f.nI)([31-Number(e.value)])}}y[64]=new n.W(n.D.bytes,new Uint8Array(0),1),y[96]=new n.W(n.D.string,"",1),y[128]=new n.W(n.D.array,0,1),y[160]=new n.W(n.D.map,0,1),y[244]=new n.W(n.D.false,!1,1),y[245]=new n.W(n.D.true,!0,1),y[246]=new n.W(n.D.null,null,1)},93270:function(e,t,r){"use strict";function n(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}r.d(t,{A:function(){return n}})},805:function(e,t,r){"use strict";r.d(t,{BL:function(){return c},Fl:function(){return s},L0:function(){return n},LQ:function(){return l},SY:function(){return i},TO:function(){return u},eb:function(){return a},rK:function(){return h},vH:function(){return o}});const n="ERR_IPNS_EXPIRED_RECORD",s="ERR_UNRECOGNIZED_VALIDITY",i="ERR_SIGNATURE_VERIFICATION",o="ERR_UNRECOGNIZED_FORMAT",a="ERR_UNDEFINED_PARAMETER",c="ERR_INVALID_RECORD_DATA",h="ERR_INVALID_VALUE",u="ERR_INVALID_EMBEDDED_KEY",l="ERR_RECORD_TOO_LARGE"},94688:function(e,t){"use strict";t.Z=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);}},27771:function(e,t,r){"use strict";var n=r(75671);t.Z=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r)&&(yield r)}();const r=(0,n.Z)(e),{value:s,done:i}=r.next();if(!0===i)return function*(){}();const o=t(s);if("function"==typeof o.then)return async function*(){await o&&(yield s);for await(const e of r)await t(e)&&(yield e)}();const a=t;return function*(){!0===o&&(yield s);for(const e of r)a(e)&&(yield e)}()}},28587:function(e,t,r){"use strict";var n=r(75671);t.Z=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r),yield r}();const r=(0,n.Z)(e),{value:s,done:i}=r.next();if(!0===i)return function*(){}();const o=t(s);if("function"==typeof o?.then)return async function*(){yield s;for await(const e of r)await t(e),yield e}();const a=t;return function*(){yield s;for(const e of r)a(e),yield e}()}},99688:function(e,t,r){"use strict";r.d(t,{u:function(){return s}});class n{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class s{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new n(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}},38578:function(e,t,r){"use strict";r.r(t),r.d(t,{base32:function(){return s},base32hex:function(){return c},base32hexpad:function(){return u},base32hexpadupper:function(){return l},base32hexupper:function(){return h},base32pad:function(){return o},base32padupper:function(){return a},base32upper:function(){return i},base32z:function(){return d}});var n=r(56731);const s=(0,n.ET)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),i=(0,n.ET)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o=(0,n.ET)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a=(0,n.ET)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),c=(0,n.ET)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),h=(0,n.ET)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),u=(0,n.ET)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),l=(0,n.ET)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d=(0,n.ET)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},26199:function(e,t,r){"use strict";r.r(t),r.d(t,{base36:function(){return s},base36upper:function(){return i}});var n=r(56731);const s=(0,n.kU)({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),i=(0,n.kU)({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})},16459:function(e,t,r){"use strict";r.r(t),r.d(t,{base58btc:function(){return s},base58flickr:function(){return i}});var n=r(56731);const s=(0,n.kU)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),i=(0,n.kU)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},5879:function(e,t,r){"use strict";r.r(t),r.d(t,{identity:function(){return o}});var n=r(91655),s=r(89668);const i=n.oQ,o={code:0,name:"identity",encode:i,digest:e=>s.Ue(0,i(e))}},96984:function(e,t,r){"use strict";r.r(t),r.d(t,{sha256:function(){return i},sha512:function(){return o}});var n=r(31919);const s=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),i=(0,n.D)({name:"sha2-256",code:18,encode:s("SHA-256")}),o=(0,n.D)({name:"sha2-512",code:19,encode:s("SHA-512")})},5689:function(e,t,r){"use strict";function n(e,t,r){let n=0,s=e.length;for(;s>0;){const i=Math.trunc(s/2);let o=n+i;r(e[o],t)<=0?(n=++o,s-=i+1):s=i}return n}r.d(t,{Z:function(){return n}})},4424:function(e,t,r){"use strict";r.d(t,{Lj:function(){return y},X3:function(){return m}});const n=(e,t)=>t.some((t=>e instanceof t));let s,i;const o=new WeakMap,a=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap;let l={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return p(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),p(o.get(this))}:function(...t){return p(e.apply(g(this),t))}:function(t,...r){const n=e.call(g(this),t,...r);return c.set(n,t.sort?t.sort():[t]),p(n)}}function f(e){return"function"==typeof e?d(e):(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)}));a.set(e,t)}(e),n(e,s||(s=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,l):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(p(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),u.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=f(e);return t!==e&&(h.set(e,t),u.set(t,e)),t}const g=e=>u.get(e);function m(e,t,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=p(o);return n&&o.addEventListener("upgradeneeded",(e=>{n(p(o.result),e.oldVersion,e.newVersion,p(o.transaction),e)})),r&&o.addEventListener("blocked",(e=>r(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}function y(e,{blocked:t}={}){const r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",(e=>t(e.oldVersion,e))),p(r).then((()=>{}))}const b=["get","getKey","getAll","getAllKeys","count"],w=["put","add","delete","clear"],v=new Map;function _(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(v.get(t))return v.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,s=w.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!b.includes(r))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[r](...t),s&&i.done]))[0]};return v.set(t,i),i}l=(e=>({...e,get:(t,r,n)=>_(t,r)||e.get(t,r,n),has:(t,r)=>!!_(t,r)||e.has(t,r)}))(l)},64348:function(e,t,r){"use strict";r.d(t,{s:function(){return n.s}});var n=r(66699)},66699:function(e,t,r){"use strict";r.d(t,{s:function(){return h}});var n=r(53416),s=r(49784),i=r(77408);const o="/",a=(new TextEncoder).encode(o),c=a[0];class h{constructor(e,t){if("string"==typeof e)this._buf=(0,i.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==c)throw new Error("Invalid key")}toString(e="utf8"){return(0,s.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new h(e.join(o))}static random(){return new h((0,n.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new h(e):"function"==typeof e.uint8Array?new h(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=a),this._buf[0]!==c){const e=new Uint8Array(this._buf.byteLength+1);e.fill(c,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===c;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],s=r[e];if(n<s)return!0;if(n>s)return!1}return t.length<r.length}reverse(){return h.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(o).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new h(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(o)||(e+=o),e+=this.type(),new h(e)}parent(){const e=this.list();return 1===e.length?new h(o):new h(e.slice(0,-1).join(o))}child(e){return this.toString()===o?e:e.toString()===o?this:new h(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return h.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}},3287:function(e,t){"use strict";const r="[a-fA-F\\d:]",n=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${r})|(?<=${r})(?=\\s|$))`:"",s="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",i="[a-fA-F\\d]{1,4}",o=`\n(?:\n(?:${i}:){7}(?:${i}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${i}:){6}(?:${s}|:${i}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${i}:){5}(?::${s}|(?::${i}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${i}:){4}(?:(?::${i}){0,1}:${s}|(?::${i}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${i}:){3}(?:(?::${i}){0,2}:${s}|(?::${i}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${i}:){2}(?:(?::${i}){0,3}:${s}|(?::${i}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${i}:){1}(?:(?::${i}){0,4}:${s}|(?::${i}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${i}){0,5}:${s}|(?::${i}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),a=new RegExp(`(?:^${s}$)|(?:^${o}$)`),c=new RegExp(`^${s}$`),h=new RegExp(`^${o}$`),u=e=>e&&e.exact?a:new RegExp(`(?:${n(e)}${s}${n(e)})|(?:${n(e)}${o}${n(e)})`,"g");u.v4=e=>e&&e.exact?c:new RegExp(`${n(e)}${s}${n(e)}`,"g"),u.v6=e=>e&&e.exact?h:new RegExp(`${n(e)}${o}${n(e)}`,"g"),t.Z=u},28807:function(e,t,r){"use strict";r.d(t,{D:function(){return s}});var n=r(77519);class s{_refCounter;cid;priority;wantType;constructor(e,t,r){this._refCounter=1,this.cid=e,this.priority=t??1,this.wantType=r}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(n.i)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}}},30002:function(e,t,r){"use strict";function n(e){const t=new globalThis.AbortController;function r(){t.abort();for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e){if(!0===t?.aborted){r();break}null!=t?.addEventListener&&t.addEventListener("abort",r)}const n=t.signal;return n.clear=function(){for(const t of e)null!=t?.removeEventListener&&t.removeEventListener("abort",r)},n}r.d(t,{N:function(){return n}})},34592:function(e,t,r){"use strict";var n=r(75671);t.Z=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)await t(r),yield r}();const r=(0,n.Z)(e),{value:s,done:i}=r.next();if(!0===i)return function*(){}();const o=t(s);if("function"==typeof o?.then)return async function*(){yield s;for await(const e of r)await t(e),yield e}();const a=t;return function*(){yield s;for(const e of r)a(e),yield e}()}},96932:function(e,t,r){"use strict";var n=r(75671);t.Z=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const r of e)yield t(r)}();const r=(0,n.Z)(e),{value:s,done:i}=r.next();if(!0===i)return function*(){}();const o=t(s);if("function"==typeof o.then)return async function*(){yield await o;for await(const e of r)yield t(e)}();const a=t;return function*(){yield o;for(const e of r)yield a(e)}()}},57514:function(e,t){"use strict";t.Z=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return}():function*(){let r=0;if(!(t<1))for(const n of e)if(yield n,r++,r===t)return}()}},77519:function(e,t,r){"use strict";r.d(t,{i:function(){return s}});var n=r(19446);const s=(0,n.kU)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});(0,n.kU)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},83747:function(e,t,r){"use strict";r.d(t,{fS:function(){return n},oQ:function(){return s}});new Uint8Array(0);const n=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},s=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}},63468:function(e,t,r){"use strict";r.d(t,{Jx:function(){return o},Ue:function(){return i},fS:function(){return a},zZ:function(){return c}});var n=r(83747),s=r(43085);const i=(e,t)=>{const r=t.byteLength,n=s.P$(e),i=n+s.P$(r),o=new Uint8Array(i+r);return s.mL(e,o,0),s.mL(r,o,n),o.set(t,i),new c(e,r,t,o)},o=e=>{const t=(0,n.oQ)(e),[r,i]=s.Jx(t),[o,a]=s.Jx(t.subarray(i)),h=t.subarray(i+a);if(h.byteLength!==o)throw new Error("Incorrect length");return new c(r,o,h,t)},a=(e,t)=>{if(e===t)return!0;{const r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&(0,n.fS)(e.bytes,r.bytes)}};class c{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}},43085:function(e,t,r){"use strict";r.d(t,{Jx:function(){return v},mL:function(){return _},P$:function(){return E}});var n=function e(t,r,n){r=r||[];var a=n=n||0;for(;t>=o;)r[n++]=255&t|s,t/=128;for(;t&i;)r[n++]=255&t|s,t>>>=7;return r[n]=0|t,e.bytes=n-a+1,r},s=128,i=-128,o=Math.pow(2,31);var a=function e(t,r){var n,s=0,i=0,o=r=r||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[o++],s+=i<28?(n&h)<<i:(n&h)*Math.pow(2,i),i+=7}while(n>=c);return e.bytes=o-r,s},c=128,h=127;var u=Math.pow(2,7),l=Math.pow(2,14),d=Math.pow(2,21),f=Math.pow(2,28),p=Math.pow(2,35),g=Math.pow(2,42),m=Math.pow(2,49),y=Math.pow(2,56),b=Math.pow(2,63),w={encode:n,decode:a,encodingLength:function(e){return e<u?1:e<l?2:e<d?3:e<f?4:e<p?5:e<g?6:e<m?7:e<y?8:e<b?9:10}};const v=(e,t=0)=>[w.decode(e,t),w.decode.bytes],_=(e,t,r=0)=>(w.encode(e,t,r),t),E=e=>w.encodingLength(e)},71115:function(e,t){"use strict";t.Z=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}})},1325:function(e,t,r){"use strict";r.d(t,{D:function(){return u}});var n=r(70248);var s=r(95972),i=r(67137);const o=new class{constructor(e){this.lru=n(e)}get(e){const t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}set(e,t,r){this.lru.set(e,{value:t,expire:Date.now()+r})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}(1e3),a=6e4,c=new(s.Z.default?s.Z.default:s.Z)({concurrency:4}),h=e=>{if(e.Path)return e.Path;throw new Error(e.Message)};async function u(e,t){return(async(e,t={})=>{const r=new URLSearchParams(t);r.set("arg",e);const n=r.toString();if(!t.nocache&&o.has(n)){const e=o.get(n);return h(e)}const s=await c.add((async()=>{const e=await i.get("https://ipfs.io/api/v0/dns",{searchParams:r}),t=new URL(e.url).search.slice(1),n=await e.json();return o.set(t,n,a),n}));return h(s)})(e,t)}},49260:function(e,t,r){"use strict";function n(){}r.d(t,{L:function(){return n}})},37608:function(e,t,r){"use strict";r.d(t,{M:function(){return Ze}});var n=r(37430),s=r(52019);const i=e=>null!=e&&("function"==typeof e[Symbol.asyncIterator]||"function"==typeof e[Symbol.iterator]||"function"==typeof e.next),o=e=>null!=e&&"function"==typeof e.sink&&i(e.source),a=e=>t=>{const r=e.sink(t);if(null!=r.then){const t=(0,n.d)({objectMode:!0});r.then((()=>{t.end()}),(e=>{t.end(e)}));const i=async function*(){yield*e.source,t.end()};return(0,s.Z)(t,i())}return e.source};function c(e,...t){if(o(e)){const t=e;e=()=>t.source}else if(i(e)){const t=e;e=()=>t}const r=[e,...t];if(r.length>1&&o(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)o(r[e])&&(r[e]=a(r[e]));return((...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t})(...r)}var h=r(64306),u=r(23366),l=r(69860),d=r(55305),f=r(46857);class p{constructor(e,t,r){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=r;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,r=!1){const{msgIdStr:n}=e;return!this.msgs.has(n)&&(this.msgs.set(n,{message:t,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),r||this.notValidatedCount++,!0)}observeDuplicate(e,t){const r=this.msgs.get(e);r&&!r.validated&&r.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const r=this.msgs.get(e);if(!r)return null;const n=(r.iwantCounts.get(t)??0)+1;return r.iwantCounts.set(t,n),{msg:r.message,count:n}}getGossipIDs(e){const t=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach((r=>{const n=this.msgs.get(r.msgIdStr);if(n&&n.validated&&e.has(r.topic)){let e=t.get(r.topic);e||(e=[],t.set(r.topic,e)),e.push(r.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;const{message:r,originatingPeers:n}=t;return t.validated=!0,t.originatingPeers=new Set,{message:r,originatingPeers:n}}shift(){this.history[this.history.length-1].forEach((e=>{const t=this.msgs.get(e.msgIdStr);t&&(this.msgs.delete(e.msgIdStr),t.validated||this.notValidatedCount--)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}var g=r(74368);const{RPC:m}=g,y="/floodsub/1.0.0",b="/meshsub/1.0.0",w="/meshsub/1.1.0",v=5e3;function _(e){if(e.length<=1)return e;for(let t=0;t<e.length;t++){const r=Math.floor(Math.random()*Math.floor(e.length)),n=e[t];e[t]=e[r],e[r]=n}return e}var E=r(49784);function k(e){return(0,E.B)(e,"base64")}var S,x,I,T,A,D=r(86906),P=r(6834);function C(e){switch(e){case P.Ct.Ignore:return I.Ignore;case P.Ct.Reject:return I.Reject}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(S||(S={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(x||(x={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(I||(I={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(T||(T={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(A||(A={}));const M="ERR_INVALID_PEER_SCORE_PARAMS";var R=r(52770);const O={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},N={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function B(e={}){return{...O,...e,topics:e.topics?Object.entries(e.topics).reduce(((e,[t,r])=>(e[t]=function(e={}){return{...N,...e}}(r),e)),{}):{}}}function L(e){if(e.topicWeight<0)throw new R.s("invalid topic weight; must be >= 0",M);if(0===e.timeInMeshQuantum)throw new R.s("invalid TimeInMeshQuantum; must be non zero",M);if(e.timeInMeshWeight<0)throw new R.s("invalid TimeInMeshWeight; must be positive (or 0 to disable)",M);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new R.s("invalid TimeInMeshQuantum; must be positive",M);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new R.s("invalid TimeInMeshCap; must be positive",M);if(e.firstMessageDeliveriesWeight<0)throw new R.s("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",M);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new R.s("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",M);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new R.s("invalid FirstMessageDeliveriesCap; must be positive",M);if(e.meshMessageDeliveriesWeight>0)throw new R.s("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",M);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new R.s("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",M);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new R.s("invalid MeshMessageDeliveriesCap; must be positive",M);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new R.s("invalid MeshMessageDeliveriesThreshold; must be positive",M);if(e.meshMessageDeliveriesWindow<0)throw new R.s("invalid MeshMessageDeliveriesWindow; must be non-negative",M);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new R.s("invalid MeshMessageDeliveriesActivation; must be at least 1s",M);if(e.meshFailurePenaltyWeight>0)throw new R.s("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",M);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new R.s("invalid MeshFailurePenaltyDecay; must be between 0 and 1",M);if(e.invalidMessageDeliveriesWeight>0)throw new R.s("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",M);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new R.s("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",M)}const z={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function U(e={}){return{...z,...e}}function F(e,t,r,n){let s=0;Object.entries(t.topics).forEach((([e,t])=>{const n=r.topics[e];if(void 0===n)return;let i=0;if(t.inMesh){let e=t.meshTime/n.timeInMeshQuantum;e>n.timeInMeshCap&&(e=n.timeInMeshCap),i+=e*n.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>n.firstMessageDeliveriesCap&&(o=n.firstMessageDeliveriesCap),i+=o*n.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n.meshMessageDeliveriesThreshold){const e=n.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;i+=e*e*n.meshMessageDeliveriesWeight}i+=t.meshFailurePenalty*n.meshFailurePenaltyWeight;i+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*n.invalidMessageDeliveriesWeight,s+=i*n.topicWeight})),r.topicScoreCap>0&&s>r.topicScoreCap&&(s=r.topicScoreCap);const i=r.appSpecificScore(e);if(s+=i*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),i=t?t.size:0;if(i>r.IPColocationFactorThreshold){const e=i-r.IPColocationFactorThreshold;s+=e*e*r.IPColocationFactorWeight}})),t.behaviourPenalty>r.behaviourPenaltyThreshold){const e=t.behaviourPenalty-r.behaviourPenaltyThreshold;s+=e*e*r.behaviourPenaltyWeight}return s}var j,V=r(59594);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(j||(j={}));class W{constructor(){this.records=new Map,this.queue=new V}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:j.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const r={msgId:e,expire:Date.now()+12e4};return this.queue.push(r),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function $(e,t,r=(()=>!0)){const n=new Set;if(t<=0)return n;for(const s of e){if(n.size>=t)break;r(s)&&(n.add(s),e.delete(s))}return n}class q extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}const K=(0,l.kg)("libp2p:gossipsub:score");class H{constructor(e,t,r){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new q((()=>new Set)),this.scoreCache=new Map,this.deliveryRecords=new W,function(e){for(const[t,r]of Object.entries(e.topics))try{L(r)}catch(e){throw new R.s(`invalid score parameters for topic ${t}: ${e.message}`,M)}if(e.topicScoreCap<0)throw new R.s("invalid topic score cap; must be positive (or 0 for no cap)",M);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new R.s("missing application specific score function",M);if(e.IPColocationFactorWeight>0)throw new R.s("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",M);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new R.s("invalid IPColocationFactorThreshold; must be at least 1",M);if(e.behaviourPenaltyWeight>0)throw new R.s("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",M);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new R.s("invalid BehaviourPenaltyDecay; must be between 0 and 1",M);if(e.decayInterval<1e3)throw new R.s("invalid DecayInterval; must be at least 1s",M);if(e.decayToZero<=0||e.decayToZero>=1)throw new R.s("invalid DecayToZero; must be between 0 and 1",M)}(e),this.scoreCacheValidityMs=r.scoreCacheValidityMs,this.computeScore=r.computeScore??F}get size(){return this.peerStats.size}start(){this._backgroundInterval?K("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),K("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),K("stopped")):K("Peer score already stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([e,t])=>[e,t])))}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((r,n)=>{r.connected?(Object.entries(r.topics).forEach((([r,n])=>{const s=this.params.topics[r];void 0!==s&&(n.firstMessageDeliveries*=s.firstMessageDeliveriesDecay,n.firstMessageDeliveries<t&&(n.firstMessageDeliveries=0),n.meshMessageDeliveries*=s.meshMessageDeliveriesDecay,n.meshMessageDeliveries<t&&(n.meshMessageDeliveries=0),n.meshFailurePenalty*=s.meshFailurePenaltyDecay,n.meshFailurePenalty<t&&(n.meshFailurePenalty=0),n.invalidMessageDeliveries*=s.invalidMessageDeliveriesDecay,n.invalidMessageDeliveries<t&&(n.invalidMessageDeliveries=0),n.inMesh&&(n.meshTime=e-n.graftTime,n.meshTime>s.meshMessageDeliveriesActivation&&(n.meshMessageDeliveriesActive=!0)))})),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<t&&(r.behaviourPenalty=0)):e>r.expire&&(this.removeIPsForPeer(n,r.knownIPs),this.peerStats.delete(n),this.scoreCache.delete(n))}))}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const r=Date.now(),n=this.scoreCache.get(e);if(n&&n.cacheUntil>r)return n.score;this.metrics?.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),i=r+this.scoreCacheValidityMs;return n?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-n.score)),n.score=s,n.cacheUntil=i):this.scoreCache.set(e,{score:s,cacheUntil:i}),s}addPenalty(e,t,r){const n=this.peerStats.get(e);n&&(n.behaviourPenalty+=t,this.metrics?.onScorePenalty(r))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const r=this.peerStats.get(e);r&&r.knownIPs.delete(t);const n=this.peerIPs.get(t);n&&(n.delete(e),0===n.size&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0)return this.removeIPsForPeer(e,t.knownIPs),void this.peerStats.delete(e);Object.entries(t.topics).forEach((([e,t])=>{t.firstMessageDeliveries=0;const r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){const e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){const r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){const t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,r){this.markFirstMessageDelivery(e,r);const n=this.deliveryRecords.ensureRecord(t),s=Date.now();n.status===j.unknown?(n.status=j.valid,n.validated=s,n.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,r)}))):K("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-n.firstSeen,j[n.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,r,n){switch(n){case I.Error:return void this.markInvalidMessageDelivery(e,r);case I.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status===j.unknown){if(n===I.Ignore)return s.status=j.ignored,void s.peers.clear();s.status=j.invalid,this.markInvalidMessageDelivery(e,r),s.peers.forEach((e=>{this.markInvalidMessageDelivery(e,r)})),s.peers.clear()}else K("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,j[s.status])}duplicateMessage(e,t,r){const n=this.deliveryRecords.ensureRecord(t);if(!n.peers.has(e))switch(n.status){case j.unknown:n.peers.add(e);break;case j.valid:n.peers.add(e),this.markDuplicateMessageDelivery(e,r,n.validated);break;case j.invalid:this.markInvalidMessageDelivery(e,r);case j.ignored:}}markInvalidMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const r=this.peerStats.get(e);if(r){const e=this.getPtopicStats(r,t);if(e){let r=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(r,e.firstMessageDeliveries+1),e.inMesh&&(r=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(r,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,r){const n=this.peerStats.get(e);if(n){const e=void 0!==r?Date.now():0,s=this.getPtopicStats(n,t);if(s&&s.inMesh){const n=this.params.topics[t];if(void 0!==r){const s=e-r,i=s>n.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,s,i),i)return}const i=n.meshMessageDeliveriesCap;s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const r of t){const t=this.peerIPs.get(r);t&&(t.delete(e),0===t.size&&this.peerIPs.delete(r))}}getPtopicStats(e,t){let r=e.topics[t];return void 0!==r?r:void 0!==this.params.topics[t]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=r,r):null}}class G{constructor(e,t,r){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=r,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const r=t[Math.floor(Math.random()*t.length)],n=this.msgIdToStrFn(r);let s=this.promises.get(n);s||(s=new Map,this.promises.set(n,s));const i=Date.now();s.has(e)||(s.set(e,i+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(n)||this.requestMsByMsg.set(n,i)))}getBrokenPromises(){const e=Date.now(),t=new Map;let r=0;return this.promises.forEach(((n,s)=>{n.forEach(((s,i)=>{s<e&&(t.set(i,(t.get(i)??0)+1),n.delete(i),r++)})),n.size||this.promises.delete(s)})),this.metrics?.iwantPromiseBroken.inc(r),t}deliverMessage(e,t=!1){this.trackMessage(e);const r=this.promises.get(e);r&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(e,t){this.trackMessage(e),t!==I.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[r,n]of this.requestMsByMsg.entries()){if(!(n<e))break;this.requestMsByMsg.delete(r),t++}this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}class J{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,r]of this.entries.entries()){if(!(r.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var Z,Q,Y,X,ee,te;!function(e){e.forward="forward",e.publish="publish"}(Z||(Z={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(Q||(Q={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Unsub="unsubscribed",e.Excess="excess"}(Y||(Y={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(X||(X={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(ee||(ee={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(te||(te={}));var re=r(41690),ne=r(77408),se=r(79944),ie=r(73062);const oe=(0,ne.m)("libp2p-pubsub:");var ae=r(27353),ce=r(86257);function he(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return(0,ce.Pc)(e.from.toBytes(),e.sequenceNumber)}async function ue(e){return await ae.sha256.encode(e.data)}function le(e,t,r,n,s){let i=0;const o=new Map;if(Object.entries(t.topics).forEach((([e,t])=>{const n=s.get(e)??"unknown",a=r.topics[e];if(void 0===a)return;let c=o.get(n);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(n,c));let h=0,u=0,l=0,d=0,f=0;if(t.inMesh){h+=Math.max(t.meshTime/a.timeInMeshQuantum,a.timeInMeshCap)*a.timeInMeshWeight}let p=t.firstMessageDeliveries;if(p>a.firstMessageDeliveriesCap&&(p=a.firstMessageDeliveriesCap),u+=p*a.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const e=a.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;l+=e*e*a.meshMessageDeliveriesWeight}d+=t.meshFailurePenalty*a.meshFailurePenaltyWeight;f+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*a.invalidMessageDeliveriesWeight,i+=(h+u+l+d+f)*a.topicWeight,c.p1w+=h,c.p2w+=u,c.p3w+=l,c.p3bw+=d,c.p4w+=f})),r.topicScoreCap>0&&i>r.topicScoreCap){i=r.topicScoreCap;const e=r.topicScoreCap/i;for(const t of o.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,c=0,h=0;a+=r.appSpecificScore(e)*r.appSpecificWeight,t.knownIPs.forEach((e=>{if(r.IPColocationFactorWhitelist.has(e))return;const t=n.get(e),s=t?t.size:0;if(s>r.IPColocationFactorThreshold){const e=s-r.IPColocationFactorThreshold;c+=e*e*r.IPColocationFactorWeight}}));return h+=t.behaviourPenalty*t.behaviourPenalty*r.behaviourPenaltyWeight,i+=a+c+h,{byTopic:o,p5w:a,p6w:c,p7w:h,score:i}}var de=r(28391),fe=r(62308),pe=r(72004),ge=r(66574);const me=Math.pow(2,7),ye=Math.pow(2,14),be=Math.pow(2,21),we=Math.pow(2,28),ve=Math.pow(2,35),_e=Math.pow(2,42),Ee=Math.pow(2,49),ke=Math.pow(2,56),Se=Math.pow(2,63),xe={encodingLength:e=>e<me?1:e<ye?2:e<be?3:e<we?4:e<ve?5:e<_e?6:e<Ee?7:e<ke?8:e<Se?9:10,encode(e,t,r=0){if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return null==t&&(t=(0,ge.E)(xe.encodingLength(e))),pe.Z.fromNumber(e).toBytes(t,r),t},decode:(e,t=0)=>pe.Z.fromBytes(e,t).toNumber(!0)};const Ie=e=>{const t=xe.encodingLength(e),r=(n=t,null!=globalThis?.Buffer?.allocUnsafe?globalThis.Buffer.allocUnsafe(n):new Uint8Array(n));var n;return xe.encode(e,r),Ie.bytes=t,r};function Te(e){const t=(e=e??{}).lengthEncoder??Ie;return async function*(e){for await(const r of e){const e=t(r.byteLength);e instanceof Uint8Array?yield e:yield*e,r instanceof Uint8Array?yield r:yield*r}}}Ie.bytes=0,Te.single=(e,t)=>{const r=(t=t??{}).lengthEncoder??Ie;return new fe.H(r(e.byteLength),e)};var Ae=r(32114);var De;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(De||(De={}));const Pe=e=>{const t=xe.decode(e);return Pe.bytes=xe.encodingLength(t),t};function Ce(e){return async function*(t){const r=new fe.H;let n=De.LENGTH,s=-1;const i=e?.lengthDecoder??Pe,o=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;for await(const c of t)for(r.append(c);r.byteLength>0;){if(n===De.LENGTH)try{if(s=i(r),s<0)throw Ae(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>a)throw Ae(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const t=i.bytes;r.consume(t),null!=e?.onLength&&e.onLength(s),n=De.DATA}catch(e){if(e instanceof RangeError){if(r.byteLength>o)throw Ae(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw e}if(n===De.DATA){if(r.byteLength<s)break;const t=r.sublist(0,s);r.consume(s),null!=e?.onData&&e.onData(t),yield t,n=De.LENGTH}}if(r.byteLength>0)throw Ae(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}Pe.bytes=0,Ce.fromReader=(e,t)=>{let r=1;const n=async function*(){for(;;)try{const{done:t,value:n}=await e.next(r);if(!0===t)return;null!=n&&(yield n)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}();return Ce({...t??{},onLength:e=>{r=e}})(n)};class Me{constructor(e,t,r){this.rawStream=e,this.pushable=(0,n.d)({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,c((0,de.wJ)(this.pushable,this.closeController.signal,{returnOnAbort:!0}),Te(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class Re{constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=(0,de.wJ)(c(this.rawStream,Ce(t)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var Oe=r(61641);const Ne={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function Be(e,t){t={...t};const r=Oe.Reader.create(e),n=e.length,s=void 0===n?r.len:r.pos+n,i={};for(;r.pos<s;){const e=r.uint32();switch(e>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.length<t.maxSubscriptions?i.subscriptions.push(Le(r,r.uint32())):r.skipType(7&e);break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.length<t.maxMessages?i.messages.push(ze(r,r.uint32())):r.skipType(7&e);break;case 3:i.control=Ue(r,r.uint32(),t);break;default:r.skipType(7&e)}}return i}function Le(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topic=e.string();break;default:e.skipType(7&t)}}return n}function ze(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topic=e.string();break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&t)}}if(!n.topic)throw Error("missing required 'topic'");return n}function Ue(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.length<r.maxControlMessages?s.ihave.push(Fe(e,e.uint32(),r)):e.skipType(7&t);break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.length<r.maxControlMessages?s.iwant.push(je(e,e.uint32(),r)):e.skipType(7&t);break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.length<r.maxControlMessages?s.graft.push(Ve(e,e.uint32())):e.skipType(7&t);break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.length<r.maxControlMessages?s.prune.push(We(e,e.uint32(),r)):e.skipType(7&t);break;default:e.skipType(7&t)}}return s}function Fe(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:s.topicID=e.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),r.maxIhaveMessageIDs-- >0?s.messageIDs.push(e.bytes()):e.skipType(7&t);break;default:e.skipType(7&t)}}return s}function je(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),r.maxIwantMessageIDs-- >0?s.messageIDs.push(e.bytes()):e.skipType(7&t);else e.skipType(7&t)}return s}function Ve(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();if(t>>>3==1)n.topicID=e.string();else e.skipType(7&t)}return n}function We(e,t,r){const n=void 0===t?e.len:e.pos+t,s={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:s.topicID=e.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),r.maxPeerInfos-- >0?s.peers.push($e(e,e.uint32())):e.skipType(7&t);break;case 3:s.backoff=e.uint64();break;default:e.skipType(7&t)}}return s}function $e(e,t){const r=void 0===t?e.len:e.pos+t,n={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.peerID=e.bytes();break;case 2:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n}var qe,Ke=r(72835);!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(qe||(qe={}));var He;!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(He||(He={}));class Ge extends f.v{constructor(e,t={}){super(),this.multicodecs=[w,b],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=(0,n.d)({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:He.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{const e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=e&&e(),this.status.code===He.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}}))};const r={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:B(t.scoreParams),scoreThresholds:U(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=r.decodeRpcLimits??Ne,this.globalSignaturePolicy=r.globalSignaturePolicy??P.xq,r.fallbackToFloodsub&&this.multicodecs.push(y),this.log=(0,l.kg)(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map((e=>e.id.toString()))),this.seenCache=new J({validityMs:r.seenTTL}),this.publishedMessageIds=new J({validityMs:r.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case P.xq:this.msgIdFn=he;break;case P.Q_:this.msgIdFn=ue}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new J({validityMs:r.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??k,this.mcache=t.messageCache||new p(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const e=Math.max(...Object.values(r.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),1e3),n=function(e,t,r){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:e.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:e.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:e.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:e.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,r){const n=this.toTopic(e);this.meshPeerInclusionEvents.inc({topic:n,reason:t},r)},onRemoveFromMesh(e,t,r){const n=this.toTopic(e);this.meshPeerChurnEvents.inc({topic:n,reason:t},r)},onReportValidationMcacheHit(e){this.asyncValidationMcacheHit.inc({hit:e?"hit":"miss"})},onReportValidation(e,t){const r=this.toTopic(e);this.asyncValidationResult.inc({topic:r,acceptance:t})},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,r){const n=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:n},t),this.ihaveRcvNotSeenMsgids.inc({topic:n},r)},onIwantRcv(e,t){for(const[t,r]of e){const e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const r=this.toTopic(e);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},t)},onPublishMsg(e,t,r,n){const s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},r*n),this.msgPublishPeers.inc({topic:s},r),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"direct"},t.direct),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"floodsub"},t.floodsub),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"mesh"},t.mesh),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"fanout"},t.fanout)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvResult(e,t){const r=this.toTopic(e);this.msgReceivedStatus.inc({topic:r,status:t})},onMsgRecvInvalid(e,t){const r=this.toTopic(e),n=t.reason===I.Error?t.error:t.reason;this.msgReceivedInvalid.inc({topic:r,error:n},1)},onDuplicateMsgDelivery(e,t,r){if(this.duplicateMsgDeliveryDelay.observe(t/1e3),r){const t=this.toTopic(e);this.duplicateMsgLateDelivery.inc({topic:t},1)}},onPublishDuplicateMsg(e){const t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),e.messages&&this.rpcRecvMessage.inc(e.messages.length),e.control&&(this.rpcRecvControl.inc(1),e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),e.messages&&this.rpcSentMessage.inc(e.messages.length),e.control){const t=e.control.ihave?.length??0,r=e.control.iwant?.length??0,n=e.control.graft?.length??0,s=e.control.prune?.length??0;t>0&&this.rpcSentIHave.inc(t),r>0&&this.rpcSentIWant.inc(r),n>0&&this.rpcSentGraft.inc(n),s>0&&this.rpcSentPrune.inc(s),(t>0||r>0||n>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let r=0,n=0,s=0,i=0;for(const o of e)o>=t.graylistThreshold&&r++,o>=t.publishThreshold&&n++,o>=t.gossipThreshold&&s++,o>=0&&i++;this.peersByScoreThreshold.set({threshold:te.graylist},r),this.peersByScoreThreshold.set({threshold:te.publish},n),this.peersByScoreThreshold.set({threshold:te.gossip},s),this.peersByScoreThreshold.set({threshold:te.mesh},i),this.score.set(e)},registerScoreWeights(e){for(const[t,r]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},r.p1w),this.scoreWeights.set({topic:t,p:"p2"},r.p2w),this.scoreWeights.set({topic:t,p:"p3"},r.p3w),this.scoreWeights.set({topic:t,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:t,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const r=new Map;e.forEach(((e,t)=>{const n=this.topicStrToLabel.get(t)??"unknown";let s=r.get(n);s||(s=new Set,r.set(n,s)),e.forEach((e=>s?.add(e)))}));for(const[e,n]of r){const r=[];n.forEach((e=>{r.push(t.get(e)??0)})),this.scorePerMesh.set({topic:e},r)}}}}(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});n.mcacheSize.addCollect((()=>this.onScrapeMetrics(n)));for(const e of this.multicodecs)n.protocolsEnabled.set({protocol:e},1);this.metrics=n}else this.metrics=null;this.gossipTracer=new G(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new H(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=r.allowedTopics?new Set(r.allowedTopics):null}getPeers(){return[...this.peers.keys()].map((e=>(0,u.jE)(e)))}isStarted(){return this.status.code===He.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await async function(e,t){switch(e){case P.xq:{if(!t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await(0,D.unmarshalPrivateKey)(t.privateKey);return{type:x.Signing,author:t,key:t.publicKey,privateKey:e}}case P.Q_:return{type:x.Anonymous};default:throw new Error(`Unknown signature policy "${e}"`)}}(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=(0,n.d)({objectMode:!0}),c(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:r}of e)await this.createOutboundStream(t,r)})).catch((e=>this.log.error("outbound inflight queue error",e))),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.peerStore.addressBook.add(e.id,e.addrs)})));const e=this.components.registrar;await Promise.all(this.multicodecs.map((t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const t=(0,d.a)({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),r=await Promise.all(this.multicodecs.map((r=>e.register(r,t)))),s=setTimeout(this.runHeartbeat,100);this.status={code:He.started,registrarTopologyIds:r,heartbeatTimeout:s,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>await this.connect(e))))})).catch((e=>{this.log(e)}))}),1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==He.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:He.stopped};const t=this.components.registrar;e.forEach((e=>t.unregister(e))),this.outboundInflightQueue.end();for(const e of this.streamsOutbound.values())e.close();this.streamsOutbound.clear();for(const e of this.streamsInbound.values())e.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const r=t.remotePeer;this.addPeer(r,t.stat.direction,t.remoteAddr),this.createInboundStream(r,e),this.outboundInflightQueue.push({peerId:r,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.stat.status}),this.isStarted()&&"OPEN"===t.stat.status&&(this.addPeer(e,t.stat.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{const n=new Me(await t.newStream(this.multicodecs),(e=>this.log.error("outbound pipe error",e)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(r,n);const s=n.protocol;s===y&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}async createInboundStream(e,t){if(!this.isStarted())return;const r=e.toString();if(!this.peers.has(r))return;const n=this.streamsInbound.get(r);void 0!==n&&(this.log("replacing existing inbound steam %s",r),n.close()),this.log("create inbound stream %s",r);const s=new Re(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,s),this.pipePeerReadStream(e,s.source).catch((e=>this.log(e)))}addPeer(e,t,r){const n=e.toString();if(!this.peers.has(n)){this.log("new peer %p",e),this.peers.add(n),this.score.addPeer(n);const s=function(e){for(const t of e.tuples())switch(t[0]){case qe.ip4:case qe.ip6:return(0,Ke.xV)(t[0],t[1])}return null}(r);null!==s?this.score.addIP(n,s):this.log("Added peer has no IP in current address %s %s",n,r.toString()),this.outbound.has(n)||this.outbound.set(n,"outbound"===t)}}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const r=this.streamsOutbound.get(t),n=this.streamsInbound.get(t);r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close(),n?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const e of this.topics.values())e.delete(t);for(const[e,r]of this.mesh)!0===r.delete(t)&&this.metrics?.onRemoveFromMesh(e,Y.Dc,1);for(const e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===He.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map((e=>(0,u.jE)(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await c(t,(async t=>{for await(const r of t)try{const t=r.subarray(),n=Be(t,this.decodeRpcLimits);this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,n):this.handleReceivedRpc(e,n).catch((e=>this.log(e)))}catch(e){this.log(e)}}))}catch(t){this.handlePeerReadStreamError(t,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void this.metrics?.rpcRecvNotAccepted.inc();if(this.log("rpc from %p",e),t.subscriptions&&t.subscriptions.length>0){const r=[];t.subscriptions.forEach((t=>{const n=t.topic,s=!0===t.subscribe;if(null!=n){if(this.allowedTopics&&!this.allowedTopics.has(n))return;this.handleReceivedSubscription(e,n,s),r.push({topic:n,subscribe:s})}})),this.dispatchEvent(new f.A("subscription-change",{detail:{peerId:e,subscriptions:r}}))}if(t.messages)for(const r of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(r.topic))continue;const t=this.handleReceivedMessage(e,r).catch((e=>this.log(e)));this.opts.awaitRpcMessageHandler&&await t}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,r){this.log("subscription update from %p topic %s",e,t);let n=this.topics.get(t);null==n&&(n=new Set,this.topics.set(t,n)),r?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const r=await this.validateReceivedMessage(e,t);switch(this.metrics?.onMsgRecvResult(t.topic,r.code),r.code){case A.duplicate:return this.score.duplicateMessage(e.toString(),r.msgIdStr,t.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),void this.mcache.observeDuplicate(r.msgIdStr,e.toString());case A.invalid:if(r.msgIdStr){const n=r.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,r.reason),this.gossipTracer.rejectMessage(n,r.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void this.metrics?.onMsgRecvInvalid(t.topic,r);case A.valid:if(this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)){this.components.peerId.equals(e)&&!this.opts.emitSelf||(super.dispatchEvent(new f.A("gossipsub:message",{detail:{propagationSource:e,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new f.A("message",{detail:r.msg})))}this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const r=this.fastMsgIdFn?.(t),n=void 0!==r?this.fastMsgIdCache?.get(r):void 0;if(n)return{code:A.duplicate,msgIdStr:n};const s=await async function(e,t){switch(e){case P.Q_:return null!=t.signature?{valid:!1,error:T.SignaturePresent}:null!=t.seqno?{valid:!1,error:T.SeqnoPresent}:null!=t.key?{valid:!1,error:T.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case P.xq:{if(null==t.seqno)return{valid:!1,error:T.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:T.InvalidSeqno};if(null==t.signature)return{valid:!1,error:T.InvalidSignature};if(null==t.from)return{valid:!1,error:T.InvalidPeerId};let e,r;try{e=(0,u.cv)(t.from)}catch(e){return{valid:!1,error:T.InvalidPeerId}}if(t.key){if(r=(0,D.unmarshalPublicKey)(t.key),void 0!==e.publicKey&&!(0,ie.f)(r.bytes,e.publicKey))return{valid:!1,error:T.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:T.InvalidPeerId};r=(0,D.unmarshalPublicKey)(e.publicKey)}const n={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},s=(0,re.z)([oe,m.Message.encode(n).finish()]);return await r.verify(s,t.signature)?{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${(0,E.B)(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:t.key??(0,D.marshalPublicKey)(r)}}:{valid:!1,error:T.InvalidSignature}}}}(this.globalSignaturePolicy,t);if(!s.valid)return{code:A.invalid,reason:I.Error,error:s.error};const i=s.message;try{this.dataTransform&&(i.data=this.dataTransform.inboundTransform(t.topic,i.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:A.invalid,reason:I.Error,error:T.TransformFailed}}const o=await this.msgIdFn(i),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(void 0!==r&&this.fastMsgIdCache){this.fastMsgIdCache.put(r,a)&&this.metrics?.fastMsgIdCacheCollision.inc()}if(this.seenCache.has(a))return{code:A.duplicate,msgIdStr:a};this.seenCache.put(a);const h=this.topicValidators.get(t.topic);if(null!=h){let t;try{t=await h(e,i)}catch(e){const r=e.code;"ERR_TOPIC_VALIDATOR_IGNORE"===r&&(t=P.Ct.Ignore),t="ERR_TOPIC_VALIDATOR_REJECT"===r?P.Ct.Reject:P.Ct.Ignore}if(t!==P.Ct.Accept)return{code:A.invalid,reason:C(t),msgIdStr:a}}return{code:A.valid,messageId:c,msg:i}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,r){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:r})))})}async handleControlMessage(e,t){if(void 0===t)return;const r=t.ihave?this.handleIHave(e,t.ihave):[],n=t.iwant?this.handleIWant(e,t.iwant):[],s=t.graft?await this.handleGraft(e,t.graft):[];t.prune&&await this.handlePrune(e,t.prune),(r.length||n.length||s.length)&&this.sendRpc(e,{messages:n,control:{iwant:r,prune:s}})}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),r=this.acceptFromWhitelist.get(e);if(r&&r.messagesAccepted<128&&r.acceptUntil>=t)return r.messagesAccepted+=1,!0;const n=this.score.score(e);return n>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),n>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:ee.LowScore}),[];const n=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,n),n>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:ee.MaxIhave}),[];const s=this.iasked.get(e)??0;if(s>=v)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:ee.MaxIasked}),[];const i=new Map;if(t.forEach((({topicID:e,messageIDs:t})=>{if(!e||!t||!this.mesh.has(e))return;let r=0;t.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(i.set(t,e),r++)})),this.metrics?.onIhaveRcv(e,t.length,r)})),!i.size)return[];let o=i.size;o+s>v&&(o=v-s),this.log("IHAVE: Asking for %d out of %d messages from %s",o,i.size,e);let a=Array.from(i.values());return _(a),a=a.slice(0,o),this.iasked.set(e,s+o),this.gossipTracer.addPromise(e,a),[{messageIDs:a}]}handleIWant(e,t){if(!t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];const n=new Map,s=new Map;let i=0;return t.forEach((({messageIDs:t})=>{t&&t.forEach((t=>{const r=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(r,e);null!=o?(s.set(o.msg.topic,1+(s.get(o.msg.topic)??0)),o.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):n.set(r,o.msg)):i++}))})),this.metrics?.onIwantRcv(s,i),n.size?(this.log("IWANT: Sending %d messages to %s",n.size,e),Array.from(n.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const r=[],n=this.score.score(e),s=Date.now();let i=this.opts.doPX;return t.forEach((({topicID:t})=>{if(!t)return;const o=this.mesh.get(t);if(!o)return void(i=!1);if(o.has(e))return;if(this.direct.has(e))return this.log("GRAFT: ignoring request from direct peer %s",e),r.push(t),void(i=!1);const a=this.backoff.get(t)?.get(e);if("number"==typeof a&&s<a){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,X.GraftBackoff),i=!1;const n=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return s<n&&this.score.addPenalty(e,1,X.GraftBackoff),this.addBackoff(e,t),void r.push(t)}return n<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,n,t),r.push(t),i=!1,void this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(r.push(t),void this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),void this.metrics?.onAddToMesh(t,Q.Subscribed,1))})),r.length?await Promise.all(r.map((t=>this.makePrune(e,t,i)))):[]}async handlePrune(e,t){const r=this.score.score(e);for(const{topicID:n,backoff:s,peers:i}of t){if(null==n)continue;const t=this.mesh.get(n);if(!t)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,n),this.score.prune(e,n),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(n,Y.Unsub,1)),"number"==typeof s&&s>0?this.doAddBackoff(e,n,1e3*s):this.addBackoff(e,n),i&&i.length){if(r<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,r,n);continue}await this.pxConnect(i)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,r){let n=this.backoff.get(t);n||(n=new Map,this.backoff.set(t,n));const s=Date.now()+r;(n.get(e)??0)<s&&n.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,X.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!=0)return;const e=Date.now();this.backoff.forEach(((t,r)=>{t.forEach(((r,n)=>{r<e&&t.delete(n)})),0===t.size&&this.backoff.delete(r)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>await this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&(_(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(!e.peerID)return;const r=(0,u.cv)(e.peerID).toString();if(!this.peers.has(r))if(e.signedPeerRecord)try{const n=await h.X.openAndCertify(e.signedPeerRecord,"libp2p-peer-record"),s=n.peerId;if(!n.peerId.equals(r))return void this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",s,r);if(!await this.components.peerStore.addressBook.consumePeerRecord(n))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(r)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(r)}))),t.length&&await Promise.all(t.map((async e=>await this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=(0,u.jE)(e),r=await this.components.connectionManager.openConnection(t);for(const e of this.multicodecs)for(const n of this.components.registrar.getTopologies(e))n.onConnect(t,r)}subscribe(e){if(this.status.code!==He.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==He.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e)}join(e){if(this.status.code!==He.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,r=this.fanout.get(e);if(r&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),r.forEach((e=>{!this.direct.has(e)&&this.score.score(e)>=0&&t.add(e)})),this.metrics?.onAddToMesh(e,Q.Fanout,t.size)),t.size<this.opts.D){const r=t.size;this.getRandomGossipPeers(e,this.opts.D,(e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0)).forEach((e=>{t.add(e)})),this.metrics?.onAddToMesh(e,Q.Random,t.size-r)}this.mesh.set(e,t),t.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}leave(e){if(this.status.code!==He.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map((async t=>(this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e))))).catch((e=>{this.log("Error sending prunes to mesh peers",e)})),this.mesh.delete(e))}selectPeersToForward(e,t,r){const n=new Set,s=this.topics.get(e);s&&(this.direct.forEach((e=>{s.has(e)&&t!==e&&!r?.has(e)&&n.add(e)})),this.floodsubPeers.forEach((e=>{s.has(e)&&t!==e&&!r?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&n.add(e)})));const i=this.mesh.get(e);return i&&i.size>0&&i.forEach((e=>{t===e||r?.has(e)||n.add(e)})),n}selectPeersToPublish(e){const t=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},n=this.topics.get(e);if(n)if(this.opts.floodPublish)n.forEach((e=>{this.direct.has(e)?(t.add(e),r.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));else{this.direct.forEach((e=>{n.has(e)&&(t.add(e),r.direct++)})),this.floodsubPeers.forEach((e=>{n.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),r.floodsub++)}));const s=this.mesh.get(e);if(s&&s.size>0)s.forEach((e=>{t.add(e),r.mesh++}));else{const n=this.fanout.get(e);if(n&&n.size>0)n.forEach((e=>{t.add(e),r.fanout++}));else{const n=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));n.size>0&&(this.fanout.set(e,n),n.forEach((e=>{t.add(e),r.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:r}}forwardMessage(e,t,r,n){r&&this.score.deliverMessage(r,e,t.topic);const s=this.selectPeersToForward(t.topic,r,n);s.forEach((e=>{this.sendRpc(e,{messages:[t]})})),this.metrics?.onForwardMsg(t.topic,s.size)}async publish(e,t,r){const n=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:s,msg:i}=await async function(e,t,r,n){switch(e.type){case x.Signing:{const s={from:e.author.toBytes(),data:n,seqno:(0,se.O6)(8),topic:t,signature:void 0,key:void 0},i=(0,re.z)([oe,m.Message.encode(s).finish()]);return s.signature=await e.privateKey.sign(i),s.key=e.key,{raw:s,msg:{type:"signed",from:e.author,data:r,sequenceNumber:BigInt(`0x${(0,E.B)(s.seqno,"base16")}`),topic:t,signature:s.signature,key:s.key}}}case x.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:t}}}}(this.publishConfig,e,t,n),o=await this.msgIdFn(i),a=this.msgIdToStrFn(o),c=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(a)){if(c)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:h,tosendCount:l}=this.selectPeersToPublish(e),d=!0===this.opts.emitSelf&&this.subscriptions.has(e),p=r?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(0===h.size&&!p&&!d)throw Error("PublishError.InsufficientPeers");this.seenCache.put(a),this.mcache.put({msgId:o,msgIdStr:a},s,!0),this.publishedMessageIds.put(a);for(const e of h){this.sendRpc(e,{messages:[s]})||h.delete(e)}return this.metrics?.onPublishMsg(e,l,h.size,null!=s.data?s.data.length:0),d&&(h.add(this.components.peerId.toString()),super.dispatchEvent(new f.A("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:a,msg:i}})),super.dispatchEvent(new f.A("message",{detail:i}))),{recipients:Array.from(h.values()).map((e=>(0,u.jE)(e)))}}reportMessageValidationResult(e,t,r){if(r===P.Ct.Accept){const n=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(null!==n),null!=n){const{message:s,originatingPeers:i}=n;this.score.deliverMessage(t.toString(),e,s.topic),this.forwardMessage(e,n.message,t.toString(),i),this.metrics?.onReportValidation(s.topic,r)}}else{const n=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(null!==n),n){const s=C(r),{message:i,originatingPeers:o}=n;this.score.rejectMessage(t.toString(),e,i.topic,s);for(const t of o)this.score.rejectMessage(t,e,i.topic,s);this.metrics?.onReportValidation(i.topic,r)}}}sendGraft(e,t){const r=[{topicID:t}];this.sendRpc(e,{control:{graft:r}})}async sendPrune(e,t){const r=[await this.makePrune(e,t,this.opts.doPX)];this.sendRpc(e,{control:{prune:r}})}sendRpc(e,t){const r=this.streamsOutbound.get(e);if(!r)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const n=this.control.get(e);n&&(this.piggybackControl(e,t,n),this.control.delete(e));const s=this.gossip.get(e);s&&(this.piggybackGossip(e,t,s),this.gossip.delete(e));const i=m.encode(t).finish();try{r.push(i)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),n&&this.control.set(e,n),s&&this.gossip.set(e,s),!1}return this.metrics?.onRpcSent(t,i.length),!0}piggybackControl(e,t,r){if(r.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(const n of r.graft)n.topicID&&this.mesh.get(n.topicID)?.has(e)&&t.control.graft.push(n)}if(r.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(const n of r.prune)n.topicID&&!this.mesh.get(n.topicID)?.has(e)&&t.control.prune.push(n)}}piggybackGossip(e,t,r){t.control||(t.control={}),t.control.ihave=r}async sendGraftPrune(e,t,r){const n=this.opts.doPX;for(const[s,i]of e){const e=i.map((e=>({topicID:e})));let o=[];const a=t.get(s);a&&(o=await Promise.all(a.map((async e=>await this.makePrune(s,e,n&&!r.get(s))))),t.delete(s)),this.sendRpc(s,{control:{graft:e,prune:o}})}for(const[e,s]of t){const t=await Promise.all(s.map((async t=>await this.makePrune(e,t,n&&!r.get(e)))));this.sendRpc(e,{control:{prune:t}})}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[r,n]of e)this.doEmitGossip(r,n,t.get(r)??[])}doEmitGossip(e,t,r){if(!r.length)return;if(_(r),r.length>v&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),!t.size)return;let n=this.opts.Dlazy;const s=.25*t.size;let i=t;s>n&&(n=s),n>i.size?n=i.size:i=_(Array.from(i)).slice(0,n),i.forEach((t=>{let n=r;r.length>v&&(n=_(n.slice()).slice(0,v)),this.pushGossip(t,{topicID:e,messageIDs:n})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);const r=this.gossip.get(e)||[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,r){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===b)return{topicID:t,peers:[]};const n=this.opts.pruneBackoff/1e3;if(!r)return{topicID:t,peers:[],backoff:n};const s=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),i=await Promise.all(Array.from(s).map((async e=>{const t=(0,u.jE)(e);return{peerID:t.toBytes(),signedPeerRecord:await this.components.peerStore.addressBook.getRawEnvelope(t)}})));return{topicID:t,peers:i,backoff:n}}async heartbeat(){const{D:e,Dlo:t,Dhi:r,Dscore:n,Dout:s,fanoutTTL:i}=this.opts;this.heartbeatTicks++;const o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},c=new Map,h=new Map,u=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const l=new Map;this.mesh.forEach(((i,o)=>{const d=this.topics.get(o),f=new Set,p=new Set;if(l.set(o,p),d){const e=_(Array.from(d)),t=this.backoff.get(o);for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!i.has(r)&&!this.direct.has(r)){const e=a(r);t&&t.has(r)||!(e>=0)||f.add(r),e>=this.opts.scoreThresholds.gossipThreshold&&p.add(r)}}}const g=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),i.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&p.add(e),this.metrics?.onRemoveFromMesh(o,t,1);const r=h.get(e);r?r.push(o):h.set(e,[o])},m=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),i.add(e),p.delete(e),this.metrics?.onAddToMesh(o,t,1);const r=c.get(e);r?r.push(o):c.set(e,[o])};if(i.forEach((e=>{const t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),g(e,Y.BadScore),u.set(e,!0))})),i.size<t){const t=function(e,t){return $(e,t,(()=>!0))}(f,e-i.size);t.forEach((e=>{m(e,Q.NotEnough)}))}if(i.size>r){let t=Array.from(i);t.sort(((e,t)=>a(t)-a(e))),t=t.slice(0,n).concat(_(t.slice(n)));let r=0;if(t.slice(0,e).forEach((e=>{this.outbound.get(e)&&r++})),r<s){const n=e=>{const r=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=r};if(r>0){let s=r;for(let r=1;r<e&&s>0;r++)this.outbound.get(t[r])&&(n(r),s--)}let s=e-r;for(let r=e;r<t.length&&s>0;r++)this.outbound.get(t[r])&&(n(r),s--)}t.slice(e).forEach((e=>{g(e,Y.Excess)}))}if(i.size>=t){let e=0;if(i.forEach((t=>{this.outbound.get(t)&&e++})),e<s){$(f,s-e,(e=>!0===this.outbound.get(e))).forEach((e=>{m(e,Q.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&i.size>1){const e=Array.from(i).sort(((e,t)=>a(e)-a(t))),t=Math.floor(i.size/2),r=a(e[t]);if(r<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=$(f,this.opts.opportunisticGraftPeers,(e=>a(e)>r));for(const t of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,o),m(t,Q.Opportunistic)}}}));const d=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+i<d&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((t,r)=>{const n=this.topics.get(r);t.forEach((e=>{(!n.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)}));const s=this.topics.get(r),i=[],o=new Set;if(l.set(r,o),s){const e=_(Array.from(s));for(const r of e){const e=this.streamsOutbound.get(r);if(e&&this.multicodecs.includes(e.protocol)&&!t.has(r)&&!this.direct.has(r)){const e=a(r);e>=this.opts.scoreThresholds.publishThreshold&&i.push(r),e>=this.opts.scoreThresholds.gossipThreshold&&o.add(r)}}}if(t.size<e){const r=e-t.size;i.slice(0,r).forEach((e=>{t.add(e),o?.delete(e)}))}})),this.emitGossip(l),await this.sendGraftPrune(c,h,u),this.flush(),this.mcache.shift(),this.dispatchEvent(new f.A("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,r=(()=>!0)){const n=this.topics.get(e);if(!n)return new Set;let s=[];return n.forEach((e=>{const t=this.streamsOutbound.get(e);t&&this.multicodecs.includes(t.protocol)&&r(e)&&s.push(e)})),s=_(s),t>0&&s.length>t&&(s=s.slice(0,t)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(const e of this.backoff.values())t+=e.size;e.cacheSize.set({cache:"backoff"},t);for(const[t,r]of this.topics)e.topicPeersCount.set({topicStr:t},r.size);for(const[t,r]of this.mesh)e.meshPeerCounts.set({topicStr:t},r.size);const r=[],n=new Map;e.behaviourPenalty.reset();for(const t of this.peers.keys()){const s=this.score.score(t);r.push(s),n.set(t,s),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(r,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,n);const s=function(e,t,r,n,s){const i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of e){const e=t.get(o);if(e){const t=le(o,e,r,n,s);for(const[e,r]of t.byTopic){let t=i.byTopic.get(e);t||(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(e,t)),t.p1w.push(r.p1w),t.p2w.push(r.p2w),t.p3w.push(r.p3w),t.p3bw.push(r.p3bw),t.p4w.push(r.p4w)}i.p5w.push(t.p5w),i.p6w.push(t.p6w),i.p7w.push(t.p7w),i.score.push(t.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}}function Je(e={}){return t=>new Ge(t,e)}Ge.multicodec=w;const Ze=()=>({gossipsub:Je({fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128})})},42637:function(e,t,r){"use strict";r.d(t,{s:function(){return s}});var n=r(64584);function s(){const e=(0,n.n)();return{transports:[e.transport],peerDiscovery:[e.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1}}}},6:function(e,t,r){"use strict";r.d(t,{M:function(){return c}});var n=r(67137),s=r(69860),i=r(95972);const o=(0,s.kg)("ipfs:preload"),a=new(i.Z.default?i.Z.default:i.Z)({concurrency:4});function c(e,t={}){return o(e),a.add((async()=>{const r=(await n.post(e,{signal:t.signal})).body.getReader();try{for(;;){const{done:e}=await r.read();if(e)return}}finally{r.releaseLock()}}))}},83523:function(e,t,r){"use strict";r.d(t,{x:function(){return C}});var n=r(63204),s=r(64348),i=r(32114);function o(e){return e=e||new Error("Write failed"),i(e,"ERR_DB_WRITE_FAILED")}var a=r(66699);const c="SHARDING";const h=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();var u=r(93361),l=r(44752),d=r(56635);class f{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,u.Z)(this.putMany(e,r)),e=[],await(0,u.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,l.Z)(r,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,l.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>h(e,t)),r)),null!=e.offset){let t=0;r=(0,l.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,l.Z)(r,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,l.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>h(e,t)),r)),null!=e.offset){let t=0;r=(0,l.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}}new s.s(c),new s.s("_README");(0,r(69860).kg)("datastore:core:tiered");var p=r(21007),g=r(34751),m=r(21301);class y extends f{constructor(e,t={}){super(),this.db="string"==typeof e?new m.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw function(e){return e=e||new Error("Cannot open database"),i(e,"ERR_DB_OPEN_FAILED")}(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(e){throw o(e)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(e){if(e.notFound)throw function(e){return e=e||new Error("Not Found"),i(e,"ERR_NOT_FOUND")}(e);throw o(e)}return t}async has(e){try{await this.db.get(e.toString())}catch(e){if(e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(e.toString())}catch(e){throw function(e){return e=e||new Error("Delete failed"),i(e,"ERR_DB_DELETE_FAILED")}(e)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,r)=>{e.push({type:"put",key:t.toString(),value:r})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,l.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,g.Z)(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=(0,l.Z)(t,(()=>e++>=r))}return n&&(t=(0,d.Z)(t,n)),t}queryKeys(e){let t=(0,p.Z)(this._query({values:!1,prefix:e.prefix}),(({key:e})=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,l.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,g.Z)(e,t)),t));const{offset:r,limit:n}=e;if(r){let e=0;t=(0,l.Z)(t,(()=>e++>=r))}return n&&(t=(0,d.Z)(t,n)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const r=e.prefix.toString();t.gte=r,t.lt=r+""}const r=this.db.iterator(t);if(r[Symbol.asyncIterator])return async function*(e){for await(const[t,r]of e)yield{key:new s.s(t,!1),value:r};await e.close()}(r);if(null!=r.next&&null!=r.end)return n=r,{[Symbol.asyncIterator]:()=>({next:()=>new Promise(((e,t)=>{n.next(((r,i,o)=>r?t(r):null==i?n.end((r=>{if(r)return t(r);e({done:!0,value:void 0})})):void e({done:!1,value:{key:new s.s(i,!1),value:o}})))})),return:()=>new Promise(((e,t)=>{n.end((r=>{if(r)return t(r);e({done:!0,value:void 0})}))}))})};var n;throw new Error("Level returned incompatible iterator")}}var b=r(37430),w=r(38161),v=r(53137),_=r(29094),E=r(14249),k=r(81653);const S=(e,t)=>async function*(){const r=await async function(e){const t=[];for await(const r of e)t.push(r);return t}(e);yield*r.sort(t)}();class x{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:n}of e)await this.put(r,n,t),yield{key:r,value:n}}async*getMany(e,t={}){for await(const r of e)yield this.get(r,t)}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(t,r){e.push({key:t,value:r})},delete(e){t.push(e)},commit:async r=>{await(0,u.Z)(this.putMany(e,r)),e=[],await(0,u.Z)(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(null!=e.prefix&&(r=(0,l.Z)(r,(t=>t.key.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,l.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>S(e,t)),r)),null!=e.offset){let t=0;r=(0,l.Z)(r,(()=>t++>=(e.offset||0)))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(null!=e.prefix&&(r=(0,l.Z)(r,(t=>t.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(r=e.filters.reduce(((e,t)=>(0,l.Z)(e,t)),r)),Array.isArray(e.orders)&&(r=e.orders.reduce(((e,t)=>S(e,t)),r)),null!=e.offset){let t=0;r=(0,l.Z)(r,(()=>t++>=e.offset))}return null!=e.limit&&(r=(0,d.Z)(r,e.limit)),r}}function I(e){const t=w.k0.asCID(e);if(!t)throw i(new Error("Not a valid cid"),"ERR_INVALID_CID");return new a.s("/"+E.base32.encode(t.multihash.bytes).slice(1).toUpperCase(),!1)}function T(e){return w.k0.createV1(v.code,_.Jx(E.base32.decode("b"+e.toString().slice(1).toLowerCase())))}function A(e){const t=e.substring(0,1);if("/"===t)return A(e.substring(1));let r,n;r="b"===t.toLowerCase()?e=>E.base32.decode(e.toLowerCase()).subarray(2):"c"===t.toLowerCase()?e=>E.base32pad.decode(e.toLowerCase()).subarray(2):"z"===t?e=>k.base58btc.decode(e).subarray(2):"Q"===t?e=>k.base58btc.decode("z"+e):e=>E.base32.decode("b"+e.toLowerCase()).subarray(2);for(let t=1;t<e.length;t++)try{n=r(e.substring(0,t))}catch(e){if("Unexpected end of data"!==e.message)throw e}let s="/C";return n&&(s=`/${E.base32.encode(n).slice(1,-1).toUpperCase()||"C"}`),s}class D extends x{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:r,value:n}of this.child.query(function(e){return{...e,prefix:e.prefix?A(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e({key:T(t.key),value:t.value}))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e({key:T(t.key),value:t.value},{key:T(r.key),value:r.value}))):void 0}}(e),t))yield{key:T(r),value:n}}async*queryKeys(e,t){for await(const r of this.child.queryKeys(function(e){return{...e,prefix:e.prefix?A(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e(T(t)))):void 0,orders:e.orders?e.orders.map((e=>(t,r)=>e(T(t),T(r)))):void 0}}(e),t))yield T(r)}async get(e,t){return this.child.get(I(e),t)}async*getMany(e,t){for await(const r of e)yield this.get(r,t)}async put(e,t,r){await this.child.put(I(e),t,r)}async*putMany(e,t){const r=(0,b.d)({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)((async()=>{try{const n=this.child;await(0,u.Z)(this.child.putMany(async function*(){for await(const s of e){const e=I(s.key);await n.has(e,t)||(yield{key:e,value:s.value}),r.push(s)}}())),r.end()}catch(e){r.end(e)}})),yield*r}has(e,t){return this.child.has(I(e),t)}delete(e,t){return this.child.delete(I(e),t)}deleteMany(e,t){const r=(0,b.d)({objectMode:!0});return(0,u.Z)(this.child.deleteMany(async function*(){for await(const t of e)yield I(t),r.push(t);r.end()}(),t)).catch((e=>{r.end(e)})),r}}var P=r(83723);function C(e,t,r){const s=r.path||"ipfs";return(0,n.x)(s,(e=>t.getCodec(e)),{root:new y(s,{prefix:"",version:2}),blocks:new D(new y(`${s}/blocks`,{prefix:"",version:2})),datastore:new y(`${s}/datastore`,{prefix:"",version:2}),keys:new y(`${s}/keys`,{prefix:"",version:2}),pins:new y(`${s}/pins`,{prefix:"",version:2})},{autoMigrate:r.autoMigrate,onMigrationProgress:r.onMigrationProgress||e,repoLock:P.G})}},49121:function(e,t,r){"use strict";r.d(t,{tK:function(){return h},Xu:function(){return u}});var n=r(32114),s=r(52197);const i=s.Reader,o=s.Writer,a=s.util,c=s.roots["ipfs-unixfs"]||(s.roots["ipfs-unixfs"]={});c.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=a.newBuffer([]),e.prototype.filesize=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=a.emptyArray,e.prototype.hashType=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.fanout=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=o.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var r=0;r<e.blocksizes.length;++r)t.uint32(32).uint64(e.blocksizes[r]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&c.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new c.Data;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;case 3:n.filesize=e.uint64();break;case 4:if(n.blocksizes&&n.blocksizes.length||(n.blocksizes=[]),2==(7&s))for(var o=e.uint32()+e.pos;e.pos<o;)n.blocksizes.push(e.uint64());else n.blocksizes.push(e.uint64());break;case 5:n.hashType=e.uint64();break;case 6:n.fanout=e.uint64();break;case 7:n.mode=e.uint32();break;case 8:n.mtime=c.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("Type"))throw a.ProtocolError("missing required 'Type'",{instance:n});return n},e.fromObject=function(e){if(e instanceof c.Data)return e;var t=new c.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?a.base64.decode(e.Data,t.Data=a.newBuffer(a.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&(a.Long?(t.filesize=a.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new a.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var r=0;r<e.blocksizes.length;++r)a.Long?(t.blocksizes[r]=a.Long.fromValue(e.blocksizes[r])).unsigned=!0:"string"==typeof e.blocksizes[r]?t.blocksizes[r]=parseInt(e.blocksizes[r],10):"number"==typeof e.blocksizes[r]?t.blocksizes[r]=e.blocksizes[r]:"object"==typeof e.blocksizes[r]&&(t.blocksizes[r]=new a.LongBits(e.blocksizes[r].low>>>0,e.blocksizes[r].high>>>0).toNumber(!0))}if(null!=e.hashType&&(a.Long?(t.hashType=a.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new a.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&(a.Long?(t.fanout=a.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new a.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=c.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.blocksizes=[]),t.defaults){if(r.Type=t.enums===String?"Raw":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=a.newBuffer(r.Data))),a.Long){var n=new a.Long(0,0,!0);r.filesize=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.filesize=t.longs===String?"0":0;if(a.Long){n=new a.Long(0,0,!0);r.hashType=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.hashType=t.longs===String?"0":0;if(a.Long){n=new a.Long(0,0,!0);r.fanout=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.fanout=t.longs===String?"0":0;r.mode=0,r.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?c.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?a.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?r.filesize=t.longs===String?String(e.filesize):e.filesize:r.filesize=t.longs===String?a.Long.prototype.toString.call(e.filesize):t.longs===Number?new a.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){r.blocksizes=[];for(var s=0;s<e.blocksizes.length;++s)"number"==typeof e.blocksizes[s]?r.blocksizes[s]=t.longs===String?String(e.blocksizes[s]):e.blocksizes[s]:r.blocksizes[s]=t.longs===String?a.Long.prototype.toString.call(e.blocksizes[s]):t.longs===Number?new a.LongBits(e.blocksizes[s].low>>>0,e.blocksizes[s].high>>>0).toNumber(!0):e.blocksizes[s]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?r.hashType=t.longs===String?String(e.hashType):e.hashType:r.hashType=t.longs===String?a.Long.prototype.toString.call(e.hashType):t.longs===Number?new a.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?r.fanout=t.longs===String?String(e.fanout):e.fanout:r.fanout=t.longs===String?a.Long.prototype.toString.call(e.fanout):t.longs===Number?new a.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(r.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(r.mtime=c.UnixTime.toObject(e.mtime,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),c.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Seconds=a.Long?a.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=o.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new c.UnixTime;e.pos<r;){var s=e.uint32();switch(s>>>3){case 1:n.Seconds=e.int64();break;case 2:n.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&s)}}if(!n.hasOwnProperty("Seconds"))throw a.ProtocolError("missing required 'Seconds'",{instance:n});return n},e.fromObject=function(e){if(e instanceof c.UnixTime)return e;var t=new c.UnixTime;return null!=e.Seconds&&(a.Long?(t.Seconds=a.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new a.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(a.Long){var n=new a.Long(0,0,!1);r.Seconds=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.Seconds=t.longs===String?"0":0;r.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?r.Seconds=t.longs===String?String(e.Seconds):e.Seconds:r.Seconds=t.longs===String?a.Long.prototype.toString.call(e.Seconds):t.longs===Number?new a.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(r.FractionalNanoseconds=e.FractionalNanoseconds),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e})(),c.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=o.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new c.Metadata;e.pos<r;){var s=e.uint32();if(s>>>3==1)n.MimeType=e.string();else e.skipType(7&s)}return n},e.fromObject=function(e){if(e instanceof c.Metadata)return e;var t=new c.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(r.MimeType=e.MimeType),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e})(),parseInt("0644",8),parseInt("0755",8);function h(e){if(null!=e)return"number"==typeof e?4095&e:"0"===(e=e.toString()).substring(0,1)?4095&parseInt(e,8):4095&parseInt(e,10)}function u(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const r=e.getTime(),n=Math.floor(r/1e3);t={secs:n,nsecs:1e3*(r-1e3*n)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw n(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}},5377:function(e,t,r){"use strict";async function n(e){const t=[];for await(const r of e)t.push(r);return t}r.d(t,{Z:function(){return n}})},45764:function(e,t,r){"use strict";function n(e){const[t,r]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:e=>{n.push(e)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}r.d(t,{Z:function(){return n}})},97295:function(e,t){"use strict";t.Z=()=>{}},89755:function(e,t,r){"use strict";r.d(t,{n:function(){return h}});var n=r(32114),s=r(53597),i=r(45764),o=r(21007),a=r(20530),c=r(49121);async function*h(e,t){if("string"==typeof e||e instanceof String||(0,a._t)(e)||(0,a.Lj)(e)||e._readableState)throw n(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if((0,a.Os)(e)&&(e=(0,s.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const r=(0,i.Z)(e),{value:s,done:c}=await r.peek();if(c)return void(yield*[]);if(r.push(s),Number.isInteger(s))throw n(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(s._readableState)return void(yield*(0,o.Z)(r,(e=>u({content:e},t))));if((0,a._t)(s))return void(yield u({content:r},t));if((0,a.Mk)(s)||s[Symbol.iterator]||s[Symbol.asyncIterator]||(0,a.Os)(s)||(0,a.Lj)(s))return void(yield*(0,o.Z)(r,(e=>u(e,t))))}if((0,a.Mk)(e))throw n(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");throw n(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}async function u(e,t){const{path:r,mode:n,mtime:s,content:i}=e,o={path:r||"",mode:(0,c.tK)(n),mtime:(0,c.Xu)(s)};return i?o.content=await t(i):r||(o.content=await t(e)),o}},32075:function(e,t,r){"use strict";r.d(t,{u:function(){return l}});var n=r(32114),s=r(77408),i=r(53597);var o=r(45764),a=r(5377),c=r(21007),h=r(20530);async function*u(e){yield e}async function l(e){if((0,h._t)(e))return u(d(e));if("string"==typeof e||e instanceof String)return u(d(e.toString()));if((0,h.Lj)(e))return"function"==typeof(t=e).stream?(0,i.Z)(t.stream()):(0,i.Z)(new Response(t).body);var t;if((0,h.Os)(e)&&(e=(0,i.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=(0,o.Z)(e),{value:r,done:n}=await t.peek();if(n)return u(new Uint8Array(0));if(t.push(r),Number.isInteger(r))return u(Uint8Array.from(await(0,a.Z)(t)));if((0,h._t)(r)||"string"==typeof r||r instanceof String)return(0,c.Z)(t,d)}throw n(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}function d(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?Uint8Array.from(e):(0,s.m)(e.toString())}},3064:function(e,t,r){"use strict";r.d(t,{f:function(){return i}});var n=r(32075),s=r(89755);function i(e){return(0,s.n)(e,n.u)}},56740:function(e,t,r){"use strict";r.d(t,{f:function(){return u}});var n=r(32075),s=r(32114),i=r(53597),o=r(45764),a=r(20530),c=r(49121);async function h(e,t){const{path:r,mode:n,mtime:s,content:i}=e,o={path:r||"",mode:(0,c.tK)(n),mtime:(0,c.Xu)(s)};return i?o.content=await t(i):r||(o.content=await t(e)),o}function u(e){return async function*(e,t){if(null==e)throw s(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");if("string"==typeof e||e instanceof String)yield h(e.toString(),t);else if((0,a._t)(e)||(0,a.Lj)(e))yield h(e,t);else{if((0,a.Os)(e)&&(e=(0,i.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const r=(0,o.Z)(e),{value:n,done:i}=await r.peek();if(i)return void(yield{content:[]});if(r.push(n),Number.isInteger(n)||(0,a._t)(n)||"string"==typeof n||n instanceof String)return void(yield h(r,t));throw s(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(!(0,a.Mk)(e))throw s(new Error('Unexpected input: cannot convert "'+typeof e+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT");yield h(e,t)}}(e,n.u)}},20530:function(e,t,r){"use strict";function n(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer}function s(e){return e.constructor&&("Blob"===e.constructor.name||"File"===e.constructor.name)&&"function"==typeof e.stream}function i(e){return"object"==typeof e&&(e.path||e.content)}r.d(t,{Lj:function(){return s},Mk:function(){return i},Os:function(){return o},_t:function(){return n}});const o=e=>e&&"function"==typeof e.getReader},51392:function(e,t,r){"use strict";r.d(t,{x:function(){return s}});const n=e=>Promise.reject(new Error(`No base found for "${e}"`));class s{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||n;for(const t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];const t=await this._loadBase(e);return null==this._basesByName[t.name]&&null==this._basesByPrefix[t.prefix]&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}}},52890:function(e,t,r){"use strict";r.d(t,{w:function(){return s}});const n=e=>Promise.reject(new Error(`No codec found for "${e}"`));class s{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||n;for(const t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){const t="string"==typeof e?this._codecsByName:this._codecsByCode;if(t[e])return t[e];const r=await this._loadCodec(e);return null==t[e]&&this.addCodec(r),r}listCodecs(){return Object.values(this._codecsByName)}}},55101:function(e,t,r){"use strict";r.d(t,{d:function(){return s}});const n=e=>Promise.reject(new Error(`No hasher found for "${e}"`));class s{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||n;for(const t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){const t="string"==typeof e?this._hashersByName:this._hashersByCode;if(t[e])return t[e];const r=await this._loadHasher(e);return null==t[e]&&this.addHasher(r),r}listHashers(){return Object.values(this._hashersByName)}}},47498:function(e,t,r){"use strict";r.d(t,{x:function(){return d}});var n=r(32114),s=r(45764),i=r(53597),o=r(5377),a=r(20530);async function c(e){if((0,a._t)(e))return new Blob([e]);if("string"==typeof e||e instanceof String)return new Blob([e.toString()]);if((0,a.Lj)(e))return e;if((0,a.Os)(e)&&(e=(0,i.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=(0,s.Z)(e),{value:r,done:n}=await t.peek();if(n)return h(t);if(t.push(r),Number.isInteger(r))return new Blob([Uint8Array.from(await(0,o.Z)(t))]);if((0,a._t)(r)||"string"==typeof r||r instanceof String)return h(t)}throw n(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}async function h(e){const t=[];for await(const r of e)t.push(r);return new Blob(t)}var u=r(89755);function l(e){if(null!=e)return"string"==typeof e?e:e.toString(8).padStart(4,"0")}async function d(e,t,r={}){const n=[],s=new FormData;let i=0,o=0;for await(const{content:t,path:r,mode:h,mtime:d}of(a=e,(0,u.n)(a,c,!0))){let e="";i>0&&(e=`-${i}`);let a=(t?"file":"dir")+e;const c=[];if(null!=h&&c.push(`mode=${l(h)}`),null!=d){const{secs:e,nsecs:t}=d;c.push(`mtime=${e}`),null!=t&&c.push(`mtime-nsecs=${t}`)}if(c.length&&(a=`${a}?${c.join("&")}`),t){s.set(a,t,null!=r?encodeURIComponent(r):void 0);const e=o+t.size;n.push({name:r,start:o,end:e}),o=e}else{if(null==r)throw new Error("path or content or both must be set");s.set(a,new File([""],encodeURIComponent(r),{type:"application/x-directory"}))}i++}var a;return{total:o,parts:n,headers:r,body:s}}},73297:function(e,t,r){"use strict";r.d(t,{f:function(){return o}});var n=r(32114),s=r(38161);function i(e){return null!=s.k0.asCID(e)}async function*o(e){if(null==e)throw n(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");const t=s.k0.asCID(e);if(t)yield a({cid:t});else{if(!(e instanceof String||"string"==typeof e)){if(null!=e.cid||null!=e.path)return yield a(e);if(r=e,Symbol.iterator in r){const t=e[Symbol.iterator](),r=t.next();if(r.done)return t;if(i(r.value)){yield a({cid:r.value});for(const e of t)yield a({cid:e});return}if(r.value instanceof String||"string"==typeof r.value){yield a({path:r.value});for(const e of t)yield a({path:e});return}if(null!=r.value.cid||null!=r.value.path){yield a(r.value);for(const e of t)yield a(e);return}throw n(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}var r;if(function(e){return Symbol.asyncIterator in e}(e)){const t=e[Symbol.asyncIterator](),r=await t.next();if(r.done)return t;if(i(r.value)){yield a({cid:r.value});for await(const e of t)yield a({cid:e});return}if(r.value instanceof String||"string"==typeof r.value){yield a({path:r.value});for await(const e of t)yield a({path:e});return}if(null!=r.value.cid||null!=r.value.path){yield a(r.value);for await(const e of t)yield a(e);return}throw n(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}throw n(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}yield a({path:e})}}function a(e){const t=e.cid||`${e.path}`;if(!t)throw n(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");const r={path:t,recursive:!1!==e.recursive};return null!=e.metadata&&(r.metadata=e.metadata),r}},41966:function(e,t,r){"use strict";r.d(t,{B:function(){return o}});var n=r(38161),s=r(32114);const i="/ipfs/";function o(e){if(e instanceof Uint8Array)try{e=n.k0.decode(e)}catch(e){throw s(e,"ERR_INVALID_CID")}let t=n.k0.asCID(e);if(t)return{cid:t,path:void 0};(e=e.toString()).startsWith(i)&&(e=e.substring(i.length));const r=e.split("/");let o;try{t=n.k0.parse(r.shift()||"")}catch(e){throw s(e,"ERR_INVALID_CID")}return r.length&&(o=`/${r.join("/")}`),{cid:t,path:o}}},63181:function(e,t,r){"use strict";r.d(t,{d:function(){return i}});var n=r(91026),s=r(45182);function i(e){try{e=(0,s.k)((0,n.HM)(e))}catch(e){}return e=e.toString()}},45847:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});var n=r(10715),s=r(32044),i=r(90072);class o extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=o.code}}function a(e,t){return(...r)=>{const a=r[null==t?r.length-1:t];if(!a||!a.timeout)return e(...r);const c="string"==typeof a.timeout?(0,i.Z)(a.timeout):a.timeout,h=new n.TimeoutController(c);a.signal=(0,s.anySignal)([a.signal,h.signal]);const u=e(...r),l=new Promise(((e,t)=>{h.signal.addEventListener("abort",(()=>{t(new o)}))})),d=Date.now(),f=()=>{if(h.signal.aborted)throw new o;if(Date.now()-d>c)throw h.abort(),new o};return u[Symbol.asyncIterator]?async function*(){const e=u[Symbol.asyncIterator]();try{for(;;){const{value:t,done:r}=await Promise.race([e.next(),l]);if(r)break;f(),yield t}}catch(e){throw f(),e}finally{h.clear(),e.return&&e.return()}}():(async()=>{try{const e=await Promise.race([u,l]);return f(),e}catch(e){throw f(),e}finally{h.clear()}})()}}o.code="ERR_TIMEOUT"}}]);
//# sourceMappingURL=393.c32e50dc.chunk.js.map