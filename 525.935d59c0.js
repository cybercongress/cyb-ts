/*! For license information please see 525.935d59c0.js.LICENSE.txt */
(self.webpackChunkcyb=self.webpackChunkcyb||[]).push([[525],{19824:function(e,t,n){"use strict";var r=n(25108);const s=-8,i=-4,o=0,a=1,c=1,u=2,l=5,h=1024,f=2048,p=8192,d=0,y=4,g=8,m=12,b=12,w=16,v="undefined"!=typeof BigUint64Array,E=Symbol(),_=1024;function k(e,t){const n=new Uint32Array(e),r=new Uint16Array(e);var s=n[t+i>>>2]>>>1,o=t>>>1;if(s<=_)return String.fromCharCode.apply(String,r.subarray(o,o+s));const a=[];do{const e=r[o+_-1],t=e>=55296&&e<56320?_-1:_;a.push(String.fromCharCode.apply(String,r.subarray(o,o+=t))),s-=t}while(s>_);return a.join("")+String.fromCharCode.apply(String,r.subarray(o,o+s))}function S(e){const t={};function n(e,t){return e?k(e.buffer,t):"<yet unknown>"}const s=e.env=e.env||{};return s.abort=s.abort||function(e,r,i,o){const a=t.memory||s.memory;throw Error("abort: "+n(a,e)+" at "+n(a,r)+":"+i+":"+o)},s.trace=s.trace||function(e,i){const o=t.memory||s.memory;r.log("trace: "+n(o,e)+(i?" ":"")+Array.prototype.slice.call(arguments,2,2+i).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function T(e,t){const n=t.exports,r=n.memory,E=n.table,_=n.__alloc,S=n.__retain,T=n.__rtti_base||-1;function A(e){const t=new Uint32Array(r.buffer);if((e>>>=0)>=t[T>>>2])throw Error("invalid id: "+e);return t[(T+4>>>2)+2*e]}function I(e){const t=new Uint32Array(r.buffer);if((e>>>=0)>=t[T>>>2])throw Error("invalid id: "+e);return t[(T+4>>>2)+2*e+1]}function x(e){return 31-Math.clz32(e>>>l&31)}function P(e,t,n){const s=r.buffer;if(n)switch(e){case 2:return new Float32Array(s);case 3:return new Float64Array(s)}else switch(e){case 0:return new(t?Int8Array:Uint8Array)(s);case 1:return new(t?Int16Array:Uint16Array)(s);case 2:return new(t?Int32Array:Uint32Array)(s);case 3:return new(t?BigInt64Array:BigUint64Array)(s)}throw Error("unsupported align: "+e)}function R(e){const t=new Uint32Array(r.buffer),n=t[e+s>>>2],o=A(n);if(!(o&c))throw Error("not an array: "+n);const a=x(o);var l=t[e+y>>>2];const p=o&u?t[e+b>>>2]:t[l+i>>>2]>>>a;return P(a,o&h,o&f).subarray(l>>>=a,l+p)}function N(e,t,n){return new e(D(e,t,n))}function D(e,t,n){const s=r.buffer,o=new Uint32Array(s),a=o[n+y>>>2];return new e(s,a,o[a+i>>>2]>>>t)}return e.__allocString=function(e){const t=e.length,n=_(t<<1,a),s=new Uint16Array(r.buffer);for(var i=0,o=n>>>1;i<t;++i)s[o+i]=e.charCodeAt(i);return n},e.__getString=function(e){const t=r.buffer;if(new Uint32Array(t)[e+s>>>2]!==a)throw Error("not a string: "+e);return k(t,e)},e.__allocArray=function(e,t){const n=A(e);if(!(n&(c|u)))throw Error("not an array: "+e+" @ "+n);const s=x(n),i=t.length,a=_(i<<s,o),l=_(n&u?w:m,e),v=new Uint32Array(r.buffer);v[l+d>>>2]=S(a),v[l+y>>>2]=a,v[l+g>>>2]=i<<s,n&u&&(v[l+b>>>2]=i);const E=P(s,n&h,n&f);if(n&p)for(let e=0;e<i;++e)E[(a>>>s)+e]=S(t[e]);else E.set(t,a>>>s);return l},e.__getArrayView=R,e.__getArray=function(e){const t=R(e),n=t.length,r=new Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r},e.__getArrayBuffer=function(e){const t=r.buffer,n=new Uint32Array(t)[e+i>>>2];return t.slice(e,e+n)},e.__getInt8Array=N.bind(null,Int8Array,0),e.__getInt8ArrayView=D.bind(null,Int8Array,0),e.__getUint8Array=N.bind(null,Uint8Array,0),e.__getUint8ArrayView=D.bind(null,Uint8Array,0),e.__getUint8ClampedArray=N.bind(null,Uint8ClampedArray,0),e.__getUint8ClampedArrayView=D.bind(null,Uint8ClampedArray,0),e.__getInt16Array=N.bind(null,Int16Array,1),e.__getInt16ArrayView=D.bind(null,Int16Array,1),e.__getUint16Array=N.bind(null,Uint16Array,1),e.__getUint16ArrayView=D.bind(null,Uint16Array,1),e.__getInt32Array=N.bind(null,Int32Array,2),e.__getInt32ArrayView=D.bind(null,Int32Array,2),e.__getUint32Array=N.bind(null,Uint32Array,2),e.__getUint32ArrayView=D.bind(null,Uint32Array,2),v&&(e.__getInt64Array=N.bind(null,BigInt64Array,3),e.__getInt64ArrayView=D.bind(null,BigInt64Array,3),e.__getUint64Array=N.bind(null,BigUint64Array,3),e.__getUint64ArrayView=D.bind(null,BigUint64Array,3)),e.__getFloat32Array=N.bind(null,Float32Array,2),e.__getFloat32ArrayView=D.bind(null,Float32Array,2),e.__getFloat64Array=N.bind(null,Float64Array,3),e.__getFloat64ArrayView=D.bind(null,Float64Array,3),e.__instanceof=function(e,t){const n=new Uint32Array(r.buffer);var i=n[e+s>>>2];if(i<=n[T>>>2])do{if(i==t)return!0}while(i=I(i));return!1},e.memory=e.memory||r,e.table=e.table||E,O(n,e)}function A(e){return"undefined"!=typeof Response&&e instanceof Response}async function I(e,t){return A(e=await e)?x(e,t):T(S(t||(t={})),await WebAssembly.instantiate(e instanceof WebAssembly.Module?e:await WebAssembly.compile(e),t))}async function x(e,t){return WebAssembly.instantiateStreaming?T(S(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance):I(A(e=await e)?e.arrayBuffer():e,t)}function O(e,t){var n=t?Object.create(t):{},r=e.__argumentsLength?function(t){e.__argumentsLength.value=t}:e.__setArgumentsLength||e.__setargc||function(){};for(let t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const s=e[t];let i=t.split("."),o=n;for(;i.length>1;){let e=i.shift();Object.prototype.hasOwnProperty.call(o,e)||(o[e]={}),o=o[e]}let a=i[0],c=a.indexOf("#");if(c>=0){let n=a.substring(0,c),i=o[n];if(void 0===i||!i.prototype){let e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={valueOf:function(){return this[E]}},e.wrap=function(t){return Object.create(e.prototype,{[E]:{value:t,writable:!1}})},i&&Object.getOwnPropertyNames(i).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t)))),o[n]=e}if(a=a.substring(c+1),o=o[n].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let n=e[t.replace("set:","get:")],r=e[t.replace("get:","set:")];Object.defineProperty(o,a,{get:function(){return n(this[E])},set:function(e){r(this[E],e)},enumerable:!0})}}else"constructor"===a?(o[a]=(...e)=>(r(e.length),s(...e))).original=s:(o[a]=function(...e){return r(e.length),s(this[E],...e)}).original=s}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:e[t.replace("set:","get:")],set:e[t.replace("get:","set:")],enumerable:!0}):"function"==typeof s&&s!==r?(o[a]=(...e)=>(r(e.length),s(...e))).original=s:o[a]=s}return n}t.instantiate=I,t.instantiateSync=function(e,t){return T(S(t||(t={})),new WebAssembly.Instance(e instanceof WebAssembly.Module?e:new WebAssembly.Module(e),t))},t.instantiateStreaming=x,t.demangle=O},19221:function(e){e.exports=function e(r,s){var i,o=0,a=0,c=s=s||0,u=r.length;do{if(c>=u||a>49)throw e.bytes=0,new RangeError("Could not decode varint");i=r[c++],o+=a<28?(i&n)<<a:(i&n)*Math.pow(2,a),a+=7}while(i>=t);return e.bytes=c-s,o};var t=128,n=127},1246:function(e){e.exports=function e(s,i,o){if(Number.MAX_SAFE_INTEGER&&s>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");i=i||[];var a=o=o||0;for(;s>=r;)i[o++]=255&s|t,s/=128;for(;s&n;)i[o++]=255&s|t,s>>>=7;return i[o]=0|s,e.bytes=o-a+1,i};var t=128,n=-128,r=Math.pow(2,31)},89003:function(e,t,n){e.exports={encode:n(1246),decode:n(19221),encodingLength:n(98641)}},98641:function(e){var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<u?9:10}},19464:function(e,t,n){"use strict";const{fromCallback:r}=n(16957),s=n(94473),{getCallback:i,getOptions:o}=n(92520),a=Symbol("promise"),c=Symbol("status"),u=Symbol("operations"),l=Symbol("finishClose"),h=Symbol("closeCallbacks");t.AbstractChainedBatch=class{constructor(e){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}this[u]=[],this[h]=[],this[c]="open",this[l]=this[l].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[u].length}put(e,t,n){if("open"!==this[c])throw new s("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(e)||this.db._checkValue(t);if(r)throw r;const i=n&&null!=n.sublevel?n.sublevel:this.db,o=n,a=i.keyEncoding(n&&n.keyEncoding),l=i.valueEncoding(n&&n.valueEncoding),h=a.format;n={...n,keyEncoding:h,valueEncoding:l.format},i!==this.db&&(n.sublevel=null);const f=i.prefixKey(a.encode(e),h),p=l.encode(t);return this._put(f,p,n),this[u].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if("open"!==this[c])throw new s("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const r=t&&null!=t.sublevel?t.sublevel:this.db,i=t,o=r.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},r!==this.db&&(t.sublevel=null),this._del(r.prefixKey(o.encode(e),a),t),this[u].push({...i,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[c])throw new s("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[u]=[],this}_clear(){}write(e,t){return t=i(e,t),t=r(t,a),e=o(e),"open"!==this[c]?this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[c]="writing",this._write(e,(e=>{this[c]="closing",this[h].push((()=>t(e))),e||this.db.emit("batch",this[u]),this._close(this[l])}))),t[a]}_write(e,t){}close(e){return e=r(e,a),"closing"===this[c]?this[h].push(e):"closed"===this[c]?this.nextTick(e):(this[h].push(e),"writing"!==this[c]&&(this[c]="closing",this._close(this[l]))),e[a]}_close(e){this.nextTick(e)}[l](){this[c]="closed",this.db.detachResource(this);const e=this[h];this[h]=[];for(const t of e)t()}}},33961:function(e,t,n){"use strict";var r=n(25108);const{fromCallback:s}=n(16957),i=n(94473),{getOptions:o,getCallback:a}=n(92520),c=Symbol("promise"),u=Symbol("callback"),l=Symbol("working"),h=Symbol("handleOne"),f=Symbol("handleMany"),p=Symbol("autoClose"),d=Symbol("finishWork"),y=Symbol("returnMany"),g=Symbol("closing"),m=Symbol("handleClose"),b=Symbol("closed"),w=Symbol("closeCallbacks"),v=Symbol("keyEncoding"),E=Symbol("valueEncoding"),_=Symbol("abortOnClose"),k=Symbol("legacy"),S=Symbol("keys"),T=Symbol("values"),A=Symbol("limit"),I=Symbol("count"),x=Object.freeze({}),O=()=>{};let P=!1;class R{constructor(e,t,n){if("object"!=typeof e||null===e){throw new TypeError(`The first argument must be an abstract-level database, received ${null===e?"null":typeof e}`)}if("object"!=typeof t||null===t)throw new TypeError("The second argument must be an options object");this[b]=!1,this[w]=[],this[l]=!1,this[g]=!1,this[p]=!1,this[u]=null,this[h]=this[h].bind(this),this[f]=this[f].bind(this),this[m]=this[m].bind(this),this[v]=t[v],this[E]=t[E],this[k]=n,this[A]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[I]=0,this[_]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[I]}get limit(){return this[A]}next(e){let t;if(void 0===e)t=new Promise(((t,n)=>{e=(e,r,s)=>{e?n(e):this[k]?void 0===r&&void 0===s?t():t([r,s]):t(r)}}));else if("function"!=typeof e)throw new TypeError("Callback must be a function");return this[g]?this.nextTick(e,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(e,new i("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[l]=!0,this[u]=e,this[I]>=this[A]?this.nextTick(this[h],null):this._next(this[h])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=a(t,n),n=s(n,c),t=o(t,x),Number.isInteger(e)?(this[g]?this.nextTick(n,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(n,new i("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[A]<1/0&&(e=Math.min(e,this[A]-this[I])),this[l]=!0,this[u]=n,e<=0?this.nextTick(this[f],null,[]):this._nextv(e,t,this[f])),n[c]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[c])}_nextv(e,t,n){const r=[],s=(t,i,o)=>t?n(t):(this[k]?void 0===i&&void 0===o:void 0===i)?n(null,r):(r.push(this[k]?[i,o]:i),void(r.length===e?n(null,r):this._next(s)));this._next(s)}all(e,t){return t=a(e,t),t=s(t,c),e=o(e,x),this[g]?this.nextTick(t,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(t,new i("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[l]=!0,this[u]=t,this[p]=!0,this[I]>=this[A]?this.nextTick(this[f],null,[]):this._all(e,this[f])),t[c]}_all(e,t){let n=this[I];const r=[],s=()=>{const e=this[A]<1/0?Math.min(1e3,this[A]-n):1e3;e<=0?this.nextTick(t,null,r):this._nextv(e,x,i)},i=(e,i)=>{e?t(e):0===i.length?t(null,r):(r.push.apply(r,i),n+=i.length,s())};s()}[d](){const e=this[u];return this[_]&&null===e?O:(this[l]=!1,this[u]=null,this[g]&&this._close(this[m]),e)}[y](e,t,n){this[p]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=o(t,x),this[g]);else{if(this[l])throw new i("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[v]),r=n.format;t.keyEncoding!==r&&(t={...t,keyEncoding:r});const s=this.db.prefixKey(n.encode(e),r);this._seek(s,t)}}}_seek(e,t){throw new i("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){if(e=s(e,c),this[b])this.nextTick(e);else if(this[g])this[w].push(e);else if(this[g]=!0,this[w].push(e),this[l]){if(this[_]){this[d]()(new i("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))}}else this._close(this[m]);return e[c]}_close(e){this.nextTick(e)}[m](){this[b]=!0,this.db.detachResource(this);const e=this[w];this[w]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[b]||await this.close()}}}class N extends R{constructor(e,t){super(e,t,!0),this[S]=!1!==t.keys,this[T]=!1!==t.values}[h](e,t,n){const r=this[d]();if(e)return r(e);try{t=this[S]&&void 0!==t?this[v].decode(t):void 0,n=this[T]&&void 0!==n?this[E].decode(n):void 0}catch(e){return r(new D("entry",e))}void 0===t&&void 0===n||this[I]++,r(null,t,n)}[f](e,t){const n=this[d]();if(e)return this[y](n,e);try{for(const e of t){const t=e[0],n=e[1];e[0]=this[S]&&void 0!==t?this[v].decode(t):void 0,e[1]=this[T]&&void 0!==n?this[E].decode(n):void 0}}catch(e){return this[y](n,new D("entries",e))}this[I]+=t.length,this[y](n,null,t)}end(e){return P||void 0===r||(P=!0,r.warn(new i("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class D extends i{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const e of["_ended property","_nexting property","_end method"])Object.defineProperty(N.prototype,e.split(" ")[0],{get(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new i(`The ${e} has been removed`,{code:"LEVEL_LEGACY"})}});N.keyEncoding=v,N.valueEncoding=E,t.AbstractIterator=N,t.AbstractKeyIterator=class extends R{constructor(e,t){super(e,t,!1)}[h](e,t){const n=this[d]();if(e)return n(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return n(new D("key",e))}void 0!==t&&this[I]++,n(null,t)}[f](e,t){const n=this[d]();if(e)return this[y](n,e);try{for(let e=0;e<t.length;e++){const n=t[e];t[e]=void 0!==n?this[v].decode(n):void 0}}catch(e){return this[y](n,new D("keys",e))}this[I]+=t.length,this[y](n,null,t)}},t.AbstractValueIterator=class extends R{constructor(e,t){super(e,t,!1)}[h](e,t){const n=this[d]();if(e)return n(e);try{t=void 0!==t?this[E].decode(t):void 0}catch(e){return n(new D("value",e))}void 0!==t&&this[I]++,n(null,t)}[f](e,t){const n=this[d]();if(e)return this[y](n,e);try{for(let e=0;e<t.length;e++){const n=t[e];t[e]=void 0!==n?this[E].decode(n):void 0}}catch(e){return this[y](n,new D("values",e))}this[I]+=t.length,this[y](n,null,t)}}},69071:function(e,t,n){"use strict";const{supports:r}=n(51675),{Transcoder:s}=n(58499),{EventEmitter:i}=n(17187),{fromCallback:o}=n(16957),a=n(94473),{AbstractIterator:c}=n(33961),{DefaultKeyIterator:u,DefaultValueIterator:l}=n(95429),{DeferredIterator:h,DeferredKeyIterator:f,DeferredValueIterator:p}=n(30593),{DefaultChainedBatch:d}=n(4765),{getCallback:y,getOptions:g}=n(92520),m=n(70056),b=Symbol("promise"),w=Symbol("landed"),v=Symbol("resources"),E=Symbol("closeResources"),_=Symbol("operations"),k=Symbol("undefer"),S=Symbol("deferOpen"),T=Symbol("options"),A=Symbol("status"),I=Symbol("defaultOptions"),x=Symbol("transcoder"),O=Symbol("keyEncoding"),P=Symbol("valueEncoding"),R=()=>{};class N extends i{constructor(e,t){if(super(),"object"!=typeof e||null===e)throw new TypeError("The first argument 'manifest' must be an object");t=g(t);const{keyEncoding:n,valueEncoding:i,passive:o,...a}=t;this[v]=new Set,this[_]=[],this[S]=!0,this[T]=a,this[A]="opening",this.supports=r(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[x]=new s(L(this)),this[O]=this[x].encoding(n||"utf8"),this[P]=this[x].encoding(i||"utf8");for(const e of this[x].encodings())this.supports.encodings[e.commonName]||(this.supports.encodings[e.commonName]=!0);this[I]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[O].commonName,valueEncoding:this[P].commonName}),key:Object.freeze({keyEncoding:this[O].commonName})},this.nextTick((()=>{this[S]&&this.open({passive:!1},R)}))}get status(){return this[A]}keyEncoding(e){return this[x].encoding(null!=e?e:this[O])}valueEncoding(e){return this[x].encoding(null!=e?e:this[P])}open(e,t){t=y(e,t),t=o(t,b),(e={...this[T],...g(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;const n=e=>{"closing"===this[A]||"opening"===this[A]?this.once(w,e?()=>n(e):n):"open"!==this[A]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[A]?this.once(w,n):this.nextTick(n):"closed"===this[A]||this[S]?(this[S]=!1,this[A]="opening",this.emit("opening"),this._open(e,(e=>{if(e)return this[A]="closed",this[E]((()=>{this.emit(w),n(e)})),void this[k]();this[A]="open",this[k](),this.emit(w),"open"===this[A]&&this.emit("open"),"open"===this[A]&&this.emit("ready"),n()}))):"open"===this[A]?this.nextTick(n):this.once(w,(()=>this.open(e,t))),t[b]}_open(e,t){this.nextTick(t)}close(e){e=o(e,b);const t=n=>{"opening"===this[A]||"closing"===this[A]?this.once(w,n?t(n):t):"closed"!==this[A]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if("open"===this[A]){this[A]="closing",this.emit("closing");const e=e=>{this[A]="open",this[k](),this.emit(w),t(e)};this[E]((()=>{this._close((n=>{if(n)return e(n);this[A]="closed",this[k](),this.emit(w),"closed"===this[A]&&this.emit("closed"),t()}))}))}else"closed"===this[A]?this.nextTick(t):this.once(w,(()=>this.close(e)));return e[b]}[E](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,n=!0;const r=()=>{0==--t&&(n?this.nextTick(e):e())};for(const e of this[v])e.close(r);n=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=y(t,n),n=o(n,b),t=g(t,this[I].entry),"opening"===this[A])return this.defer((()=>this.get(e,t,n))),n[b];if(C(this,n))return n[b];const r=this._checkKey(e);if(r)return this.nextTick(n,r),n[b];const s=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),c=s.format,u=i.format;return t.keyEncoding===c&&t.valueEncoding===u||(t=Object.assign({},t,{keyEncoding:c,valueEncoding:u})),this._get(this.prefixKey(s.encode(e),c),t,((e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),n(e);try{t=i.decode(t)}catch(e){return n(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}n(null,t)})),n[b]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=y(t,n),n=o(n,b),t=g(t,this[I].entry),"opening"===this[A])return this.defer((()=>this.getMany(e,t,n))),n[b];if(C(this,n))return n[b];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[b];if(0===e.length)return this.nextTick(n,null,[]),n[b];const r=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),i=r.format,c=s.format;t.keyEncoding===i&&t.valueEncoding===c||(t=Object.assign({},t,{keyEncoding:i,valueEncoding:c}));const u=new Array(e.length);for(let t=0;t<e.length;t++){const s=e[t],o=this._checkKey(s);if(o)return this.nextTick(n,o),n[b];u[t]=this.prefixKey(r.encode(s),i)}return this._getMany(u,t,((e,t)=>{if(e)return n(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=s.decode(t[e]))}catch(e){return n(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}n(null,t)})),n[b]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,r){if(r=y(n,r),r=o(r,b),n=g(n,this[I].entry),"opening"===this[A])return this.defer((()=>this.put(e,t,n,r))),r[b];if(C(this,r))return r[b];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(r,s),r[b];const i=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=i.format,u=a.format;n.keyEncoding===c&&n.valueEncoding===u||(n=Object.assign({},n,{keyEncoding:c,valueEncoding:u}));const l=this.prefixKey(i.encode(e),c),h=a.encode(t);return this._put(l,h,n,(n=>{if(n)return r(n);this.emit("put",e,t),r()})),r[b]}_put(e,t,n,r){this.nextTick(r)}del(e,t,n){if(n=y(t,n),n=o(n,b),t=g(t,this[I].key),"opening"===this[A])return this.defer((()=>this.del(e,t,n))),n[b];if(C(this,n))return n[b];const r=this._checkKey(e);if(r)return this.nextTick(n,r),n[b];const s=this.keyEncoding(t.keyEncoding),i=s.format;return t.keyEncoding!==i&&(t=Object.assign({},t,{keyEncoding:i})),this._del(this.prefixKey(s.encode(e),i),t,(t=>{if(t)return n(t);this.emit("del",e),n()})),n[b]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if("opening"===this[A])return new d(this);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(n="function"==typeof e?e:y(t,n),n=o(n,b),t=g(t,this[I].empty),"opening"===this[A])return this.defer((()=>this.batch(e,t,n))),n[b];if(C(this,n))return n[b];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[b];if(0===e.length)return this.nextTick(n),n[b];const r=new Array(e.length),{keyEncoding:s,valueEncoding:i,...c}=t;for(let t=0;t<e.length;t++){if("object"!=typeof e[t]||null===e[t])return this.nextTick(n,new TypeError("A batch operation must be an object")),n[b];const o=Object.assign({},e[t]);if("put"!==o.type&&"del"!==o.type)return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[b];const a=this._checkKey(o.key);if(a)return this.nextTick(n,a),n[b];const c=null!=o.sublevel?o.sublevel:this,u=c.keyEncoding(o.keyEncoding||s),l=u.format;if(o.key=c.prefixKey(u.encode(o.key),l),o.keyEncoding=l,"put"===o.type){const e=this._checkValue(o.value);if(e)return this.nextTick(n,e),n[b];const t=c.valueEncoding(o.valueEncoding||i);o.value=t.encode(o.value),o.valueEncoding=t.format}c!==this&&(o.sublevel=null),r[t]=o}return this._batch(r,c,(t=>{if(t)return n(t);this.emit("batch",e),n()})),n[b]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,D.defaults(t))}_sublevel(e,t){return new D(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=y(e,t),t=o(t,b),e=g(e,this[I].empty),"opening"===this[A])return this.defer((()=>this.clear(e,t))),t[b];if(C(this,t))return t[b];const n=e,r=this.keyEncoding(e.keyEncoding);return(e=m(e,r)).keyEncoding=r.format,0===e.limit?this.nextTick(t):this._clear(e,(e=>{if(e)return t(e);this.emit("clear",n),t()})),t[b]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[c.keyEncoding]=t,e[c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[A])return new h(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new c(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[A])return new f(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new u(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if((e=m(e,t))[c.keyEncoding]=t,e[c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[A])return new p(this,e);if("open"!==this[A])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new l(this,e)}defer(e){if("function"!=typeof e)throw new TypeError("The first argument must be a function");this[_].push(e)}[k](){if(0===this[_].length)return;const e=this[_];this[_]=[];for(const t of e)t()}attachResource(e){if("object"!=typeof e||null===e||"function"!=typeof e.close)throw new TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new d(this)}_checkKey(e){if(null==e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null==e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}N.prototype.nextTick=n(56909);const{AbstractSublevel:D}=n(59650)({AbstractLevel:N});t.AbstractLevel=N,t.AbstractSublevel=D;const C=function(e,t){return"open"!==e[A]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},L=function(e){return Object.keys(e.supports.encodings).filter((t=>!!e.supports.encodings[t]))}},50875:function(e,t,n){"use strict";t.AbstractLevel=n(69071).AbstractLevel,t.AbstractSublevel=n(69071).AbstractSublevel,t.AbstractIterator=n(33961).AbstractIterator,t.AbstractKeyIterator=n(33961).AbstractKeyIterator,t.AbstractValueIterator=n(33961).AbstractValueIterator,t.AbstractChainedBatch=n(19464).AbstractChainedBatch},82970:function(e,t,n){"use strict";const{AbstractIterator:r,AbstractKeyIterator:s,AbstractValueIterator:i}=n(33961),o=Symbol("unfix"),a=Symbol("iterator"),c=Symbol("handleOne"),u=Symbol("handleMany"),l=Symbol("callback");class h extends r{constructor(e,t,n,r){super(e,t),this[a]=n,this[o]=r,this[c]=this[c].bind(this),this[u]=this[u].bind(this),this[l]=null}[c](e,t,n){const r=this[l];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t,n)}[u](e,t){const n=this[l];if(e)return n(e);for(const e of t){const t=e[0];void 0!==t&&(e[0]=this[o](t))}n(e,t)}}class f extends s{constructor(e,t,n,r){super(e,t),this[a]=n,this[o]=r,this[c]=this[c].bind(this),this[u]=this[u].bind(this),this[l]=null}[c](e,t){const n=this[l];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t)}[u](e,t){const n=this[l];if(e)return n(e);for(let e=0;e<t.length;e++){const n=t[e];void 0!==n&&(t[e]=this[o](n))}n(e,t)}}class p extends i{constructor(e,t,n){super(e,t),this[a]=n}}for(const e of[h,f])e.prototype._next=function(e){this[l]=e,this[a].next(this[c])},e.prototype._nextv=function(e,t,n){this[l]=n,this[a].nextv(e,t,this[u])},e.prototype._all=function(e,t){this[l]=t,this[a].all(e,this[u])};for(const e of[p])e.prototype._next=function(e){this[a].next(e)},e.prototype._nextv=function(e,t,n){this[a].nextv(e,t,n)},e.prototype._all=function(e,t){this[a].all(e,t)};for(const e of[h,f,p])e.prototype._seek=function(e,t){this[a].seek(e,t)},e.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=h,t.AbstractSublevelKeyIterator=f,t.AbstractSublevelValueIterator=p},59650:function(e,t,n){"use strict";const r=n(94473),{Buffer:s}=n(96451)||{},{AbstractSublevelIterator:i,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=n(82970),c=Symbol("prefix"),u=Symbol("upperBound"),l=Symbol("prefixRange"),h=Symbol("parent"),f=Symbol("unfix"),p=new TextEncoder,d={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"==typeof e)throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?d:e.separator?e:{...e,separator:"!"}}constructor(e,n,s){const{separator:i,manifest:o,...a}=t.defaults(s);n=w(n,i);const l=i.charCodeAt(0)+1,d=e[h]||e;if(!p.encode(n).every((e=>e>l&&e<127)))throw new r(`Prefix must use bytes > ${l} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(y(d,o),a);const g=(e.prefix||"")+i+n+i,v=g.slice(0,-1)+String.fromCharCode(l);this[h]=d,this[c]=new m(g),this[u]=new m(v),this[f]=new b,this.nextTick=d.nextTick}prefixKey(e,t){if("utf8"===t)return this[c].utf8+e;if(0===e.byteLength)return this[c][t];if("view"===t){const t=this[c].view,n=new Uint8Array(t.byteLength+e.byteLength);return n.set(t,0),n.set(e,t.byteLength),n}{const t=this[c].buffer;return s.concat([t,e],t.byteLength+e.byteLength)}}[l](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[c][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[u][t]}get prefix(){return this[c].utf8}get db(){return this[h]}_open(e,t){this[h].open({passive:!0},t)}_put(e,t,n,r){this[h].put(e,t,n,r)}_get(e,t,n){this[h].get(e,t,n)}_getMany(e,t,n){this[h].getMany(e,t,n)}_del(e,t,n){this[h].del(e,t,n)}_batch(e,t,n){this[h].batch(e,t,n)}_clear(e,t){this[l](e,e.keyEncoding),this[h].clear(e,t)}_iterator(e){this[l](e,e.keyEncoding);const t=this[h].iterator(e),n=this[f].get(this[c].utf8.length,e.keyEncoding);return new i(this,e,t,n)}_keys(e){this[l](e,e.keyEncoding);const t=this[h].keys(e),n=this[f].get(this[c].utf8.length,e.keyEncoding);return new o(this,e,t,n)}_values(e){this[l](e,e.keyEncoding);const t=this[h].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};const y=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:g(e,"utf8"),buffer:g(e,"buffer"),view:g(e,"view")}}},g=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class m{constructor(e){this.utf8=e,this.view=p.encode(e),this.buffer=s?s.from(this.view.buffer,0,this.view.byteLength):{}}}class b{constructor(){this.cache=new Map}get(e,t){let n=this.cache.get(t);return void 0===n&&(n="view"===t?function(e,t){return t.subarray(e)}.bind(null,e):function(e,t){return t.slice(e)}.bind(null,e),this.cache.set(t,n)),n}}const w=function(e,t){let n=0,r=e.length;for(;n<r&&e[n]===t;)n++;for(;r>n&&e[r-1]===t;)r--;return e.slice(n,r)}},92520:function(e,t){"use strict";t.getCallback=function(e,t){return"function"==typeof e?e:t},t.getOptions=function(e,t){return"object"==typeof e&&null!==e?e:void 0!==t?t:{}}},4765:function(e,t,n){"use strict";const{AbstractChainedBatch:r}=n(19464),s=n(94473),i=Symbol("encoded");t.DefaultChainedBatch=class extends r{constructor(e){super(e),this[i]=[]}_put(e,t,n){this[i].push({...n,type:"put",key:e,value:t})}_del(e,t){this[i].push({...t,type:"del",key:e})}_clear(){this[i]=[]}_write(e,t){"opening"===this.db.status?this.db.defer((()=>this._write(e,t))):"open"===this.db.status?0===this[i].length?this.nextTick(t):this.db._batch(this[i],e,t):this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}},95429:function(e,t,n){"use strict";const{AbstractKeyIterator:r,AbstractValueIterator:s}=n(33961),i=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),c=Symbol("handleMany");class u extends r{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}class l extends s{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}for(const e of[u,l]){const t=e===u,n=t?e=>e[0]:e=>e[1];e.prototype._next=function(e){this[o]=e,this[i].next(this[a])},e.prototype[a]=function(e,n,r){const s=this[o];e?s(e):s(null,t?n:r)},e.prototype._nextv=function(e,t,n){this[o]=n,this[i].nextv(e,t,this[c])},e.prototype._all=function(e,t){this[o]=t,this[i].all(e,this[c])},e.prototype[c]=function(e,t){const r=this[o];e?r(e):r(null,t.map(n))},e.prototype._seek=function(e,t){this[i].seek(e,t)},e.prototype._close=function(e){this[i].close(e)}}t.DefaultKeyIterator=u,t.DefaultValueIterator=l},30593:function(e,t,n){"use strict";const{AbstractIterator:r,AbstractKeyIterator:s,AbstractValueIterator:i}=n(33961),o=n(94473),a=Symbol("nut"),c=Symbol("undefer"),u=Symbol("factory");class l extends r{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.iterator(t),this.db.defer((()=>this[c]()))}}class h extends s{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.keys(t),this.db.defer((()=>this[c]()))}}class f extends i{constructor(e,t){super(e,t),this[a]=null,this[u]=()=>e.values(t),this.db.defer((()=>this[c]()))}}for(const e of[l,h,f])e.prototype[c]=function(){"open"===this.db.status&&(this[a]=this[u]())},e.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer((()=>this._next(e))):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._nextv=function(e,t,n){null!==this[a]?this[a].nextv(e,t,n):"opening"===this.db.status?this.db.defer((()=>this._nextv(e,t,n))):this.nextTick(n,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer((()=>this._all(e,t))):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},e.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer((()=>this._seek(e,t)))},e.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer((()=>this._close(e))):this.nextTick(e)};t.DeferredIterator=l,t.DeferredKeyIterator=h,t.DeferredValueIterator=f},56909:function(e,t,n){"use strict";const r=n(54375);e.exports=function(e,...t){0===t.length?r(e):r((()=>e(...t)))}},70056:function(e,t,n){"use strict";const r=n(94473),s=Object.prototype.hasOwnProperty,i=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){const n={};for(const o in e)if(s.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new r(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new r("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});i.has(o)?n[o]=t.encode(e[o]):n[o]=e[o]}return n.reverse=!!n.reverse,n.limit=Number.isInteger(n.limit)&&n.limit>=0?n.limit:-1,n}},96451:function(e,t,n){"use strict";var r=n(25108);const s=n(79742),i=n(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50;const a=2147483647;function c(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|g(e,t);let r=c(n);const s=r.write(e,t);s!==n&&(r=r.slice(0,s));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Z(e,Uint8Array)){const t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Z(e,ArrayBuffer)||e&&Z(e.buffer,ArrayBuffer))return d(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(Z(e,SharedArrayBuffer)||e&&Z(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return u.from(r,t,n);const s=function(e){if(u.isBuffer(e)){const t=0|y(e.length),n=c(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||Y(e.length)?c(0):p(e);if("Buffer"===e.type&&Array.isArray(e.data))return p(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return h(e),c(e<0?0:0|y(e))}function p(e){const t=e.length<0?0:0|y(e.length),n=c(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function d(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,u.prototype),r}function y(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function g(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let s=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(s)return r?-1:W(e).length;t=(""+t).toLowerCase(),s=!0}}function m(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return P(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function b(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function w(e,t,n,r,s){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=s?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(s)return-1;n=e.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,s);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,s){let i,o=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){let r=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===r?0:i-r)){if(-1===r&&(r=i),i-r+1===c)return r*o}else-1!==r&&(i-=i-r),r=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){let n=!0;for(let r=0;r<c;r++)if(u(e,i+r)!==u(t,r)){n=!1;break}if(n)return i}return-1}function E(e,t,n,r){n=Number(n)||0;const s=e.length-n;r?(r=Number(r))>s&&(r=s):r=s;const i=t.length;let o;for(r>i/2&&(r=i/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(Y(r))return o;e[n+o]=r}return o}function _(e,t,n,r){return J(W(t,e.length-n),e,n,r)}function k(e,t,n,r){return J(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return J(G(t),e,n,r)}function T(e,t,n,r){return J(function(e,t){let n,r,s;const i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,s=n%256,i.push(s),i.push(r);return i}(t,e.length-n),e,n,r)}function A(e,t,n){return 0===t&&n===e.length?s.fromByteArray(e):s.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);const r=[];let s=t;for(;s<n;){const t=e[s];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(s+o<=n){let n,r,a,c;switch(o){case 1:t<128&&(i=t);break;case 2:n=e[s+1],128==(192&n)&&(c=(31&t)<<6|63&n,c>127&&(i=c));break;case 3:n=e[s+1],r=e[s+2],128==(192&n)&&128==(192&r)&&(c=(15&t)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:n=e[s+1],r=e[s+2],a=e[s+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(c=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),s+=o}return function(e){const t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=x));return n}(r)}t.kMaxLength=a,u.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||void 0===r||"function"!=typeof r.error||r.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return h(e),e<=0?c(e):void 0!==t?"string"==typeof n?c(e).fill(t,n):c(e).fill(t):c(e)}(e,t,n)},u.allocUnsafe=function(e){return f(e)},u.allocUnsafeSlow=function(e){return f(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(Z(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),Z(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let s=0,i=Math.min(n,r);s<i;++s)if(e[s]!==t[s]){n=e[s],r=t[s];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=u.allocUnsafe(t);let s=0;for(n=0;n<e.length;++n){let t=e[n];if(Z(t,Uint8Array))s+t.length>r.length?(u.isBuffer(t)||(t=u.from(t)),t.copy(r,s)):Uint8Array.prototype.set.call(r,t,s);else{if(!u.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,s)}s+=t.length}return r},u.byteLength=g,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)b(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,n,r,s){if(Z(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),t<0||n>e.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&t>=n)return 0;if(r>=s)return-1;if(t>=n)return 1;if(this===e)return 0;let i=(s>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0);const a=Math.min(i,o),c=this.slice(r,s),l=e.slice(t,n);for(let e=0;e<a;++e)if(c[e]!==l[e]){i=c[e],o=l[e];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return w(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return w(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const s=this.length-t;if((void 0===n||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let i=!1;for(;;)switch(r){case"hex":return E(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":case"latin1":case"binary":return k(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const x=4096;function O(e,t,n){let r="";n=Math.min(e.length,n);for(let s=t;s<n;++s)r+=String.fromCharCode(127&e[s]);return r}function P(e,t,n){let r="";n=Math.min(e.length,n);for(let s=t;s<n;++s)r+=String.fromCharCode(e[s]);return r}function R(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let s="";for(let r=t;r<n;++r)s+=X[e[r]];return s}function N(e,t,n){const r=e.slice(t,n);let s="";for(let e=0;e<r.length-1;e+=2)s+=String.fromCharCode(r[e]+256*r[e+1]);return s}function D(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,n,r,s,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r,s){H(t,r,s,e,n,7);let i=Number(t&BigInt(4294967295));e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function B(e,t,n,r,s){H(t,r,s,e,n,7);let i=Number(t&BigInt(4294967295));e[n+7]=i,i>>=8,e[n+6]=i,i>>=8,e[n+5]=i,i>>=8,e[n+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function M(e,t,n,r,s,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,s){return t=+t,n>>>=0,s||M(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function z(e,t,n,r,s){return t=+t,n>>>=0,s||M(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,u.prototype),r},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e],s=1,i=0;for(;++i<t&&(s*=256);)r+=this[e+i]*s;return r},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e+--t],s=1;for(;t>0&&(s*=256);)r+=this[e+--t]*s;return r},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=Q((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,s=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(s)<<BigInt(32))})),u.prototype.readBigUInt64BE=Q((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],s=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(s)})),u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e],s=1,i=0;for(;++i<t&&(s*=256);)r+=this[e+i]*s;return s*=128,r>=s&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=t,s=1,i=this[e+--r];for(;r>0&&(s*=256);)i+=this[e+--r]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||D(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||D(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=Q((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),u.prototype.readBigInt64BE=Q((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||K(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||D(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||D(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||D(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||D(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){C(this,e,t,n,Math.pow(2,8*n)-1,0)}let s=1,i=0;for(this[t]=255&e;++i<n&&(s*=256);)this[t+i]=e/s&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){C(this,e,t,n,Math.pow(2,8*n)-1,0)}let s=n-1,i=1;for(this[t+s]=255&e;--s>=0&&(i*=256);)this[t+s]=e/i&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=Q((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=Q((function(e,t=0){return B(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);C(this,e,t,n,r-1,-r)}let s=0,i=1,o=0;for(this[t]=255&e;++s<n&&(i*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);C(this,e,t,n,r-1,-r)}let s=n-1,i=1,o=0;for(this[t+s]=255&e;--s>=0&&(i*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=Q((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=Q((function(e,t=0){return B(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return z(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return z(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const s=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),s},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{const i=u.isBuffer(e)?e:u.from(e,r),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=i[s%o]}return this};const U={};function F(e,t,n){U[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function $(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function H(e,t,n,r,s,i){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let s;throw s=i>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(i+1)}${r}`:`>= -(2${r} ** ${8*(i+1)-1}${r}) and < 2 ** ${8*(i+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new U.ERR_OUT_OF_RANGE("value",s,e)}!function(e,t,n){V(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||K(t,e.length-(n+1))}(r,s,i)}function V(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function K(e,t,n){if(Math.floor(e)!==e)throw V(e,n),new U.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}F("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),F("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),F("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,s=n;return Number.isInteger(n)&&Math.abs(n)>2**32?s=$(String(n)):"bigint"==typeof n&&(s=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(s=$(s)),s+="n"),r+=` It must be ${t}. Received ${s}`,r}),RangeError);const q=/[^+/0-9A-Za-z-_]/g;function W(e,t){let n;t=t||1/0;const r=e.length;let s=null;const i=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!s){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}s=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function G(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function J(e,t,n,r){let s;for(s=0;s<r&&!(s+n>=t.length||s>=e.length);++s)t[s+n]=e[s];return s}function Z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const X=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let s=0;s<16;++s)t[r+s]=e[n]+e[s]}return t}();function Q(e){return"undefined"==typeof BigInt?ee:e}function ee(){throw new Error("BigInt not supported")}},32044:function(e){function t(e){const t=new globalThis.AbortController;function n(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",n)}for(const t of e)if(t&&t.addEventListener){if(t.aborted){n();break}t.addEventListener("abort",n)}return t.signal}e.exports=t,e.exports.anySignal=t},69282:function(e,t,n){"use strict";var r=n(34155),s=n(25108);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var o,a,c=n(62136).codes,u=c.ERR_AMBIGUOUS_ARGUMENT,l=c.ERR_INVALID_ARG_TYPE,h=c.ERR_INVALID_ARG_VALUE,f=c.ERR_INVALID_RETURN_VALUE,p=c.ERR_MISSING_ARGS,d=n(25961),y=n(89539).inspect,g=n(89539).types,m=g.isPromise,b=g.isRegExp,w=Object.assign?Object.assign:n(8091).assign,v=Object.is?Object.is:n(20609);new Map;function E(){var e=n(19158);o=e.isDeepEqual,a=e.isDeepStrictEqual}var _=!1,k=e.exports=I,S={};function T(e){if(e.message instanceof Error)throw e.message;throw new d(e)}function A(e,t,n,r){if(!n){var s=!1;if(0===t)s=!0,r="No value argument passed to `assert.ok()`";else if(r instanceof Error)throw r;var i=new d({actual:n,expected:!0,message:r,operator:"==",stackStartFn:e});throw i.generatedMessage=s,i}}function I(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];A.apply(void 0,[I,t.length].concat(t))}k.fail=function e(t,n,i,o,a){var c,u=arguments.length;if(0===u)c="Failed";else if(1===u)i=t,t=void 0;else{if(!1===_)_=!0,(r.emitWarning?r.emitWarning:s.warn.bind(s))("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094");2===u&&(o="!=")}if(i instanceof Error)throw i;var l={actual:t,expected:n,operator:void 0===o?"fail":o,stackStartFn:a||e};void 0!==i&&(l.message=i);var h=new d(l);throw c&&(h.message=c,h.generatedMessage=!0),h},k.AssertionError=d,k.ok=I,k.equal=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");t!=n&&T({actual:t,expected:n,message:r,operator:"==",stackStartFn:e})},k.notEqual=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");t==n&&T({actual:t,expected:n,message:r,operator:"!=",stackStartFn:e})},k.deepEqual=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");void 0===o&&E(),o(t,n)||T({actual:t,expected:n,message:r,operator:"deepEqual",stackStartFn:e})},k.notDeepEqual=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");void 0===o&&E(),o(t,n)&&T({actual:t,expected:n,message:r,operator:"notDeepEqual",stackStartFn:e})},k.deepStrictEqual=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");void 0===o&&E(),a(t,n)||T({actual:t,expected:n,message:r,operator:"deepStrictEqual",stackStartFn:e})},k.notDeepStrictEqual=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");void 0===o&&E();a(t,n)&&T({actual:t,expected:n,message:r,operator:"notDeepStrictEqual",stackStartFn:e})},k.strictEqual=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");v(t,n)||T({actual:t,expected:n,message:r,operator:"strictEqual",stackStartFn:e})},k.notStrictEqual=function e(t,n,r){if(arguments.length<2)throw new p("actual","expected");v(t,n)&&T({actual:t,expected:n,message:r,operator:"notStrictEqual",stackStartFn:e})};var x=function e(t,n,r){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.forEach((function(e){e in t&&(void 0!==r&&"string"==typeof r[e]&&b(t[e])&&t[e].test(r[e])?s[e]=r[e]:s[e]=t[e])}))};function O(e,t,n,r){if("function"!=typeof t){if(b(t))return t.test(e);if(2===arguments.length)throw new l("expected",["Function","RegExp"],t);if("object"!==i(e)||null===e){var s=new d({actual:e,expected:t,message:n,operator:"deepStrictEqual",stackStartFn:r});throw s.operator=r.name,s}var c=Object.keys(t);if(t instanceof Error)c.push("name","message");else if(0===c.length)throw new h("error",t,"may not be an empty object");return void 0===o&&E(),c.forEach((function(s){"string"==typeof e[s]&&b(t[s])&&t[s].test(e[s])||function(e,t,n,r,s,i){if(!(n in e)||!a(e[n],t[n])){if(!r){var o=new x(e,s),c=new x(t,s,e),u=new d({actual:o,expected:c,operator:"deepStrictEqual",stackStartFn:i});throw u.actual=e,u.expected=t,u.operator=i.name,u}T({actual:e,expected:t,message:r,operator:i.name,stackStartFn:i})}}(e,t,s,n,c,r)})),!0}return void 0!==t.prototype&&e instanceof t||!Error.isPrototypeOf(t)&&!0===t.call({},e)}function P(e){if("function"!=typeof e)throw new l("fn","Function",e);try{e()}catch(e){return e}return S}function R(e){return m(e)||null!==e&&"object"===i(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function N(e){return Promise.resolve().then((function(){var t;if("function"==typeof e){if(!R(t=e()))throw new f("instance of Promise","promiseFn",t)}else{if(!R(e))throw new l("promiseFn",["Function","Promise"],e);t=e}return Promise.resolve().then((function(){return t})).then((function(){return S})).catch((function(e){return e}))}))}function D(e,t,n,r){if("string"==typeof n){if(4===arguments.length)throw new l("error",["Object","Error","Function","RegExp"],n);if("object"===i(t)&&null!==t){if(t.message===n)throw new u("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===n)throw new u("error/message",'The error "'.concat(t,'" is identical to the message.'));r=n,n=void 0}else if(null!=n&&"object"!==i(n)&&"function"!=typeof n)throw new l("error",["Object","Error","Function","RegExp"],n);if(t===S){var s="";n&&n.name&&(s+=" (".concat(n.name,")")),s+=r?": ".concat(r):".";var o="rejects"===e.name?"rejection":"exception";T({actual:void 0,expected:n,operator:e.name,message:"Missing expected ".concat(o).concat(s),stackStartFn:e})}if(n&&!O(t,n,r,e))throw t}function C(e,t,n,r){if(t!==S){if("string"==typeof n&&(r=n,n=void 0),!n||O(t,n)){var s=r?": ".concat(r):".",i="doesNotReject"===e.name?"rejection":"exception";T({actual:t,expected:n,operator:e.name,message:"Got unwanted ".concat(i).concat(s,"\n")+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}function L(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];A.apply(void 0,[L,t.length].concat(t))}k.throws=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];D.apply(void 0,[e,P(t)].concat(r))},k.rejects=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return N(t).then((function(t){return D.apply(void 0,[e,t].concat(r))}))},k.doesNotThrow=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];C.apply(void 0,[e,P(t)].concat(r))},k.doesNotReject=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return N(t).then((function(t){return C.apply(void 0,[e,t].concat(r))}))},k.ifError=function e(t){if(null!=t){var n="ifError got unwanted exception: ";"object"===i(t)&&"string"==typeof t.message?0===t.message.length&&t.constructor?n+=t.constructor.name:n+=t.message:n+=y(t);var r=new d({actual:t,expected:null,operator:"ifError",message:n,stackStartFn:e}),s=t.stack;if("string"==typeof s){var o=s.split("\n");o.shift();for(var a=r.stack.split("\n"),c=0;c<o.length;c++){var u=a.indexOf(o[c]);if(-1!==u){a=a.slice(0,u);break}}r.stack="".concat(a.join("\n"),"\n").concat(o.join("\n"))}throw r}},k.strict=w(L,k,{equal:k.strictEqual,deepEqual:k.deepStrictEqual,notEqual:k.notStrictEqual,notDeepEqual:k.notDeepStrictEqual}),k.strict.strict=k.strict},25961:function(e,t,n){"use strict";var r=n(34155);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?a(e):t}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){var t="function"==typeof Map?new Map:void 0;return c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,h(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,e)},c(e)}function u(e,t,n){return u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var s=new(Function.bind.apply(e,r));return n&&l(s,n.prototype),s},u.apply(null,arguments)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}var p=n(89539).inspect,d=n(62136).codes.ERR_INVALID_ARG_TYPE;function y(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}var g="",m="",b="",w="",v={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"};function E(e){var t=Object.keys(e),n=Object.create(Object.getPrototypeOf(e));return t.forEach((function(t){n[t]=e[t]})),Object.defineProperty(n,"message",{value:e.message}),n}function _(e){return p(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function k(e,t,n){var s="",i="",o=0,a="",c=!1,u=_(e),l=u.split("\n"),h=_(t).split("\n"),p=0,d="";if("strictEqual"===n&&"object"===f(e)&&"object"===f(t)&&null!==e&&null!==t&&(n="strictEqualObject"),1===l.length&&1===h.length&&l[0]!==h[0]){var E=l[0].length+h[0].length;if(E<=10){if(!("object"===f(e)&&null!==e||"object"===f(t)&&null!==t||0===e&&0===t))return"".concat(v[n],"\n\n")+"".concat(l[0]," !== ").concat(h[0],"\n")}else if("strictEqualObject"!==n){if(E<(r.stderr&&r.stderr.isTTY?r.stderr.columns:80)){for(;l[0][p]===h[0][p];)p++;p>2&&(d="\n  ".concat(function(e,t){if(t=Math.floor(t),0==e.length||0==t)return"";var n=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+e.substring(0,n-e.length)}(" ",p),"^"),p=0)}}}for(var k=l[l.length-1],S=h[h.length-1];k===S&&(p++<2?a="\n  ".concat(k).concat(a):s=k,l.pop(),h.pop(),0!==l.length&&0!==h.length);)k=l[l.length-1],S=h[h.length-1];var T=Math.max(l.length,h.length);if(0===T){var A=u.split("\n");if(A.length>30)for(A[26]="".concat(g,"...").concat(w);A.length>27;)A.pop();return"".concat(v.notIdentical,"\n\n").concat(A.join("\n"),"\n")}p>3&&(a="\n".concat(g,"...").concat(w).concat(a),c=!0),""!==s&&(a="\n  ".concat(s).concat(a),s="");var I=0,x=v[n]+"\n".concat(m,"+ actual").concat(w," ").concat(b,"- expected").concat(w),O=" ".concat(g,"...").concat(w," Lines skipped");for(p=0;p<T;p++){var P=p-o;if(l.length<p+1)P>1&&p>2&&(P>4?(i+="\n".concat(g,"...").concat(w),c=!0):P>3&&(i+="\n  ".concat(h[p-2]),I++),i+="\n  ".concat(h[p-1]),I++),o=p,s+="\n".concat(b,"-").concat(w," ").concat(h[p]),I++;else if(h.length<p+1)P>1&&p>2&&(P>4?(i+="\n".concat(g,"...").concat(w),c=!0):P>3&&(i+="\n  ".concat(l[p-2]),I++),i+="\n  ".concat(l[p-1]),I++),o=p,i+="\n".concat(m,"+").concat(w," ").concat(l[p]),I++;else{var R=h[p],N=l[p],D=N!==R&&(!y(N,",")||N.slice(0,-1)!==R);D&&y(R,",")&&R.slice(0,-1)===N&&(D=!1,N+=","),D?(P>1&&p>2&&(P>4?(i+="\n".concat(g,"...").concat(w),c=!0):P>3&&(i+="\n  ".concat(l[p-2]),I++),i+="\n  ".concat(l[p-1]),I++),o=p,i+="\n".concat(m,"+").concat(w," ").concat(N),s+="\n".concat(b,"-").concat(w," ").concat(R),I+=2):(i+=s,s="",1!==P&&0!==p||(i+="\n  ".concat(N),I++))}if(I>20&&p<T-2)return"".concat(x).concat(O,"\n").concat(i,"\n").concat(g,"...").concat(w).concat(s,"\n")+"".concat(g,"...").concat(w)}return"".concat(x).concat(c?O:"","\n").concat(i).concat(s).concat(a).concat(d)}var S=function(e){function t(e){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!==f(e)||null===e)throw new d("options","Object",e);var s=e.message,i=e.operator,c=e.stackStartFn,u=e.actual,l=e.expected,p=Error.stackTraceLimit;if(Error.stackTraceLimit=0,null!=s)n=o(this,h(t).call(this,String(s)));else if(r.stderr&&r.stderr.isTTY&&(r.stderr&&r.stderr.getColorDepth&&1!==r.stderr.getColorDepth()?(g="[34m",m="[32m",w="[39m",b="[31m"):(g="",m="",w="",b="")),"object"===f(u)&&null!==u&&"object"===f(l)&&null!==l&&"stack"in u&&u instanceof Error&&"stack"in l&&l instanceof Error&&(u=E(u),l=E(l)),"deepStrictEqual"===i||"strictEqual"===i)n=o(this,h(t).call(this,k(u,l,i)));else if("notDeepStrictEqual"===i||"notStrictEqual"===i){var y=v[i],S=_(u).split("\n");if("notStrictEqual"===i&&"object"===f(u)&&null!==u&&(y=v.notStrictEqualObject),S.length>30)for(S[26]="".concat(g,"...").concat(w);S.length>27;)S.pop();n=1===S.length?o(this,h(t).call(this,"".concat(y," ").concat(S[0]))):o(this,h(t).call(this,"".concat(y,"\n\n").concat(S.join("\n"),"\n")))}else{var T=_(u),A="",I=v[i];"notDeepEqual"===i||"notEqual"===i?(T="".concat(v[i],"\n\n").concat(T)).length>1024&&(T="".concat(T.slice(0,1021),"...")):(A="".concat(_(l)),T.length>512&&(T="".concat(T.slice(0,509),"...")),A.length>512&&(A="".concat(A.slice(0,509),"...")),"deepEqual"===i||"equal"===i?T="".concat(I,"\n\n").concat(T,"\n\nshould equal\n\n"):A=" ".concat(i," ").concat(A)),n=o(this,h(t).call(this,"".concat(T).concat(A)))}return Error.stackTraceLimit=p,n.generatedMessage=!s,Object.defineProperty(a(n),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),n.code="ERR_ASSERTION",n.actual=u,n.expected=l,n.operator=i,Error.captureStackTrace&&Error.captureStackTrace(a(n),c),n.stack,n.name="AssertionError",o(n)}var n,c,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),n=t,c=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:p.custom,value:function(e,t){return p(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}({},t,{customInspect:!1,depth:0}))}}],c&&i(n.prototype,c),u&&i(n,u),t}(c(Error));e.exports=S},62136:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}var a,c,u={};function l(e,t,n){n||(n=Error);var r=function(n){function r(n,o,a){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),c=s(this,i(r).call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,o,a))),c.code=e,c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(r,n),r}(n);u[e]=r}function h(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}l("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),l("ERR_INVALID_ARG_TYPE",(function(e,t,s){var i,o,c,u;if(void 0===a&&(a=n(69282)),a("string"==typeof e,"'name' must be a string"),"string"==typeof t&&(o="not ",t.substr(!c||c<0?0:+c,o.length)===o)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))u="The ".concat(e," ").concat(i," ").concat(h(t,"type"));else{var l=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";u='The "'.concat(e,'" ').concat(l," ").concat(i," ").concat(h(t,"type"))}return u+=". Received type ".concat(r(s))}),TypeError),l("ERR_INVALID_ARG_VALUE",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid";void 0===c&&(c=n(89539));var s=c.inspect(t);return s.length>128&&(s="".concat(s.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(r,". Received ").concat(s)}),TypeError,RangeError),l("ERR_INVALID_RETURN_VALUE",(function(e,t,n){var s;return s=n&&n.constructor&&n.constructor.name?"instance of ".concat(n.constructor.name):"type ".concat(r(n)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(s,".")}),TypeError),l("ERR_MISSING_ARGS",(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];void 0===a&&(a=n(69282)),a(t.length>0,"At least one arg needs to be specified");var s="The ",i=t.length;switch(t=t.map((function(e){return'"'.concat(e,'"')})),i){case 1:s+="".concat(t[0]," argument");break;case 2:s+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:s+=t.slice(0,i-1).join(", "),s+=", and ".concat(t[i-1]," arguments")}return"".concat(s," must be specified")}),TypeError),e.exports.codes=u},19158:function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,s=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){s=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}var i=void 0!==/a/g.flags,o=function(e){var t=[];return e.forEach((function(e){return t.push(e)})),t},a=function(e){var t=[];return e.forEach((function(e,n){return t.push([n,e])})),t},c=Object.is?Object.is:n(20609),u=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},l=Number.isNaN?Number.isNaN:n(20360);function h(e){return e.call.bind(e)}var f=h(Object.prototype.hasOwnProperty),p=h(Object.prototype.propertyIsEnumerable),d=h(Object.prototype.toString),y=n(89539).types,g=y.isAnyArrayBuffer,m=y.isArrayBufferView,b=y.isDate,w=y.isMap,v=y.isRegExp,E=y.isSet,_=y.isNativeError,k=y.isBoxedPrimitive,S=y.isNumberObject,T=y.isStringObject,A=y.isBooleanObject,I=y.isBigIntObject,x=y.isSymbolObject,O=y.isFloat32Array,P=y.isFloat64Array;function R(e){if(0===e.length||e.length>10)return!0;for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n<48||n>57)return!0}return 10===e.length&&e>=Math.pow(2,32)}function N(e){return Object.keys(e).filter(R).concat(u(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}function D(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,s=0,i=Math.min(n,r);s<i;++s)if(e[s]!==t[s]){n=e[s],r=t[s];break}return n<r?-1:r<n?1:0}var C=0,L=1,B=2,M=3;function j(e,t,n,r){if(e===t)return 0!==e||(!n||c(e,t));if(n){if("object"!==s(e))return"number"==typeof e&&l(e)&&l(t);if("object"!==s(t)||null===e||null===t)return!1;if(Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{if(null===e||"object"!==s(e))return(null===t||"object"!==s(t))&&e==t;if(null===t||"object"!==s(t))return!1}var o,a,u,h,f=d(e);if(f!==d(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var p=N(e),y=N(t);return p.length===y.length&&U(e,t,n,r,L,p)}if("[object Object]"===f&&(!w(e)&&w(t)||!E(e)&&E(t)))return!1;if(b(e)){if(!b(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if(v(e)){if(!v(t)||(u=e,h=t,!(i?u.source===h.source&&u.flags===h.flags:RegExp.prototype.toString.call(u)===RegExp.prototype.toString.call(h))))return!1}else if(_(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else{if(m(e)){if(n||!O(e)&&!P(e)){if(!function(e,t){return e.byteLength===t.byteLength&&0===D(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}(e,t))return!1}else if(!function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}(e,t))return!1;var R=N(e),j=N(t);return R.length===j.length&&U(e,t,n,r,C,R)}if(E(e))return!(!E(t)||e.size!==t.size)&&U(e,t,n,r,B);if(w(e))return!(!w(t)||e.size!==t.size)&&U(e,t,n,r,M);if(g(e)){if(a=t,(o=e).byteLength!==a.byteLength||0!==D(new Uint8Array(o),new Uint8Array(a)))return!1}else if(k(e)&&!function(e,t){return S(e)?S(t)&&c(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):T(e)?T(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):A(e)?A(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):I(e)?I(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):x(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)}(e,t))return!1}return U(e,t,n,r,C)}function z(e,t){return t.filter((function(t){return p(e,t)}))}function U(e,t,n,i,c,l){if(5===arguments.length){l=Object.keys(e);var h=Object.keys(t);if(l.length!==h.length)return!1}for(var d=0;d<l.length;d++)if(!f(t,l[d]))return!1;if(n&&5===arguments.length){var y=u(e);if(0!==y.length){var g=0;for(d=0;d<y.length;d++){var m=y[d];if(p(e,m)){if(!p(t,m))return!1;l.push(m),g++}else if(p(t,m))return!1}var b=u(t);if(y.length!==b.length&&z(t,b).length!==g)return!1}else{var w=u(t);if(0!==w.length&&0!==z(t,w).length)return!1}}if(0===l.length&&(c===C||c===L&&0===e.length||0===e.size))return!0;if(void 0===i)i={val1:new Map,val2:new Map,position:0};else{var v=i.val1.get(e);if(void 0!==v){var E=i.val2.get(t);if(void 0!==E)return v===E}i.position++}i.val1.set(e,i.position),i.val2.set(t,i.position);var _=function(e,t,n,i,c,u){var l=0;if(u===B){if(!function(e,t,n,r){for(var i=null,a=o(e),c=0;c<a.length;c++){var u=a[c];if("object"===s(u)&&null!==u)null===i&&(i=new Set),i.add(u);else if(!t.has(u)){if(n)return!1;if(!H(e,t,u))return!1;null===i&&(i=new Set),i.add(u)}}if(null!==i){for(var l=o(t),h=0;h<l.length;h++){var f=l[h];if("object"===s(f)&&null!==f){if(!F(i,f,n,r))return!1}else if(!n&&!e.has(f)&&!F(i,f,n,r))return!1}return 0===i.size}return!0}(e,t,n,c))return!1}else if(u===M){if(!function(e,t,n,i){for(var o=null,c=a(e),u=0;u<c.length;u++){var l=r(c[u],2),h=l[0],f=l[1];if("object"===s(h)&&null!==h)null===o&&(o=new Set),o.add(h);else{var p=t.get(h);if(void 0===p&&!t.has(h)||!j(f,p,n,i)){if(n)return!1;if(!V(e,t,h,f,i))return!1;null===o&&(o=new Set),o.add(h)}}}if(null!==o){for(var d=a(t),y=0;y<d.length;y++){var g=r(d[y],2),m=(h=g[0],g[1]);if("object"===s(h)&&null!==h){if(!K(o,e,h,m,n,i))return!1}else if(!(n||e.has(h)&&j(e.get(h),m,!1,i)||K(o,e,h,m,!1,i)))return!1}return 0===o.size}return!0}(e,t,n,c))return!1}else if(u===L)for(;l<e.length;l++){if(!f(e,l)){if(f(t,l))return!1;for(var h=Object.keys(e);l<h.length;l++){var p=h[l];if(!f(t,p)||!j(e[p],t[p],n,c))return!1}return h.length===Object.keys(t).length}if(!f(t,l)||!j(e[l],t[l],n,c))return!1}for(l=0;l<i.length;l++){var d=i[l];if(!j(e[d],t[d],n,c))return!1}return!0}(e,t,n,l,i,c);return i.val1.delete(e),i.val2.delete(t),_}function F(e,t,n,r){for(var s=o(e),i=0;i<s.length;i++){var a=s[i];if(j(t,a,n,r))return e.delete(a),!0}return!1}function $(e){switch(s(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(l(e))return!1}return!0}function H(e,t,n){var r=$(n);return null!=r?r:t.has(r)&&!e.has(r)}function V(e,t,n,r,s){var i=$(n);if(null!=i)return i;var o=t.get(i);return!(void 0===o&&!t.has(i)||!j(r,o,!1,s))&&(!e.has(i)&&j(r,o,!1,s))}function K(e,t,n,r,s,i){for(var a=o(e),c=0;c<a.length;c++){var u=a[c];if(j(n,u,s,i)&&j(r,t.get(u),s,i))return e.delete(u),!0}return!1}e.exports={isDeepEqual:function(e,t){return j(e,t,false)},isDeepStrictEqual:function(e,t){return j(e,t,true)}}},79742:function(e,t){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,i=c(e),o=i[0],a=i[1],u=new s(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),l=0,h=a>0?o-4:o;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,r=e.length,s=r%3,i=[],o=16383,a=0,c=r-s;a<c;a+=o)i.push(u(e,a,a+o>c?c:a+o));1===s?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===s&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=i.length;o<a;++o)n[o]=i[o],r[i.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,r){for(var s,i,o=[],a=t;a<r;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(i=s)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},11708:function(e,t,n){"use strict";const{AbstractLevel:r}=n(50875),s=n(94473),i=n(29967),{fromCallback:o}=n(16957),{Iterator:a}=n(8212),c=n(89687),u=n(89968),l=n(21217),h="level-js-",f=Symbol("idb"),p=Symbol("namePrefix"),d=Symbol("location"),y=Symbol("version"),g=Symbol("store"),m=Symbol("onComplete"),b=Symbol("promise");class w extends r{constructor(e,t,n){if("function"==typeof t||"function"==typeof n)throw new s("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:r,version:i,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof e)throw new Error("constructor requires a location string argument");this[d]=e,this[p]=null==r?h:r,this[y]=parseInt(i||1,10),this[f]=null}get location(){return this[d]}get namePrefix(){return this[p]}get version(){return this[y]}get db(){return this[f]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[p]+this[d],this[y]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[f]=n.result,t()},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this[d])||t.createObjectStore(this[d])}}[g](e){return this[f].transaction([this[d]],e).objectStore(this[d])}[m](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const r=this[g]("readonly");let i;try{i=r.get(e)}catch(e){return this.nextTick(n,e)}this[m](i,(function(e,t){return e?n(e):void 0===t?n(new s("Entry not found",{code:"LEVEL_NOT_FOUND"})):void n(null,c(t))}))}_getMany(e,t,n){const r=this[g]("readonly"),s=e.map((e=>t=>{let n;try{n=r.get(e)}catch(e){return t(e)}n.onsuccess=()=>{const e=n.result;t(null,void 0===e?e:c(e))},n.onerror=e=>{e.stopPropagation(),t(n.error)}}));i(s,16,n)}_del(e,t,n){const r=this[g]("readwrite");let s;try{s=r.delete(e)}catch(e){return this.nextTick(n,e)}this[m](s,n)}_put(e,t,n,r){const s=this[g]("readwrite");let i;try{i=s.put(t,e)}catch(e){return this.nextTick(r,e)}this[m](i,r)}_iterator(e){return new a(this,this[d],e)}_batch(e,t,n){const r=this[g]("readwrite"),s=r.transaction;let i,o=0;s.onabort=function(){n(i||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()},function t(){const n=e[o++],a=n.key;let c;try{c="del"===n.type?r.delete(a):r.put(n.value,a)}catch(e){return i=e,void s.abort()}o<e.length?c.onsuccess=t:"function"==typeof s.commit&&s.commit()}()}_clear(e,t){let n,r;try{n=l(e)}catch(e){return this.nextTick(t)}if(e.limit>=0)return u(this,this[d],n,e,t);try{const e=this[g]("readwrite");r=n?e.delete(n):e.clear()}catch(e){return this.nextTick(t,e)}this[m](r,t)}_close(e){this[f].close(),this.nextTick(e)}}w.destroy=function(e,t,n){"function"==typeof t&&(n=t,t=h),n=o(n,b);const r=indexedDB.deleteDatabase(t+e);return r.onsuccess=function(){n()},r.onerror=function(e){n(e)},n[b]},t.BrowserLevel=w},8212:function(e,t,n){"use strict";const{AbstractIterator:r}=n(50875),s=n(21217),i=n(89687),o=Symbol("cache"),a=Symbol("finished"),c=Symbol("options"),u=Symbol("currentOptions"),l=Symbol("position"),h=Symbol("location"),f=Symbol("first"),p={};function d(e){"function"==typeof e.commit&&e.commit()}t.Iterator=class extends r{constructor(e,t,n){super(e,n),this[o]=[],this[a]=0===this.limit,this[c]=n,this[u]={...n},this[l]=void 0,this[h]=t,this[f]=!0}_nextv(e,t,n){if(this[f]=!1,this[a])return this.nextTick(n,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(n,null,this[o].splice(0,e));let r;void 0!==this[l]&&(this[c].reverse?(this[u].lt=this[l],this[u].lte=void 0):(this[u].gt=this[l],this[u].gte=void 0));try{r=s(this[u])}catch(e){return this[a]=!0,this.nextTick(n,null,[])}const p=this.db.db.transaction([this[h]],"readonly"),y=p.objectStore(this[h]),g=[];if(this[c].reverse){y[!this[c].values&&y.openKeyCursor?"openKeyCursor":"openCursor"](r,"prev").onsuccess=t=>{const n=t.target.result;if(n){const{key:t,value:r}=n;this[l]=t,g.push([this[c].keys&&void 0!==t?i(t):void 0,this[c].values&&void 0!==r?i(r):void 0]),g.length<e?n.continue():d(p)}else this[a]=!0}}else{let t,n;const s=()=>{if(void 0===t||void 0===n)return;const r=Math.max(t.length,n.length);0===r||e===1/0?this[a]=!0:this[l]=t[r-1],g.length=r;for(let e=0;e<r;e++){const r=t[e],s=n[e];g[e]=[this[c].keys&&void 0!==r?i(r):void 0,this[c].values&&void 0!==s?i(s):void 0]}d(p)};this[c].keys||e<1/0?y.getAllKeys(r,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,s()}:(t=[],this.nextTick(s)),this[c].values?y.getAll(r,e<1/0?e:void 0).onsuccess=e=>{n=e.target.result,s()}:(n=[],this.nextTick(s))}p.onabort=()=>{n(p.error||new Error("aborted by user")),n=null},p.oncomplete=()=>{n(null,g),n=null}}_next(e){if(this[o].length>0){const[t,n]=this[o].shift();this.nextTick(e,null,t,n)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[f]&&(this[f]=!1,t=1),this._nextv(t,p,((t,n)=>{if(t)return e(t);this[o]=n,this._next(e)}))}}_all(e,t){this[f]=!1;const n=this[o].splice(0,this[o].length),r=this.limit-this.count-n.length;if(r<=0)return this.nextTick(t,null,n);this._nextv(r,p,((e,r)=>{if(e)return t(e);n.length>0&&(r=n.concat(r)),t(null,r)}))}_seek(e,t){let n;this[f]=!0,this[o]=[],this[a]=!1,this[l]=void 0,this[u]={...this[c]};try{n=s(this[c])}catch(e){return void(this[a]=!0)}null===n||n.includes(e)?this[c].reverse?this[u].lte=e:this[u].gte=e:this[a]=!0}}},89968:function(e){"use strict";e.exports=function(e,t,n,r,s){if(0===r.limit)return e.nextTick(s);const i=e.db.transaction([t],"readwrite"),o=i.objectStore(t);let a=0;i.oncomplete=function(){s()},i.onabort=function(){s(i.error||new Error("aborted by user"))};const c=o.openKeyCursor?"openKeyCursor":"openCursor",u=r.reverse?"prev":"next";o[c](n,u).onsuccess=function(e){const t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(r.limit<=0||++a<r.limit)&&t.continue()})}}},89687:function(e){"use strict";const t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},21217:function(e){"use strict";e.exports=function(e){const t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,n=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,r=void 0===e.gte,s=void 0===e.lte;return void 0!==t&&void 0!==n?IDBKeyRange.bound(t,n,r,s):void 0!==t?IDBKeyRange.lowerBound(t,r):void 0!==n?IDBKeyRange.upperBound(n,s):null}},79830:function(e){"use strict";e.exports=function(e,t){if("string"==typeof e)return o(e);if("number"==typeof e)return i(e,t);return null},e.exports.format=i,e.exports.parse=o;var t=/\B(?=(\d{3})+(?!\d))/g,n=/(?:\.0*|(\.[^0]+)0+)$/,r={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},s=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function i(e,s){if(!Number.isFinite(e))return null;var i=Math.abs(e),o=s&&s.thousandsSeparator||"",a=s&&s.unitSeparator||"",c=s&&void 0!==s.decimalPlaces?s.decimalPlaces:2,u=Boolean(s&&s.fixedDecimals),l=s&&s.unit||"";l&&r[l.toLowerCase()]||(l=i>=r.pb?"PB":i>=r.tb?"TB":i>=r.gb?"GB":i>=r.mb?"MB":i>=r.kb?"KB":"B");var h=(e/r[l.toLowerCase()]).toFixed(c);return u||(h=h.replace(n,"$1")),o&&(h=h.split(".").map((function(e,n){return 0===n?e.replace(t,o):e})).join(".")),h+a+l}function o(e){if("number"==typeof e&&!isNaN(e))return e;if("string"!=typeof e)return null;var t,n=s.exec(e),i="b";return n?(t=parseFloat(n[1]),i=n[4].toLowerCase()):(t=parseInt(e,10),i="b"),isNaN(t)?null:Math.floor(r[i]*t)}},21924:function(e,t,n){"use strict";var r=n(40210),s=n(55559),i=s(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&i(e,".prototype.")>-1?s(n):n}},55559:function(e,t,n){"use strict";var r=n(58612),s=n(40210),i=s("%Function.prototype.apply%"),o=s("%Function.prototype.call%"),a=s("%Reflect.apply%",!0)||r.call(o,i),c=s("%Object.getOwnPropertyDescriptor%",!0),u=s("%Object.defineProperty%",!0),l=s("%Math.max%");if(u)try{u({},"a",{value:1})}catch(e){u=null}e.exports=function(e){var t=a(r,o,arguments);c&&u&&(c(t,"length").configurable&&u(t,"length",{value:1+l(0,e.length-(arguments.length-1))}));return t};var h=function(){return a(r,i,arguments)};u?u(e.exports,"apply",{value:h}):e.exports.apply=h},16957:function(e,t,n){"use strict";var r=n(90886);t.fromCallback=function(e,t){if(void 0===e){var n=new Promise((function(t,n){e=function(e,r){e?n(e):t(r)}}));e[void 0!==t?t:"promise"]=n}else if("function"!=typeof e)throw new TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then((function(e){r((()=>t(null,e)))})).catch((function(e){r((()=>t(e)))}))}},90886:function(e){e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},25108:function(e,t,n){var r=n(89539),s=n(69282);function i(){return(new Date).getTime()}var o,a=Array.prototype.slice,c={};o=void 0!==n.g&&n.g.console?n.g.console:"undefined"!=typeof window&&window.console?window.console:{};for(var u=[[function(){},"log"],[function(){o.log.apply(o,arguments)},"info"],[function(){o.log.apply(o,arguments)},"warn"],[function(){o.warn.apply(o,arguments)},"error"],[function(e){c[e]=i()},"time"],[function(e){var t=c[e];if(!t)throw new Error("No such label: "+e);delete c[e];var n=i()-t;o.log(e+": "+n+"ms")},"timeEnd"],[function(){var e=new Error;e.name="Trace",e.message=r.format.apply(null,arguments),o.error(e.stack)},"trace"],[function(e){o.log(r.inspect(e)+"\n")},"dir"],[function(e){if(!e){var t=a.call(arguments,1);s.ok(!1,r.format.apply(null,t))}},"assert"]],l=0;l<u.length;l++){var h=u[l],f=h[0],p=h[1];o[p]||(o[p]=f)}e.exports=o},74077:function(e,t){var n="undefined"!=typeof self?self:this,r=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();!function(e){!function(t){var n={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(n.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};function i(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function o(e){return"string"!=typeof e&&(e=String(e)),e}function a(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n.iterable&&(t[Symbol.iterator]=function(){return t}),t}function c(e){this.map={},e instanceof c?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function u(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function h(e){var t=new FileReader,n=l(t);return t.readAsArrayBuffer(e),n}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:n.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():n.arrayBuffer&&n.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||s(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?u(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,n=l(t);return t.readAsText(e),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}c.prototype.append=function(e,t){e=i(e),t=o(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},c.prototype.delete=function(e){delete this.map[i(e)]},c.prototype.get=function(e){return e=i(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(i(e))},c.prototype.set=function(e,t){this.map[i(e)]=o(t)},c.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},c.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),a(e)},c.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),a(e)},c.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),a(e)},n.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var d=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(e,t){var n,r,s=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),d.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function g(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),s=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(s))}})),t}function m(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},p.call(y.prototype),p.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},m.error=function(){var e=new m(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];m.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new m(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function w(e,r){return new Promise((function(s,i){var o=new y(e,r);if(o.signal&&o.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new c,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var s=n.join(":").trim();t.append(r,s)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;s(new m(r,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&n.blob&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",u)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}w.polyfill=!0,e.fetch||(e.fetch=w,e.Headers=c,e.Request=y,e.Response=m),t.Headers=c,t.Request=y,t.Response=m,t.fetch=w,Object.defineProperty(t,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;(t=s.fetch).default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,e.exports=t},59435:function(e){var t=1e3,n=60*t,r=60*n,s=24*r,i=7*s,o=365.25*s;function a(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}e.exports=function(e,c){c=c||{};var u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*s;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===u&&isFinite(e))return c.long?function(e){var i=Math.abs(e);if(i>=s)return a(e,i,s,"day");if(i>=r)return a(e,i,r,"hour");if(i>=n)return a(e,i,n,"minute");if(i>=t)return a(e,i,t,"second");return e+" ms"}(e):function(e){var i=Math.abs(e);if(i>=s)return Math.round(e/s)+"d";if(i>=r)return Math.round(e/r)+"h";if(i>=n)return Math.round(e/n)+"m";if(i>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},11227:function(e,t,n){var r=n(25108),s=n(34155);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))})),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==s&&"env"in s&&(e=s.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,r.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=r.debug||r.log||(()=>{}),e.exports=n(82447)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},82447:function(e,t,n){var r=n(25108);e.exports=function(e){function t(e){let n,r,i,o=null;function a(...e){if(!a.enabled)return;const r=a,s=Number(new Date),i=s-(n||s);r.diff=i,r.prev=n,r.curr=s,n=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,s)=>{if("%%"===n)return"%";o++;const i=t.formatters[s];if("function"==typeof i){const t=e[o];n=i.call(r,t),e.splice(o,1),o--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=s,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(r!==t.namespaces&&(r=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function s(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(n=0;n<s;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(59435),t.destroy=function(){r.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},4289:function(e,t,n){"use strict";var r=n(82215),s="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),i=Object.prototype.toString,o=Array.prototype.concat,a=Object.defineProperty,c=n(31044)(),u=a&&c,l=function(e,t,n,r){if(t in e)if(!0===r){if(e[t]===n)return}else if("function"!=typeof(s=r)||"[object Function]"!==i.call(s)||!r())return;var s;u?a(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n},h=function(e,t){var n=arguments.length>2?arguments[2]:{},i=r(t);s&&(i=o.call(i,Object.getOwnPropertySymbols(t)));for(var a=0;a<i.length;a+=1)l(e,i[a],t[i[a]],n[i[a]])};h.supportsDescriptors=!!u,e.exports=h},65780:function(e){"use strict";const t=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},n=({clearTimeout:e,setTimeout:n,willResolve:r})=>(s,{value:i,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(t());let a,c,u;const l=e||clearTimeout,h=()=>{l(a),u(t())},f=new Promise(((e,t)=>{c=()=>{o&&o.removeEventListener("abort",h),r?e(i):t(i)},u=t,a=(n||setTimeout)(c,s)}));return o&&o.addEventListener("abort",h,{once:!0}),f.clear=()=>{l(a),a=null,c()},f},r=e=>{const t=n({...e,willResolve:!0});return t.reject=n({...e,willResolve:!1}),t.range=(e,n,r)=>t(((e,t)=>Math.floor(Math.random()*(t-e+1)+e))(e,n),r),t},s=r();s.createWithTimers=r,e.exports=s,e.exports.default=s},45001:function(e){"use strict";function t(e,t){t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(void 0===e)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(void 0===e)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},t.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var n=this.size(),r=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s,i=this._list[t];if(e<n/2){for(s=e;s>0;s--)this._list[t]=this._list[t=t-1+r&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+r&this._capacityMask}else{for(s=n-1-e;s>0;s--)this._list[t]=this._list[t=t+1+r&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+r&this._capacityMask}return i}}},t.prototype.remove=function(e,t){var n,r=e,s=t;if(r===(0|r)&&this._head!==this._tail){var i=this.size(),o=this._list.length;if(!(r>=i||r<-i||t<1)){if(r<0&&(r+=i),1===t||!t)return(n=new Array(1))[0]=this.removeOne(r),n;if(0===r&&r+t>=i)return n=this.toArray(),this.clear(),n;var a;for(r+t>i&&(t=i-r),n=new Array(t),a=0;a<t;a++)n[a]=this._list[this._head+r+a&this._capacityMask];if(r=this._head+r&this._capacityMask,e+t===i){for(this._tail=this._tail-t+o&this._capacityMask,a=t;a>0;a--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(0===e){for(this._head=this._head+t+o&this._capacityMask,a=t-1;a>0;a--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(r<i/2){for(this._head=this._head+e+t+o&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[r=r-1+o&this._capacityMask]);for(r=this._head-1+o&this._capacityMask;s>0;)this._list[r=r-1+o&this._capacityMask]=void 0,s--;e<0&&(this._tail=r)}else{for(this._tail=r,r=r+t+o&this._capacityMask,a=i-(t+e);a>0;a--)this.push(this._list[r++]);for(r=this._tail;s>0;)this._list[r=r+1+o&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),n}}},t.prototype.splice=function(e,t){var n=e;if(n===(0|n)){var r=this.size();if(n<0&&(n+=r),!(n>r)){if(arguments.length>2){var s,i,o,a=arguments.length,c=this._list.length,u=2;if(!r||n<r/2){for(i=new Array(n),s=0;s<n;s++)i[s]=this._list[this._head+s&this._capacityMask];for(0===t?(o=[],n>0&&(this._head=this._head+n+c&this._capacityMask)):(o=this.remove(n,t),this._head=this._head+n+c&this._capacityMask);a>u;)this.unshift(arguments[--a]);for(s=n;s>0;s--)this.unshift(i[s-1])}else{var l=(i=new Array(r-(n+t))).length;for(s=0;s<l;s++)i[s]=this._list[this._head+n+t+s&this._capacityMask];for(0===t?(o=[],n!=r&&(this._tail=this._head+n+c&this._capacityMask)):(o=this.remove(n,t),this._tail=this._tail-l+c&this._capacityMask);u<a;)this.push(arguments[u++]);for(s=0;s<l;s++)this.push(i[s])}return o}return this.remove(n,t)}}},t.prototype.clear=function(){this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])},t.prototype._copyArray=function(e){var t,n=[],r=this._list,s=r.length;if(e||this._head>this._tail){for(t=this._head;t<s;t++)n.push(r[t]);for(t=0;t<this._tail;t++)n.push(r[t])}else for(t=this._head;t<this._tail;t++)n.push(r[t]);return n},t.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},e.exports=t},39387:function(e,t,n){"use strict";n.d(t,{ZP:function(){return Hn}});var r=n(25108);const s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,i=Object.keys,o=Array.isArray;function a(e,t){return"object"!=typeof t||i(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||s.Promise||(s.Promise=Promise);const c=Object.getPrototypeOf,u={}.hasOwnProperty;function l(e,t){return u.call(e,t)}function h(e,t){"function"==typeof t&&(t=t(c(e))),("undefined"==typeof Reflect?i:Reflect.ownKeys)(t).forEach((n=>{p(e,n,t[n])}))}const f=Object.defineProperty;function p(e,t,n,r){f(e,t,a(n&&l(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function d(e){return{from:function(t){return e.prototype=Object.create(t.prototype),p(e.prototype,"constructor",e),{extend:h.bind(null,e.prototype)}}}}const y=Object.getOwnPropertyDescriptor;function g(e,t){let n;return y(e,t)||(n=c(e))&&g(n,t)}const m=[].slice;function b(e,t,n){return m.call(e,t,n)}function w(e,t){return t(e)}function v(e){if(!e)throw new Error("Assertion Failed")}function E(e){s.setImmediate?setImmediate(e):setTimeout(e,0)}function _(e,t){return e.reduce(((e,n,r)=>{var s=t(n,r);return s&&(e[s[0]]=s[1]),e}),{})}function k(e,t){if(l(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,s=t.length;r<s;++r){var i=k(e,t[r]);n.push(i)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:k(a,t.substr(o+1))}}function S(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){v("string"!=typeof n&&"length"in n);for(var r=0,s=t.length;r<s;++r)S(e,t[r],n[r])}else{var i=t.indexOf(".");if(-1!==i){var a=t.substr(0,i),c=t.substr(i+1);if(""===c)void 0===n?o(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n;else{var u=e[a];u&&l(e,a)||(u=e[a]={}),S(u,c,n)}}else void 0===n?o(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function T(e){var t={};for(var n in e)l(e,n)&&(t[n]=e[n]);return t}const A=[].concat;function I(e){return A.apply([],e)}const x="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(I([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>s[e])),O=x.map((e=>s[e]));_(x,(e=>[e,!0]));let P=null;function R(e){P="undefined"!=typeof WeakMap&&new WeakMap;const t=N(e);return P=null,t}function N(e){if(!e||"object"!=typeof e)return e;let t=P&&P.get(e);if(t)return t;if(o(e)){t=[],P&&P.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(N(e[n]))}else if(O.indexOf(e.constructor)>=0)t=e;else{const n=c(e);for(var s in t=n===Object.prototype?{}:Object.create(n),P&&P.set(e,t),e)l(e,s)&&(t[s]=N(e[s]))}return t}const{toString:D}={};function C(e){return D.call(e).slice(8,-1)}const L="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",B="symbol"==typeof L?function(e){var t;return null!=e&&(t=e[L])&&t.apply(e)}:function(){return null},M={};function j(e){var t,n,r,s;if(1===arguments.length){if(o(e))return e.slice();if(this===M&&"string"==typeof e)return[e];if(s=B(e)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const z="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var U="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function F(e,t){U=e,$=t}var $=()=>!0;const H=!new Error("").stack;function V(){if(H)try{throw V.arguments,new Error}catch(e){return e}return new Error}function K(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter($).map((e=>"\n"+e)).join("")):""}var q=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],W=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(q),G={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function J(e,t){this._e=V(),this.name=e,this.message=t}function Z(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function Y(e,t,n,r){this._e=V(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Z(e,t)}function X(e,t){this._e=V(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=Z(e,t)}d(J).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+K(this._e,2))}},toString:function(){return this.name+": "+this.message}}),d(Y).from(J),d(X).from(J);var Q=W.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const ee=J;var te=W.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=V(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=G[t]||n,this.inner=null)}return d(r).from(ee),e[t]=r,e}),{});te.Syntax=SyntaxError,te.Type=TypeError,te.Range=RangeError;var ne=q.reduce(((e,t)=>(e[t+"Error"]=te[t],e)),{}),re=W.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=te[t]),e)),{});function se(){}function ie(e){return e}function oe(e,t){return null==e||e===ie?t:function(n){return t(e(n))}}function ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ce(e,t){return e===se?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ae(r,this.onsuccess):r),s&&(this.onerror=this.onerror?ae(s,this.onerror):s),void 0!==i?i:n}}function ue(e,t){return e===se?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ae(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ae(r,this.onerror):r)}}function le(e,t){return e===se?t:function(n){var r=e.apply(this,arguments);a(n,r);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ae(s,this.onsuccess):s),i&&(this.onerror=this.onerror?ae(i,this.onerror):i),void 0===r?void 0===o?void 0:o:a(r,o)}}function he(e,t){return e===se?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(e,t){return e===se?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return n.then((function(){return t.apply(r,i)}))}return t.apply(this,arguments)}}re.ModifyError=Y,re.DexieError=J,re.BulkError=X;var pe={};const[de,ye,ge]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,c(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,c(t),e]})(),me=ye&&ye.then,be=de&&de.constructor,we=!!ge;var ve=!1,Ee=ge?()=>{ge.then(Ve)}:s.setImmediate?setImmediate.bind(null,Ve):s.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Ve(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Ve,0)},_e=function(e,t){Re.push([e,t]),Se&&(Ee(),Se=!1)},ke=!0,Se=!0,Te=[],Ae=[],Ie=null,xe=ie,Oe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:dt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{dt(e[0],e[1])}catch(e){}}))}},Pe=Oe,Re=[],Ne=0,De=[];function Ce(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=se,this._lib=!1;var t=this._PSD=Pe;if(U&&(this._stackHolder=V(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==pe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&je(this,this._value))}this._state=null,this._value=null,++t.ref,Me(this,e)}const Le={get:function(){var e=Pe,t=et;function n(n,r){var s=!e.global&&(e!==Pe||t!==et);const i=s&&!st();var o=new Ce(((t,o)=>{Ue(this,new Be(ft(n,e,s,i),ft(r,e,s,i),t,o,e))}));return U&&He(o,this),o}return n.prototype=pe,n},set:function(e){p(this,"then",e&&e.prototype===pe?Le:{get:function(){return e},set:Le.set})}};function Be(e,t,n,r,s){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=s}function Me(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Ke();t&&"function"==typeof t.then?Me(e,((e,n)=>{t instanceof Ce?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,ze(e)),n&&qe()}}),je.bind(null,e))}catch(t){je(e,t)}}function je(e,t){if(Ae.push(t),null===e._state){var n=e._lib&&Ke();t=xe(t),e._state=!1,e._value=t,U&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,void 0)}catch(e){}}((()=>{var n=g(t,"stack");t._promise=e,p(t,"stack",{get:()=>ve?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Te.some((t=>t._value===e._value))||Te.push(e)}(e),ze(e),n&&qe()}}function ze(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Ue(e,t[n]);var s=e._PSD;--s.ref||s.finalize(),0===Ne&&(++Ne,_e((()=>{0==--Ne&&We()}),[]))}function Ue(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ne,_e(Fe,[n,e,t])}else e._listeners.push(t)}function Fe(e,t,n){try{Ie=t;var r,s=t._value;t._state?r=e(s):(Ae.length&&(Ae=[]),r=e(s),-1===Ae.indexOf(s)&&function(e){for(var t=Te.length;t;)if(Te[--t]._value===e._value)return void Te.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{Ie=null,0==--Ne&&We(),--n.psd.ref||n.psd.finalize()}}function $e(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var s,i,o=e._value;null!=o?(s=o.name||"Error",i=o.message||o,r=K(o,0)):(s=o,i=""),t.push(s+(i?": "+i:"")+r)}return U&&((r=K(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&$e(e._prev,t,n)),t}function He(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ve(){Ke()&&qe()}function Ke(){var e=ke;return ke=!1,Se=!1,e}function qe(){var e,t,n;do{for(;Re.length>0;)for(e=Re,Re=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Re.length>0);ke=!0,Se=!0}function We(){var e=Te;Te=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=De.slice(0),n=t.length;n;)t[--n]()}function Ge(e){return new Ce(pe,!1,e)}function Je(e,t){var n=Pe;return function(){var r=Ke(),s=Pe;try{return ct(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ct(s,!1),r&&qe()}}}h(Ce.prototype,{then:Le,_then:function(e,t){Ue(this,new Be(null,null,e,t,Pe))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):Ge(e))):this.then(null,(e=>e&&e.name===t?n(e):Ge(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Ge(t))))},stack:{get:function(){if(this._stack)return this._stack;try{ve=!0;var e=$e(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{ve=!1}}},timeout:function(e,t){return e<1/0?new Ce(((n,r)=>{var s=setTimeout((()=>r(new te.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,s))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&p(Ce.prototype,Symbol.toStringTag,"Dexie.Promise"),Oe.env=ut(),h(Ce,{all:function(){var e=j.apply(null,arguments).map(it);return new Ce((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((s,i)=>Ce.resolve(s).then((n=>{e[i]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof Ce)return e;if(e&&"function"==typeof e.then)return new Ce(((t,n)=>{e.then(t,n)}));var t=new Ce(pe,!0,e);return He(t,Ie),t},reject:Ge,race:function(){var e=j.apply(null,arguments).map(it);return new Ce(((t,n)=>{e.map((e=>Ce.resolve(e).then(t,n)))}))},PSD:{get:()=>Pe,set:e=>Pe=e},totalEchoes:{get:()=>et},newPSD:nt,usePSD:lt,scheduler:{get:()=>_e,set:e=>{_e=e}},rejectionMapper:{get:()=>xe,set:e=>{xe=e}},follow:(e,t)=>new Ce(((n,r)=>nt(((t,n)=>{var r=Pe;r.unhandleds=[],r.onunhandled=n,r.finalize=ae((function(){!function(e){De.push((function t(){e(),De.splice(De.indexOf(t),1)})),++Ne,_e((()=>{0==--Ne&&We()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),be&&(be.allSettled&&p(Ce,"allSettled",(function(){const e=j.apply(null,arguments).map(it);return new Ce((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,s)=>Ce.resolve(e).then((e=>r[s]={status:"fulfilled",value:e}),(e=>r[s]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),be.any&&"undefined"!=typeof AggregateError&&p(Ce,"any",(function(){const e=j.apply(null,arguments).map(it);return new Ce(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const s=new Array(r);e.forEach(((e,i)=>Ce.resolve(e).then((e=>t(e)),(e=>{s[i]=e,--r||n(new AggregateError(s))}))))}))})));const Ze={awaits:0,echoes:0,id:0};var Ye=0,Xe=[],Qe=0,et=0,tt=0;function nt(e,t,n,r){var s=Pe,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++tt;var o=Oe.env;i.env=we?{Promise:Ce,PromiseProp:{value:Ce,configurable:!0,writable:!0},all:Ce.all,race:Ce.race,allSettled:Ce.allSettled,any:Ce.any,resolve:Ce.resolve,reject:Ce.reject,nthen:pt(o.nthen,i),gthen:pt(o.gthen,i)}:{},t&&a(i,t),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var c=lt(i,e,n,r);return 0===i.ref&&i.finalize(),c}function rt(){return Ze.id||(Ze.id=++Ye),++Ze.awaits,Ze.echoes+=100,Ze.id}function st(){return!!Ze.awaits&&(0==--Ze.awaits&&(Ze.id=0),Ze.echoes=100*Ze.awaits,!0)}function it(e){return Ze.echoes&&e&&e.constructor===be?(rt(),e.then((e=>(st(),e)),(e=>(st(),yt(e))))):e}function ot(e){++et,Ze.echoes&&0!=--Ze.echoes||(Ze.echoes=Ze.id=0),Xe.push(Pe),ct(e,!0)}function at(){var e=Xe[Xe.length-1];Xe.pop(),ct(e,!1)}function ct(e,t){var n=Pe;if((t?!Ze.echoes||Qe++&&e===Pe:!Qe||--Qe&&e===Pe)||ht(t?ot.bind(null,e):at),e!==Pe&&(Pe=e,n===Oe&&(Oe.env=ut()),we)){var r=Oe.env.Promise,i=e.env;ye.then=i.nthen,r.prototype.then=i.gthen,(n.global||e.global)&&(Object.defineProperty(s,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function ut(){var e=s.Promise;return we?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ye.then,gthen:e.prototype.then}:{}}function lt(e,t,n,r,s){var i=Pe;try{return ct(e,!0),t(n,r,s)}finally{ct(i,!1)}}function ht(e){me.call(de,e)}function ft(e,t,n,r){return"function"!=typeof e?e:function(){var s=Pe;n&&rt(),ct(t,!0);try{return e.apply(this,arguments)}finally{ct(s,!1),r&&ht(st)}}}function pt(e,t){return function(n,r){return e.call(this,ft(n,t),ft(r,t))}}function dt(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var i,o={promise:t,reason:e};if(s.document&&document.createEvent?((i=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),a(i,o)):s.CustomEvent&&a(i=new CustomEvent("unhandledrejection",{detail:o}),o),i&&s.dispatchEvent&&(dispatchEvent(i),!s.PromiseRejectionEvent&&s.onunhandledrejection))try{s.onunhandledrejection(i)}catch(e){}U&&i&&!i.defaultPrevented&&r.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+me).indexOf("[native code]")&&(rt=st=se);var yt=Ce.reject;function gt(e,t,n,s){if(e.idbdb&&(e._state.openComplete||Pe.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===Q.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(r.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>gt(e,t,n,s)))):yt(i)}return i._promise(t,((e,t)=>nt((()=>(Pe.trans=i,s(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return yt(new te.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return yt(new te.DatabaseClosed);e.open().catch(se)}return e._state.dbReadyPromise.then((()=>gt(e,t,n,s)))}const mt=String.fromCharCode(65535),bt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wt=[],vt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Et=vt,_t=vt,kt=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function St(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Tt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function At(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=R(t))[e],t)}class It{_trans(e,t,n){const r=this._tx||Pe.trans,s=this.name;function i(e,n,r){if(!r.schema[s])throw new te.NotFound("Table "+s+" not part of transaction");return t(r.idbtrans,r)}const o=Ke();try{return r&&r.db===this.db?r===Pe.trans?r._promise(e,i,n):nt((()=>r._promise(e,i,n)),{trans:r,transless:Pe.transless||Pe}):gt(this.db,e,[this.name],i)}finally{o&&qe()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(o(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=i(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==mt)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&U&&r.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:s}=this.schema,a=this.db._deps.indexedDB;function c(e,t){try{return 0===a.cmp(e,t)}catch(e){return!1}}const[u,l]=t.reduce((([t,n],r)=>{const i=s[r],a=e[r];return[t||i,t||!i?St(n,i&&i.multi?e=>{const t=k(e,r);return o(t)&&t.some((e=>c(a,e)))}:e=>c(a,k(e,r))):n]}),[null,null]);return u?this.where(u.name).equals(e[u.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,o(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var r in t)if(l(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){a(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let s=e;return r&&n&&(s=At(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[s]}))).then((e=>e.numFailures?Ce.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{S(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||o(e))return this.where(":id").equals(e).modify(t);{const n=k(e,this.schema.primKey.keyPath);if(void 0===n)return yt(new te.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?i(t).forEach((n=>{S(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let s=e;return r&&n&&(s=At(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[s],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Ce.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{S(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Ce.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Tt}))).then((e=>e.numFailures?Ce.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,s=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new te.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=i&&n?e.map(At(i)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:a,wantResults:s}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return s?t:n;throw new X(`${this.name}.bulkAdd(): ${e} of ${o} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,s=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:i}=this.schema.primKey;if(i&&r)throw new te.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const o=e.length;let a=i&&n?e.map(At(i)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:a,wantResults:s}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return s?t:n;throw new X(`${this.name}.bulkPut(): ${e} of ${o} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new X(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function xt(e){var t={},n=function(n,r){if(r){for(var s=arguments.length,i=new Array(s-1);--s;)i[s-1]=arguments[s];return t[n].subscribe.apply(null,i),e}if("string"==typeof n)return t[n]};n.addEventType=a;for(var r=1,s=arguments.length;r<s;++r)a(arguments[r]);return n;function a(e,r,s){if("object"==typeof e)return c(e);r||(r=he),s||(s=se);var i={subscribers:[],fire:s,subscribe:function(e){-1===i.subscribers.indexOf(e)&&(i.subscribers.push(e),i.fire=r(i.fire,e))},unsubscribe:function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e})),i.fire=i.subscribers.reduce(r,s)}};return t[e]=n[e]=i,i}function c(e){i(e).forEach((function(t){var n=e[t];if(o(n))a(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new te.InvalidArgument("Invalid event config");var r=a(t,ie,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){E((function(){e.apply(null,t)}))}))}))}}))}}function Ot(e,t){return d(t).from({prototype:e}),t}function Pt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Rt(e,t){e.filter=St(e.filter,t)}function Nt(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>St(r(),t()):t,e.justLimit=n&&!r}function Dt(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new te.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Ct(e,t,n){const r=Dt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Lt(e,t,n,r){const s=e.replayFilter?St(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},o=(e,n,r)=>{if(!s||s(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var o=n.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),l(i,a)||(i[a]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(o,n),Bt(Ct(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Bt(Ct(e,r,n),St(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Bt(e,t,n,r){var s=Je(r?(e,t,s)=>n(r(e),t,s):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=se}),(t=>{e.fail(t),n=se}))||s(e.value,e,(e=>n=e)),n()}))}))}function Mt(e,t){try{const n=jt(e),r=jt(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,s=n<r?n:r;for(let n=0;n<s;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(zt(e),zt(t));case"Array":return function(e,t){const n=e.length,r=t.length,s=n<r?n:r;for(let n=0;n<s;++n){const r=Mt(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function jt(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=C(e);return"ArrayBuffer"===n?"binary":n}function zt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Ut{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,yt.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,yt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=St(t.algorithm,e)}_iterate(e,t){return Lt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&a(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>Lt(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Pt(t,!0))return n.count({trans:e,query:{index:Dt(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return Lt(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],s=n.length-1;function i(e,t){return t?i(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var n=i(e,s),r=i(t,s);return n<r?-o:n>r?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Pt(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=Dt(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return Lt(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Pt(t)?Nt(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):Nt(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Nt(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return Rt(this._ctx,(function(n,r,s){return!e(n.value)||(r(s),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Rt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=St(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Pt(t,!0)&&t.limit>0)return this._read((e=>{var n=Dt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Rt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=l(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var s=i(e),o=s.length;r=function(t){for(var n=!1,r=0;r<o;++r){var i=s[r],a=e[i];k(t,i)!==a&&(S(t,i,a),n=!0)}return n}}const a=t.table.core,{outbound:c,extractKey:u}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,h=[];let f=0;const p=[],d=(e,t)=>{const{failures:n,numFailures:r}=t;f+=e-r;for(let e of i(n))h.push(n[e])};return this.clone().primaryKeys().then((s=>{const i=o=>{const h=Math.min(l,s.length-o);return a.getMany({trans:n,keys:s.slice(o,o+h),cache:"immutable"}).then((f=>{const p=[],y=[],g=c?[]:null,m=[];for(let e=0;e<h;++e){const t=f[e],n={value:R(t),primKey:s[o+e]};!1!==r.call(n,n.value,n)&&(null==n.value?m.push(s[o+e]):c||0===Mt(u(t),u(n.value))?(y.push(n.value),c&&g.push(s[o+e])):(m.push(s[o+e]),p.push(n.value)))}const b=Pt(t)&&t.limit===1/0&&("function"!=typeof e||e===Ft)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&a.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)m.splice(parseInt(t),1);d(p.length,e)}))).then((()=>(y.length>0||b&&"object"==typeof e)&&a.mutate({trans:n,type:"put",keys:g,values:y,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>d(y.length,e))))).then((()=>(m.length>0||b&&e===Ft)&&a.mutate({trans:n,type:"delete",keys:m,criteria:b}).then((e=>d(m.length,e))))).then((()=>s.length>o+h&&i(o+l)))}))};return i(0).then((()=>{if(h.length>0)throw new Y("Error modifying one or more objects",h,f,p);return s.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Pt(e)&&(e.isPrimKey&&!_t||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,s=t;return e.table.core.count({trans:n,query:{index:r,range:s}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:s}).then((({failures:e,lastResult:n,results:r,numFailures:s})=>{if(s)throw new Y("Could not delete some values",Object.keys(e).map((t=>e[t])),t-s);return t-s}))))})):this.modify(Ft)}}const Ft=(e,t)=>t.value=null;function $t(e,t){return e<t?-1:e===t?0:1}function Ht(e,t){return e>t?-1:e===t?0:1}function Vt(e,t,n){var r=e instanceof Zt?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Kt(e){return new e.Collection(e,(()=>Jt(""))).limit(0)}function qt(e,t,n,r,s,i){for(var o=Math.min(e.length,r.length),a=-1,c=0;c<o;++c){var u=t[c];if(u!==r[c])return s(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):s(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;s(e[c],u)<0&&(a=c)}return o<r.length&&"next"===i?e+n.substr(e.length):o<e.length&&"prev"===i?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function Wt(e,t,n,r){var s,i,o,a,c,u,l,h=n.length;if(!n.every((e=>"string"==typeof e)))return Vt(e,"String expected.");function f(e){s=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),i=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),o="next"===e?$t:Ht;var t=n.map((function(e){return{lower:i(e),upper:s(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));a=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),u=e,l="next"===e?"":r}f("next");var p=new e.Collection(e,(()=>Gt(a[0],c[h-1]+r)));p._ondirectionchange=function(e){f(e)};var d=0;return p._addAlgorithm((function(e,n,r){var s=e.key;if("string"!=typeof s)return!1;var f=i(s);if(t(f,c,d))return!0;for(var p=null,y=d;y<h;++y){var g=qt(s,f,a[y],c[y],o,u);null===g&&null===p?d=y+1:(null===p||o(p,g)>0)&&(p=g)}return n(null!==p?function(){e.continue(p+l)}:r),!1})),p}function Gt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Jt(e){return{type:1,lower:e,upper:e}}class Zt{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Kt(this):new this.Collection(this,(()=>Gt(e,t,!n,!r)))}catch(e){return Vt(this,bt)}}equals(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Jt(e)))}above(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(e,void 0,!0)))}aboveOrEqual(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(e,void 0,!1)))}below(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Vt(this,bt):new this.Collection(this,(()=>Gt(void 0,e)))}startsWith(e){return"string"!=typeof e?Vt(this,"String expected."):this.between(e,e+mt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):Wt(this,((e,t)=>0===e.indexOf(t[0])),[e],mt)}equalsIgnoreCase(e){return Wt(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=j.apply(M,arguments);return 0===e.length?Kt(this):Wt(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=j.apply(M,arguments);return 0===e.length?Kt(this):Wt(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,mt)}anyOf(){const e=j.apply(M,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Vt(this,bt)}if(0===e.length)return Kt(this);const n=new this.Collection(this,(()=>Gt(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,s,i)=>{const o=n.key;for(;t(o,e[r])>0;)if(++r,r===e.length)return s(i),!1;return 0===t(o,e[r])||(s((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=j.apply(M,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Vt(this,bt)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,s=this._descending,i=this._min,o=this._max;if(0===e.length)return Kt(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return Vt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",te.InvalidArgument);const a=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let u,l=r;function h(e,t){return l(e[0],t[0])}try{u=e.reduce((function(e,t){let r=0,s=e.length;for(;r<s;++r){const s=e[r];if(n(t[0],s[1])<0&&n(t[1],s[0])>0){s[0]=i(s[0],t[0]),s[1]=o(s[1],t[1]);break}}return r===s&&e.push(t),e}),[]),u.sort(h)}catch(e){return Vt(this,bt)}let f=0;const p=c?e=>r(e,u[f][1])>0:e=>r(e,u[f][1])>=0,d=a?e=>s(e,u[f][0])>0:e=>s(e,u[f][0])>=0;let y=p;const g=new this.Collection(this,(()=>Gt(u[0][0],u[u.length-1][1],!a,!c)));return g._ondirectionchange=e=>{"next"===e?(y=p,l=r):(y=d,l=s),u.sort(h)},g._addAlgorithm(((e,t,n)=>{for(var s=e.key;y(s);)if(++f,f===u.length)return t(n),!1;return!!function(e){return!p(e)&&!d(e)}(s)||(0===this._cmp(s,u[f][1])||0===this._cmp(s,u[f][0])||t((()=>{l===r?e.continue(u[f][0]):e.continue(u[f][1])})),!1)})),g}startsWithAnyOf(){const e=j.apply(M,arguments);return e.every((e=>"string"==typeof e))?0===e.length?Kt(this):this.inAnyRange(e.map((e=>[e,e+mt]))):Vt(this,"startsWithAnyOf() only works with strings")}}function Yt(e){return Je((function(t){return Xt(t),e(t.target.error),!1}))}function Xt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Qt=xt(null,"storagemutated");class en{_lock(){return v(!Pe.global),++this._reculock,1!==this._reculock||Pe.global||(Pe.lockOwnerFor=this),this}_unlock(){if(v(!Pe.global),0==--this._reculock)for(Pe.global||(Pe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{lt(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Pe.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(v(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new te.DatabaseClosed(n);case"MissingAPIError":throw new te.MissingAPI(n.message,n);default:throw new te.OpenFailed(n)}if(!this.active)throw new te.TransactionInactive;return v(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Je((t=>{Xt(t),this._reject(e.error)})),e.onabort=Je((t=>{Xt(t),this.active&&this._reject(new te.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=Je((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Qt.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return yt(new te.ReadOnly("Transaction is readonly"));if(!this.active)return yt(new te.TransactionInactive);if(this._locked())return new Ce(((r,s)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,s)},Pe])}));if(n)return nt((()=>{var e=new Ce(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new Ce(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=Ce.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var s=t._waitingFor;return new Ce(((e,r)=>{n.then((n=>t._waitingQueue.push(Je(e.bind(null,n)))),(e=>t._waitingQueue.push(Je(r.bind(null,e))))).finally((()=>{t._waitingFor===s&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new te.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(l(t,e))return t[e];const n=this.schema[e];if(!n)throw new te.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function tn(e,t,n,r,s,i,o){return{name:e,keyPath:t,unique:n,multi:r,auto:s,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(s?"++":"")+nn(t)}}function nn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function rn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:_(n,(e=>[e.name,e]))}}let sn=e=>{try{return e.only([[]]),sn=()=>[[]],[[]]}catch(e){return sn=()=>mt,mt}};function on(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>k(t,e)}(e):t=>k(t,e)}function an(e){return[].slice.call(e)}let cn=0;function un(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function ln(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:s,upperOpen:i}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!i):void 0===r?t.lowerBound(n,!!s):t.bound(n,r,!!s,!!i)}const{schema:s,hasGetAll:i}=function(e,t){const n=an(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=o(t),s=null==t,i={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:s,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:on(t)},indexes:an(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:s}=e,a={name:t,compound:o(s),keyPath:s,unique:n,multiEntry:r,extractKey:on(s)};return i[un(s)]=a,a})),getIndexByKeyPath:e=>i[un(e)]};return i[":id"]=a.primaryKey,null!=t&&(i[un(t)]=a.primaryKey),a}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),a=s.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:s,values:i,range:o}){return new Promise(((a,c)=>{a=Je(a);const u=e.objectStore(t),l=null==u.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:f}=s||i||{length:1};if(s&&i&&s.length!==i.length)throw new Error("Given keys array must have same length as given values array.");if(0===f)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let p;const d=[],y=[];let g=0;const m=e=>{++g,Xt(e)};if("deleteRange"===n){if(4===o.type)return a({numFailures:g,failures:y,results:[],lastResult:void 0});3===o.type?d.push(p=u.clear()):d.push(p=u.delete(r(o)))}else{const[e,t]=h?l?[i,s]:[i,null]:[s,null];if(h)for(let r=0;r<f;++r)d.push(p=t&&void 0!==t[r]?u[n](e[r],t[r]):u[n](e[r])),p.onerror=m;else for(let t=0;t<f;++t)d.push(p=u[n](e[t])),p.onerror=m}const b=e=>{const t=e.target.result;d.forEach(((e,t)=>null!=e.error&&(y[t]=e.error))),a({numFailures:g,failures:y,results:"delete"===n?s:d.map((e=>e.result)),lastResult:t})};p.onerror=e=>{m(e),b(e)},p.onsuccess=b}))},getMany:({trans:e,keys:n})=>new Promise(((r,s)=>{r=Je(r);const i=e.objectStore(t),o=n.length,a=new Array(o);let c,u=0,l=0;const h=e=>{const t=e.target;a[t._pos]=t.result,++l===u&&r(a)},f=Yt(s);for(let e=0;e<o;++e)null!=n[e]&&(c=i.get(n[e]),c._pos=e,c.onsuccess=h,c.onerror=f,++u);0===u&&r(a)})),get:({trans:e,key:n})=>new Promise(((r,s)=>{r=Je(r);const i=e.objectStore(t).get(n);i.onsuccess=e=>r(e.target.result),i.onerror=Yt(s)})),query:function(e){return n=>new Promise(((s,i)=>{s=Je(s);const{trans:o,values:a,limit:c,query:u}=n,l=c===1/0?void 0:c,{index:h,range:f}=u,p=o.objectStore(t),d=h.isPrimaryKey?p:p.index(h.name),y=r(f);if(0===c)return s({result:[]});if(e){const e=a?d.getAll(y,l):d.getAllKeys(y,l);e.onsuccess=e=>s({result:e.target.result}),e.onerror=Yt(i)}else{let e=0;const t=a||!("openKeyCursor"in d)?d.openCursor(y):d.openKeyCursor(y),n=[];t.onsuccess=r=>{const i=t.result;return i?(n.push(a?i.value:i.primaryKey),++e===c?s({result:n}):void i.continue()):s({result:n})},t.onerror=Yt(i)}}))}(i),openCursor:function({trans:e,values:n,query:s,reverse:i,unique:o}){return new Promise(((a,c)=>{a=Je(a);const{index:u,range:l}=s,h=e.objectStore(t),f=u.isPrimaryKey?h:h.index(u.name),p=i?o?"prevunique":"prev":o?"nextunique":"next",d=n||!("openKeyCursor"in f)?f.openCursor(r(l),p):f.openKeyCursor(r(l),p);d.onerror=Yt(c),d.onsuccess=Je((t=>{const n=d.result;if(!n)return void a(null);n.___id=++cn,n.done=!1;const r=n.continue.bind(n);let s=n.continuePrimaryKey;s&&(s=s.bind(n));const i=n.advance.bind(n),o=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Je(c),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=Je(e),d.onerror=Yt(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=o,e(t)}})),a=()=>{if(d.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return d.onsuccess=Je((e=>{d.onsuccess=a,a()})),n.continue=r,n.continuePrimaryKey=s,n.advance=i,a(),t},a(n)}),c)}))},count({query:e,trans:n}){const{index:s,range:i}=e;return new Promise(((e,o)=>{const a=n.objectStore(t),c=s.isPrimaryKey?a:a.index(s.name),u=r(i),l=u?c.count(u):c.count();l.onsuccess=Je((t=>e(t.target.result))),l.onerror=Yt(o)}))}}}(e))),c={};return a.forEach((e=>c[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!c[e])throw new Error(`Table '${e}' not found`);return c[e]},MIN_KEY:-1/0,MAX_KEY:sn(t),schema:s}}function hn({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},s){const i=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(ln(t,n,s),e.dbcore);return{dbcore:i}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function fn({_novip:e},t,n,r){n.forEach((n=>{const s=r[n];t.forEach((t=>{const r=g(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?p(t,n,{get(){return this.table(n)},set(e){f(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,s))}))}))}function pn({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function dn(e,t){return e._cfg.version-t._cfg.version}function yn(e,t,n,r){const s=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,s);o.create(n),o._completion.catch(r);const a=o._reject.bind(o),c=Pe.transless||Pe;nt((()=>{Pe.trans=o,Pe.transless=c,0===t?(i(s).forEach((e=>{mn(n,e,s[e].primKey,s[e].indexes)})),hn(e,n),Ce.follow((()=>e.on.populate.fire(o))).catch(a)):function({_novip:e},t,n,r){const s=[],o=e._versions;let a=e._dbSchema=wn(e,e.idbdb,r),c=!1;return o.filter((e=>e._cfg.version>=t)).forEach((o=>{s.push((()=>{const s=a,u=o._cfg.dbschema;vn(e,s,r),vn(e,u,r),a=e._dbSchema=u;const l=gn(s,u);l.add.forEach((e=>{mn(r,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((e=>{if(e.recreate)throw new te.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>bn(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),bn(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const h=o._cfg.contentUpgrade;if(h&&o._cfg.version>t){hn(e,r),n._memoizedTables={},c=!0;let t=T(u);l.del.forEach((e=>{t[e]=s[e]})),pn(e,[e.Transaction.prototype]),fn(e,[e.Transaction.prototype],i(t),t),n.schema=t;const o=z(h);let a;o&&rt();const f=Ce.follow((()=>{if(a=h(n),a&&o){var e=st.bind(null,null);a.then(e,e)}}));return a&&"function"==typeof a.then?Ce.resolve(a):f.then((()=>a))}})),s.push((t=>{c&&Et||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(o._cfg.dbschema,t),pn(e,[e.Transaction.prototype]),fn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),function e(){return s.length?Ce.resolve(s.shift()(n.idbtrans)).then(e):Ce.resolve()}().then((()=>{var e,t;t=r,i(e=a).forEach((n=>{t.db.objectStoreNames.contains(n)||mn(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,o,n).catch(a)}))}function gn(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const s=e[r],i=t[r];if(s){const e={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!vt)e.recreate=!0,n.change.push(e);else{const t=s.idxByName,r=i.idxByName;let o;for(o in t)r[o]||e.del.push(o);for(o in r){const n=t[o],s=r[o];n?n.src!==s.src&&e.change.push(s):e.add.push(s)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,i])}return n}function mn(e,t,n,r){const s=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>bn(s,e))),s}function bn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function wn(e,t,n){const r={};return b(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let s=t.keyPath;const i=tn(nn(s),s||"",!1,!1,!!t.autoIncrement,s&&"string"!=typeof s,!0),o=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);s=n.keyPath;var a=tn(n.name,s,!!n.unique,!!n.multiEntry,!1,s&&"string"!=typeof s,!1);o.push(a)}r[e]=rn(e,i,o)})),r}function vn({_novip:e},t,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const i=r[s],o=n.objectStore(i);e._hasGetAll="getAll"in o;for(let e=0;e<o.indexNames.length;++e){const n=o.indexNames[e],r=o.index(n).keyPath,s="string"==typeof r?r:"["+b(r).join("+")+"]";if(t[i]){const e=t[i].idxByName[s];e&&(e.name=n,delete t[i].idxByName[s],t[i].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class En{_parseStoresSpec(e,t){i(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return tn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),o(r),0===t)})),s=r.shift();if(s.multi)throw new te.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new te.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new te.Schema("Index must have a name and cannot be an empty string")})),t[n]=rn(n,s,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,e):e;const n=t._versions,r={};let s={};return n.forEach((e=>{a(r,e._cfg.storesSource),s=e._cfg.dbschema={},e._parseStoresSpec(r,s)})),t._dbSchema=s,pn(t,[t._allTables,t,t.Transaction.prototype]),fn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],i(s),s),t._storeNames=i(s),this}upgrade(e){return this._cfg.contentUpgrade=fe(this._cfg.contentUpgrade||se,e),this}}function _n(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Hn("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function kn(e){return e&&"function"==typeof e.databases}function Sn(e){return nt((function(){return Pe.letThrough=!0,e()}))}function Tn(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function An(e){var t=t=>e.next(t),n=s(t),r=s((t=>e.throw(t)));function s(e){return t=>{var s=e(t),i=s.value;return s.done?i:i&&"function"==typeof i.then?i.then(n,r):o(i)?Promise.all(i).then(n,r):n(i)}}return s(t)()}function In(e,t,n){var r=arguments.length;if(r<2)throw new te.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];return n=s.pop(),[e,I(s),n]}function xn(e,t,n,s,i){return Ce.resolve().then((()=>{const o=Pe.transless||Pe,a=e._createTransaction(t,n,e._dbSchema,s),c={trans:a,transless:o};if(s)a.idbtrans=s.idbtrans;else try{a.create(),e._state.PR1398_maxLoop=3}catch(s){return s.name===Q.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(r.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>xn(e,t,n,null,i)))):yt(s)}const u=z(i);let l;u&&rt();const h=Ce.follow((()=>{if(l=i.call(a,a),l)if(u){var e=st.bind(null,null);l.then(e,e)}else"function"==typeof l.next&&"function"==typeof l.throw&&(l=An(l))}),c);return(l&&"function"==typeof l.then?Ce.resolve(l).then((e=>a.active?e:yt(new te.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):h.then((()=>l))).then((e=>(s&&a._resolve(),a._completion.then((()=>e))))).catch((e=>(a._reject(e),yt(e))))}))}function On(e,t,n){const r=o(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const Pn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,s={},i=[];function o(e,t,n){const r=un(e),a=s[r]=s[r]||[],c=null==e?0:"string"==typeof e?1:e.length,u=t>0,l={...n,isVirtual:u,keyTail:t,keyLength:c,extractKey:on(e),unique:!u&&n.unique};return a.push(l),l.isPrimaryKey||i.push(l),c>1&&o(2===c?e[0]:e.slice(0,c-1),t+1,n),a.sort(((e,t)=>e.keyTail-t.keyTail)),l}const a=o(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[a];for(const e of r.indexes)o(e.keyPath,0,e);function c(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,s=n.keyTail,{type:1===r.type?2:r.type,lower:On(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,s),lowerOpen:!0,upper:On(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,s),upperOpen:!0})}}:t;var r,s}const u={...n,schema:{...r,primaryKey:a,indexes:i,getIndexByKeyPath:function(e){const t=s[un(e)];return t&&t[0]}},count:e=>n.count(c(e)),query:e=>n.query(c(e)),openCursor(t){const{keyTail:r,isVirtual:s,keyLength:i}=t.query.index;return s?n.openCursor(c(t)).then((n=>n&&function(n){const s=Object.create(n,{continue:{value:function(s){null!=s?n.continue(On(s,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,i).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,s){n.continuePrimaryKey(On(t,e.MAX_KEY,r),s)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:()=>n.value}});return s}(n))):n.openCursor(t)}};return u}}}};function Rn(e,t,n,r){return n=n||{},r=r||"",i(e).forEach((s=>{if(l(t,s)){var i=e[s],o=t[s];if("object"==typeof i&&"object"==typeof o&&i&&o){const e=C(i);e!==C(o)?n[r+s]=t[s]:"Object"===e?Rn(i,o,n,r+s+"."):i!==o&&(n[r+s]=t[s])}else i!==o&&(n[r+s]=t[s])}else n[r+s]=void 0})),i(t).forEach((s=>{l(e,s)||(n[r+s]=t[s])})),n}const Nn={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,s={...n,mutate(e){const s=Pe.trans,{deleting:i,creating:o,updating:a}=s.table(t).hook;switch(e.type){case"add":if(o.fire===se)break;return s._promise("readwrite",(()=>c(e)),!0);case"put":if(o.fire===se&&a.fire===se)break;return s._promise("readwrite",(()=>c(e)),!0);case"delete":if(i.fire===se)break;return s._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(i.fire===se)break;return s._promise("readwrite",(()=>function(e){return u(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function c(e){const t=Pe.trans,s=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!s)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:s}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,s).then((c=>{const u=s.map(((n,s)=>{const u=c[s],h={onerror:null,onsuccess:null};if("delete"===e.type)i.fire.call(h,n,u,t);else if("add"===e.type||void 0===u){const i=o.fire.call(h,n,e.values[s],t);null==n&&null!=i&&(n=i,e.keys[s]=n,r.outbound||S(e.values[s],r.keyPath,n))}else{const r=Rn(u,e.values[s]),i=a.fire.call(h,r,n,u,t);if(i){const t=e.values[s];Object.keys(i).forEach((e=>{l(t,e)?t[e]=i[e]:S(t,e,i[e])}))}}return h}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:i})=>{for(let r=0;r<s.length;++r){const i=n?n[r]:s[r],o=u[r];null==i?o.onerror&&o.onerror(t[r]):o.onsuccess&&o.onsuccess("put"===e.type&&c[r]?e.values[r]:i)}return{failures:t,results:n,numFailures:r,lastResult:i}})).catch((e=>(u.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function u(e,t,s){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:s}).then((({result:n})=>c({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<s?{failures:[],numFailures:0,lastResult:void 0}:u(e,{...t,lower:n[n.length-1],lowerOpen:!0},s)))))}}};return s}})};function Dn(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let s=0,i=0;s<t.keys.length&&i<e.length;++s)0===Mt(t.keys[s],e[i])&&(r.push(n?R(t.values[s]):t.values[s]),++i);return r.length===e.length?r:null}catch(e){return null}}const Cn={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=Dn(e.keys,e.trans._cache,"clone"===e.cache);return t?Ce.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?R(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Ln(e){return!("from"in e)}const Bn=function(e,t){if(!this){const t=new Bn;return e&&"d"in e&&a(t,e),t}a(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Mn(e,t,n){const r=Mt(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Ln(e))return a(e,{from:t,to:n,d:1});const s=e.l,i=e.r;if(Mt(n,e.from)<0)return s?Mn(s,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Un(e);if(Mt(t,e.to)>0)return i?Mn(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Un(e);Mt(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),Mt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;s&&!e.l&&jn(e,s),i&&o&&jn(e,i)}function jn(e,t){Ln(t)||function e(t,{from:n,to:r,l:s,r:i}){Mn(t,n,r),s&&e(t,s),i&&e(t,i)}(e,t)}function zn(e){let t=Ln(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Mt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Mt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Un(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const t="r"===s?"l":"r",n={...e},r=e[s];e.from=r.from,e.to=r.to,e[s]=r[s],n[s]=r[t],e[t]=n,n.d=Fn(n)}e.d=Fn(e)}function Fn({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}h(Bn.prototype,{add(e){return jn(this,e),this},addKey(e){return Mn(this,e,e),this},addKeys(e){return e.forEach((e=>Mn(this,e,e))),this},[L](){return zn(this)}});const $n={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new Bn(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const s=e.table(r),{schema:a}=s,{primaryKey:c}=a,{extractKey:u,outbound:l}=c,h={...s,mutate:e=>{const i=e.trans,c=i.mutatedParts||(i.mutatedParts={}),u=e=>{const n=`idb://${t}/${r}/${e}`;return c[n]||(c[n]=new Bn)},l=u(""),h=u(":dels"),{type:f}=e;let[p,d]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const y=e.trans._cache;return s.mutate(e).then((e=>{if(o(p)){"delete"!==f&&(p=e.results),l.addKeys(p);const t=Dn(p,y);t||"add"===f||h.addKeys(p),(t||d)&&function(e,t,n,r){t.indexes.forEach((function(t){const s=e(t.name||"");function i(e){return null!=e?t.extractKey(e):null}const a=e=>t.multiEntry&&o(e)?e.forEach((e=>s.addKey(e))):s.addKey(e);(n||r).forEach(((e,t)=>{const s=n&&i(n[t]),o=r&&i(r[t]);0!==Mt(s,o)&&(null!=s&&a(s),null!=o&&a(o))}))}))}(u,a,t,d)}else if(p){const e={from:p.lower,to:p.upper};h.add(e),l.add(e)}else l.add(n),h.add(n),a.indexes.forEach((e=>u(e.name).add(n)));return e}))}},f=({query:{index:t,range:n}})=>{var r,s;return[t,new Bn(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(s=n.upper)&&void 0!==s?s:e.MAX_KEY)]},p={get:e=>[c,new Bn(e.key)],getMany:e=>[c,(new Bn).addKeys(e.keys)],count:f,query:f,openCursor:f};return i(p).forEach((e=>{h[e]=function(i){const{subscr:o}=Pe;if(o){const a=e=>{const n=`idb://${t}/${r}/${e}`;return o[n]||(o[n]=new Bn)},c=a(""),h=a(":dels"),[f,d]=p[e](i);if(a(f.name||"").add(d),!f.isPrimaryKey){if("count"!==e){const t="query"===e&&l&&i.values&&s.query({...i,values:!1});return s[e].apply(this,arguments).then((n=>{if("query"===e){if(l&&i.values)return t.then((({result:e})=>(c.addKeys(e),n)));const e=i.values?n.result.map(u):n.result;i.values?c.addKeys(e):h.addKeys(e)}else if("openCursor"===e){const e=n,t=i.values;return e&&Object.create(e,{key:{get:()=>(h.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return h.addKey(t),t}},value:{get:()=>(t&&c.addKey(e.primaryKey),e.value)}})}return n}))}h.add(n)}}return s[e].apply(this,arguments)}})),h}}}};class Hn{constructor(e,t){this._middlewares={},this.verno=0;const n=Hn.dependencies;this._options=t={addons:Hn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:s}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:se,dbReadyPromise:null,cancelOpen:se,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new Ce((e=>{i.dbReadyResolve=e})),i.openCanceller=new Ce(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=xt(this,"populate","blocked","versionchange","close",{ready:[fe,se]}),this.on.ready.subscribe=w(this.on.ready.subscribe,(e=>(t,n)=>{Hn.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Ce.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=(o=this,Ot(Ut.prototype,(function(e,t){this.db=o;let n=Tt,r=null;if(t)try{n=t()}catch(e){r=e}const s=e._ctx,i=s.table,a=i.hook.reading.fire;this._ctx={table:i,index:s.index,isPrimKey:!s.index||i.schema.primKey.keyPath&&s.index===i.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:s.or,valueMapper:a!==ie?a:null}}))),this.Table=function(e){return Ot(It.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:xt(null,{creating:[ce,se],reading:[oe,ie],updating:[le,se],deleting:[ue,se]})}))}(this),this.Transaction=function(e){return Ot(en.prototype,(function(t,n,r,s,i){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=xt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ce(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),yt(e)}))}))}(this),this.Version=function(e){return Ot(En.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Ot(Zt.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const s=e._deps.indexedDB;if(!s)throw new te.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(e,t)=>s.cmp(t,e),this._max=(e,t)=>s.cmp(e,t)>0?e:t,this._min=(e,t)=>s.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?r.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):r.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?r.warn(`Dexie.delete('${this.name}') was blocked`):r.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=sn(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),wt.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Pn),this.use(Nn),this.use($n),this.use(Cn),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new te.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new te.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(dn),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Pe.letThrough||this._vip)?e():new Ce(((e,t)=>{if(this._state.openComplete)return t(new te.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new te.DatabaseClosed);this.open().catch(se)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:t,level:null==n?10:n,name:r}),s.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?yt(t.dbOpenError):e));U&&(t.openCanceller._stackHolder=V()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const s=t.openCanceller;function o(){if(t.openCanceller!==s)throw new te.DatabaseClosed("db.open() was cancelled")}let a=t.dbReadyResolve,c=null,u=!1;return Ce.race([s,("undefined"==typeof navigator?Ce.resolve():Tn()).then((()=>new Ce(((s,a)=>{if(o(),!n)throw new te.MissingAPI;const l=e.name,h=t.autoSchema?n.open(l):n.open(l,Math.round(10*e.verno));if(!h)throw new te.MissingAPI;h.onerror=Yt(a),h.onblocked=Je(e._fireOnBlocked),h.onupgradeneeded=Je((r=>{if(c=h.transaction,t.autoSchema&&!e._options.allowEmptyDB){h.onerror=Xt,c.abort(),h.result.close();const e=n.deleteDatabase(l);e.onsuccess=e.onerror=Je((()=>{a(new te.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{c.onerror=Yt(a);var s=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;u=s<1,e._novip.idbdb=h.result,yn(e,s/10,c,a)}}),a),h.onsuccess=Je((()=>{c=null;const n=e._novip.idbdb=h.result,o=b(n.objectStoreNames);if(o.length>0)try{const s=n.transaction(1===(a=o).length?a[0]:a,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=wn(0,t,n);e._storeNames=b(t.objectStoreNames,0),fn(e,[e._allTables],i(r),r)}(e,n,s):(vn(e,e._dbSchema,s),function(e,t){const n=gn(wn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,s)||r.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),hn(e,s)}catch(e){}var a;wt.push(e),n.onversionchange=Je((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=Je((t=>{e.on("close").fire(t)})),u&&function({indexedDB:e,IDBKeyRange:t},n){!kn(e)&&"__dbnames"!==n&&_n(e,t).put({name:n}).catch(se)}(e._deps,l),s()}),a)}))))]).then((()=>(o(),t.onReadyBeingFired=[],Ce.resolve(Sn((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(fe,se);return t.onReadyBeingFired=[],Ce.resolve(Sn((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{c&&c.abort()}catch(e){}return s===t.openCanceller&&e._close(),yt(n)})).finally((()=>{t.openComplete=!0,a()}))}(this)}_close(){const e=this._state,t=wt.indexOf(this);if(t>=0&&wt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Ce((t=>{e.dbReadyResolve=t})),e.openCanceller=new Ce(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new te.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Ce(((n,r)=>{const s=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=Je((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!kn(e)&&"__dbnames"!==n&&_n(e,t).delete(n).catch(se)}(this._deps,this.name),n()})),e.onerror=Yt(r),e.onblocked=this._fireOnBlocked};if(e)throw new te.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(s):s()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return i(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=In.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=Pe.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const s=-1!==e.indexOf("?");let i,o;e=e.replace("!","").replace("?","");try{if(o=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)i="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new te.InvalidArgument("Invalid transaction mode: "+e);i="readwrite"}if(r){if("readonly"===r.mode&&"readwrite"===i){if(!s)throw new te.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!s)throw new te.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),s&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):yt(e)}const a=xn.bind(null,this,i,o,r,n);return r?r._promise(i,a,"lock"):Pe.trans?lt(Pe.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(e){if(!l(this._allTables,e))throw new te.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Vn="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Kn{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[Vn](){return this}}function qn(e,t){return i(t).forEach((n=>{jn(e[n]||(e[n]=new Bn),t[n])})),e}let Wn;try{Wn={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch(s){Wn={indexedDB:null,IDBKeyRange:null}}const Gn=Hn;function Jn(e){let t=Zn;try{Zn=!0,Qt.storagemutated.fire(e)}finally{Zn=t}}h(Gn,{...re,delete:e=>new Gn(e,{addons:[]}).delete(),exists:e=>new Gn(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return kn(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):_n(e,t).toCollection().primaryKeys()}(Gn.dependencies).then(e)}catch(e){return yt(new te.MissingAPI)}},defineClass:()=>function(e){a(this,e)},ignoreTransaction:e=>Pe.trans?lt(Pe.transless,e):e(),vip:Sn,async:function(e){return function(){try{var t=An(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ce.resolve(t)}catch(e){return yt(e)}}},spawn:function(e,t,n){try{var r=An(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ce.resolve(r)}catch(e){return yt(e)}},currentTransaction:{get:()=>Pe.trans||null},waitFor:function(e,t){const n=Ce.resolve("function"==typeof e?Gn.ignoreTransaction(e):e).timeout(t||6e4);return Pe.trans?Pe.trans.waitFor(n):n},Promise:Ce,debug:{get:()=>U,set:e=>{F(e,"dexie"===e?()=>!0:kt)}},derive:d,extend:a,props:h,override:w,Events:xt,on:Qt,liveQuery:function(e){return new Kn((t=>{const n=z(e);let r=!1,s={},o={};const a={get closed(){return r},unsubscribe:()=>{r=!0,Qt.storagemutated.unsubscribe(h)}};t.start&&t.start(a);let c=!1,u=!1;function l(){return i(o).some((e=>s[e]&&function(e,t){const n=zn(t);let r=n.next();if(r.done)return!1;let s=r.value;const i=zn(e);let o=i.next(s.from),a=o.value;for(;!r.done&&!o.done;){if(Mt(a.from,s.to)<=0&&Mt(a.to,s.from)>=0)return!0;Mt(s.from,a.from)<0?s=(r=n.next(a.from)).value:a=(o=i.next(s.from)).value}return!1}(s[e],o[e])))}const h=e=>{qn(s,e),l()&&f()},f=()=>{if(c||r)return;s={};const i={},p=function(t){n&&rt();const r=()=>nt(e,{subscr:t,trans:null}),s=Pe.trans?lt(Pe.transless,r):r();return n&&s.then(st,st),s}(i);u||(Qt("storagemutated",h),u=!0),c=!0,Promise.resolve(p).then((e=>{c=!1,r||(l()?f():(s={},o=i,t.next&&t.next(e)))}),(e=>{c=!1,t.error&&t.error(e),a.unsubscribe()}))};return f(),a}))},extendObservabilitySet:qn,getByKeyPath:k,setByKeyPath:S,delByKeyPath:function(e,t){"string"==typeof t?S(e,t,void 0):"length"in t&&[].map.call(t,(function(t){S(e,t,void 0)}))},shallowClone:T,deepClone:R,getObjectDiff:Rn,cmp:Mt,asap:E,minKey:-1/0,addons:[],connections:wt,errnames:Q,dependencies:Wn,semVer:"3.2.3",version:"3.2.3".split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),Gn.maxKey=sn(Gn.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Qt("storagemutated",(e=>{if(!Zn){let t;vt?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Zn=!0,dispatchEvent(t),Zn=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{Zn||Jn(e)})));let Zn=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");"function"==typeof e.unref&&e.unref(),Qt("storagemutated",(t=>{Zn||e.postMessage(t)})),e.onmessage=e=>{e.data&&Jn(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Qt("storagemutated",(e=>{try{Zn||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&Jn(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&Jn(e.changedParts)}))}Ce.rejectionMapper=function(e,t){if(!e||e instanceof J||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ne[e.name])return e;var n=new ne[e.name](t||e.message,e);return"stack"in e&&p(n,"stack",{get:function(){return this.inner.stack}}),n},F(U,kt)},26905:function(e){e.exports=function(e,t,n,r,s){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:s;return e===s?n:e}},32114:function(e){"use strict";function t(e,t){for(const n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}e.exports=function(e,n,r){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof n&&(r=n,n=""),n&&(r.code=n);try{return t(e,r)}catch(n){r.message=e.message,r.stack=e.stack;const s=function(){};s.prototype=Object.create(Object.getPrototypeOf(e));return t(new s,r)}}},8091:function(e){"use strict";function t(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),r=1;r<arguments.length;r++){var s=arguments[r];if(null!=s)for(var i=Object.keys(Object(s)),o=0,a=i.length;o<a;o++){var c=i[o],u=Object.getOwnPropertyDescriptor(s,c);void 0!==u&&u.enumerable&&(n[c]=s[c])}}return n}e.exports={assign:t,polyfill:function(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:t})}}},90507:function(e,t,n){"use strict";const r=n(8231);t.zN=r.EventIterator,r.EventIterator},8231:function(e,t,n){"use strict";var r=n(25108);Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():r&&r.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch((()=>{})),this.pushQueue.push(t)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((e,t)=>{this.pullQueue.push({resolve:e,reject:t})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class i{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const r=new s;r.highWaterMark=t,r.lowWaterMark=n,r.removeCallback=e({push:e=>r.push(e),stop:()=>r.stop(),fail:e=>r.fail(e),on:(e,t)=>{r.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>r[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=i,t.default=i},17187:function(e,t,n){"use strict";var r,s=n(25108),i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,e.exports.once=function(e,t){return new Promise((function(n,r){function s(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),n([].slice.call(arguments))}b(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&b(e,"error",t,n)}(e,s,{once:!0})}))},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function f(e,t,n,r){var i,o,a,c;if(l(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=h(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,c=u,s&&s.warn&&s.warn(c)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},s=p.bind(r);return s.listener=n,r.wrapFn=s,s}function y(e,t,n){var r=e._events;if(void 0===r)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?n?[s.listener||s]:[s]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(s):m(s,s.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function b(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){r.once&&e.removeEventListener(t,s),n(i)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,l=m(c,u);for(n=0;n<u;++n)o(l[n],this,t)}return!0},c.prototype.addListener=function(e,t){return f(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return f(this,e,t,!0)},c.prototype.once=function(e,t){return l(t),this.on(e,d(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,d(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,r,s,i,o;if(l(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(s=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,s=i;break}if(s<0)return this;0===s?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,s),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var s,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(s=i[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},c.prototype.listeners=function(e){return y(this,e,!0)},c.prototype.rawListeners=function(e){return y(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},c.prototype.listenerCount=g,c.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},72445:function(e){"use strict";e.exports=function(e){var t=e.uri,n=e.name,r=e.type;this.uri=t,this.name=n,this.type=r}},40804:function(e,t,n){"use strict";var r=n(51268);e.exports=function e(t,n,s){var i;void 0===n&&(n=""),void 0===s&&(s=r);var o=new Map;function a(e,t){var n=o.get(t);n?n.push.apply(n,e):o.set(t,e)}if(s(t))i=null,a([n],t);else{var c=n?n+".":"";if("undefined"!=typeof FileList&&t instanceof FileList)i=Array.prototype.map.call(t,(function(e,t){return a([""+c+t],e),null}));else if(Array.isArray(t))i=t.map((function(t,n){var r=e(t,""+c+n,s);return r.files.forEach(a),r.clone}));else if(t&&t.constructor===Object)for(var u in i={},t){var l=e(t[u],""+c+u,s);l.files.forEach(a),i[u]=l.clone}else i=t}return{clone:i,files:o}}},51268:function(e,t,n){"use strict";var r=n(72445);e.exports=function(e){return"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Blob&&e instanceof Blob||e instanceof r}},3975:function(e){e.exports=class{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},91607:function(e,t,n){const r=n(3975);e.exports=class{constructor(e){this.hwm=e||16,this.head=new r(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new r(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},16932:function(e,t,n){"use strict";const r=n(78501),s=n(58844),i=n(41192);e.exports={XMLParser:s,XMLValidator:r,XMLBuilder:i}},17849:function(e,t){"use strict";const n=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r="["+n+"]["+(n+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",s=new RegExp("^"+r+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,n){if(t){const r=Object.keys(t),s=r.length;for(let i=0;i<s;i++)e[r[i]]="strict"===n?[t[r[i]]]:t[r[i]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){const t=s.exec(e);return!(null==t)},t.getAllMatches=function(e,t){const n=[];let r=t.exec(e);for(;r;){const s=[];s.startIndex=t.lastIndex-r[0].length;const i=r.length;for(let e=0;e<i;e++)s.push(r[e]);n.push(s),r=t.exec(e)}return n},t.nameRegexp=r},78501:function(e,t,n){"use strict";const r=n(17849),s={allowBooleanAttributes:!1,unpairedTags:[]};function i(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function o(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const r=e.substr(n,t-n);if(t>5&&"xml"===r)return d("InvalidXml","XML declaration allowed only at the start of the document.",g(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function a(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},s,t);const n=[];let c=!1,u=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let s=0;s<e.length;s++)if("<"===e[s]&&"?"===e[s+1]){if(s+=2,s=o(e,s),s.err)return s}else{if("<"!==e[s]){if(i(e[s]))continue;return d("InvalidChar","char '"+e[s]+"' is not expected.",g(e,s))}{let y=s;if(s++,"!"===e[s]){s=a(e,s);continue}{let m=!1;"/"===e[s]&&(m=!0,s++);let b="";for(;s<e.length&&">"!==e[s]&&" "!==e[s]&&"\t"!==e[s]&&"\n"!==e[s]&&"\r"!==e[s];s++)b+=e[s];if(b=b.trim(),"/"===b[b.length-1]&&(b=b.substring(0,b.length-1),s--),h=b,!r.isName(h)){let t;return t=0===b.trim().length?"Invalid space after '<'.":"Tag '"+b+"' is an invalid name.",d("InvalidTag",t,g(e,s))}const w=l(e,s);if(!1===w)return d("InvalidAttr","Attributes for '"+b+"' have open quote.",g(e,s));let v=w.value;if(s=w.index,"/"===v[v.length-1]){const n=s-v.length;v=v.substring(0,v.length-1);const r=f(v,t);if(!0!==r)return d(r.err.code,r.err.msg,g(e,n+r.err.line));c=!0}else if(m){if(!w.tagClosed)return d("InvalidTag","Closing tag '"+b+"' doesn't have proper closing.",g(e,s));if(v.trim().length>0)return d("InvalidTag","Closing tag '"+b+"' can't have attributes or invalid starting.",g(e,y));{const t=n.pop();if(b!==t.tagName){let n=g(e,t.tagStartPos);return d("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+b+"'.",g(e,y))}0==n.length&&(u=!0)}}else{const r=f(v,t);if(!0!==r)return d(r.err.code,r.err.msg,g(e,s-v.length+r.err.line));if(!0===u)return d("InvalidXml","Multiple possible root nodes found.",g(e,s));-1!==t.unpairedTags.indexOf(b)||n.push({tagName:b,tagStartPos:y}),c=!0}for(s++;s<e.length;s++)if("<"===e[s]){if("!"===e[s+1]){s++,s=a(e,s);continue}if("?"!==e[s+1])break;if(s=o(e,++s),s.err)return s}else if("&"===e[s]){const t=p(e,s);if(-1==t)return d("InvalidChar","char '&' is not expected.",g(e,s));s=t}else if(!0===u&&!i(e[s]))return d("InvalidXml","Extra text at the end",g(e,s));"<"===e[s]&&s--}}}var h;return c?1==n.length?d("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",g(e,n[0].tagStartPos)):!(n.length>0)||d("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):d("InvalidXml","Start tag expected.",1)};const c='"',u="'";function l(e,t){let n="",r="",s=!1;for(;t<e.length;t++){if(e[t]===c||e[t]===u)""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){s=!0;break}n+=e[t]}return""===r&&{value:n,index:t,tagClosed:s}}const h=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function f(e,t){const n=r.getAllMatches(e,h),s={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return d("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",m(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return d("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",m(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return d("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",m(n[e]));const r=n[e][2];if(!y(r))return d("InvalidAttr","Attribute '"+r+"' is an invalid name.",m(n[e]));if(s.hasOwnProperty(r))return d("InvalidAttr","Attribute '"+r+"' is repeated.",m(n[e]));s[r]=1}return!0}function p(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function d(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function y(e){return r.isName(e)}function g(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function m(e){return e.startIndex+e[1].length}},41192:function(e,t,n){"use strict";const r=n(82592),s={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(e){this.options=Object.assign({},s,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=c),this.processTextOrObjNode=o,this.options.format?(this.indentate=a,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function o(e,t,n){const r=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,r.attrStr,n):this.buildObjectNode(r.val,t,r.attrStr,n)}function a(e){return this.options.indentBy.repeat(e)}function c(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}i.prototype.build=function(e){return this.options.preserveOrder?r(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},i.prototype.j2x=function(e,t){let n="",r="";for(let s in e)if(void 0===e[s]);else if(null===e[s])"?"===s[0]?r+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)r+=this.buildTextValNode(e[s],s,"",t);else if("object"!=typeof e[s]){const i=this.isAttribute(s);if(i)n+=this.buildAttrPairStr(i,""+e[s]);else if(s===this.options.textNodeName){let t=this.options.tagValueProcessor(s,""+e[s]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextValNode(e[s],s,"",t)}else if(Array.isArray(e[s])){const n=e[s].length;let i="";for(let o=0;o<n;o++){const n=e[s][o];void 0===n||(null===n?"?"===s[0]?r+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+s+"/"+this.tagEndChar:"object"==typeof n?this.options.oneListGroup?i+=this.j2x(n,t+1).val:i+=this.processTextOrObjNode(n,s,t):i+=this.buildTextValNode(n,s,"",t))}this.options.oneListGroup&&(i=this.buildObjectNode(i,s,"",t)),r+=i}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const t=Object.keys(e[s]),r=t.length;for(let i=0;i<r;i++)n+=this.buildAttrPairStr(t[i],""+e[s][t[i]])}else r+=this.processTextOrObjNode(e[s],s,t);return{attrStr:n,val:r}},i.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},i.prototype.buildObjectNode=function(e,t,n,r){if(""===e)return"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,i="";return"?"===t[0]&&(i="?",s=""),n&&-1===e.indexOf("<")?this.indentate(r)+"<"+t+n+i+">"+e+s:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===i.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+n+i+this.tagEndChar+e+this.indentate(r)+s}},i.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},i.prototype.buildTextValNode=function(e,t,n,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(r)+"<"+t+n+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),""===s?this.indentate(r)+"<"+t+n+this.closeTag(t)+this.tagEndChar:this.indentate(r)+"<"+t+n+">"+s+"</"+t+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e},e.exports=i},82592:function(e){function t(e,o,a,c){let u="",l=!1;for(let h=0;h<e.length;h++){const f=e[h],p=n(f);let d="";if(d=0===a.length?p:`${a}.${p}`,p===o.textNodeName){let e=f[p];s(d,o)||(e=o.tagValueProcessor(p,e),e=i(e,o)),l&&(u+=c),u+=e,l=!1;continue}if(p===o.cdataPropName){l&&(u+=c),u+=`<![CDATA[${f[p][0][o.textNodeName]}]]>`,l=!1;continue}if(p===o.commentPropName){u+=c+`\x3c!--${f[p][0][o.textNodeName]}--\x3e`,l=!0;continue}if("?"===p[0]){const e=r(f[":@"],o),t="?xml"===p?"":c;let n=f[p][0][o.textNodeName];n=0!==n.length?" "+n:"",u+=t+`<${p}${n}${e}?>`,l=!0;continue}let y=c;""!==y&&(y+=o.indentBy);const g=c+`<${p}${r(f[":@"],o)}`,m=t(f[p],o,d,y);-1!==o.unpairedTags.indexOf(p)?o.suppressUnpairedNode?u+=g+">":u+=g+"/>":m&&0!==m.length||!o.suppressEmptyNode?m&&m.endsWith(">")?u+=g+`>${m}${c}</${p}>`:(u+=g+">",m&&""!==c&&(m.includes("/>")||m.includes("</"))?u+=c+o.indentBy+m+c:u+=m,u+=`</${p}>`):u+=g+"/>",l=!0}return u}function n(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function r(e,t){let n="";if(e&&!t.ignoreAttributes)for(let r in e){let s=t.attributeValueProcessor(r,e[r]);s=i(s,t),!0===s&&t.suppressBooleanAttributes?n+=` ${r.substr(t.attributeNamePrefix.length)}`:n+=` ${r.substr(t.attributeNamePrefix.length)}="${s}"`}return n}function s(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+n)return!0;return!1}function i(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const r=t.entities[n];e=e.replace(r.regex,r.val)}return e}e.exports=function(e,n){let r="";return n.format&&n.indentBy.length>0&&(r="\n"),t(e,n,"",r)}},74780:function(e,t,n){const r=n(17849);function s(e,t){let n="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)n+=e[t];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const r=e[t++];let s="";for(;t<e.length&&e[t]!==r;t++)s+=e[t];return[n,s,t]}function i(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function o(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function a(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function c(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function u(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function l(e){if(r.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}e.exports=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,h=!1,f=!1,p="";for(;t<e.length;t++)if("<"!==e[t]||f)if(">"===e[t]){if(f?"-"===e[t-1]&&"-"===e[t-2]&&(f=!1,r--):r--,0===r)break}else"["===e[t]?h=!0:p+=e[t];else{if(h&&o(e,t))t+=7,[entityName,val,t]=s(e,t+1),-1===val.indexOf("&")&&(n[l(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(h&&a(e,t))t+=8;else if(h&&c(e,t))t+=8;else if(h&&u(e,t))t+=9;else{if(!i)throw new Error("Invalid DOCTYPE");f=!0}r++,p=""}if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}}},66745:function(e,t){const n={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e}};t.buildOptions=function(e){return Object.assign({},n,e)},t.defaultOptions=n},81078:function(e,t,n){"use strict";const r=n(17849),s=n(36311),i=n(74780),o=n(14153);"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,r.nameRegexp);function a(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function c(e,t,n,r,s,i,o){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,n,s,i);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return v(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?v(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function u(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const l=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function h(e,t,n){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=r.getAllMatches(e,l),s=n.length,i={};for(let e=0;e<s;e++){const r=this.resolveNameSpace(n[e][1]);let s=n[e][4],o=this.options.attributeNamePrefix+r;if(r.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),"__proto__"===o&&(o="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(r,s,t);i[o]=null==e?s:typeof e!=typeof s||e!==s?e:v(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[o]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=i,e}return i}}const f=function(e){e=e.replace(/\r\n?/g,"\n");const t=new s("!xml");let n=t,r="",o="";for(let a=0;a<e.length;a++){if("<"===e[a])if("/"===e[a+1]){const t=m(e,">",a,"Closing Tag is not closed.");let s=e.substring(a+2,t).trim();if(this.options.removeNSPrefix){const e=s.indexOf(":");-1!==e&&(s=s.substr(e+1))}this.options.transformTagName&&(s=this.options.transformTagName(s)),n&&(r=this.saveTextToParentTag(r,n,o));const i=o.substring(o.lastIndexOf(".")+1);if(s&&-1!==this.options.unpairedTags.indexOf(s))throw new Error(`Unpaired tag can not be used as closing tag: </${s}>`);let c=0;i&&-1!==this.options.unpairedTags.indexOf(i)?(c=o.lastIndexOf(".",o.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=o.lastIndexOf("."),o=o.substring(0,c),n=this.tagsNodeStack.pop(),r="",a=t}else if("?"===e[a+1]){let t=b(e,a,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,o),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new s(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,o,t.tagName)),this.addChild(n,e,o)}a=t.closeIndex+1}else if("!--"===e.substr(a+1,3)){const t=m(e,"--\x3e",a+4,"Comment is not closed.");if(this.options.commentPropName){const s=e.substring(a+4,t-2);r=this.saveTextToParentTag(r,n,o),n.add(this.options.commentPropName,[{[this.options.textNodeName]:s}])}a=t}else if("!D"===e.substr(a+1,2)){const t=i(e,a);this.docTypeEntities=t.entities,a=t.i}else if("!["===e.substr(a+1,2)){const t=m(e,"]]>",a,"CDATA is not closed.")-2,s=e.substring(a+9,t);if(r=this.saveTextToParentTag(r,n,o),this.options.cdataPropName)n.add(this.options.cdataPropName,[{[this.options.textNodeName]:s}]);else{let e=this.parseTextData(s,n.tagname,o,!0,!1,!0);null==e&&(e=""),n.add(this.options.textNodeName,e)}a=t+2}else{let i=b(e,a,this.options.removeNSPrefix),c=i.tagName,u=i.tagExp,l=i.attrExpPresent,h=i.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),n&&r&&"!xml"!==n.tagname&&(r=this.saveTextToParentTag(r,n,o,!1));const f=n;if(f&&-1!==this.options.unpairedTags.indexOf(f.tagname)&&(n=this.tagsNodeStack.pop(),o=o.substring(0,o.lastIndexOf("."))),c!==t.tagname&&(o+=o?"."+c:c),this.isItStopNode(this.options.stopNodes,o,c)){let t="";if(u.length>0&&u.lastIndexOf("/")===u.length-1)a=i.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(c))a=i.closeIndex;else{const n=this.readStopNodeData(e,c,h+1);if(!n)throw new Error(`Unexpected end of ${c}`);a=n.i,t=n.tagContent}const r=new s(c);c!==u&&l&&(r[":@"]=this.buildAttributesMap(u,o,c)),t&&(t=this.parseTextData(t,c,o,!0,l,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),r.add(this.options.textNodeName,t),this.addChild(n,r,o)}else{if(u.length>0&&u.lastIndexOf("/")===u.length-1){"/"===c[c.length-1]?(c=c.substr(0,c.length-1),u=c):u=u.substr(0,u.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));const e=new s(c);c!==u&&l&&(e[":@"]=this.buildAttributesMap(u,o,c)),this.addChild(n,e,o),o=o.substr(0,o.lastIndexOf("."))}else{const e=new s(c);this.tagsNodeStack.push(n),c!==u&&l&&(e[":@"]=this.buildAttributesMap(u,o,c)),this.addChild(n,e,o),n=e}r="",a=h}}else r+=e[a]}return t.child};function p(e,t,n){const r=this.options.updateTag(t.tagname,n,t[":@"]);!1===r||("string"==typeof r?(t.tagname=r,e.addChild(t)):e.addChild(t))}const d=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function y(e,t,n,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function g(e,t,n){const r="*."+n;for(const n in e){const s=e[n];if(r===s||t===s)return!0}return!1}function m(e,t,n,r){const s=e.indexOf(t,n);if(-1===s)throw new Error(r);return s+t.length-1}function b(e,t,n,r=">"){const s=function(e,t,n=">"){let r,s="";for(let i=t;i<e.length;i++){let t=e[i];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===n[0]){if(!n[1])return{data:s,index:i};if(e[i+1]===n[1])return{data:s,index:i}}else"\t"===t&&(t=" ");s+=t}}(e,t+1,r);if(!s)return;let i=s.data;const o=s.index,a=i.search(/\s/);let c=i,u=!0;if(-1!==a&&(c=i.substr(0,a).replace(/\s\s*$/,""),i=i.substr(a+1)),n){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),u=c!==s.data.substr(e+1))}return{tagName:c,tagExp:i,closeIndex:o,attrExpPresent:u}}function w(e,t,n){const r=n;let s=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const i=m(e,">",n,`${t} is not closed`);if(e.substring(n+2,i).trim()===t&&(s--,0===s))return{tagContent:e.substring(r,n),i:i};n=i}else if("?"===e[n+1]){n=m(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=m(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=m(e,"]]>",n,"StopNode is not closed.")-2}else{const r=b(e,n,">");if(r){(r&&r.tagName)===t&&"/"!==r.tagExp[r.tagExp.length-1]&&s++,n=r.closeIndex}}}function v(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&o(e,n)}return r.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""}},this.addExternalEntities=a,this.parseXml=f,this.parseTextData=c,this.resolveNameSpace=u,this.buildAttributesMap=h,this.isItStopNode=g,this.replaceEntitiesValue=d,this.readStopNodeData=w,this.saveTextToParentTag=y,this.addChild=p}}},58844:function(e,t,n){const{buildOptions:r}=n(66745),s=n(81078),{prettify:i}=n(16997),o=n(78501);e.exports=class{constructor(e){this.externalEntities={},this.options=r(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=o.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new s(this.options);n.addExternalEntities(this.externalEntities);const r=n.parseXml(e);return this.options.preserveOrder||void 0===r?r:i(r,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}},16997:function(e,t){"use strict";function n(e,t,o){let a;const c={};for(let u=0;u<e.length;u++){const l=e[u],h=r(l);let f="";if(f=void 0===o?h:o+"."+h,h===t.textNodeName)void 0===a?a=l[h]:a+=""+l[h];else{if(void 0===h)continue;if(l[h]){let e=n(l[h],t,f);const r=i(e,t);l[":@"]?s(e,l[":@"],f,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==c[h]&&c.hasOwnProperty(h)?(Array.isArray(c[h])||(c[h]=[c[h]]),c[h].push(e)):t.isArray(h,f,r)?c[h]=[e]:c[h]=e}}}return"string"==typeof a?a.length>0&&(c[t.textNodeName]=a):void 0!==a&&(c[t.textNodeName]=a),c}function r(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function s(e,t,n,r){if(t){const s=Object.keys(t),i=s.length;for(let o=0;o<i;o++){const i=s[o];r.isArray(i,n+"."+i,!0,!0)?e[i]=[t[i]]:e[i]=t[i]}}}function i(e,t){const{textNodeName:n}=t,r=Object.keys(e).length;return 0===r||!(1!==r||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}t.prettify=function(e,t){return n(e,t)}},36311:function(e){"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},96132:function(e,t){"use strict";function n(e,t=n.BASE){const r=e.length;for(let n=0;n<r;n++)t^=e.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}Object.defineProperty(t,"__esModule",{value:!0}),n.BASE=2166136261,t.default=n,e.exports=n},94029:function(e,t,n){"use strict";var r=n(95320),s=Object.prototype.toString,i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){if(!r(t))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=n),"[object Array]"===s.call(e)?function(e,t,n){for(var r=0,s=e.length;r<s;r++)i.call(e,r)&&(null==n?t(e[r],r,e):t.call(n,e[r],r,e))}(e,t,o):"string"==typeof e?function(e,t,n){for(var r=0,s=e.length;r<s;r++)null==n?t(e.charAt(r),r,e):t.call(n,e.charAt(r),r,e)}(e,t,o):function(e,t,n){for(var r in e)i.call(e,r)&&(null==n?t(e[r],r,e):t.call(n,e[r],r,e))}(e,t,o)}},17648:function(e){"use strict";var t=Array.prototype.slice,n=Object.prototype.toString;e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==n.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var s,i=t.call(arguments,1),o=Math.max(0,r.length-i.length),a=[],c=0;c<o;c++)a.push("$"+c);if(s=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var n=r.apply(this,i.concat(t.call(arguments)));return Object(n)===n?n:this}return r.apply(e,i.concat(t.call(arguments)))})),r.prototype){var u=function(){};u.prototype=r.prototype,s.prototype=new u,u.prototype=null}return s}},58612:function(e,t,n){"use strict";var r=n(17648);e.exports=Function.prototype.bind||r},40210:function(e,t,n){"use strict";var r,s=SyntaxError,i=Function,o=TypeError,a=function(e){try{return i('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var u=function(){throw new o},l=c?function(){try{return u}catch(e){try{return c(arguments,"callee").get}catch(e){return u}}}():u,h=n(41405)(),f=Object.getPrototypeOf||function(e){return e.__proto__},p={},d="undefined"==typeof Uint8Array?r:f(Uint8Array),y={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?f(f([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?f(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":s,"%ThrowTypeError%":l,"%TypedArray%":d,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};try{null.error}catch(e){var g=f(f(e));y["%Error.prototype%"]=g}var m=function e(t){var n;if("%AsyncFunction%"===t)n=a("async function () {}");else if("%GeneratorFunction%"===t)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=a("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var s=e("%AsyncGenerator%");s&&(n=f(s.prototype))}return y[t]=n,n},b={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=n(58612),v=n(17642),E=w.call(Function.call,Array.prototype.concat),_=w.call(Function.apply,Array.prototype.splice),k=w.call(Function.call,String.prototype.replace),S=w.call(Function.call,String.prototype.slice),T=w.call(Function.call,RegExp.prototype.exec),A=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I=/\\(\\)?/g,x=function(e,t){var n,r=e;if(v(b,r)&&(r="%"+(n=b[r])[0]+"%"),v(y,r)){var i=y[r];if(i===p&&(i=m(r)),void 0===i&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new s("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===T(/^%?[^%]*%?$/,e))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=S(e,0,1),n=S(e,-1);if("%"===t&&"%"!==n)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new s("invalid intrinsic syntax, expected opening `%`");var r=[];return k(e,A,(function(e,t,n,s){r[r.length]=n?k(s,I,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",i=x("%"+r+"%",t),a=i.name,u=i.value,l=!1,h=i.alias;h&&(r=h[0],_(n,E([0,1],h)));for(var f=1,p=!0;f<n.length;f+=1){var d=n[f],g=S(d,0,1),m=S(d,-1);if(('"'===g||"'"===g||"`"===g||'"'===m||"'"===m||"`"===m)&&g!==m)throw new s("property names with quotes must have matching quotes");if("constructor"!==d&&p||(l=!0),v(y,a="%"+(r+="."+d)+"%"))u=y[a];else if(null!=u){if(!(d in u)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&f+1>=n.length){var b=c(u,d);u=(p=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:u[d]}else p=v(u,d),u=u[d];p&&!l&&(y[a]=u)}}return u}},27296:function(e,t,n){"use strict";var r=n(40210)("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(e){r=null}e.exports=r},53458:function(e){e.exports="object"==typeof self?self.FormData:window.FormData},31230:function(e,t,n){"use strict";var r=n(70655),s=n(25202),i=n(25108),o=new Map,a=new Map,c=!0,u=!1;function l(e){return e.replace(/[\s,]+/g," ").trim()}function h(e){var t=new Set,n=[];return e.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var r=e.name.value,s=l((u=e.loc).source.body.substring(u.start,u.end)),o=a.get(r);o&&!o.has(s)?c&&i.warn("Warning: fragment with name "+r+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):o||a.set(r,o=new Set),o.add(s),t.has(s)||(t.add(s),n.push(e))}else n.push(e);var u})),(0,r.pi)((0,r.pi)({},e),{definitions:n})}function f(e){var t=l(e);if(!o.has(t)){var n=(0,s.Qc)(e,{experimentalFragmentVariables:u,allowLegacyFragmentVariables:u});if(!n||"Document"!==n.kind)throw new Error("Not a valid GraphQL document.");o.set(t,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(n){var r=e[n];r&&"object"==typeof r&&t.add(r)}))}));var n=e.loc;return n&&(delete n.startToken,delete n.endToken),e}(h(n)))}return o.get(t)}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];"string"==typeof e&&(e=[e]);var r=e[0];return t.forEach((function(t,n){t&&"Document"===t.kind?r+=t.loc.source.body:r+=t,r+=e[n+1]})),f(r)}var d,y=p,g=function(){o.clear(),a.clear()},m=function(){c=!1},b=function(){u=!0},w=function(){u=!1};(d=p||(p={})).gql=y,d.resetCaches=g,d.disableFragmentWarnings=m,d.enableExperimentalFragmentVariables=b,d.disableExperimentalFragmentVariables=w,p.default=p,t.ZP=p},53767:function(e,t,n){"use strict";function r(e,t){if(!Boolean(e))throw new Error(t)}n.d(t,{a:function(){return r}})},6589:function(e,t,n){"use strict";n.d(t,{X:function(){return i}});const r=10,s=2;function i(e){return o(e,[])}function o(e,t){switch(typeof e){case"string":return JSON.stringify(e);case"function":return e.name?`[function ${e.name}]`:"[function]";case"object":return function(e,t){if(null===e)return"null";if(t.includes(e))return"[Circular]";const n=[...t,e];if(function(e){return"function"==typeof e.toJSON}(e)){const t=e.toJSON();if(t!==e)return"string"==typeof t?t:o(t,n)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>s)return"[Array]";const n=Math.min(r,e.length),i=e.length-n,a=[];for(let r=0;r<n;++r)a.push(o(e[r],t));1===i?a.push("... 1 more item"):i>1&&a.push(`... ${i} more items`);return"["+a.join(", ")+"]"}(e,n);return function(e,t){const n=Object.entries(e);if(0===n.length)return"{}";if(t.length>s)return"["+function(e){const t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){const t=e.constructor.name;if("string"==typeof t&&""!==t)return t}return t}(e)+"]";const r=n.map((([e,n])=>e+": "+o(n,t)));return"{ "+r.join(", ")+" }"}(e,n)}(e,t);default:return String(e)}}},39504:function(e,t,n){"use strict";n.d(t,{UG:function(){return a},WU:function(){return s},Ye:function(){return r},h8:function(){return i},ku:function(){return c}});class r{constructor(e,t,n){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=n}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class s{constructor(e,t,n,r,s,i){this.kind=e,this.start=t,this.end=n,this.line=r,this.column=s,this.value=i,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const i={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},o=new Set(Object.keys(i));function a(e){const t=null==e?void 0:e.kind;return"string"==typeof t&&o.has(t)}var c;!function(e){e.QUERY="query",e.MUTATION="mutation",e.SUBSCRIPTION="subscription"}(c||(c={}))},95389:function(e,t,n){"use strict";n.d(t,{LZ:function(){return o},wv:function(){return s}});var r=n(91022);function s(e){var t;let n=Number.MAX_SAFE_INTEGER,r=null,s=-1;for(let t=0;t<e.length;++t){var o;const a=e[t],c=i(a);c!==a.length&&(r=null!==(o=r)&&void 0!==o?o:t,s=t,0!==t&&c<n&&(n=c))}return e.map(((e,t)=>0===t?e:e.slice(n))).slice(null!==(t=r)&&void 0!==t?t:0,s+1)}function i(e){let t=0;for(;t<e.length&&(0,r.FD)(e.charCodeAt(t));)++t;return t}function o(e,t){const n=e.replace(/"""/g,'\\"""'),s=n.split(/\r\n|[\n\r]/g),i=1===s.length,o=s.length>1&&s.slice(1).every((e=>0===e.length||(0,r.FD)(e.charCodeAt(0)))),a=n.endsWith('\\"""'),c=e.endsWith('"')&&!a,u=e.endsWith("\\"),l=c||u,h=!(null!=t&&t.minimize)&&(!i||e.length>70||l||o||a);let f="";const p=i&&(0,r.FD)(e.charCodeAt(0));return(h&&!p||o)&&(f+="\n"),f+=n,(h||l)&&(f+="\n"),'"""'+f+'"""'}},91022:function(e,t,n){"use strict";function r(e){return 9===e||32===e}function s(e){return e>=48&&e<=57}function i(e){return e>=97&&e<=122||e>=65&&e<=90}function o(e){return i(e)||95===e}function a(e){return i(e)||s(e)||95===e}n.d(t,{FD:function(){return r},HQ:function(){return a},LQ:function(){return o},X1:function(){return s}})},6450:function(e,t,n){"use strict";var r;n.d(t,{h:function(){return r}}),function(e){e.NAME="Name",e.DOCUMENT="Document",e.OPERATION_DEFINITION="OperationDefinition",e.VARIABLE_DEFINITION="VariableDefinition",e.SELECTION_SET="SelectionSet",e.FIELD="Field",e.ARGUMENT="Argument",e.FRAGMENT_SPREAD="FragmentSpread",e.INLINE_FRAGMENT="InlineFragment",e.FRAGMENT_DEFINITION="FragmentDefinition",e.VARIABLE="Variable",e.INT="IntValue",e.FLOAT="FloatValue",e.STRING="StringValue",e.BOOLEAN="BooleanValue",e.NULL="NullValue",e.ENUM="EnumValue",e.LIST="ListValue",e.OBJECT="ObjectValue",e.OBJECT_FIELD="ObjectField",e.DIRECTIVE="Directive",e.NAMED_TYPE="NamedType",e.LIST_TYPE="ListType",e.NON_NULL_TYPE="NonNullType",e.SCHEMA_DEFINITION="SchemaDefinition",e.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",e.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",e.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",e.FIELD_DEFINITION="FieldDefinition",e.INPUT_VALUE_DEFINITION="InputValueDefinition",e.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",e.UNION_TYPE_DEFINITION="UnionTypeDefinition",e.ENUM_TYPE_DEFINITION="EnumTypeDefinition",e.ENUM_VALUE_DEFINITION="EnumValueDefinition",e.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",e.DIRECTIVE_DEFINITION="DirectiveDefinition",e.SCHEMA_EXTENSION="SchemaExtension",e.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",e.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",e.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",e.UNION_TYPE_EXTENSION="UnionTypeExtension",e.ENUM_TYPE_EXTENSION="EnumTypeExtension",e.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"}(r||(r={}))},25202:function(e,t,n){"use strict";function r(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}n.d(t,{Qc:function(){return F}});const s=/\r\n|[\n\r]/g;function i(e,t){let n=0,i=1;for(const o of e.body.matchAll(s)){if("number"==typeof o.index||r(!1),o.index>=t)break;n=o.index+o[0].length,i+=1}return{line:i,column:t+1-n}}function o(e){return a(e.source,i(e.source,e.start))}function a(e,t){const n=e.locationOffset.column-1,r="".padStart(n)+e.body,s=t.line-1,i=e.locationOffset.line-1,o=t.line+i,a=1===t.line?n:0,u=t.column+a,l=`${e.name}:${o}:${u}\n`,h=r.split(/\r\n|[\n\r]/g),f=h[s];if(f.length>120){const e=Math.floor(u/80),t=u%80,n=[];for(let e=0;e<f.length;e+=80)n.push(f.slice(e,e+80));return l+c([[`${o} |`,n[0]],...n.slice(1,e+1).map((e=>["|",e])),["|","^".padStart(t)],["|",n[e+1]]])}return l+c([[o-1+" |",h[s-1]],[`${o} |`,f],["|","^".padStart(u)],[`${o+1} |`,h[s+1]]])}function c(e){const t=e.filter((([e,t])=>void 0!==t)),n=Math.max(...t.map((([e])=>e.length)));return t.map((([e,t])=>e.padStart(n)+(t?" "+t:""))).join("\n")}class u extends Error{constructor(e,...t){var n,r,s;const{nodes:o,source:a,positions:c,path:h,originalError:f,extensions:p}=function(e){const t=e[0];return null==t||"kind"in t||"length"in t?{nodes:t,source:e[1],positions:e[2],path:e[3],originalError:e[4],extensions:e[5]}:t}(t);super(e),this.name="GraphQLError",this.path=null!=h?h:void 0,this.originalError=null!=f?f:void 0,this.nodes=l(Array.isArray(o)?o:o?[o]:void 0);const d=l(null===(n=this.nodes)||void 0===n?void 0:n.map((e=>e.loc)).filter((e=>null!=e)));this.source=null!=a?a:null==d||null===(r=d[0])||void 0===r?void 0:r.source,this.positions=null!=c?c:null==d?void 0:d.map((e=>e.start)),this.locations=c&&a?c.map((e=>i(a,e))):null==d?void 0:d.map((e=>i(e.source,e.start)));const y="object"==typeof(g=null==f?void 0:f.extensions)&&null!==g?null==f?void 0:f.extensions:void 0;var g;this.extensions=null!==(s=null!=p?p:y)&&void 0!==s?s:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),null!=f&&f.stack?Object.defineProperty(this,"stack",{value:f.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,u):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const t of this.nodes)t.loc&&(e+="\n\n"+o(t.loc));else if(this.source&&this.locations)for(const t of this.locations)e+="\n\n"+a(this.source,t);return e}toJSON(){const e={message:this.message};return null!=this.locations&&(e.locations=this.locations),null!=this.path&&(e.path=this.path),null!=this.extensions&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function l(e){return void 0===e||0===e.length?void 0:e}function h(e,t,n){return new u(`Syntax Error: ${n}`,{source:e,positions:[t]})}var f,p=n(39504);!function(e){e.QUERY="QUERY",e.MUTATION="MUTATION",e.SUBSCRIPTION="SUBSCRIPTION",e.FIELD="FIELD",e.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",e.FRAGMENT_SPREAD="FRAGMENT_SPREAD",e.INLINE_FRAGMENT="INLINE_FRAGMENT",e.VARIABLE_DEFINITION="VARIABLE_DEFINITION",e.SCHEMA="SCHEMA",e.SCALAR="SCALAR",e.OBJECT="OBJECT",e.FIELD_DEFINITION="FIELD_DEFINITION",e.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",e.INTERFACE="INTERFACE",e.UNION="UNION",e.ENUM="ENUM",e.ENUM_VALUE="ENUM_VALUE",e.INPUT_OBJECT="INPUT_OBJECT",e.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"}(f||(f={}));var d,y=n(6450),g=n(95389),m=n(91022);!function(e){e.SOF="<SOF>",e.EOF="<EOF>",e.BANG="!",e.DOLLAR="$",e.AMP="&",e.PAREN_L="(",e.PAREN_R=")",e.SPREAD="...",e.COLON=":",e.EQUALS="=",e.AT="@",e.BRACKET_L="[",e.BRACKET_R="]",e.BRACE_L="{",e.PIPE="|",e.BRACE_R="}",e.NAME="Name",e.INT="Int",e.FLOAT="Float",e.STRING="String",e.BLOCK_STRING="BlockString",e.COMMENT="Comment"}(d||(d={}));class b{constructor(e){const t=new p.WU(d.SOF,0,0,0,0);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){this.lastToken=this.token;return this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==d.EOF)do{if(e.next)e=e.next;else{const t=T(this,e.end);e.next=t,t.prev=e,e=t}}while(e.kind===d.COMMENT);return e}}function w(e){return e>=0&&e<=55295||e>=57344&&e<=1114111}function v(e,t){return E(e.charCodeAt(t))&&_(e.charCodeAt(t+1))}function E(e){return e>=55296&&e<=56319}function _(e){return e>=56320&&e<=57343}function k(e,t){const n=e.source.body.codePointAt(t);if(void 0===n)return d.EOF;if(n>=32&&n<=126){const e=String.fromCodePoint(n);return'"'===e?"'\"'":`"${e}"`}return"U+"+n.toString(16).toUpperCase().padStart(4,"0")}function S(e,t,n,r,s){const i=e.line,o=1+n-e.lineStart;return new p.WU(t,n,r,i,o,s)}function T(e,t){const n=e.source.body,r=n.length;let s=t;for(;s<r;){const t=n.charCodeAt(s);switch(t){case 65279:case 9:case 32:case 44:++s;continue;case 10:++s,++e.line,e.lineStart=s;continue;case 13:10===n.charCodeAt(s+1)?s+=2:++s,++e.line,e.lineStart=s;continue;case 35:return A(e,s);case 33:return S(e,d.BANG,s,s+1);case 36:return S(e,d.DOLLAR,s,s+1);case 38:return S(e,d.AMP,s,s+1);case 40:return S(e,d.PAREN_L,s,s+1);case 41:return S(e,d.PAREN_R,s,s+1);case 46:if(46===n.charCodeAt(s+1)&&46===n.charCodeAt(s+2))return S(e,d.SPREAD,s,s+3);break;case 58:return S(e,d.COLON,s,s+1);case 61:return S(e,d.EQUALS,s,s+1);case 64:return S(e,d.AT,s,s+1);case 91:return S(e,d.BRACKET_L,s,s+1);case 93:return S(e,d.BRACKET_R,s,s+1);case 123:return S(e,d.BRACE_L,s,s+1);case 124:return S(e,d.PIPE,s,s+1);case 125:return S(e,d.BRACE_R,s,s+1);case 34:return 34===n.charCodeAt(s+1)&&34===n.charCodeAt(s+2)?L(e,s):O(e,s)}if((0,m.X1)(t)||45===t)return I(e,s,t);if((0,m.LQ)(t))return B(e,s);throw h(e.source,s,39===t?"Unexpected single quote character ('), did you mean to use a double quote (\")?":w(t)||v(n,s)?`Unexpected character: ${k(e,s)}.`:`Invalid character: ${k(e,s)}.`)}return S(e,d.EOF,r,r)}function A(e,t){const n=e.source.body,r=n.length;let s=t+1;for(;s<r;){const e=n.charCodeAt(s);if(10===e||13===e)break;if(w(e))++s;else{if(!v(n,s))break;s+=2}}return S(e,d.COMMENT,t,s,n.slice(t+1,s))}function I(e,t,n){const r=e.source.body;let s=t,i=n,o=!1;if(45===i&&(i=r.charCodeAt(++s)),48===i){if(i=r.charCodeAt(++s),(0,m.X1)(i))throw h(e.source,s,`Invalid number, unexpected digit after 0: ${k(e,s)}.`)}else s=x(e,s,i),i=r.charCodeAt(s);if(46===i&&(o=!0,i=r.charCodeAt(++s),s=x(e,s,i),i=r.charCodeAt(s)),69!==i&&101!==i||(o=!0,i=r.charCodeAt(++s),43!==i&&45!==i||(i=r.charCodeAt(++s)),s=x(e,s,i),i=r.charCodeAt(s)),46===i||(0,m.LQ)(i))throw h(e.source,s,`Invalid number, expected digit but got: ${k(e,s)}.`);return S(e,o?d.FLOAT:d.INT,t,s,r.slice(t,s))}function x(e,t,n){if(!(0,m.X1)(n))throw h(e.source,t,`Invalid number, expected digit but got: ${k(e,t)}.`);const r=e.source.body;let s=t+1;for(;(0,m.X1)(r.charCodeAt(s));)++s;return s}function O(e,t){const n=e.source.body,r=n.length;let s=t+1,i=s,o="";for(;s<r;){const r=n.charCodeAt(s);if(34===r)return o+=n.slice(i,s),S(e,d.STRING,t,s+1,o);if(92!==r){if(10===r||13===r)break;if(w(r))++s;else{if(!v(n,s))throw h(e.source,s,`Invalid character within String: ${k(e,s)}.`);s+=2}}else{o+=n.slice(i,s);const t=117===n.charCodeAt(s+1)?123===n.charCodeAt(s+2)?P(e,s):R(e,s):C(e,s);o+=t.value,s+=t.size,i=s}}throw h(e.source,s,"Unterminated string.")}function P(e,t){const n=e.source.body;let r=0,s=3;for(;s<12;){const e=n.charCodeAt(t+s++);if(125===e){if(s<5||!w(r))break;return{value:String.fromCodePoint(r),size:s}}if(r=r<<4|D(e),r<0)break}throw h(e.source,t,`Invalid Unicode escape sequence: "${n.slice(t,t+s)}".`)}function R(e,t){const n=e.source.body,r=N(n,t+2);if(w(r))return{value:String.fromCodePoint(r),size:6};if(E(r)&&92===n.charCodeAt(t+6)&&117===n.charCodeAt(t+7)){const e=N(n,t+8);if(_(e))return{value:String.fromCodePoint(r,e),size:12}}throw h(e.source,t,`Invalid Unicode escape sequence: "${n.slice(t,t+6)}".`)}function N(e,t){return D(e.charCodeAt(t))<<12|D(e.charCodeAt(t+1))<<8|D(e.charCodeAt(t+2))<<4|D(e.charCodeAt(t+3))}function D(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function C(e,t){const n=e.source.body;switch(n.charCodeAt(t+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:"\n",size:2};case 114:return{value:"\r",size:2};case 116:return{value:"\t",size:2}}throw h(e.source,t,`Invalid character escape sequence: "${n.slice(t,t+2)}".`)}function L(e,t){const n=e.source.body,r=n.length;let s=e.lineStart,i=t+3,o=i,a="";const c=[];for(;i<r;){const r=n.charCodeAt(i);if(34===r&&34===n.charCodeAt(i+1)&&34===n.charCodeAt(i+2)){a+=n.slice(o,i),c.push(a);const r=S(e,d.BLOCK_STRING,t,i+3,(0,g.wv)(c).join("\n"));return e.line+=c.length-1,e.lineStart=s,r}if(92!==r||34!==n.charCodeAt(i+1)||34!==n.charCodeAt(i+2)||34!==n.charCodeAt(i+3))if(10!==r&&13!==r)if(w(r))++i;else{if(!v(n,i))throw h(e.source,i,`Invalid character within String: ${k(e,i)}.`);i+=2}else a+=n.slice(o,i),c.push(a),13===r&&10===n.charCodeAt(i+1)?i+=2:++i,a="",o=i,s=i;else a+=n.slice(o,i),o=i+1,i+=4}throw h(e.source,i,"Unterminated string.")}function B(e,t){const n=e.source.body,r=n.length;let s=t+1;for(;s<r;){const e=n.charCodeAt(s);if(!(0,m.HQ)(e))break;++s}return S(e,d.NAME,t,s,n.slice(t,s))}var M=n(53767),j=n(6589);const z=function(e,t){return e instanceof t};class U{constructor(e,t="GraphQL request",n={line:1,column:1}){"string"==typeof e||(0,M.a)(!1,`Body must be a string. Received: ${(0,j.X)(e)}.`),this.body=e,this.name=t,this.locationOffset=n,this.locationOffset.line>0||(0,M.a)(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||(0,M.a)(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function F(e,t){return new $(e,t).parseDocument()}class ${constructor(e,t={}){const n=function(e){return z(e,U)}(e)?e:new U(e);this._lexer=new b(n),this._options=t,this._tokenCounter=0}parseName(){const e=this.expectToken(d.NAME);return this.node(e,{kind:y.h.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:y.h.DOCUMENT,definitions:this.many(d.SOF,this.parseDefinition,d.EOF)})}parseDefinition(){if(this.peek(d.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),t=e?this._lexer.lookahead():this._lexer.token;if(t.kind===d.NAME){switch(t.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw h(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(t.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(t)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(d.BRACE_L))return this.node(e,{kind:y.h.OPERATION_DEFINITION,operation:p.ku.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const t=this.parseOperationType();let n;return this.peek(d.NAME)&&(n=this.parseName()),this.node(e,{kind:y.h.OPERATION_DEFINITION,operation:t,name:n,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(d.NAME);switch(e.value){case"query":return p.ku.QUERY;case"mutation":return p.ku.MUTATION;case"subscription":return p.ku.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(d.PAREN_L,this.parseVariableDefinition,d.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:y.h.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(d.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(d.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(d.DOLLAR),this.node(e,{kind:y.h.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:y.h.SELECTION_SET,selections:this.many(d.BRACE_L,this.parseSelection,d.BRACE_R)})}parseSelection(){return this.peek(d.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,t=this.parseName();let n,r;return this.expectOptionalToken(d.COLON)?(n=t,r=this.parseName()):r=t,this.node(e,{kind:y.h.FIELD,alias:n,name:r,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(d.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(d.PAREN_L,t,d.PAREN_R)}parseArgument(e=!1){const t=this._lexer.token,n=this.parseName();return this.expectToken(d.COLON),this.node(t,{kind:y.h.ARGUMENT,name:n,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(d.SPREAD);const t=this.expectOptionalKeyword("on");return!t&&this.peek(d.NAME)?this.node(e,{kind:y.h.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:y.h.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),!0===this._options.allowLegacyFragmentVariables?this.node(e,{kind:y.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:y.h.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()}parseValueLiteral(e){const t=this._lexer.token;switch(t.kind){case d.BRACKET_L:return this.parseList(e);case d.BRACE_L:return this.parseObject(e);case d.INT:return this.advanceLexer(),this.node(t,{kind:y.h.INT,value:t.value});case d.FLOAT:return this.advanceLexer(),this.node(t,{kind:y.h.FLOAT,value:t.value});case d.STRING:case d.BLOCK_STRING:return this.parseStringLiteral();case d.NAME:switch(this.advanceLexer(),t.value){case"true":return this.node(t,{kind:y.h.BOOLEAN,value:!0});case"false":return this.node(t,{kind:y.h.BOOLEAN,value:!1});case"null":return this.node(t,{kind:y.h.NULL});default:return this.node(t,{kind:y.h.ENUM,value:t.value})}case d.DOLLAR:if(e){if(this.expectToken(d.DOLLAR),this._lexer.token.kind===d.NAME){const e=this._lexer.token.value;throw h(this._lexer.source,t.start,`Unexpected variable "$${e}" in constant value.`)}throw this.unexpected(t)}return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:y.h.STRING,value:e.value,block:e.kind===d.BLOCK_STRING})}parseList(e){return this.node(this._lexer.token,{kind:y.h.LIST,values:this.any(d.BRACKET_L,(()=>this.parseValueLiteral(e)),d.BRACKET_R)})}parseObject(e){return this.node(this._lexer.token,{kind:y.h.OBJECT,fields:this.any(d.BRACE_L,(()=>this.parseObjectField(e)),d.BRACE_R)})}parseObjectField(e){const t=this._lexer.token,n=this.parseName();return this.expectToken(d.COLON),this.node(t,{kind:y.h.OBJECT_FIELD,name:n,value:this.parseValueLiteral(e)})}parseDirectives(e){const t=[];for(;this.peek(d.AT);)t.push(this.parseDirective(e));return t}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const t=this._lexer.token;return this.expectToken(d.AT),this.node(t,{kind:y.h.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let t;if(this.expectOptionalToken(d.BRACKET_L)){const n=this.parseTypeReference();this.expectToken(d.BRACKET_R),t=this.node(e,{kind:y.h.LIST_TYPE,type:n})}else t=this.parseNamedType();return this.expectOptionalToken(d.BANG)?this.node(e,{kind:y.h.NON_NULL_TYPE,type:t}):t}parseNamedType(){return this.node(this._lexer.token,{kind:y.h.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(d.STRING)||this.peek(d.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");const n=this.parseConstDirectives(),r=this.many(d.BRACE_L,this.parseOperationTypeDefinition,d.BRACE_R);return this.node(e,{kind:y.h.SCHEMA_DEFINITION,description:t,directives:n,operationTypes:r})}parseOperationTypeDefinition(){const e=this._lexer.token,t=this.parseOperationType();this.expectToken(d.COLON);const n=this.parseNamedType();return this.node(e,{kind:y.h.OPERATION_TYPE_DEFINITION,operation:t,type:n})}parseScalarTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");const n=this.parseName(),r=this.parseConstDirectives();return this.node(e,{kind:y.h.SCALAR_TYPE_DEFINITION,description:t,name:n,directives:r})}parseObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");const n=this.parseName(),r=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),i=this.parseFieldsDefinition();return this.node(e,{kind:y.h.OBJECT_TYPE_DEFINITION,description:t,name:n,interfaces:r,directives:s,fields:i})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(d.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(d.BRACE_L,this.parseFieldDefinition,d.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,t=this.parseDescription(),n=this.parseName(),r=this.parseArgumentDefs();this.expectToken(d.COLON);const s=this.parseTypeReference(),i=this.parseConstDirectives();return this.node(e,{kind:y.h.FIELD_DEFINITION,description:t,name:n,arguments:r,type:s,directives:i})}parseArgumentDefs(){return this.optionalMany(d.PAREN_L,this.parseInputValueDef,d.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,t=this.parseDescription(),n=this.parseName();this.expectToken(d.COLON);const r=this.parseTypeReference();let s;this.expectOptionalToken(d.EQUALS)&&(s=this.parseConstValueLiteral());const i=this.parseConstDirectives();return this.node(e,{kind:y.h.INPUT_VALUE_DEFINITION,description:t,name:n,type:r,defaultValue:s,directives:i})}parseInterfaceTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");const n=this.parseName(),r=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),i=this.parseFieldsDefinition();return this.node(e,{kind:y.h.INTERFACE_TYPE_DEFINITION,description:t,name:n,interfaces:r,directives:s,fields:i})}parseUnionTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");const n=this.parseName(),r=this.parseConstDirectives(),s=this.parseUnionMemberTypes();return this.node(e,{kind:y.h.UNION_TYPE_DEFINITION,description:t,name:n,directives:r,types:s})}parseUnionMemberTypes(){return this.expectOptionalToken(d.EQUALS)?this.delimitedMany(d.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");const n=this.parseName(),r=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();return this.node(e,{kind:y.h.ENUM_TYPE_DEFINITION,description:t,name:n,directives:r,values:s})}parseEnumValuesDefinition(){return this.optionalMany(d.BRACE_L,this.parseEnumValueDefinition,d.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,t=this.parseDescription(),n=this.parseEnumValueName(),r=this.parseConstDirectives();return this.node(e,{kind:y.h.ENUM_VALUE_DEFINITION,description:t,name:n,directives:r})}parseEnumValueName(){if("true"===this._lexer.token.value||"false"===this._lexer.token.value||"null"===this._lexer.token.value)throw h(this._lexer.source,this._lexer.token.start,`${H(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");const n=this.parseName(),r=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();return this.node(e,{kind:y.h.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:n,directives:r,fields:s})}parseInputFieldsDefinition(){return this.optionalMany(d.BRACE_L,this.parseInputValueDef,d.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===d.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const t=this.parseConstDirectives(),n=this.optionalMany(d.BRACE_L,this.parseOperationTypeDefinition,d.BRACE_R);if(0===t.length&&0===n.length)throw this.unexpected();return this.node(e,{kind:y.h.SCHEMA_EXTENSION,directives:t,operationTypes:n})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const t=this.parseName(),n=this.parseConstDirectives();if(0===n.length)throw this.unexpected();return this.node(e,{kind:y.h.SCALAR_TYPE_EXTENSION,name:t,directives:n})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const t=this.parseName(),n=this.parseImplementsInterfaces(),r=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(0===n.length&&0===r.length&&0===s.length)throw this.unexpected();return this.node(e,{kind:y.h.OBJECT_TYPE_EXTENSION,name:t,interfaces:n,directives:r,fields:s})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const t=this.parseName(),n=this.parseImplementsInterfaces(),r=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(0===n.length&&0===r.length&&0===s.length)throw this.unexpected();return this.node(e,{kind:y.h.INTERFACE_TYPE_EXTENSION,name:t,interfaces:n,directives:r,fields:s})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const t=this.parseName(),n=this.parseConstDirectives(),r=this.parseUnionMemberTypes();if(0===n.length&&0===r.length)throw this.unexpected();return this.node(e,{kind:y.h.UNION_TYPE_EXTENSION,name:t,directives:n,types:r})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const t=this.parseName(),n=this.parseConstDirectives(),r=this.parseEnumValuesDefinition();if(0===n.length&&0===r.length)throw this.unexpected();return this.node(e,{kind:y.h.ENUM_TYPE_EXTENSION,name:t,directives:n,values:r})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const t=this.parseName(),n=this.parseConstDirectives(),r=this.parseInputFieldsDefinition();if(0===n.length&&0===r.length)throw this.unexpected();return this.node(e,{kind:y.h.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:n,fields:r})}parseDirectiveDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(d.AT);const n=this.parseName(),r=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const i=this.parseDirectiveLocations();return this.node(e,{kind:y.h.DIRECTIVE_DEFINITION,description:t,name:n,arguments:r,repeatable:s,locations:i})}parseDirectiveLocations(){return this.delimitedMany(d.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,t=this.parseName();if(Object.prototype.hasOwnProperty.call(f,t.value))return t;throw this.unexpected(e)}node(e,t){return!0!==this._options.noLocation&&(t.loc=new p.Ye(e,this._lexer.lastToken,this._lexer.source)),t}peek(e){return this._lexer.token.kind===e}expectToken(e){const t=this._lexer.token;if(t.kind===e)return this.advanceLexer(),t;throw h(this._lexer.source,t.start,`Expected ${V(e)}, found ${H(t)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e&&(this.advanceLexer(),!0)}expectKeyword(e){const t=this._lexer.token;if(t.kind!==d.NAME||t.value!==e)throw h(this._lexer.source,t.start,`Expected "${e}", found ${H(t)}.`);this.advanceLexer()}expectOptionalKeyword(e){const t=this._lexer.token;return t.kind===d.NAME&&t.value===e&&(this.advanceLexer(),!0)}unexpected(e){const t=null!=e?e:this._lexer.token;return h(this._lexer.source,t.start,`Unexpected ${H(t)}.`)}any(e,t,n){this.expectToken(e);const r=[];for(;!this.expectOptionalToken(n);)r.push(t.call(this));return r}optionalMany(e,t,n){if(this.expectOptionalToken(e)){const e=[];do{e.push(t.call(this))}while(!this.expectOptionalToken(n));return e}return[]}many(e,t,n){this.expectToken(e);const r=[];do{r.push(t.call(this))}while(!this.expectOptionalToken(n));return r}delimitedMany(e,t){this.expectOptionalToken(e);const n=[];do{n.push(t.call(this))}while(this.expectOptionalToken(e));return n}advanceLexer(){const{maxTokens:e}=this._options,t=this._lexer.advance();if(void 0!==e&&t.kind!==d.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw h(this._lexer.source,t.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function H(e){const t=e.value;return V(e.kind)+(null!=t?` "${t}"`:"")}function V(e){return function(e){return e===d.BANG||e===d.DOLLAR||e===d.AMP||e===d.PAREN_L||e===d.PAREN_R||e===d.SPREAD||e===d.COLON||e===d.EQUALS||e===d.AT||e===d.BRACKET_L||e===d.BRACKET_R||e===d.BRACE_L||e===d.PIPE||e===d.BRACE_R}(e)?`"${e}"`:e}},31044:function(e,t,n){"use strict";var r=n(40210)("%Object.defineProperty%",!0),s=function(){if(r)try{return r({},"a",{value:1}),!0}catch(e){return!1}return!1};s.hasArrayLengthDefineBug=function(){if(!s())return null;try{return 1!==r([],"length",{value:1}).length}catch(e){return!0}},e.exports=s},41405:function(e,t,n){"use strict";var r="undefined"!=typeof Symbol&&Symbol,s=n(55419);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&s())))}},55419:function(e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},96410:function(e,t,n){"use strict";var r=n(55419);e.exports=function(){return r()&&!!Symbol.toStringTag}},17642:function(e,t,n){"use strict";var r=n(58612);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},70248:function(e){e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,n=Object.create(null),r=Object.create(null);function s(s,i){n[s]=i,++t>=e&&(t=0,r=n,n=Object.create(null))}return{has:function(e){return void 0!==n[e]||void 0!==r[e]},remove:function(e){void 0!==n[e]&&(n[e]=void 0),void 0!==r[e]&&(r[e]=void 0)},get:function(e){var t=n[e];return void 0!==t?t:void 0!==(t=r[e])?(s(e,t),t):void 0},set:function(e,t){void 0!==n[e]?n[e]=t:s(e,t)},clear:function(){n=Object.create(null),r=Object.create(null)}}}},80645:function(e,t){t.read=function(e,t,n,r,s){var i,o,a=8*s-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?s-1:0,f=n?-1:1,p=e[t+h];for(h+=f,i=p&(1<<-l)-1,p>>=-l,l+=a;l>0;i=256*i+e[t+h],h+=f,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=f,l-=8);if(0===i)i=1-u;else{if(i===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),i-=u}return(p?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,s,i){var o,a,c,u=8*i-s-1,l=(1<<u)-1,h=l>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+h>=1?f/c:f*Math.pow(2,1-h))*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,s),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,s),o=0));s>=8;e[n+p]=255&a,p+=d,a/=256,s-=8);for(o=o<<s|a,u+=s;u>0;e[n+p]=255&o,p+=d,o/=256,u-=8);e[n+p-d]|=128*y}},35717:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},56512:function(e){!function(t){"use strict";const n="(0?\\d+|0x[a-f0-9]+)",r={fourOctet:new RegExp(`^${n}\\.${n}\\.${n}\\.${n}$`,"i"),threeOctet:new RegExp(`^${n}\\.${n}\\.${n}$`,"i"),twoOctet:new RegExp(`^${n}\\.${n}$`,"i"),longValue:new RegExp(`^${n}$`,"i")},s=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${n}\\.${n}\\.${n}\\.${n}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${n}\\.${n}\\.${n}\\.${n}(${o})?$`,"i")};function u(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let n,r,s=0,i=-1,o=(e.match(c.zoneIndex)||[])[0];for(o&&(o=o.substring(1),e=e.replace(/%.+$/,""));(i=e.indexOf(":",i+1))>=0;)s++;if("::"===e.substr(0,2)&&s--,"::"===e.substr(-2,2)&&s--,s>t)return null;for(r=t-s,n=":";r--;)n+="0:";return":"===(e=e.replace("::",n))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),n=[];for(let e=0;e<t.length;e++)n.push(parseInt(t[e],16));return n}(),zoneId:o}}function l(e,t,n,r){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let s,i=0;for(;r>0;){if(s=n-r,s<0&&(s=0),e[i]>>s!=t[i]>>s)return!1;r-=n,i+=1}return!0}function h(e){if(i.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(s.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function f(e,t){for(;e.length<t;)e=`0${e}`;return e}const p={};p.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,n;for(t=0;t<e.length;t++)if(n=e[t],!(0<=n&&n<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let n;if(void 0===t&&(n=e,e=n[0],t=n[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return l(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const n={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let r,s,i;for(r=3;r>=0;r-=1){if(s=this.octets[r],!(s in n))return null;if(i=n[s],t&&0!==i)return null;8!==i&&(t=!0),e+=i}return 32-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return p.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),p.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),n=t[0].toByteArray(),r=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[];let i=0;for(;i<4;)s.push(parseInt(n[i],10)|255^parseInt(r[i],10)),i++;return new this(s)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.isIPv4=function(e){return null!==this.parser(e)},p.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},p.IPv4.isValidFourPartDecimal=function(e){return!(!p.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},p.IPv4.networkAddressFromCIDR=function(e){let t,n,r,s,i;try{for(t=this.parseCIDR(e),r=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[],n=0;n<4;)s.push(parseInt(r[n],10)&parseInt(i[n],10)),n++;return new this(s)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},p.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const n=[this.parse(t[1]),e];return Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},p.IPv4.parser=function(e){let t,n,s;if(t=e.match(r.fourOctet))return function(){const e=t.slice(1,6),r=[];for(let t=0;t<e.length;t++)n=e[t],r.push(h(n));return r}();if(t=e.match(r.longValue)){if(s=h(t[1]),s>4294967295||s<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(s>>t&255);return e}().reverse()}return(t=e.match(r.twoOctet))?function(){const e=t.slice(1,4),n=[];if(s=h(e[1]),s>16777215||s<0)throw new Error("ipaddr: address outside defined range");return n.push(h(e[0])),n.push(s>>16&255),n.push(s>>8&255),n.push(255&s),n}():(t=e.match(r.threeOctet))?function(){const e=t.slice(1,5),n=[];if(s=h(e[2]),s>65535||s<0)throw new Error("ipaddr: address outside defined range");return n.push(h(e[0])),n.push(h(e[1])),n.push(s>>8&255),n.push(255&s),n}():null},p.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let n=0;const r=Math.floor(e/8);for(;n<r;)t[n]=255,n++;return r<4&&(t[r]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.IPv6=function(){function e(e,t){let n,r;if(16===e.length)for(this.parts=[],n=0;n<=14;n+=2)this.parts.push(e[n]<<8|e[n+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(n=0;n<this.parts.length;n++)if(r=this.parts[n],!(0<=r&&r<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let n;if(void 0===t&&(n=e,e=n[0],t=n[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return l(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const n={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let r,s;for(let i=7;i>=0;i-=1){if(r=this.parts[i],!(r in n))return null;if(s=n[r],t&&0!==s)return null;16!==s&&(t=!0),e+=s}return 128-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],n=this.parts;for(let r=0;r<n.length;r++)e=n[r],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(f(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],n=e[1];return new p.IPv4([t>>8,255&t,n>>8,255&n])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let n,r=0,s=-1;for(;n=e.exec(t);)n[0].length>s&&(r=n.index,s=n[0].length);return s<0?t:`${t.substring(0,r)}::${t.substring(r+s)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),p.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),n=t[0].toByteArray(),r=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[];let i=0;for(;i<16;)s.push(parseInt(n[i],10)|255^parseInt(r[i],10)),i++;return new this(s)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.isIPv6=function(e){return null!==this.parser(e)},p.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},p.IPv6.networkAddressFromCIDR=function(e){let t,n,r,s,i;try{for(t=this.parseCIDR(e),r=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[],n=0;n<16;)s.push(parseInt(r[n],10)&parseInt(i[n],10)),n++;return new this(s)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},p.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},p.IPv6.parseCIDR=function(e){let t,n,r;if((n=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(n[2]),t>=0&&t<=128))return r=[this.parse(n[1]),t],Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},p.IPv6.parser=function(e){let t,n,r,s,i,o;if(r=e.match(c.deprecatedTransitional))return this.parser(`::ffff:${r[1]}`);if(c.native.test(e))return u(e,8);if((r=e.match(c.transitional))&&(o=r[6]||"",t=u(r[1].slice(0,-1)+o,6),t.parts)){for(i=[parseInt(r[2]),parseInt(r[3]),parseInt(r[4]),parseInt(r[5])],n=0;n<i.length;n++)if(s=i[n],!(0<=s&&s<=255))return null;return t.parts.push(i[0]<<8|i[1]),t.parts.push(i[2]<<8|i[3]),{parts:t.parts,zoneId:t.zoneId}}return null},p.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let n=0;const r=Math.floor(e/8);for(;n<r;)t[n]=255,n++;return r<16&&(t[r]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.fromByteArray=function(e){const t=e.length;if(4===t)return new p.IPv4(e);if(16===t)return new p.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},p.isValid=function(e){return p.IPv6.isValid(e)||p.IPv4.isValid(e)},p.parse=function(e){if(p.IPv6.isValid(e))return p.IPv6.parse(e);if(p.IPv4.isValid(e))return p.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},p.parseCIDR=function(e){try{return p.IPv6.parseCIDR(e)}catch(t){try{return p.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},p.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},p.subnetMatch=function(e,t,n){let r,s,i,o;for(s in null==n&&(n="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,s))for(i=t[s],!i[0]||i[0]instanceof Array||(i=[i]),r=0;r<i.length;r++)if(o=i[r],e.kind()===o[0].kind()&&e.match.apply(e,o))return s;return n},e.exports?e.exports=p:t.ipaddr=p}(this)},63655:function(e,t,n){"use strict";e.exports=n(31154)},31154:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(34237),r.BufferWriter=n(55093),r.Reader=n(4544),r.BufferReader=n(6703),r.util=n(34471),r.rpc=n(70324),r.roots=n(76085),r.configure=s,s()},4544:function(e,t,n){"use strict";e.exports=c;var r,s=n(34471),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=h(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},6703:function(e,t,n){"use strict";e.exports=i;var r=n(4544);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(34471);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},76085:function(e){"use strict";e.exports={}},70324:function(e,t,n){"use strict";t.Service=n(27610)},27610:function(e,t,n){"use strict";e.exports=s;var r=n(34471);function s(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},96725:function(e,t,n){"use strict";e.exports=s;var r=n(34471);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},34471:function(e,t,n){"use strict";var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(34537),r.base64=n(97419),r.EventEmitter=n(19211),r.float=n(10945),r.inquire=n(67199),r.utf8=n(94997),r.pool=n(76662),r.LongBits=n(96725),r.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},34237:function(e,t,n){"use strict";e.exports=h;var r,s=n(34471),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},55093:function(e,t,n){"use strict";e.exports=i;var r=n(34237);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(34471);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},89158:function(e){e.exports=function e(r,s){var i,o=0,a=0,c=s=s||0,u=r.length;do{if(c>=u||a>49)throw e.bytes=0,new RangeError("Could not decode varint");i=r[c++],o+=a<28?(i&n)<<a:(i&n)*Math.pow(2,a),a+=7}while(i>=t);return e.bytes=c-s,o};var t=128,n=127},14967:function(e){e.exports=function e(s,i,o){if(Number.MAX_SAFE_INTEGER&&s>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");i=i||[];var a=o=o||0;for(;s>=r;)i[o++]=255&s|t,s/=128;for(;s&n;)i[o++]=255&s|t,s>>>=7;return i[o]=0|s,e.bytes=o-a+1,i};var t=128,n=-128,r=Math.pow(2,31)},77308:function(e,t,n){e.exports={encode:n(14967),decode:n(89158),encodingLength:n(40591)}},40591:function(e){var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<u?9:10}},52197:function(e,t,n){"use strict";e.exports=n(50628)},50628:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(5886),r.BufferWriter=n(93079),r.Reader=n(32376),r.BufferReader=n(85333),r.util=n(98380),r.rpc=n(26751),r.roots=n(86849),r.configure=s,s()},32376:function(e,t,n){"use strict";e.exports=c;var r,s=n(98380),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=h(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},85333:function(e,t,n){"use strict";e.exports=i;var r=n(32376);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(98380);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},86849:function(e){"use strict";e.exports={}},26751:function(e,t,n){"use strict";t.Service=n(98094)},98094:function(e,t,n){"use strict";e.exports=s;var r=n(98380);function s(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},26396:function(e,t,n){"use strict";e.exports=s;var r=n(98380);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},98380:function(e,t,n){"use strict";var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(34537),r.base64=n(97419),r.EventEmitter=n(19211),r.float=n(10945),r.inquire=n(67199),r.utf8=n(94997),r.pool=n(76662),r.LongBits=n(26396),r.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},5886:function(e,t,n){"use strict";e.exports=h;var r,s=n(98380),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},93079:function(e,t,n){"use strict";e.exports=i;var r=n(5886);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(98380);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},25853:function(e,t,n){"use strict";e.exports=n(5092)},5092:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(40834),r.BufferWriter=n(88832),r.Reader=n(96115),r.BufferReader=n(86890),r.util=n(27957),r.rpc=n(43825),r.roots=n(34954),r.configure=s,s()},96115:function(e,t,n){"use strict";e.exports=c;var r,s=n(27957),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=h(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},86890:function(e,t,n){"use strict";e.exports=i;var r=n(96115);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(27957);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},34954:function(e){"use strict";e.exports={}},43825:function(e,t,n){"use strict";t.Service=n(64998)},64998:function(e,t,n){"use strict";e.exports=s;var r=n(27957);function s(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},91802:function(e,t,n){"use strict";e.exports=s;var r=n(27957);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},27957:function(e,t,n){"use strict";var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(34537),r.base64=n(97419),r.EventEmitter=n(19211),r.float=n(10945),r.inquire=n(67199),r.utf8=n(94997),r.pool=n(76662),r.LongBits=n(91802),r.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},40834:function(e,t,n){"use strict";e.exports=h;var r,s=n(27957),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},88832:function(e,t,n){"use strict";e.exports=i;var r=n(40834);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(27957);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},90088:function(e){e.exports=function e(r,s){var i,o=0,a=0,c=s=s||0,u=r.length;do{if(c>=u||a>49)throw e.bytes=0,new RangeError("Could not decode varint");i=r[c++],o+=a<28?(i&n)<<a:(i&n)*Math.pow(2,a),a+=7}while(i>=t);return e.bytes=c-s,o};var t=128,n=127},98720:function(e){e.exports=function e(s,i,o){if(Number.MAX_SAFE_INTEGER&&s>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");i=i||[];var a=o=o||0;for(;s>=r;)i[o++]=255&s|t,s/=128;for(;s&n;)i[o++]=255&s|t,s>>>=7;return i[o]=0|s,e.bytes=o-a+1,i};var t=128,n=-128,r=Math.pow(2,31)},26104:function(e,t,n){e.exports={encode:n(98720),decode:n(90088),encodingLength:n(91222)}},91222:function(e){var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<u?9:10}},67412:function(e,t,n){"use strict";e.exports=n(14036)},14036:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(79827),r.BufferWriter=n(28324),r.Reader=n(18550),r.BufferReader=n(85426),r.util=n(25072),r.rpc=n(4239),r.roots=n(98426),r.configure=s,s()},18550:function(e,t,n){"use strict";e.exports=c;var r,s=n(25072),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=h(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},85426:function(e,t,n){"use strict";e.exports=i;var r=n(18550);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(25072);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},98426:function(e){"use strict";e.exports={}},4239:function(e,t,n){"use strict";t.Service=n(99603)},99603:function(e,t,n){"use strict";e.exports=s;var r=n(25072);function s(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},41838:function(e,t,n){"use strict";e.exports=s;var r=n(25072);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},25072:function(e,t,n){"use strict";var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(34537),r.base64=n(97419),r.EventEmitter=n(19211),r.float=n(10945),r.inquire=n(67199),r.utf8=n(94997),r.pool=n(76662),r.LongBits=n(41838),r.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},79827:function(e,t,n){"use strict";e.exports=h;var r,s=n(25072),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},28324:function(e,t,n){"use strict";e.exports=i;var r=n(79827);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(25072);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},77841:function(e){e.exports=function e(r,s){var i,o=0,a=0,c=s=s||0,u=r.length;do{if(c>=u||a>49)throw e.bytes=0,new RangeError("Could not decode varint");i=r[c++],o+=a<28?(i&n)<<a:(i&n)*Math.pow(2,a),a+=7}while(i>=t);return e.bytes=c-s,o};var t=128,n=127},98222:function(e){e.exports=function e(s,i,o){if(Number.MAX_SAFE_INTEGER&&s>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");i=i||[];var a=o=o||0;for(;s>=r;)i[o++]=255&s|t,s/=128;for(;s&n;)i[o++]=255&s|t,s>>>=7;return i[o]=0|s,e.bytes=o-a+1,i};var t=128,n=-128,r=Math.pow(2,31)},33497:function(e,t,n){e.exports={encode:n(98222),decode:n(77841),encodingLength:n(32510)}},32510:function(e){var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),u=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<u?9:10}},68653:function(e,t,n){"use strict";e.exports=n(82943)},82943:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(685),r.BufferWriter=n(43410),r.Reader=n(68184),r.BufferReader=n(87674),r.util=n(43264),r.rpc=n(32988),r.roots=n(19981),r.configure=s,s()},68184:function(e,t,n){"use strict";e.exports=c;var r,s=n(43264),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=h(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},87674:function(e,t,n){"use strict";e.exports=i;var r=n(68184);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(43264);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},19981:function(e){"use strict";e.exports={}},32988:function(e,t,n){"use strict";t.Service=n(37867)},37867:function(e,t,n){"use strict";e.exports=s;var r=n(43264);function s(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},67348:function(e,t,n){"use strict";e.exports=s;var r=n(43264);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},43264:function(e,t,n){"use strict";var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(34537),r.base64=n(97419),r.EventEmitter=n(19211),r.float=n(10945),r.inquire=n(67199),r.utf8=n(94997),r.pool=n(76662),r.LongBits=n(67348),r.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},685:function(e,t,n){"use strict";e.exports=h;var r,s=n(43264),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},43410:function(e,t,n){"use strict";e.exports=i;var r=n(685);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(43264);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},55353:function(e,t,n){"use strict";e.exports=n(20612)},20612:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(27070),r.BufferWriter=n(5096),r.Reader=n(59824),r.BufferReader=n(26075),r.util=n(81910),r.rpc=n(86177),r.roots=n(83314),r.configure=s,s()},59824:function(e,t,n){"use strict";e.exports=c;var r,s=n(81910),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=h(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},26075:function(e,t,n){"use strict";e.exports=i;var r=n(59824);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(81910);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},83314:function(e){"use strict";e.exports={}},86177:function(e,t,n){"use strict";t.Service=n(44658)},44658:function(e,t,n){"use strict";e.exports=s;var r=n(81910);function s(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},76758:function(e,t,n){"use strict";e.exports=s;var r=n(81910);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},81910:function(e,t,n){"use strict";var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(34537),r.base64=n(97419),r.EventEmitter=n(19211),r.float=n(10945),r.inquire=n(67199),r.utf8=n(94997),r.pool=n(76662),r.LongBits=n(76758),r.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},27070:function(e,t,n){"use strict";e.exports=h;var r,s=n(81910),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},5096:function(e,t,n){"use strict";e.exports=i;var r=n(27070);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(81910);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},74449:function(e){"use strict";e.exports=async function*(e,t={}){const n=e.getReader();try{for(;;){const e=await n.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&n.cancel(),n.releaseLock()}}},46851:function(e){"use strict";e.exports=async e=>{const t=[];for await(const n of e)t.push(n);return t}},106:function(e,t,n){"use strict";var r=n(34155);const s=n(59134),i="object"==typeof window&&"object"==typeof document&&9===document.nodeType,o=s(),a=i&&!o,c=o&&!i,u=o&&i,l=void 0!==r&&void 0!==r.release&&"node"===r.release.name&&!o,h="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,f=void 0!==r&&void 0!==r.env&&!1,p="undefined"!=typeof navigator&&"ReactNative"===navigator.product;e.exports={isTest:f,isElectron:o,isElectronMain:c,isElectronRenderer:u,isNode:l,isBrowser:a,isWebWorker:h,isEnvWithDom:i,isReactNative:p}},38688:function(e,t,n){"use strict";e.exports=n(30700)},46953:function(e,t,n){"use strict";const r=n(67137);async function*s(e,t){const n=new r,s=await n.get(e,t);yield*s.iterator()}e.exports=(e,t)=>({path:decodeURIComponent(new URL(e).pathname.split("/").pop()||""),content:s(e,t)})},67137:function(e,t,n){"use strict";const{fetch:r,Request:s,Headers:i}=n(50730),{TimeoutError:o,HTTPError:a}=n(44171),c=n(70942).bind({ignoreUndefined:!0}),{URL:u,URLSearchParams:l}=n(17745),h=n(32044),f=n(74449),{isBrowser:p,isWebWorker:d}=n(106),y=n(46851),g={throwHttpErrors:!0,credentials:"same-origin"};class m{constructor(e={}){this.opts=c(g,e)}async fetch(e,t={}){const n=c(this.opts,t),g=new i(n.headers);if("string"!=typeof e&&!(e instanceof u||e instanceof s))throw new TypeError("`resource` must be a string, URL, or Request");const m=new u(e.toString(),n.base),{searchParams:v,transformSearchParams:E,json:_}=n;v&&(m.search="function"==typeof E?E(new l(n.searchParams)):new l(n.searchParams)),_&&(n.body=JSON.stringify(n.json),g.set("content-type","application/json"));const k=new AbortController,S=h([k.signal,n.signal]);null!=globalThis.ReadableStream&&n.body instanceof globalThis.ReadableStream&&(p||d)&&(n.body=new Blob(await y(f(n.body))));const T=await((e,t,n)=>{if(void 0===t)return e;const r=Date.now(),s=()=>Date.now()-r>=t;return new Promise(((r,i)=>{const a=setTimeout((()=>{s()&&(i(new o),n.abort())}),t),c=e=>t=>{clearTimeout(a),s()?i(new o):e(t)};e.then(c(r),c(i))}))})(r(m.toString(),{...n,signal:S,timeout:void 0,headers:g,duplex:"half"}),n.timeout,k);if(!T.ok&&n.throwHttpErrors)throw n.handleError&&await n.handleError(T),new a(T);return T.iterator=async function*(){yield*w(T.body)},T.ndjson=async function*(){for await(const e of b(T.iterator()))t.transform?yield t.transform(e):yield e},T}post(e,t={}){return this.fetch(e,{...t,method:"POST"})}get(e,t={}){return this.fetch(e,{...t,method:"GET"})}put(e,t={}){return this.fetch(e,{...t,method:"PUT"})}delete(e,t={}){return this.fetch(e,{...t,method:"DELETE"})}options(e,t={}){return this.fetch(e,{...t,method:"OPTIONS"})}}const b=async function*(e){const t=new TextDecoder;let n="";for await(const r of e){n+=t.decode(r,{stream:!0});const e=n.split(/\r?\n/);for(let t=0;t<e.length-1;t++){const n=e[t].trim();n.length>0&&(yield JSON.parse(n))}n=e[e.length-1]}n+=t.decode(),n=n.trim(),0!==n.length&&(yield JSON.parse(n))},w=e=>{if(v(e))return e;if(_(e)){const t=e[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:t.next.bind(t),return:n=>(e.destroy(),"function"==typeof t.return?t.return():Promise.resolve({done:!0,value:n}))})}}if(E(e)){const t=e.getReader();return async function*(){try{for(;;){const{done:e,value:n}=await t.read();if(e)return;n&&(yield n)}}finally{t.releaseLock()}}()}throw new TypeError("Body can't be converted to AsyncIterable")},v=e=>"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator],E=e=>e&&"function"==typeof e.getReader,_=e=>Object.prototype.hasOwnProperty.call(e,"readable")&&Object.prototype.hasOwnProperty.call(e,"writable");m.HTTPError=a,m.TimeoutError=o,m.streamToAsyncIterator=w,m.post=(e,t)=>new m(t).post(e,t),m.get=(e,t)=>new m(t).get(e,t),m.put=(e,t)=>new m(t).put(e,t),m.delete=(e,t)=>new m(t).delete(e,t),m.options=(e,t)=>new m(t).options(e,t),e.exports=m},44171:function(e,t){"use strict";class n extends Error{constructor(e="Request timed out"){super(e),this.name="TimeoutError"}}t.TimeoutError=n;class r extends Error{constructor(e="The operation was aborted."){super(e),this.name="AbortError"}}t.AbortError=r;class s extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.response=e}}t.HTTPError=s},50730:function(e,t,n){"use strict";const{TimeoutError:r,AbortError:s}=n(44171),{Response:i,Request:o,Headers:a,default:c}=n(38688),u=c,l=e=>{const t=new a;for(const n of e.trim().split(/[\r\n]+/)){const e=n.indexOf(": ");e>0&&t.set(n.slice(0,e),n.slice(e+1))}return t};class h extends i{constructor(e,t,n){super(t,n),Object.defineProperty(this,"url",{value:e})}}e.exports={fetch:(e,t={})=>null!=t.onUploadProgress?((e,t={})=>{const n=new XMLHttpRequest;n.open(t.method||"GET",e.toString(),!0);const{timeout:o,headers:c}=t;if(o&&o>0&&o<1/0&&(n.timeout=o),null!=t.overrideMimeType&&n.overrideMimeType(t.overrideMimeType),c)for(const[e,t]of new a(c))n.setRequestHeader(e,t);return t.signal&&(t.signal.onabort=()=>n.abort()),t.onUploadProgress&&(n.upload.onprogress=t.onUploadProgress),n.responseType="arraybuffer",new Promise(((e,o)=>{const a=t=>{switch(t.type){case"error":e(i.error());break;case"load":e(new h(n.responseURL,n.response,{status:n.status,statusText:n.statusText,headers:l(n.getAllResponseHeaders())}));break;case"timeout":o(new r);break;case"abort":o(new s)}};n.onerror=a,n.onload=a,n.ontimeout=a,n.onabort=a,n.send(t.body)}))})(e,t):u(e,t),Request:o,Headers:a}},77914:function(e,t,n){"use strict";e.exports=c;var r,s=n(44738),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},h=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}c.create=h(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=h(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},97151:function(e,t,n){"use strict";e.exports=i;var r=n(77914);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(44738);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},57369:function(e,t,n){"use strict";e.exports=s;var r=n(44738);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"==typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},44738:function(e,t,n){"use strict";var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(34537),r.base64=n(97419),r.EventEmitter=n(19211),r.float=n(10945),r.inquire=n(67199),r.utf8=n(94997),r.pool=n(76662),r.LongBits=n(57369),r.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},29078:function(e,t,n){"use strict";e.exports=h;var r,s=n(44738),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function y(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(y,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(y,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(y,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var m=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(m,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new c(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},48320:function(e,t,n){"use strict";e.exports=i;var r=n(29078);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(44738);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},82584:function(e,t,n){"use strict";var r=n(96410)(),s=n(21924)("Object.prototype.toString"),i=function(e){return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===s(e)},o=function(e){return!!i(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==s(e)&&"[object Function]"===s(e.callee)},a=function(){return i(arguments)}();i.isLegacyArguments=o,e.exports=a?i:o},95320:function(e){"use strict";var t,n,r=Function.prototype.toString,s="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof s&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw n}}),n={},s((function(){throw 42}),null,t)}catch(e){e!==n&&(s=null)}else s=null;var i=/^\s*class\b/,o=function(e){try{var t=r.call(e);return i.test(t)}catch(e){return!1}},a=function(e){try{return!o(e)&&(r.call(e),!0)}catch(e){return!1}},c=Object.prototype.toString,u="function"==typeof Symbol&&!!Symbol.toStringTag,l=!(0 in[,]),h=function(){return!1};if("object"==typeof document){var f=document.all;c.call(f)===c.call(document.all)&&(h=function(e){if((l||!e)&&(void 0===e||"object"==typeof e))try{var t=c.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(e){}return!1})}e.exports=s?function(e){if(h(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{s(e,null,t)}catch(e){if(e!==n)return!1}return!o(e)&&a(e)}:function(e){if(h(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(u)return a(e);if(o(e))return!1;var t=c.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&a(e)}},82734:function(e){"use strict";var t=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i;e.exports=function(e,n){if(null==n&&(n=!1),e.length<2)return!1;if(e.length>255)return!1;var r=e[e.length-1];if(n){if("."!==r)return!1}else if("."===r)return!1;return t.test(e)}},59134:function(e,t,n){var r=n(34155);e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!(void 0===r||"object"!=typeof r.versions||!r.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}},48662:function(e,t,n){"use strict";var r,s=Object.prototype.toString,i=Function.prototype.toString,o=/^\s*(?:function)?\*/,a=n(96410)(),c=Object.getPrototypeOf;e.exports=function(e){if("function"!=typeof e)return!1;if(o.test(i.call(e)))return!0;if(!a)return"[object GeneratorFunction]"===s.call(e);if(!c)return!1;if(void 0===r){var t=function(){if(!a)return!1;try{return Function("return function*() {}")()}catch(e){}}();r=!!t&&c(t)}return c(e)===r}},98611:function(e){"use strict";e.exports=function(e){return e!=e}},20360:function(e,t,n){"use strict";var r=n(55559),s=n(4289),i=n(98611),o=n(29415),a=n(23194),c=r(o(),Number);s(c,{getPolyfill:o,implementation:i,shim:a}),e.exports=c},29415:function(e,t,n){"use strict";var r=n(98611);e.exports=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:r}},23194:function(e,t,n){"use strict";var r=n(4289),s=n(29415);e.exports=function(){var e=s();return r(Number,{isNaN:e},{isNaN:function(){return Number.isNaN!==e}}),e}},85692:function(e,t,n){"use strict";var r=n(94029),s=n(63083),i=n(21924),o=i("Object.prototype.toString"),a=n(96410)(),c=n(27296),u="undefined"==typeof globalThis?n.g:globalThis,l=s(),h=i("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},f=i("String.prototype.slice"),p={},d=Object.getPrototypeOf;a&&c&&d&&r(l,(function(e){var t=new u[e];if(Symbol.toStringTag in t){var n=d(t),r=c(n,Symbol.toStringTag);if(!r){var s=d(n);r=c(s,Symbol.toStringTag)}p[e]=r.get}}));e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!a||!(Symbol.toStringTag in e)){var t=f(o(e),8,-1);return h(l,t)>-1}return!!c&&function(e){var t=!1;return r(p,(function(n,r){if(!t)try{t=n.call(e)===r}catch(e){}})),t}(e)}},71993:function(e){"use strict";e.exports={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:256,RTLD_LOCAL:0,RTLD_DEEPBIND:8,E2BIG:7,EACCES:13,EADDRINUSE:98,EADDRNOTAVAIL:99,EAFNOSUPPORT:97,EAGAIN:11,EALREADY:114,EBADF:9,EBADMSG:74,EBUSY:16,ECANCELED:125,ECHILD:10,ECONNABORTED:103,ECONNREFUSED:111,ECONNRESET:104,EDEADLK:35,EDESTADDRREQ:89,EDOM:33,EDQUOT:122,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:113,EIDRM:43,EILSEQ:84,EINPROGRESS:115,EINTR:4,EINVAL:22,EIO:5,EISCONN:106,EISDIR:21,ELOOP:40,EMFILE:24,EMLINK:31,EMSGSIZE:90,EMULTIHOP:72,ENAMETOOLONG:36,ENETDOWN:100,ENETRESET:102,ENETUNREACH:101,ENFILE:23,ENOBUFS:105,ENODATA:61,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:37,ENOLINK:67,ENOMEM:12,ENOMSG:42,ENOPROTOOPT:92,ENOSPC:28,ENOSR:63,ENOSTR:60,ENOSYS:38,ENOTCONN:107,ENOTDIR:20,ENOTEMPTY:39,ENOTSOCK:88,ENOTSUP:95,ENOTTY:25,ENXIO:6,EOPNOTSUPP:95,EOVERFLOW:75,EPERM:1,EPIPE:32,EPROTO:71,EPROTONOSUPPORT:93,EPROTOTYPE:91,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:116,ETIME:62,ETIMEDOUT:110,ETXTBSY:26,EWOULDBLOCK:11,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:7,SIGFPE:8,SIGKILL:9,SIGUSR1:10,SIGSEGV:11,SIGUSR2:12,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:17,SIGSTKFLT:16,SIGCONT:18,SIGSTOP:19,SIGTSTP:20,SIGTTIN:21,SIGTTOU:22,SIGURG:23,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:29,SIGPOLL:29,SIGPWR:30,SIGSYS:31,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,UV_FS_O_FILEMAP:0,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DSYNC:4096,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:805306496,SSL_OP_ALL:2147485776,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,defaultCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA"}},1914:function(e){"use strict";const t=65536;e.exports=function(e){const n=new Uint8Array(e);let r=0;if(e>0)if(e>t)for(;r<e;)r+t>e?(crypto.getRandomValues(n.subarray(r,r+(e-r))),r+=e-r):(crypto.getRandomValues(n.subarray(r,r+t)),r+=t);else crypto.getRandomValues(n);return n}},17745:function(e,t,n){"use strict";const{URLWithLegacySupport:r,format:s,URLSearchParams:i,defaultBase:o}=n(82049),a=n(15939);e.exports={URL:r,URLSearchParams:i,format:s,relative:a,defaultBase:o}},15939:function(e,t,n){"use strict";const{URLWithLegacySupport:r,format:s}=n(82049);e.exports=(e,t={},n={},i)=>{let o,a=t.protocol?t.protocol.replace(":",""):"http";a=(n[a]||i||a)+":";try{o=new r(e)}catch(e){o={}}const c=Object.assign({},t,{protocol:a||o.protocol,host:t.host||o.host});return new r(e,s(c)).toString()}},82049:function(e){"use strict";const t="undefined"!=typeof navigator&&"ReactNative"===navigator.product;const n=self.URL,r=t?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:"";e.exports={URLWithLegacySupport:class{constructor(e="",t=r){this.super=new n(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return n.createObjectURL(e)}static revokeObjectURL(e){n.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}},URLSearchParams:self.URLSearchParams,defaultBase:r,format:function(e){if("string"==typeof e){return new n(e).toString()}if(!(e instanceof n)){const t=e.username&&e.password?`${e.username}:${e.password}@`:"",n=e.auth?e.auth+"@":"",r=e.port?":"+e.port:"",s=e.protocol?e.protocol+"//":"",i=e.host||"",o=e.hostname||"",a=e.search||(e.query?"?"+e.query:""),c=e.hash||"",u=e.pathname||"";return`${s}${t||n}${i||o+r}${e.path||u+a}${c}`}}}},64482:function(e,t,n){var r,s,i;s=[n(62100)],void 0===(i="function"==typeof(r=function(e){"use strict";var t=e.Reader,n=e.Writer,r=e.util,s=e.roots.default||(e.roots.default={});return s.RPC=function(){function i(e){if(this.subscriptions=[],this.messages=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.subscriptions=r.emptyArray,i.prototype.messages=r.emptyArray,i.prototype.control=null,Object.defineProperty(i.prototype,"_control",{get:r.oneOfGetter(o=["control"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=n.create()),null!=e.subscriptions&&e.subscriptions.length)for(var r=0;r<e.subscriptions.length;++r)s.RPC.SubOpts.encode(e.subscriptions[r],t.uint32(10).fork()).ldelim();if(null!=e.messages&&e.messages.length)for(r=0;r<e.messages.length;++r)s.RPC.Message.encode(e.messages[r],t.uint32(18).fork()).ldelim();return null!=e.control&&Object.hasOwnProperty.call(e,"control")&&s.RPC.ControlMessage.encode(e.control,t.uint32(26).fork()).ldelim(),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.push(s.RPC.SubOpts.decode(e,e.uint32()));break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.push(s.RPC.Message.decode(e,e.uint32()));break;case 3:i.control=s.RPC.ControlMessage.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC)return e;var t=new s.RPC;if(e.subscriptions){if(!Array.isArray(e.subscriptions))throw TypeError(".RPC.subscriptions: array expected");t.subscriptions=[];for(var n=0;n<e.subscriptions.length;++n){if("object"!=typeof e.subscriptions[n])throw TypeError(".RPC.subscriptions: object expected");t.subscriptions[n]=s.RPC.SubOpts.fromObject(e.subscriptions[n])}}if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".RPC.messages: array expected");for(t.messages=[],n=0;n<e.messages.length;++n){if("object"!=typeof e.messages[n])throw TypeError(".RPC.messages: object expected");t.messages[n]=s.RPC.Message.fromObject(e.messages[n])}}if(null!=e.control){if("object"!=typeof e.control)throw TypeError(".RPC.control: object expected");t.control=s.RPC.ControlMessage.fromObject(e.control)}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.subscriptions=[],n.messages=[]),e.subscriptions&&e.subscriptions.length){n.subscriptions=[];for(var r=0;r<e.subscriptions.length;++r)n.subscriptions[r]=s.RPC.SubOpts.toObject(e.subscriptions[r],t)}if(e.messages&&e.messages.length)for(n.messages=[],r=0;r<e.messages.length;++r)n.messages[r]=s.RPC.Message.toObject(e.messages[r],t);return null!=e.control&&e.hasOwnProperty("control")&&(n.control=s.RPC.ControlMessage.toObject(e.control,t),t.oneofs&&(n._control="control")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i.SubOpts=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.subscribe=null,i.prototype.topic=null,Object.defineProperty(i.prototype,"_subscribe",{get:r.oneOfGetter(o=["subscribe"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_topic",{get:r.oneOfGetter(o=["topic"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.subscribe&&Object.hasOwnProperty.call(e,"subscribe")&&t.uint32(8).bool(e.subscribe),null!=e.topic&&Object.hasOwnProperty.call(e,"topic")&&t.uint32(18).string(e.topic),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC.SubOpts;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.subscribe=e.bool();break;case 2:i.topic=e.string();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.SubOpts)return e;var t=new s.RPC.SubOpts;return null!=e.subscribe&&(t.subscribe=Boolean(e.subscribe)),null!=e.topic&&(t.topic=String(e.topic)),t},i.toObject=function(e,t){t||(t={});var n={};return null!=e.subscribe&&e.hasOwnProperty("subscribe")&&(n.subscribe=e.subscribe,t.oneofs&&(n._subscribe="subscribe")),null!=e.topic&&e.hasOwnProperty("topic")&&(n.topic=e.topic,t.oneofs&&(n._topic="topic")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.Message=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.from=null,i.prototype.data=null,i.prototype.seqno=null,i.prototype.topic="",i.prototype.signature=null,i.prototype.key=null,Object.defineProperty(i.prototype,"_from",{get:r.oneOfGetter(o=["from"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_data",{get:r.oneOfGetter(o=["data"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_seqno",{get:r.oneOfGetter(o=["seqno"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signature",{get:r.oneOfGetter(o=["signature"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_key",{get:r.oneOfGetter(o=["key"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.from&&Object.hasOwnProperty.call(e,"from")&&t.uint32(10).bytes(e.from),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.seqno&&Object.hasOwnProperty.call(e,"seqno")&&t.uint32(26).bytes(e.seqno),t.uint32(34).string(e.topic),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(50).bytes(e.key),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var i=void 0===n?e.len:e.pos+n,o=new s.RPC.Message;e.pos<i;){var a=e.uint32();switch(a>>>3){case 1:o.from=e.bytes();break;case 2:o.data=e.bytes();break;case 3:o.seqno=e.bytes();break;case 4:o.topic=e.string();break;case 5:o.signature=e.bytes();break;case 6:o.key=e.bytes();break;default:e.skipType(7&a)}}if(!o.hasOwnProperty("topic"))throw r.ProtocolError("missing required 'topic'",{instance:o});return o},i.fromObject=function(e){if(e instanceof s.RPC.Message)return e;var t=new s.RPC.Message;return null!=e.from&&("string"==typeof e.from?r.base64.decode(e.from,t.from=r.newBuffer(r.base64.length(e.from)),0):e.from.length&&(t.from=e.from)),null!=e.data&&("string"==typeof e.data?r.base64.decode(e.data,t.data=r.newBuffer(r.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.seqno&&("string"==typeof e.seqno?r.base64.decode(e.seqno,t.seqno=r.newBuffer(r.base64.length(e.seqno)),0):e.seqno.length&&(t.seqno=e.seqno)),null!=e.topic&&(t.topic=String(e.topic)),null!=e.signature&&("string"==typeof e.signature?r.base64.decode(e.signature,t.signature=r.newBuffer(r.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.key&&("string"==typeof e.key?r.base64.decode(e.key,t.key=r.newBuffer(r.base64.length(e.key)),0):e.key.length&&(t.key=e.key)),t},i.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.topic=""),null!=e.from&&e.hasOwnProperty("from")&&(n.from=t.bytes===String?r.base64.encode(e.from,0,e.from.length):t.bytes===Array?Array.prototype.slice.call(e.from):e.from,t.oneofs&&(n._from="from")),null!=e.data&&e.hasOwnProperty("data")&&(n.data=t.bytes===String?r.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data,t.oneofs&&(n._data="data")),null!=e.seqno&&e.hasOwnProperty("seqno")&&(n.seqno=t.bytes===String?r.base64.encode(e.seqno,0,e.seqno.length):t.bytes===Array?Array.prototype.slice.call(e.seqno):e.seqno,t.oneofs&&(n._seqno="seqno")),null!=e.topic&&e.hasOwnProperty("topic")&&(n.topic=e.topic),null!=e.signature&&e.hasOwnProperty("signature")&&(n.signature=t.bytes===String?r.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature,t.oneofs&&(n._signature="signature")),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.bytes===String?r.base64.encode(e.key,0,e.key.length):t.bytes===Array?Array.prototype.slice.call(e.key):e.key,t.oneofs&&(n._key="key")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlMessage=function(){function i(e){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return i.prototype.ihave=r.emptyArray,i.prototype.iwant=r.emptyArray,i.prototype.graft=r.emptyArray,i.prototype.prune=r.emptyArray,i.encode=function(e,t){if(t||(t=n.create()),null!=e.ihave&&e.ihave.length)for(var r=0;r<e.ihave.length;++r)s.RPC.ControlIHave.encode(e.ihave[r],t.uint32(10).fork()).ldelim();if(null!=e.iwant&&e.iwant.length)for(r=0;r<e.iwant.length;++r)s.RPC.ControlIWant.encode(e.iwant[r],t.uint32(18).fork()).ldelim();if(null!=e.graft&&e.graft.length)for(r=0;r<e.graft.length;++r)s.RPC.ControlGraft.encode(e.graft[r],t.uint32(26).fork()).ldelim();if(null!=e.prune&&e.prune.length)for(r=0;r<e.prune.length;++r)s.RPC.ControlPrune.encode(e.prune[r],t.uint32(34).fork()).ldelim();return t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlMessage;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.push(s.RPC.ControlIHave.decode(e,e.uint32()));break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.push(s.RPC.ControlIWant.decode(e,e.uint32()));break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.push(s.RPC.ControlGraft.decode(e,e.uint32()));break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.push(s.RPC.ControlPrune.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlMessage)return e;var t=new s.RPC.ControlMessage;if(e.ihave){if(!Array.isArray(e.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");t.ihave=[];for(var n=0;n<e.ihave.length;++n){if("object"!=typeof e.ihave[n])throw TypeError(".RPC.ControlMessage.ihave: object expected");t.ihave[n]=s.RPC.ControlIHave.fromObject(e.ihave[n])}}if(e.iwant){if(!Array.isArray(e.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");for(t.iwant=[],n=0;n<e.iwant.length;++n){if("object"!=typeof e.iwant[n])throw TypeError(".RPC.ControlMessage.iwant: object expected");t.iwant[n]=s.RPC.ControlIWant.fromObject(e.iwant[n])}}if(e.graft){if(!Array.isArray(e.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");for(t.graft=[],n=0;n<e.graft.length;++n){if("object"!=typeof e.graft[n])throw TypeError(".RPC.ControlMessage.graft: object expected");t.graft[n]=s.RPC.ControlGraft.fromObject(e.graft[n])}}if(e.prune){if(!Array.isArray(e.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");for(t.prune=[],n=0;n<e.prune.length;++n){if("object"!=typeof e.prune[n])throw TypeError(".RPC.ControlMessage.prune: object expected");t.prune[n]=s.RPC.ControlPrune.fromObject(e.prune[n])}}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.ihave=[],n.iwant=[],n.graft=[],n.prune=[]),e.ihave&&e.ihave.length){n.ihave=[];for(var r=0;r<e.ihave.length;++r)n.ihave[r]=s.RPC.ControlIHave.toObject(e.ihave[r],t)}if(e.iwant&&e.iwant.length)for(n.iwant=[],r=0;r<e.iwant.length;++r)n.iwant[r]=s.RPC.ControlIWant.toObject(e.iwant[r],t);if(e.graft&&e.graft.length)for(n.graft=[],r=0;r<e.graft.length;++r)n.graft[r]=s.RPC.ControlGraft.toObject(e.graft[r],t);if(e.prune&&e.prune.length)for(n.prune=[],r=0;r<e.prune.length;++r)n.prune[r]=s.RPC.ControlPrune.toObject(e.prune[r],t);return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIHave=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.topicID=null,i.prototype.messageIDs=r.emptyArray,Object.defineProperty(i.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=n.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.messageIDs&&e.messageIDs.length)for(var r=0;r<e.messageIDs.length;++r)t.uint32(18).bytes(e.messageIDs[r]);return t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlIHave;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes());break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIHave)return e;var t=new s.RPC.ControlIHave;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");t.messageIDs=[];for(var n=0;n<e.messageIDs.length;++n)"string"==typeof e.messageIDs[n]?r.base64.decode(e.messageIDs[n],t.messageIDs[n]=r.newBuffer(r.base64.length(e.messageIDs[n])),0):e.messageIDs[n].length&&(t.messageIDs[n]=e.messageIDs[n])}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.messageIDs=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(n.topicID=e.topicID,t.oneofs&&(n._topicID="topicID")),e.messageIDs&&e.messageIDs.length){n.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)n.messageIDs[s]=t.bytes===String?r.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIWant=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return i.prototype.messageIDs=r.emptyArray,i.encode=function(e,t){if(t||(t=n.create()),null!=e.messageIDs&&e.messageIDs.length)for(var r=0;r<e.messageIDs.length;++r)t.uint32(10).bytes(e.messageIDs[r]);return t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlIWant;e.pos<r;){var o=e.uint32();o>>>3==1?(i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes())):e.skipType(7&o)}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIWant)return e;var t=new s.RPC.ControlIWant;if(e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");t.messageIDs=[];for(var n=0;n<e.messageIDs.length;++n)"string"==typeof e.messageIDs[n]?r.base64.decode(e.messageIDs[n],t.messageIDs[n]=r.newBuffer(r.base64.length(e.messageIDs[n])),0):e.messageIDs[n].length&&(t.messageIDs[n]=e.messageIDs[n])}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.messageIDs=[]),e.messageIDs&&e.messageIDs.length){n.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)n.messageIDs[s]=t.bytes===String?r.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlGraft=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.topicID=null,Object.defineProperty(i.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlGraft;e.pos<r;){var o=e.uint32();o>>>3==1?i.topicID=e.string():e.skipType(7&o)}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlGraft)return e;var t=new s.RPC.ControlGraft;return null!=e.topicID&&(t.topicID=String(e.topicID)),t},i.toObject=function(e,t){t||(t={});var n={};return null!=e.topicID&&e.hasOwnProperty("topicID")&&(n.topicID=e.topicID,t.oneofs&&(n._topicID="topicID")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlPrune=function(){function i(e){if(this.peers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.topicID=null,i.prototype.peers=r.emptyArray,i.prototype.backoff=null,Object.defineProperty(i.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_backoff",{get:r.oneOfGetter(o=["backoff"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=n.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.peers&&e.peers.length)for(var r=0;r<e.peers.length;++r)s.RPC.PeerInfo.encode(e.peers[r],t.uint32(18).fork()).ldelim();return null!=e.backoff&&Object.hasOwnProperty.call(e,"backoff")&&t.uint32(24).uint64(e.backoff),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlPrune;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),i.peers.push(s.RPC.PeerInfo.decode(e,e.uint32()));break;case 3:i.backoff=e.uint64();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlPrune)return e;var t=new s.RPC.ControlPrune;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.peers){if(!Array.isArray(e.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");t.peers=[];for(var n=0;n<e.peers.length;++n){if("object"!=typeof e.peers[n])throw TypeError(".RPC.ControlPrune.peers: object expected");t.peers[n]=s.RPC.PeerInfo.fromObject(e.peers[n])}}return null!=e.backoff&&(r.Long?(t.backoff=r.Long.fromValue(e.backoff)).unsigned=!0:"string"==typeof e.backoff?t.backoff=parseInt(e.backoff,10):"number"==typeof e.backoff?t.backoff=e.backoff:"object"==typeof e.backoff&&(t.backoff=new r.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0))),t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.peers=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(n.topicID=e.topicID,t.oneofs&&(n._topicID="topicID")),e.peers&&e.peers.length){n.peers=[];for(var i=0;i<e.peers.length;++i)n.peers[i]=s.RPC.PeerInfo.toObject(e.peers[i],t)}return null!=e.backoff&&e.hasOwnProperty("backoff")&&("number"==typeof e.backoff?n.backoff=t.longs===String?String(e.backoff):e.backoff:n.backoff=t.longs===String?r.Long.prototype.toString.call(e.backoff):t.longs===Number?new r.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0):e.backoff,t.oneofs&&(n._backoff="backoff")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.PeerInfo=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.peerID=null,i.prototype.signedPeerRecord=null,Object.defineProperty(i.prototype,"_peerID",{get:r.oneOfGetter(o=["peerID"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signedPeerRecord",{get:r.oneOfGetter(o=["signedPeerRecord"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.peerID&&Object.hasOwnProperty.call(e,"peerID")&&t.uint32(10).bytes(e.peerID),null!=e.signedPeerRecord&&Object.hasOwnProperty.call(e,"signedPeerRecord")&&t.uint32(18).bytes(e.signedPeerRecord),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));for(var r=void 0===n?e.len:e.pos+n,i=new s.RPC.PeerInfo;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.peerID=e.bytes();break;case 2:i.signedPeerRecord=e.bytes();break;default:e.skipType(7&o)}}return i},i.fromObject=function(e){if(e instanceof s.RPC.PeerInfo)return e;var t=new s.RPC.PeerInfo;return null!=e.peerID&&("string"==typeof e.peerID?r.base64.decode(e.peerID,t.peerID=r.newBuffer(r.base64.length(e.peerID)),0):e.peerID.length&&(t.peerID=e.peerID)),null!=e.signedPeerRecord&&("string"==typeof e.signedPeerRecord?r.base64.decode(e.signedPeerRecord,t.signedPeerRecord=r.newBuffer(r.base64.length(e.signedPeerRecord)),0):e.signedPeerRecord.length&&(t.signedPeerRecord=e.signedPeerRecord)),t},i.toObject=function(e,t){t||(t={});var n={};return null!=e.peerID&&e.hasOwnProperty("peerID")&&(n.peerID=t.bytes===String?r.base64.encode(e.peerID,0,e.peerID.length):t.bytes===Array?Array.prototype.slice.call(e.peerID):e.peerID,t.oneofs&&(n._peerID="peerID")),null!=e.signedPeerRecord&&e.hasOwnProperty("signedPeerRecord")&&(n.signedPeerRecord=t.bytes===String?r.base64.encode(e.signedPeerRecord,0,e.signedPeerRecord.length):t.bytes===Array?Array.prototype.slice.call(e.signedPeerRecord):e.signedPeerRecord,t.oneofs&&(n._signedPeerRecord="signedPeerRecord")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i}(),s})?r.apply(t,s):r)||(e.exports=i)},63083:function(e,t,n){"use strict";var r=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],s="undefined"==typeof globalThis?n.g:globalThis;e.exports=function(){for(var e=[],t=0;t<r.length;t++)"function"==typeof s[r[t]]&&(e[e.length]=r[t]);return e}},42734:function(e,t,n){"use strict";async function r(){throw new Error("Not supported in browsers")}n.d(t,{h:function(){return r}})},49736:function(e,t,n){"use strict";n.d(t,{C:function(){return s},aY:function(){return i},h6:function(){return o}});var r=n(1262);function s(e){return Boolean((0,r.cs)(e))}function i(e){return Boolean((0,r.XK)(e))}function o(e){return Boolean((0,r.yb)(e))}},1262:function(e,t,n){"use strict";n.d(t,{yb:function(){return c},cs:function(){return o},XK:function(){return a}});const r=45,s=15,i=new class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return void 0===n&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically((()=>{const t=this.readChar();if(t===e)return t}))}readSeparator(e,t,n){return this.readAtomically((()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return n()}))}readNumber(e,t,n,r){return this.readAtomically((()=>{let s=0,i=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*r)-1;for(;;){const n=this.readAtomically((()=>{const t=this.readChar();if(void 0===t)return;const n=Number.parseInt(t,e);return Number.isNaN(n)?void 0:n}));if(void 0===n)break;if(s*=e,s+=n,s>c)return;if(i+=1,void 0!==t&&i>t)return}return 0===i||!n&&a&&i>1?void 0:s}))}readIPv4Addr(){return this.readAtomically((()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,(()=>this.readNumber(10,3,!1,1)));if(void 0===n)return;e[t]=n}return e}))}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const n=2*t;if(t<e.length-3){const r=this.readSeparator(":",t,(()=>this.readIPv4Addr()));if(void 0!==r)return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],[n+4,!0]}const r=this.readSeparator(":",t,(()=>this.readNumber(16,4,!0,2)));if(void 0===r)return[n,!1];e[n]=r>>8,e[n+1]=255&r}return[e.length,!1]};return this.readAtomically((()=>{const t=new Uint8Array(16),[n,r]=e(t);if(16===n)return t;if(r)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const s=new Uint8Array(14),i=16-(n+2),[o]=e(s.subarray(0,i));return t.set(s.subarray(0,o),16-o),t}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function o(e){if(!(e.length>s))return i.new(e).parseWith((()=>i.readIPv4Addr()))}function a(e){if(!(e.length>r))return i.new(e).parseWith((()=>i.readIPv6Addr()))}function c(e){if(!(e.length>r))return i.new(e).parseWith((()=>i.readIPAddr()))}},9839:function(e,t,n){"use strict";n(1262);parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255])},90560:function(e,t,n){"use strict";n.r(t),n.d(t,{code:function(){return u},decode:function(){return h},encode:function(){return l},name:function(){return c}});var r=n(64936),s=n(38161);const i=42;const o={float64:!0,typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=s.k0.asCID(e);if(!t)return null;const n=new Uint8Array(t.bytes.byteLength+1);return n.set(t.bytes,1),[new r.WU(r.Dy.tag,i),new r.WU(r.Dy.bytes,n)]},undefined:function(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};const a={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};a.tags[i]=function(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return s.k0.decode(e.subarray(1))};const c="dag-cbor",u=113,l=e=>r.cv(e,o),h=e=>r.Jx(e,a)},36921:function(e,t,n){"use strict";n.r(t),n.d(t,{code:function(){return w},decode:function(){return E},encode:function(){return v},format:function(){return _},name:function(){return b},parse:function(){return S},stringify:function(){return _}});var r=n(11015),s=n(99382),i=n(64936),o=n(59787),a=n(72696),c=n(85590),u=n(22042);class l extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===o.D.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===o.D.map&&(t.elements++,1!==t.elements&&(t.elements%2==1?e.push([44]):e.push([58]))))}[o.D.uint.major](e,t){this.prefix(e);const n=String(t.value),r=[];for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);e.push(r)}[o.D.negint.major](e,t){this[o.D.uint.major](e,t)}[o.D.bytes.major](e,t){throw new Error(`${c.OO} unsupported type: Uint8Array`)}[o.D.string.major](e,t){this.prefix(e);const n=(0,u.mL)(JSON.stringify(t.value));e.push(n.length>32?(0,u.Dz)(n):n)}[o.D.array.major](e,t){this.prefix(e),this.inRecursive.push({type:o.D.array,elements:0}),e.push([91])}[o.D.map.major](e,t){this.prefix(e),this.inRecursive.push({type:o.D.map,elements:0}),e.push([123])}[o.D.tag.major](e,t){}[o.D.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===o.D.array)e.push([93]);else{if(t.type!==o.D.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${c.OO} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const n=String(t.value),r=[];let s=!1;for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e),s||46!==r[e]&&101!==r[e]&&69!==r[e]||(s=!0);s||(r.push(46),r.push(48)),e.push(r)}}const h={addBreakTokens:!0,mapSorter:function(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${c.OO} complex map keys are not supported`);const n=e[0],r=t[0];if(n.type!==o.D.string||r.type!==o.D.string)throw new Error(`${c.OO} non-string map keys are not supported`);if(n<r)return-1;if(n>r)return 1;throw new Error(`${c.OO} unexpected duplicate map keys, this is not supported`)}};var f=n(61287);class p{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${c.IR} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${c.IR} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,n=!1;const r=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this.pos++}};if(45===this.ch()&&(t=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new o.W(o.D.uint,0,this.pos-e);this.pos++,n=!0}if(r([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${c.IR} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(n)throw new Error(`${c.IR} unexpected token at position ${this.pos}`);n=!0,this.pos++,r([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(n=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,r([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),i=parseFloat(s);return n?new o.W(o.D.float,i,this.pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(i)?new o.W(i>=0?o.D.uint:o.D.negint,i,this.pos-e):new o.W(i>=0?o.D.uint:o.D.negint,BigInt(s),this.pos-e)}parseString(){if(34!==this.ch())throw new Error(`${c.IR} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let e=this.pos,t=0;e<this.data.length&&t<65536;e++,t++){const n=this.data[e];if(92===n||n<32||n>=128)break;if(34===n){const n=String.fromCharCode.apply(null,this.data.subarray(this.pos,e));return this.pos=e+1,new o.W(o.D.string,n,t)}}const e=this.pos,t=[],n=()=>{if(this.pos+4>=this.data.length)throw new Error(`${c.IR} unexpected end of unicode escape sequence at position ${this.pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${c.IR} unexpected unicode escape character at position ${this.pos}`);t=t-65+10}e=16*e+t,this.pos++}return e},r=()=>{const e=this.ch();let n,r,s,i,o=null,a=e>239?4:e>223?3:e>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${c.IR} unexpected unicode sequence at position ${this.pos}`);switch(a){case 1:e<128&&(o=e);break;case 2:n=this.data[this.pos+1],128==(192&n)&&(i=(31&e)<<6|63&n,i>127&&(o=i));break;case 3:n=this.data[this.pos+1],r=this.data[this.pos+2],128==(192&n)&&128==(192&r)&&(i=(15&e)<<12|(63&n)<<6|63&r,i>2047&&(i<55296||i>57343)&&(o=i));break;case 4:n=this.data[this.pos+1],r=this.data[this.pos+2],s=this.data[this.pos+3],128==(192&n)&&128==(192&r)&&128==(192&s)&&(i=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&s,i>65535&&i<1114112&&(o=i))}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this.pos+=a};for(;!this.done();){const s=this.ch();let i;switch(s){case 92:if(this.pos++,this.done())throw new Error(`${c.IR} unexpected string termination at position ${this.pos}`);switch(i=this.ch(),this.pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${c.IR} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new o.W(o.D.string,(0,u.Pu)(t),this.pos-e);default:if(s<32)throw new Error(`${c.IR} invalid control character at position ${this.pos}`);s<128?(t.push(s),this.pos++):r()}}throw new Error(`${c.IR} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new o.W(o.D.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new o.W(o.D.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new o.W(o.D.null,null,4);case 102:return this.expect([102,97,108,115,101]),new o.W(o.D.false,!1,5);case 116:return this.expect([116,114,117,101]),new o.W(o.D.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${c.IR} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new o.W(o.D.break,void 0,1);if(44!==this.ch())throw new Error(`${c.IR} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new o.W(o.D.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new o.W(o.D.break,void 0,1);if(44!==this.ch())throw new Error(`${c.IR} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new o.W(o.D.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${c.IR} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${c.IR} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function d(e){const t=s.base64.encode(e).slice(1);return[new i.WU(i.Dy.map,1/0,1),new i.WU(i.Dy.string,"/",1),new i.WU(i.Dy.map,1/0,1),new i.WU(i.Dy.string,"bytes",5),new i.WU(i.Dy.string,t,t.length),new i.WU(i.Dy.break,void 0,1),new i.WU(i.Dy.break,void 0,1)]}const y={typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=r.k0.asCID(e);if(!t)return null;const n=t.toString();return[new i.WU(i.Dy.map,1/0,1),new i.WU(i.Dy.string,"/",1),new i.WU(i.Dy.string,n,n.length),new i.WU(i.Dy.break,void 0,1)]},Uint8Array:d,Buffer:d,undefined:function(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};class g extends p{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===i.Dy.map){const e=this._next();if(e.type===i.Dy.string&&"/"===e.value){const e=this._next();if(e.type===i.Dy.string){if(this._next().type!==i.Dy.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new i.WU(i.Dy.tag,42,0)}if(e.type===i.Dy.map){const e=this._next();if(e.type===i.Dy.string&&"bytes"===e.value){const e=this._next();if(e.type===i.Dy.string){for(let e=0;e<2;e++){if(this._next().type!==i.Dy.break)throw new Error("Invalid encoded Bytes form")}const t=s.base64.decode(`m${e.value}`);return new i.WU(i.Dy.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}const m={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};m.tags[42]=r.k0.parse;const b="dag-json",w=297,v=e=>{return t=e,n=y,n=Object.assign({},h,n),(0,a.w$)(t,new l,n);var t,n},E=e=>function(e,t){return t=Object.assign({tokenizer:new p(e,t)},t),(0,f.Jx)(e,t)}(e,Object.assign(m,{tokenizer:new g(e,m)})),_=e=>k.decode(v(e)),k=new TextDecoder,S=e=>E(T.encode(e)),T=new TextEncoder},33808:function(e,t,n){"use strict";n.r(t),n.d(t,{code:function(){return O},createLink:function(){return I},createNode:function(){return A},decode:function(){return R},encode:function(){return P},name:function(){return x},prepare:function(){return S},validate:function(){return T}});var r=n(38161);const s=new TextDecoder;function i(e,t){let n=0;for(let r=0;;r+=7){if(r>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const s=e[t++];if(n+=r<28?(127&s)<<r:(127&s)*2**r,s<128)break}return[n,t]}function o(e,t){let n;[n,t]=i(e,t);const r=t+n;if(n<0||r<0)throw new Error("protobuf: invalid length");if(r>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,r),r]}function a(e,t){let n;return[n,t]=i(e,t),[7&n,n>>3,t]}function c(e){const t={},n=e.length;let r=0;for(;r<n;){let n,c;if([n,c,r]=a(e,r),1===c){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,r]=o(e,r)}else if(2===c){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,r]=o(e,r),t.Name=s.decode(i)}else{if(3!==c)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${c}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Tsize`);[t.Tsize,r]=i(e,r)}}if(r>n)throw new Error("protobuf: (PBLink) unexpected end of data");return t}const u=new TextEncoder,l=2**32,h=2**31;function f(e,t){let n=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");n=y(t,n,e.Tsize)-1,t[n]=24}if("string"==typeof e.Name){const r=u.encode(e.Name);n-=r.length,t.set(r,n),n=y(t,n,r.length)-1,t[n]=18}return e.Hash&&(n-=e.Hash.length,t.set(e.Hash,n),n=y(t,n,e.Hash.length)-1,t[n]=10),t.length-n}function p(e){const t=function(e){let t=0;if(e.Data){const n=e.Data.length;t+=1+n+g(n)}if(e.Links)for(const n of e.Links){const e=d(n);t+=1+e+g(e)}return t}(e),n=new Uint8Array(t);let r=t;if(e.Data&&(r-=e.Data.length,n.set(e.Data,r),r=y(n,r,e.Data.length)-1,n[r]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){const s=f(e.Links[t],n.subarray(0,r));r-=s,r=y(n,r,s)-1,n[r]=18}return n}function d(e){let t=0;if(e.Hash){const n=e.Hash.length;t+=1+n+g(n)}if("string"==typeof e.Name){const n=u.encode(e.Name).length;t+=1+n+g(n)}return"number"==typeof e.Tsize&&(t+=1+g(e.Tsize)),t}function y(e,t,n){const r=t-=g(n);for(;n>=h;)e[t++]=127&n|128,n/=128;for(;n>=128;)e[t++]=127&n|128,n>>>=7;return e[t]=n,r}function g(e){return e%2==0&&e++,Math.floor((function(e){let t=0;e>=l&&(e=Math.floor(e/l),t=32);e>=65536&&(e>>>=16,t+=16);e>=256&&(e>>>=8,t+=8);return t+m[e]}(e)+6)/7)}const m=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],b=["Data","Links"],w=["Hash","Name","Tsize"],v=new TextEncoder;function E(e,t){if(e===t)return 0;const n=e.Name?v.encode(e.Name):[],r=t.Name?v.encode(t.Name):[];let s=n.length,i=r.length;for(let e=0,t=Math.min(s,i);e<t;++e)if(n[e]!==r[e]){s=n[e],i=r[e];break}return s<i?-1:i<s?1:0}function _(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function k(e){if("object"==typeof e.asCID){const t=r.k0.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(e.Hash){let n=r.k0.asCID(e.Hash);try{n||("string"==typeof e.Hash?n=r.k0.parse(e.Hash):e.Hash instanceof Uint8Array&&(n=r.k0.decode(e.Hash)))}catch(e){throw new TypeError(`Invalid DAG-PB form: ${e.message}`)}n&&(t.Hash=n)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function S(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=v.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(k),t.Links.sort(E)}else t.Links=[];return t}function T(e){if(!e||"object"!=typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!_(e,b))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){const n=e.Links[t];if(!n||"object"!=typeof n||Array.isArray(n)||n instanceof Uint8Array||n["/"]&&n["/"]===n.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!_(n,w))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===n.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==n.Hash||!n.Hash["/"]||n.Hash["/"]!==n.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==n.Name&&"string"!=typeof n.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==n.Tsize){if("number"!=typeof n.Tsize||n.Tsize%1!=0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(n.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===E(n,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function A(e,t=[]){return S({Data:e,Links:t})}function I(e,t,n){return k({Hash:n,Name:e,Tsize:t})}const x="dag-pb",O=112;function P(e){T(e);const t={};return e.Links&&(t.Links=e.Links.map((e=>{const t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),p(t)}function R(e){const t=function(e){const t=e.length;let n,r,s=0,i=!1;for(;s<t;){let t,u;if([t,u,s]=a(e,s),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===u){if(r)throw new Error("protobuf: (PBNode) duplicate Data section");[r,s]=o(e,s),n&&(i=!0)}else{if(2!==u)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${u}`);{if(i)throw new Error("protobuf: (PBNode) duplicate Links section");let t;n||(n=[]),[t,s]=o(e,s),n.push(c(t))}}}if(s>t)throw new Error("protobuf: (PBNode) unexpected end of data");const u={};return r&&(u.Data=r),u.Links=n||[],u}(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map((e=>{const t={};try{t.Hash=r.k0.decode(e.Hash)}catch(e){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),n}},2237:function(e,t,n){"use strict";n.d(t,{_L:function(){return r},D7:function(){return o},wJ:function(){return s}});class r extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function s(e,t,n){const s=n??{},i=function(e){if(null!=e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}(e);return async function*(){let n;const o=()=>{null!=n&&n()};for(t.addEventListener("abort",o);;){let a;try{if(t.aborted){const{abortMessage:e,abortCode:t}=s;throw new r(e,t)}const e=new Promise(((e,t)=>{n=()=>{const{abortMessage:e,abortCode:n}=s;t(new r(e,n))}}));a=await Promise.race([e,i.next()]),n=null}catch(n){t.removeEventListener("abort",o);const r="aborted"===n.type&&t.aborted;if(r&&null!=s.onAbort&&await s.onAbort(e),"function"==typeof i.return)try{const e=i.return();e instanceof Promise&&e.catch((e=>{null!=s.onReturnError&&s.onReturnError(e)}))}catch(e){null!=s.onReturnError&&s.onReturnError(e)}if(r&&!0===s.returnOnAbort)return;throw n}if(!0===a.done)break;yield a.value}t.removeEventListener("abort",o)}()}function i(e,t,n){return r=>e(s(r,t,n))}function o(e,t,n){return{sink:i(e.sink,t,{...n,onAbort:void 0}),source:s(e.source,t,n)}}},53597:function(e,t,n){"use strict";async function*r(e,t={}){const n=e.getReader();try{for(;;){const e=await n.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await n.cancel(),n.releaseLock()}}n.d(t,{Z:function(){return r}})},11067:function(e,t,n){"use strict";function r(e){return e instanceof Uint8Array?{get:t=>e[t],set(t,n){e[t]=n}}:{get:t=>e.get(t),set(t,n){e.set(t,n)}}}n.d(t,{Z:function(){return r}})},64936:function(e,t,n){"use strict";n.d(t,{Dy:function(){return i.D},Jx:function(){return s.Jx},WU:function(){return i.W},cv:function(){return r.cv}});var r=n(72696),s=n(61287),i=n(59787)},55580:function(e,t,n){"use strict";n.d(t,{Fh:function(){return d},Jl:function(){return c},Km:function(){return l},Tp:function(){return y},X0:function(){return a},YX:function(){return u},Zh:function(){return h},cs:function(){return f},kj:function(){return o},or:function(){return i},uN:function(){return p}});var r=n(59787),s=n(85590);const i=[24,256,65536,4294967296,BigInt("18446744073709551616")];function o(e,t,n){(0,s.DO)(e,t,1);const r=e[t];if(!0===n.strict&&r<i[0])throw new Error(`${s.IR} integer encoded in more bytes than necessary (strict decode)`);return r}function a(e,t,n){(0,s.DO)(e,t,2);const r=e[t]<<8|e[t+1];if(!0===n.strict&&r<i[1])throw new Error(`${s.IR} integer encoded in more bytes than necessary (strict decode)`);return r}function c(e,t,n){(0,s.DO)(e,t,4);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<i[2])throw new Error(`${s.IR} integer encoded in more bytes than necessary (strict decode)`);return r}function u(e,t,n){(0,s.DO)(e,t,8);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],a=(BigInt(r)<<BigInt(32))+BigInt(o);if(!0===n.strict&&a<i[3])throw new Error(`${s.IR} integer encoded in more bytes than necessary (strict decode)`);if(a<=Number.MAX_SAFE_INTEGER)return Number(a);if(!0===n.allowBigInt)return a;throw new Error(`${s.IR} integers outside of the safe integer range are not supported`)}function l(e,t,n,s){return new r.W(r.D.uint,o(e,t+1,s),2)}function h(e,t,n,s){return new r.W(r.D.uint,a(e,t+1,s),3)}function f(e,t,n,s){return new r.W(r.D.uint,c(e,t+1,s),5)}function p(e,t,n,s){return new r.W(r.D.uint,u(e,t+1,s),9)}function d(e,t){return y(e,0,t.value)}function y(e,t,n){if(n<i[0]){const r=Number(n);e.push([t|r])}else if(n<i[1]){const r=Number(n);e.push([24|t,r])}else if(n<i[2]){const r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<i[3]){const r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<i[4]))throw new Error(`${s.IR} encountered BigInt larger than allowable range`);{const n=[27|t,0,0,0,0,0,0,0];let s=Number(r&BigInt(4294967295)),i=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&s,s>>=8,n[7]=255&s,s>>=8,n[6]=255&s,s>>=8,n[5]=255&s,n[4]=255&i,i>>=8,n[3]=255&i,i>>=8,n[2]=255&i,i>>=8,n[1]=255&i,e.push(n)}}}d.encodedSize=function(e){return y.encodedSize(e.value)},y.encodedSize=function(e){return e<i[0]?1:e<i[1]?2:e<i[2]?3:e<i[3]?5:9},d.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}},53929:function(e,t,n){"use strict";n.d(t,{UT:function(){return f},ec:function(){return h},r0:function(){return a},wy:function(){return c},yr:function(){return o}});var r=n(59787),s=n(55580),i=n(85590);function o(e,t,n,i){return new r.W(r.D.negint,-1-s.kj(e,t+1,i),2)}function a(e,t,n,i){return new r.W(r.D.negint,-1-s.X0(e,t+1,i),3)}function c(e,t,n,i){return new r.W(r.D.negint,-1-s.Jl(e,t+1,i),5)}const u=BigInt(-1),l=BigInt(1);function h(e,t,n,o){const a=s.YX(e,t+1,o);if("bigint"!=typeof a){const e=-1-a;if(e>=Number.MIN_SAFE_INTEGER)return new r.W(r.D.negint,e,9)}if(!0!==o.allowBigInt)throw new Error(`${i.IR} integers outside of the safe integer range are not supported`);return new r.W(r.D.negint,u-BigInt(a),9)}function f(e,t){const n=t.value,r="bigint"==typeof n?n*u-l:-1*n-1;s.Tp(e,t.type.majorEncoded,r)}f.encodedSize=function(e){const t=e.value,n="bigint"==typeof t?t*u-l:-1*t-1;return n<s.or[0]?1:n<s.or[1]?2:n<s.or[2]?3:n<s.or[3]?5:9},f.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0}},92887:function(e,t,n){"use strict";n.d(t,{BS:function(){return l},Ii:function(){return c},ME:function(){return f},UQ:function(){return u},hg:function(){return d},zU:function(){return h}});var r=n(59787),s=n(85590),i=n(55580),o=n(22042);function a(e,t,n,i){(0,s.DO)(e,t,n+i);const a=(0,o.tP)(e,t+n,t+n+i);return new r.W(r.D.bytes,a,n+i)}function c(e,t,n,r){return a(e,t,1,n)}function u(e,t,n,r){return a(e,t,2,i.kj(e,t+1,r))}function l(e,t,n,r){return a(e,t,3,i.X0(e,t+1,r))}function h(e,t,n,r){return a(e,t,5,i.Jl(e,t+1,r))}function f(e,t,n,r){const o=i.YX(e,t+1,r);if("bigint"==typeof o)throw new Error(`${s.IR} 64-bit integer bytes lengths not supported`);return a(e,t,9,o)}function p(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===r.D.string?(0,o.mL)(e.value):e.value),e.encodedBytes}function d(e,t){const n=p(t);i.Tp(e,t.type.majorEncoded,n.length),e.push(n)}d.encodedSize=function(e){const t=p(e);return i.Tp.encodedSize(t.length)+t.length},d.compareTokens=function(e,t){return n=p(e),r=p(t),n.length<r.length?-1:n.length>r.length?1:(0,o.qu)(n,r);var n,r}},50768:function(e,t,n){"use strict";n.d(t,{Bq:function(){return l},YW:function(){return d},bc:function(){return p},h:function(){return h},nt:function(){return u},q0:function(){return f}});var r=n(59787),s=n(85590),i=n(55580),o=n(92887),a=n(22042);function c(e,t,n,i,o){const c=n+i;(0,s.DO)(e,t,c);const u=new r.W(r.D.string,(0,a.BB)(e,t+n,t+c),c);return!0===o.retainStringBytes&&(u.byteValue=(0,a.tP)(e,t+n,t+c)),u}function u(e,t,n,r){return c(e,t,1,n,r)}function l(e,t,n,r){return c(e,t,2,i.kj(e,t+1,r),r)}function h(e,t,n,r){return c(e,t,3,i.X0(e,t+1,r),r)}function f(e,t,n,r){return c(e,t,5,i.Jl(e,t+1,r),r)}function p(e,t,n,r){const o=i.YX(e,t+1,r);if("bigint"==typeof o)throw new Error(`${s.IR} 64-bit integer string lengths not supported`);return c(e,t,9,o,r)}const d=o.hg},8278:function(e,t,n){"use strict";n.d(t,{HF:function(){return p},Ju:function(){return a},OC:function(){return u},a8:function(){return h},h7:function(){return c},lY:function(){return l},s5:function(){return f}});var r=n(59787),s=n(55580),i=n(85590);function o(e,t,n,s){return new r.W(r.D.array,s,n)}function a(e,t,n,r){return o(0,0,1,n)}function c(e,t,n,r){return o(0,0,2,s.kj(e,t+1,r))}function u(e,t,n,r){return o(0,0,3,s.X0(e,t+1,r))}function l(e,t,n,r){return o(0,0,5,s.Jl(e,t+1,r))}function h(e,t,n,r){const a=s.YX(e,t+1,r);if("bigint"==typeof a)throw new Error(`${i.IR} 64-bit integer array lengths not supported`);return o(0,0,9,a)}function f(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${i.IR} indefinite length items not allowed`);return o(0,0,1,1/0)}function p(e,t){s.Tp(e,r.D.array.majorEncoded,t.value)}p.compareTokens=s.Fh.compareTokens,p.encodedSize=function(e){return s.Tp.encodedSize(e.value)}},59283:function(e,t,n){"use strict";n.d(t,{F2:function(){return h},G:function(){return c},IY:function(){return l},KI:function(){return p},_K:function(){return a},ng:function(){return f},qe:function(){return u}});var r=n(59787),s=n(55580),i=n(85590);function o(e,t,n,s){return new r.W(r.D.map,s,n)}function a(e,t,n,r){return o(0,0,1,n)}function c(e,t,n,r){return o(0,0,2,s.kj(e,t+1,r))}function u(e,t,n,r){return o(0,0,3,s.X0(e,t+1,r))}function l(e,t,n,r){return o(0,0,5,s.Jl(e,t+1,r))}function h(e,t,n,r){const a=s.YX(e,t+1,r);if("bigint"==typeof a)throw new Error(`${i.IR} 64-bit integer map lengths not supported`);return o(0,0,9,a)}function f(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${i.IR} indefinite length items not allowed`);return o(0,0,1,1/0)}function p(e,t){s.Tp(e,r.D.map.majorEncoded,t.value)}p.compareTokens=s.Fh.compareTokens,p.encodedSize=function(e){return s.Tp.encodedSize(e.value)}},82428:function(e,t,n){"use strict";n.d(t,{CF:function(){return a},MV:function(){return u},ZR:function(){return o},qJ:function(){return i},vP:function(){return c},xy:function(){return l}});var r=n(59787),s=n(55580);function i(e,t,n,s){return new r.W(r.D.tag,n,1)}function o(e,t,n,i){return new r.W(r.D.tag,s.kj(e,t+1,i),2)}function a(e,t,n,i){return new r.W(r.D.tag,s.X0(e,t+1,i),3)}function c(e,t,n,i){return new r.W(r.D.tag,s.Jl(e,t+1,i),5)}function u(e,t,n,i){return new r.W(r.D.tag,s.YX(e,t+1,i),9)}function l(e,t){s.Tp(e,r.D.tag.majorEncoded,t.value)}l.compareTokens=s.Fh.compareTokens,l.encodedSize=function(e){return s.Tp.encodedSize(e.value)}},73851:function(e,t,n){"use strict";n.d(t,{GI:function(){return d},h1:function(){return l},mW:function(){return p},tA:function(){return g},vV:function(){return y},y7:function(){return h}});var r=n(59787),s=n(85590),i=n(55580);const o=20,a=21,c=22,u=23;function l(e,t,n,i){if(!1===i.allowUndefined)throw new Error(`${s.IR} undefined values are not supported`);return!0===i.coerceUndefinedToNull?new r.W(r.D.null,null,1):new r.W(r.D.undefined,void 0,1)}function h(e,t,n,i){if(!1===i.allowIndefinite)throw new Error(`${s.IR} indefinite length items not allowed`);return new r.W(r.D.break,void 0,1)}function f(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw new Error(`${s.IR} NaN values are not supported`);if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${s.IR} Infinity values are not supported`)}return new r.W(r.D.float,e,t)}function p(e,t,n,r){return f(E(e,t+1),3,r)}function d(e,t,n,r){return f(k(e,t+1),5,r)}function y(e,t,n,r){return f(S(e,t+1),9,r)}function g(e,t,n){const s=t.value;if(!1===s)e.push([r.D.float.majorEncoded|o]);else if(!0===s)e.push([r.D.float.majorEncoded|a]);else if(null===s)e.push([r.D.float.majorEncoded|c]);else if(void 0===s)e.push([r.D.float.majorEncoded|u]);else{let t,r=!1;n&&!0===n.float64||(v(s),t=E(w,1),s===t||Number.isNaN(s)?(w[0]=249,e.push(w.slice(0,3)),r=!0):(_(s),t=k(w,1),s===t&&(w[0]=250,e.push(w.slice(0,5)),r=!0))),r||(i=s,b.setFloat64(0,i,!1),t=S(w,1),w[0]=251,e.push(w.slice(0,9)))}var i}g.encodedSize=function(e,t){const n=e.value;if(!1===n||!0===n||null==n)return 1;if(!t||!0!==t.float64){v(n);let e=E(w,1);if(n===e||Number.isNaN(n))return 3;if(_(n),e=k(w,1),n===e)return 5}return 9};const m=new ArrayBuffer(9),b=new DataView(m,1),w=new Uint8Array(m,0);function v(e){if(e===1/0)b.setUint16(0,31744,!1);else if(e===-1/0)b.setUint16(0,64512,!1);else if(Number.isNaN(e))b.setUint16(0,32256,!1);else{b.setFloat32(0,e);const t=b.getUint32(0),n=(2139095040&t)>>23,r=8388607&t;if(255===n)b.setUint16(0,31744,!1);else if(0===n)b.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{const e=n-127;e<-24?b.setUint16(0,0):e<-14?b.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):b.setUint16(0,(2147483648&t)>>16|e+15<<10|r>>13,!1)}}}function E(e,t){if(e.length-t<2)throw new Error(`${s.IR} not enough data for float16`);const n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,i=1023&n;let o;return o=0===r?i*2**-24:31!==r?(i+1024)*2**(r-25):0===i?1/0:NaN,32768&n?-o:o}function _(e){b.setFloat32(0,e,!1)}function k(e,t){if(e.length-t<4)throw new Error(`${s.IR} not enough data for float32`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function S(e,t){if(e.length-t<8)throw new Error(`${s.IR} not enough data for float64`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}g.compareTokens=i.Fh.compareTokens},22042:function(e,t,n){"use strict";n.d(t,{BB:function(){return c},Dz:function(){return a},Pu:function(){return b},mL:function(){return u},nI:function(){return l},qu:function(){return d},tP:function(){return h},un:function(){return p},zo:function(){return f}});const r=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,s=new TextDecoder,i=new TextEncoder;function o(e){return r&&globalThis.Buffer.isBuffer(e)}function a(e){return e instanceof Uint8Array?o(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const c=r?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):g(e,t,n):(e,t,n)=>n-t>64?s.decode(e.subarray(t,n)):g(e,t,n),u=r?e=>e.length>64?globalThis.Buffer.from(e):y(e):e=>e.length>64?i.encode(e):y(e),l=e=>Uint8Array.from(e),h=r?(e,t,n)=>o(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),f=r?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),a(globalThis.Buffer.concat(e,t))):(e,t)=>{const n=new Uint8Array(t);let r=0;for(let t of e)r+t.length>n.length&&(t=t.subarray(0,n.length-r)),n.set(t,r),r+=t.length;return n},p=r?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function d(e,t){if(o(e)&&o(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}function y(e,t=1/0){let n;const r=e.length;let s=null;const i=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!s){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}s=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function g(e,t,n){const r=[];for(;t<n;){const s=e[t];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(t+o<=n){let n,r,a,c;switch(o){case 1:s<128&&(i=s);break;case 2:n=e[t+1],128==(192&n)&&(c=(31&s)<<6|63&n,c>127&&(i=c));break;case 3:n=e[t+1],r=e[t+2],128==(192&n)&&128==(192&r)&&(c=(15&s)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:n=e[t+1],r=e[t+2],a=e[t+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(c=(15&s)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),t+=o}return b(r)}const m=4096;function b(e){const t=e.length;if(t<=m)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=m));return n}},85590:function(e,t,n){"use strict";n.d(t,{DO:function(){return o},IR:function(){return r},OO:function(){return s}});const r="CBOR decode error:",s="CBOR encode error:",i=[];function o(e,t,n){if(e.length-t<n)throw new Error(`${r} not enough data for type`)}i[23]=1,i[24]=2,i[25]=3,i[26]=5,i[27]=9},61287:function(e,t,n){"use strict";n.d(t,{Jx:function(){return h}});var r=n(85590),s=n(59787),i=n(53741);const o={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class a{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=i.PS[e];if(void 0===t){const n=i.cW[e];if(!n)throw new Error(`${r.IR} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=31&e;t=n(this.data,this.pos,s,this.options)}return this.pos+=t.encodedLength,t}}const c=Symbol.for("DONE"),u=Symbol.for("BREAK");function l(e,t){if(e.done())return c;const n=e.next();if(n.type===s.D.break)return u;if(n.type.terminal)return n.value;if(n.type===s.D.array)return function(e,t,n){const s=[];for(let i=0;i<e.value;i++){const o=l(t,n);if(o===u){if(e.value===1/0)break;throw new Error(`${r.IR} got unexpected break to lengthed array`)}if(o===c)throw new Error(`${r.IR} found array but not enough entries (got ${i}, expected ${e.value})`);s[i]=o}return s}(n,e,t);if(n.type===s.D.map)return function(e,t,n){const s=!0===n.useMaps,i=s?void 0:{},o=s?new Map:void 0;for(let a=0;a<e.value;a++){const h=l(t,n);if(h===u){if(e.value===1/0)break;throw new Error(`${r.IR} got unexpected break to lengthed map`)}if(h===c)throw new Error(`${r.IR} found map but not enough entries (got ${a} [no key], expected ${e.value})`);if(!0!==s&&"string"!=typeof h)throw new Error(`${r.IR} non-string keys not supported (got ${typeof h})`);if(!0===n.rejectDuplicateMapKeys&&(s&&o.has(h)||!s&&h in i))throw new Error(`${r.IR} found repeat map key "${h}"`);const f=l(t,n);if(f===c)throw new Error(`${r.IR} found map but not enough entries (got ${a} [no value], expected ${e.value})`);s?o.set(h,f):i[h]=f}return s?o:i}(n,e,t);if(n.type===s.D.tag){if(t.tags&&"function"==typeof t.tags[n.value]){const r=l(e,t);return t.tags[n.value](r)}throw new Error(`${r.IR} tag not supported (${n.value})`)}throw new Error("unsupported")}function h(e,t){if(!(e instanceof Uint8Array))throw new Error(`${r.IR} data to decode must be a Uint8Array`);const n=(t=Object.assign({},o,t)).tokenizer||new a(e,t),s=l(n,t);if(s===c)throw new Error(`${r.IR} did not find any content to decode`);if(s===u)throw new Error(`${r.IR} got unexpected break`);if(!n.done())throw new Error(`${r.IR} too many terminals, data makes no sense`);return s}},72696:function(e,t,n){"use strict";n.d(t,{cv:function(){return O},w$:function(){return x}});const r=["string","number","bigint","symbol"],s=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function i(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(r.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const n=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(s.includes(t))return t;return}(e);return n||"Object"}var o=n(59787),a=n(22042);class c{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=(0,a.un)(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=(0,a.tP)(n,0,this.cursor)}else t=(0,a.zo)(this.chunks,this.cursor);return e&&this.reset(),t}}var u=n(85590),l=n(53741),h=n(55580),f=n(53929),p=n(92887),d=n(50768),y=n(8278),g=n(59283),m=n(82428),b=n(73851),w=n(25108);const v={float64:!1,mapSorter:function(e,t){const n=Array.isArray(e[0])?e[0][0]:e[0],r=Array.isArray(t[0])?t[0][0]:t[0];if(n.type!==r.type)return n.type.compare(r.type);const s=n.type.major,i=E[s].compareTokens(n,r);0===i&&w.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return i},quickEncodeToken:l.JN};const E=function(){const e=[];return e[o.D.uint.major]=h.Fh,e[o.D.negint.major]=f.UT,e[o.D.bytes.major]=p.hg,e[o.D.string.major]=d.YW,e[o.D.array.major]=y.HF,e[o.D.map.major]=g.KI,e[o.D.tag.major]=m.xy,e[o.D.float.major]=b.tA,e}(),_=new c;class k{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${u.OO} object contains circular references`);return new k(t,e)}}const S={null:new o.W(o.D.null,null),undefined:new o.W(o.D.undefined,void 0),true:new o.W(o.D.true,!0),false:new o.W(o.D.false,!1),emptyArray:new o.W(o.D.array,0),emptyMap:new o.W(o.D.map,0)},T={number:(e,t,n,r)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new o.W(o.D.uint,e):new o.W(o.D.negint,e):new o.W(o.D.float,e),bigint:(e,t,n,r)=>e>=BigInt(0)?new o.W(o.D.uint,e):new o.W(o.D.negint,e),Uint8Array:(e,t,n,r)=>new o.W(o.D.bytes,e),string:(e,t,n,r)=>new o.W(o.D.string,e),boolean:(e,t,n,r)=>e?S.true:S.false,null:(e,t,n,r)=>S.null,undefined:(e,t,n,r)=>S.undefined,ArrayBuffer:(e,t,n,r)=>new o.W(o.D.bytes,new Uint8Array(e)),DataView:(e,t,n,r)=>new o.W(o.D.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[S.emptyArray,new o.W(o.D.break)]:S.emptyArray;r=k.createCheck(r,e);const s=[];let i=0;for(const t of e)s[i++]=A(t,n,r);return n.addBreakTokens?[new o.W(o.D.array,e.length),s,new o.W(o.D.break)]:[new o.W(o.D.array,e.length),s]},Object(e,t,n,r){const s="Object"!==t,i=s?e.keys():Object.keys(e),a=s?e.size:i.length;if(!a)return!0===n.addBreakTokens?[S.emptyMap,new o.W(o.D.break)]:S.emptyMap;r=k.createCheck(r,e);const c=[];let u=0;for(const t of i)c[u++]=[A(t,n,r),A(s?e.get(t):e[t],n,r)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(c,n),n.addBreakTokens?[new o.W(o.D.map,a),c,new o.W(o.D.break)]:[new o.W(o.D.map,a),c]}};T.Map=T.Object,T.Buffer=T.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))T[`${e}Array`]=T.DataView;function A(e,t={},n){const r=i(e),s=t&&t.typeEncoders&&t.typeEncoders[r]||T[r];if("function"==typeof s){const i=s(e,r,t,n);if(null!=i)return i}const o=T[r];if(!o)throw new Error(`${u.OO} unsupported type: ${r}`);return o(e,r,t,n)}function I(e,t,n,r){if(Array.isArray(t))for(const s of t)I(e,s,n,r);else n[t.type.major](e,t,r)}function x(e,t,n){const r=A(e,n);if(!Array.isArray(r)&&n.quickEncodeToken){const e=n.quickEncodeToken(r);if(e)return e;const s=t[r.type.major];if(s.encodedSize){const e=s.encodedSize(r,n),t=new c(e);if(s(t,r,n),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return(0,a.Dz)(t.chunks[0])}}return _.reset(),I(_,r,t,n),_.toBytes(!0)}function O(e,t){return t=Object.assign({},v,t),x(e,E,t)}},53741:function(e,t,n){"use strict";n.d(t,{JN:function(){return b},PS:function(){return m},cW:function(){return g}});var r=n(59787),s=n(55580),i=n(53929),o=n(92887),a=n(50768),c=n(8278),u=n(59283),l=n(82428),h=n(73851),f=n(85590),p=n(22042);function d(e,t,n){throw new Error(`${f.IR} encountered invalid minor (${n}) for major ${e[t]>>>5}`)}function y(e){return()=>{throw new Error(`${f.IR} ${e}`)}}const g=[];for(let e=0;e<=23;e++)g[e]=d;g[24]=s.Km,g[25]=s.Zh,g[26]=s.cs,g[27]=s.uN,g[28]=d,g[29]=d,g[30]=d,g[31]=d;for(let e=32;e<=55;e++)g[e]=d;g[56]=i.yr,g[57]=i.r0,g[58]=i.wy,g[59]=i.ec,g[60]=d,g[61]=d,g[62]=d,g[63]=d;for(let e=64;e<=87;e++)g[e]=o.Ii;g[88]=o.UQ,g[89]=o.BS,g[90]=o.zU,g[91]=o.ME,g[92]=d,g[93]=d,g[94]=d,g[95]=y("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)g[e]=a.nt;g[120]=a.Bq,g[121]=a.h,g[122]=a.q0,g[123]=a.bc,g[124]=d,g[125]=d,g[126]=d,g[127]=y("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)g[e]=c.Ju;g[152]=c.h7,g[153]=c.OC,g[154]=c.lY,g[155]=c.a8,g[156]=d,g[157]=d,g[158]=d,g[159]=c.s5;for(let e=160;e<=183;e++)g[e]=u._K;g[184]=u.G,g[185]=u.qe,g[186]=u.IY,g[187]=u.F2,g[188]=d,g[189]=d,g[190]=d,g[191]=u.ng;for(let e=192;e<=215;e++)g[e]=l.qJ;g[216]=l.ZR,g[217]=l.CF,g[218]=l.vP,g[219]=l.MV,g[220]=d,g[221]=d,g[222]=d,g[223]=d;for(let e=224;e<=243;e++)g[e]=y("simple values are not supported");g[244]=d,g[245]=d,g[246]=d,g[247]=h.h1,g[248]=y("simple values are not supported"),g[249]=h.mW,g[250]=h.GI,g[251]=h.vV,g[252]=d,g[253]=d,g[254]=d,g[255]=h.y7;const m=[];for(let e=0;e<24;e++)m[e]=new r.W(r.D.uint,e,1);for(let e=-1;e>=-24;e--)m[31-e]=new r.W(r.D.negint,e,1);function b(e){switch(e.type){case r.D.false:return(0,p.nI)([244]);case r.D.true:return(0,p.nI)([245]);case r.D.null:return(0,p.nI)([246]);case r.D.bytes:return e.value.length?void 0:(0,p.nI)([64]);case r.D.string:return""===e.value?(0,p.nI)([96]):void 0;case r.D.array:return 0===e.value?(0,p.nI)([128]):void 0;case r.D.map:return 0===e.value?(0,p.nI)([160]):void 0;case r.D.uint:return e.value<24?(0,p.nI)([Number(e.value)]):void 0;case r.D.negint:if(e.value>=-24)return(0,p.nI)([31-Number(e.value)])}}m[64]=new r.W(r.D.bytes,new Uint8Array(0),1),m[96]=new r.W(r.D.string,"",1),m[128]=new r.W(r.D.array,0,1),m[160]=new r.W(r.D.map,0,1),m[244]=new r.W(r.D.false,!1,1),m[245]=new r.W(r.D.true,!0,1),m[246]=new r.W(r.D.null,null,1)},59787:function(e,t,n){"use strict";n.d(t,{D:function(){return r},W:function(){return s}});class r{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}r.uint=new r(0,"uint",!0),r.negint=new r(1,"negint",!0),r.bytes=new r(2,"bytes",!0),r.string=new r(3,"string",!0),r.array=new r(4,"array",!1),r.map=new r(5,"map",!1),r.tag=new r(6,"tag",!1),r.float=new r(7,"float",!0),r.false=new r(7,"false",!0),r.true=new r(7,"true",!0),r.null=new r(7,"null",!0),r.undefined=new r(7,"undefined",!0),r.break=new r(7,"break",!0);class s{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}},84296:function(e,t,n){"use strict";n.r(t),n.d(t,{code:function(){return p},decode:function(){return b},encode:function(){return m},name:function(){return f},toGeneral:function(){return g}});var r=n(99382);function s(e){return r.base64url.encode(e).slice(1)}function i(e){return r.base64url.decode(`u${e}`)}var o=n(38161);function a(e){const t={signature:i(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=i(e.protected)),t}function c(e){const t={signature:s(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=s(e.protected)),t}function u(e){const t={};return e.encrypted_key&&(t.encrypted_key=i(e.encrypted_key)),e.header&&(t.header=e.header),t}function l(e){const t={};return e.encrypted_key&&(t.encrypted_key=s(e.encrypted_key)),e.header&&(t.header=e.header),t}var h=n(90560);const f="dag-jose",p=133;function d(e){return"payload"in e&&"string"==typeof e.payload&&"signatures"in e&&Array.isArray(e.signatures)}function y(e){return"ciphertext"in e&&"string"==typeof e.ciphertext&&"iv"in e&&"string"==typeof e.iv&&"protected"in e&&"string"==typeof e.protected&&"tag"in e&&"string"==typeof e.tag}function g(e){if("string"==typeof e){const t=e.split(".");if(3===t.length)return function(e){const[t,n,r]=e;return{payload:n,signatures:[{protected:t,signature:r}],link:o.k0.decode(i(n))}}(t);if(5===t.length)return function(e){const[t,n,r,s,i]=e,o={ciphertext:s,iv:r,protected:t,tag:i};return n&&(o.recipients=[{encrypted_key:n}]),o}(t);throw new Error("Not a valid JOSE string")}if(d(e)||y(e))return e;throw new Error("Not a valid unencoded JOSE object")}function m(e){let t;if("string"==typeof e&&(e=g(e)),d(e))t=function(e){const t=i(e.payload);try{o.k0.decode(t)}catch(e){throw new Error("Not a valid DagJWS")}return{payload:t,signatures:e.signatures.map(a)}}(e);else{if(!y(e))throw new Error("Not a valid JOSE object");t=function(e){const t={ciphertext:i(e.ciphertext),protected:i(e.protected),iv:i(e.iv),tag:i(e.tag)};return e.aad&&(t.aad=i(e.aad)),e.recipients&&(t.recipients=e.recipients.map(u)),e.unprotected&&(t.unprotected=e.unprotected),t}(e)}return new Uint8Array(h.encode(t))}function b(e){let t;try{t=h.decode(e)}catch(e){throw new Error("Not a valid DAG-JOSE object")}if("payload"in(n=t)&&n.payload instanceof Uint8Array&&"signatures"in n&&Array.isArray(n.signatures))return function(e){const t={payload:s(e.payload),signatures:e.signatures.map(c)};return t.link=o.k0.decode(new Uint8Array(e.payload)),t}(t);if(function(e){return"ciphertext"in e&&e.ciphertext instanceof Uint8Array&&"iv"in e&&e.iv instanceof Uint8Array&&"protected"in e&&e.protected instanceof Uint8Array&&"tag"in e&&e.tag instanceof Uint8Array}(t))return function(e){const t={ciphertext:s(e.ciphertext),protected:s(e.protected),iv:s(e.iv),tag:s(e.tag)};return e.aad&&(t.aad=s(e.aad)),e.recipients&&(t.recipients=e.recipients.map(l)),e.unprotected&&(t.unprotected=e.unprotected),t}(t);throw new Error("Not a valid DAG-JOSE object");var n}},96863:function(e,t,n){"use strict";n.d(t,{e:function(){return a}});const r=(e,t)=>async function*(){const n=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(e);yield*n.sort(t)}();var s=n(93361),i=n(44752),o=n(56635);class a{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:r}of e)await this.put(n,r,t),yield{key:n,value:r}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(t,n){e.push({key:t,value:n})},delete(e){t.push(e)},commit:async n=>{await(0,s.Z)(this.putMany(e,n)),e=[],await(0,s.Z)(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(null!=e.prefix&&(n=(0,i.Z)(n,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>(0,i.Z)(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>r(e,t)),n)),null!=e.offset){let t=0;n=(0,i.Z)(n,(()=>t++>=e.offset))}return null!=e.limit&&(n=(0,o.Z)(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(null!=e.prefix&&(n=(0,i.Z)(n,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>(0,i.Z)(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>r(e,t)),n)),null!=e.offset){let t=0;n=(0,i.Z)(n,(()=>t++>=e.offset))}return null!=e.limit&&(n=(0,o.Z)(n,e.limit)),n}}},40668:function(e,t,n){"use strict";n.r(t),n.d(t,{abortedError:function(){return c},dbDeleteFailedError:function(){return i},dbOpenFailedError:function(){return s},dbWriteFailedError:function(){return o},notFoundError:function(){return a}});var r=n(32114);function s(e){return e=e||new Error("Cannot open database"),r(e,"ERR_DB_OPEN_FAILED")}function i(e){return e=e||new Error("Delete failed"),r(e,"ERR_DB_DELETE_FAILED")}function o(e){return e=e||new Error("Write failed"),r(e,"ERR_DB_WRITE_FAILED")}function a(e){return e=e||new Error("Not Found"),r(e,"ERR_NOT_FOUND")}function c(e){return e=e||new Error("Aborted"),r(e,"ERR_ABORTED")}},85404:function(e,t,n){"use strict";n.d(t,{a:function(){return o}});var r=n(96863),s=n(66699),i=n(40668);class o extends r.e{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){if(!await this.has(e))throw i.notFoundError();return this.data[e.toString()]}async has(e){return void 0!==this.data[e.toString()]}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map((([e,t])=>({key:new s.s(e),value:t})))}async*_allKeys(){yield*Object.entries(this.data).map((([e])=>new s.s(e)))}}},41309:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var r=n(11227),s=n(73692);const i=globalThis.fetch,o=globalThis.Headers;globalThis.Request,globalThis.Response;function a(e,t,n){return`${e}?name=${t}&type=${n}`}async function c(e,t){const n=await i(e,{headers:new o({accept:"application/dns-json"}),signal:t});return await n.json()}function u(e,t){return`${t}_${e}`}const l=Object.assign(r("dns-over-http-resolver"),{error:r("dns-over-http-resolver:error")});var h=class{constructor(e={}){this._cache=new s({max:e?.maxCache??100}),this._TXTcache=new s({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??c,this._abortControllers=[]}cancel(){this._abortControllers.forEach((e=>e.abort()))}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*t),r=e[t];e[t]=e[n],e[n]=r}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",n=this._cache.get(u(e,t));if(null!=n)return n;let r=!1;for(const n of this._getShuffledServers()){const s=new AbortController;this._abortControllers.push(s);try{const r=await this._request(a(n,e,t),s.signal),i=r.Answer.map((e=>e.data)),o=Math.min(...r.Answer.map((e=>e.TTL)));return this._cache.set(u(e,t),i,{ttl:o}),i}catch(i){s.signal.aborted&&(r=!0),l.error(`${n} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==s))}}if(r)throw Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",n=this._cache.get(u(e,t));if(null!=n)return n;let r=!1;for(const n of this._getShuffledServers()){const s=new AbortController;this._abortControllers.push(s);try{const r=await this._request(a(n,e,t),s.signal),i=r.Answer.map((e=>e.data)),o=Math.min(...r.Answer.map((e=>e.TTL)));return this._cache.set(u(e,t),i,{ttl:o}),i}catch(i){s.signal.aborted&&(r=!0),l.error(`${n} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==s))}}if(r)throw Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",n=this._TXTcache.get(u(e,t));if(null!=n)return n;let r=!1;for(const n of this._getShuffledServers()){const s=new AbortController;this._abortControllers.push(s);try{const r=await this._request(a(n,e,t),s.signal),i=r.Answer.map((e=>[e.data.replace(/['"]+/g,"")])),o=Math.min(...r.Answer.map((e=>e.TTL)));return this._TXTcache.set(u(e,t),i,{ttl:o}),i}catch(i){s.signal.aborted&&(r=!0),l.error(`${n} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==s))}}if(r)throw Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}},85965:function(e,t,n){"use strict";n.d(t,{sk:function(){return G},Vq:function(){return _},Y3:function(){return F},Qc:function(){return W}});const r=Object.create(null);r.open="0",r.close="1",r.ping="2",r.pong="3",r.message="4",r.upgrade="5",r.noop="6";const s=Object.create(null);Object.keys(r).forEach((e=>{s[r[e]]=e}));const i={type:"error",data:"parser error"},o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,c=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};var u=({type:e,data:t},n,s)=>{return o&&t instanceof Blob?n?s(t):c(t,s):a&&(t instanceof ArrayBuffer||(i=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer))?n?s(t):c(new Blob([t]),s):s(r[e]+(t||""));var i};const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<l.length;e++)h[l.charCodeAt(e)]=e;const f="function"==typeof ArrayBuffer,p=(e,t)=>{if(f){const n=(e=>{let t,n,r,s,i,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const u=new ArrayBuffer(o),l=new Uint8Array(u);for(t=0;t<a;t+=4)n=h[e.charCodeAt(t)],r=h[e.charCodeAt(t+1)],s=h[e.charCodeAt(t+2)],i=h[e.charCodeAt(t+3)],l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|s>>2,l[c++]=(3&s)<<6|63&i;return u})(e);return d(n,t)}return{base64:!0,data:e}},d=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e;var y=(e,t)=>{if("string"!=typeof e)return{type:"message",data:d(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:p(e.substring(1),t)};return s[n]?e.length>1?{type:s[n],data:e.substring(1)}:{type:s[n]}:i};const g=String.fromCharCode(30);var m=n(99748);const b="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function w(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const v=b.setTimeout,E=b.clearTimeout;function _(e,t){t.useNativeTimers?(e.setTimeoutFn=v.bind(b),e.clearTimeoutFn=E.bind(b)):(e.setTimeoutFn=b.setTimeout.bind(b),e.clearTimeoutFn=b.clearTimeout.bind(b))}class k extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class S extends m.Q{constructor(e){super(),this.writable=!1,_(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new k(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=y(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const T="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),A=64,I={};let x,O=0,P=0;function R(e){let t="";do{t=T[e%A]+t,e=Math.floor(e/A)}while(e>0);return t}function N(){const e=R(+new Date);return e!==x?(O=0,x=e):e+"."+R(O++)}for(;P<A;P++)I[T[P]]=P;function D(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}let C=!1;try{C="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const L=C;function B(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||L))return new XMLHttpRequest}catch(e){}if(!t)try{return new(b[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function M(){}const j=null!=new B({xdomain:!1}).responseType;class z extends m.Q{constructor(e,t){super(),_(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=w(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new B(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=z.requestsCount++,z.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=M,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete z.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(z.requestsCount=0,z.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",U);else if("function"==typeof addEventListener){addEventListener("onpagehide"in b?"pagehide":"unload",U,!1)}function U(){for(let e in z.requests)z.requests.hasOwnProperty(e)&&z.requests[e].abort()}const F="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),$=b.WebSocket||b.MozWebSocket;n(23085).lW;const H="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const V={websocket:class extends S{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=H?{}:w(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=H?new $(e,t,n):t?new $(e,t):new $(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;u(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}r&&F((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=N()),this.supportsBinary||(e.b64=1);const r=D(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}check(){return!!$}},polling:class extends S{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=j&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(g),r=[];for(let e=0;e<n.length;e++){const s=y(n[e],t);if(r.push(s),"error"===s.type)break}return r})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let s=0;e.forEach(((e,i)=>{u(e,!1,(e=>{r[i]=e,++s===n&&t(r.join(g))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=N()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const r=D(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new z(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},K=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,q=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function W(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let s=K.exec(e||""),i={},o=14;for(;o--;)i[q[o]]=s[o]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,i.path),i.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,i.query),i}class G extends m.Q{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=W(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=W(t.host).host),_(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let e=0,r=n.length;e<r;e++){let r=n[e].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new V[e](n)}open(){let e;if(this.opts.rememberUpgrade&&G.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;G.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;G.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function s(){n||(n=!0,u(),t.close(),t=null)}const i=e=>{const n=new Error("probe error: "+e);n.transport=t.name,s(),this.emitReserved("upgradeError",n)};function o(){i("transport closed")}function a(){i("socket closed")}function c(e){t&&e.name!==t.name&&s()}const u=()=>{t.removeListener("open",r),t.removeListener("error",i),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",r),t.once("error",i),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",G.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(e+="string"==typeof(t=r)?function(e){let t=0,n=0;for(let r=0,s=e.length;r<s;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){G.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}G.protocol=4;G.protocol},1900:function(e,t,n){"use strict";n.d(t,{R:function(){return r},a:function(){return s}});const r=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace"],s=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/x-parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed"]},2157:function(e,t,n){"use strict";var r=n(21858),s=n(51268),i=n(40804),o=n(53458);const a=e=>s(e)||null!==e&&"object"==typeof e&&"function"==typeof e.pipe;t.Z=(e,t,n,s=r.n)=>{const{clone:c,files:u}=i({query:e,variables:t,operationName:n},"",a);if(0===u.size){if(!Array.isArray(e))return s.stringify(c);if(void 0!==t&&!Array.isArray(t))throw new Error("Cannot create request body with given variable type, array expected");const n=e.reduce(((e,n,r)=>(e.push({query:n,variables:t?t[r]:void 0}),e)),[]);return s.stringify(n)}const l=new("undefined"==typeof FormData?o:FormData);l.append("operations",s.stringify(c));const h={};let f=0;return u.forEach((e=>{h[++f]=e})),l.append("map",s.stringify(h)),f=0,u.forEach(((e,t)=>{l.append(""+ ++f,t)})),l}},21858:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});const r={parse:JSON.parse,stringify:JSON.stringify}},3050:function(e,t,n){"use strict";n(28688),n(24518),n(25108)},73112:function(e,t,n){"use strict";n.d(t,{L:function(){return s},P:function(){return r}});const r=e=>e.toUpperCase(),s=e=>{const t={};return e.forEach(((e,n)=>{t[n]=e})),t}},17933:function(e,t,n){"use strict";n.d(t,{Gr:function(){return o},HU:function(){return i},N$:function(){return s},ZO:function(){return r}});const r=(e,t,n)=>e.document?e:{document:e,variables:t,requestHeaders:n,signal:void 0},s=(e,t,n)=>e.query?e:{query:e,variables:t,requestHeaders:n,signal:void 0},i=(e,t)=>e.documents?e:{documents:e,requestHeaders:t,signal:void 0},o=(e,t,...n)=>{const[r,s]=n;return e.document?e:{url:e,document:t,variables:r,requestHeaders:s,signal:void 0}}},28688:function(e,t,n){"use strict";n.d(t,{h:function(){return k}});var r=n(25202),s=n(95389);const i=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function o(e){return a[e.charCodeAt(0)]}const a=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"];var c=n(53767),u=n(6589),l=n(39504),h=n(6450);const f=Object.freeze({});function p(e,t,n=l.h8){const r=new Map;for(const e of Object.values(h.h))r.set(e,d(t,e));let s,i,o,a=Array.isArray(e),p=[e],y=-1,g=[],m=e;const b=[],w=[];do{y++;const e=y===p.length,h=e&&0!==g.length;if(e){if(i=0===w.length?void 0:b[b.length-1],m=o,o=w.pop(),h)if(a){m=m.slice();let e=0;for(const[t,n]of g){const r=t-e;null===n?(m.splice(r,1),e++):m[r]=n}}else{m=Object.defineProperties({},Object.getOwnPropertyDescriptors(m));for(const[e,t]of g)m[e]=t}y=s.index,p=s.keys,g=s.edits,a=s.inArray,s=s.prev}else if(o){if(i=a?y:p[y],m=o[i],null==m)continue;b.push(i)}let d;if(!Array.isArray(m)){var v,E;(0,l.UG)(m)||(0,c.a)(!1,`Invalid AST Node: ${(0,u.X)(m)}.`);const n=e?null===(v=r.get(m.kind))||void 0===v?void 0:v.leave:null===(E=r.get(m.kind))||void 0===E?void 0:E.enter;if(d=null==n?void 0:n.call(t,m,i,o,b,w),d===f)break;if(!1===d){if(!e){b.pop();continue}}else if(void 0!==d&&(g.push([i,d]),!e)){if(!(0,l.UG)(d)){b.pop();continue}m=d}}var _;if(void 0===d&&h&&g.push([i,m]),e)b.pop();else s={inArray:a,index:y,keys:p,edits:g,prev:s},a=Array.isArray(m),p=a?m:null!==(_=n[m.kind])&&void 0!==_?_:[],y=-1,g=[],o&&w.push(o),o=m}while(void 0!==s);return 0!==g.length?g[g.length-1][1]:e}function d(e,t){const n=e[t];return"object"==typeof n?n:"function"==typeof n?{enter:n,leave:void 0}:{enter:e.enter,leave:e.leave}}function y(e){return p(e,g)}const g={Name:{leave:e=>e.value},Variable:{leave:e=>"$"+e.name},Document:{leave:e=>m(e.definitions,"\n\n")},OperationDefinition:{leave(e){const t=w("(",m(e.variableDefinitions,", "),")"),n=m([e.operation,m([e.name,t]),m(e.directives," ")]," ");return("query"===n?"":n+" ")+e.selectionSet}},VariableDefinition:{leave:({variable:e,type:t,defaultValue:n,directives:r})=>e+": "+t+w(" = ",n)+w(" ",m(r," "))},SelectionSet:{leave:({selections:e})=>b(e)},Field:{leave({alias:e,name:t,arguments:n,directives:r,selectionSet:s}){const i=w("",e,": ")+t;let o=i+w("(",m(n,", "),")");return o.length>80&&(o=i+w("(\n",v(m(n,"\n")),"\n)")),m([o,m(r," "),s]," ")}},Argument:{leave:({name:e,value:t})=>e+": "+t},FragmentSpread:{leave:({name:e,directives:t})=>"..."+e+w(" ",m(t," "))},InlineFragment:{leave:({typeCondition:e,directives:t,selectionSet:n})=>m(["...",w("on ",e),m(t," "),n]," ")},FragmentDefinition:{leave:({name:e,typeCondition:t,variableDefinitions:n,directives:r,selectionSet:s})=>`fragment ${e}${w("(",m(n,", "),")")} on ${t} ${w("",m(r," ")," ")}`+s},IntValue:{leave:({value:e})=>e},FloatValue:{leave:({value:e})=>e},StringValue:{leave:({value:e,block:t})=>t?(0,s.LZ)(e):`"${e.replace(i,o)}"`},BooleanValue:{leave:({value:e})=>e?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:e})=>e},ListValue:{leave:({values:e})=>"["+m(e,", ")+"]"},ObjectValue:{leave:({fields:e})=>"{"+m(e,", ")+"}"},ObjectField:{leave:({name:e,value:t})=>e+": "+t},Directive:{leave:({name:e,arguments:t})=>"@"+e+w("(",m(t,", "),")")},NamedType:{leave:({name:e})=>e},ListType:{leave:({type:e})=>"["+e+"]"},NonNullType:{leave:({type:e})=>e+"!"},SchemaDefinition:{leave:({description:e,directives:t,operationTypes:n})=>w("",e,"\n")+m(["schema",m(t," "),b(n)]," ")},OperationTypeDefinition:{leave:({operation:e,type:t})=>e+": "+t},ScalarTypeDefinition:{leave:({description:e,name:t,directives:n})=>w("",e,"\n")+m(["scalar",t,m(n," ")]," ")},ObjectTypeDefinition:{leave:({description:e,name:t,interfaces:n,directives:r,fields:s})=>w("",e,"\n")+m(["type",t,w("implements ",m(n," & ")),m(r," "),b(s)]," ")},FieldDefinition:{leave:({description:e,name:t,arguments:n,type:r,directives:s})=>w("",e,"\n")+t+(E(n)?w("(\n",v(m(n,"\n")),"\n)"):w("(",m(n,", "),")"))+": "+r+w(" ",m(s," "))},InputValueDefinition:{leave:({description:e,name:t,type:n,defaultValue:r,directives:s})=>w("",e,"\n")+m([t+": "+n,w("= ",r),m(s," ")]," ")},InterfaceTypeDefinition:{leave:({description:e,name:t,interfaces:n,directives:r,fields:s})=>w("",e,"\n")+m(["interface",t,w("implements ",m(n," & ")),m(r," "),b(s)]," ")},UnionTypeDefinition:{leave:({description:e,name:t,directives:n,types:r})=>w("",e,"\n")+m(["union",t,m(n," "),w("= ",m(r," | "))]," ")},EnumTypeDefinition:{leave:({description:e,name:t,directives:n,values:r})=>w("",e,"\n")+m(["enum",t,m(n," "),b(r)]," ")},EnumValueDefinition:{leave:({description:e,name:t,directives:n})=>w("",e,"\n")+m([t,m(n," ")]," ")},InputObjectTypeDefinition:{leave:({description:e,name:t,directives:n,fields:r})=>w("",e,"\n")+m(["input",t,m(n," "),b(r)]," ")},DirectiveDefinition:{leave:({description:e,name:t,arguments:n,repeatable:r,locations:s})=>w("",e,"\n")+"directive @"+t+(E(n)?w("(\n",v(m(n,"\n")),"\n)"):w("(",m(n,", "),")"))+(r?" repeatable":"")+" on "+m(s," | ")},SchemaExtension:{leave:({directives:e,operationTypes:t})=>m(["extend schema",m(e," "),b(t)]," ")},ScalarTypeExtension:{leave:({name:e,directives:t})=>m(["extend scalar",e,m(t," ")]," ")},ObjectTypeExtension:{leave:({name:e,interfaces:t,directives:n,fields:r})=>m(["extend type",e,w("implements ",m(t," & ")),m(n," "),b(r)]," ")},InterfaceTypeExtension:{leave:({name:e,interfaces:t,directives:n,fields:r})=>m(["extend interface",e,w("implements ",m(t," & ")),m(n," "),b(r)]," ")},UnionTypeExtension:{leave:({name:e,directives:t,types:n})=>m(["extend union",e,m(t," "),w("= ",m(n," | "))]," ")},EnumTypeExtension:{leave:({name:e,directives:t,values:n})=>m(["extend enum",e,m(t," "),b(n)]," ")},InputObjectTypeExtension:{leave:({name:e,directives:t,fields:n})=>m(["extend input",e,m(t," "),b(n)]," ")}};function m(e,t=""){var n;return null!==(n=null==e?void 0:e.filter((e=>e)).join(t))&&void 0!==n?n:""}function b(e){return w("{\n",v(m(e,"\n")),"\n}")}function w(e,t,n=""){return null!=t&&""!==t?e+t+n:""}function v(e){return w("  ",e.replace(/\n/g,"\n  "))}function E(e){var t;return null!==(t=null==e?void 0:e.some((e=>e.includes("\n"))))&&void 0!==t&&t}const _=e=>{let t;const n=e.definitions.filter((e=>"OperationDefinition"===e.kind));return 1===n.length&&(t=n[0]?.name?.value),t},k=e=>{if("string"==typeof e){let t;try{const n=(0,r.Qc)(e);t=_(n)}catch(e){}return{query:e,operationName:t}}const t=_(e);return{query:y(e),operationName:t}}},24518:function(e,t,n){"use strict";n.d(t,{X:function(){return r}});class r extends Error{constructor(e,t){super(`${r.extractMessage(e)}: ${JSON.stringify({response:e,request:t})}`),Object.setPrototypeOf(this,r.prototype),this.response=e,this.request=t,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}static extractMessage(e){return e.errors?.[0]?.message??`GraphQL Error (Code: ${e.status})`}}},66699:function(e,t,n){"use strict";n.d(t,{s:function(){return u}});var r=n(53416),s=n(49784),i=n(77408);const o="/",a=(new TextEncoder).encode(o),c=a[0];class u{constructor(e,t){if("string"==typeof e)this._buf=(0,i.m)(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==c)throw new Error("Invalid key")}toString(e="utf8"){return(0,s.B)(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new u(e.join(o))}static random(){return new u((0,r.x0)().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new u(e):"function"==typeof e.uint8Array?new u(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=a),this._buf[0]!==c){const e=new Uint8Array(this._buf.byteLength+1);e.fill(c,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===c;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let e=0;e<t.length;e++){if(n.length<e+1)return!1;const r=t[e],s=n[e];if(r<s)return!0;if(r>s)return!1}return t.length<n.length}reverse(){return u.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(o).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new u(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(o)||(e+=o),e+=this.type(),new u(e)}parent(){const e=this.list();return 1===e.length?new u(o):new u(e.slice(0,-1).join(o))}child(e){return this.toString()===o?e:e.toString()===o?this:new u(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return u.withNamespaces([...this.namespaces(),...(t=e.map((e=>e.namespaces())),[].concat(...t))]);var t}}},3287:function(e,t){"use strict";const n="[a-fA-F\\d:]",r=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${n})|(?<=${n})(?=\\s|$))`:"",s="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",i="[a-fA-F\\d]{1,4}",o=`\n(?:\n(?:${i}:){7}(?:${i}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${i}:){6}(?:${s}|:${i}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${i}:){5}(?::${s}|(?::${i}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${i}:){4}(?:(?::${i}){0,1}:${s}|(?::${i}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${i}:){3}(?:(?::${i}){0,2}:${s}|(?::${i}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${i}:){2}(?:(?::${i}){0,3}:${s}|(?::${i}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${i}:){1}(?:(?::${i}){0,4}:${s}|(?::${i}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${i}){0,5}:${s}|(?::${i}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),a=new RegExp(`(?:^${s}$)|(?:^${o}$)`),c=new RegExp(`^${s}$`),u=new RegExp(`^${o}$`),l=e=>e&&e.exact?a:new RegExp(`(?:${r(e)}${s}${r(e)})|(?:${r(e)}${o}${r(e)})`,"g");l.v4=e=>e&&e.exact?c:new RegExp(`${r(e)}${s}${r(e)}`,"g"),l.v6=e=>e&&e.exact?u:new RegExp(`${r(e)}${o}${r(e)}`,"g"),t.Z=l},49121:function(e,t,n){"use strict";n.d(t,{tK:function(){return u},Xu:function(){return l}});var r=n(32114),s=n(52197);const i=s.Reader,o=s.Writer,a=s.util,c=s.roots["ipfs-unixfs"]||(s.roots["ipfs-unixfs"]={});c.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Type=0,e.prototype.Data=a.newBuffer([]),e.prototype.filesize=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=a.emptyArray,e.prototype.hashType=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.fanout=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=o.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var n=0;n<e.blocksizes.length;++n)t.uint32(32).uint64(e.blocksizes[n]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&c.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.Data;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Type=e.int32();break;case 2:r.Data=e.bytes();break;case 3:r.filesize=e.uint64();break;case 4:if(r.blocksizes&&r.blocksizes.length||(r.blocksizes=[]),2==(7&s))for(var o=e.uint32()+e.pos;e.pos<o;)r.blocksizes.push(e.uint64());else r.blocksizes.push(e.uint64());break;case 5:r.hashType=e.uint64();break;case 6:r.fanout=e.uint64();break;case 7:r.mode=e.uint32();break;case 8:r.mtime=c.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Type"))throw a.ProtocolError("missing required 'Type'",{instance:r});return r},e.fromObject=function(e){if(e instanceof c.Data)return e;var t=new c.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?a.base64.decode(e.Data,t.Data=a.newBuffer(a.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&(a.Long?(t.filesize=a.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new a.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var n=0;n<e.blocksizes.length;++n)a.Long?(t.blocksizes[n]=a.Long.fromValue(e.blocksizes[n])).unsigned=!0:"string"==typeof e.blocksizes[n]?t.blocksizes[n]=parseInt(e.blocksizes[n],10):"number"==typeof e.blocksizes[n]?t.blocksizes[n]=e.blocksizes[n]:"object"==typeof e.blocksizes[n]&&(t.blocksizes[n]=new a.LongBits(e.blocksizes[n].low>>>0,e.blocksizes[n].high>>>0).toNumber(!0))}if(null!=e.hashType&&(a.Long?(t.hashType=a.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new a.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&(a.Long?(t.fanout=a.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new a.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=c.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.blocksizes=[]),t.defaults){if(n.Type=t.enums===String?"Raw":0,t.bytes===String?n.Data="":(n.Data=[],t.bytes!==Array&&(n.Data=a.newBuffer(n.Data))),a.Long){var r=new a.Long(0,0,!0);n.filesize=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.filesize=t.longs===String?"0":0;if(a.Long){r=new a.Long(0,0,!0);n.hashType=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.hashType=t.longs===String?"0":0;if(a.Long){r=new a.Long(0,0,!0);n.fanout=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.fanout=t.longs===String?"0":0;n.mode=0,n.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(n.Type=t.enums===String?c.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(n.Data=t.bytes===String?a.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?n.filesize=t.longs===String?String(e.filesize):e.filesize:n.filesize=t.longs===String?a.Long.prototype.toString.call(e.filesize):t.longs===Number?new a.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){n.blocksizes=[];for(var s=0;s<e.blocksizes.length;++s)"number"==typeof e.blocksizes[s]?n.blocksizes[s]=t.longs===String?String(e.blocksizes[s]):e.blocksizes[s]:n.blocksizes[s]=t.longs===String?a.Long.prototype.toString.call(e.blocksizes[s]):t.longs===Number?new a.LongBits(e.blocksizes[s].low>>>0,e.blocksizes[s].high>>>0).toNumber(!0):e.blocksizes[s]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?n.hashType=t.longs===String?String(e.hashType):e.hashType:n.hashType=t.longs===String?a.Long.prototype.toString.call(e.hashType):t.longs===Number?new a.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?n.fanout=t.longs===String?String(e.fanout):e.fanout:n.fanout=t.longs===String?a.Long.prototype.toString.call(e.fanout):t.longs===Number?new a.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(n.mtime=c.UnixTime.toObject(e.mtime,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),c.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Seconds=a.Long?a.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=o.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.UnixTime;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Seconds"))throw a.ProtocolError("missing required 'Seconds'",{instance:r});return r},e.fromObject=function(e){if(e instanceof c.UnixTime)return e;var t=new c.UnixTime;return null!=e.Seconds&&(a.Long?(t.Seconds=a.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new a.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(a.Long){var r=new a.Long(0,0,!1);n.Seconds=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.Seconds=t.longs===String?"0":0;n.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?n.Seconds=t.longs===String?String(e.Seconds):e.Seconds:n.Seconds=t.longs===String?a.Long.prototype.toString.call(e.Seconds):t.longs===Number?new a.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=e.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e})(),c.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=o.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.Metadata;e.pos<n;){var s=e.uint32();if(s>>>3==1)r.MimeType=e.string();else e.skipType(7&s)}return r},e.fromObject=function(e){if(e instanceof c.Metadata)return e;var t=new c.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(n.MimeType=e.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e})(),parseInt("0644",8),parseInt("0755",8);function u(e){if(null!=e)return"number"==typeof e?4095&e:"0"===(e=e.toString()).substring(0,1)?4095&parseInt(e,8):4095&parseInt(e,10)}function l(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const n=e.getTime(),r=Math.floor(n/1e3);t={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw r(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}},5377:function(e,t,n){"use strict";async function r(e){const t=[];for await(const n of e)t.push(n);return t}n.d(t,{Z:function(){return r}})},97295:function(e,t){"use strict";t.Z=()=>{}},89755:function(e,t,n){"use strict";n.d(t,{n:function(){return u}});var r=n(32114),s=n(53597),i=n(75671),o=n(21007),a=n(20530),c=n(49121);async function*u(e,t){if("string"==typeof e||e instanceof String||(0,a._t)(e)||(0,a.Lj)(e)||e._readableState)throw r(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if((0,a.Os)(e)&&(e=(0,s.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const n=(0,i.Z)(e),{value:s,done:c}=await n.peek();if(c)return void(yield*[]);if(n.push(s),Number.isInteger(s))throw r(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(s._readableState)return void(yield*(0,o.Z)(n,(e=>l({content:e},t))));if((0,a._t)(s))return void(yield l({content:n},t));if((0,a.Mk)(s)||s[Symbol.iterator]||s[Symbol.asyncIterator]||(0,a.Os)(s)||(0,a.Lj)(s))return void(yield*(0,o.Z)(n,(e=>l(e,t))))}if((0,a.Mk)(e))throw r(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");throw r(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}async function l(e,t){const{path:n,mode:r,mtime:s,content:i}=e,o={path:n||"",mode:(0,c.tK)(r),mtime:(0,c.Xu)(s)};return i?o.content=await t(i):n||(o.content=await t(e)),o}},32075:function(e,t,n){"use strict";n.d(t,{u:function(){return h}});var r=n(32114),s=n(77408),i=n(53597);var o=n(75671),a=n(5377),c=n(21007),u=n(20530);async function*l(e){yield e}async function h(e){if((0,u._t)(e))return l(f(e));if("string"==typeof e||e instanceof String)return l(f(e.toString()));if((0,u.Lj)(e))return"function"==typeof(t=e).stream?(0,i.Z)(t.stream()):(0,i.Z)(new Response(t).body);var t;if((0,u.Os)(e)&&(e=(0,i.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=(0,o.Z)(e),{value:n,done:r}=await t.peek();if(r)return l(new Uint8Array(0));if(t.push(n),Number.isInteger(n))return l(Uint8Array.from(await(0,a.Z)(t)));if((0,u._t)(n)||"string"==typeof n||n instanceof String)return(0,c.Z)(t,f)}throw r(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}function f(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?Uint8Array.from(e):(0,s.m)(e.toString())}},56740:function(e,t,n){"use strict";n.d(t,{f:function(){return l}});var r=n(32075),s=n(32114),i=n(53597),o=n(75671),a=n(20530),c=n(49121);async function u(e,t){const{path:n,mode:r,mtime:s,content:i}=e,o={path:n||"",mode:(0,c.tK)(r),mtime:(0,c.Xu)(s)};return i?o.content=await t(i):n||(o.content=await t(e)),o}function l(e){return async function*(e,t){if(null==e)throw s(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");if("string"==typeof e||e instanceof String)yield u(e.toString(),t);else if((0,a._t)(e)||(0,a.Lj)(e))yield u(e,t);else{if((0,a.Os)(e)&&(e=(0,i.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const n=(0,o.Z)(e),{value:r,done:i}=await n.peek();if(i)return void(yield{content:[]});if(n.push(r),Number.isInteger(r)||(0,a._t)(r)||"string"==typeof r||r instanceof String)return void(yield u(n,t));throw s(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(!(0,a.Mk)(e))throw s(new Error('Unexpected input: cannot convert "'+typeof e+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT");yield u(e,t)}}(e,r.u)}},20530:function(e,t,n){"use strict";function r(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer}function s(e){return e.constructor&&("Blob"===e.constructor.name||"File"===e.constructor.name)&&"function"==typeof e.stream}function i(e){return"object"==typeof e&&(e.path||e.content)}n.d(t,{Lj:function(){return s},Mk:function(){return i},Os:function(){return o},_t:function(){return r}});const o=e=>e&&"function"==typeof e.getReader},51392:function(e,t,n){"use strict";n.d(t,{x:function(){return s}});const r=e=>Promise.reject(new Error(`No base found for "${e}"`));class s{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||r;for(const t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];const t=await this._loadBase(e);return null==this._basesByName[t.name]&&null==this._basesByPrefix[t.prefix]&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}}},52890:function(e,t,n){"use strict";n.d(t,{w:function(){return s}});const r=e=>Promise.reject(new Error(`No codec found for "${e}"`));class s{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||r;for(const t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){const t="string"==typeof e?this._codecsByName:this._codecsByCode;if(t[e])return t[e];const n=await this._loadCodec(e);return null==t[e]&&this.addCodec(n),n}listCodecs(){return Object.values(this._codecsByName)}}},55101:function(e,t,n){"use strict";n.d(t,{d:function(){return s}});const r=e=>Promise.reject(new Error(`No hasher found for "${e}"`));class s{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||r;for(const t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){const t="string"==typeof e?this._hashersByName:this._hashersByCode;if(t[e])return t[e];const n=await this._loadHasher(e);return null==t[e]&&this.addHasher(n),n}listHashers(){return Object.values(this._hashersByName)}}},47498:function(e,t,n){"use strict";n.d(t,{x:function(){return f}});var r=n(32114),s=n(75671),i=n(53597),o=n(5377),a=n(20530);async function c(e){if((0,a._t)(e))return new Blob([e]);if("string"==typeof e||e instanceof String)return new Blob([e.toString()]);if((0,a.Lj)(e))return e;if((0,a.Os)(e)&&(e=(0,i.Z)(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=(0,s.Z)(e),{value:n,done:r}=await t.peek();if(r)return u(t);if(t.push(n),Number.isInteger(n))return new Blob([Uint8Array.from(await(0,o.Z)(t))]);if((0,a._t)(n)||"string"==typeof n||n instanceof String)return u(t)}throw r(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}async function u(e){const t=[];for await(const n of e)t.push(n);return new Blob(t)}var l=n(89755);function h(e){if(null!=e)return"string"==typeof e?e:e.toString(8).padStart(4,"0")}async function f(e,t,n={}){const r=[],s=new FormData;let i=0,o=0;for await(const{content:t,path:n,mode:u,mtime:f}of(a=e,(0,l.n)(a,c,!0))){let e="";i>0&&(e=`-${i}`);let a=(t?"file":"dir")+e;const c=[];if(null!=u&&c.push(`mode=${h(u)}`),null!=f){const{secs:e,nsecs:t}=f;c.push(`mtime=${e}`),null!=t&&c.push(`mtime-nsecs=${t}`)}if(c.length&&(a=`${a}?${c.join("&")}`),t){s.set(a,t,null!=n?encodeURIComponent(n):void 0);const e=o+t.size;r.push({name:n,start:o,end:e}),o=e}else{if(null==n)throw new Error("path or content or both must be set");s.set(a,new File([""],encodeURIComponent(n),{type:"application/x-directory"}))}i++}var a;return{total:o,parts:r,headers:n,body:s}}},73297:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var r=n(32114),s=n(38161);function i(e){return null!=s.k0.asCID(e)}async function*o(e){if(null==e)throw r(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");const t=s.k0.asCID(e);if(t)yield a({cid:t});else{if(!(e instanceof String||"string"==typeof e)){if(null!=e.cid||null!=e.path)return yield a(e);if(n=e,Symbol.iterator in n){const t=e[Symbol.iterator](),n=t.next();if(n.done)return t;if(i(n.value)){yield a({cid:n.value});for(const e of t)yield a({cid:e});return}if(n.value instanceof String||"string"==typeof n.value){yield a({path:n.value});for(const e of t)yield a({path:e});return}if(null!=n.value.cid||null!=n.value.path){yield a(n.value);for(const e of t)yield a(e);return}throw r(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}var n;if(function(e){return Symbol.asyncIterator in e}(e)){const t=e[Symbol.asyncIterator](),n=await t.next();if(n.done)return t;if(i(n.value)){yield a({cid:n.value});for await(const e of t)yield a({cid:e});return}if(n.value instanceof String||"string"==typeof n.value){yield a({path:n.value});for await(const e of t)yield a({path:e});return}if(null!=n.value.cid||null!=n.value.path){yield a(n.value);for await(const e of t)yield a(e);return}throw r(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}throw r(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}yield a({path:e})}}function a(e){const t=e.cid||`${e.path}`;if(!t)throw r(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");const n={path:t,recursive:!1!==e.recursive};return null!=e.metadata&&(n.metadata=e.metadata),n}},63181:function(e,t,n){"use strict";n.d(t,{d:function(){return i}});var r=n(91026),s=n(38456);function i(e){try{e=(0,s.k)((0,r.HM)(e))}catch(e){}return e=e.toString()}},13963:function(e,t,n){"use strict";n.d(t,{Ue:function(){return Kb}});var r={};n.r(r),n.d(r,{InvalidValueError:function(){return bu},MissingRepoOptionsError:function(){return wu},NonReversibleMigrationError:function(){return yu},NotInitializedRepoError:function(){return gu},RequiredParameterError:function(){return mu}});var s={};n.r(s),n.d(s,{abortedError:function(){return Pb},notFoundError:function(){return Ob}});var i=n(79221),o=n(106),a=n(69860),c=n(32114),u=n(25853);const l=u.Reader,h=u.Writer,f=u.util,p=u.roots["ipfs-unixfs"]||(u.roots["ipfs-unixfs"]={}),d=p.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Type=0,e.prototype.Data=f.newBuffer([]),e.prototype.filesize=f.Long?f.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=f.emptyArray,e.prototype.hashType=f.Long?f.Long.fromBits(0,0,!0):0,e.prototype.fanout=f.Long?f.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=h.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var n=0;n<e.blocksizes.length;++n)t.uint32(32).uint64(e.blocksizes[n]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&p.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof l||(e=l.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new p.Data;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Type=e.int32();break;case 2:r.Data=e.bytes();break;case 3:r.filesize=e.uint64();break;case 4:if(r.blocksizes&&r.blocksizes.length||(r.blocksizes=[]),2==(7&s))for(var i=e.uint32()+e.pos;e.pos<i;)r.blocksizes.push(e.uint64());else r.blocksizes.push(e.uint64());break;case 5:r.hashType=e.uint64();break;case 6:r.fanout=e.uint64();break;case 7:r.mode=e.uint32();break;case 8:r.mtime=p.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Type"))throw f.ProtocolError("missing required 'Type'",{instance:r});return r},e.fromObject=function(e){if(e instanceof p.Data)return e;var t=new p.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?f.base64.decode(e.Data,t.Data=f.newBuffer(f.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&(f.Long?(t.filesize=f.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new f.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var n=0;n<e.blocksizes.length;++n)f.Long?(t.blocksizes[n]=f.Long.fromValue(e.blocksizes[n])).unsigned=!0:"string"==typeof e.blocksizes[n]?t.blocksizes[n]=parseInt(e.blocksizes[n],10):"number"==typeof e.blocksizes[n]?t.blocksizes[n]=e.blocksizes[n]:"object"==typeof e.blocksizes[n]&&(t.blocksizes[n]=new f.LongBits(e.blocksizes[n].low>>>0,e.blocksizes[n].high>>>0).toNumber(!0))}if(null!=e.hashType&&(f.Long?(t.hashType=f.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new f.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&(f.Long?(t.fanout=f.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new f.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=p.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.blocksizes=[]),t.defaults){if(n.Type=t.enums===String?"Raw":0,t.bytes===String?n.Data="":(n.Data=[],t.bytes!==Array&&(n.Data=f.newBuffer(n.Data))),f.Long){var r=new f.Long(0,0,!0);n.filesize=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.filesize=t.longs===String?"0":0;if(f.Long){r=new f.Long(0,0,!0);n.hashType=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.hashType=t.longs===String?"0":0;if(f.Long){r=new f.Long(0,0,!0);n.fanout=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.fanout=t.longs===String?"0":0;n.mode=0,n.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(n.Type=t.enums===String?p.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(n.Data=t.bytes===String?f.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?n.filesize=t.longs===String?String(e.filesize):e.filesize:n.filesize=t.longs===String?f.Long.prototype.toString.call(e.filesize):t.longs===Number?new f.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){n.blocksizes=[];for(var s=0;s<e.blocksizes.length;++s)"number"==typeof e.blocksizes[s]?n.blocksizes[s]=t.longs===String?String(e.blocksizes[s]):e.blocksizes[s]:n.blocksizes[s]=t.longs===String?f.Long.prototype.toString.call(e.blocksizes[s]):t.longs===Number?new f.LongBits(e.blocksizes[s].low>>>0,e.blocksizes[s].high>>>0).toNumber(!0):e.blocksizes[s]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?n.hashType=t.longs===String?String(e.hashType):e.hashType:n.hashType=t.longs===String?f.Long.prototype.toString.call(e.hashType):t.longs===Number?new f.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?n.fanout=t.longs===String?String(e.fanout):e.fanout:n.fanout=t.longs===String?f.Long.prototype.toString.call(e.fanout):t.longs===Number?new f.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(n.mtime=p.UnixTime.toObject(e.mtime,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,u.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),y=(p.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Seconds=f.Long?f.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=h.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof l||(e=l.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new p.UnixTime;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Seconds"))throw f.ProtocolError("missing required 'Seconds'",{instance:r});return r},e.fromObject=function(e){if(e instanceof p.UnixTime)return e;var t=new p.UnixTime;return null!=e.Seconds&&(f.Long?(t.Seconds=f.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new f.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(f.Long){var r=new f.Long(0,0,!1);n.Seconds=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.Seconds=t.longs===String?"0":0;n.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?n.Seconds=t.longs===String?String(e.Seconds):e.Seconds:n.Seconds=t.longs===String?f.Long.prototype.toString.call(e.Seconds):t.longs===Number?new f.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=e.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,u.util.toJSONOptions)},e})(),p.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=h.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof l||(e=l.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new p.Metadata;e.pos<n;){var s=e.uint32();if(s>>>3==1)r.MimeType=e.string();else e.skipType(7&s)}return r},e.fromObject=function(e){if(e instanceof p.Metadata)return e;var t=new p.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(n.MimeType=e.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,u.util.toJSONOptions)},e})(),d),g=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],m=["directory","hamt-sharded-directory"],b=parseInt("0644",8),w=parseInt("0755",8);function v(e){if(null!=e)return"number"==typeof e?4095&e:"0"===(e=e.toString()).substring(0,1)?4095&parseInt(e,8):4095&parseInt(e,10)}function E(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const n=e.getTime(),r=Math.floor(n/1e3);t={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw c(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}class _{static unmarshal(e){const t=y.decode(e),n=y.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),r=new _({type:g[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return r._originalMode=n.mode||0,r}constructor(e={type:"file"}){const{type:t,data:n,blockSizes:r,hashType:s,fanout:i,mtime:o,mode:a}=e;if(t&&!g.includes(t))throw c(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=s,this.fanout=i,this.blockSizes=r||[],this._originalMode=0,this.mode=v(a),o&&(this.mtime=E(o),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?w:b;const t=v(e);void 0!==t&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&m.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach((t=>{e+=t})),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=y.DataType.Raw;break;case"directory":e=y.DataType.Directory;break;case"file":e=y.DataType.File;break;case"metadata":e=y.DataType.Metadata;break;case"symlink":e=y.DataType.Symlink;break;case"hamt-sharded-directory":e=y.DataType.HAMTShard;break;default:throw c(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t,n,r=this.data;if(this.data&&this.data.length||(r=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(v(this.mode)||0),t!==b||this.isDirectory()||(t=void 0),t===w&&this.isDirectory()&&(t=void 0)),null!=this.mtime){const e=E(this.mtime);e&&(n={Seconds:e.secs,FractionalNanoseconds:e.nsecs},0===n.FractionalNanoseconds&&delete n.FractionalNanoseconds)}const s={Type:e,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:n};return y.encode(s).finish()}}var k=n(33808),S=n(90560),T=n(36921),A=n(84296),I=n(38566),x=n(97098);class O extends Error{constructor(e="not initialized"){super(e),this.name="NotInitializedError",this.code=O.code}}O.code="ERR_NOT_INITIALIZED";class P extends Error{constructor(e="cannot initialize an initializing node"){super(e),this.name="AlreadyInitializingError",this.code=R.code}}P.code="ERR_ALREADY_INITIALIZING";class R extends Error{constructor(e="cannot re-initialize an initialized node"){super(e),this.name="AlreadyInitializedError",this.code=R.code}}R.code="ERR_ALREADY_INITIALIZED";class N extends Error{constructor(e="not started"){super(e),this.name="NotStartedError",this.code=N.code}}N.code="ERR_NOT_STARTED";class D extends Error{constructor(e="cannot start, already startin"){super(e),this.name="AlreadyStartingError",this.code=D.code}}D.code="ERR_ALREADY_STARTING";class C extends Error{constructor(e="cannot start, already started"){super(e),this.name="AlreadyStartedError",this.code=C.code}}C.code="ERR_ALREADY_STARTED";class L extends Error{constructor(e="not enabled"){super(e),this.name="NotEnabledError",this.code=L.code}}L.code="ERR_NOT_ENABLED";var B=n(77408),M=n(10715),j=n(81653),z=n(14249),U=n(29094),F=n(91026),$=n(61093),H=n(38161),V=n(17745),K=n(49784);const q=/^\/(ip[fn]s)\/([^/?#]+)/,W=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/,G=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function J(e){try{return X(e)?Boolean(H.k0.parse(e)):e instanceof Uint8Array?Boolean(H.k0.decode(e)):Boolean(H.k0.asCID(e))}catch{return!1}}function Z(e,t,n=1,r=2){const s=Q(e);if(!1===s)return!1;const i=s.match(t);if(null==i)return!1;if("ipfs"!==i[n])return!1;let o=i[r];return null!=o&&t===W&&(o=o.toLowerCase()),J(o)}function Y(e,t,n=1,r=2){const s=Q(e);if(!1===s)return!1;const i=s.match(t);if(null==i)return!1;if("ipns"!==i[n])return!1;let o=i[r];if(null!=o&&t===W){if(o=o.toLowerCase(),J(o))return!0;try{!o.includes(".")&&o.includes("-")&&(o=o.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));const{hostname:e}=new V.URL(`http://${o}`);return G.test(e)}catch(e){return!1}}return!0}function X(e){return"string"==typeof e}function Q(e){return e instanceof Uint8Array?(0,K.B)(e,"base58btc"):!!X(e)&&e}const ee=e=>Z(e,q)||Y(e,q),te=e=>Y(e,q);var ne=n(66699),re=n(32044),se=n(90072);class ie extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=ie.code}}function oe(e,t){return(...n)=>{const r=n[null==t?n.length-1:t];if(!r||!r.timeout)return e(...n);const s="string"==typeof r.timeout?(0,se.Z)(r.timeout):r.timeout,i=new M.TimeoutController(s);r.signal=(0,re.anySignal)([r.signal,i.signal]);const o=e(...n),a=new Promise(((e,t)=>{i.signal.addEventListener("abort",(()=>{t(new ie)}))})),c=Date.now(),u=()=>{if(i.signal.aborted)throw new ie;if(Date.now()-c>s)throw i.abort(),new ie};return o[Symbol.asyncIterator]?async function*(){const e=o[Symbol.asyncIterator]();try{for(;;){const{value:t,done:n}=await Promise.race([e.next(),a]);if(n)break;u(),yield t}}catch(e){throw u(),e}finally{i.clear(),e.return&&e.return()}}():(async()=>{try{const e=await Promise.race([o,a]);return u(),e}catch(e){throw u(),e}finally{i.clear()}})()}}ie.code="ERR_TIMEOUT";const ae="/ipfs/";function ce(e){if(e instanceof Uint8Array)try{e=H.k0.decode(e)}catch(e){throw c(e,"ERR_INVALID_CID")}let t=H.k0.asCID(e);if(t)return{cid:t,path:void 0};(e=e.toString()).startsWith(ae)&&(e=e.substring(ae.length));const n=e.split("/");let r;try{t=H.k0.parse(n.shift()||"")}catch(e){throw c(e,"ERR_INVALID_CID")}return n.length&&(r=`/${n.join("/")}`),{cid:t,path:r}}const ue="This command must be run in online mode. Try running 'ipfs daemon' first.",le=new ne.s("/local/filesroot"),he=e=>e instanceof Uint8Array?H.k0.decode(e).toString():(0===(e=e.toString()).indexOf("/ipfs/")&&(e=e.substring("/ipfs/".length)),"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e),fe=async function(e,t,n,r={}){const{cid:s,path:i}=ce(n);i&&(r.path=i);let o=s,a=r.path||"";if(a.startsWith("/")&&(a=a.substring(1)),r.path)try{for await(const{value:n,remainderPath:i}of ye(s,r.path,t,e,{signal:r.signal})){if(!H.k0.asCID(n))break;a=i,o=n}}catch(e){throw e.message.startsWith("Object has no property")&&(e.message=`no link named "${a.split("/")[0]}" under ${o}`,e.code="ERR_NO_LINK"),e}return{cid:o,remainderPath:a||""}},pe=e=>{if("file"!==e.type&&"directory"!==e.type&&"raw"!==e.type)throw new Error(`Unknown node type '${e.type}'`);const t={cid:e.cid,path:e.path,name:e.name,size:e.size,type:"file"};return"directory"===e.type&&(t.type="dir"),"file"===e.type&&(t.size=e.unixfs.fileSize()),"file"!==e.type&&"directory"!==e.type||(t.mode=e.unixfs.mode,void 0!==e.unixfs.mtime&&(t.mtime=e.unixfs.mtime)),t},de=oe((async(e,t)=>await e)),ye=async function*(e,t,n,r,s){const i=async e=>{const t=await n.getCodec(e.code),i=await r.blocks.get(e,s);return t.decode(i)},o=t.split("/").filter(Boolean);let a=await i(e),u=e;for(;o.length;){const n=o.shift();if(!n)throw c(new Error(`Could not resolve path "${t}"`),"ERR_INVALID_PATH");if(e.code===k.code&&Array.isArray(a.Links)){const e=a.Links.find((e=>e.Name===n));if(e){yield{value:e.Hash,remainderPath:o.join("/")},a=await i(e.Hash),u=e.Hash;continue}}if(!Object.prototype.hasOwnProperty.call(a,n))throw c(new Error(`no link named "${n}" under ${u}`),"ERR_NO_LINK");a=a[n],yield{value:a,remainderPath:o.join("/")},H.k0.asCID(a)&&(u=a,a=await i(a))}yield{value:a,remainderPath:""}};class ge{static create({start:e,stop:t}){return new ge(e,t)}static async start(e,t){const{state:n,activate:r}=e;switch(n.status){case"stopped":try{const n=r(t);e.state={status:"starting",ready:n};const s=await n;return e.state={status:"started",value:s},s}catch(t){throw e.state={status:"stopped"},t}case"starting":throw new D;case"started":throw new C;case"stopping":return await n.ready,await ge.start(e,t);default:return ge.panic(e)}}static async stop(e){const{state:t,deactivate:n}=e;switch(t.status){case"stopped":break;case"starting":try{await t.ready}catch(e){}return await ge.stop(e);case"stopping":return await t.ready;case"started":n&&await n(t.value),e.state={status:"stopped"};break;default:ge.panic(t)}}static try({state:e}){return"started"===e.status?e.value:null}static async use({state:e},t){switch(e.status){case"started":return e.value;case"starting":return await de(e.ready,t);default:throw new N}}static panic({state:e}){const t=JSON.stringify({status:e.status});throw RangeError(`Service in invalid state ${t}, should never happen if you see this please report a bug`)}constructor(e,t){this.activate=e,this.deactivate=t,this.state={status:"stopped"}}async use(e){return await ge.use(this,e)}try(){return ge.try(this)}}var me=n(70248);var be=n(28364),we=n(67137);const ve=new class{constructor(e){this.lru=me(e)}get(e){const t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}(1e3),Ee=6e4,_e=new(be.Z.default?be.Z.default:be.Z)({concurrency:4}),ke=e=>{if(e.Path)return e.Path;throw new Error(e.Message)};function Se(){return oe((async(e,t={recursive:!0})=>{if("string"!=typeof e)throw new Error("Invalid arguments, domain must be a string");return async function(e,t){return(async(e,t={})=>{const n=new URLSearchParams(t);n.set("arg",e);const r=n.toString();if(!t.nocache&&ve.has(r)){const e=ve.get(r);return ke(e)}const s=await _e.add((async()=>{const e=await we.get("https://ipfs.io/api/v0/dns",{searchParams:n}),t=new URL(e.url).search.slice(1),r=await e.json();return ve.set(t,r,Ee),r}));return ke(s)})(e,t)}(e=function(e){return e.endsWith(".eth")&&(e=e.replace(/.eth$/,".eth.link")),e}(e),t)}))}var Te=n(23366);function Ae({repo:e,codecs:t,bases:n,name:r}){return oe((async function(s,i={}){if(!ee(s))throw new Error("invalid argument "+s);if(te(s))for await(const e of r.resolve(s,i))s=e;const[,o,a,...c]=s.split("/"),u=i.cidBase?await n.getBase(i.cidBase):void 0,l=function(e){try{return(0,Te.jE)(e).toBytes()}catch{return H.k0.parse(e).bytes}}(a);if(0===c.length){return`/${o}/${u?u.encoder.encode(l):a}`}const h=H.k0.decode(l);s=c.join("/");const f=ye(h,s,t,e,i);let p=h,d=s;for await(const e of f)H.k0.asCID(e.value)&&(p=e.value,d=e.remainderPath);return`/ipfs/${p.toString(u&&u.encoder)}${d?"/"+d:""}`}))}var Ie=n(68883);var xe=n(73297);const Oe={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function Pe(e,t,n){const r={type:e,cid:t};return n&&(r.metadata=n),r}class Re{constructor({codecs:e,repo:t}){const n=function({repo:e,codecs:t}){return oe((async function*(n,r={}){const s=async function*(){for await(const{path:r,recursive:s,metadata:i}of(0,xe.f)(n)){const{cid:n}=await fe(e,t,r),{reason:o}=await e.pins.isPinnedWithType(n,[Oe.recursive,Oe.direct]);if("recursive"===o&&!s)throw new Error(`${n} already pinned recursively`);s?await e.pins.pinRecursively(n,{metadata:i}):await e.pins.pinDirectly(n,{metadata:i}),yield n}};if(!Boolean(r.lock))return void(yield*s());const i=await e.gcLock.readLock();try{yield*s()}finally{i()}}))}({codecs:e,repo:t});this.addAll=n,this.add=function({addAll:e}){return(t,n={})=>{let r;const s=H.k0.asCID(t);return r=e(s?[{cid:s,...n}]:[{path:t.toString(),...n}],n),(0,Ie.Z)(r)}}({addAll:n});const r=function({repo:e,codecs:t}){return oe((async function*(n,r={}){const s=await e.gcLock.readLock();try{for await(const{path:r,recursive:s}of(0,xe.f)(n)){const{cid:n}=await fe(e,t,r),{pinned:i,reason:o}=await e.pins.isPinnedWithType(n,Oe.all);if(!i)throw new Error(`${n} is not pinned`);switch(o){case Oe.recursive:if(!s)throw new Error(`${n} is pinned recursively`);await e.pins.unpin(n),yield n;break;case Oe.direct:await e.pins.unpin(n),yield n;break;default:throw new Error(`${n} is pinned indirectly under ${o}`)}}}finally{s()}}))}({codecs:e,repo:t});this.rmAll=r,this.rm=function({rmAll:e}){return async function(t,n={}){const r=await(0,Ie.Z)(e([{path:t,...n}],n));if(!r)throw new Error("CID expected");return r}}({rmAll:r}),this.ls=function({repo:e,codecs:t}){return oe((async function*(n={}){let r=Oe.all;if(n.type&&(r=n.type,!Object.keys(Oe).includes(r)))throw c(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(n.paths){let s=!1;for await(const{path:i}of(0,xe.f)(n.paths)){const{cid:n}=await fe(e,t,i),{reason:o,pinned:a,parent:u,metadata:l}=await e.pins.isPinnedWithType(n,r);if(!a)throw c(new Error(`path '${i}' is not pinned`),"ERR_NOT_PINNED");switch(o){case Oe.direct:case Oe.recursive:s=!0,yield Pe(o,n,l);break;default:s=!0,yield Pe(`${Oe.indirect} through ${u}`,n,l)}}if(!s)throw new Error("No match found")}else{if(r===Oe.recursive||r===Oe.all)for await(const{cid:t,metadata:n}of e.pins.recursiveKeys())yield Pe(Oe.recursive,t,n);if(r===Oe.indirect||r===Oe.all)for await(const t of e.pins.indirectKeys(n))yield Pe(Oe.indirect,t);if(r===Oe.direct||r===Oe.all)for await(const{cid:t,metadata:n}of e.pins.directKeys())yield Pe(Oe.direct,t,n)}}))}({codecs:e,repo:t}),this.remote={add:(e,t={})=>Promise.reject(new Error("Not implemented")),ls:async function*(e,t={}){return Promise.reject(new Error("Not implemented"))},rm:(e,t={})=>Promise.reject(new Error("Not implemented")),rmAll:(e,t={})=>Promise.reject(new Error("Not implemented")),service:{add:(e,t)=>Promise.reject(new Error("Not implemented")),rm:(e,t={})=>Promise.reject(new Error("Not implemented")),ls:(e={})=>Promise.reject(new Error("Not implemented"))}}}}var Ne=n(682),De=n(40668),Ce=n(73062),Le=n(79297),Be=n(86906);const Me="ERR_UNRECOGNIZED_VALIDITY",je="ERR_SIGNATURE_VERIFICATION",ze="ERR_UNDEFINED_PARAMETER";var Ue=n(77914),Fe=n(97151),$e=n(29078),He=n(48320);n(44738)._configure(),Ue._configure(Fe),$e._configure(He);const Ve=["uint64","int64","sint64","fixed64","sfixed64"];function Ke(e){return function(e){for(const t of Ve){if(null==e[t])continue;const n=e[t];e[t]=function(){return BigInt(n.call(this).toString())}}return e}(new Ue(e))}function qe(){return function(e){for(const t of Ve){if(null==e[t])continue;const n=e[t];e[t]=function(e){return n.call(this,e.toString())}}return e}($e.create())}var We,Ge;function Je(e,t,n,r){return{name:e,type:t,encode:n,decode:r}}!function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(We||(We={})),function(e){let t,n,r;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(n||(n={})),function(e){e.codec=()=>function(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return Je("enum",We.VARINT,(function(e,n){const r=t(e);n.int32(r)}),(function(e){return t(e.int32())}))}(n)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==r&&(r=function(e,t){return Je("message",We.LENGTH_DELIMITED,e,t)}(((t,n,r={})=>{!1!==r.lengthDelimited&&n.fork(),null!=t.value&&(n.uint32(10),n.bytes(t.value)),null!=t.signature&&(n.uint32(18),n.bytes(t.signature)),null!=t.validityType&&(n.uint32(24),e.ValidityType.codec().encode(t.validityType,n)),null!=t.validity&&(n.uint32(34),n.bytes(t.validity)),null!=t.sequence&&(n.uint32(40),n.uint64(t.sequence)),null!=t.ttl&&(n.uint32(48),n.uint64(t.ttl)),null!=t.pubKey&&(n.uint32(58),n.bytes(t.pubKey)),null!=t.signatureV2&&(n.uint32(66),n.bytes(t.signatureV2)),null!=t.data&&(n.uint32(74),n.bytes(t.data)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},s=null==n?t.len:t.pos+n;for(;t.pos<s;){const n=t.uint32();switch(n>>>3){case 1:r.value=t.bytes();break;case 2:r.signature=t.bytes();break;case 3:r.validityType=e.ValidityType.codec().decode(t);break;case 4:r.validity=t.bytes();break;case 5:r.sequence=t.uint64();break;case 6:r.ttl=t.uint64();break;case 7:r.pubKey=t.bytes();break;case 8:r.signatureV2=t.bytes();break;case 9:r.data=t.bytes();break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>function(e,t){const n=qe();return t.encode(e,n,{lengthDelimited:!1}),n.finish()}(t,e.codec()),e.decode=t=>function(e,t){const n=Ke(e instanceof Uint8Array?e:e.subarray());return t.decode(n)}(t,e.codec())}(Ge||(Ge={}));var Ze=n(41690),Ye=n(64936);const Xe=(0,a.kg)("ipns:utils"),Qe=(0,B.m)("/ipns/");function et(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(e).trim().match(t);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),s=parseInt(n[2],10)-1,i=parseInt(n[3],10),o=parseInt(n[4],10),a=parseInt(n[5],10),c=parseInt(n[6],10),u=parseInt(n[7].slice(0,-6),10);return new Date(Date.UTC(r,s,i,o,a,c,u))}const tt=e=>{const t=(0,B.m)("ipns-signature:");return(0,Ze.z)([t,e])},nt=e=>{const t=Ge.decode(e);return null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),{value:t.value??new Uint8Array(0),signature:t.signature??new Uint8Array(0),validityType:t.validityType??Ge.ValidityType.EOL,validity:t.validity??new Uint8Array(0),sequence:t.sequence??0n,pubKey:t.pubKey,ttl:t.ttl??void 0,signatureV2:t.signatureV2,data:t.data}},rt=e=>(0,Ze.z)([Qe,e.toBytes()]),st=(0,a.kg)("ipns"),it=I.identity.code,ot="/ipns/",at=ot.length,ct=async(e,t,n,r,s,i)=>{n=BigInt(n);const o=(0,B.m)(s.toString());if(null==e.privateKey)throw c(new Error("Missing private key"),"ERR_MISSING_PRIVATE_KEY");const a=await(0,Be.unmarshalPrivateKey)(e.privateKey),u=await lt(a,t,r,o),l=((e,t,n,r,s)=>{let i;if(n!==Ge.ValidityType.EOL)throw c(new Error("Unknown validity type"),Me);i=0;const o={Value:e,Validity:t,ValidityType:i,Sequence:r,TTL:s};return Ye.cv(o)})(t,o,r,n,i),h=tt(l),f={value:t,signature:u,validityType:r,validity:o,sequence:n,ttl:i,signatureV2:await a.sign(h),data:l};if(null!=e.publicKey){const t=U.Jx(e.toBytes());t.code===it&&(0,Ce.f)(e.publicKey,t.digest)||(f.pubKey=e.publicKey)}return st("ipns entry for %b created",t),f},ut=e=>new ne.s(`/ipns/${(e=>z.base32upper.encode(e).slice(1))(e)}`),lt=async(e,t,n,r)=>{try{const s=((e,t,n)=>{const r=(0,B.m)(t);return(0,Ze.z)([e,n,r])})(t,n,r);return await e.sign(s)}catch(e){throw st.error("record signature creation failed",e),c(new Error("record signature creation failed"),"ERR_SIGNATURE_CREATION")}},ht=(0,a.kg)("ipfs:ipns:publisher"),ft=(0,De.notFoundError)().code,pt=36e5;class dt{constructor(e,t){this._routing=e,this._datastore=t}async publishWithEOL(e,t,n,r){const s=await this._updateOrCreateRecord(e,t,n,r);return this._putRecordToRouting(s,e,r)}publish(e,t,n){return this.publishWithEOL(e,t,pt,n)}async _putRecordToRouting(e,t,n){if(!(0,Ne.I)(t)){const e="peerId received is not valid";throw ht.error(e),c(new Error(e),"ERR_INVALID_PEER_ID")}if(null==t.publicKey)throw c(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");const r=rt(t);return await this._publishEntry(r,e,n),e}async _publishEntry(e,t,n){try{const r=await this._routing.put(e,t,n);return ht(`ipns record for ${(0,K.B)(e,"base32")} was stored in the routing`),r}catch(t){const n=`ipns record for ${(0,K.B)(e,"base32")} could not be stored in the routing - ${t.stack}`;throw ht.error(n),ht.error(t),c(new Error(n),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(e,t={}){if(!(0,Ne.I)(e)){const e="peerId received is not valid";throw ht.error(e),c(new Error(e),"ERR_INVALID_PEER_ID")}const n=!1!==t.checkRouting;try{const t=await this._datastore.get(ut(e.toBytes()));return this._unmarshalData(t)}catch(t){if(t.code!==ft){const t=`unexpected error getting the ipns record ${e.toString()} from datastore`;throw ht.error(t),c(new Error(t),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!n)throw c(t,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{const t=rt(e),n=await this._routing.get(t);return this._unmarshalData(n)}catch(e){throw ht.error(e),e}}}_unmarshalData(e){try{return nt(e)}catch(e){throw c(e,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(e,t,n,r){if(!(0,Ne.I)(e)){const e="peerId received is not valid";throw ht.error(e),c(new Error(e),"ERR_INVALID_PEER_ID")}const s={checkRouting:!0};let i;try{i=await this._getPublished(e,s)}catch(t){if(t.code!==ft){const n=`unexpected error when determining the last published IPNS record for ${e.toString()} ${t.stack}`;throw ht.error(n),c(new Error(n),"ERR_DETERMINING_PUBLISHED_RECORD")}}let o,a=0n;i&&void 0!==i.sequence&&(a=(0,Ce.f)(i.value,t)?i.sequence:i.sequence+BigInt(1));try{o=await(async(e,t,n,r)=>{const s=new Le(Date.now()+Number(r)),i=Ge.ValidityType.EOL,[o,a]=r.toString().split("."),c=BigInt(o)*BigInt(1e5)+BigInt(a??"0");return await ct(e,t,n,i,s,c)})(e,t,a,n)}catch(e){const n=`ipns record for ${t} could not be created`;throw ht.error(e),c(new Error(n),"ERR_CREATING_IPNS_RECORD")}try{const n=(u=o,Ge.encode(u));return await this._datastore.put(ut(e.toBytes()),n,r),ht(`ipns record for ${(0,K.B)(t,"base32")} was stored in the datastore`),n}catch(e){const n=`ipns record for ${t} could not be stored in the datastore`;throw ht.error(n),c(new Error(n),"ERR_STORING_IN_DATASTORE")}var u}}dt.defaultRecordLifetime=pt;const yt=(0,a.kg)("ipfs:ipns:republisher");class gt{constructor(e,t,n,r,s={pass:""}){this._publisher=e,this._datastore=t,this._peerId=n,this._keychain=r,this._options=s,this._republishHandle=null}async start(){if(this._republishHandle)throw c(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");const e={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:t=>{e._timeoutId=setTimeout((async()=>{e._timeoutId=null;try{e._inflightTask=e._task(),await e._inflightTask,e._task&&e.runPeriodically(t)}catch(e){yt.error(e)}}),t())},cancel:async()=>{null!=e._timeoutId&&clearTimeout(e._timeoutId),e._task=null,await e._inflightTask}},{pass:t}=this._options;let n=!0;e._task=async()=>{const e=new M.TimeoutController(3e4);try{await this._republishEntries(this._peerId,t,{signal:e.signal})}finally{e.clear()}},e.runPeriodically((()=>n?(n=!1,this._options.initialBroadcastInterval||6e4):this._options.broadcastInterval||144e5)),this._republishHandle=e}async stop(){const e=this._republishHandle;if(!e)throw c(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await e.cancel()}async _republishEntries(e,t,n){try{await this._republishEntry(e,n)}catch(e){const t="cannot republish entry for the node's private key";return void yt.error(t)}if(t)try{const e=await this._keychain.listKeys();for(const r of e){if("self"===r.name)continue;const e=await this._keychain.exportKey(r.name,t),s=await(0,Be.importKey)(e,t),i=await(0,Te.y5)(s.public.bytes,s.bytes);await this._republishEntry(i,n)}}catch(e){yt.error(e)}}async _republishEntry(e,t){try{const n=await this._getPreviousValue(e);await this._publisher.publishWithEOL(e,n,864e5,t)}catch(e){if("ERR_NO_ENTRY_FOUND"===e.code)return;throw e}}async _getPreviousValue(e){if(!(0,Ne.I)(e))throw c(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{const t=await this._datastore.get(ut(e.toBytes()));if(!(t instanceof Uint8Array))throw c(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{return nt(t).value}catch(e){throw yt.error(e),c(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(t){if(t&&t.notFound)throw c(new Error(`no previous entry for record with id: ${e.toString()}`),"ERR_NO_ENTRY_FOUND");throw t}}}const mt=(0,a.kg)("ipns:validator"),bt=e=>{if(null==e.data)throw c(new Error("Record data is missing"),"ERR_INVALID_RECORD_DATA");const t=(e=>{const t=Ye.Jx(e);if(0!==t.ValidityType)throw c(new Error("Unknown validity type"),Me);return t.ValidityType=Ge.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t})(e.data);if(!(0,Ce.f)(t.Value,e.value))throw c(new Error('Field "value" did not match between protobuf and CBOR'),je);if(!(0,Ce.f)(t.Validity,e.validity))throw c(new Error('Field "validity" did not match between protobuf and CBOR'),je);if(t.ValidityType!==e.validityType)throw c(new Error('Field "validityType" did not match between protobuf and CBOR'),je);if(t.Sequence!==e.sequence)throw c(new Error('Field "sequence" did not match between protobuf and CBOR'),je);if(t.TTL!==e.ttl)throw c(new Error('Field "ttl" did not match between protobuf and CBOR'),je)},wt=async(e,t)=>{const n=(e=>(0,Te.cv)(e.slice(Qe.length)))(e),r=nt(t),s=await(async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw Xe.error(e),c(e,ze)}let n;if(null!=t.pubKey){try{n=(0,Be.unmarshalPublicKey)(t.pubKey)}catch(e){throw Xe.error(e),e}if(!(await(0,Te.y5)(t.pubKey)).equals(e))throw c(new Error("Embedded public key did not match PeerID"),"ERR_INVALID_EMBEDDED_KEY")}else null!=e.publicKey&&(n=(0,Be.unmarshalPublicKey)(e.publicKey));if(null!=n)return n;throw c(new Error("no public key is available"),ze)})(n,r);await(async(e,t)=>{const{value:n,validityType:r,validity:s}=t;let i,o,a;if(null==t.signatureV2||null==t.data)throw c(new Error("missing data or signatureV2"),je);o=t.signatureV2,i=tt(t.data),bt(t);try{a=await e.verify(i,o)}catch(e){a=!1}if(!a)throw mt.error("record signature verification failed"),c(new Error("record signature verification failed"),je);if(null!=s&&r===Ge.ValidityType.EOL){let e;try{e=et((0,K.B)(s))}catch(e){throw mt.error("unrecognized validity format (not an rfc3339 format)"),c(new Error("unrecognized validity format (not an rfc3339 format)"),"ERR_UNRECOGNIZED_FORMAT")}if(e.getTime()<Date.now())throw mt.error("record has expired"),c(new Error("record has expired"),"ERR_IPNS_EXPIRED_RECORD")}else if(null!=r)throw mt.error("unrecognized validity type"),c(new Error("unrecognized validity type"),Me);mt("ipns entry for %b is valid",n)})(s,r)},vt=(0,a.kg)("ipfs:ipns:resolver"),Et=De.notFoundError().code;class _t{constructor(e){this._routing=e}async resolve(e,t={}){if("string"!=typeof e)throw c(new Error("invalid name"),"ERR_INVALID_NAME");const n=t.recursive&&"true"===t.recursive.toString(),r=e.split("/");if(3!==r.length||""!==r[0])throw c(new Error("invalid name"),"ERR_INVALID_NAME");const s=r[2];let i=1/0;n&&(i=32);const o=await this.resolver(s,i,t);return vt(`${e} was locally resolved correctly`),o}async resolver(e,t,n){if(0===t){const e="could not resolve name (recursion limit of 32 exceeded)";throw vt.error(e),c(new Error(e),"ERR_RESOLVE_RECURSION_LIMIT")}const r=await this._resolveName(e,n),s=r.split("/");return"ipfs"!==s[1]&&t?this.resolver(s[2],t-1,n):r}async _resolveName(e,t){const n=(0,Te.jE)(e),r=rt(n);let s;try{s=await this._routing.get(r,t)}catch(t){if(vt.error("could not get record from routing",t),t.code===Et)throw c(new Error(`record requested for ${e} was not found in the network`),"ERR_NO_RECORD_FOUND");throw c(new Error(`unexpected error getting the ipns record ${n.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(n,s)}async _validateRecord(e,t){await wt((0,Ze.z)([(0,B.m)("/ipns/"),e.toBytes()]),t);const n=nt(t);return(0,K.B)(n.value)}}class kt{constructor(e){this.lru=me(e)}get(e){const t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){return!!this.get(e)}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}const St=(0,a.kg)("ipfs:ipns");class Tt{constructor(e,t,n,r,s){this.publisher=new dt(e,t),this.republisher=new gt(this.publisher,t,n,r,s),this.resolver=new _t(e),this.cache=new kt(1e3),this.routing=e}async publish(e,t,n=dt.defaultRecordLifetime,r){try{await this.publisher.publishWithEOL(e,t,n,r),St(`IPNS value ${(0,K.B)(t,"base32")} was published correctly`);const s=e.toString(),i=parseFloat(n),o=i<6e4?i:6e4;return this.cache.set(s,t,o),St(`IPNS value ${(0,K.B)(t,"base32")} was cached correctly`),{name:s,value:t}}catch(e){throw St.error(e),e}}async resolve(e,t={}){if("string"!=typeof e)throw c(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!t.nocache&&!t.recursive){const t=e.split("/")[2],n=this.cache.get(t);if(n)return n}try{const n=await this.resolver.resolve(e,t);return St(`IPNS record from ${e} was resolved correctly`),n}catch(e){throw St.error(e),e}}async initializeKeyspace(e,t,n){return this.publish(e,t,dt.defaultRecordLifetime,n)}}var At=n(96863),It=n(37430),xt=n(93361);const Ot=(0,a.kg)("datastore:core:tiered");class Pt extends At.e{constructor(e){super(),this.stores=e.slice()}async open(){try{await Promise.all(this.stores.map((e=>e.open())))}catch(e){throw De.dbOpenFailedError(e)}}async put(e,t,n){try{await Promise.all(this.stores.map((r=>r.put(e,t,n))))}catch(e){throw De.dbWriteFailedError(e)}}async get(e,t){for(const n of this.stores)try{const r=await n.get(e,t);if(r)return r}catch(e){Ot.error(e)}throw De.notFoundError()}async has(e,t){for(const n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map((n=>n.delete(e,t))))}catch(e){throw De.dbDeleteFailedError(e)}}async*putMany(e,t={}){let n;const r=this.stores.map((e=>{const r=(0,It.d)({objectMode:!0});return(0,xt.Z)(e.putMany(r,t)).catch((e=>{n=e})),r}));try{for await(const t of e){if(n)throw n;r.forEach((e=>e.push(t))),yield t}}finally{r.forEach((e=>e.end()))}}async*deleteMany(e,t={}){let n;const r=this.stores.map((e=>{const r=(0,It.d)({objectMode:!0});return(0,xt.Z)(e.deleteMany(r,t)).catch((e=>{n=e})),r}));try{for await(const t of e){if(n)throw n;r.forEach((e=>e.push(t))),yield t}}finally{r.forEach((e=>e.end()))}}async close(){await Promise.all(this.stores.map((e=>e.close())))}batch(){const e=this.stores.map((e=>e.batch()));return{put:(t,n)=>{e.forEach((e=>e.put(t,n)))},delete:t=>{e.forEach((e=>e.delete(t)))},commit:async t=>{for(const n of e)await n.commit(t)}}}query(e,t){return this.stores[this.stores.length-1].query(e,t)}queryKeys(e,t){return this.stores[this.stores.length-1].queryKeys(e,t)}}var Rt=n(26905);const Nt=(e,t)=>{const n=t.map(((e,t)=>({entry:Ge.decode(e),index:t})));return n.sort(((e,t)=>{if(null!=e.entry.signatureV2&&null==t.entry.signatureV2)return-1;if(null==e.entry.signatureV2&&null!=t.entry.signatureV2)return 1;const n=e.entry.sequence??0n,r=t.entry.sequence??0n;if(n>r)return-1;if(n<r)return 1;const s=e.entry.validity??new Uint8Array(0),i=t.entry.validity??new Uint8Array(0),o=et((0,K.B)(s)),a=et((0,K.B)(i));return o.getTime()>a.getTime()?-1:o.getTime()<a.getTime()?1:0})),n[0].index},Dt="SHARDING";n(85404);new ne.s(Dt),new ne.s("_README");var Ct=n(52770);const Lt="/record/";function Bt(e){return(0,K.B)(e,"base32")}function Mt(e){("string"==typeof e||e instanceof String)&&(e=(0,B.m)(e.toString()));const t=(0,K.B)(e,"base64url");return`${Lt}${t}`}const jt=(0,a.kg)("datastore-pubsub:publisher");class zt extends At.e{constructor(e,t,n,r,s,i){if(super(),!r)throw new Ct.s("missing validator","ERR_INVALID_PARAMETERS");if("function"!=typeof r)throw new Ct.s("missing validate function","ERR_INVALID_PARAMETERS");if("function"!=typeof s)throw new Ct.s("missing select function","ERR_INVALID_PARAMETERS");if(i&&"function"!=typeof i)throw new Ct.s("invalid subscriptionKeyFn received","ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=n,this._validator=r,this._selector=s,this._handleSubscriptionKeyFn=i,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,n){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw jt.error(e),new Ct.s(e,"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){const e="received value is not a Uint8Array";throw jt.error(e),new Ct.s(e,"ERR_INVALID_VALUE_RECEIVED")}const r=Mt(e);jt(`publish value for topic ${r}`),await this._pubsub.publish(r,t)}async get(e,t){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw jt.error(e),new Ct.s(e,"ERR_INVALID_DATASTORE_KEY")}const n=Mt(e),r=await this._pubsub.getTopics();if(r&&Array.isArray(r)&&r.indexOf(n)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(n)}catch(e){const t=`cannot subscribe topic ${n}`;throw jt.error(t),new Ct.s(t,"ERR_SUBSCRIBING_TOPIC")}return jt(`subscribed values for key ${n}`),this._getLocal(e)}unsubscribe(e){const t=Mt(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){const n=new ne.s("/"+Bt(e),!1);let r;try{r=await this._datastore.get(n,t)}catch(e){if("ERR_NOT_FOUND"!==e.code){const e=`unexpected error getting the ipns record for ${n.toString()}`;throw jt.error(e),new Ct.s(e,"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const t=`local record requested was not found for ${n.toString()}`;throw jt.error(t),new Ct.s(t,"ERR_NOT_FOUND")}if(!(r instanceof Uint8Array)){const e="found record that we couldn't convert to a value";throw jt.error(e),new Ct.s(e,"ERR_INVALID_RECORD_RECEIVED")}return r}async _onMessage(e){const t=e.detail;if("signed"!==t.type)return void jt.error("unsigned message received, this module can only work with signed messages");const{data:n,from:r,topic:s}=t;let i;try{i=function(e){if(e.substring(0,Lt.length)!==Lt)throw new Ct.s("topic received is not from a record","ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");const t=e.substring(Lt.length);return(0,B.m)(t,"base64url")}(s)}catch(e){return void jt.error(e)}if(jt(`message received for topic ${s}`),this._peerId.equals(r))jt("message discarded as it is from the same peer");else{if(this._handleSubscriptionKeyFn){let e;try{e=await this._handleSubscriptionKeyFn(i)}catch(e){return void jt.error("message discarded by the subscriptionKeyFn")}i=e}try{await this._storeIfSubscriptionIsBetter(i,n)}catch(e){jt.error(e)}}}async _storeIfSubscriptionIsBetter(e,t,n){let r=!1;try{r=await this._isBetter(e,t)}catch(e){if("ERR_NOT_VALID_RECORD"!==e.code)throw e}r&&await this._storeRecord(e,t,n)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){return 0===await this._selector(e,t)}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch(e){const t="record received through pubsub is not valid";throw jt.error(t),new Ct.s(t,"ERR_NOT_VALID_RECORD")}const n=new ne.s(e);let r;try{r=await this._getLocal(n.uint8Array())}catch(e){return!0}return!(0,Ce.f)(r,t)&&this._selectRecord(e,[r,t])}async _storeRecord(e,t,n){const r=new ne.s("/"+Bt(e),!1);await this._datastore.put(r,t,n),jt(`record for ${Mt(e)} was stored in the datastore`)}}const Ut=(0,a.kg)("ipfs:ipns:pubsub");class Ft{constructor(e,t,n){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new zt(e,t,n,wt,Nt,this._handleSubscriptionKey)}async put(e,t,n){try{await this._pubsubDs.put(e,t,n)}catch(e){throw Ut.error(e),e}}async get(e,t){let n,r;try{n=await this._pubsubDs.get(e,t)}catch(e){r=e}const s=e.slice(0,at);if((0,K.B)(s)===ot){const t=j.base58btc.encode(e).substring(1),n=j.base58btc.encode(e.slice(at)).substring(1);this._subscriptions[t]=n,Ut(`subscribed to pubsub topic ${t}, id ${n}`)}if(r)throw r;return n}_handleSubscriptionKey(e){e instanceof Uint8Array&&(e=(0,K.B)(e,"base58btc"));const t=this._subscriptions[e];if(!t)throw c(new Error(`key ${e} does not correspond to a subscription`),"ERR_INVALID_KEY");try{return rt((0,Te.jE)(t))}catch(e){throw Ut.error(e),e}}getSubscriptions(){return Object.values(this._subscriptions).filter(Boolean).map((e=>`${ot}${e}`))}async cancel(e){if("string"!=typeof e)throw c(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");e.startsWith(ot)&&(e=e.substring(at));const t=Object.keys(this._subscriptions).find((t=>this._subscriptions[t]===e));if(!t)return{canceled:!1};const n=(0,B.m)(t);return this._pubsubDs.unsubscribe(n),delete this._subscriptions[t],Ut(`unsubscribed pubsub ${t}: ${e}`),{canceled:!0}}}var $t=n(21177);const Ht=(0,a.kg)("ipfs:ipns:offline-datastore");class Vt{constructor(e){this._datastore=e,this.stores=[]}async put(e,t,n){if(!(e instanceof Uint8Array))throw c(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(t instanceof Uint8Array))throw c(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let r;try{r=this._routingKey(e)}catch(e){throw Ht.error(e),c(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const s=new $t.Y(e,t,new Date);await this._datastore.put(r,s.serialize(),n)}async get(e,t){if(!(e instanceof Uint8Array))throw c(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let n;try{n=this._routingKey(e)}catch(e){throw Ht.error(e),c(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const r=await this._datastore.get(n,t);let s;try{s=$t.Y.deserialize(r)}catch(e){throw Ht.error(e),e}return s.value}_routingKey(e){return new ne.s("/dht/record/"+(0,K.B)(e,"base32"),!1)}}const Kt=(0,a.kg)("ipfs:ipns:dht-datastore");class qt{constructor(e){this._dht=e}async put(e,t,n){try{await(0,xt.Z)(this._dht.put(e,t,n))}catch(e){throw Kt.error(e),e}}async get(e,t){for await(const n of this._dht.get(e,t))if("VALUE"===n.name)return n.value;throw(0,De.notFoundError)()}}const Wt=(0,a.kg)("ipfs:components:ipns");class Gt{constructor(e={pass:""}){this.options=e,this.offline=null,this.online=null}getIPNS(){const e=this.online||this.offline;if(e)return e;throw new O}get routing(){return this.getIPNS().routing}startOffline({repo:e,peerId:t,keychain:n}){if(null!=this.offline)throw new R;Wt("initializing IPNS keyspace (offline)");const r=new Vt(e.datastore),s=new Tt(r,e.datastore,t,n,this.options);this.offline=s}async startOnline({libp2p:e,repo:t,peerId:n,keychain:r}){if(null!=this.online)throw new R;const s=function({libp2p:e,repo:t,peerId:n,options:r}){const s=[];let i;if(Rt(r,"EXPERIMENTAL.ipnsPubsub",!1)&&(i=new Ft(e.pubsub,t.datastore,n),s.push(i)),!0!==Rt(r,"offline",!1)&&["dht","dhtclient","dhtserver"].includes(Rt(r,"config.Routing.Type","none"))&&s.push(new qt(e.dht)),Rt(r,"offline",!1)||0===s.length){const e=new Vt(t.datastore);s.push(e)}return new Pt(s)}({libp2p:e,repo:t,peerId:n,options:this.options}),i=new Tt(s,t.datastore,n,r,this.options);await i.republisher.start(),this.online=i}async stop(){const e=this.online;e&&(await e.republisher.stop(),this.online=null)}publish(e,t,n,r){return this.getIPNS().publish(e,t,n,r)}resolve(e,t){return this.getIPNS().resolve(e,t)}initializeKeyspace(e,t,n){return this.getIPNS().initializeKeyspace(e,t,n)}}async function Jt({ipns:e,repo:t,codecs:n},r,s){if(te(r))return e.resolve(r);const{cid:i,path:o}=ce(r);await(0,xt.Z)(ye(i,o||"",n,t,s))}const Zt=(0,a.kg)("ipfs:name:publish");function Yt({ipns:e,repo:t,codecs:n,peerId:r,isOnline:s,keychain:i}){const o=async e=>{let t;if("self"===e&&null!=r.privateKey)t=await(0,Be.unmarshalPrivateKey)(r.privateKey);else try{const n=await i.exportKey(e,"temp");t=await(0,Be.importKey)(n,"temp")}catch(e){throw Zt.error(e),c(e,"ERR_CANNOT_GET_KEY")}return(0,Te.y5)(t.public.bytes,t.bytes)};return oe((async function(r,i={}){const a=!(!1===i.resolve),u=i.lifetime||"24h",l=i.key||"self";if(!s())throw c(new Error(ue),"OFFLINE_ERROR");try{r=(e=>{if(H.k0.asCID(e))return`/ipfs/${e}`;const t=e.toString();try{return`/ipfs/${H.k0.parse(t)}`}catch{}if(ee(t))return t;throw c(new Error(`invalid path: ${e}`),"ERR_BAD_PATH")})(r)}catch(e){throw Zt.error(e),e}let h=0;try{h=(0,se.Z)(u)||0,h=parseFloat(h.toFixed(6))}catch(e){throw Zt.error(e),e}const f=await Promise.all([o(l),a?Jt({ipns:e,repo:t,codecs:n},r):Promise.resolve()]),p=(0,B.m)(r),d=await e.publish(f[0],p,h,i);return{name:d.name,value:(0,K.B)(d.value)}}))}var Xt=n(68673),Qt=n(82734);const en=i.Z.bind({ignoreUndefined:!0}),tn=(0,a.kg)("ipfs:name:resolve"),nn=(e,t)=>t.length>0?e+"/"+t.join("/"):e;function rn(e,t){if(!e||!t||!t.ipnsPubsub)throw c(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(e.routing instanceof Ft)return e.routing;const n=(e.routing.stores||[]).find((e=>e instanceof Ft));if(!n)throw c(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return n}class sn{constructor({ipns:e,options:t}){this.cancel=function({ipns:e,options:t}){const n=t.EXPERIMENTAL;return oe((async function(t,r={}){return rn(e,n).cancel(t,r)}))}({ipns:e,options:t}),this.state=function({ipns:e,options:t}){const n=t.EXPERIMENTAL;return oe((async function(t={}){try{return{enabled:Boolean(rn(e,n))}}catch(e){return{enabled:!1}}}))}({ipns:e,options:t}),this.subs=function({ipns:e,options:t}){const n=t.EXPERIMENTAL;return oe((async function(t={}){return rn(e,n).getSubscriptions(t)}))}({ipns:e,options:t})}}class on{constructor({dns:e,ipns:t,repo:n,codecs:r,peerId:s,isOnline:i,keychain:o,options:a}){this.publish=Yt({ipns:t,repo:n,codecs:r,peerId:s,isOnline:i,keychain:o}),this.resolve=function({dns:e,ipns:t,isOnline:n,options:{offline:r}}){return oe((async function*(s,i={}){if(i=en({nocache:!1,recursive:!0},i),r&&i&&i.nocache)throw c(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!n()&&!r)throw c(new Error(ue),"OFFLINE_ERROR");let o=s.toString();o.startsWith("/ipns/")||(o=`/ipns/${o}`);let[a,u,...l]=o.slice(1).split("/");try{if("1"===u.substring(0,1)){const e=(0,Te.jE)(u),t=U.Jx(e.toBytes());u=H.k0.createV1(114,t).toString(Xt.base36)}else{const e=H.k0.parse(u);1===e.version&&(u=e.toString(Xt.base36))}}catch(t){if(Qt(u))return void(yield nn(await e(u,i),l));throw tn.error(t),c(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}const h=await t.resolve(`/${a}/${u}`,i);yield nn(h instanceof Uint8Array?(0,K.B)(h):h,l)}))}({dns:e,ipns:t,isOnline:i,options:a}),this.pubsub=new sn({ipns:t,options:a})}}const an=(0,De.notFoundError)().code,cn={default:"<dst>",edges:"<src> -> <dst>"};function un({repo:e,codecs:t,resolve:n,preload:r}){return async function*(s,i={}){if(0===i.maxDepth)return;if(i.edges&&i.format&&i.format!==cn.default)throw new Error("Cannot set edges to true and also specify format");if(i.format=i.edges?cn.edges:i.format,"number"!=typeof i.maxDepth&&(i.maxDepth=i.recursive?1/0:1),i.timeout){const e=[new M.TimeoutController(i.timeout).signal];i.signal&&e.push(i.signal),i.signal=(0,re.anySignal)(e)}const o=(Array.isArray(s)?s:[s]).map((e=>function(e,t,n){const{cid:r,path:s}=ce(t);!1!==n.preload&&e(r);return`/ipfs/${r}${s||""}`}(r,e,i)));for(const r of o)try{yield*ln(n,e,t,r,i)}catch(e){yield{ref:"",err:e.message}}}}async function*ln(e,t,n,r,s){const i=await e(r,s),{cid:o}=ce(i),a=null!=s.maxDepth?s.maxDepth:1/0,c=s.unique||!1;for await(const e of async function*(e,t,n,r,s,i){const o=new Set;async function*a(n,c){const u=c+1;if(!(u>r))try{for await(const r of async function*(e,t,n,r){const s=await e.blocks.get(n,r),i=await t.getCodec(n.code),o=i.decode(s),a=n.code===k.code,c=[];for(const[e,t]of fn(o,c)){if(a){const n=e.match(/^Links\/(\d+)\/Hash$/);if(n){const e=Number(n[1]);if(e<o.Links.length){yield{name:o.Links[e].Name,cid:t};continue}}}yield{name:e,cid:t}}}(e,t,n.cid,i))yield{parent:n,node:r,isDuplicate:s&&o.has(r.cid.toString())},s&&o.add(r.cid.toString()),yield*a(r,u)}catch(e){throw e.code===an&&(e.message=`Could not find object with CID: ${n.cid}`),e}}yield*a({cid:n},0)}(t,n,o,a,c,s))e.parent&&(e.isDuplicate||(yield{ref:hn(e.parent.cid,e.node.cid,e.node.name,s.format)}))}function hn(e,t,n="",r=cn.default){let s=r.replace(/<src>/g,e.toString());return s=s.replace(/<dst>/g,t.toString()),s=s.replace(/<linkname>/g,n),s}const fn=function*(e,t){if(null!=e&&!(e instanceof Uint8Array)){for(const[n,r]of Object.entries(e)){const e=[...t,n];if(null!=r&&"object"==typeof r)if(Array.isArray(r))for(const[t,n]of r.entries()){const r=[...e,t],s=H.k0.asCID(n);s?yield[r.join("/"),s]:"object"==typeof n&&(yield*fn(n,r))}else{const t=H.k0.asCID(r);t?yield[e.join("/"),t]:yield*fn(r,e)}}return[]}};function pn({repo:e}){return oe((async function*(t={}){for await(const n of e.blocks.queryKeys({},{signal:t.signal}))yield{ref:n.toString()}}))}function dn({network:e}){return oe((async function(t={}){const n=(await e.use(t)).bitswap,r=n.stat().snapshot;return{provideBufLen:parseInt(r.providesBufferLength.toString()),blocksReceived:BigInt(r.blocksReceived.toString()),wantlist:Array.from(n.getWantlist()).map((e=>e[1].cid)),peers:n.peers(),dupBlksReceived:BigInt(r.dupBlksReceived.toString()),dupDataReceived:BigInt(r.dupDataReceived.toString()),dataReceived:BigInt(r.dataReceived.toString()),blocksSent:BigInt(r.blocksSent.toString()),dataSent:BigInt(r.dataSent.toString())}}))}class yn{constructor({network:e}){this.wantlist=function({network:e}){return oe((async function(t={}){const{bitswap:n}=await e.use(t),r=n.getWantlist();return Array.from(r).map((e=>e[1].cid))}))}({network:e}),this.wantlistForPeer=function({network:e}){return oe((async function(t,n={}){const{bitswap:r}=await e.use(n),s=r.wantlistForPeer(t);return Array.from(s).map((e=>e[1].cid))}))}({network:e}),this.unwant=function({network:e}){return oe((async function(t,n={}){const{bitswap:r}=await e.use(n);return Array.isArray(t)||(t=[t]),r.unwant(t)}))}({network:e}),this.stat=dn({network:e})}}function gn(e){try{return $.Cz.matches(e)}catch(e){return!1}}var mn=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}});class bn{constructor({repo:e}){this.add=function({repo:e}){return oe((async function(t,n={}){if(!gn(t))throw new Error(`${t} is not a valid Multiaddr`);const r=await e.config.getAll(n),s=r.Bootstrap||[];return s.push(t.toString()),r.Bootstrap=Array.from(new Set(s)).sort(((e,t)=>e.localeCompare(t))),await e.config.replace(r),{Peers:[t]}}))}({repo:e}),this.list=function({repo:e}){return oe((async function(t={}){return{Peers:(await e.config.get("Bootstrap",t)||[]).map((e=>(0,F.HM)(e)))}}))}({repo:e}),this.rm=function({repo:e}){return oe((async function(t,n={}){if(!gn(t))throw new Error(`${t} is not a valid Multiaddr`);const r=await e.config.getAll(n);return r.Bootstrap=(r.Bootstrap||[]).filter((e=>e.toString()!==t.toString())),await e.config.replace(r),{Peers:[t]}}))}({repo:e}),this.clear=function({repo:e}){return oe((async function(t={}){const n=await e.config.getAll(t),r=n.Bootstrap||[];return n.Bootstrap=[],await e.config.replace(n),{Peers:r.map((e=>(0,F.HM)(e)))}}))}({repo:e}),this.reset=function({repo:e}){return oe((async function(t={}){const n=await e.config.getAll(t);return n.Bootstrap=mn().Bootstrap,await e.config.replace(n),{Peers:mn().Bootstrap.map((e=>(0,F.HM)(e)))}}))}({repo:e})}}var wn=n(69849),vn=n(21007),En=n(44752),_n=n(88211);function kn(e){return e instanceof Uint8Array?H.k0.decode(e):H.k0.parse(e.toString())}class Sn{constructor({codecs:e,hashers:t,preload:n,repo:r}){this.get=function({preload:e,repo:t}){return oe((async function(n,r={}){return!1!==r.preload&&e(n),t.blocks.get(n,r)}))}({preload:n,repo:r}),this.put=function({codecs:e,hashers:t,repo:n,preload:r}){return oe((async function(s,i={}){const o=i.pin?await n.gcLock.readLock():null;try{const o=null!=i.version?i.version:0,a=i.format||(0===o?"dag-pb":"raw"),c=await t.getHasher(i.mhtype||"sha2-256"),u=await c.digest(s),l=await e.getCodec(a),h=H.k0.create(o,l.code,u);return await n.blocks.put(h,s,{signal:i.signal}),!1!==i.preload&&r(h),!0===i.pin&&await n.pins.pinRecursively(h,{signal:i.signal}),h}finally{o&&o()}}))}({codecs:e,hashers:t,preload:n,repo:r}),this.rm=function({repo:e}){return oe((async function*(t,n={}){Array.isArray(t)||(t=[t]);const r=await e.gcLock.writeLock();try{yield*(0,_n.zG)(t,(t=>(0,vn.Z)(t,(t=>async()=>{const r={cid:t=kn(t)};try{if(!await e.blocks.has(t))throw c(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await e.blocks.delete(t)}catch(e){n.force||(e.message=`cannot remove ${t}: ${e.message}`,r.error=e)}return r}))),(e=>(0,wn.Z)(e,{concurrency:8})),(e=>(0,En.Z)(e,(()=>!n.quiet))))}finally{r()}}))}({repo:r}),this.stat=function({repo:e,preload:t}){return oe((async function(n,r={}){return n=kn(n),!1!==r.preload&&t(n),{cid:n,size:(await e.blocks.get(n)).length}}))}({preload:n,repo:r})}}var Tn=n(56740);async function*An(e,t=1){let n=[];t<1&&(t=1);for await(const r of e)for(n.push(r);n.length>=t;)yield n.slice(0,t),n=n.slice(t);for(;n.length>0;)yield n.slice(0,t),n=n.slice(t)}async function*In(e,t=1){for await(const n of An(e,t)){const e=n.map((async e=>await e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const n=await e[t];if(!n.ok)throw n.err;yield n.value}}}var xn=n(27353),On=n(12619);const Pn={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:xn.sha256,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:async function(e){return(await On.Pv.encode(e)).slice(0,8).reverse()},hamtHashCode:34,hamtBucketBits:8};var Rn=(e={})=>i.Z.bind({ignoreUndefined:!0})(Pn,e),Nn=n(55353);const Dn=Nn.Reader,Cn=Nn.Writer,Ln=Nn.util,Bn=Nn.roots["ipfs-unixfs"]||(Nn.roots["ipfs-unixfs"]={}),Mn=Bn.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Type=0,e.prototype.Data=Ln.newBuffer([]),e.prototype.filesize=Ln.Long?Ln.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=Ln.emptyArray,e.prototype.hashType=Ln.Long?Ln.Long.fromBits(0,0,!0):0,e.prototype.fanout=Ln.Long?Ln.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=Cn.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var n=0;n<e.blocksizes.length;++n)t.uint32(32).uint64(e.blocksizes[n]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&Bn.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof Dn||(e=Dn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Bn.Data;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Type=e.int32();break;case 2:r.Data=e.bytes();break;case 3:r.filesize=e.uint64();break;case 4:if(r.blocksizes&&r.blocksizes.length||(r.blocksizes=[]),2==(7&s))for(var i=e.uint32()+e.pos;e.pos<i;)r.blocksizes.push(e.uint64());else r.blocksizes.push(e.uint64());break;case 5:r.hashType=e.uint64();break;case 6:r.fanout=e.uint64();break;case 7:r.mode=e.uint32();break;case 8:r.mtime=Bn.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Type"))throw Ln.ProtocolError("missing required 'Type'",{instance:r});return r},e.fromObject=function(e){if(e instanceof Bn.Data)return e;var t=new Bn.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?Ln.base64.decode(e.Data,t.Data=Ln.newBuffer(Ln.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&(Ln.Long?(t.filesize=Ln.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new Ln.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var n=0;n<e.blocksizes.length;++n)Ln.Long?(t.blocksizes[n]=Ln.Long.fromValue(e.blocksizes[n])).unsigned=!0:"string"==typeof e.blocksizes[n]?t.blocksizes[n]=parseInt(e.blocksizes[n],10):"number"==typeof e.blocksizes[n]?t.blocksizes[n]=e.blocksizes[n]:"object"==typeof e.blocksizes[n]&&(t.blocksizes[n]=new Ln.LongBits(e.blocksizes[n].low>>>0,e.blocksizes[n].high>>>0).toNumber(!0))}if(null!=e.hashType&&(Ln.Long?(t.hashType=Ln.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new Ln.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&(Ln.Long?(t.fanout=Ln.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new Ln.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=Bn.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.blocksizes=[]),t.defaults){if(n.Type=t.enums===String?"Raw":0,t.bytes===String?n.Data="":(n.Data=[],t.bytes!==Array&&(n.Data=Ln.newBuffer(n.Data))),Ln.Long){var r=new Ln.Long(0,0,!0);n.filesize=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.filesize=t.longs===String?"0":0;if(Ln.Long){r=new Ln.Long(0,0,!0);n.hashType=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.hashType=t.longs===String?"0":0;if(Ln.Long){r=new Ln.Long(0,0,!0);n.fanout=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.fanout=t.longs===String?"0":0;n.mode=0,n.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(n.Type=t.enums===String?Bn.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(n.Data=t.bytes===String?Ln.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?n.filesize=t.longs===String?String(e.filesize):e.filesize:n.filesize=t.longs===String?Ln.Long.prototype.toString.call(e.filesize):t.longs===Number?new Ln.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){n.blocksizes=[];for(var s=0;s<e.blocksizes.length;++s)"number"==typeof e.blocksizes[s]?n.blocksizes[s]=t.longs===String?String(e.blocksizes[s]):e.blocksizes[s]:n.blocksizes[s]=t.longs===String?Ln.Long.prototype.toString.call(e.blocksizes[s]):t.longs===Number?new Ln.LongBits(e.blocksizes[s].low>>>0,e.blocksizes[s].high>>>0).toNumber(!0):e.blocksizes[s]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?n.hashType=t.longs===String?String(e.hashType):e.hashType:n.hashType=t.longs===String?Ln.Long.prototype.toString.call(e.hashType):t.longs===Number?new Ln.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?n.fanout=t.longs===String?String(e.fanout):e.fanout:n.fanout=t.longs===String?Ln.Long.prototype.toString.call(e.fanout):t.longs===Number?new Ln.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(n.mtime=Bn.UnixTime.toObject(e.mtime,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Nn.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),jn=(Bn.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Seconds=Ln.Long?Ln.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=Cn.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof Dn||(e=Dn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Bn.UnixTime;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Seconds"))throw Ln.ProtocolError("missing required 'Seconds'",{instance:r});return r},e.fromObject=function(e){if(e instanceof Bn.UnixTime)return e;var t=new Bn.UnixTime;return null!=e.Seconds&&(Ln.Long?(t.Seconds=Ln.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new Ln.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Ln.Long){var r=new Ln.Long(0,0,!1);n.Seconds=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.Seconds=t.longs===String?"0":0;n.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?n.Seconds=t.longs===String?String(e.Seconds):e.Seconds:n.Seconds=t.longs===String?Ln.Long.prototype.toString.call(e.Seconds):t.longs===Number?new Ln.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=e.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Nn.util.toJSONOptions)},e})(),Bn.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=Cn.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof Dn||(e=Dn.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Bn.Metadata;e.pos<n;){var s=e.uint32();if(s>>>3==1)r.MimeType=e.string();else e.skipType(7&s)}return r},e.fromObject=function(e){if(e instanceof Bn.Metadata)return e;var t=new Bn.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(n.MimeType=e.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Nn.util.toJSONOptions)},e})(),Mn),zn=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],Un=["directory","hamt-sharded-directory"],Fn=parseInt("0644",8),$n=parseInt("0755",8);function Hn(e){if(null!=e)return"number"==typeof e?4095&e:"0"===(e=e.toString()).substring(0,1)?4095&parseInt(e,8):4095&parseInt(e,10)}function Vn(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const n=e.getTime(),r=Math.floor(n/1e3);t={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw c(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}class Kn{static unmarshal(e){const t=jn.decode(e),n=jn.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),r=new Kn({type:zn[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return r._originalMode=n.mode||0,r}constructor(e={type:"file"}){const{type:t,data:n,blockSizes:r,hashType:s,fanout:i,mtime:o,mode:a}=e;if(t&&!zn.includes(t))throw c(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=s,this.fanout=i,this.blockSizes=r||[],this._originalMode=0,this.mode=Hn(a),o&&(this.mtime=Vn(o),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?$n:Fn;const t=Hn(e);void 0!==t&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&Un.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach((t=>{e+=t})),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=jn.DataType.Raw;break;case"directory":e=jn.DataType.Directory;break;case"file":e=jn.DataType.File;break;case"metadata":e=jn.DataType.Metadata;break;case"symlink":e=jn.DataType.Symlink;break;case"hamt-sharded-directory":e=jn.DataType.HAMTShard;break;default:throw c(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t,n,r=this.data;if(this.data&&this.data.length||(r=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(Hn(this.mode)||0),t!==Fn||this.isDirectory()||(t=void 0),t===$n&&this.isDirectory()&&(t=void 0)),null!=this.mtime){const e=Vn(this.mtime);e&&(n={Seconds:e.secs,FractionalNanoseconds:e.nsecs},0===n.FractionalNanoseconds&&delete n.FractionalNanoseconds)}const s={Type:e,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:n};return jn.encode(s).finish()}}var qn=async(e,t,n)=>{n.codec||(n.codec=k),n.hasher||(n.hasher=xn.sha256),void 0===n.cidVersion&&(n.cidVersion=1),n.codec===k&&n.hasher!==xn.sha256&&(n.cidVersion=1);const r=await n.hasher.digest(e),s=H.k0.create(n.cidVersion,n.codec.code,r);return n.onlyHash||await t.put(s,e,{signal:n.signal}),s};var Wn=async(e,t,n)=>{const r=new Kn({type:"directory",mtime:e.mtime,mode:e.mode}),s=(0,k.encode)((0,k.prepare)({Data:r.marshal()}));return{cid:await qn(s,t,n),path:e.path,unixfs:r,size:s.length}},Gn=n(53137);var Jn=async function(e,t){return t(await async function(e){const t=[];for await(const n of e)t.push(n);return t}(e))};async function Zn(e,t,n){const r=[];for await(const s of An(e,n.maxChildrenPerNode))r.push(await t(s));return r.length>1?Zn(r,t,n):r[0]}var Yn=function(e,t,n){return Zn(e,t,n)};var Xn=async function(e,t,n){const r=new er(n.layerRepeat);let s=0,i=1,o=r;for await(const a of An(e,n.maxChildrenPerNode))o.isFull()&&(o!==r&&r.addChild(await o.reduce(t)),s&&s%n.layerRepeat==0&&i++,o=new Qn(i,n.layerRepeat,s),s++),o.append(a);return o&&o!==r&&r.addChild(await o.reduce(t)),r.reduce(t)};class Qn{constructor(e,t,n=0){this.maxDepth=e,this.layerRepeat=t,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:e,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;const e=this._findParent(this.node,this.currentDepth);return!e||(this._addNextNodeToParent(e),!1)}_addNextNodeToParent(e){this.parent=e;const t={children:[],depth:e.depth+1,parent:e,maxDepth:this.maxDepth,maxChildren:Math.floor(e.children.length/this.layerRepeat)*this.layerRepeat};e.children.push(t),this.currentDepth=t.depth,this.node=t}append(e){this.node.data=e}reduce(e){return this._reduce(this.root,e)}async _reduce(e,t){let n=[];return e.children.length&&(n=await Promise.all(e.children.filter((e=>e.data)).map((e=>this._reduce(e,t))))),t((e.data||[]).concat(n))}_findParent(e,t){const n=e.parent;if(n&&0!==n.depth)return n.children.length!==n.maxChildren&&n.maxChildren?n:this._findParent(n,t)}}class er extends Qn{constructor(e){super(0,e),this.root.depth=0,this.currentDepth=1}addChild(e){this.root.children.push(e)}reduce(e){return e((this.root.data||[]).concat(this.root.children))}}var tr=async function*(e,t,n){for await(let r of e.content)yield async()=>{let s;n.progress(r.length,e.path);const i={codec:k,cidVersion:n.cidVersion,hasher:n.hasher,onlyHash:n.onlyHash};return n.rawLeaves?(i.codec=Gn,i.cidVersion=1):(s=new Kn({type:n.leafType,data:r}),r=k.encode({Data:s.marshal(),Links:[]})),{cid:await qn(r,t,i),unixfs:s,size:r.length}}};const nr={flat:Jn,balanced:Yn,trickle:Xn};var rr=function(e,t,n){const r=nr[n.strategy];if(!r)throw c(new Error(`Unknown importer build strategy name: ${n.strategy}`),"ERR_BAD_STRATEGY");return r(async function*(e,t,n){let r,s,i=-1;s="function"==typeof n.bufferImporter?n.bufferImporter:tr;for await(const o of In(s(e,t,n),n.blockWriteConcurrency))i++,0!==i?(1===i&&r&&(yield r,r=null),yield o):r=o;r&&(r.single=!0,yield r)}(e,t,n),((e,t,n)=>async function(r){if(1===r.length&&r[0].single&&n.reduceSingleLeafToSelf){const s=r[0];if(void 0!==e.mtime||void 0!==e.mode){let r=await t.get(s.cid);s.unixfs=new Kn({type:"file",mtime:e.mtime,mode:e.mode,data:r}),r=(0,k.encode)((0,k.prepare)({Data:s.unixfs.marshal()})),s.cid=await qn(r,t,{...n,codec:k,hasher:n.hasher,cidVersion:n.cidVersion}),s.size=r.length}return{cid:s.cid,path:e.path,unixfs:s.unixfs,size:s.size}}const s=new Kn({type:"file",mtime:e.mtime,mode:e.mode}),i=r.filter((e=>!(e.cid.code!==Gn.code||!e.size)||!(!e.unixfs||e.unixfs.data||!e.unixfs.fileSize())||Boolean(e.unixfs&&e.unixfs.data&&e.unixfs.data.length))).map((e=>e.cid.code===Gn.code?(s.addBlockSize(e.size),{Name:"",Tsize:e.size,Hash:e.cid}):(e.unixfs&&e.unixfs.data?s.addBlockSize(e.unixfs.data.length):s.addBlockSize(e.unixfs&&e.unixfs.fileSize()||0),{Name:"",Tsize:e.size,Hash:e.cid}))),o={Data:s.marshal(),Links:i},a=(0,k.encode)((0,k.prepare)(o));return{cid:await qn(a,t,n),path:e.path,unixfs:s,size:a.length+o.Links.reduce(((e,t)=>e+t.Tsize),0)}})(e,t,n),n)},sr=n(62308),ir=n(63060);var or=async function*(e,t){let n,r,s;if(t.minChunkSize&&t.maxChunkSize&&t.avgChunkSize)s=t.avgChunkSize,n=t.minChunkSize,r=t.maxChunkSize;else{if(!t.avgChunkSize)throw c(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");s=t.avgChunkSize,n=s/3,r=s+s/2}if(n<16)throw c(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");r<n&&(r=n),s<n&&(s=n);const i=Math.floor(Math.log2(s));for await(const s of async function*(e,t){const n=await(0,ir.create)(t.bits,t.min,t.max,t.window),r=new sr.H;for await(const t of e){r.append(t);const e=n.fingerprint(t);for(let t=0;t<e.length;t++){const n=e[t],s=r.slice(0,n);r.consume(n),yield s}}r.length&&(yield r.subarray(0))}(e,{min:n,max:r,bits:i,window:t.window,polynomial:t.polynomial}))yield s};var ar=async function*(e,t){let n=new sr.H,r=0,s=!1;const i=t.maxChunkSize;for await(const t of e)for(n.append(t),r+=t.length;r>=i;)if(yield n.slice(0,i),s=!0,i===n.length)n=new sr.H,r=0;else{const e=new sr.H;e.append(n.sublist(i)),n=e,r-=i}s&&!r||(yield n.subarray(0,r))};var cr=async function*(e){for await(const t of e){if(void 0===t.length)throw c(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"==typeof t||t instanceof String)yield(0,B.m)(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw c(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}};function ur(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(t=e,Symbol.iterator in t)return async function*(){yield*e}();if(function(e){return Symbol.asyncIterator in e}(e))return e}catch{throw c(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}var t;throw c(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}var lr=async function*(e,t,n){for await(const r of e)if(r.path&&("./"===r.path.substring(0,2)&&(n.wrapWithDirectory=!0),r.path=r.path.split("/").filter((e=>e&&"."!==e)).join("/")),r.content){let e,s;e="function"==typeof n.chunker?n.chunker:"rabin"===n.chunker?or:ar,s="function"==typeof n.chunkValidator?n.chunkValidator:cr;const i={path:r.path,mtime:r.mtime,mode:r.mode,content:e(s(ur(r.content),n),n)};yield()=>rr(i,t,n)}else{if(!r.path)throw new Error("Import candidate must have content or path or both");{const e={path:r.path,mtime:r.mtime,mode:r.mode};yield()=>Wn(e,t,n)}}};var hr=class{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}};var fr=class extends hr{constructor(e,t){super(e,t),this._children={}}async put(e,t){this.cid=void 0,this.size=void 0,this._children[e]=t}get(e){return Promise.resolve(this._children[e])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){const e=Object.keys(this._children);for(let t=0;t<e.length;t++){const n=e[t];yield{key:n,child:this._children[n]}}}async*flush(e){const t=Object.keys(this._children),n=[];for(let r=0;r<t.length;r++){let s=this._children[t[r]];if(s instanceof hr)for await(const t of s.flush(e))s=t,yield s;null!=s.size&&s.cid&&n.push({Name:t[r],Tsize:s.size,Hash:s.cid})}const r=new Kn({type:"directory",mtime:this.mtime,mode:this.mode}),s={Data:r.marshal(),Links:n},i=(0,k.encode)((0,k.prepare)(s)),o=await qn(i,e,this.options),a=i.length+s.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=o,this.size=a,yield{cid:o,unixfs:r,path:this.path,size:a}}},pr=n(20544);class dr{constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new pr,this.key=null}async put(e,t){const n=await this._findNewBucketAndPos(e);await n.bucket._putAt(n,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);null!=n&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((e,t)=>t instanceof dr?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof dr?yield*t.eachLeafSeries():yield t}serialize(e,t){return t(this._children.reduce(((n,r,s)=>(null!=r&&(r instanceof dr?n.push(r.serialize(e,t)):n.push(e(r,s))),n)),[]))}async asyncTransform(e,t){return await br(this,e,t)}toJSON(){return this.serialize(gr,mr)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof dr))return null!=n&&n.key===e?n:void 0}async _findPlace(e){const t=this._options.hash("string"==typeof e?(0,B.m)(e):e),n=await t.take(this._options.bits),r=this._children.get(n);return r instanceof dr?await r._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:r}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){const e=new dr(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const n=await e._findPlace(t.existingChild.hash);return n.bucket._putAt(n,t.existingChild.key,t.existingChild.value),await e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(yr);if(null!=e&&!(e instanceof dr)){const t=e.hash;t.untake(this._options.bits);const n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function yr(e){return Boolean(e)}function gr(e,t){return e.key}function mr(e){return e}async function br(e,t,n){const r=[];for(const s of e._children.compactArray())if(s instanceof dr)await br(s,t,n);else{const n=await t(s);r.push({bitField:e._children.bitField(),children:n})}return await n(r)}const wr=[255,254,252,248,240,224,192,128],vr=[1,3,7,15,31,63,127,255];class Er{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],r=this._currentBitPos+1,s=Math.min(r,t);n=(n<<s)+_r(e,r-s,s),t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function _r(e,t,n){const r=function(e,t){return wr[e]&vr[Math.min(t+e-1,7)]}(t,n);return(e&r)>>>t}function kr(e){return function(t){return t instanceof Sr?t:new Sr(t,e)}}class Sr{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.availableBits(),t);n=(n<<r)+e.take(r),t-=r,this._availableBits-=r,0===e.availableBits()&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.totalBits()-e.availableBits(),t);e.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?(0,Ze.z)([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new Er(t);this._buffers.push(n),this._availableBits+=n.availableBits()}}function Tr(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const t={bits:e.bits??8,hash:kr(e.hashFn)};return new dr(t)}var Ar=class extends hr{constructor(e,t){super(e,t),this._bucket=Tr({hashFn:t.hamtHashFn,bits:t.hamtBucketBits})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){for await(const t of Ir(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*Ir(e,t,n,r){const s=e._children,i=[];let o=0;for(let e=0;e<s.length;e++){const n=s.get(e);if(!n)continue;const a=e.toString(16).toUpperCase().padStart(2,"0");if(n instanceof dr){let e;for await(const s of await Ir(n,t,null,r))e=s;if(!e)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:a,Tsize:e.size,Hash:e.cid}),o+=e.size}else if("function"==typeof n.value.flush){const e=n.value;let r;for await(const n of e.flush(t))r=n,yield r;const s=a+n.key;i.push({Name:s,Tsize:r.size,Hash:r.cid}),o+=r.size}else{const e=n.value;if(!e.cid)continue;const t=a+n.key,r=e.size;i.push({Name:t,Tsize:r,Hash:e.cid}),o+=r}}const a=Uint8Array.from(s.bitField().reverse()),c=new Kn({type:"hamt-sharded-directory",data:a,fanout:e.tableSize(),hashType:r.hamtHashCode,mtime:n&&n.mtime,mode:n&&n.mode}),u={Data:c.marshal(),Links:i},l=(0,k.encode)((0,k.prepare)(u)),h=await qn(l,t,r),f=l.length+o;yield{cid:h,unixfs:c,size:f}}var xr=async function e(t,n,r,s){let i=n;n instanceof fr&&n.directChildrenCount()>=r&&(i=await async function(e,t){const n=new Ar({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(const{key:t,child:r}of e.eachChildSeries())await n.put(t,r);return n}(n,s));const o=i.parent;if(o){if(i!==n){if(t&&(t.parent=i),!i.parentKey)throw new Error("No parent key found");await o.put(i.parentKey,i)}return e(i,o,r,s)}return i};var Or=(e="")=>(e.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean);async function Pr(e,t,n){const r=Or(e.path||""),s=r.length-1;let i=t,o="";for(let a=0;a<r.length;a++){const c=r[a];o+=`${o?"/":""}${c}`;const u=a===s;if(i.dirty=!0,i.cid=void 0,i.size=void 0,u)await i.put(c,e),t=await xr(null,i,n.shardSplitThreshold,n);else{let e=await i.get(c);e&&e instanceof hr||(e=new fr({root:!1,dir:!0,parent:i,parentKey:c,path:o,dirty:!0,flat:!0,mtime:e&&e.unixfs&&e.unixfs.mtime,mode:e&&e.unixfs&&e.unixfs.mode},n)),await i.put(c,e),i=e}}return t}async function*Rr(e,t){e instanceof hr?yield*e.flush(t):e&&e.unixfs&&e.unixfs.isDirectory()&&(yield e)}var Nr=async function*(e,t,n){let r=new fr({root:!0,dir:!0,path:"",dirty:!0,flat:!0},n);for await(const t of e)t&&(r=await Pr(t,r,n),t.unixfs&&t.unixfs.isDirectory()||(yield t));if(n.wrapWithDirectory)yield*Rr(r,t);else for await(const e of r.eachChildSeries())e&&(yield*Rr(e.child,t))};async function*Dr(e,t,n={}){const r=Rn(n);let s,i,o;s="function"==typeof n.dagBuilder?n.dagBuilder:lr,i="function"==typeof n.treeBuilder?n.treeBuilder:Nr,o=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];for await(const e of i(In(s(o,t,r),r.fileImportConcurrency),t,r))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}var Cr=n(32075),Lr=n(89755);const Br=e=>{if(e){if(e.startsWith("size-")){const t=e.split("-")[1],n=parseInt(t);if(isNaN(n))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:n}}if(e.startsWith("rabin"))return{chunker:"rabin",...Mr(e)};throw new Error(`Unrecognized chunker option: ${e}`)}return{chunker:"fixed"}},Mr=e=>{const t={},n=e.split("-");switch(n.length){case 1:t.avgChunkSize=262144;break;case 2:t.avgChunkSize=jr(n[1],"avg");break;case 4:t.minChunkSize=jr(n[1],"min"),t.avgChunkSize=jr(n[2],"avg"),t.maxChunkSize=jr(n[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return t},jr=(e,t)=>{const n=parseInt(e);if(isNaN(n))throw new Error(`Chunker parameter ${t} must be an integer`);return n},zr=i.Z.bind({ignoreUndefined:!0});function Ur({repo:e,preload:t,hashers:n,options:r}){const s=r&&r.sharding;return oe((async function*(r,i={}){const o=zr({shardSplitThreshold:s?1e3:1/0,strategy:"balanced"},i,{...Br(i.chunker)});o.hashAlg&&"sha2-256"!==o.hashAlg&&1!==o.cidVersion&&(o.cidVersion=1),o.trickle&&(o.strategy="trickle"),"trickle"===o.strategy&&(o.leafType="raw",o.reduceSingleLeafToSelf=!1),o.cidVersion>0&&void 0===o.rawLeaves&&(o.rawLeaves=!0),void 0!==o.hashAlg&&void 0===o.rawLeaves&&(o.rawLeaves=!0),delete o.trickle;const a={};if(o.progress){const e=o.progress;o.progress=(t,n)=>{a[n]||(a[n]=0),a[n]+=t,e(a[n],n)}}let c;null!=o.hashAlg&&(c=await n.getHasher(o.hashAlg));const u=(0,_n.zG)((l=r,(0,Lr.n)(l,Cr.u)),(t=>Dr(t,e.blocks,{...o,hasher:c,pin:!1})),function(e){async function*t(t){for await(const n of t){let t=n.cid;1===e.cidVersion&&(t=t.toV1());let r=n.path?n.path:t.toString();e.wrapWithDirectory&&!n.path&&(r=""),yield{path:r,cid:t,size:n.size,mode:n.unixfs&&n.unixfs.mode,mtime:n.unixfs&&n.unixfs.mtime}}}return t}(o),function(e,t){async function*n(n){for await(const r of n){(!r.path||t.wrapWithDirectory?""===r.path:!r.path.includes("/"))&&!t.onlyHash&&!1!==t.preload&&e(r.cid),yield r}}return n}(t,o),function(e,t){async function*n(n){for await(const r of n){const n=!(r.path&&r.path.includes("/"));(null==t.pin||t.pin)&&n&&!t.onlyHash&&await e.pins.pinRecursively(r.cid),yield r}}return n}(e,o));var l;const h=await e.gcLock.readLock();try{for await(const e of u){const t=e.path??e.cid.toString();delete a[t],yield{...e,path:t}}}finally{h()}}))}var Fr=n(68653);const $r=Fr.Reader,Hr=Fr.Writer,Vr=Fr.util,Kr=Fr.roots["ipfs-unixfs"]||(Fr.roots["ipfs-unixfs"]={}),qr=Kr.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Type=0,e.prototype.Data=Vr.newBuffer([]),e.prototype.filesize=Vr.Long?Vr.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=Vr.emptyArray,e.prototype.hashType=Vr.Long?Vr.Long.fromBits(0,0,!0):0,e.prototype.fanout=Vr.Long?Vr.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=Hr.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var n=0;n<e.blocksizes.length;++n)t.uint32(32).uint64(e.blocksizes[n]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&Kr.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof $r||(e=$r.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Kr.Data;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Type=e.int32();break;case 2:r.Data=e.bytes();break;case 3:r.filesize=e.uint64();break;case 4:if(r.blocksizes&&r.blocksizes.length||(r.blocksizes=[]),2==(7&s))for(var i=e.uint32()+e.pos;e.pos<i;)r.blocksizes.push(e.uint64());else r.blocksizes.push(e.uint64());break;case 5:r.hashType=e.uint64();break;case 6:r.fanout=e.uint64();break;case 7:r.mode=e.uint32();break;case 8:r.mtime=Kr.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Type"))throw Vr.ProtocolError("missing required 'Type'",{instance:r});return r},e.fromObject=function(e){if(e instanceof Kr.Data)return e;var t=new Kr.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5}if(null!=e.Data&&("string"==typeof e.Data?Vr.base64.decode(e.Data,t.Data=Vr.newBuffer(Vr.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&(Vr.Long?(t.filesize=Vr.Long.fromValue(e.filesize)).unsigned=!0:"string"==typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"==typeof e.filesize?t.filesize=e.filesize:"object"==typeof e.filesize&&(t.filesize=new Vr.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var n=0;n<e.blocksizes.length;++n)Vr.Long?(t.blocksizes[n]=Vr.Long.fromValue(e.blocksizes[n])).unsigned=!0:"string"==typeof e.blocksizes[n]?t.blocksizes[n]=parseInt(e.blocksizes[n],10):"number"==typeof e.blocksizes[n]?t.blocksizes[n]=e.blocksizes[n]:"object"==typeof e.blocksizes[n]&&(t.blocksizes[n]=new Vr.LongBits(e.blocksizes[n].low>>>0,e.blocksizes[n].high>>>0).toNumber(!0))}if(null!=e.hashType&&(Vr.Long?(t.hashType=Vr.Long.fromValue(e.hashType)).unsigned=!0:"string"==typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"==typeof e.hashType?t.hashType=e.hashType:"object"==typeof e.hashType&&(t.hashType=new Vr.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&(Vr.Long?(t.fanout=Vr.Long.fromValue(e.fanout)).unsigned=!0:"string"==typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"==typeof e.fanout?t.fanout=e.fanout:"object"==typeof e.fanout&&(t.fanout=new Vr.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!=typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=Kr.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.blocksizes=[]),t.defaults){if(n.Type=t.enums===String?"Raw":0,t.bytes===String?n.Data="":(n.Data=[],t.bytes!==Array&&(n.Data=Vr.newBuffer(n.Data))),Vr.Long){var r=new Vr.Long(0,0,!0);n.filesize=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.filesize=t.longs===String?"0":0;if(Vr.Long){r=new Vr.Long(0,0,!0);n.hashType=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.hashType=t.longs===String?"0":0;if(Vr.Long){r=new Vr.Long(0,0,!0);n.fanout=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.fanout=t.longs===String?"0":0;n.mode=0,n.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(n.Type=t.enums===String?Kr.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(n.Data=t.bytes===String?Vr.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"==typeof e.filesize?n.filesize=t.longs===String?String(e.filesize):e.filesize:n.filesize=t.longs===String?Vr.Long.prototype.toString.call(e.filesize):t.longs===Number?new Vr.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){n.blocksizes=[];for(var s=0;s<e.blocksizes.length;++s)"number"==typeof e.blocksizes[s]?n.blocksizes[s]=t.longs===String?String(e.blocksizes[s]):e.blocksizes[s]:n.blocksizes[s]=t.longs===String?Vr.Long.prototype.toString.call(e.blocksizes[s]):t.longs===Number?new Vr.LongBits(e.blocksizes[s].low>>>0,e.blocksizes[s].high>>>0).toNumber(!0):e.blocksizes[s]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"==typeof e.hashType?n.hashType=t.longs===String?String(e.hashType):e.hashType:n.hashType=t.longs===String?Vr.Long.prototype.toString.call(e.hashType):t.longs===Number?new Vr.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"==typeof e.fanout?n.fanout=t.longs===String?String(e.fanout):e.fanout:n.fanout=t.longs===String?Vr.Long.prototype.toString.call(e.fanout):t.longs===Number?new Vr.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(n.mtime=Kr.UnixTime.toObject(e.mtime,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Fr.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),Wr=(Kr.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Seconds=Vr.Long?Vr.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=Hr.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof $r||(e=$r.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Kr.UnixTime;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&s)}}if(!r.hasOwnProperty("Seconds"))throw Vr.ProtocolError("missing required 'Seconds'",{instance:r});return r},e.fromObject=function(e){if(e instanceof Kr.UnixTime)return e;var t=new Kr.UnixTime;return null!=e.Seconds&&(Vr.Long?(t.Seconds=Vr.Long.fromValue(e.Seconds)).unsigned=!1:"string"==typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"==typeof e.Seconds?t.Seconds=e.Seconds:"object"==typeof e.Seconds&&(t.Seconds=new Vr.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Vr.Long){var r=new Vr.Long(0,0,!1);n.Seconds=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.Seconds=t.longs===String?"0":0;n.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"==typeof e.Seconds?n.Seconds=t.longs===String?String(e.Seconds):e.Seconds:n.Seconds=t.longs===String?Vr.Long.prototype.toString.call(e.Seconds):t.longs===Number?new Vr.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=e.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Fr.util.toJSONOptions)},e})(),Kr.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=Hr.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof $r||(e=$r.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Kr.Metadata;e.pos<n;){var s=e.uint32();if(s>>>3==1)r.MimeType=e.string();else e.skipType(7&s)}return r},e.fromObject=function(e){if(e instanceof Kr.Metadata)return e;var t=new Kr.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(n.MimeType=e.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Fr.util.toJSONOptions)},e})(),qr),Gr=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],Jr=["directory","hamt-sharded-directory"],Zr=parseInt("0644",8),Yr=parseInt("0755",8);function Xr(e){if(null!=e)return"number"==typeof e?4095&e:"0"===(e=e.toString()).substring(0,1)?4095&parseInt(e,8):4095&parseInt(e,10)}function Qr(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const n=e.getTime(),r=Math.floor(n/1e3);t={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw c(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}class es{static unmarshal(e){const t=Wr.decode(e),n=Wr.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),r=new es({type:Gr[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return r._originalMode=n.mode||0,r}constructor(e={type:"file"}){const{type:t,data:n,blockSizes:r,hashType:s,fanout:i,mtime:o,mode:a}=e;if(t&&!Gr.includes(t))throw c(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=s,this.fanout=i,this.blockSizes=r||[],this._originalMode=0,this.mode=Xr(a),o&&(this.mtime=Qr(o),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?Yr:Zr;const t=Xr(e);void 0!==t&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&Jr.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach((t=>{e+=t})),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=Wr.DataType.Raw;break;case"directory":e=Wr.DataType.Directory;break;case"file":e=Wr.DataType.File;break;case"metadata":e=Wr.DataType.Metadata;break;case"symlink":e=Wr.DataType.Symlink;break;case"hamt-sharded-directory":e=Wr.DataType.HAMTShard;break;default:throw c(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t,n,r=this.data;if(this.data&&this.data.length||(r=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(Xr(this.mode)||0),t!==Zr||this.isDirectory()||(t=void 0),t===Yr&&this.isDirectory()&&(t=void 0)),null!=this.mtime){const e=Qr(this.mtime);e&&(n={Seconds:e.secs,FractionalNanoseconds:e.nsecs},0===n.FractionalNanoseconds&&delete n.FractionalNanoseconds)}const s={Type:e,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:n};return Wr.encode(s).finish()}}const ts=async function(e){return(await On.Pv.encode(e)).slice(0,8).reverse()},ns=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),rs=async(e,t,n,r,s)=>{if(!r){const e=Tr({hashFn:ts});r={rootBucket:e,hamtDepth:1,lastBucket:e}}await((e,t,n)=>Promise.all(e.map((e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(2===e.Name.length){const r=parseInt(e.Name,16);return t._putObjectAt(r,new dr({hash:n._options.hash,bits:n._options.bits},t,r))}return n.put(e.Name.substring(2),!0)}))))(e.Links,r.lastBucket,r.rootBucket);const i=await r.rootBucket._findNewBucketAndPos(t);let o=ns(i.pos);const a=(e=>{let t=e.bucket;const n=[];for(;t._parent;)n.push(t),t=t._parent;return n.push(t),n.reverse()})(i);a.length>r.hamtDepth&&(r.lastBucket=a[r.hamtDepth],o=ns(r.lastBucket._posAtParent));const c=e.Links.find((e=>{if(null==e.Name)return!1;const n=e.Name.substring(0,2),r=e.Name.substring(2);return n===o&&(!r||r===t)}));if(!c)return null;if(null!=c.Name&&c.Name.substring(2)===t)return c.Hash;r.hamtDepth++;const u=await n.get(c.Hash,s);return e=(0,k.decode)(u),rs(e,t,n,r,s)};var ss=rs;var is=function(e,t,n,r){const s=t+e.length;return n>=s||r<t?new Uint8Array(0):(r>=t&&r<s&&(e=e.subarray(0,r-t)),n>=t&&n<s&&(e=e.subarray(n-t)),e)};var os=(e,t,n)=>{if(t||(t=0),t<0)throw c(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(t>e)throw c(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(n||0===n||(n=e-t),n<0)throw c(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return t+n>e&&(n=e-t),{offset:t,length:n}};async function as(e,t,n,r,s,i,o,a){if(t instanceof Uint8Array)return void n.push(is(t,r,s,i));if(null==t.Data)throw c(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let u;try{u=es.unmarshal(t.Data)}catch(e){throw c(e,"ERR_NOT_UNIXFS")}if(null!=u.data){const e=u.data,t=is(e,r,s,i);n.push(t),r+=t.byteLength}const l=[];for(let e=0;e<t.Links.length;e++){const n=t.Links[e],o=r,a=o+u.blockSizes[e];if((s>=o&&s<a||i>=o&&i<=a||s<o&&i>a)&&l.push({link:n,blockStart:r}),(r=a)>i)break}await(0,_n.zG)(l,(t=>(0,vn.Z)(t,(t=>async()=>{const n=await e.get(t.link.Hash,{signal:a.signal});return{...t,block:n}}))),(e=>(0,wn.Z)(e,{ordered:!0})),(async t=>{for await(const{link:r,block:u,blockStart:l}of t){let t;switch(r.Hash.code){case k.code:t=k.decode(u);break;case Gn.code:t=u;break;default:return void n.end(c(new Error(`Unsupported codec: ${r.Hash.code}`),"ERR_NOT_UNIXFS"))}o.add((async()=>{await as(e,t,n,l,s,i,o,a)}))}}))}var cs=(e,t,n,r,s,i,o)=>async function*(e={}){const r=n.fileSize();if(void 0===r)throw new Error("File was a directory");const{offset:s,length:i}=os(r,e.offset,e.length);if(0===i)return;const a=new be.Z({concurrency:1}),c=(0,It.d)();a.add((async()=>{await as(o,t,c,0,s,s+i,a,e)})),a.on("error",(e=>{c.end(e)}));let u=0;for await(const e of c)null!=e&&(u+=e.byteLength,u===i&&c.end(),yield e)};var us=(e,t,n,r,s,i,o)=>async function*(e={}){const n=e.offset||0,a=e.length||t.Links.length,c=t.Links.slice(n,a);for(const t of c){const n=await s(t.Hash,t.Name||"",`${r}/${t.Name||""}`,[],i+1,o,e);n.entry&&(yield n.entry)}};async function*ls(e,t,n,r,s,i){const o=e.Links;for(const a of o){const o=null!=a.Name?a.Name.substring(2):null;if(o){const e=await n(a.Hash,o,`${t}/${o}`,[],r+1,s,i);yield e.entry}else{const o=await s.get(a.Hash);e=(0,k.decode)(o);for await(const o of ls(e,t,n,r,s,i))yield o}}}var hs=(e,t,n,r,s,i,o)=>function(e={}){return ls(t,r,s,i,o,e)};const fs={raw:cs,file:cs,directory:us,"hamt-sharded-directory":hs,metadata:(e,t,n,r,s,i,o)=>()=>[],symlink:(e,t,n,r,s,i,o)=>()=>[]};var ps=async(e,t,n,r,s,i,o,a)=>{const u=await o.get(e,a),l=(0,k.decode)(u);let h,f;if(t||(t=e.toString()),null==l.Data)throw c(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{h=es.unmarshal(l.Data)}catch(e){throw c(e,"ERR_NOT_UNIXFS")}if(n||(n=t),r.length){let e;if(e=h&&"hamt-sharded-directory"===h.type?await ss(l,r[0],o):((e,t)=>{const n=e.Links.find((e=>e.Name===t));return n&&n.Hash})(l,r[0]),!e)throw c(new Error("file does not exist"),"ERR_NOT_FOUND");const t=r.shift();f={cid:e,toResolve:r,name:t||"",path:`${n}/${t}`}}return{entry:{type:h.isDirectory()?"directory":"file",name:t,path:n,cid:e,content:fs[h.type](e,l,h,n,s,i,o),unixfs:h,depth:i,node:l,size:h.fileSize()},next:f}};var ds=async(e,t,n,r,s,i,o,a)=>{if(r.length)throw c(new Error(`No link named ${n} found in raw node ${e}`),"ERR_NOT_FOUND");const u=await o.get(e,a);return{entry:{type:"raw",name:t,path:n,cid:e,content:(l=u,async function*(e={}){const{offset:t,length:n}=os(l.length,e.offset,e.length);yield is(l,0,t,t+n)}),depth:i,size:u.length,node:u}};var l};var ys=async(e,t,n,r,s,i,o,a)=>{const u=await o.get(e),l=S.decode(u);let h=l,f=n;for(;r.length;){const s=r[0];if(!(s in h))throw c(new Error(`No property named ${s} found in cbor node ${e}`),"ERR_NO_PROP");{r.shift(),f=`${f}/${s}`;const o=H.k0.asCID(h[s]);if(o)return{entry:{type:"object",name:t,path:n,cid:e,node:u,depth:i,size:u.length,content:async function*(){yield l}},next:{cid:o,name:s,path:f,toResolve:r}};h=h[s]}}return{entry:{type:"object",name:t,path:n,cid:e,node:u,depth:i,size:u.length,content:async function*(){yield l}}}};var gs=async(e,t,n,r,s,i,o,a)=>{if(r.length)throw c(new Error(`No link named ${n} found in raw node ${e}`),"ERR_NOT_FOUND");const u=await U.Jx(e.multihash.bytes);return{entry:{type:"identity",name:t,path:n,cid:e,content:(l=u.digest,async function*(e={}){const{offset:t,length:n}=os(l.length,e.offset,e.length);yield is(l,0,t,t+n)}),depth:i,size:u.digest.length,node:u.digest}};var l};const ms={[k.code]:ps,[Gn.code]:ds,[S.code]:ys,[I.identity.code]:gs};var bs=function e(t,n,r,s,i,o,a){const u=ms[t.code];if(!u)throw c(new Error(`No resolver for code ${t.code}`),"ERR_NO_RESOLVER");return u(t,n,r,s,e,i,o,a)};const ws=e=>{if(e instanceof Uint8Array)return{cid:H.k0.decode(e),toResolve:[]};const t=H.k0.asCID(e);if(t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=((e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean))(e);return{cid:H.k0.parse(t[0]),toResolve:t.slice(1)}}throw c(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function*vs(e,t,n={}){let{cid:r,toResolve:s}=ws(e),i=r.toString(),o=i;const a=s.length;for(;;){const u=await bs(r,i,o,s,a,t,n);if(!u.entry&&!u.next)throw c(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(u.entry&&(yield u.entry),!u.next)return;s=u.next.toResolve,r=u.next.cid,i=u.next.name,o=u.next.path}}async function Es(e,t,n={}){const r=await(0,Ie.Z)(vs(e,t,n));if(!r)throw c(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return r}async function*_s(e,t,n={}){const r=await Es(e,t,n);if(r&&(yield r,"directory"===r.type))for await(const e of async function*e(t,n){for await(const r of t.content(n))yield r,r instanceof Uint8Array||"directory"===r.type&&(yield*e(r,n))}(r,n))yield e}"0".charCodeAt(0),(0,B.m)("ustar\0","binary"),(0,B.m)("ustar ","binary"),(0,B.m)(" \0","binary");n(93489);var ks=n(71993);async function Ss(e){let t=new Uint8Array(0);for await(const n of e)t=(0,Ze.z)([t,n],t.length+n.length);return t}const Ts="0".charCodeAt(0),As=(0,B.m)("ustar\0","binary"),Is=(0,B.m)("00","binary"),xs=parseInt("7777",8),Os=257,Ps=263,Rs=function(e){switch(e){case"file":default:return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}},Ns=function(e){let t=256;for(let n=0;n<148;n++)t+=e[n];for(let n=156;n<512;n++)t+=e[n];return t},Ds=function(e,t){const n=e.toString(8);return n.length>t?(0,B.m)("7777777777777777777".slice(0,t)+" "):(0,B.m)("0000000000000000000".slice(0,t-n.length)+n+" ")},Cs=function(e){const t=(0,B.m)(e).byteLength;let n=Math.floor(Math.log(t)/Math.log(10))+1;return t+n>=Math.pow(10,n)&&n++,`${t+n}${e}`};function Ls(e){const t=new Uint8Array(512);let n=e.name,r="";if(5===e.typeflag&&"/"!==n[n.length-1]&&(n+="/"),(0,B.m)(n).byteLength!==n.length)return null;for(;(0,B.m)(n).byteLength>100;){const e=n.indexOf("/");if(-1===e)return null;r+=""!==r?"/"+n.slice(0,e):n.slice(0,e),n=n.slice(e+1)}return(0,B.m)(n).byteLength>100||(0,B.m)(r).byteLength>155||null!=e.linkname&&(0,B.m)(e.linkname).byteLength>100?null:(t.set((0,B.m)(n),0),t.set(Ds(e.mode&xs,6),100),t.set(Ds(e.uid,6),108),t.set(Ds(e.gid,6),116),t.set(Ds(e.size,11),124),t.set(Ds(e.mtime.getTime()/1e3|0,11),136),t[156]=Ts+Rs(e.type),null!=e.linkname&&t.set((0,B.m)(e.linkname),157),t.set(As,Os),t.set(Is,Ps),null!=e.uname&&t.set((0,B.m)(e.uname),265),null!=e.gname&&t.set((0,B.m)(e.gname),297),t.set(Ds(e.devmajor??0,6),329),t.set(Ds(e.devminor??0,6),337),null!=r&&t.set((0,B.m)(r),345),t.set(Ds(Ns(t),6),148),t)}const{S_IFMT:Bs,S_IFBLK:Ms,S_IFCHR:js,S_IFDIR:zs,S_IFIFO:Us,S_IFLNK:Fs}=ks,$s=parseInt("755",8),Hs=parseInt("644",8),Vs=new Uint8Array(1024);function Ks(e=0){switch(e&Bs){case Ms:return"block-device";case js:return"character-device";case zs:return"directory";case Us:return"fifo";case Fs:return"symlink";default:return"file"}}function qs(e){return 0!==(e&=511)?Vs.subarray(0,512-e):new Uint8Array(0)}function Ws(e){if(null==e.pax){const t=Ls(e);if(null!=t)return t}return function(e){const t=function(e){let t="";null!=e.name&&(t+=Cs(" path="+e.name+"\n")),null!=e.linkname&&(t+=Cs(" linkpath="+e.linkname+"\n"));const n=e.pax;if(null!=n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t+=Cs(" "+e+"="+n[e]+"\n"));return(0,B.m)(t)}(e),n={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.length,mtime:e.mtime,type:"pax-header",linkname:e.linkname,uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};return new sr.H(Ls(n)??new Uint8Array(0),t,qs(t.length),Ls({...n,size:e.size,type:e.type})??new Uint8Array(0)).subarray()}(e)}function Gs(){return async function*(e){for await(let{header:t,body:n}of e){const e={...t,size:"symlink"===t.type?0:t.size??0,type:t.type??Ks(t.mode),mode:t.mode??("directory"===t.type?$s:Hs),uid:t.uid??0,gid:t.gid??0,mtime:t.mtime??new Date};if("string"==typeof n&&(n=(0,B.m)(n)),n instanceof Uint8Array||(0,sr.Z)(n)){e.size=n.length,yield Ws(e),yield(0,sr.Z)(n)?n.subarray():n,yield qs(e.size);continue}if("symlink"===e.type&&null==e.linkname){if(null==n)throw new Error("type was symlink but no linkname or body specified");e.linkname=(0,K.B)(await Ss(n)),yield Ws(e);continue}if(yield Ws(e),"file"!==e.type&&"contiguous-file"!==e.type)continue;let r=0;for await(const e of n??[])r+=e.length,yield(0,sr.Z)(e)?e.subarray():e;if(r!==e.size)throw new Error(`size mismatch, wrote ${r} of ${e.size} bytes`);yield qs(e.size)}yield Vs}}var Js=n(88424);class Zs{constructor({preload:e,repo:t,hashers:n,options:r}){const s=Ur({preload:e,repo:t,options:r,hashers:n});this.addAll=s,this.add=function({addAll:e}){return async function(t,n={}){const r=await(0,Ie.Z)(e((0,Tn.f)(t),n));if(null==r)throw Error("Failed to add a file, if you see this please report a bug");return r}}({addAll:s}),this.cat=function({repo:e,preload:t}){return oe((async function*(n,r={}){if(n=he(n),!1!==r.preload){const e=n.split("/");t(H.k0.parse(e[0]))}const s=await Es(n,e.blocks,r);if("directory"===s.type)throw new Error("this dag node is a directory");if(!s.content)throw new Error("this dag node has no content");yield*s.content(r)}))}({repo:t,preload:e}),this.get=function({repo:e,preload:t}){return oe((async function*(n,r={}){if(null!=r.compressionLevel&&(r.compressionLevel<-1||r.compressionLevel>9))throw c(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(!1!==r.preload){let e;try{e=he(n).split("/")}catch(e){throw c(e,"ERR_INVALID_PATH")}t(H.k0.parse(e[0]))}const s=H.k0.asCID(n)||n,i=await Es(s,e.blocks,r);if("file"===i.type||"raw"===i.type){const e=[];return r.compress&&!0!==r.archive?e.push(i.content):e.push([{header:{name:i.path,mode:"file"===i.type&&i.unixfs.mode,mtime:"file"===i.type&&i.unixfs.mtime?new Date(1e3*i.unixfs.mtime.secs):void 0,size:i.size,type:"file"},body:i.content()}],Gs()),r.compress&&e.push((async function*(e){const t=await Ss(e);yield Js.ZP.gzip(t,{level:r.compressionLevel||6})})),void(yield*(0,_n.zG)(...e))}if("directory"!==i.type)throw c(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");{const t=[_s(s,e.blocks,r),async function*(e){for await(const t of e){const e={header:{name:t.path,size:t.size}};if("file"===t.type)e.header.type="file",e.header.mode=null!=t.unixfs.mode?t.unixfs.mode:void 0,e.header.mtime=t.unixfs.mtime?new Date(1e3*t.unixfs.mtime.secs):void 0,e.body=t.content();else if("raw"===t.type)e.header.type="file",e.body=t.content();else{if("directory"!==t.type)throw c(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");e.header.type="directory",e.header.mode=null!=t.unixfs.mode?t.unixfs.mode:void 0,e.header.mtime=t.unixfs.mtime?new Date(1e3*t.unixfs.mtime.secs):void 0}yield e}},Gs()];if(r.compress){if(!r.archive)throw c(new Error("file is not regular"),"ERR_INVALID_PATH");r.compress&&t.push((async function*(e){const t=await Ss(e);yield Js.ZP.gzip(t,{level:r.compressionLevel||6})}))}yield*(0,_n.zG)(...t)}}))}({repo:t,preload:e}),this.ls=function({repo:e,preload:t}){return oe((async function*(n,r={}){const s=he(n),i=s.split("/");!1!==r.preload&&t(H.k0.parse(i[0]));const o=H.k0.asCID(s)||s,a=await Es(o,e.blocks,r);if("file"!==a.type){if("directory"!==a.type)throw c(new Error(`Unknown UnixFS type ${a.type}`),"ERR_UNKNOWN_UNIXFS_TYPE");for await(const e of a.content())yield pe(e)}else yield pe(a)}))}({repo:t,preload:e})}}const Ys="0.18.0";const Xs=(0,a.kg)("ipfs:components:id");function Qs({peerId:e,network:t}){return oe((async function(n={}){const r=t.try();if(!r){if(n.peerId)throw new N;if(null==e.publicKey)throw c(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:e,publicKey:(0,K.B)(e.publicKey,"base64pad"),addresses:[],agentVersion:`js-ipfs/${Ys}`,protocolVersion:"9000",protocols:[]}}const{libp2p:s}=r,i=n.peerId?n.peerId:e,o=await async function(e,t,n){let r=await t.peerStore.get(e);r||(r=await async function(e,t,n){if(null==t.dht)throw c(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(const r of t.dht.findPeer(e,n))if("FINAL_PEER"===r.name)break;const r=await t.peerStore.get(e);if(!r)throw c(new Error("Could not find peer"),"ERR_NOT_FOUND");return r}(e,t,n));let s=e.publicKey?e.publicKey:await t.peerStore.keyBook.get(e);if(null==s)try{s=await t.getPublicKey(e,n)}catch(t){Xs.error("Could not load public key for",e.toString(),t)}return{...r,publicKey:s,metadata:r.metadata||new Map,addresses:r.addresses.map((e=>e.multiaddr))}}(i,s,n),a=(0,K.B)(o.metadata.get("AgentVersion")||new Uint8Array),u=(0,K.B)(o.metadata.get("ProtocolVersion")||new Uint8Array),l=o.id.toString();return{id:i,publicKey:o.publicKey?(0,K.B)(o.publicKey,"base64pad"):"",addresses:(o.addresses||[]).map((e=>{const t=e.toString();return t.endsWith(`/p2p/${l}`)?t:`${t}/p2p/${l}`})).sort().map((e=>(0,F.HM)(e))),agentVersion:a,protocolVersion:u,protocols:(o.protocols||[]).sort()}}))}var ei=function(e,t,n){var r,s,i;Array.isArray(t)&&(r=t.slice(0));"string"==typeof t&&(r=t.split("."));"symbol"==typeof t&&(r=[t]);if(!Array.isArray(r))throw new Error("props arg must be an array, a string or a symbol");if(!(s=r.pop()))return!1;ti(s);for(;i=r.shift();)if(ti(i),void 0===e[i]&&(e[i]={}),!(e=e[i])||"object"!=typeof e)return!1;return e[s]=n,!0};function ti(e){if("__proto__"==e||"constructor"==e||"prototype"==e)throw new Error("setting of prototype values not supported")}const ni={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:e=>(ei(e,"Discovery.MDNS.Enabled",!1),ei(e,"Discovery.webRTCStar.Enabled",!1),e.Swarm={...e.Swarm||{},DisableNatPortMap:!0},e)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:e=>(ei(e,"Discovery.MDNS.Enabled",!0),ei(e,"Discovery.webRTCStar.Enabled",!0),ei(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!1}),e)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:e=>{const t=mn();return ei(e,"Addresses.API",t.Addresses.API?"/ip4/127.0.0.1/tcp/0":""),ei(e,"Addresses.Gateway",t.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":""),ei(e,"Addresses.Swarm",t.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),ei(e,"Addresses.Delegates",[]),ei(e,"Bootstrap",[]),ei(e,"Discovery.MDNS.Enabled",!1),ei(e,"Discovery.webRTCStar.Enabled",!1),ei(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!0}),e}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:e=>{const t=mn();return ei(e,"Addresses.API",t.Addresses.API),ei(e,"Addresses.Gateway",t.Addresses.Gateway),ei(e,"Addresses.Swarm",t.Addresses.Swarm),ei(e,"Addresses.Delegates",t.Addresses.Delegates),ei(e,"Bootstrap",t.Bootstrap),ei(e,"Discovery.MDNS.Enabled",t.Discovery.MDNS.Enabled),ei(e,"Discovery.webRTCStar.Enabled",t.Discovery.webRTCStar.Enabled),ei(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!1}),e}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:e=>{const t=e.Swarm||{},n=t.ConnMgr||{};return n.LowWater=20,n.HighWater=40,t.ConnMgr=n,e.Swarm=t,e}},"default-power":{description:'Inverse of "lowpower" profile.',transform:e=>{const t=mn();return e.Swarm=t.Swarm,e}}},ri=(0,a.kg)("ipfs:core:config");async function si(e){return Object.keys(ni).map((e=>({name:e,description:ni[e].description})))}var ii=n(7618),oi=n(89003);function ai(e){const t=(0,S.encode)({version:1,roots:e}),n=oi.encode(t.length),r=new Uint8Array(n.length+t.length);return r.set(n,0),r.set(t,n.length),r}function ci(){}const ui={Null:e=>null===e,Int:e=>Number.isInteger(e),Float:e=>"number"==typeof e&&Number.isFinite(e),String:e=>"string"==typeof e,Bool:e=>"boolean"==typeof e,Bytes:e=>e instanceof Uint8Array,Link:e=>!ui.Null(e)&&"object"==typeof e&&e.asCID===e,List:e=>Array.isArray(e),Map:e=>!ui.Null(e)&&"object"==typeof e&&e.asCID!==e&&!ui.List(e)&&!ui.Bytes(e)},li={Int:ui.Int,"CarHeader > version":e=>li.Int(e),"CarHeader > roots (anon) > valueType (anon)":ui.Link,"CarHeader > roots (anon)":e=>ui.List(e)&&Array.prototype.every.call(e,li["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":e=>li["CarHeader > roots (anon)"](e),CarHeader:e=>{const t=e&&Object.keys(e);return ui.Map(e)&&["version"].every((e=>t.includes(e)))&&Object.entries(e).every((([e,t])=>li["CarHeader > "+e]&&li["CarHeader > "+e](t)))}},hi=li.CarHeader,fi={SHA2_256:18,LENGTH:32,DAG_PB:112},pi=40;function di(e,t){if(!e.length)throw new Error("Unexpected end of data");const n=oi.decode(e);return t.seek(oi.decode.bytes),n}async function yi(e,t){const n=di(await e.upTo(8),e);if(0===n)throw new Error("Invalid CAR header (zero length)");const r=await e.exactly(n,!0),s=(0,S.decode)(r);if(!hi(s))throw new Error("Invalid CAR header format");if(1!==s.version&&2!==s.version||void 0!==t&&s.version!==t)throw new Error(`Invalid CAR version: ${s.version}${void 0!==t?` (expected ${t})`:""}`);const i=Array.isArray(s.roots);if(1===s.version&&!i||2===s.version&&i)throw new Error("Invalid CAR header format");if(1===s.version)return s;const o=function(e){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=0;return{version:2,characteristics:[t.getBigUint64(n,!0),t.getBigUint64(n+=8,!0)],dataOffset:Number(t.getBigUint64(n+=8,!0)),dataSize:Number(t.getBigUint64(n+=8,!0)),indexOffset:Number(t.getBigUint64(n+=8,!0))}}(await e.exactly(pi,!0));e.seek(o.dataOffset-e.pos);const a=await yi(e,1);return Object.assign(a,o)}async function gi(e){const t=await e.exactly(2,!1);if(t[0]===fi.SHA2_256&&t[1]===fi.LENGTH){const t=await e.exactly(34,!0),n=U.Jx(t);return H.k0.create(0,fi.DAG_PB,n)}const n=di(await e.upTo(8),e);if(1!==n)throw new Error(`Unexpected CID version (${n})`);const r=di(await e.upTo(8),e),s=await e.exactly(function(e){oi.decode(e);const t=oi.decode.bytes,n=oi.decode(e.subarray(oi.decode.bytes));return t+oi.decode.bytes+n}(await e.upTo(8)),!0),i=U.Jx(s);return H.k0.create(n,r,i)}async function mi(e){const t=e.pos;let n=di(await e.upTo(8),e);if(0===n)throw new Error("Invalid CAR section (zero length)");n+=e.pos-t;return{cid:await gi(e),length:n,blockLength:n-Number(e.pos-t)}}async function bi(e){const{cid:t,blockLength:n}=await mi(e);return{bytes:await e.exactly(n,!0),cid:t}}async function wi(e){const t=e.pos,{cid:n,length:r,blockLength:s}=await mi(e),i={cid:n,length:r,blockLength:s,offset:t,blockOffset:e.pos};return e.seek(i.blockLength),i}function vi(e){const t=(async()=>{const t=await yi(e);if(2===t.version){const n=e.pos-t.dataOffset;e=function(e,t){let n=0;return{async upTo(r){let s=await e.upTo(r);return s.length+n>t&&(s=s.subarray(0,t-n)),s},async exactly(r,s=!1){const i=await e.exactly(r,s);if(i.length+n>t)throw new Error("Unexpected end of data");return s&&(n+=r),i},seek(t){n+=t,e.seek(t)},get pos(){return e.pos}}}(e,t.dataSize-n)}return t})();return{header:()=>t,async*blocks(){for(await t;(await e.upTo(8)).length>0;)yield await bi(e)},async*blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await wi(e)}}}function Ei(e){let t=0;return{upTo:async n=>e.subarray(t,t+Math.min(n,e.length-t)),async exactly(n,r=!1){if(n>e.length-t)throw new Error("Unexpected end of data");const s=e.subarray(t,t+n);return r&&(t+=n),s},seek(e){t+=e},get pos(){return t}}}function _i(e){const t=e[Symbol.asyncIterator]();return function(e){let t=0,n=0,r=0,s=new Uint8Array(0);const i=async t=>{n=s.length-r;const i=[s.subarray(r)];for(;n<t;){const t=await e();if(null==t)break;n<0?t.length>n&&i.push(t.subarray(-n)):i.push(t),n+=t.length}s=new Uint8Array(i.reduce(((e,t)=>e+t.length),0));let o=0;for(const e of i)s.set(e,o),o+=e.length;r=0};return{upTo:async e=>(s.length-r<e&&await i(e),s.subarray(r,r+Math.min(s.length-r,e))),async exactly(e,n=!1){if(s.length-r<e&&await i(e),s.length-r<e)throw new Error("Unexpected end of data");const o=s.subarray(r,r+e);return n&&(t+=e,r+=e),o},seek(e){t+=e,r+=e},get pos(){return t}}}((async function(){const e=await t.next();return e.done?null:e.value}))}class ki{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array&&e.cid))throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const t=H.k0.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then((()=>this._encoder.writeBlock({cid:t,bytes:e.bytes}))),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(e){e=function(e){if(void 0===e)return[];if(!Array.isArray(e)){const t=H.k0.asCID(e);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}const t=[];for(const n of e){const e=H.k0.asCID(n);if(!e)throw new TypeError("roots must be a single CID or an array of CIDs");t.push(e)}return t}(e);const{encoder:t,iterator:n}=Ti();return{writer:new ki(e,t),out:new Si(n)}}static createAppender(){const{encoder:e,iterator:t}=Ti();e.setRoots=()=>Promise.resolve();return{writer:new ki([],e),out:new Si(t)}}static async updateRootsInBytes(e,t){const n=Ei(e);await yi(n);const r=ai(t);if(Number(n.pos)!==r.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${r.length} bytes)`);return e.set(r,0),e}}class Si{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function Ti(){const e=function(){const e=[];let t=null,n=ci,r=!1,s=null,i=ci;const o=()=>(t||(t=new Promise((e=>{n=()=>{t=null,n=ci,e()}}))),t),a={write(t){e.push(t);const n=o();return i(),n},async end(){r=!0;const e=o();i(),await e}},c={async next(){const t=e.shift();return t?(0===e.length&&n(),{done:!1,value:t}):r?(n(),{done:!0,value:void 0}):(s||(s=new Promise((e=>{i=()=>(s=null,i=ci,e(c.next()))}))),s)}};return{writer:a,iterator:c}}(),{writer:t,iterator:n}=e,r=function(e){return{async setRoots(t){const n=ai(t);await e.write(n)},async writeBlock(t){const{cid:n,bytes:r}=t;await e.write(new Uint8Array(oi.encode(n.bytes.length+r.length))),await e.write(n.bytes),r.length&&await e.write(r)},async close(){await e.end()}}}(t);return{encoder:r,iterator:n}}var Ai=n(22188),Ii=n(41232);const xi=(0,a.kg)("ipfs:components:dag:import"),Oi=[Gn.code,Ai.code];function Pi({repo:e,preload:t,codecs:n}){return oe((async function*(r,s={}){!1!==s.preload&&t(r);const i=H.k0.asCID(r);if(!i)throw new Error(`Unexpected error converting CID type: ${r}`);xi(`Exporting ${i} as car`);const{writer:o,out:a}=await ki.create([i]);let c=null;(async()=>{try{const t=function(e,t,n,r){return async s=>{const i=await r.getCodec(s.code);if(!i)throw new Error(`Can't decode links in block with codec 0x${s.code.toString(16)} to form complete DAG`);const o=await e.blocks.get(s,n);return xi(`Adding block ${s} to car`),await t.put({cid:s,bytes:o}),Oi.includes(s.code)?null:(0,ii.OV)({bytes:o,cid:s,codec:i})}}(e,o,{signal:s.signal,timeout:s.timeout},n);await(0,Ii._)({cid:i,load:t})}catch(e){c=e}finally{o.close()}})();for await(const e of a){if(c)break;yield e}if(c)throw c}))}var Ri=n(91486);class Ni{constructor(e,t,n){this._version=e,this._roots=t,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class Di extends Ni{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){const{version:t,roots:n,iterator:r}=await Li(e);return new Di(t,n,r)}static async fromIterable(e){const{version:t,roots:n,iterator:r}=await Bi(e);return new Di(t,n,r)}}class Ci extends(null){[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;const e=this._iterable[Symbol.asyncIterator]();return{async next(){const t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(e){const{version:t,roots:n,iterator:r}=await Li(e);return new Ci(t,n,r)}static async fromIterable(e){const{version:t,roots:n,iterator:r}=await Bi(e);return new Ci(t,n,r)}}async function Li(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Mi(Ei(e))}async function Bi(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return Mi(_i(e))}async function Mi(e){const t=vi(e),{version:n,roots:r}=await t.header();return{version:n,roots:r,iterator:t.blocks()}}var ji=n(75671);const zi=(0,a.kg)("ipfs:components:dag:import");async function Ui(e,t,n){const r=await Di.fromIterable(n),s=await r.getRoots();return await(0,xt.Z)(e.blocks.putMany((0,vn.Z)(r,(({cid:e,bytes:t})=>(zi(`Import block ${e}`),{key:e,value:t}))),{signal:t.signal})),s}class Fi{constructor({repo:e,codecs:t,hashers:n,preload:r}){this.export=Pi({repo:e,preload:r,codecs:t}),this.get=function({codecs:e,repo:t,preload:n}){return oe((async function(r,s={}){if(!1!==s.preload&&n(r),s.path){const n=s.localResolve?await(0,Ri.Z)(ye(r,s.path,e,t,s)):await(0,Ie.Z)(ye(r,s.path,e,t,s));if(!n)throw c(new Error("Not found"),"ERR_NOT_FOUND");return n}const i=await e.getCodec(r.code),o=await t.blocks.get(r,s);return{value:i.decode(o),remainderPath:""}}))}({codecs:t,repo:e,preload:r}),this.import=function({repo:e}){return oe((async function*(t,n={}){const r=await e.gcLock.readLock();try{const r={signal:n.signal,timeout:n.timeout},s=(0,ji.Z)(t),{value:i,done:o}=await s.peek();if(o)return;let a;i&&s.push(i),a=i instanceof Uint8Array?[s]:s;for await(const t of a){const s=await Ui(e,r,t);if(!1!==n.pinRoots)for(const t of s){let n="";try{await e.blocks.has(t)?(zi(`Pinning root ${t}`),await e.pins.pinRecursively(t)):n="blockstore: block not found"}catch(e){n=e.message}yield{root:{cid:t,pinErrorMsg:n}}}}}finally{r()}}))}({repo:e}),this.resolve=function({repo:e,codecs:t,preload:n}){return oe((async function(r,s={}){const{cid:i}=ce(r);return!1!==s.preload&&n(i),fe(e,t,r,s)}))}({repo:e,codecs:t,preload:r}),this.put=function({repo:e,codecs:t,hashers:n,preload:r}){return oe((async function(s,i={}){const o=i.pin?await e.gcLock.readLock():null;try{const o=await t.getCodec(i.storeCodec||"dag-cbor");if(!o)throw new Error(`Unknown storeCodec ${i.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(i.inputCodec){if(!(s instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");const e=await t.getCodec(i.inputCodec);if(!e)throw new Error(`Unknown inputCodec ${i.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);s=e.decode(s)}const a=null!=i.version?i.version:1,c=await n.getHasher(i.hashAlg||"sha2-256");if(!c)throw new Error(`Unknown hash algorithm ${i.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);const u=o.encode(s),l=await c.digest(u),h=H.k0.create(a,o.code,l);return await e.blocks.put(h,u,{signal:i.signal}),i.pin&&await e.pins.pinRecursively(h),!1!==i.preload&&r(h),h}finally{o&&o()}}))}({repo:e,codecs:t,hashers:n,preload:r})}}var $i=n(38456);const Hi=(0,a.kg)("ipfs:preload"),Vi=new(be.Z.default?be.Z.default:be.Z)({concurrency:4});function Ki(e,t={}){return Hi(e),Vi.add((async()=>{const n=(await we.post(e,{signal:t.signal})).body.getReader();try{for(;;){const{done:e}=await n.read();if(e)return}}finally{n.releaseLock()}}))}const qi=(0,a.kg)("ipfs:preload");function Wi(e={}){if(e.enabled=Boolean(e.enabled),e.addresses=e.addresses||[],e.cache=e.cache||1e3,!e.enabled||!e.addresses.length){qi("preload disabled");const e=()=>{};return Object.assign(e,{start:()=>{},stop:()=>{}})}let t=!0,n=[];const r=e.addresses.map((e=>(0,$i.k)(e))),s=me(e.cache),i=async e=>{try{if(t)throw new Error(`preload ${e} but preloader is not started`);const i=e.toString();if(s.has(i))return;s.set(i,!0);const o=function(e){if(!Array.isArray(e))throw new TypeError("Expected an array, got "+typeof e);for(let t=(e=[...e]).length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}(r);let a=!1;const c=Date.now();for(const e of o){if(t)throw new Error(`preload aborted for ${i}`);let r;try{r=new AbortController,n=n.concat(r),await Ki(`${e}/api/v0/refs?r=true&arg=${encodeURIComponent(i)}`,{signal:r.signal}),a=!0}catch(e){"aborted"!==e.type&&qi.error(e)}finally{n=n.filter((e=>e!==r))}if(a)break}qi(`${a?"":"un"}successfully preloaded ${i} in ${Date.now()-c}ms`)}catch(e){qi.error(e)}};return i.start=()=>{t=!1},i.stop=()=>{t=!0,qi(`aborting ${n.length} pending preload request(s)`),n.forEach((e=>e.abort())),n=[]},i}const Gi=(0,a.kg)("ipfs:mfs-preload");var Ji=n(32398);let Zi;function Yi(e=!1){if(Zi)return Zi;const t=(0,Ji.Z)({singleProcess:e});return Zi={readLock:e=>async(...n)=>{const r=await t.readLock();try{return await e.apply(null,n)}finally{r()}},writeLock:e=>async(...n)=>{const r=await t.writeLock();try{return await e.apply(null,n)}finally{r()}}},Zi}const Xi=(0,a.kg)("ipfs:mfs:utils:with-mfs-root");async function Qi(e,t){if(t&&t.signal&&t.signal.aborted)throw c(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});let n;await e.repo.datastore.open();try{const t=await e.repo.datastore.get(le);n=H.k0.decode(t)}catch(r){if("ERR_NOT_FOUND"!==r.code)throw r;Xi("Creating new MFS root");const s=k.encode({Data:new _({type:"directory"}).marshal(),Links:[]}),i=await xn.sha256.digest(s);if(n=H.k0.createV0(i),await e.repo.blocks.put(n,s),t&&t.signal&&t.signal.aborted)throw c(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await e.repo.datastore.put(le,n.bytes)}return Xi(`Loaded MFS root /ipfs/${n}`),n}function eo(e=""){return(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}const to="ipfs",no=async(e,t,n)=>{const r=await Qi(e,n);let s={entryType:"file"},i="";if(i=H.k0.asCID(t)?`/ipfs/${t}`:t.toString(),i=i.trim(),i=i.replace(/(\/\/+)/g,"/"),i.endsWith("/")&&i.length>1&&(i=i.substring(0,i.length-1)),!i)throw c(new Error("paths must not be empty"),"ERR_NO_PATH");if("/"!==i.substring(0,1))throw c(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");"/"===i.substring(i.length-1)&&(i=i.substring(0,i.length-1));const o=eo(i);if(o[0]===to){let e;e=2===o.length?`/${o.join("/")}`:`/${o.slice(0,o.length-1).join("/")}`,s={type:"ipfs",depth:o.length-2,entryType:"file",mfsPath:`/${o.join("/")}`,mfsDirectory:e,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}else{const e=`/${to}/${r}${o.length?"/"+o.join("/"):""}`,t=`/${to}/${r}/${o.slice(0,o.length-1).join("/")}`;s={type:"mfs",depth:o.length,entryType:"file",mfsDirectory:t,mfsPath:e,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}const a="mfs"===s.type?s.mfsPath:s.path;try{const t=await Es(a,e.repo.blocks,n);s.cid=t.cid,s.mfsPath=`/ipfs/${t.path}`,s.entryType=t.type,s.content=t.content,"file"!==s.entryType&&"directory"!==s.entryType||"file"!==t.type&&"directory"!==t.type||(s.unixfs=t.unixfs)}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}return s.exists=Boolean(s.cid),s},ro=i.Z.bind({ignoreUndefined:!0}),so=(0,a.kg)("ipfs:mfs:stat"),io={withLocal:!1};function oo(e){return oe((async function(t,n={}){n=ro(io,n),so(`Fetching stats for ${t}`);const{type:r,cid:s,mfsPath:i}=await no(e,t,n),o="ipfs"===r&&s?s:i;let a;try{a=await Es(o,e.repo.blocks)}catch(e){if("ERR_NOT_FOUND"===e.code)throw c(new Error(`${t} does not exist`),"ERR_NOT_FOUND");throw e}if(!ao[a.type])throw new Error(`Cannot stat codec ${a.cid.code}`);return ao[a.type](a)}))}const ao={raw:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:e=>{const t={cid:e.cid,type:"file",size:e.unixfs.fileSize(),cumulativeSize:k.encode(e.node).length+(e.node.Links||[]).reduce(((e,t)=>e+(t.Tsize||0)),0),blocks:e.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:e.unixfs.mode};return e.unixfs.mtime&&(t.mtime=e.unixfs.mtime),t},directory:e=>{const t={cid:e.cid,type:"directory",size:0,cumulativeSize:k.encode(e.node).length+(e.node.Links||[]).reduce(((e,t)=>e+(t.Tsize||0)),0),blocks:e.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:e.unixfs.mode};return e.unixfs.mtime&&(t.mtime=e.unixfs.mtime),t},object:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})},co=(0,a.kg)("ipfs:mfs:utils:to-trail");async function uo(e,t){co(`Creating trail for path ${t}`);const n=[];for await(const r of vs(t,e.repo.blocks))n.push({name:r.name,cid:r.cid,size:r.size,type:r.type});return n}const lo=async(e,t,n)=>{n.codec||(n.codec=k),n.hasher||(n.hasher=xn.sha256),void 0===n.cidVersion&&(n.cidVersion=1),n.codec===k&&n.hasher!==xn.sha256&&(n.cidVersion=1);const r=await n.hasher.digest(e),s=H.k0.create(n.cidVersion,n.codec.code,r);return n.onlyHash||await t.put(s,e,{signal:n.signal}),s},ho=On.Pv.code;async function fo(e){return(await On.Pv.encode(e)).subarray(0,8).reverse()}class po{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}}class yo extends po{constructor(e,t){super(e,t),this._bucket=Tr({hashFn:fo,bits:8})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){yield*go(this._bucket,e,this,this.options)}}async function*go(e,t,n,r){const s=e._children,i=[];let o=0;for(let e=0;e<s.length;e++){const n=s.get(e);if(!n)continue;const a=e.toString(16).toUpperCase().padStart(2,"0");if(n instanceof dr){let e;for await(const s of await go(n,t,null,r))e=s;if(!e)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:a,Tsize:e.size,Hash:e.cid}),o+=e.size}else if("function"==typeof n.value.flush){const e=n.value;let r;for await(const n of e.flush(t))r=n,yield r;const s=a+n.key;i.push({Name:s,Tsize:r.size,Hash:r.cid}),o+=r.size}else{const e=n.value;if(!e.cid)continue;const t=a+n.key,r=e.size;i.push({Name:t,Tsize:r,Hash:e.cid}),o+=r}}const a=Uint8Array.from(s.bitField().reverse()),c={Data:new _({type:"hamt-sharded-directory",data:a,fanout:e.tableSize(),hashType:ho,mtime:n&&n.mtime,mode:n&&n.mode}).marshal(),Links:i},u=(0,k.encode)((0,k.prepare)(c)),l=await lo(u,t,r),h=u.length+o;yield{cid:l,node:c,size:h}}const mo=(0,a.kg)("ipfs:mfs:core:utils:hamt-utils"),bo=async(e,t,n,r)=>{if(!r.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");const s=Uint8Array.from(n._children.bitField().reverse()),i=_.unmarshal(r.parent.Data),o=new _({type:"hamt-sharded-directory",data:s,fanout:n.tableSize(),hashType:ho,mode:i.mode,mtime:i.mtime}),a=await e.hashers.getHasher(r.hashAlg),c={Data:o.marshal(),Links:t.sort(((e,t)=>(e.Name||"").localeCompare(t.Name||"")))},u=k.encode(c),l=await a.digest(u),h=H.k0.create(r.cidVersion,k.code,l);return r.flush&&await e.repo.blocks.put(h,u),{node:c,cid:h,size:t.reduce(((e,t)=>e+(t.Tsize||0)),u.length)}},wo=async(e,t,n,r,s)=>{const i=new dr({hash:n._options.hash,bits:n._options.bits},r,s);return r._putObjectAt(s,i),await Eo(e,t,i,n),i},vo=async e=>{const t=Tr({hashFn:fo,bits:8});return await Promise.all(e.map((async e=>{const n=e.Name||"";if(2===n.length){const e=parseInt(n,16),r=new dr({hash:t._options.hash,bits:t._options.bits},t,e);return t._putObjectAt(e,r),Promise.resolve()}return t.put(n.substring(2),{size:e.Tsize,cid:e.Hash})}))),t},Eo=async(e,t,n,r)=>{await Promise.all(t.map((async t=>{const s=t.Name||"";if(2===s.length){mo("Populating sub bucket",s);const i=parseInt(s,16),o=await e.repo.blocks.get(t.Hash),a=k.decode(o),c=new dr({hash:r._options.hash,bits:r._options.bits},n,i);return n._putObjectAt(i,c),await Eo(e,a.Links,c,r),Promise.resolve()}return r.put(s.substring(2),{size:t.Tsize,cid:t.Hash})})))},_o=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),ko=(0,a.kg)("ipfs:mfs:core:utils:add-link");async function So(e,t){let n=t.parent;if(t.parentCid){const r=H.k0.asCID(t.parentCid);if(null===r)throw c(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(r.code!==k.code)throw c(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");ko(`Loading parent node ${r}`);const s=await e.repo.blocks.get(r);n=k.decode(s)}if(!n)throw c(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!t.cid)throw c(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!t.name)throw c(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!t.size&&0!==t.size)throw c(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!n.Data)throw c(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");const r=_.unmarshal(n.Data);return"hamt-sharded-directory"===r.type?(ko("Adding link to sharded directory"),Io(e,{...t,parent:n})):n.Links.length>=t.shardSplitThreshold?(ko("Converting directory to sharded directory"),To(e,{...t,parent:n,mtime:r.mtime,mode:r.mode})):(ko(`Adding ${t.name} (${t.cid}) to regular directory`),Ao(e,{...t,parent:n}))}const To=async(e,t)=>{const n=await(async(e,t,n={})=>{const r=new yo({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:n.mtime,mode:n.mode},n);for(let e=0;e<t.length;e++)await r._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});const s=await(0,Ie.Z)(r.flush(e.repo.blocks));if(!s)throw new Error("Flushing shard yielded no result");return s})(e,t.parent.Links.map((e=>({name:e.Name||"",size:e.Tsize||0,cid:e.Hash}))).concat({name:t.name,size:t.size,cid:t.cid}),t);return ko(`Converted directory to sharded directory ${n.cid}`),n},Ao=async(e,t)=>{const n=t.parent.Links.filter((e=>e.Name!==t.name));if(n.push({Name:t.name,Tsize:t.size,Hash:t.cid}),!t.parent.Data)throw c(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");const r=_.unmarshal(t.parent.Data);let s;if(r.mtime){const e=Date.now(),t=Math.floor(e/1e3);r.mtime={secs:t,nsecs:1e3*(e-1e3*t)},s=r.marshal()}else s=t.parent.Data;t.parent=k.prepare({Data:s,Links:n});const i=await e.hashers.getHasher(t.hashAlg),o=k.encode(t.parent),a=await i.digest(o),u=H.k0.create(t.cidVersion,k.code,a);return t.flush&&await e.repo.blocks.put(u,o),{node:t.parent,cid:u,size:o.length}},Io=async(e,t)=>{const{shard:n,path:r}=await xo(e,t),s=await(0,Ie.Z)(n.flush(e.repo.blocks));if(!s)throw new Error("No result from flushing shard");const i=await e.repo.blocks.get(s.cid),o=k.decode(i),a=t.parent.Links.filter((e=>(e.Name||"").substring(0,2)!==r[0].prefix)),c=o.Links.find((e=>(e.Name||"").substring(0,2)===r[0].prefix));if(!c)throw new Error(`No link found with prefix ${r[0].prefix}`);return a.push(c),bo(e,a,r[0].bucket,t)},xo=async(e,t)=>{const n={name:t.name,cid:t.cid,size:t.size};if(!t.parent.Data)throw c(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");const r=await vo(t.parent.Links),s=_.unmarshal(t.parent.Data),i=new yo({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:s.mode},t);i._bucket=r,s.mtime&&(i.mtime={secs:Math.round(Date.now()/1e3)});const o=await r._findNewBucketAndPos(n.name),a=Oo(o);a[0].node=t.parent;let u=0;for(;u<a.length;){const t=a[u];u++;const s=t.node;if(!s)throw new Error("Segment had no node");const i=s.Links.find((e=>(e.Name||"").substring(0,2)===t.prefix));if(!i){ko(`Link ${t.prefix}${n.name} will be added`),u=a.length;break}if(i.Name===`${t.prefix}${n.name}`){ko(`Link ${t.prefix}${n.name} will be replaced`),u=a.length;break}if((i.Name||"").length>2){ko(`Link ${i.Name} ${i.Hash} will be replaced with a subshard`),u=a.length;break}ko(`Found subshard ${t.prefix}`);const o=await e.repo.blocks.get(i.Hash),c=k.decode(o);if(!a[u]){ko(`Loaded new subshard ${t.prefix}`),await wo(e,c.Links,r,t.bucket,parseInt(t.prefix,16));const s=await r._findNewBucketAndPos(n.name);a.push({bucket:s.bucket,prefix:_o(s.pos),node:c});break}const l=a[u];await Eo(e,c.Links,l.bucket,r),l.node=c}return await i._bucket.put(n.name,{size:n.size,cid:n.cid}),{shard:i,path:a}},Oo=e=>{const t=[{bucket:e.bucket,prefix:_o(e.pos)}];let n=e.bucket._parent,r=e.bucket._posAtParent;for(;n;)t.push({bucket:n,prefix:_o(r)}),r=n._posAtParent,n=n._parent;return t.reverse(),t},Po=(0,a.kg)("ipfs:mfs:utils:update-tree"),Ro={shardSplitThreshold:1e3};async function No(e,t,n){n=Object.assign({},Ro,n),Po("Trail",t),t=t.slice().reverse();let r,s=0;for await(const i of e.repo.blocks.getMany(t.map((e=>e.cid)))){const o=(0,k.decode)(i),a=t[s].cid,c=t[s].name;if(s++,!r){r={cid:a,name:c,size:i.length};continue}const u=await So(e,{parent:o,name:r.name,cid:r.cid,size:r.size,flush:n.flush,shardSplitThreshold:n.shardSplitThreshold,hashAlg:n.hashAlg,cidVersion:n.cidVersion});r={cid:u.cid,name:c,size:u.size}}const{cid:i}=r;return Po(`Final CID ${i}`),i}const Do=(0,a.kg)("ipfs:mfs:utils:update-mfs-root");async function Co(e,t,n){if(n&&n.signal&&n.signal.aborted)throw c(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return Do(`New MFS root will be ${t}`),await e.repo.datastore.put(le,t.bytes),t}const Lo=i.Z.bind({ignoreUndefined:!0}),Bo=(0,a.kg)("ipfs:mfs:mkdir"),Mo={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function jo(e){return oe((async function(t,n={}){const r=Lo(Mo,n);if(!t)throw new Error("no path given to Mkdir");if("/"===(t=t.trim())){if(r.parents)return;throw c(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if("/"!==t.substring(0,1))throw c(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");Bo(`Creating ${t}`);const s=eo(t);if("ipfs"===s[0])throw c(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");const i=await Qi(e,r);let o;const a=[],u=await async function(e,t,n){const r=new _({type:t,mode:n.mode,mtime:n.mtime}),s=await e.hashers.getHasher(n.hashAlg),i={Data:r.marshal(),Links:[]},o=k.encode(i),a=await s.digest(o),c=H.k0.create(n.cidVersion,k.code,a);return n.flush&&await e.repo.blocks.put(c,o),{cid:c,node:i}}(e,"directory",r);for(let n=0;n<=s.length;n++){const l=s.slice(0,n),h=`/ipfs/${i}/${l.join("/")}`;try{if(o=await Es(h,e.repo.blocks),"file"!==o.type&&"directory"!==o.type)throw c(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(n===s.length){if(r.parents)return;throw c(new Error("file already exists"),"ERR_ALREADY_EXISTS")}a.push({name:o.name,cid:o.cid})}catch(t){if("ERR_NOT_FOUND"!==t.code)throw t;if(n<s.length&&!r.parents)throw c(new Error(`Intermediate directory path ${h} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await zo(e,l[l.length-1],u,a[a.length-1],a,r)}}const l=await No(e,a,r);await Co(e,l,r)}))}const zo=async(e,t,n,r,s,i)=>{Bo(`Adding empty dir called ${t} to ${r.cid}`);const o=await So(e,{parent:r.node,parentCid:r.cid,size:0,cid:n.cid,name:t,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});s[s.length-1].cid=o.cid,s.push({name:t,cid:n.cid})},Uo=i.Z.bind({ignoreUndefined:!0}),Fo=(0,a.kg)("ipfs:mfs:cp"),$o={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function Ho(e){return oe((async function(t,n,r={}){const s=Uo($o,r);Array.isArray(t)||(t=[t]);const i=await Promise.all(t.map((t=>no(e,t,s))));let o=await no(e,n,s);if(!i.length||!o)throw c(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");const a=i.find((e=>!e.exists));if(a)throw c(new Error(`${a.path} does not exist`),"ERR_INVALID_PARAMS");const u=Vo(o);if(o.exists){if(Fo("Destination exists"),1===i.length&&!u)throw c(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(Fo("Destination does not exist"),i.length>1){if(!s.parents)throw c(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await jo(e)(o.path,s),o=await no(e,o.path,s)}else if(o.parts.length>1){const t=`/${o.parts.slice(0,-1).join("/")}`;try{await oo(e)(t,s)}catch(n){if("ERR_NOT_FOUND"!==n.code)throw n;if(!s.parents)throw c(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await jo(e)(t,s),o=await no(e,o.path,s)}}const l=Vo(o)?o.mfsPath:o.mfsDirectory,h=await uo(e,l);if(1===i.length){const t=i.pop();if(!t)throw c(new Error("could not find source"),"ERR_INVALID_PARAMS");const n=u?t.name:o.name;return Fo(`Only one source, copying to destination ${u?"directory":"file"} ${n}`),Ko(e,t,n,h,s)}return Fo("Multiple sources, wrapping in a directory"),qo(e,i,o,h,s)}))}const Vo=e=>e.unixfs&&e.unixfs.type&&e.unixfs.type.includes("directory"),Ko=async(e,t,n,r,s)=>{let i=r.pop();if(!i)throw c(new Error("destination had no parent"),"ERR_INVALID_PARAMS");i=await Wo(e,t,n,i,s),r.push(i);const o=await No(e,r,s);await Co(e,o,s)},qo=async(e,t,n,r,s)=>{for(let r=0;r<t.length;r++){const i=t[r];n=await Wo(e,i,i.name,n,s)}r[r.length-1]=n;const i=await No(e,r,s);await Co(e,i,s)},Wo=async(e,t,n,r,s)=>{const i=await e.repo.blocks.get(t.cid),{node:o,cid:a,size:c}=await So(e,{parentCid:r.cid,size:i.length,cid:t.cid,name:n,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold});return r.node=o,r.cid=a,r.size=c,r},Go=(0,a.kg)("ipfs:mfs:core:utils:remove-link");const Jo=async(e,t)=>{t.parent.Links=t.parent.Links.filter((e=>e.Name!==t.name));const n=await k.encode(t.parent),r=await e.hashers.getHasher(t.hashAlg),s=await r.digest(n),i=H.k0.create(t.cidVersion,k.code,s);return await e.repo.blocks.put(i,n),Go(`Updated regular directory ${i}`),{node:t.parent,cid:i}},Zo=async(e,t)=>{const{rootBucket:n,path:r}=await(async(e,t,n)=>{const r=await vo(n.Links),s=await r._findNewBucketAndPos(t),i=[{bucket:s.bucket,prefix:_o(s.pos)}];let o=s.bucket;for(;o!==r;)i.push({bucket:o,prefix:_o(o._posAtParent)}),o=o._parent;i.reverse(),i[0].node=n;for(let n=0;n<i.length;n++){const s=i[n];if(!s.node)throw new Error("Could not generate HAMT path");const o=s.node.Links.filter((e=>(e.Name||"").substring(0,2)===s.prefix)).pop();if(!o){mo(`Link ${s.prefix}${t} will be added`);continue}if(o.Name===`${s.prefix}${t}`){mo(`Link ${s.prefix}${t} will be replaced`);continue}mo(`Found subshard ${s.prefix}`);const a=await e.repo.blocks.get(o.Hash),c=k.decode(a);if(!i[n+1]){mo(`Loaded new subshard ${s.prefix}`),await wo(e,c.Links,r,s.bucket,parseInt(s.prefix,16));const n=await r._findNewBucketAndPos(t);i.push({bucket:n.bucket,prefix:_o(n.pos),node:c});continue}const u=i[n+1];await Eo(e,c.Links,u.bucket,r),u.node=c}return await r.put(t,!0),i.reverse(),{rootBucket:r,path:i}})(e,t.name,t.parent);await n.del(t.name);const{node:s}=await Yo(e,r,t.name,t);return bo(e,s.Links,n,t)},Yo=async(e,t,n,r)=>{const s=t.pop();if(!s)throw c(new Error("Could not find parent"),"EINVALIDPARENT");const{bucket:i,prefix:o,node:a}=s;if(!a)throw c(new Error("Could not find parent"),"EINVALIDPARENT");const u=a.Links.find((e=>(e.Name||"").substring(0,2)===o));if(!u)throw c(new Error(`No link found with prefix ${o} for file ${n}`),"ERR_NOT_FOUND");if(u.Name===`${o}${n}`){Go(`Removing existing link ${u.Name}`);const t=a.Links.filter((e=>e.Name!==u.Name));return await i.del(n),bo(e,t,i,r)}Go(`Descending into sub-shard ${u.Name} for ${o}${n}`);const l=await Yo(e,t,n,r);let h=l.cid,f=l.size,p=o;if(1===l.node.Links.length){Go(`Removing subshard for ${o}`);const e=l.node.Links[0];p=`${o}${(e.Name||"").substring(2)}`,h=e.Hash,f=e.Tsize||0}return Go(`Updating shard ${o} with name ${p}`),Xo(e,i,a,o,p,f,h,r)},Xo=(e,t,n,r,s,i,o,a)=>{const c=n.Links.filter((e=>e.Name!==r));return c.push({Name:s,Tsize:i,Hash:o}),bo(e,c,t,a)},Qo=i.Z.bind({ignoreUndefined:!0}),ea={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function ta(e){return oe((async function(t,n={}){const r=Qo(ea,n);Array.isArray(t)||(t=[t]);const s=await Promise.all(t.map((t=>no(e,t,r))));if(!s.length)throw c(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");s.forEach((e=>{if("/"===e.path)throw c(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")}));for(const t of s)await na(e,t.path,r)}))}const na=async(e,t,n)=>{const r=await no(e,t,n),s=await uo(e,r.mfsPath),i=s[s.length-1];s.pop();const o=s[s.length-1];if(!o)throw c(new Error(`${t} does not exist`),"ERR_NOT_FOUND");if("directory"===i.type&&!n.recursive)throw c(new Error(`${t} is a directory, use -r to remove directories`),"ERR_WAS_DIR");const{cid:a}=await async function(e,t){let n=t.parent;if(t.parentCid){const r=H.k0.asCID(t.parentCid);if(null===r)throw c(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");Go(`Loading parent node ${r}`);const s=await e.repo.blocks.get(r);n=k.decode(s)}if(!n)throw c(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!t.name)throw c(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!n.Data)throw c(new Error("Parent node had no data"),"ERR_INVALID_NODE");return"hamt-sharded-directory"===_.unmarshal(n.Data).type?(Go(`Removing ${t.name} from sharded directory`),Zo(e,{...t,parent:n})):(Go(`Removing link ${t.name} regular directory`),Jo(e,{...t,parent:n}))}(e,{parentCid:o.cid,name:i.name,hashAlg:n.hashAlg,cidVersion:n.cidVersion,flush:n.flush,shardSplitThreshold:n.shardSplitThreshold});o.cid=a;const u=await No(e,s,n);await Co(e,u,n)},ra=i.Z.bind({ignoreUndefined:!0}),sa=(0,a.kg)("ipfs:mfs:touch"),ia={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function oa(e,t,n){t||(t=0);const r=e.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!r)throw new Error(`Invalid file mode: ${e}`);let[,s,i,o]=r;"a"!==s&&s||(s="ugo");let a=function(e,t,n){let r=0;return(e.includes("x")||e.includes("X")&&(n||1&t||8&t||64&t))&&(r+=1),e.includes("w")&&(r+=2),e.includes("r")&&(r+=4),r}(o,t,n);return a=function(e,t){let n=0;return e.includes("u")&&(n+=t<<6),e.includes("g")&&(n+=t<<3),e.includes("o")&&(n+=t),n}(s,a),a=function(e,t,n){return t.includes("t")&&(n+=parseInt("1000",8)),t.includes("s")&&(e.includes("u")&&(n+=parseInt("4000",8)),e.includes("g")&&(n+=parseInt("2000",8))),n}(s,o,a),"="===i?(s.includes("u")&&(t&=parseInt("7077",8),t|=a),s.includes("g")&&(t&=parseInt("7707",8),t|=a),s.includes("o")&&(t&=parseInt("7770",8),t|=a),t):"+"===i?a|t:"-"===i?a^t:t}function aa(e,t){if(e instanceof String||"string"==typeof e){const n=`${e}`;e=n.match(/^\d+$/g)?parseInt(n,8):0+n.split(",").reduce(((e,n)=>oa(n,e,t.isDirectory())),t.mode||0)}return e}const ca=i.Z.bind({ignoreUndefined:!0}),ua={};const la=i.Z.bind({ignoreUndefined:!0}),ha={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3};const fa=i.Z.bind({ignoreUndefined:!0}),pa=(0,a.kg)("ipfs:mfs:touch"),da={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"};const ya=i.Z.bind({ignoreUndefined:!0}),ga={offset:0,length:1/0};var ma=n(53597);const ba=(0,a.kg)("ipfs:mfs:utils:to-async-iterator");const wa=i.Z.bind({ignoreUndefined:!0}),va=(0,a.kg)("ipfs:mfs:write"),Ea={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(e,t)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3};const _a=async(e,t,n,r,s)=>{const i=await ka(e,n,r,s);await Yi().writeLock((async()=>{const n=eo(t),r=n.pop();if(null==r)throw c(new Error("source does not exist"),"ERR_NO_EXIST");let o=!1;try{await oo(e)(`/${n.join("/")}`,s),o=!0}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}o||await jo(e)(`/${n.join("/")}`,s);const a=await no(e,t,s),u=await uo(e,a.mfsDirectory),l=u[u.length-1];if(!l)throw c(new Error("directory does not exist"),"ERR_NO_EXIST");if(!l.type||!l.type.includes("directory"))throw c(new Error(`cannot write to ${l.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");const h=await e.repo.blocks.get(l.cid),f=(0,k.decode)(h),p=await So(e,{parent:f,name:r,cid:i.cid,size:i.size,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold,hashAlg:s.hashAlg,cidVersion:s.cidVersion});l.cid=p.cid;const d=await No(e,u,s);await Co(e,d,s)}))()},ka=async(e,t,n,r)=>{n.exists?va(`Overwriting file ${n.cid} offset ${r.offset} length ${r.length}`):va(`Writing file offset ${r.offset} length ${r.length}`);const s=[];if(r.offset>0)if(n.unixfs){if(va(`Writing first ${r.offset} bytes of original file`),s.push((()=>n.content({offset:0,length:r.offset}))),n.unixfs.fileSize()<r.offset){const e=r.offset-n.unixfs.fileSize();va(`Writing zeros for extra ${e} bytes`),s.push(Ta(e))}}else va(`Writing zeros for first ${r.offset} bytes`),s.push(Ta(r.offset));s.push(Sa(t,r.length));const i=Ia(Aa(s),(e=>{if(n.unixfs&&!r.truncate){const t=n.unixfs.fileSize();if(t>e)return va(`Writing last ${t-e} of ${t} bytes from original file starting at offset ${e}`),n.content({offset:e});va("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}}));let o,a;void 0!==r.mode&&null!==r.mode?o=v(r.mode):n&&n.unixfs&&(o=n.unixfs.mode),null!=r.mtime?a=E(r.mtime):n&&n.unixfs&&(a=n.unixfs.mtime);const u=await e.hashers.getHasher(r.hashAlg),l=await(0,Ie.Z)(Dr([{content:i,mode:o,mtime:a}],e.repo.blocks,{progress:r.progress,hasher:u,cidVersion:r.cidVersion,strategy:r.strategy,rawLeaves:r.rawLeaves,reduceSingleLeafToSelf:r.reduceSingleLeafToSelf,leafType:r.leafType}));if(!l)throw c(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return va(`Wrote ${l.cid}`),{cid:l.cid,size:l.size}},Sa=(e,t)=>async function*(){let n=0;for await(const r of e){if(n+=r.length,n>t)return void(yield r.subarray(0,t-n));yield r}},Ta=(e,t=262144)=>{const n=new Uint8Array(t);return Sa(async function*(){for(;;)yield n}(),e)},Aa=async function*(e){for(let t=0;t<e.length;t++)yield*e[t]()},Ia=async function*(e,t){let n=0;for await(const t of e)n+=t.length,yield t;for await(const e of t(n))n+=e.length,yield e},xa=e=>{const t={cid:e.cid,name:e.name,type:"directory"===e.type?"directory":"file",size:e.size};return"file"!==e.type&&"directory"!==e.type||(t.mode=e.unixfs.mode,t.mtime=e.unixfs.mtime),t};const Oa={stat:oo},Pa={chmod:function(e){return oe((async function(t,n,r={}){const s=ra(ia,r);sa(`Fetching stats for ${t}`);const{cid:i,mfsDirectory:o,name:a}=await no(e,t,s);if(i.code!==k.code)throw c(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(s.recursive){const r=await(0,_n.zG)((async function*(){for await(const r of _s(i,e.repo.blocks)){if("file"!==r.type&&"directory"!==r.type)throw c(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");r.unixfs.mode=aa(n,r.unixfs);const e=k.prepare({Data:r.unixfs.marshal(),Links:r.node.Links});yield{path:r.path,content:e}}}),(t=>Dr(t,e.repo.blocks,{...s,pin:!1,dagBuilder:async function*(e,t,n){for await(const r of e)yield async function(){const e=r.content,s=k.encode(e),i=await lo(s,t,n);if(!e.Data)throw c(new Error(`${i} had no data`),"ERR_INVALID_NODE");const o=_.unmarshal(e.Data);return{cid:i,size:s.length,path:r.path,unixfs:o}}}})),(e=>(0,Ie.Z)(e)));if(!r)throw c(new Error(`Could not chmod ${t}`),"ERR_COULD_NOT_CHMOD");return await ta(e)(t,s),void await Ho(e)(`/ipfs/${r.cid}`,t,s)}const u=await e.repo.blocks.get(i),l=k.decode(u);if(!l.Data)throw c(new Error(`${i} had no data`),"ERR_INVALID_NODE");const h=_.unmarshal(l.Data);h.mode=aa(n,h);const f=k.encode({Data:h.marshal(),Links:l.Links}),p=s.hashAlg||ia.hashAlg,d=await e.hashers.getHasher(p),y=await d.digest(f),g=H.k0.create(s.cidVersion,k.code,y);s.flush&&await e.repo.blocks.put(g,f);const m=await uo(e,o),b=m[m.length-1],w=H.k0.decode(b.cid.bytes),v=await e.repo.blocks.get(w),E=k.decode(v),S=await So(e,{parent:E,name:a,cid:g,size:f.length,flush:s.flush,hashAlg:p,cidVersion:i.version,shardSplitThreshold:1/0});b.cid=S.cid;const T=await No(e,m,s);await Co(e,T,s)}))},cp:Ho,flush:function(e){return oe((async function(t,n={}){n=ca(ua,n);const{cid:r}=await oo(e)(t,n);return r}))},mkdir:jo,mv:function(e){return oe((async function(t,n,r={}){const s=la(ha,r);await Ho(e)(t,n,s),await ta(e)(t,{...s,recursive:!0})}))},rm:ta,touch:function(e){return oe((async function(t,n={}){const r=fa(da,n);r.mtime=r.mtime||new Date,pa(`Touching ${t} mtime: ${r.mtime}`);const{cid:s,mfsDirectory:i,name:o,exists:a}=await no(e,t,r),u=n.hashAlg||da.hashAlg,l=await e.hashers.getHasher(u);let h,f,p=r.cidVersion;if(a){if(s.code!==k.code)throw c(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");p=s.version;const n=await e.repo.blocks.get(s),i=k.decode(n);if(!i.Data)throw c(new Error(`${t} had no data`),"ERR_INVALID_NODE");const o=_.unmarshal(i.Data);o.mtime=r.mtime,h=k.encode({Data:o.marshal(),Links:i.Links});const a=await l.digest(h);f=H.k0.create(r.cidVersion,k.code,a),r.flush&&await e.repo.blocks.put(f,h)}else{const t=new _({type:"file",mtime:r.mtime});h=k.encode({Data:t.marshal(),Links:[]});const n=await l.digest(h);f=H.k0.create(r.cidVersion,k.code,n),r.flush&&await e.repo.blocks.put(f,h)}const d=await uo(e,i),y=d[d.length-1],g=y.cid,m=await e.repo.blocks.get(g),b=k.decode(m),w=await So(e,{parent:b,name:o,cid:f,size:h.length,flush:r.flush,shardSplitThreshold:r.shardSplitThreshold,hashAlg:r.hashAlg,cidVersion:p});y.cid=w.cid;const v=await No(e,d,r);await Co(e,v,r)}))}},Ra={write:function(e){return oe((async function(t,n,r={}){const s=wa(Ea,r);let i,o,a;if(va("Reading source, destination and parent"),await Yi().readLock((async()=>{i=await function(e){if(!e)throw c(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if(("string"==typeof e||e instanceof String)&&(ba("Content was a string"),e=(0,B.m)(e.toString())),e.length)return ba("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield e}};if(e[Symbol.asyncIterator])return ba("Content was an async iterator"),e;if(e[Symbol.iterator])return ba("Content was an iterator"),e;if(global.Blob&&e instanceof global.Blob)return ba("Content was an HTML5 Blob"),(0,ma.Z)(e.stream());throw c(new Error(`Don't know how to convert ${e} into an async iterator`),"ERR_INVALID_PARAMS")}(n),o=await no(e,t,s),a=await no(e,o.mfsDirectory,s)}))(),va("Read source, destination and parent"),!s.parents&&!a.exists)throw c(new Error("directory does not exist"),"ERR_NO_EXIST");if(null==i)throw c(new Error("could not create source"),"ERR_NO_SOURCE");if(null==o)throw c(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!s.create&&!o.exists)throw c(new Error("file does not exist"),"ERR_NO_EXIST");if("file"!==o.entryType)throw c(new Error("not a file"),"ERR_NOT_A_FILE");return _a(e,t,i,o,s)}))},read:function(e){return oe((function(t,n={}){return n=ya(ga,n),{[Symbol.asyncIterator]:async function*(){const r=await no(e,t,n),s=await Es(r.mfsPath,e.repo.blocks);if("file"!==s.type&&"raw"!==s.type)throw c(new Error(`${t} was not a file or raw bytes`),"ERR_NOT_FILE");if(!s.content)throw c(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(const e of s.content({offset:n.offset,length:n.length}))yield e}}}))},ls:function(e){return oe((async function*(t,n={}){const r=await no(e,t,n),s=await Es(r.mfsPath,e.repo.blocks);"directory"!==s.type?yield xa(s):yield*(0,vn.Z)(s.content(n),xa)}))}},Na=({options:e,mfs:t,operations:n,lock:r})=>{Object.keys(n).forEach((s=>{t[s]=r(n[s](e))}))},Da={repoOwner:!0,repo:null};function Ca({repo:e,preload:t,hashers:n,options:r}){const s=function(e){const{repoOwner:t}=Object.assign({},Da||{},e),n=Yi(t),r={};return Na({options:e,mfs:r,operations:Oa,lock:e=>n.readLock(e)}),Na({options:e,mfs:r,operations:Pa,lock:e=>n.writeLock(e)}),Object.keys(Ra).forEach((t=>{r[t]=Ra[t](e)})),r}({repo:e,repoOwner:!1!==r.repoOwner,hashers:n}),i=e=>(...n)=>{const r=n.filter((e=>Z(e,q)||J(e)));if(r.length){const e=n[n.length-1];e&&!1!==e.preload&&r.forEach((e=>t(e)))}return e(...n)};return{...s,chmod:s.chmod,cp:i(s.cp),mkdir:s.mkdir,stat:i(s.stat),rm:s.rm,read:i(s.read),touch:s.touch,write:s.write,mv:i(s.mv),flush:s.flush,ls:i((async function*(...e){for await(const t of s.ls(...e))yield{...t,size:t.size||0}}))}}const La="Ed25519";class Ba{constructor({keychain:e}){this.gen=function({keychain:e}){return oe(((t,n={type:La,size:2048})=>e.createKey(t,n.type||La,n.size||2048)))}({keychain:e}),this.list=function({keychain:e}){return oe((()=>e.listKeys()))}({keychain:e}),this.rm=function({keychain:e}){return oe((t=>e.removeKey(t)))}({keychain:e}),this.rename=function({keychain:e}){return oe((async(t,n)=>{const r=await e.renameKey(t,n);return{was:t,now:r.name,id:r.id,overwrite:!1}}))}({keychain:e}),this.export=function({keychain:e}){return oe(((t,n)=>e.exportKey(t,n)))}({keychain:e}),this.import=function({keychain:e}){return oe(((t,n,r)=>e.importKey(t,n,r)))}({keychain:e}),this.info=function({keychain:e}){return oe((t=>e.findKeyByName(t)))}({keychain:e})}}function Ma({repo:e,preload:t}){return oe((async function(n,r={}){!1!==r.preload&&t(n);const s=await e.blocks.get(n,r);return k.decode(s)}))}function ja(e,t=[]){for(const n in e){const r=e[n];if("/"===n&&1===Object.keys(e).length)try{t.push({Name:"",Tsize:0,Hash:H.k0.parse(r)});continue}catch(e){}const s=H.k0.asCID(r);s?t.push({Name:"",Tsize:0,Hash:s}):(Array.isArray(r)&&ja(r,t),r&&"object"==typeof r&&ja(r,t))}return t}function za({repo:e,codecs:t}){return oe((async function(n,r={}){const s=await t.getCodec(n.code),i=await e.blocks.get(n,r),o=s.decode(i);switch(n.code){case Gn.code:return[];case k.code:return o.Links;case S.code:case T.code:return ja(o);default:throw new Error(`Cannot resolve links from codec ${n.code}`)}}))}function Ua({repo:e,preload:t}){return oe((async function(n,r={}){const s=await e.gcLock.readLock();try{const s=k.encode(n),i=await xn.sha256.digest(s),o=H.k0.createV1(k.code,i);return await e.blocks.put(o,s,{signal:r.signal}),!1!==r.preload&&t(o),r.pin&&await e.pins.pinRecursively(o,{signal:r.signal}),o}finally{s()}}))}class Fa{constructor({repo:e,preload:t}){this.addLink=function({repo:e,preload:t}){const n=Ma({repo:e,preload:t}),r=Ua({repo:e,preload:t});return oe((async function(e,t,s={}){const i=await n(e,s);return r({...i,Links:i.Links.concat([t])},s)}))}({repo:e,preload:t}),this.appendData=function({repo:e,preload:t}){const n=Ma({repo:e,preload:t}),r=Ua({repo:e,preload:t});return oe((async function(e,t,s={}){const i=await n(e,s),o=(0,Ze.z)([i.Data||[],t]);return r({...i,Data:o},s)}))}({repo:e,preload:t}),this.rmLink=function({repo:e,preload:t}){const n=Ma({repo:e,preload:t}),r=Ua({repo:e,preload:t});return oe((async function(e,t,s={}){const i=await n(e,s),o=("string"==typeof t?t:t.Name)||"";return i.Links=i.Links.filter((e=>e.Name!==o)),r(i,s)}))}({repo:e,preload:t}),this.setData=function({repo:e,preload:t}){const n=Ma({repo:e,preload:t}),r=Ua({repo:e,preload:t});return oe((async function(e,t,s={}){const i=await n(e,s);return r({...i,Data:t},s)}))}({repo:e,preload:t})}}class $a{constructor({repo:e,codecs:t,preload:n}){this.data=function({repo:e,preload:t}){const n=Ma({repo:e,preload:t});return oe((async function(e,t={}){return(await n(e,t)).Data||new Uint8Array(0)}))}({repo:e,preload:n}),this.get=Ma({repo:e,preload:n}),this.links=za({repo:e,codecs:t}),this.new=function({repo:e,preload:t}){return oe((async function(n={}){let r;if(n.template){if("unixfs-dir"!==n.template)throw new Error("unknown template");r=new _({type:"directory"}).marshal()}const s=k.encode({Data:r,Links:[]}),i=await xn.sha256.digest(s),o=H.k0.createV0(i);return await e.blocks.put(o,s,{signal:n.signal}),!1!==n.preload&&t(o),o}))}({repo:e,preload:n}),this.put=Ua({repo:e,preload:n}),this.stat=function({repo:e,preload:t}){const n=Ma({repo:e,preload:t});return oe((async function(e,t={}){const r=await n(e,t),s=k.encode(r).length,i=r.Links.reduce(((e,t)=>e+(t.Tsize||0)),0);return{Hash:e,NumLinks:r.Links.length,BlockSize:s,LinksSize:s-(r.Data||[]).length,DataSize:(r.Data||[]).length,CumulativeSize:s+i}}))}({repo:e,preload:n}),this.patch=new Fa({repo:e,preload:n})}}const Ha=(0,a.kg)("ipfs:repo:gc");function Va({repo:e}){return oe((async function(t={}){const n=await e.stat();return{numObjects:BigInt(n.numObjects.toString()),repoSize:BigInt(n.repoSize.toString()),repoPath:n.repoPath,version:`${n.version}`,storageMax:BigInt(n.storageMax.toString())}}))}const Ka=12;class qa{constructor({repo:e,hashers:t}){this.gc=function({repo:e,hashers:t}){return oe((async function*(n={}){const r=Date.now();let s;try{s=await Qi({repo:e,hashers:t},n),await e.pins.pinRecursively(s),yield*e.gc()}finally{s&&await e.pins.unpin(s)}Ha(`Complete (${Date.now()-r}ms)`)}))}({repo:e,hashers:t}),this.stat=Va({repo:e}),this.version=function({repo:e}){return oe((async function(t={}){try{await e._checkInitialized(t)}catch(e){if([/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some((t=>t.test(e.message))))return Ka;throw e}return e.version.get()}))}({repo:e}),this.setApiAddr=t=>e.apiAddr.set(t)}}function Wa(e,t){return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0}}class Ga{constructor({repo:e,network:t}){this.repo=Va({repo:e}),this.bw=function({network:e}){return oe((async function*(t={}){const{libp2p:n}=await e.use(t);if(!t.poll)return void(yield Wa());const r=t.interval||1e3;let s,i=-1;try{if(i="string"==typeof r?(0,se.Z)(r)||-1:r,!i||i<0)throw new Error("invalid duration")}catch(e){throw c(e,"ERR_INVALID_POLL_INTERVAL")}try{for(;;)yield Wa(),await new Promise((e=>{s=setTimeout(e,i)}))}finally{clearTimeout(s)}}))}({network:t}),this.bitswap=dn({network:t})}}var Ja=function(e,t,n){if(!e)return n;var r,s;Array.isArray(t)&&(r=t.slice(0));"string"==typeof t&&(r=t.split("."));"symbol"==typeof t&&(r=[t]);if(!Array.isArray(r))throw new Error("props arg must be an array, a string or a symbol");for(;r.length;){if(s=r.shift(),!e)return n;if(void 0===(e=e[s]))return n}return e};var Za=n(11227),Ya=n(95918);const Xa=Za("ipfs:repo:migrator:migration-8");function Qa(e){return e.child?Qa(e.child):e}function ec(e){try{const t=z.base32.decode(`b${e.toString().toLowerCase().slice(1)}`),n=H.k0.decode(t).multihash.bytes,r=z.base32.encode(n).slice(1).toUpperCase();return new ne.s(`/${r}`,!1)}catch(t){return e}}function tc(e){try{const t=z.base32.decode(`b${e.toString().toLowerCase().slice(1)}`),n=U.Jx(t),r=z.base32.encode(H.k0.createV1(Gn.code,n).bytes).slice(1);return new ne.s(`/${r.toUpperCase()}`,!1)}catch{return e}}async function nc(e,t,n){const r=e.blocks;await r.open();const s=Qa(r),i=await(0,Ya.Z)(s.queryKeys({filters:[e=>n(e).toString()!==e.toString()]}));try{let e=0;for await(const r of s.query({})){const o=n(r.key);o.toString()!==r.key.toString()&&(e+=1,Xa(`Migrating Block from ${r.key} to ${o}`,await s.has(r.key)),await s.delete(r.key),await s.put(o,r.value),t(e/i*100,`Migrated Block from ${r.key} to ${o}`))}}finally{await r.close()}}const rc={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(e,t=(()=>{}))=>nc(e,t,ec),revert:(e,t=(()=>{}))=>nc(e,t,tc)};var sc=n(67412);const ic=sc.Reader,oc=sc.Writer,ac=(sc.util,sc.roots.default||(sc.roots.default={})),cc=ac.ipfs=(()=>{const e={};return e.pin=function(){const e={};return e.Set=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.version=0,e.prototype.fanout=0,e.prototype.seed=0,e.encode=function(e,t){return t||(t=oc.create()),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(8).uint32(e.version),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(16).uint32(e.fanout),null!=e.seed&&Object.hasOwnProperty.call(e,"seed")&&t.uint32(29).fixed32(e.seed),t},e.decode=function(e,t){e instanceof ic||(e=ic.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new ac.ipfs.pin.Set;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.version=e.uint32();break;case 2:r.fanout=e.uint32();break;case 3:r.seed=e.fixed32();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof ac.ipfs.pin.Set)return e;var t=new ac.ipfs.pin.Set;return null!=e.version&&(t.version=e.version>>>0),null!=e.fanout&&(t.fanout=e.fanout>>>0),null!=e.seed&&(t.seed=e.seed>>>0),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.version=0,n.fanout=0,n.seed=0),null!=e.version&&e.hasOwnProperty("version")&&(n.version=e.version),null!=e.fanout&&e.hasOwnProperty("fanout")&&(n.fanout=e.fanout),null!=e.seed&&e.hasOwnProperty("seed")&&(n.seed=e.seed),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e}(),e}(),e})();var uc=n(96132),lc=n(33497);const hc=new ne.s("/local/pins"),fc=256,pc=8192,dc=H.k0.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),yc="direct",gc="recursive";function mc(e){return new ne.s(`/${z.base32.encode(e.multihash.bytes).toUpperCase().substring(1)}`)}var bc=n(20295);const wc=cc.pin.Set;async function*vc(e,t){const n=function(e){const t=e.Data;if(!t)throw new Error("No data present");const n=lc.decode(t),r=lc.decode.bytes??0;if(r<=0)throw new Error("Invalid Set header length");if(r+n>t.length)throw new Error("Impossibly large set header length");const s=t.slice(r,n+r),i=wc.toObject(wc.decode(s),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(1!==i.version)throw new Error(`Unsupported Set version: ${i.version}`);if(i.fanout>e.Links.length)throw new Error("Impossibly large fanout");return{header:i,data:t.slice(n+r)}}(t);let r=0;for(const s of t.Links){if(r<n.header.fanout){const t=s.Hash;if(!dc.equals(t)){const n=await e.get(t),r=k.decode(n);yield*vc(e,r)}}else yield s.Hash;r++}}async function*Ec(e,t,n){const r=t.Links.find((e=>e.Name===n));if(!r)throw new Error("No link found with name "+n);const s=await e.get(r.Hash),i=k.decode(s);yield*vc(e,i)}function _c(e,t){return async function t(n,r){const s=wc.encode({version:1,fanout:fc,seed:r}).finish(),i=lc.encode(s.length),o=(0,Ze.z)([i,s]),a=[];for(let e=0;e<fc;e++)a.push({Name:"",Tsize:1,Hash:dc});if(n.length<=pc){const e=n.map((e=>({link:{Name:"",Tsize:1,Hash:e.key},data:e.data||new Uint8Array}))).sort(((e,t)=>(0,bc.q)(e.link.Hash.bytes,t.link.Hash.bytes))),t=a.concat(e.map((e=>e.link)));return{Data:(0,Ze.z)([o,...e.map((e=>e.data))]),Links:t}}{const e=n.reduce(((e,t)=>{const n=function(e,t){const n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,e,!0);const r=(0,B.m)(t.toString()),s=(0,Ze.z)([n,r],n.byteLength+r.byteLength);return uc((0,K.B)(s))}(r,t.key)%fc;return e[n]=n in e?e[n].concat([t]):[t],e}),[]);let s=0;for(const n of e){const e=await t(n,r+1);await c(e,s),s++}return{Data:o,Links:a}}async function c(t,n){const r=k.encode(t),s=await xn.sha256.digest(r),i=H.k0.createV0(s);await e.put(i,r);const o=t.Links.reduce(((e,t)=>e+(t.Tsize||0)),0)+r.length;a[n]={Name:"",Tsize:o,Hash:i}}}(t,0)}async function kc(e,t,n){const r=await _c(e,n.map((e=>({key:e})))),s=k.encode(r),i=await xn.sha256.digest(s),o=H.k0.createV0(i);await e.put(o,s);return{Name:t,Tsize:r.Links.reduce(((e,t)=>e+t.Tsize),0)+s.length,Hash:o}}async function Sc(e,t,n,r){if(!await t.has(hc))return;const s=await t.get(hc),i=H.k0.decode(s),o=await e.get(i),a=k.decode(o);let c=0;const u=await(0,Ya.Z)(Ec(e,a,gc))+await(0,Ya.Z)(Ec(e,a,yc));for await(const t of Ec(e,a,gc)){c++;const e={depth:1/0};0!==t.version&&(e.version=t.version),t.code!==k.code&&(e.codec=t.code),await n.put(mc(t),Ye.cv(e)),r(c/u*100,`Migrated recursive pin ${t}`)}for await(const t of Ec(e,a,yc)){c++;const e={depth:0};0!==t.version&&(e.version=t.version),t.code!==k.code&&(e.codec=t.code),await n.put(mc(t),Ye.cv(e)),r(c/u*100,`Migrated direct pin ${t}`)}await e.delete(i),await t.delete(hc)}async function Tc(e,t,n,r){const s=[],i=[];let o=0;const a=await(0,Ya.Z)(n.queryKeys({}));for await(const{key:e,value:t}of n.query({})){o++;const n=Ye.Jx(t),c=H.k0.create(n.version||0,n.codec||k.code,U.Jx(z.base32.decode("b"+e.toString().toLowerCase().split("/").pop())));0===n.depth?(r(o/a*100,`Reverted direct pin ${c}`),i.push(c)):(r(o/a*100,`Reverted recursive pin ${c}`),s.push(c))}r(100,"Updating pin root");const c={Links:[await kc(e,yc,i),await kc(e,gc,s)]},u=k.encode(c),l=await xn.sha256.digest(u),h=H.k0.createV0(l);await e.put(h,u),await t.put(hc,h.bytes)}async function Ac(e,t,n){const r=e.blocks,s=e.datastore,i=e.pins;await r.open(),await s.open(),await i.open();try{await n(r,s,i,t)}finally{await i.close(),await s.close(),await r.close()}}const Ic={version:9,description:"Migrates pins to datastore",migrate:(e,t=(()=>{}))=>Ac(e,t,Sc),revert:(e,t=(()=>{}))=>Ac(e,t,Tc)},xc=new ne.s("/config"),Oc=new ne.s("/version");function Pc(e){let t=e;for(;t.db||t.child;)if(t=t.db||t.child,"level-js"===t.type||"Level"===t.constructor.name)return t}function Rc(e){const t=e.get.bind(e),n=e.has.bind(e);return e.get=r=>async function(e,t,n,r){if(await n(e))return t(e);const s=Pc(r);if(!s)throw(0,De.notFoundError)();return new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{if(r.result)return t(r.result);n((0,De.notFoundError)())}}))}(r,t,n,e),e.has=t=>async function(e,t,n){const r=await t(e);if(r)return r;const s=Pc(n);return!!s&&new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{t(Boolean(r.result))}}))}(t,n,e),e}function Nc(e){return{...e,root:Rc(e.root),datastore:Rc(e.datastore),pins:Rc(e.pins),keys:Rc(e.keys)}}async function Dc(e,t,n=(()=>{})){const r=Pc(t);if(!r)return void n(`${e} did not need an upgrade`);n(`Upgrading ${e}`);await jc(r,((e,t)=>[{type:"del",key:e},{type:"put",key:(0,B.m)(e),value:t}]))}async function Cc(e,t,n=(()=>{})){const r=Pc(t);if(!r)return void n(`${e} did not need a downgrade`);n(`Downgrading ${e}`);await jc(r,((e,t)=>[{type:"del",key:e},{type:"put",key:(0,K.B)(e),value:t}]))}function Lc(e){return e.child?Lc(e.child):e}async function Bc(e,t,n){const r=Object.entries(e).map((([e,t])=>({key:e,backend:Lc(t)}))).filter((({key:e,backend:t})=>"LevelDatastore"===t.constructor.name)).map((({key:e,backend:t})=>({name:e,store:t})));t(0,`Migrating ${r.length} dbs`);let s=0;const i=e=>{t(Math.round(s/r.length*100),e)};for(const{name:e,store:t}of r){await t.open();try{await n(e,t,i)}finally{s++,await t.close()}}t(100,`Migrated ${r.length} dbs`)}const Mc={version:10,description:"Migrates datastore-level keys to binary",migrate:(e,t=(()=>{}))=>Bc(e,t,Dc),revert:(e,t=(()=>{}))=>Bc(e,t,Cc)};function jc(e,t){return new Promise(((n,r)=>{const s=e.iterator();s._deserializeKey=s._deserializeValue=e=>e,function i(){const o=(o,a,c)=>{if(o||void 0===a){const e=e=>{e?r(e):n()};s.end(e)}else!function(t,n){const r=e.store("readwrite"),s=r.transaction;let i,o=0;s.onabort=()=>n(i||s.error||new Error("aborted by user")),s.oncomplete=()=>n(),function e(){const n=t[o++],a=n.key;let c;try{c="del"===n.type?r.delete(a):r.put(n.value,a)}catch(e){return i=e,void s.abort()}o<t.length&&(c.onsuccess=e)}()}(t(a,c),i)};s.next(o)}()}))}const zc=new ne.s("/local/filesroot");const Uc={version:11,description:"Store mfs root in the datastore",migrate:async function(e,t=(()=>{})){if(t(100,"Migrating MFS root to repo datastore"),await e.root.open(),await e.datastore.open(),await e.root.has(zc)){const t=await e.root.get(zc);await e.datastore.put(zc,t),await e.root.delete(zc)}await e.datastore.close(),await e.root.close(),t(100,"Stored MFS root in repo datastore")},revert:async function(e,t=(()=>{})){if(t(100,"Migrating MFS root to repo root datastore"),await e.root.open(),await e.datastore.open(),await e.datastore.has(zc)){const t=await e.datastore.get(zc);await e.root.put(zc,t),await e.datastore.delete(zc)}await e.datastore.close(),await e.root.close(),t(100,"Stored MFS root in repo root datastore")}},Fc=sc.Reader,$c=sc.Writer,Hc=sc.util,Vc=sc.roots.default||(sc.roots.default={}),Kc=Vc.Protocols=(()=>{function e(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.protocols=Hc.emptyArray,e.encode=function(e,t){if(t||(t=$c.create()),null!=e.protocols&&e.protocols.length)for(var n=0;n<e.protocols.length;++n)t.uint32(10).string(e.protocols[n]);return t},e.decode=function(e,t){e instanceof Fc||(e=Fc.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Vc.Protocols;e.pos<n;){var s=e.uint32();if(s>>>3==1)r.protocols&&r.protocols.length||(r.protocols=[]),r.protocols.push(e.string());else e.skipType(7&s)}return r},e.fromObject=function(e){if(e instanceof Vc.Protocols)return e;var t=new Vc.Protocols;if(e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Protocols.protocols: array expected");t.protocols=[];for(var n=0;n<e.protocols.length;++n)t.protocols[n]=String(e.protocols[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.protocols=[]),e.protocols&&e.protocols.length){n.protocols=[];for(var r=0;r<e.protocols.length;++r)n.protocols[r]=e.protocols[r]}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e})(),qc=sc.Reader,Wc=sc.Writer,Gc=sc.util,Jc=sc.roots.default||(sc.roots.default={}),Zc=Jc.Addresses=(()=>{function e(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.addrs=Gc.emptyArray,e.prototype.certifiedRecord=null,e.encode=function(e,t){if(t||(t=Wc.create()),null!=e.addrs&&e.addrs.length)for(var n=0;n<e.addrs.length;++n)Jc.Addresses.Address.encode(e.addrs[n],t.uint32(10).fork()).ldelim();return null!=e.certifiedRecord&&Object.hasOwnProperty.call(e,"certifiedRecord")&&Jc.Addresses.CertifiedRecord.encode(e.certifiedRecord,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof qc||(e=qc.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Jc.Addresses;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.addrs&&r.addrs.length||(r.addrs=[]),r.addrs.push(Jc.Addresses.Address.decode(e,e.uint32()));break;case 2:r.certifiedRecord=Jc.Addresses.CertifiedRecord.decode(e,e.uint32());break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Jc.Addresses)return e;var t=new Jc.Addresses;if(e.addrs){if(!Array.isArray(e.addrs))throw TypeError(".Addresses.addrs: array expected");t.addrs=[];for(var n=0;n<e.addrs.length;++n){if("object"!=typeof e.addrs[n])throw TypeError(".Addresses.addrs: object expected");t.addrs[n]=Jc.Addresses.Address.fromObject(e.addrs[n])}}if(null!=e.certifiedRecord){if("object"!=typeof e.certifiedRecord)throw TypeError(".Addresses.certifiedRecord: object expected");t.certifiedRecord=Jc.Addresses.CertifiedRecord.fromObject(e.certifiedRecord)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.addrs=[]),t.defaults&&(n.certifiedRecord=null),e.addrs&&e.addrs.length){n.addrs=[];for(var r=0;r<e.addrs.length;++r)n.addrs[r]=Jc.Addresses.Address.toObject(e.addrs[r],t)}return null!=e.certifiedRecord&&e.hasOwnProperty("certifiedRecord")&&(n.certifiedRecord=Jc.Addresses.CertifiedRecord.toObject(e.certifiedRecord,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e.Address=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.multiaddr=Gc.newBuffer([]),e.prototype.isCertified=null,Object.defineProperty(e.prototype,"_isCertified",{get:Gc.oneOfGetter(t=["isCertified"]),set:Gc.oneOfSetter(t)}),e.encode=function(e,t){return t||(t=Wc.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),null!=e.isCertified&&Object.hasOwnProperty.call(e,"isCertified")&&t.uint32(16).bool(e.isCertified),t},e.decode=function(e,t){e instanceof qc||(e=qc.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Jc.Addresses.Address;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.multiaddr=e.bytes();break;case 2:r.isCertified=e.bool();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Jc.Addresses.Address)return e;var t=new Jc.Addresses.Address;return null!=e.multiaddr&&("string"==typeof e.multiaddr?Gc.base64.decode(e.multiaddr,t.multiaddr=Gc.newBuffer(Gc.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),null!=e.isCertified&&(t.isCertified=Boolean(e.isCertified)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.multiaddr="":(n.multiaddr=[],t.bytes!==Array&&(n.multiaddr=Gc.newBuffer(n.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(n.multiaddr=t.bytes===String?Gc.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),null!=e.isCertified&&e.hasOwnProperty("isCertified")&&(n.isCertified=e.isCertified,t.oneofs&&(n._isCertified="isCertified")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e}(),e.CertifiedRecord=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=Gc.Long?Gc.Long.fromBits(0,0,!0):0,e.prototype.raw=Gc.newBuffer([]),e.encode=function(e,t){return t||(t=Wc.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.raw&&Object.hasOwnProperty.call(e,"raw")&&t.uint32(18).bytes(e.raw),t},e.decode=function(e,t){e instanceof qc||(e=qc.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Jc.Addresses.CertifiedRecord;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.seq=e.uint64();break;case 2:r.raw=e.bytes();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Jc.Addresses.CertifiedRecord)return e;var t=new Jc.Addresses.CertifiedRecord;return null!=e.seq&&(Gc.Long?(t.seq=Gc.Long.fromValue(e.seq)).unsigned=!0:"string"==typeof e.seq?t.seq=parseInt(e.seq,10):"number"==typeof e.seq?t.seq=e.seq:"object"==typeof e.seq&&(t.seq=new Gc.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),null!=e.raw&&("string"==typeof e.raw?Gc.base64.decode(e.raw,t.raw=Gc.newBuffer(Gc.base64.length(e.raw)),0):e.raw.length&&(t.raw=e.raw)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Gc.Long){var r=new Gc.Long(0,0,!0);n.seq=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.seq=t.longs===String?"0":0;t.bytes===String?n.raw="":(n.raw=[],t.bytes!==Array&&(n.raw=Gc.newBuffer(n.raw)))}return null!=e.seq&&e.hasOwnProperty("seq")&&("number"==typeof e.seq?n.seq=t.longs===String?String(e.seq):e.seq:n.seq=t.longs===String?Gc.Long.prototype.toString.call(e.seq):t.longs===Number?new Gc.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),null!=e.raw&&e.hasOwnProperty("raw")&&(n.raw=t.bytes===String?Gc.base64.encode(e.raw,0,e.raw.length):t.bytes===Array?Array.prototype.slice.call(e.raw):e.raw),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e}(),e})(),Yc=sc.Reader,Xc=sc.Writer,Qc=sc.util,eu=sc.roots.default||(sc.roots.default={}),tu=eu.Peer=(()=>{function e(e){if(this.addresses=[],this.protocols=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.addresses=Qc.emptyArray,e.prototype.protocols=Qc.emptyArray,e.prototype.metadata=Qc.emptyArray,e.prototype.pubKey=null,e.prototype.peerRecordEnvelope=null,Object.defineProperty(e.prototype,"_pubKey",{get:Qc.oneOfGetter(t=["pubKey"]),set:Qc.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_peerRecordEnvelope",{get:Qc.oneOfGetter(t=["peerRecordEnvelope"]),set:Qc.oneOfSetter(t)}),e.encode=function(e,t){if(t||(t=Xc.create()),null!=e.addresses&&e.addresses.length)for(var n=0;n<e.addresses.length;++n)eu.Address.encode(e.addresses[n],t.uint32(10).fork()).ldelim();if(null!=e.protocols&&e.protocols.length)for(n=0;n<e.protocols.length;++n)t.uint32(18).string(e.protocols[n]);if(null!=e.metadata&&e.metadata.length)for(n=0;n<e.metadata.length;++n)eu.Metadata.encode(e.metadata[n],t.uint32(26).fork()).ldelim();return null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(34).bytes(e.pubKey),null!=e.peerRecordEnvelope&&Object.hasOwnProperty.call(e,"peerRecordEnvelope")&&t.uint32(42).bytes(e.peerRecordEnvelope),t},e.decode=function(e,t){e instanceof Yc||(e=Yc.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new eu.Peer;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.addresses&&r.addresses.length||(r.addresses=[]),r.addresses.push(eu.Address.decode(e,e.uint32()));break;case 2:r.protocols&&r.protocols.length||(r.protocols=[]),r.protocols.push(e.string());break;case 3:r.metadata&&r.metadata.length||(r.metadata=[]),r.metadata.push(eu.Metadata.decode(e,e.uint32()));break;case 4:r.pubKey=e.bytes();break;case 5:r.peerRecordEnvelope=e.bytes();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof eu.Peer)return e;var t=new eu.Peer;if(e.addresses){if(!Array.isArray(e.addresses))throw TypeError(".Peer.addresses: array expected");t.addresses=[];for(var n=0;n<e.addresses.length;++n){if("object"!=typeof e.addresses[n])throw TypeError(".Peer.addresses: object expected");t.addresses[n]=eu.Address.fromObject(e.addresses[n])}}if(e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Peer.protocols: array expected");t.protocols=[];for(n=0;n<e.protocols.length;++n)t.protocols[n]=String(e.protocols[n])}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".Peer.metadata: array expected");t.metadata=[];for(n=0;n<e.metadata.length;++n){if("object"!=typeof e.metadata[n])throw TypeError(".Peer.metadata: object expected");t.metadata[n]=eu.Metadata.fromObject(e.metadata[n])}}return null!=e.pubKey&&("string"==typeof e.pubKey?Qc.base64.decode(e.pubKey,t.pubKey=Qc.newBuffer(Qc.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.peerRecordEnvelope&&("string"==typeof e.peerRecordEnvelope?Qc.base64.decode(e.peerRecordEnvelope,t.peerRecordEnvelope=Qc.newBuffer(Qc.base64.length(e.peerRecordEnvelope)),0):e.peerRecordEnvelope.length&&(t.peerRecordEnvelope=e.peerRecordEnvelope)),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.addresses=[],n.protocols=[],n.metadata=[]),e.addresses&&e.addresses.length){n.addresses=[];for(var r=0;r<e.addresses.length;++r)n.addresses[r]=eu.Address.toObject(e.addresses[r],t)}if(e.protocols&&e.protocols.length){n.protocols=[];for(r=0;r<e.protocols.length;++r)n.protocols[r]=e.protocols[r]}if(e.metadata&&e.metadata.length){n.metadata=[];for(r=0;r<e.metadata.length;++r)n.metadata[r]=eu.Metadata.toObject(e.metadata[r],t)}return null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(n.pubKey=t.bytes===String?Qc.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey,t.oneofs&&(n._pubKey="pubKey")),null!=e.peerRecordEnvelope&&e.hasOwnProperty("peerRecordEnvelope")&&(n.peerRecordEnvelope=t.bytes===String?Qc.base64.encode(e.peerRecordEnvelope,0,e.peerRecordEnvelope.length):t.bytes===Array?Array.prototype.slice.call(e.peerRecordEnvelope):e.peerRecordEnvelope,t.oneofs&&(n._peerRecordEnvelope="peerRecordEnvelope")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e})(),nu=(eu.Address=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.multiaddr=Qc.newBuffer([]),e.prototype.isCertified=null,Object.defineProperty(e.prototype,"_isCertified",{get:Qc.oneOfGetter(t=["isCertified"]),set:Qc.oneOfSetter(t)}),e.encode=function(e,t){return t||(t=Xc.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),null!=e.isCertified&&Object.hasOwnProperty.call(e,"isCertified")&&t.uint32(16).bool(e.isCertified),t},e.decode=function(e,t){e instanceof Yc||(e=Yc.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new eu.Address;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.multiaddr=e.bytes();break;case 2:r.isCertified=e.bool();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof eu.Address)return e;var t=new eu.Address;return null!=e.multiaddr&&("string"==typeof e.multiaddr?Qc.base64.decode(e.multiaddr,t.multiaddr=Qc.newBuffer(Qc.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),null!=e.isCertified&&(t.isCertified=Boolean(e.isCertified)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.multiaddr="":(n.multiaddr=[],t.bytes!==Array&&(n.multiaddr=Qc.newBuffer(n.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(n.multiaddr=t.bytes===String?Qc.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),null!=e.isCertified&&e.hasOwnProperty("isCertified")&&(n.isCertified=e.isCertified,t.oneofs&&(n._isCertified="isCertified")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e})(),eu.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value=Qc.newBuffer([]),e.encode=function(e,t){return t||(t=Xc.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).bytes(e.value),t},e.decode=function(e,t){e instanceof Yc||(e=Yc.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new eu.Metadata;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.key=e.string();break;case 2:r.value=e.bytes();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof eu.Metadata)return e;var t=new eu.Metadata;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&("string"==typeof e.value?Qc.base64.decode(e.value,t.value=Qc.newBuffer(Qc.base64.length(e.value)),0):e.value.length&&(t.value=e.value)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.key="",t.bytes===String?n.value="":(n.value=[],t.bytes!==Array&&(n.value=Qc.newBuffer(n.value)))),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(n.value=t.bytes===String?Qc.base64.encode(e.value,0,e.value.length):t.bytes===Array?Array.prototype.slice.call(e.value):e.value),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e})(),sc.Reader),ru=sc.Writer,su=sc.util,iu=sc.roots.default||(sc.roots.default={}),ou=iu.Envelope=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.publicKey=su.newBuffer([]),e.prototype.payloadType=su.newBuffer([]),e.prototype.payload=su.newBuffer([]),e.prototype.signature=su.newBuffer([]),e.encode=function(e,t){return t||(t=ru.create()),null!=e.publicKey&&Object.hasOwnProperty.call(e,"publicKey")&&t.uint32(10).bytes(e.publicKey),null!=e.payloadType&&Object.hasOwnProperty.call(e,"payloadType")&&t.uint32(18).bytes(e.payloadType),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(26).bytes(e.payload),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),t},e.decode=function(e,t){e instanceof nu||(e=nu.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new iu.Envelope;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof iu.Envelope)return e;var t=new iu.Envelope;return null!=e.publicKey&&("string"==typeof e.publicKey?su.base64.decode(e.publicKey,t.publicKey=su.newBuffer(su.base64.length(e.publicKey)),0):e.publicKey.length&&(t.publicKey=e.publicKey)),null!=e.payloadType&&("string"==typeof e.payloadType?su.base64.decode(e.payloadType,t.payloadType=su.newBuffer(su.base64.length(e.payloadType)),0):e.payloadType.length&&(t.payloadType=e.payloadType)),null!=e.payload&&("string"==typeof e.payload?su.base64.decode(e.payload,t.payload=su.newBuffer(su.base64.length(e.payload)),0):e.payload.length&&(t.payload=e.payload)),null!=e.signature&&("string"==typeof e.signature?su.base64.decode(e.signature,t.signature=su.newBuffer(su.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.publicKey="":(n.publicKey=[],t.bytes!==Array&&(n.publicKey=su.newBuffer(n.publicKey))),t.bytes===String?n.payloadType="":(n.payloadType=[],t.bytes!==Array&&(n.payloadType=su.newBuffer(n.payloadType))),t.bytes===String?n.payload="":(n.payload=[],t.bytes!==Array&&(n.payload=su.newBuffer(n.payload))),t.bytes===String?n.signature="":(n.signature=[],t.bytes!==Array&&(n.signature=su.newBuffer(n.signature)))),null!=e.publicKey&&e.hasOwnProperty("publicKey")&&(n.publicKey=t.bytes===String?su.base64.encode(e.publicKey,0,e.publicKey.length):t.bytes===Array?Array.prototype.slice.call(e.publicKey):e.publicKey),null!=e.payloadType&&e.hasOwnProperty("payloadType")&&(n.payloadType=t.bytes===String?su.base64.encode(e.payloadType,0,e.payloadType.length):t.bytes===Array?Array.prototype.slice.call(e.payloadType):e.payloadType),null!=e.payload&&e.hasOwnProperty("payload")&&(n.payload=t.bytes===String?su.base64.encode(e.payload,0,e.payload.length):t.bytes===Array?Array.prototype.slice.call(e.payload):e.payload),null!=e.signature&&e.hasOwnProperty("signature")&&(n.signature=t.bytes===String?su.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e})(),au=sc.Reader,cu=sc.Writer,uu=sc.util,lu=sc.roots.default||(sc.roots.default={}),hu=lu.PeerRecord=(()=>{function e(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.peerId=uu.newBuffer([]),e.prototype.seq=uu.Long?uu.Long.fromBits(0,0,!0):0,e.prototype.addresses=uu.emptyArray,e.encode=function(e,t){if(t||(t=cu.create()),null!=e.peerId&&Object.hasOwnProperty.call(e,"peerId")&&t.uint32(10).bytes(e.peerId),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.addresses&&e.addresses.length)for(var n=0;n<e.addresses.length;++n)lu.PeerRecord.AddressInfo.encode(e.addresses[n],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof au||(e=au.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new lu.PeerRecord;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.peerId=e.bytes();break;case 2:r.seq=e.uint64();break;case 3:r.addresses&&r.addresses.length||(r.addresses=[]),r.addresses.push(lu.PeerRecord.AddressInfo.decode(e,e.uint32()));break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof lu.PeerRecord)return e;var t=new lu.PeerRecord;if(null!=e.peerId&&("string"==typeof e.peerId?uu.base64.decode(e.peerId,t.peerId=uu.newBuffer(uu.base64.length(e.peerId)),0):e.peerId.length&&(t.peerId=e.peerId)),null!=e.seq&&(uu.Long?(t.seq=uu.Long.fromValue(e.seq)).unsigned=!0:"string"==typeof e.seq?t.seq=parseInt(e.seq,10):"number"==typeof e.seq?t.seq=e.seq:"object"==typeof e.seq&&(t.seq=new uu.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),e.addresses){if(!Array.isArray(e.addresses))throw TypeError(".PeerRecord.addresses: array expected");t.addresses=[];for(var n=0;n<e.addresses.length;++n){if("object"!=typeof e.addresses[n])throw TypeError(".PeerRecord.addresses: object expected");t.addresses[n]=lu.PeerRecord.AddressInfo.fromObject(e.addresses[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.addresses=[]),t.defaults)if(t.bytes===String?n.peerId="":(n.peerId=[],t.bytes!==Array&&(n.peerId=uu.newBuffer(n.peerId))),uu.Long){var r=new uu.Long(0,0,!0);n.seq=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.seq=t.longs===String?"0":0;if(null!=e.peerId&&e.hasOwnProperty("peerId")&&(n.peerId=t.bytes===String?uu.base64.encode(e.peerId,0,e.peerId.length):t.bytes===Array?Array.prototype.slice.call(e.peerId):e.peerId),null!=e.seq&&e.hasOwnProperty("seq")&&("number"==typeof e.seq?n.seq=t.longs===String?String(e.seq):e.seq:n.seq=t.longs===String?uu.Long.prototype.toString.call(e.seq):t.longs===Number?new uu.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),e.addresses&&e.addresses.length){n.addresses=[];for(var s=0;s<e.addresses.length;++s)n.addresses[s]=lu.PeerRecord.AddressInfo.toObject(e.addresses[s],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e.AddressInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.multiaddr=uu.newBuffer([]),e.encode=function(e,t){return t||(t=cu.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),t},e.decode=function(e,t){e instanceof au||(e=au.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new lu.PeerRecord.AddressInfo;e.pos<n;){var s=e.uint32();if(s>>>3==1)r.multiaddr=e.bytes();else e.skipType(7&s)}return r},e.fromObject=function(e){if(e instanceof lu.PeerRecord.AddressInfo)return e;var t=new lu.PeerRecord.AddressInfo;return null!=e.multiaddr&&("string"==typeof e.multiaddr?uu.base64.decode(e.multiaddr,t.multiaddr=uu.newBuffer(uu.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.multiaddr="":(n.multiaddr=[],t.bytes!==Array&&(n.multiaddr=uu.newBuffer(n.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(n.multiaddr=t.bytes===String?uu.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,sc.util.toJSONOptions)},e}(),e})();sc.util.Long=void 0,sc.configure();const fu={version:12,description:"Store each peerstore peer under a single datastore key",migrate:async function(e,t=(()=>{})){t(0,"Storing each peerstore key under a single datastore key"),await e.datastore.open();const n={},r=[];for await(const{key:t,value:s}of e.datastore.query({prefix:"/peers"})){r.push(t);const e=t.toString(),[,i,o,a,c]=e.split("/");if("peers"===i&&(["protos","addrs","metadata","keys"].includes(o)&&a))if(n[a]=n[a]||{addresses:[],protocols:[],metadata:[]},"protos"===o){const e=Kc.decode(s);n[a].protocols=e.protocols.sort()}else if("addrs"===o){const e=Zc.decode(s);n[a].addresses=e.addrs.sort(((e,t)=>(0,F.HM)(e.multiaddr).toString().localeCompare((0,F.HM)(t.multiaddr).toString()))),e.certifiedRecord&&e.certifiedRecord.raw&&(n[a].peerRecordEnvelope=e.certifiedRecord.raw)}else"metadata"===o?n[a].metadata.push({key:c,value:s}):"keys"===o&&(n[a].pubKey=s)}t(33,"Read peer data from store");for(const t of r)await e.datastore.delete(t);t(66,"Removed existing peer data from store");for(const t of Object.keys(n)){const r=n[t];r.metadata=r.metadata.sort(((e,t)=>e.key.localeCompare(t.key)));const s=tu.encode(r).finish();await e.datastore.put(new ne.s(`/peers/${t}`),s)}await e.datastore.close(),t(100,"Stored each peerstore key under a single datastore key")},revert:async function(e,t=(()=>{})){t(0,"Storing each peerstore key under a multiple datastore keys"),await e.datastore.open();const n={},r=[];for await(const{key:t,value:s}of e.datastore.query({prefix:"/peers"})){r.push(t);const e=t.toString(),[,,i]=e.split("/");n[i]=tu.decode(s)}t(33,"Read peer data from store");for(const t of r)await e.datastore.delete(t);t(66,"Removed existing peer data from store");for(const[t,r]of Object.entries(n)){if(r.protocols&&r.protocols.length>0&&await e.datastore.put(new ne.s(`/peers/protos/${t}`),Kc.encode({protocols:r.protocols}).finish()),r.addresses&&r.addresses.length>0){const n=r.peerRecordEnvelope;let s;if(n){const e=ou.decode(n);s={raw:n,seq:hu.decode(e.payload).seq}}await e.datastore.put(new ne.s(`/peers/addrs/${t}`),Zc.encode({addrs:r.addresses,certifiedRecord:s}).finish())}if(r.metadata&&r.metadata.length>0)for(const{key:n,value:s}of r.metadata)await e.datastore.put(new ne.s(`/peers/metadata/${t}/${n}`),s);r.pubKey&&await e.datastore.put(new ne.s(`/peers/keys/${t}`),r.pubKey)}await e.datastore.close(),t(100,"Stored each peerstore key under multiple datastore keys")}},pu={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0};var du=[Object.assign({version:1},pu),Object.assign({version:2},pu),Object.assign({version:3},pu),Object.assign({version:4},pu),Object.assign({version:5},pu),Object.assign({version:6},pu),Object.assign({version:7},pu),rc,Ic,Mc,Uc,fu];class yu extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=yu.code,this.message=e}}yu.code="ERR_NON_REVERSIBLE_MIGRATION";class gu extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=gu.code,this.message=e}}gu.code="ERR_NOT_INITIALIZED_REPO";class mu extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=mu.code,this.message=e}}mu.code="ERR_REQUIRED_PARAMETER";class bu extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=bu.code,this.message=e}}bu.code="ERR_INVALID_VALUE";class wu extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=wu.code,this.message=e}}wu.code="ERR_MISSING_REPO_OPTIONS";const vu=Za("ipfs:repo:migrator:repo:init");async function Eu(e){if(!await async function(e){if(!e)throw new wu("Please pass repo options when trying to open a repo");const t=e.root;try{await t.open();const e=await t.has(Oc),n=await t.has(xc);return!(!e||!n)||(vu(`Version entry present: ${e}`),vu(`Config entry present: ${n}`),!1)}catch(e){return vu("While checking if repo is initialized error was thrown: "+e.message),!1}finally{if(void 0!==t)try{await t.close()}catch{}}}(e))throw new gu("Repo is not initialized!");const t=e.root;await t.open();try{return parseInt((0,K.B)(await t.get(Oc)))}finally{await t.close()}}async function _u(e,t){if(!t)throw new wu("Please pass repo options when trying to open a repo");const n=t.root;await n.open(),await n.put(Oc,(0,B.m)(String(e))),await n.close()}const ku=Za("ipfs:repo:migrator");async function Su(e,t,n,r,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??du;if(!e)throw new Au.RequiredParameterError("Path argument is required!");if(!n)throw new Au.RequiredParameterError("repoOptions argument is required!");if(!r)throw new Au.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(r)||r<=0)throw new Au.InvalidValueError("Version has to be positive integer!");t=Nc(t);const u=await Eu(t);if(u===r)return void ku("Nothing to migrate.");if(u>r)throw new Au.InvalidValueError(`Current repo's version (${u}) is higher then toVersion (${r}), you probably wanted to revert it?`);let l;Tu(c,u,r),a||i||(l=await n.repoLock.lock(e));try{for(const e of c){if(void 0!==r&&e.version>r)break;if(!(e.version<=u)){ku(`Migrating version ${e.version}`);try{if(!a){let n=()=>{};o&&(n=(t,n)=>o(e.version,t.toFixed(2),n)),await e.migrate(t,n)}}catch(n){const r=e.version-1;throw ku(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${r}`),await _u(r,t),new Error(`During migration to version ${e.version} exception was raised: ${n.stack||n.message||n}`)}ku(`Migrating to version ${e.version} finished`)}}a||await _u(r||function(e){return e=e||du,Array.isArray(e)&&0!==e.length?e[e.length-1].version:0}(c),t),ku("Repo successfully migrated",void 0!==r?`to version ${r}!`:"to latest version!")}finally{a||i||!l||await l.close()}}function Tu(e,t,n,r=!1){let s=0;for(const i of e){if(i.version>n)break;if(i.version>t){if(r&&!i.revert)throw new Au.NonReversibleMigrationError(`It is not possible to revert to version ${t} because migration version ${i.version} is not reversible. Cancelling reversion.`);s++}}if(s!==n-t)throw new Au.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${t} to ${n}`)}const Au=r;var Iu=n(79830);class xu extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=xu.code}}xu.code="ERR_LOCK_EXISTS";class Ou extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=Ou.code}}Ou.code="ERR_NOT_FOUND";class Pu extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=Pu.code}}Pu.code="ERR_INVALID_REPO_VERSION";const Ru="ERR_REPO_NOT_INITIALIZED";async function Nu(e,t,n){const r=await t(e);if(r)return r;const s=Cu(n);return!!s&&new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{t(Boolean(r.result))}}))}async function Du(e,t,n,r){if(await n(e))return t(e);const s=Cu(r);if(!s)throw new Ou;return new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{if(r.result)return t(r.result);n(new Ou)}}))}function Cu(e){let t=e;for(;t.db||t.child;)if(t=t.db||t.child,"level-js"===t.type||"Level"===t.constructor.name)return t}const Lu=Za("ipfs:repo:version"),Bu=new ne.s("version");const Mu=be.Z.default?be.Z.default:be.Z,ju=new ne.s("config");var zu=n(62794);const Uu=new ne.s("datastore_spec");const Fu=new ne.s("api");function $u(e){const t=H.k0.asCID(e);if(null==t)throw c(new Error("Not a valid cid"),"ERR_INVALID_CID");return t.multihash.code!==I.identity.code?{isIdentity:!1}:{isIdentity:!0,digest:t.multihash.digest}}const Hu=Za("ipfs:repo:lock:memory"),Vu="repo.lock",Ku={};const qu={lock:async function(e){const t=e+"/"+Vu;if(Hu("locking %s",t),!0===Ku[t])throw new xu(`Lock already being held for file: ${t}`);return Ku[t]=!0,{async close(){Ku[t]&&delete Ku[t]}}},locked:async function(e){const t=e+"/"+Vu;return Hu(`checking lock: ${t}`),Boolean(Ku[t])}};var Wu={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:qu},Gu={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}},Ju=n(11015);function Zu(e){const t=Ju.k0.asCID(e);if(null==t)throw c(new Error("Not a valid cid"),"ERR_INVALID_CID");const n=z.base32.encode(t.multihash.bytes);return new ne.s("/"+n.slice(1).toUpperCase(),!1)}function Yu(e){return U.Jx(z.base32.decode(`b${e.toString().toLowerCase().substring(1)}`))}const Xu=Za("ipfs:repo:utils:walk-dag");async function*Qu(e,t,n,r){try{const s=await t.get(e,r),i=await n(e.code),o=(0,ii.OV)({bytes:s,cid:e,codec:i});for(const[,e]of o.links())yield e,yield*Qu(e,t,n,r)}catch(t){throw Xu("Could not walk DAG for CID",e.toString(),t),t}}class el extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return"number"==typeof t.expiry&&t.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;if(!this.cache.has(t)){!1===this._deleteIfExpired(t,n)&&(yield e)}}for(const e of this.cache){const[t,n]=e;!1===this._deleteIfExpired(t,n)&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const r="number"==typeof n&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:r}):this._set(e,{value:t,expiry:r})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;!1===this._deleteIfExpired(t,n)&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;if(!this.cache.has(t)){!1===this._deleteIfExpired(t,n)&&(yield[t,n.value])}}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[r,s]=n;!1===this._deleteIfExpired(r,s)&&(yield[r,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[r,s]=n;if(!this.cache.has(r)){!1===this._deleteIfExpired(r,s)&&(yield[r,s.value])}}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,r]of this.entriesAscending())e.call(t,r,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class tl{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=Za("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);const n={depth:0};return 0!==e.version&&(n.version=e.version),e.code!==k.code&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(Zu(e),Ye.cv(n))}unpin(e,t){return this.pinstore.delete(Zu(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);const n={depth:1/0};0!==e.version&&(n.version=e.version),e.code!==k.code&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(Zu(e),Ye.cv(n))}async*directKeys(e){for await(const e of this.pinstore.query({filters:[e=>0===Ye.Jx(e.value).depth]})){const t=Ye.Jx(e.value),n=t.version||0,r=null!=t.codec?t.codec:k.code,s=Yu(e.key);yield{cid:H.k0.create(n,r,s),metadata:t.metadata}}}async*recursiveKeys(e){for await(const e of this.pinstore.query({filters:[e=>Ye.Jx(e.value).depth===1/0]})){const t=Ye.Jx(e.value),n=t.version||0,r=null!=t.codec?t.codec:k.code,s=Yu(e.key);yield{cid:H.k0.create(n,r,s),metadata:t.metadata}}}async*indirectKeys(e){for await(const{cid:t}of this.recursiveKeys())for await(const n of Qu(t,this.blockstore,this.loadCodec,e)){const e=[Oe.recursive];(await this.isPinnedWithType(n,e)).pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);const r=t.includes(Oe.all),s=t.includes(Oe.direct),i=t.includes(Oe.recursive),o=t.includes(Oe.indirect);if(i||s||r){const n=await(0,Ri.Z)(this.pinstore.query({prefix:Zu(e).toString(),filters:[e=>{if(r)return!0;const n=Ye.Jx(e.value);return t.includes(0===n.depth?Oe.direct:Oe.recursive)}],limit:1}));if(n){const t=Ye.Jx(n.value);return{cid:e,pinned:!0,reason:0===t.depth?Oe.direct:Oe.recursive,metadata:t.metadata}}}const a=this;if(r||o){const t=await(0,Ri.Z)(async function*(e,t){for await(const{cid:n}of t)for await(const t of Qu(n,a.blockstore,a.loadCodec))if(t.equals(e))return void(yield n)}(e,this.recursiveKeys()));if(t)return{cid:e,pinned:!0,reason:Oe.indirect,parent:t}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){const n=new el({maxSize:t.cidCacheMaxSize??2048}),r=async(e,t)=>{if(n.has(e.toString()))return;n.set(e.toString(),!0);const s=await this.blockstore.get(e,t),i=await this.loadCodec(e.code),o=(0,ii.OV)({bytes:s,cid:e,codec:i});await Promise.all([...o.links()].map((([,e])=>r(e,t))))};await r(e,t)}static checkPinType(e){if("string"!=typeof e||!Object.keys(Oe).includes(e))throw function(e){return c(new Error(`Invalid type '${e}', must be one of {direct, indirect, recursive, all}`),"ERR_INVALID_PIN_TYPE")}(e);return!0}}async function nl(e,t){const{pinned:n,reason:r}=await t.isPinnedWithType(e,Oe.all);if(n)throw c(new Error(`pinned: ${r}`),"ERR_BLOCK_PINNED")}var rl=n(52019);const sl=Za("ipfs:repo:gc"),il=(0,De.notFoundError)().code,ol=256,al=new ne.s("/local/filesroot");function cl({gcLock:e,pins:t,blockstore:n,root:r,loadCodec:s}){return async function*(){const i=Date.now();sl("Creating set of marked blocks");const o=await e.writeLock();try{const e=await async function({pins:e,blockstore:t,loadCodec:n,root:r}){const s=async function*(){let e;try{e=await r.get(al)}catch(e){if(e.code===il)return void sl("No blocks in MFS");throw e}const s=H.k0.decode(e);yield s,yield*Qu(s,t,n)}(),i=(0,rl.Z)((0,vn.Z)(e.recursiveKeys(),(({cid:e})=>e)),e.indirectKeys(),(0,vn.Z)(e.directKeys(),(({cid:e})=>e)),s),o=new Set;for await(const e of(0,rl.Z)(i,s))o.add(z.base32.encode(e.multihash.bytes));return o}({pins:t,blockstore:n,root:r,loadCodec:s}),o=n.queryKeys({});yield*async function*({blockstore:e},t,n){let r=0,s=0;const i=async n=>async function(){r++;try{const r=z.base32.encode(n.multihash.bytes);if(t.has(r))return null;try{await e.delete(n),s++}catch(e){return{err:new Error(`Could not delete block with CID ${n}: ${e.message}`)}}return{cid:n}}catch(e){const t=`Could delete block with CID ${n}`;return sl(t,e),{err:new Error(t+`: ${e.message}`)}}};yield*(0,_n.zG)(In((0,vn.Z)(n,i),ol),(e=>(0,En.Z)(e,Boolean))),sl(`Marked set has ${t.size} unique blocks. Blockstore has ${r} blocks. Deleted ${s} blocks.`)}({blockstore:n},e,o),sl(`Complete (${Date.now()-i}ms)`)}finally{o()}}}const ul=Za("ipfs:repo"),ll=Number.MAX_SAFE_INTEGER;class hl{constructor(e,t,n,r){if("string"!=typeof e)throw new Error("missing repo path");if("function"!=typeof t)throw new Error("missing codec loader");this.options=(0,i.Z)(Wu,r),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;const s=n.blocks,o=n.pins;this.pins=new tl({pinstore:o,blockstore:s,loadCodec:t});const a=(u=this.pins,l=s,{open:()=>l.open(),close:()=>l.close(),query:(e,t)=>l.query(e,t),queryKeys:(e,t)=>l.queryKeys(e,t),get:async(e,t)=>l.get(e,t),async*getMany(e,t){yield*l.getMany(e,t)},async put(e,t,n){await l.put(e,t,n)},async*putMany(e,t){yield*l.putMany(e,t)},has:(e,t)=>l.has(e,t),delete:async(e,t)=>(await nl(e,u),l.delete(e,t)),deleteMany:(e,t)=>l.deleteMany((0,vn.Z)(e,(async e=>(await nl(e,u),e))),t),batch:()=>l.batch()});var u,l;this.blocks=function(e){return{open:()=>e.open(),close:()=>e.close(),query:(t,n)=>e.query(t,n),queryKeys:(t,n)=>e.queryKeys(t,n),async get(t,n){const r=$u(t);return r.isIdentity?Promise.resolve(r.digest):e.get(t,n)},async*getMany(e,t){for await(const n of e)yield this.get(n,t)},async put(t,n,r){const{isIdentity:s}=$u(t);s||await e.put(t,n,r)},async*putMany(t,n){const r=(0,It.d)({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)((async()=>{try{await(0,xt.Z)(e.putMany(async function*(){for await(const{key:e,value:n}of t)$u(e).isIdentity||(yield{key:e,value:n}),r.push({key:e,value:n})}())),r.end()}catch(e){r.end(e)}})),yield*r},has(t,n){const{isIdentity:r}=$u(t);return r?Promise.resolve(!0):e.has(t,n)},delete(t,n){const{isIdentity:r}=$u(t);return r?Promise.resolve():e.delete(t,n)},deleteMany:(t,n)=>e.deleteMany((0,En.Z)(t,(e=>!$u(e).isIdentity)),n),batch(){const t=e.batch();return{put(e,n){const{isIdentity:r}=$u(e);r||t.put(e,n)},delete(e){const{isIdentity:n}=$u(e);n||t.delete(e)},commit:e=>t.commit(e)}}}}(a),this.version=function(e){return{exists:async()=>Nu(Bu,e.has.bind(e),e),async get(){const t=await Du(Bu,e.get.bind(e),e.has.bind(e),e);return parseInt((0,K.B)(t),10)},set:t=>e.put(Bu,(0,B.m)(String(t))),async check(e){const t=await this.get();return Lu("comparing version: %s and %s",t,e),t===e||6===t&&7===e||6===e&&7===t}}}(this.root),this.config=function(e){const t=new Mu({concurrency:1}),n={async getAll(t={}){const n=await Du(ju,e.get.bind(e),e.has.bind(e),e);return JSON.parse((0,K.B)(n))},async get(e,t={}){if(null==e)throw new Ou(`Key ${e} does not exist in config`);const n=await this.getAll(t),r=Ja(n,e);if(void 0===r)throw new Ou(`Key ${e} does not exist in config`);return r},set(e,n,s={}){if("string"!=typeof e&&!(e instanceof String))throw c(new Error("Invalid key type: "+typeof e),"ERR_INVALID_KEY");if(void 0===n||n instanceof Uint8Array)throw c(new Error("Invalid value type: "+typeof n),"ERR_INVALID_VALUE");return t.add((()=>r({key:e,value:n},s.signal)))},replace(e,n={}){if(!e||e instanceof Uint8Array)throw c(new Error("Invalid value type: "+typeof e),"ERR_INVALID_VALUE");return t.add((()=>r({key:void 0,value:e},n.signal)))},exists:async()=>Nu(ju,e.has.bind(e),e)};return n;async function r(e,t){if(t&&t.aborted)return;const r=e.key,i=e.value;if(r){const e=await n.getAll();return"object"==typeof e&&null!==e&&ei(e,r,i),s(e)}return s(i)}function s(t){const n=(0,B.m)(JSON.stringify(t,null,2));return e.put(ju,n)}}(this.root),this.spec=function(e){return{exists:()=>e.has(Uu),async get(){const t=await e.get(Uu);return JSON.parse((0,K.B)(t))},set:async t=>e.put(Uu,(0,B.m)(JSON.stringify((0,zu.Z)(t,{deep:!0}))))}}(this.root),this.apiAddr=function(e){return{async get(){const t=await e.get(Fu);return t&&t.toString()},set:t=>e.put(Fu,(0,B.m)(t.toString())),delete:()=>e.delete(Fu)}}(this.root),this.gcLock=(0,Ji.Z)({name:e,singleProcess:!1!==this.options.repoOwner}),this.gc=cl({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){var t;ul("initializing at: %s",this.path),await this._openRoot(),await this.config.replace((t=e,t.Datastore=Object.assign({},Gu,Ja(t,"datastore")),t)),await this.spec.set(function(e){const t={...Gu.Spec,...Ja(e,"Datastore.Spec")};return{type:t.type,mounts:t.mounts.map((e=>({mountpoint:e.mountpoint,type:e.child.type,path:e.child.path,shardFunc:e.child.shardFunc})))}}(e)),await this.version.set(Ka)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch(e){return!1}}async open(){if(!this.closed)throw c(new Error("repo is already open"),"ERR_REPO_ALREADY_OPEN");ul("opening at: %s",this.path);try{await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),ul("acquired repo.lock");if(!await this.version.check(Ka)){if(!await this._isAutoMigrationEnabled())throw new Pu("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");await this._migrate(Ka,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys})}ul("creating datastore"),await this.datastore.open(),ul("creating blocks"),await this.blocks.open(),ul("creating keystore"),await this.keys.open(),ul("creating pins"),await this.pins.pinstore.open(),this.closed=!1,ul("all opened")}catch(e){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(e){ul("error removing lock",e)}throw e}}async _openRoot(){try{await this.root.open()}catch(e){if("Already open"!==e.message)throw e}}async _openLock(){const e=await this.options.repoLock.lock(this.path);if("function"!=typeof e.close)throw c(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){let e;ul("init check");try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(e){if("ERR_NOT_FOUND"===e.code)throw c(new Error("repo is not initialized yet"),Ru,{path:this.path});throw e}if(!e)throw c(new Error("repo is not initialized yet"),Ru,{path:this.path})}async close(){if(this.closed)throw c(new Error("repo is already closed"),"ERR_REPO_ALREADY_CLOSED");ul("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(e){if(e.code!==Ru&&!e.message.startsWith("ENOENT"))throw e}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map((e=>e&&e.close()))),ul("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){const[e,t,n,r,s]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),fl(this.datastore),fl(this.keys)]),i=t.size+r+s;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:i}}throw c(new Error("repo is not initialized yet"),Ru,{path:this.path})}async _isAutoMigrationEnabled(){if(void 0!==this.options.autoMigrate)return this.options.autoMigrate;let e;try{e=await this.config.get("repoAutoMigrate")}catch(t){if(t.code!==Ou.code)throw t;e=!0}return e}async _migrate(e,t){return await this.version.get()>e?(ul(`reverting to version ${e}`),async function(e,t,n,r,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??du;if(!e)throw new Au.RequiredParameterError("Path argument is required!");if(!n)throw new Au.RequiredParameterError("repoOptions argument is required!");if(!r)throw new Au.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(r)||r<=0)throw new Au.InvalidValueError("Version has to be positive integer!");t=Nc(t);const u=await Eu(t);if(u===r)return void ku("Nothing to revert.");if(u<r)throw new Au.InvalidValueError(`Current repo's version (${u}) is lower then toVersion (${r}), you probably wanted to migrate it?`);let l;Tu(c,r,u,!0),a||i||(l=await n.repoLock.lock(e)),ku(`Reverting from version ${u} to ${r}`);try{const e=c.slice().reverse();for(const n of e){if(n.version<=r)break;if(!(n.version>u)){ku(`Reverting migration version ${n.version}`);try{if(!a){let e=()=>{};o&&(e=(e,t)=>o(n.version,e.toFixed(2),t)),await n.revert(t,e)}}catch(e){const r=n.version;throw ku(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${r}`),await _u(r,t),e.message=`During reversion to version ${n.version} exception was raised: ${e.message}`,e}ku(`Reverting to version ${n.version} finished`)}}a||await _u(r,t),ku(`All migrations successfully reverted to version ${r}!`)}finally{a||i||!l||await l.close()}}(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(ul(`migrating to version ${e}`),Su(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{const e=await this.config.get("Datastore.StorageMax");return BigInt(Iu(e))}catch(e){return BigInt(ll)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(const{key:n,value:r}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(r.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}}async function fl(e){let t=BigInt(0);for await(const n of e.query({}))t+=BigInt(n.value.byteLength),t+=BigInt(n.key.uint8Array().byteLength);return t}var pl=n(56635),dl=n(34751),yl=n(21301);class gl extends At.e{constructor(e,t={}){super(),this.db="string"==typeof e?new yl.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw De.dbOpenFailedError(e)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(e){throw De.dbWriteFailedError(e)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(e){if(e.notFound)throw De.notFoundError(e);throw De.dbWriteFailedError(e)}return t}async has(e){try{await this.db.get(e.toString())}catch(e){if(e.notFound)return!1;throw e}return!0}async delete(e){try{await this.db.del(e.toString())}catch(e){throw De.dbDeleteFailedError(e)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,En.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,dl.Z)(e,t)),t));const{offset:n,limit:r}=e;if(n){let e=0;t=(0,En.Z)(t,(()=>e++>=n))}return r&&(t=(0,pl.Z)(t,r)),t}queryKeys(e){let t=(0,vn.Z)(this._query({values:!1,prefix:e.prefix}),(({key:e})=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>(0,En.Z)(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>(0,dl.Z)(e,t)),t));const{offset:n,limit:r}=e;if(n){let e=0;t=(0,En.Z)(t,(()=>e++>=n))}return r&&(t=(0,pl.Z)(t,r)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const n=e.prefix.toString();t.gte=n,t.lt=n+""}const n=this.db.iterator(t);if(n[Symbol.asyncIterator])return async function*(e){for await(const[t,n]of e)yield{key:new ne.s(t,!1),value:n};await e.close()}(n);if(null!=n.next&&null!=n.end)return r=n,{[Symbol.asyncIterator]:()=>({next:()=>new Promise(((e,t)=>{r.next(((n,s,i)=>n?t(n):null==s?r.end((n=>{if(n)return t(n);e({done:!0,value:void 0})})):void e({done:!1,value:{key:new ne.s(s,!1),value:i}})))})),return:()=>new Promise(((e,t)=>{r.end((n=>{if(n)return t(n);e({done:!0,value:void 0})}))}))})};var r;throw new Error("Level returned incompatible iterator")}}const ml=(e,t)=>async function*(){const n=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(e);yield*n.sort(t)}();class bl{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:r}of e)await this.put(n,r,t),yield{key:n,value:r}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(t,n){e.push({key:t,value:n})},delete(e){t.push(e)},commit:async n=>{await(0,xt.Z)(this.putMany(e,n)),e=[],await(0,xt.Z)(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(null!=e.prefix&&(n=(0,En.Z)(n,(t=>t.key.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>(0,En.Z)(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>ml(e,t)),n)),null!=e.offset){let t=0;n=(0,En.Z)(n,(()=>t++>=(e.offset||0)))}return null!=e.limit&&(n=(0,pl.Z)(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(null!=e.prefix&&(n=(0,En.Z)(n,(t=>t.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>(0,En.Z)(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>ml(e,t)),n)),null!=e.offset){let t=0;n=(0,En.Z)(n,(()=>t++>=e.offset))}return null!=e.limit&&(n=(0,pl.Z)(n,e.limit)),n}}function wl(e){const t=H.k0.asCID(e);if(!t)throw c(new Error("Not a valid cid"),"ERR_INVALID_CID");return new ne.s("/"+z.base32.encode(t.multihash.bytes).slice(1).toUpperCase(),!1)}function vl(e){return H.k0.createV1(Gn.code,U.Jx(z.base32.decode("b"+e.toString().slice(1).toLowerCase())))}function El(e){const t=e.substring(0,1);if("/"===t)return El(e.substring(1));let n,r;n="b"===t.toLowerCase()?e=>z.base32.decode(e.toLowerCase()).subarray(2):"c"===t.toLowerCase()?e=>z.base32pad.decode(e.toLowerCase()).subarray(2):"z"===t?e=>j.base58btc.decode(e).subarray(2):"Q"===t?e=>j.base58btc.decode("z"+e):e=>z.base32.decode("b"+e.toLowerCase()).subarray(2);for(let t=1;t<e.length;t++)try{r=n(e.substring(0,t))}catch(e){if("Unexpected end of data"!==e.message)throw e}let s="/C";return r&&(s=`/${z.base32.encode(r).slice(1,-1).toUpperCase()||"C"}`),s}class _l extends bl{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:n,value:r}of this.child.query(function(e){return{...e,prefix:e.prefix?El(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e({key:vl(t.key),value:t.value}))):void 0,orders:e.orders?e.orders.map((e=>(t,n)=>e({key:vl(t.key),value:t.value},{key:vl(n.key),value:n.value}))):void 0}}(e),t))yield{key:vl(n),value:r}}async*queryKeys(e,t){for await(const n of this.child.queryKeys(function(e){return{...e,prefix:e.prefix?El(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e(vl(t)))):void 0,orders:e.orders?e.orders.map((e=>(t,n)=>e(vl(t),vl(n)))):void 0}}(e),t))yield vl(n)}async get(e,t){return this.child.get(wl(e),t)}async*getMany(e,t){for await(const n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(wl(e),t,n)}async*putMany(e,t){const n=(0,It.d)({objectMode:!0});(globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout)((async()=>{try{const r=this.child;await(0,xt.Z)(this.child.putMany(async function*(){for await(const s of e){const e=wl(s.key);await r.has(e,t)||(yield{key:e,value:s.value}),n.push(s)}}())),n.end()}catch(e){n.end(e)}})),yield*n}has(e,t){return this.child.has(wl(e),t)}delete(e,t){return this.child.delete(wl(e),t)}deleteMany(e,t){const n=(0,It.d)({objectMode:!0});return(0,xt.Z)(this.child.deleteMany(async function*(){for await(const t of e)yield wl(t),n.push(t);n.end()}(),t)).catch((e=>{n.end(e)})),n}}function kl(e,t,n){const r=n.path||"ipfs";return function(e,t,n,r){return new hl(e,t,n,r)}(r,(e=>t.getCodec(e)),{root:new gl(r,{prefix:"",version:2}),blocks:new _l(new gl(`${r}/blocks`,{prefix:"",version:2})),datastore:new gl(`${r}/datastore`,{prefix:"",version:2}),keys:new gl(`${r}/keys`,{prefix:"",version:2}),pins:new gl(`${r}/pins`,{prefix:"",version:2})},{autoMigrate:n.autoMigrate,onMigrationProgress:n.onMigrationProgress||e,repoLock:qu})}var Sl=n(29666),Tl=n(55305),Al=n(46857);class Il{constructor(e,t,n){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=n;for(let e=0;e<t;e++)this.history[e]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:r}=e;return!this.msgs.has(r)&&(this.msgs.set(r,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(!n)return null;const r=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,r),{msg:n.message,count:r}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach((n=>{const r=this.msgs.get(n.msgIdStr);if(r&&r.validated&&e.has(n.topic)){let e=t.get(n.topic);e||(e=[],t.set(n.topic,e)),e.push(n.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:r}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:r}}shift(){this.history[this.history.length-1].forEach((e=>{const t=this.msgs.get(e.msgIdStr);t&&(this.msgs.delete(e.msgIdStr),t.validated||this.notValidatedCount--)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}var xl=n(64482);const{RPC:Ol}=xl,Pl="/floodsub/1.0.0",Rl="/meshsub/1.0.0",Nl="/meshsub/1.1.0",Dl=5e3;function Cl(e){if(e.length<=1)return e;for(let t=0;t<e.length;t++){const n=Math.floor(Math.random()*Math.floor(e.length)),r=e[t];e[t]=e[n],e[n]=r}return e}function Ll(e){return(0,K.B)(e,"base64")}var Bl,Ml,jl,zl,Ul,Fl=n(6834);function $l(e){switch(e){case Fl.Ct.Ignore:return jl.Ignore;case Fl.Ct.Reject:return jl.Reject}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(Bl||(Bl={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(Ml||(Ml={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(jl||(jl={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(zl||(zl={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(Ul||(Ul={}));const Hl="ERR_INVALID_PEER_SCORE_PARAMS",Vl={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},Kl={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function ql(e={}){return{...Vl,...e,topics:e.topics?Object.entries(e.topics).reduce(((e,[t,n])=>(e[t]=function(e={}){return{...Kl,...e}}(n),e)),{}):{}}}function Wl(e){if(e.topicWeight<0)throw new Ct.s("invalid topic weight; must be >= 0",Hl);if(0===e.timeInMeshQuantum)throw new Ct.s("invalid TimeInMeshQuantum; must be non zero",Hl);if(e.timeInMeshWeight<0)throw new Ct.s("invalid TimeInMeshWeight; must be positive (or 0 to disable)",Hl);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new Ct.s("invalid TimeInMeshQuantum; must be positive",Hl);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new Ct.s("invalid TimeInMeshCap; must be positive",Hl);if(e.firstMessageDeliveriesWeight<0)throw new Ct.s("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",Hl);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new Ct.s("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",Hl);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new Ct.s("invalid FirstMessageDeliveriesCap; must be positive",Hl);if(e.meshMessageDeliveriesWeight>0)throw new Ct.s("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",Hl);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new Ct.s("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",Hl);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new Ct.s("invalid MeshMessageDeliveriesCap; must be positive",Hl);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new Ct.s("invalid MeshMessageDeliveriesThreshold; must be positive",Hl);if(e.meshMessageDeliveriesWindow<0)throw new Ct.s("invalid MeshMessageDeliveriesWindow; must be non-negative",Hl);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new Ct.s("invalid MeshMessageDeliveriesActivation; must be at least 1s",Hl);if(e.meshFailurePenaltyWeight>0)throw new Ct.s("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",Hl);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new Ct.s("invalid MeshFailurePenaltyDecay; must be between 0 and 1",Hl);if(e.invalidMessageDeliveriesWeight>0)throw new Ct.s("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",Hl);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new Ct.s("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",Hl)}const Gl={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function Jl(e={}){return{...Gl,...e}}function Zl(e,t,n,r){let s=0;Object.entries(t.topics).forEach((([e,t])=>{const r=n.topics[e];if(void 0===r)return;let i=0;if(t.inMesh){let e=t.meshTime/r.timeInMeshQuantum;e>r.timeInMeshCap&&(e=r.timeInMeshCap),i+=e*r.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>r.firstMessageDeliveriesCap&&(o=r.firstMessageDeliveriesCap),i+=o*r.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r.meshMessageDeliveriesThreshold){const e=r.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;i+=e*e*r.meshMessageDeliveriesWeight}i+=t.meshFailurePenalty*r.meshFailurePenaltyWeight;i+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*r.invalidMessageDeliveriesWeight,s+=i*r.topicWeight})),n.topicScoreCap>0&&s>n.topicScoreCap&&(s=n.topicScoreCap);const i=n.appSpecificScore(e);if(s+=i*n.appSpecificWeight,t.knownIPs.forEach((e=>{if(n.IPColocationFactorWhitelist.has(e))return;const t=r.get(e),i=t?t.size:0;if(i>n.IPColocationFactorThreshold){const e=i-n.IPColocationFactorThreshold;s+=e*e*n.IPColocationFactorWeight}})),t.behaviourPenalty>n.behaviourPenaltyThreshold){const e=t.behaviourPenalty-n.behaviourPenaltyThreshold;s+=e*e*n.behaviourPenaltyWeight}return s}var Yl,Xl=n(45001);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(Yl||(Yl={}));class Ql{constructor(){this.records=new Map,this.queue=new Xl}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:Yl.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function eh(e,t,n=(()=>!0)){const r=new Set;if(t<=0)return r;for(const s of e){if(r.size>=t)break;n(s)&&(r.add(s),e.delete(s))}return r}class th extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}const nh=(0,a.kg)("libp2p:gossipsub:score");class rh{constructor(e,t,n){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new th((()=>new Set)),this.scoreCache=new Map,this.deliveryRecords=new Ql,function(e){for(const[t,n]of Object.entries(e.topics))try{Wl(n)}catch(e){throw new Ct.s(`invalid score parameters for topic ${t}: ${e.message}`,Hl)}if(e.topicScoreCap<0)throw new Ct.s("invalid topic score cap; must be positive (or 0 for no cap)",Hl);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new Ct.s("missing application specific score function",Hl);if(e.IPColocationFactorWeight>0)throw new Ct.s("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",Hl);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new Ct.s("invalid IPColocationFactorThreshold; must be at least 1",Hl);if(e.behaviourPenaltyWeight>0)throw new Ct.s("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",Hl);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new Ct.s("invalid BehaviourPenaltyDecay; must be between 0 and 1",Hl);if(e.decayInterval<1e3)throw new Ct.s("invalid DecayInterval; must be at least 1s",Hl);if(e.decayToZero<=0||e.decayToZero>=1)throw new Ct.s("invalid DecayToZero; must be between 0 and 1",Hl)}(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??Zl}get size(){return this.peerStats.size}start(){this._backgroundInterval?nh("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),nh("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),nh("stopped")):nh("Peer score already stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([e,t])=>[e,t])))}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((n,r)=>{n.connected?(Object.entries(n.topics).forEach((([n,r])=>{const s=this.params.topics[n];void 0!==s&&(r.firstMessageDeliveries*=s.firstMessageDeliveriesDecay,r.firstMessageDeliveries<t&&(r.firstMessageDeliveries=0),r.meshMessageDeliveries*=s.meshMessageDeliveriesDecay,r.meshMessageDeliveries<t&&(r.meshMessageDeliveries=0),r.meshFailurePenalty*=s.meshFailurePenaltyDecay,r.meshFailurePenalty<t&&(r.meshFailurePenalty=0),r.invalidMessageDeliveries*=s.invalidMessageDeliveriesDecay,r.invalidMessageDeliveries<t&&(r.invalidMessageDeliveries=0),r.inMesh&&(r.meshTime=e-r.graftTime,r.meshTime>s.meshMessageDeliveriesActivation&&(r.meshMessageDeliveriesActive=!0)))})),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)):e>n.expire&&(this.removeIPsForPeer(r,n.knownIPs),this.peerStats.delete(r),this.scoreCache.delete(r))}))}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const n=Date.now(),r=this.scoreCache.get(e);if(r&&r.cacheUntil>n)return r.score;this.metrics?.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),i=n+this.scoreCacheValidityMs;return r?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-r.score)),r.score=s,r.cacheUntil=i):this.scoreCache.set(e,{score:s,cacheUntil:i}),s}addPenalty(e,t,n){const r=this.peerStats.get(e);r&&(r.behaviourPenalty+=t,this.metrics?.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);n&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);n&&n.knownIPs.delete(t);const r=this.peerIPs.get(t);r&&(r.delete(e),0===r.size&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0)return this.removeIPsForPeer(e,t.knownIPs),void this.peerStats.delete(e);Object.entries(t.topics).forEach((([e,t])=>{t.firstMessageDeliveries=0;const n=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n){const e=n-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);if(e){const n=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<n){const t=n-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const r=this.deliveryRecords.ensureRecord(t),s=Date.now();r.status===Yl.unknown?(r.status=Yl.valid,r.validated=s,r.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,n)}))):nh("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-r.firstSeen,Yl[r.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,r){switch(r){case jl.Error:return void this.markInvalidMessageDelivery(e,n);case jl.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status===Yl.unknown){if(r===jl.Ignore)return s.status=Yl.ignored,void s.peers.clear();s.status=Yl.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach((e=>{this.markInvalidMessageDelivery(e,n)})),s.peers.clear()}else nh("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,Yl[s.status])}duplicateMessage(e,t,n){const r=this.deliveryRecords.ensureRecord(t);if(!r.peers.has(e))switch(r.status){case Yl.unknown:r.peers.add(e);break;case Yl.valid:r.peers.add(e),this.markDuplicateMessageDelivery(e,n,r.validated);break;case Yl.invalid:this.markInvalidMessageDelivery(e,n);case Yl.ignored:}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);if(e){let n=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(n,e.firstMessageDeliveries+1),e.inMesh&&(n=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(n,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){const r=this.peerStats.get(e);if(r){const e=void 0!==n?Date.now():0,s=this.getPtopicStats(r,t);if(s&&s.inMesh){const r=this.params.topics[t];if(void 0!==n){const s=e-n,i=s>r.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,s,i),i)return}const i=r.meshMessageDeliveriesCap;s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const t=this.peerIPs.get(n);t&&(t.delete(e),0===t.size&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return void 0!==n?n:void 0!==this.params.topics[t]?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}class sh{constructor(e,t,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=t[Math.floor(Math.random()*t.length)],r=this.msgIdToStrFn(n);let s=this.promises.get(r);s||(s=new Map,this.promises.set(r,s));const i=Date.now();s.has(e)||(s.set(e,i+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(r)||this.requestMsByMsg.set(r,i)))}getBrokenPromises(){const e=Date.now(),t=new Map;let n=0;return this.promises.forEach(((r,s)=>{r.forEach(((s,i)=>{s<e&&(t.set(i,(t.get(i)??0)+1),r.delete(i),n++)})),r.size||this.promises.delete(s)})),this.metrics?.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);const n=this.promises.get(e);n&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){this.trackMessage(e),t!==jl.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[n,r]of this.requestMsByMsg.entries()){if(!(r<e))break;this.requestMsByMsg.delete(n),t++}this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}class ih{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries()){if(!(n.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var oh,ah,ch,uh,lh,hh;!function(e){e.forward="forward",e.publish="publish"}(oh||(oh={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(ah||(ah={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Unsub="unsubscribed",e.Excess="excess"}(ch||(ch={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(uh||(uh={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(lh||(lh={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(hh||(hh={}));var fh=n(79944);const ph=(0,B.m)("libp2p-pubsub:");var dh=n(86257);function yh(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return(0,dh.Pc)(e.from.toBytes(),e.sequenceNumber)}async function gh(e){return await xn.sha256.encode(e.data)}function mh(e,t,n,r,s){let i=0;const o=new Map;if(Object.entries(t.topics).forEach((([e,t])=>{const r=s.get(e)??"unknown",a=n.topics[e];if(void 0===a)return;let c=o.get(r);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(r,c));let u=0,l=0,h=0,f=0,p=0;if(t.inMesh){u+=Math.max(t.meshTime/a.timeInMeshQuantum,a.timeInMeshCap)*a.timeInMeshWeight}let d=t.firstMessageDeliveries;if(d>a.firstMessageDeliveriesCap&&(d=a.firstMessageDeliveriesCap),l+=d*a.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const e=a.meshMessageDeliveriesThreshold-t.meshMessageDeliveries;h+=e*e*a.meshMessageDeliveriesWeight}f+=t.meshFailurePenalty*a.meshFailurePenaltyWeight;p+=t.invalidMessageDeliveries*t.invalidMessageDeliveries*a.invalidMessageDeliveriesWeight,i+=(u+l+h+f+p)*a.topicWeight,c.p1w+=u,c.p2w+=l,c.p3w+=h,c.p3bw+=f,c.p4w+=p})),n.topicScoreCap>0&&i>n.topicScoreCap){i=n.topicScoreCap;const e=n.topicScoreCap/i;for(const t of o.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,c=0,u=0;a+=n.appSpecificScore(e)*n.appSpecificWeight,t.knownIPs.forEach((e=>{if(n.IPColocationFactorWhitelist.has(e))return;const t=r.get(e),s=t?t.size:0;if(s>n.IPColocationFactorThreshold){const e=s-n.IPColocationFactorThreshold;c+=e*e*n.IPColocationFactorWeight}}));return u+=t.behaviourPenalty*t.behaviourPenalty*n.behaviourPenaltyWeight,i+=a+c+u,{byTopic:o,p5w:a,p6w:c,p7w:u,score:i}}var bh=n(2237),wh=n(55150);class vh{constructor(e,t,n){this.rawStream=e,this.pushable=(0,It.d)({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,(0,_n.zG)((0,bh.wJ)(this.pushable,this.closeController.signal,{returnOnAbort:!0}),(0,wh.c)(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class Eh{constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=(0,bh.wJ)((0,_n.zG)(this.rawStream,(0,wh.J)(t)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var _h=n(62100);const kh={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function Sh(e,t){t={...t};const n=_h.Reader.create(e),r=e.length,s=void 0===r?n.len:n.pos+r,i={};for(;n.pos<s;){const e=n.uint32();switch(e>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.length<t.maxSubscriptions?i.subscriptions.push(Th(n,n.uint32())):n.skipType(7&e);break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.length<t.maxMessages?i.messages.push(Ah(n,n.uint32())):n.skipType(7&e);break;case 3:i.control=Ih(n,n.uint32(),t);break;default:n.skipType(7&e)}}return i}function Th(e,t){const n=void 0===t?e.len:e.pos+t,r={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.subscribe=e.bool();break;case 2:r.topic=e.string();break;default:e.skipType(7&t)}}return r}function Ah(e,t){const n=void 0===t?e.len:e.pos+t,r={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.from=e.bytes();break;case 2:r.data=e.bytes();break;case 3:r.seqno=e.bytes();break;case 4:r.topic=e.string();break;case 5:r.signature=e.bytes();break;case 6:r.key=e.bytes();break;default:e.skipType(7&t)}}if(!r.topic)throw Error("missing required 'topic'");return r}function Ih(e,t,n){const r=void 0===t?e.len:e.pos+t,s={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.length<n.maxControlMessages?s.ihave.push(xh(e,e.uint32(),n)):e.skipType(7&t);break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.length<n.maxControlMessages?s.iwant.push(Oh(e,e.uint32(),n)):e.skipType(7&t);break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.length<n.maxControlMessages?s.graft.push(Ph(e,e.uint32())):e.skipType(7&t);break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.length<n.maxControlMessages?s.prune.push(Rh(e,e.uint32(),n)):e.skipType(7&t);break;default:e.skipType(7&t)}}return s}function xh(e,t,n){const r=void 0===t?e.len:e.pos+t,s={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:s.topicID=e.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),n.maxIhaveMessageIDs-- >0?s.messageIDs.push(e.bytes()):e.skipType(7&t);break;default:e.skipType(7&t)}}return s}function Oh(e,t,n){const r=void 0===t?e.len:e.pos+t,s={};for(;e.pos<r;){const t=e.uint32();if(t>>>3==1)s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),n.maxIwantMessageIDs-- >0?s.messageIDs.push(e.bytes()):e.skipType(7&t);else e.skipType(7&t)}return s}function Ph(e,t){const n=void 0===t?e.len:e.pos+t,r={};for(;e.pos<n;){const t=e.uint32();if(t>>>3==1)r.topicID=e.string();else e.skipType(7&t)}return r}function Rh(e,t,n){const r=void 0===t?e.len:e.pos+t,s={};for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:s.topicID=e.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),n.maxPeerInfos-- >0?s.peers.push(Nh(e,e.uint32())):e.skipType(7&t);break;case 3:s.backoff=e.uint64();break;default:e.skipType(7&t)}}return s}function Nh(e,t){const n=void 0===t?e.len:e.pos+t,r={};for(;e.pos<n;){const t=e.uint32();switch(t>>>3){case 1:r.peerID=e.bytes();break;case 2:r.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return r}var Dh,Ch=n(72835);!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(Dh||(Dh={}));var Lh;!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(Lh||(Lh={}));class Bh extends Al.v{constructor(e,t={}){super(),this.multicodecs=[Nl,Rl],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=(0,It.d)({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:Lh.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{const e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=e&&e(),this.status.code===Lh.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}}))};const n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:ql(t.scoreParams),scoreThresholds:Jl(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??kh,this.globalSignaturePolicy=n.globalSignaturePolicy??Fl.xq,n.fallbackToFloodsub&&this.multicodecs.push(Pl),this.log=(0,a.kg)(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map((e=>e.id.toString()))),this.seenCache=new ih({validityMs:n.seenTTL}),this.publishedMessageIds=new ih({validityMs:n.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Fl.xq:this.msgIdFn=yh;break;case Fl.Q_:this.msgIdFn=gh}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new ih({validityMs:n.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??Ll,this.mcache=t.messageCache||new Il(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const e=Math.max(...Object.values(n.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),1e3),r=function(e,t,n){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:e.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:e.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:e.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:e.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*n.maxMeshMessageDeliveriesWindowSec,.5*n.maxMeshMessageDeliveriesWindowSec,1*n.maxMeshMessageDeliveriesWindowSec,2*n.maxMeshMessageDeliveriesWindowSec,4*n.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*n.behaviourPenaltyThreshold,.5*n.behaviourPenaltyThreshold,1*n.behaviourPenaltyThreshold,2*n.behaviourPenaltyThreshold,4*n.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*n.gossipPromiseExpireSec,1*n.gossipPromiseExpireSec,2*n.gossipPromiseExpireSec,4*n.gossipPromiseExpireSec]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,n){const r=this.toTopic(e);this.meshPeerInclusionEvents.inc({topic:r,reason:t},n)},onRemoveFromMesh(e,t,n){const r=this.toTopic(e);this.meshPeerChurnEvents.inc({topic:r,reason:t},n)},onReportValidationMcacheHit(e){this.asyncValidationMcacheHit.inc({hit:e?"hit":"miss"})},onReportValidation(e,t){const n=this.toTopic(e);this.asyncValidationResult.inc({topic:n,acceptance:t})},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,n){const r=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:r},t),this.ihaveRcvNotSeenMsgids.inc({topic:r},n)},onIwantRcv(e,t){for(const[t,n]of e){const e=this.toTopic(t);this.iwantRcvMsgids.inc({topic:e},n)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const n=this.toTopic(e);this.msgForwardCount.inc({topic:n},1),this.msgForwardPeers.inc({topic:n},t)},onPublishMsg(e,t,n,r){const s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},n*r),this.msgPublishPeers.inc({topic:s},n),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"direct"},t.direct),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"floodsub"},t.floodsub),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"mesh"},t.mesh),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"fanout"},t.fanout)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvResult(e,t){const n=this.toTopic(e);this.msgReceivedStatus.inc({topic:n,status:t})},onMsgRecvInvalid(e,t){const n=this.toTopic(e),r=t.reason===jl.Error?t.error:t.reason;this.msgReceivedInvalid.inc({topic:n,error:r},1)},onDuplicateMsgDelivery(e,t,n){if(this.duplicateMsgDeliveryDelay.observe(t/1e3),n){const t=this.toTopic(e);this.duplicateMsgLateDelivery.inc({topic:t},1)}},onPublishDuplicateMsg(e){const t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),e.messages&&this.rpcRecvMessage.inc(e.messages.length),e.control&&(this.rpcRecvControl.inc(1),e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),e.messages&&this.rpcSentMessage.inc(e.messages.length),e.control){const t=e.control.ihave?.length??0,n=e.control.iwant?.length??0,r=e.control.graft?.length??0,s=e.control.prune?.length??0;t>0&&this.rpcSentIHave.inc(t),n>0&&this.rpcSentIWant.inc(n),r>0&&this.rpcSentGraft.inc(r),s>0&&this.rpcSentPrune.inc(s),(t>0||n>0||r>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let n=0,r=0,s=0,i=0;for(const o of e)o>=t.graylistThreshold&&n++,o>=t.publishThreshold&&r++,o>=t.gossipThreshold&&s++,o>=0&&i++;this.peersByScoreThreshold.set({threshold:hh.graylist},n),this.peersByScoreThreshold.set({threshold:hh.publish},r),this.peersByScoreThreshold.set({threshold:hh.gossip},s),this.peersByScoreThreshold.set({threshold:hh.mesh},i),this.score.set(e)},registerScoreWeights(e){for(const[t,n]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},n.p1w),this.scoreWeights.set({topic:t,p:"p2"},n.p2w),this.scoreWeights.set({topic:t,p:"p3"},n.p3w),this.scoreWeights.set({topic:t,p:"p3b"},n.p3bw),this.scoreWeights.set({topic:t,p:"p4"},n.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const n=new Map;e.forEach(((e,t)=>{const r=this.topicStrToLabel.get(t)??"unknown";let s=n.get(r);s||(s=new Set,n.set(r,s)),e.forEach((e=>s?.add(e)))}));for(const[e,r]of n){const n=[];r.forEach((e=>{n.push(t.get(e)??0)})),this.scorePerMesh.set({topic:e},n)}}}}(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});r.mcacheSize.addCollect((()=>this.onScrapeMetrics(r)));for(const e of this.multicodecs)r.protocolsEnabled.set({protocol:e},1);this.metrics=r}else this.metrics=null;this.gossipTracer=new sh(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new rh(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=n.allowedTopics?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map((e=>(0,Te.jE)(e)))}isStarted(){return this.status.code===Lh.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await async function(e,t){switch(e){case Fl.xq:{if(!t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await(0,Be.unmarshalPrivateKey)(t.privateKey);return{type:Ml.Signing,author:t,key:t.publicKey,privateKey:e}}case Fl.Q_:return{type:Ml.Anonymous};default:throw new Error(`Unknown signature policy "${e}"`)}}(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=(0,It.d)({objectMode:!0}),(0,_n.zG)(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:n}of e)await this.createOutboundStream(t,n)})).catch((e=>this.log.error("outbound inflight queue error",e))),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.peerStore.addressBook.add(e.id,e.addrs)})));const e=this.components.registrar;await Promise.all(this.multicodecs.map((t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const t=(0,Tl.a)({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map((n=>e.register(n,t)))),r=setTimeout(this.runHeartbeat,100);this.status={code:Lh.started,registrarTopologyIds:n,heartbeatTimeout:r,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>await this.connect(e))))})).catch((e=>{this.log(e)}))}),1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Lh.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:Lh.stopped};const t=this.components.registrar;e.forEach((e=>t.unregister(e))),this.outboundInflightQueue.end();for(const e of this.streamsOutbound.values())e.close();this.streamsOutbound.clear();for(const e of this.streamsInbound.values())e.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const n=t.remotePeer;this.addPeer(n,t.stat.direction,t.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.stat.status}),this.isStarted()&&"OPEN"===t.stat.status&&(this.addPeer(e,t.stat.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{const r=new vh(await t.newStream(this.multicodecs),(e=>this.log.error("outbound pipe error",e)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,r);const s=r.protocol;s===Pl&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(e){this.log.error("createOutboundStream error",e)}}async createInboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(!this.peers.has(n))return;const r=this.streamsInbound.get(n);void 0!==r&&(this.log("replacing existing inbound steam %s",n),r.close()),this.log("create inbound stream %s",n);const s=new Eh(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,s),this.pipePeerReadStream(e,s.source).catch((e=>this.log(e)))}addPeer(e,t,n){const r=e.toString();if(!this.peers.has(r)){this.log("new peer %p",e),this.peers.add(r),this.score.addPeer(r);const s=function(e){for(const t of e.tuples())switch(t[0]){case Dh.ip4:case Dh.ip6:return(0,Ch.xV)(t[0],t[1])}return null}(n);null!==s?this.score.addIP(r,s):this.log("Added peer has no IP in current address %s %s",r,n.toString()),this.outbound.has(r)||this.outbound.set(r,"outbound"===t)}}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const n=this.streamsOutbound.get(t),r=this.streamsInbound.get(t);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),r?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const e of this.topics.values())e.delete(t);for(const[e,n]of this.mesh)!0===n.delete(t)&&this.metrics?.onRemoveFromMesh(e,ch.Dc,1);for(const e of this.fanout.values())e.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===Lh.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map((e=>(0,Te.jE)(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await(0,_n.zG)(t,(async t=>{for await(const n of t)try{const t=n.subarray(),r=Sh(t,this.decodeRpcLimits);this.metrics?.onRpcRecv(r,t.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,r):this.handleReceivedRpc(e,r).catch((e=>this.log(e)))}catch(e){this.log(e)}}))}catch(t){this.handlePeerReadStreamError(t,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void this.metrics?.rpcRecvNotAccepted.inc();if(this.log("rpc from %p",e),t.subscriptions&&t.subscriptions.length>0){const n=[];t.subscriptions.forEach((t=>{const r=t.topic,s=!0===t.subscribe;if(null!=r){if(this.allowedTopics&&!this.allowedTopics.has(r))return;this.handleReceivedSubscription(e,r,s),n.push({topic:r,subscribe:s})}})),this.dispatchEvent(new Al.A("subscription-change",{detail:{peerId:e,subscriptions:n}}))}if(t.messages)for(const n of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(n.topic))continue;const t=this.handleReceivedMessage(e,n).catch((e=>this.log(e)));this.opts.awaitRpcMessageHandler&&await t}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,n){this.log("subscription update from %p topic %s",e,t);let r=this.topics.get(t);null==r&&(r=new Set,this.topics.set(t,r)),n?r.add(e.toString()):r.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const n=await this.validateReceivedMessage(e,t);switch(this.metrics?.onMsgRecvResult(t.topic,n.code),n.code){case Ul.duplicate:return this.score.duplicateMessage(e.toString(),n.msgIdStr,t.topic),this.gossipTracer.deliverMessage(n.msgIdStr,!0),void this.mcache.observeDuplicate(n.msgIdStr,e.toString());case Ul.invalid:if(n.msgIdStr){const r=n.msgIdStr;this.score.rejectMessage(e.toString(),r,t.topic,n.reason),this.gossipTracer.rejectMessage(r,n.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void this.metrics?.onMsgRecvInvalid(t.topic,n);case Ul.valid:if(this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)){this.components.peerId.equals(e)&&!this.opts.emitSelf||(super.dispatchEvent(new Al.A("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new Al.A("message",{detail:n.msg})))}this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const n=this.fastMsgIdFn?.(t),r=void 0!==n?this.fastMsgIdCache?.get(n):void 0;if(r)return{code:Ul.duplicate,msgIdStr:r};const s=await async function(e,t){switch(e){case Fl.Q_:return null!=t.signature?{valid:!1,error:zl.SignaturePresent}:null!=t.seqno?{valid:!1,error:zl.SeqnoPresent}:null!=t.key?{valid:!1,error:zl.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case Fl.xq:{if(null==t.seqno)return{valid:!1,error:zl.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:zl.InvalidSeqno};if(null==t.signature)return{valid:!1,error:zl.InvalidSignature};if(null==t.from)return{valid:!1,error:zl.InvalidPeerId};let e,n;try{e=(0,Te.cv)(t.from)}catch(e){return{valid:!1,error:zl.InvalidPeerId}}if(t.key){if(n=(0,Be.unmarshalPublicKey)(t.key),void 0!==e.publicKey&&!(0,Ce.f)(n.bytes,e.publicKey))return{valid:!1,error:zl.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:zl.InvalidPeerId};n=(0,Be.unmarshalPublicKey)(e.publicKey)}const r={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},s=(0,Ze.z)([ph,Ol.Message.encode(r).finish()]);return await n.verify(s,t.signature)?{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${(0,K.B)(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:t.key??(0,Be.marshalPublicKey)(n)}}:{valid:!1,error:zl.InvalidSignature}}}}(this.globalSignaturePolicy,t);if(!s.valid)return{code:Ul.invalid,reason:jl.Error,error:s.error};const i=s.message;try{this.dataTransform&&(i.data=this.dataTransform.inboundTransform(t.topic,i.data))}catch(e){return this.log("Invalid message, transform failed",e),{code:Ul.invalid,reason:jl.Error,error:zl.TransformFailed}}const o=await this.msgIdFn(i),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(void 0!==n&&this.fastMsgIdCache){this.fastMsgIdCache.put(n,a)&&this.metrics?.fastMsgIdCacheCollision.inc()}if(this.seenCache.has(a))return{code:Ul.duplicate,msgIdStr:a};this.seenCache.put(a);const u=this.topicValidators.get(t.topic);if(null!=u){let t;try{t=await u(e,i)}catch(e){const n=e.code;"ERR_TOPIC_VALIDATOR_IGNORE"===n&&(t=Fl.Ct.Ignore),t="ERR_TOPIC_VALIDATOR_REJECT"===n?Fl.Ct.Reject:Fl.Ct.Ignore}if(t!==Fl.Ct.Accept)return{code:Ul.invalid,reason:$l(t),msgIdStr:a}}return{code:Ul.valid,messageId:c,msg:i}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:n})))})}async handleControlMessage(e,t){if(void 0===t)return;const n=t.ihave?this.handleIHave(e,t.ihave):[],r=t.iwant?this.handleIWant(e,t.iwant):[],s=t.graft?await this.handleGraft(e,t.graft):[];t.prune&&await this.handlePrune(e,t.prune),(n.length||r.length||s.length)&&this.sendRpc(e,{messages:r,control:{iwant:n,prune:s}})}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;const r=this.score.score(e);return r>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),r>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:lh.LowScore}),[];const r=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,r),r>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:lh.MaxIhave}),[];const s=this.iasked.get(e)??0;if(s>=Dl)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:lh.MaxIasked}),[];const i=new Map;if(t.forEach((({topicID:e,messageIDs:t})=>{if(!e||!t||!this.mesh.has(e))return;let n=0;t.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(i.set(t,e),n++)})),this.metrics?.onIhaveRcv(e,t.length,n)})),!i.size)return[];let o=i.size;o+s>Dl&&(o=Dl-s),this.log("IHAVE: Asking for %d out of %d messages from %s",o,i.size,e);let a=Array.from(i.values());return Cl(a),a=a.slice(0,o),this.iasked.set(e,s+o),this.gossipTracer.addPromise(e,a),[{messageIDs:a}]}handleIWant(e,t){if(!t.length)return[];const n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];const r=new Map,s=new Map;let i=0;return t.forEach((({messageIDs:t})=>{t&&t.forEach((t=>{const n=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(n,e);null!=o?(s.set(o.msg.topic,1+(s.get(o.msg.topic)??0)),o.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):r.set(n,o.msg)):i++}))})),this.metrics?.onIwantRcv(s,i),r.size?(this.log("IWANT: Sending %d messages to %s",r.size,e),Array.from(r.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const n=[],r=this.score.score(e),s=Date.now();let i=this.opts.doPX;return t.forEach((({topicID:t})=>{if(!t)return;const o=this.mesh.get(t);if(!o)return void(i=!1);if(o.has(e))return;if(this.direct.has(e))return this.log("GRAFT: ignoring request from direct peer %s",e),n.push(t),void(i=!1);const a=this.backoff.get(t)?.get(e);if("number"==typeof a&&s<a){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,uh.GraftBackoff),i=!1;const r=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return s<r&&this.score.addPenalty(e,1,uh.GraftBackoff),this.addBackoff(e,t),void n.push(t)}return r<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,r,t),n.push(t),i=!1,void this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(n.push(t),void this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),void this.metrics?.onAddToMesh(t,ah.Subscribed,1))})),n.length?await Promise.all(n.map((t=>this.makePrune(e,t,i)))):[]}async handlePrune(e,t){const n=this.score.score(e);for(const{topicID:r,backoff:s,peers:i}of t){if(null==r)continue;const t=this.mesh.get(r);if(!t)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,r),this.score.prune(e,r),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(r,ch.Unsub,1)),"number"==typeof s&&s>0?this.doAddBackoff(e,r,1e3*s):this.addBackoff(e,r),i&&i.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,r);continue}await this.pxConnect(i)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){let r=this.backoff.get(t);r||(r=new Map,this.backoff.set(t,r));const s=Date.now()+n;(r.get(e)??0)<s&&r.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,uh.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!=0)return;const e=Date.now();this.backoff.forEach(((t,n)=>{t.forEach(((n,r)=>{n<e&&t.delete(r)})),0===t.size&&this.backoff.delete(n)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>await this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&(Cl(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(!e.peerID)return;const n=(0,Te.cv)(e.peerID).toString();if(!this.peers.has(n))if(e.signedPeerRecord)try{const r=await Sl.X.openAndCertify(e.signedPeerRecord,"libp2p-peer-record"),s=r.peerId;if(!r.peerId.equals(n))return void this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",s,n);if(!await this.components.peerStore.addressBook.consumePeerRecord(r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(n)}catch(e){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(n)}))),t.length&&await Promise.all(t.map((async e=>await this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=(0,Te.jE)(e),n=await this.components.connectionManager.openConnection(t);for(const e of this.multicodecs)for(const r of this.components.registrar.getTopologies(e))r.onConnect(t,n)}subscribe(e){if(this.status.code!==Lh.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Lh.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!1);this.leave(e)}join(e){if(this.status.code!==Lh.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach((e=>{!this.direct.has(e)&&this.score.score(e)>=0&&t.add(e)})),this.metrics?.onAddToMesh(e,ah.Fanout,t.size)),t.size<this.opts.D){const n=t.size;this.getRandomGossipPeers(e,this.opts.D,(e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0)).forEach((e=>{t.add(e)})),this.metrics?.onAddToMesh(e,ah.Random,t.size-n)}this.mesh.set(e,t),t.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}leave(e){if(this.status.code!==Lh.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map((async t=>(this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e))))).catch((e=>{this.log("Error sending prunes to mesh peers",e)})),this.mesh.delete(e))}selectPeersToForward(e,t,n){const r=new Set,s=this.topics.get(e);s&&(this.direct.forEach((e=>{s.has(e)&&t!==e&&!n?.has(e)&&r.add(e)})),this.floodsubPeers.forEach((e=>{s.has(e)&&t!==e&&!n?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&r.add(e)})));const i=this.mesh.get(e);return i&&i.size>0&&i.forEach((e=>{t===e||n?.has(e)||r.add(e)})),r}selectPeersToPublish(e){const t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},r=this.topics.get(e);if(r)if(this.opts.floodPublish)r.forEach((e=>{this.direct.has(e)?(t.add(e),n.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),n.floodsub++)}));else{this.direct.forEach((e=>{r.has(e)&&(t.add(e),n.direct++)})),this.floodsubPeers.forEach((e=>{r.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),n.floodsub++)}));const s=this.mesh.get(e);if(s&&s.size>0)s.forEach((e=>{t.add(e),n.mesh++}));else{const r=this.fanout.get(e);if(r&&r.size>0)r.forEach((e=>{t.add(e),n.fanout++}));else{const r=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));r.size>0&&(this.fanout.set(e,r),r.forEach((e=>{t.add(e),n.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,r){n&&this.score.deliverMessage(n,e,t.topic);const s=this.selectPeersToForward(t.topic,n,r);s.forEach((e=>{this.sendRpc(e,{messages:[t]})})),this.metrics?.onForwardMsg(t.topic,s.size)}async publish(e,t,n){const r=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:s,msg:i}=await async function(e,t,n,r){switch(e.type){case Ml.Signing:{const s={from:e.author.toBytes(),data:r,seqno:(0,fh.O6)(8),topic:t,signature:void 0,key:void 0},i=(0,Ze.z)([ph,Ol.Message.encode(s).finish()]);return s.signature=await e.privateKey.sign(i),s.key=e.key,{raw:s,msg:{type:"signed",from:e.author,data:n,sequenceNumber:BigInt(`0x${(0,K.B)(s.seqno,"base16")}`),topic:t,signature:s.signature,key:s.key}}}case Ml.Anonymous:return{raw:{from:void 0,data:r,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:n,topic:t}}}}(this.publishConfig,e,t,r),o=await this.msgIdFn(i),a=this.msgIdToStrFn(o),c=n?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(a)){if(c)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:u,tosendCount:l}=this.selectPeersToPublish(e),h=!0===this.opts.emitSelf&&this.subscriptions.has(e),f=n?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(0===u.size&&!f&&!h)throw Error("PublishError.InsufficientPeers");this.seenCache.put(a),this.mcache.put({msgId:o,msgIdStr:a},s,!0),this.publishedMessageIds.put(a);for(const e of u){this.sendRpc(e,{messages:[s]})||u.delete(e)}return this.metrics?.onPublishMsg(e,l,u.size,null!=s.data?s.data.length:0),h&&(u.add(this.components.peerId.toString()),super.dispatchEvent(new Al.A("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:a,msg:i}})),super.dispatchEvent(new Al.A("message",{detail:i}))),{recipients:Array.from(u.values()).map((e=>(0,Te.jE)(e)))}}reportMessageValidationResult(e,t,n){if(n===Fl.Ct.Accept){const r=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(null!==r),null!=r){const{message:s,originatingPeers:i}=r;this.score.deliverMessage(t.toString(),e,s.topic),this.forwardMessage(e,r.message,t.toString(),i),this.metrics?.onReportValidation(s.topic,n)}}else{const r=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(null!==r),r){const s=$l(n),{message:i,originatingPeers:o}=r;this.score.rejectMessage(t.toString(),e,i.topic,s);for(const t of o)this.score.rejectMessage(t,e,i.topic,s);this.metrics?.onReportValidation(i.topic,n)}}}sendGraft(e,t){const n=[{topicID:t}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,t){const n=[await this.makePrune(e,t,this.opts.doPX)];this.sendRpc(e,{control:{prune:n}})}sendRpc(e,t){const n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const r=this.control.get(e);r&&(this.piggybackControl(e,t,r),this.control.delete(e));const s=this.gossip.get(e);s&&(this.piggybackGossip(e,t,s),this.gossip.delete(e));const i=Ol.encode(t).finish();try{n.push(i)}catch(t){return this.log.error(`Cannot send rpc to ${e}`,t),r&&this.control.set(e,r),s&&this.gossip.set(e,s),!1}return this.metrics?.onRpcSent(t,i.length),!0}piggybackControl(e,t,n){if(n.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(const r of n.graft)r.topicID&&this.mesh.get(r.topicID)?.has(e)&&t.control.graft.push(r)}if(n.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(const r of n.prune)r.topicID&&!this.mesh.get(r.topicID)?.has(e)&&t.control.prune.push(r)}}piggybackGossip(e,t,n){t.control||(t.control={}),t.control.ihave=n}async sendGraftPrune(e,t,n){const r=this.opts.doPX;for(const[s,i]of e){const e=i.map((e=>({topicID:e})));let o=[];const a=t.get(s);a&&(o=await Promise.all(a.map((async e=>await this.makePrune(s,e,r&&!n.get(s))))),t.delete(s)),this.sendRpc(s,{control:{graft:e,prune:o}})}for(const[e,s]of t){const t=await Promise.all(s.map((async t=>await this.makePrune(e,t,r&&!n.get(e)))));this.sendRpc(e,{control:{prune:t}})}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[n,r]of e)this.doEmitGossip(n,r,t.get(n)??[])}doEmitGossip(e,t,n){if(!n.length)return;if(Cl(n),n.length>Dl&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!t.size)return;let r=this.opts.Dlazy;const s=.25*t.size;let i=t;s>r&&(r=s),r>i.size?r=i.size:i=Cl(Array.from(i)).slice(0,r),i.forEach((t=>{let r=n;n.length>Dl&&(r=Cl(r.slice()).slice(0,Dl)),this.pushGossip(t,{topicID:e,messageIDs:r})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);const n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(t))}async makePrune(e,t,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===Rl)return{topicID:t,peers:[]};const r=this.opts.pruneBackoff/1e3;if(!n)return{topicID:t,peers:[],backoff:r};const s=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),i=await Promise.all(Array.from(s).map((async e=>{const t=(0,Te.jE)(e);return{peerID:t.toBytes(),signedPeerRecord:await this.components.peerStore.addressBook.getRawEnvelope(t)}})));return{topicID:t,peers:i,backoff:r}}async heartbeat(){const{D:e,Dlo:t,Dhi:n,Dscore:r,Dout:s,fanoutTTL:i}=this.opts;this.heartbeatTicks++;const o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},c=new Map,u=new Map,l=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const h=new Map;this.mesh.forEach(((i,o)=>{const f=this.topics.get(o),p=new Set,d=new Set;if(h.set(o,d),f){const e=Cl(Array.from(f)),t=this.backoff.get(o);for(const n of e){const e=this.streamsOutbound.get(n);if(e&&this.multicodecs.includes(e.protocol)&&!i.has(n)&&!this.direct.has(n)){const e=a(n);t&&t.has(n)||!(e>=0)||p.add(n),e>=this.opts.scoreThresholds.gossipThreshold&&d.add(n)}}}const y=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),i.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&d.add(e),this.metrics?.onRemoveFromMesh(o,t,1);const n=u.get(e);n?n.push(o):u.set(e,[o])},g=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),i.add(e),d.delete(e),this.metrics?.onAddToMesh(o,t,1);const n=c.get(e);n?n.push(o):c.set(e,[o])};if(i.forEach((e=>{const t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),y(e,ch.BadScore),l.set(e,!0))})),i.size<t){const t=function(e,t){return eh(e,t,(()=>!0))}(p,e-i.size);t.forEach((e=>{g(e,ah.NotEnough)}))}if(i.size>n){let t=Array.from(i);t.sort(((e,t)=>a(t)-a(e))),t=t.slice(0,r).concat(Cl(t.slice(r)));let n=0;if(t.slice(0,e).forEach((e=>{this.outbound.get(e)&&n++})),n<s){const r=e=>{const n=t[e];for(let n=e;n>0;n--)t[n]=t[n-1];t[0]=n};if(n>0){let s=n;for(let n=1;n<e&&s>0;n++)this.outbound.get(t[n])&&(r(n),s--)}let s=e-n;for(let n=e;n<t.length&&s>0;n++)this.outbound.get(t[n])&&(r(n),s--)}t.slice(e).forEach((e=>{y(e,ch.Excess)}))}if(i.size>=t){let e=0;if(i.forEach((t=>{this.outbound.get(t)&&e++})),e<s){eh(p,s-e,(e=>!0===this.outbound.get(e))).forEach((e=>{g(e,ah.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&i.size>1){const e=Array.from(i).sort(((e,t)=>a(e)-a(t))),t=Math.floor(i.size/2),n=a(e[t]);if(n<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=eh(p,this.opts.opportunisticGraftPeers,(e=>a(e)>n));for(const t of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",t,o),g(t,ah.Opportunistic)}}}));const f=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+i<f&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((t,n)=>{const r=this.topics.get(n);t.forEach((e=>{(!r.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)}));const s=this.topics.get(n),i=[],o=new Set;if(h.set(n,o),s){const e=Cl(Array.from(s));for(const n of e){const e=this.streamsOutbound.get(n);if(e&&this.multicodecs.includes(e.protocol)&&!t.has(n)&&!this.direct.has(n)){const e=a(n);e>=this.opts.scoreThresholds.publishThreshold&&i.push(n),e>=this.opts.scoreThresholds.gossipThreshold&&o.add(n)}}}if(t.size<e){const n=e-t.size;i.slice(0,n).forEach((e=>{t.add(e),o?.delete(e)}))}})),this.emitGossip(h),await this.sendGraftPrune(c,u,l),this.flush(),this.mcache.shift(),this.dispatchEvent(new Al.A("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,n=(()=>!0)){const r=this.topics.get(e);if(!r)return new Set;let s=[];return r.forEach((e=>{const t=this.streamsOutbound.get(e);t&&this.multicodecs.includes(t.protocol)&&n(e)&&s.push(e)})),s=Cl(s),t>0&&s.length>t&&(s=s.slice(0,t)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(const e of this.backoff.values())t+=e.size;e.cacheSize.set({cache:"backoff"},t);for(const[t,n]of this.topics)e.topicPeersCount.set({topicStr:t},n.size);for(const[t,n]of this.mesh)e.meshPeerCounts.set({topicStr:t},n.size);const n=[],r=new Map;e.behaviourPenalty.reset();for(const t of this.peers.keys()){const s=this.score.score(t);n.push(s),r.set(t,s),e.behaviourPenalty.observe(this.score.peerStats.get(t)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,r);const s=function(e,t,n,r,s){const i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of e){const e=t.get(o);if(e){const t=mh(o,e,n,r,s);for(const[e,n]of t.byTopic){let t=i.byTopic.get(e);t||(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(e,t)),t.p1w.push(n.p1w),t.p2w.push(n.p2w),t.p3w.push(n.p3w),t.p3bw.push(n.p3bw),t.p4w.push(n.p4w)}i.p5w.push(t.p5w),i.p6w.push(t.p6w),i.p7w.push(t.p7w),i.score.push(t.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}}function Mh(e={}){return t=>new Bh(t,e)}Bh.multicodec=Nl;const jh=()=>({gossipsub:Mh({fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128})});var zh=n(38532),Uh=n(35505),Fh=n(51392),$h=n(52890),Hh=n(55101),Vh=n(63181),Kh=n(97295);const qh=(0,a.kg)("ipfs-http-client:lib:error-handler"),Wh=i.Z.bind({ignoreUndefined:!0}),Gh=o.isBrowser||o.isWebWorker?location.protocol:"http",Jh=o.isBrowser||o.isWebWorker?location.hostname:"localhost",Zh=o.isBrowser||o.isWebWorker?location.port:"5001",Yh=async e=>{let t;try{if((e.headers.get("Content-Type")||"").startsWith("application/json")){const n=await e.json();qh(n),t=n.Message||n.message}else t=await e.text()}catch(e){qh("Failed to parse error response",e),t=e.message}let n=new we.HTTPError(e);throw t&&(t.includes("deadline has elapsed")&&(n=new we.TimeoutError),t&&t.includes("context deadline exceeded")&&(n=new we.TimeoutError)),t&&t.includes("request timed out")&&(n=new we.TimeoutError),t&&(n.message=t),n},Xh=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,Qh=e=>e.replace(Xh,(function(e){return"-"+e.toLowerCase()}));class ef extends we{constructor(e={}){const t=((e={})=>{let t,n,r={};if("string"==typeof e||(0,F.h2)(e))t=new URL((0,Vh.d)(e));else if(e instanceof URL)t=e;else if("string"==typeof e.url||(0,F.h2)(e.url))t=new URL((0,Vh.d)(e.url)),r=e;else if(e.url instanceof URL)t=e.url,r=e;else{r=e||{};const n=(r.protocol||Gh).replace(":",""),s=(r.host||Jh).split(":")[0],i=r.port||Zh;t=new URL(`${n}://${s}:${i}`)}if(r.apiPath?t.pathname=r.apiPath:"/"!==t.pathname&&void 0!==t.pathname||(t.pathname="api/v0"),o.isNode){const e=(0,Kh.Z)(t);n=r.agent||new e({keepAlive:!0,maxSockets:6})}return{...r,host:t.host,protocol:t.protocol.replace(":",""),port:Number(t.port),apiPath:t.pathname,url:t,agent:n}})(e);var n;super({timeout:(n=t.timeout||0,("string"==typeof n?(0,se.Z)(n):n)||void 0),headers:t.headers,base:`${t.url}`,handleError:Yh,transformSearchParams:e=>{const t=new URLSearchParams;for(const[n,r]of e)"undefined"!==r&&"null"!==r&&"signal"!==n&&t.append(Qh(n),r),"timeout"!==n||isNaN(r)||t.append(Qh(n),r);return t},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;const r=this.fetch;this.fetch=(e,n={})=>("string"!=typeof e||e.startsWith("/")||(e=`${t.url}/${e}`),r.call(this,e,Wh(n,{method:"POST"})))}}we.HTTPError;const tf=e=>t=>e(new ef(t),t);function nf(e){if(null!=e)return"string"==typeof e?e:e.toString(8).padStart(4,"0")}function rf(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const n=e.getTime(),r=Math.floor(n/1e3);t={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw c(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}function sf({arg:e,searchParams:t,hashAlg:n,mtime:r,mode:s,...i}={}){t&&(i={...i,...t}),n&&(i.hash=n),null!=r&&(r=rf(r),i.mtime=r.secs,i.mtimeNsecs=r.nsecs),null!=s&&(i.mode=nf(s)),i.timeout&&!isNaN(i.timeout)&&(i.timeout=`${i.timeout}ms`),null==e?e=[]:Array.isArray(e)||(e=[e]);const o=new URLSearchParams(i);return e.forEach((e=>o.append("arg",e))),o}const of=tf((e=>async function(t={}){return((await(await e.post("bitswap/wantlist",{signal:t.signal,searchParams:sf(t),headers:t.headers})).json()).Keys||[]).map((e=>H.k0.parse(e["/"])))})),af=tf((e=>async function(t,n={}){return((await(await e.post("bitswap/wantlist",{signal:n.signal,searchParams:sf({...n,peer:t.toString()}),headers:n.headers})).json()).Keys||[]).map((e=>H.k0.parse(e["/"])))})),cf=tf((e=>async function(t={}){const n=await e.post("bitswap/stat",{searchParams:sf(t),signal:t.signal,headers:t.headers});return function(e){return{provideBufLen:e.ProvideBufLen,wantlist:(e.Wantlist||[]).map((e=>H.k0.parse(e["/"]))),peers:(e.Peers||[]).map((e=>(0,Te.jE)(e))),blocksReceived:BigInt(e.BlocksReceived),dataReceived:BigInt(e.DataReceived),blocksSent:BigInt(e.BlocksSent),dataSent:BigInt(e.DataSent),dupBlksReceived:BigInt(e.DupBlksReceived),dupDataReceived:BigInt(e.DupDataReceived)}}(await n.json())}));const uf=tf((e=>async function(t,n={}){return(await e.post("bitswap/unwant",{signal:n.signal,searchParams:sf({arg:t.toString(),...n}),headers:n.headers})).json()}));function lf(e){return{wantlist:of(e),wantlistForPeer:af(e),unwant:uf(e),stat:cf(e)}}const hf=tf((e=>async function(t,n={}){const r=await e.post("block/get",{signal:n.signal,searchParams:sf({arg:t.toString(),...n}),headers:n.headers});return new Uint8Array(await r.arrayBuffer())}));var ff=n(47498);function pf(...e){return(0,re.anySignal)(function(e){return e.filter(Boolean)}(e))}const df=tf((e=>async function t(n,r={}){const s=new AbortController,i=pf(s.signal,r.signal);let o;try{const t=await e.post("block/put",{signal:i,searchParams:sf(r),...await(0,ff.x)([n],s,r.headers)});o=await t.json()}catch(e){if("dag-pb"===r.format)return t(n,{...r,format:"protobuf"});if("dag-cbor"===r.format)return t(n,{...r,format:"cbor"});throw e}return H.k0.parse(o.Key)})),yf=tf((e=>async function*(t,n={}){Array.isArray(t)||(t=[t]);const r=await e.post("block/rm",{signal:n.signal,searchParams:sf({arg:t.map((e=>e.toString())),"stream-channels":!0,...n}),headers:n.headers});for await(const e of r.ndjson())yield gf(e)}));function gf(e){const t={cid:H.k0.parse(e.Hash)};return e.Error&&(t.error=new Error(e.Error)),t}const mf=tf((e=>async function(t,n={}){const r=await e.post("block/stat",{signal:n.signal,searchParams:sf({arg:t.toString(),...n}),headers:n.headers}),s=await r.json();return{cid:H.k0.parse(s.Key),size:s.Size}}));function bf(e){return{get:hf(e),put:df(e),rm:yf(e),stat:mf(e)}}const wf=tf((e=>async function(t,n={}){const r=await e.post("bootstrap/add",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),{Peers:s}=await r.json();return{Peers:s.map((e=>(0,F.HM)(e)))}})),vf=tf((e=>async function(t={}){const n=await e.post("bootstrap/rm",{signal:t.signal,searchParams:sf({...t,all:!0}),headers:t.headers}),{Peers:r}=await n.json();return{Peers:r.map((e=>(0,F.HM)(e)))}})),Ef=tf((e=>async function(t={}){const n=await e.post("bootstrap/list",{signal:t.signal,searchParams:sf(t),headers:t.headers}),{Peers:r}=await n.json();return{Peers:r.map((e=>(0,F.HM)(e)))}})),_f=tf((e=>async function(t={}){const n=await e.post("bootstrap/add",{signal:t.signal,searchParams:sf({...t,default:!0}),headers:t.headers}),{Peers:r}=await n.json();return{Peers:r.map((e=>(0,F.HM)(e)))}})),kf=tf((e=>async function(t,n={}){const r=await e.post("bootstrap/rm",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),{Peers:s}=await r.json();return{Peers:s.map((e=>(0,F.HM)(e)))}}));function Sf(e){return{add:wf(e),clear:vf(e),list:Ef(e),reset:_f(e),rm:kf(e)}}const Tf=tf((e=>async function(t,n={}){const r=await e.post("config/profile/apply",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),s=await r.json();return{original:s.OldCfg,updated:s.NewCfg}}));function Af(e){if(null==e)return e;const t=/^[A-Z]+$/;return Object.keys(e).reduce(((n,r)=>(t.test(r)?n[r.toLowerCase()]=e[r]:t.test(r[0])?n[r[0].toLowerCase()+r.slice(1)]=e[r]:n[r]=e[r],n)),{})}const If=tf((e=>async function(t={}){const n=await e.post("config/profile/list",{signal:t.signal,searchParams:sf(t),headers:t.headers});return(await n.json()).map((e=>Af(e)))}));function xf(e){return{apply:Tf(e),list:If(e)}}const Of=tf((e=>async(t,n={})=>{if(!t)throw new Error("key argument is required");const r=await e.post("config",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers});return(await r.json()).Value})),Pf=tf((e=>async(t={})=>{const n=await e.post("config/show",{signal:t.signal,searchParams:sf({...t}),headers:t.headers});return await n.json()})),Rf=tf((e=>async(t,n={})=>{const r=new AbortController,s=pf(r.signal,n.signal),i=await e.post("config/replace",{signal:s,searchParams:sf(n),...await(0,ff.x)([(0,B.m)(JSON.stringify(t))],r,n.headers)});await i.text()})),Nf=tf((e=>async(t,n,r={})=>{if("string"!=typeof t)throw new Error("Invalid key type");const s={...r,...Df(t,n)},i=await e.post("config",{signal:r.signal,searchParams:sf(s),headers:r.headers});await i.text()})),Df=(e,t)=>{switch(typeof t){case"boolean":return{arg:[e,t.toString()],bool:!0};case"string":return{arg:[e,t]};default:return{arg:[e,JSON.stringify(t)],json:!0}}};function Cf(e){return{getAll:Pf(e),get:Of(e),set:Nf(e),replace:Rf(e),profiles:xf(e)}}const Lf=tf((e=>async function*(t,n={}){const r=await e.post("dag/export",{signal:n.signal,searchParams:sf({arg:t.toString()}),headers:n.headers});yield*r.iterator()}));async function*Bf(e,t,n,r,s){const i=async e=>{const t=await n.getCodec(e.code),i=await r(e,s);return t.decode(i)},o=t.split("/").filter(Boolean);let a=await i(e),u=e;for(;o.length;){const e=o.shift();if(!e)throw c(new Error(`Could not resolve path "${t}"`),"ERR_INVALID_PATH");if(!Object.prototype.hasOwnProperty.call(a,e))throw c(new Error(`no link named "${e}" under ${u}`),"ERR_NO_LINK");a=a[e],yield{value:a,remainderPath:o.join("/")};const n=H.k0.asCID(a);n&&(u=n,a=await i(a))}yield{value:a,remainderPath:""}}const Mf=(e,t)=>{const n=tf(((t,n)=>{const r=hf(n);return async(t,n={})=>{if(n.path){const s=n.localResolve?await(0,Ri.Z)(Bf(t,n.path,e,r,n)):await(0,Ie.Z)(Bf(t,n.path,e,r,n));if(!s)throw c(new Error("Not found"),"ERR_NOT_FOUND");return s}const s=await e.getCodec(t.code),i=await r(t,n);return{value:s.decode(i),remainderPath:""}}}));return n(t)},jf=tf((e=>async function*(t,n={}){const r=new AbortController,s=pf(r.signal,n.signal),{headers:i,body:o}=await(0,ff.x)(t,r,n.headers),a=await e.post("dag/import",{signal:s,headers:i,body:o,searchParams:sf({"pin-roots":n.pinRoots})});for await(const{Root:e}of a.ndjson())if(void 0!==e){const{Cid:{"/":t},PinErrorMsg:n}=e;yield{root:{cid:H.k0.parse(t),pinErrorMsg:n}}}})),zf=(e,t)=>{const n=tf((t=>async(n,r={})=>{const s={storeCodec:"dag-cbor",hashAlg:"sha2-256",...r};let i;if(s.inputCodec){if(!(n instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");i=n}else{i=(await e.getCodec(s.storeCodec)).encode(n),s.inputCodec=s.storeCodec}const o=new AbortController,a=pf(o.signal,s.signal),c=await t.post("dag/put",{timeout:s.timeout,signal:a,searchParams:sf(s),...await(0,ff.x)([i],o,s.headers)}),u=await c.json();return H.k0.parse(u.Cid["/"])}));return n(t)},Uf=tf((e=>async(t,n={})=>{const r=await e.post("dag/resolve",{signal:n.signal,searchParams:sf({arg:`${t}${n.path?`/${n.path}`.replace(/\/[/]+/g,"/"):""}`,...n}),headers:n.headers}),s=await r.json();return{cid:H.k0.parse(s.Cid["/"]),remainderPath:s.RemPath}}));function Ff(e,t){return{export:Lf(t),get:Mf(e,t),import:jf(t),put:zf(e,t),resolve:Uf(t)}}const $f=e=>{if(0===e.Type)return{name:"SENDING_QUERY",type:e.Type};if(1===e.Type)return{from:(0,Te.jE)(e.ID),name:"PEER_RESPONSE",type:e.Type,messageType:0,messageName:"PUT_VALUE",closer:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:(0,Te.jE)(e),multiaddrs:t.map((e=>(0,F.HM)(e))),protocols:[]}))),providers:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:(0,Te.jE)(e),multiaddrs:t.map((e=>(0,F.HM)(e))),protocols:[]})))};if(2===e.Type){let t={id:e.ID??(0,Te.jE)(e.ID),multiaddrs:[],protocols:[]};return e.Responses&&e.Responses.length&&(t={id:(0,Te.jE)(e.Responses[0].ID),multiaddrs:e.Responses[0].Addrs.map((e=>(0,F.HM)(e))),protocols:[]}),{name:"FINAL_PEER",type:e.Type,peer:t}}if(3===e.Type)return{name:"QUERY_ERROR",type:e.Type,error:new Error(e.Extra)};if(4===e.Type)return{name:"PROVIDER",type:e.Type,providers:e.Responses.map((({ID:e,Addrs:t})=>({id:(0,Te.jE)(e),multiaddrs:t.map((e=>(0,F.HM)(e))),protocols:[]})))};if(5===e.Type)return{name:"VALUE",type:e.Type,value:(0,B.m)(e.Extra,"base64pad")};if(6===e.Type){const t=e.Responses.map((({ID:e})=>(0,Te.jE)(e)));if(!t.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:e.Type,peer:t[0]}}if(7===e.Type)return{name:"DIALING_PEER",type:e.Type,peer:(0,Te.jE)(e.ID)};throw new Error("Unknown DHT event type")},Hf=tf((e=>async function*(t,n={}){const r=await e.post("dht/findpeer",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers});for await(const e of r.ndjson())yield $f(e)})),Vf=tf((e=>async function*(t,n={}){const r=await e.post("dht/findprovs",{signal:n.signal,searchParams:sf({arg:t.toString(),...n}),headers:n.headers});for await(const e of r.ndjson())yield $f(e)})),Kf=tf((e=>async function*(t,n={}){const r=await e.post("dht/get",{signal:n.signal,searchParams:sf({arg:t instanceof Uint8Array?(0,K.B)(t):t.toString(),...n}),headers:n.headers});for await(const e of r.ndjson())yield $f(e)})),qf=tf((e=>async function*(t,n={recursive:!1}){const r=Array.isArray(t)?t:[t],s=await e.post("dht/provide",{signal:n.signal,searchParams:sf({arg:r.map((e=>e.toString())),...n}),headers:n.headers});for await(const e of s.ndjson())yield $f(e)})),Wf=tf((e=>async function*(t,n,r={}){const s=new AbortController,i=pf(s.signal,r.signal),o=await e.post("dht/put",{signal:i,searchParams:sf({arg:t instanceof Uint8Array?(0,K.B)(t):t.toString(),...r}),...await(0,ff.x)([n],s,r.headers)});for await(const e of o.ndjson())yield $f(e)})),Gf=tf((e=>async function*(t,n={}){const r=await e.post("dht/query",{signal:n.signal,searchParams:sf({arg:t.toString(),...n}),headers:n.headers});for await(const e of r.ndjson())yield $f(e)}));function Jf(e){return{findPeer:Hf(e),findProvs:Vf(e),get:Kf(e),provide:qf(e),put:Wf(e),query:Gf(e)}}const Zf=tf((e=>async function(t={}){return(await e.post("diag/cmds",{signal:t.signal,searchParams:sf(t),headers:t.headers})).json()})),Yf=tf((e=>async function(t={}){return(await e.post("diag/net",{signal:t.signal,searchParams:sf(t),headers:t.headers})).json()})),Xf=tf((e=>async function(t={}){return(await e.post("diag/sys",{signal:t.signal,searchParams:sf(t),headers:t.headers})).json()}));function Qf(e){return{cmds:Zf(e),net:Yf(e),sys:Xf(e)}}const ep=tf((e=>async function(t,n,r={}){const s=await e.post("files/chmod",{signal:r.signal,searchParams:sf({arg:t,mode:n,...r}),headers:r.headers});await s.text()})),tp=tf((e=>async function(t,n,r={}){const s=Array.isArray(t)?t:[t],i=await e.post("files/cp",{signal:r.signal,searchParams:sf({arg:s.concat(n).map((e=>H.k0.asCID(e)?`/ipfs/${e}`:e)),...r}),headers:r.headers});await i.text()})),np=tf((e=>async function(t,n={}){if(!t||"string"!=typeof t)throw new Error("ipfs.files.flush requires a path");const r=await e.post("files/flush",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),s=await r.json();return H.k0.parse(s.Cid)}));function rp(e){const t=Af(e);return Object.prototype.hasOwnProperty.call(t,"mode")&&(t.mode=parseInt(t.mode,8)),Object.prototype.hasOwnProperty.call(t,"mtime")&&(t.mtime={secs:t.mtime,nsecs:t.mtimeNsecs||0},delete t.mtimeNsecs),t}const sp=tf((e=>async function*(t,n={}){if(!t)throw new Error("ipfs.files.ls requires a path");const r=await e.post("files/ls",{signal:n.signal,searchParams:sf({arg:H.k0.asCID(t)?`/ipfs/${t}`:t,long:!0,...n,stream:!0}),headers:n.headers});for await(const e of r.ndjson())if("Entries"in e)for(const t of e.Entries||[])yield ip(rp(t));else yield ip(rp(e))}));function ip(e){return e.hash&&(e.cid=H.k0.parse(e.hash)),delete e.hash,e.type=1===e.type?"directory":"file",e}const op=tf((e=>async function(t,n={}){const r=await e.post("files/mkdir",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers});await r.text()})),ap=tf((e=>async function(t,n,r={}){Array.isArray(t)||(t=[t]);const s=await e.post("files/mv",{signal:r.signal,searchParams:sf({arg:t.concat(n),...r}),headers:r.headers});await s.text()}));var cp=n(50590);const up=tf((e=>async function*(t,n={}){const r=await e.post("files/read",{signal:n.signal,searchParams:sf({arg:t,count:n.length,...n}),headers:n.headers});yield*cp(r.body)})),lp=tf((e=>async function(t,n={}){const r=await e.post("files/rm",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),s=await r.text();if(""!==s){const e=new we.HTTPError(r);throw e.message=s,e}})),hp=tf((e=>async function(t,n={}){const r=await e.post("files/stat",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),s=await r.json();return s.WithLocality=s.WithLocality||!1,(i=rp(s)).cid=H.k0.parse(i.hash),delete i.hash,i;var i}));const fp=tf((e=>async function(t,n={}){const r=await e.post("files/touch",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers});await r.text()})),pp=tf((e=>async function(t,n,r={}){const s=new AbortController,i=pf(s.signal,r.signal),o=await e.post("files/write",{signal:i,searchParams:sf({arg:t,streamChannels:!0,count:r.length,...r}),...await(0,ff.x)([{content:n,path:"arg",mode:nf(r.mode),mtime:rf(r.mtime)}],s,r.headers)});await o.text()}));function dp(e){return{chmod:ep(e),cp:tp(e),flush:np(e),ls:sp(e),mkdir:op(e),mv:ap(e),read:up(e),rm:lp(e),stat:hp(e),touch:fp(e),write:pp(e)}}const yp=tf((e=>async(e,t,n={})=>{throw c(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),gp=tf((e=>async function(t,n){const r=n??{type:"Ed25519"},s=await e.post("key/gen",{signal:r.signal,searchParams:sf({arg:t,...r}),headers:r.headers});return Af(await s.json())})),mp=tf((e=>async function(t,n,r,s={}){const i=await e.post("key/import",{signal:s.signal,searchParams:sf({arg:t,pem:n,password:r,...s}),headers:s.headers});return Af(await i.json())})),bp=tf((e=>async(e,t={})=>{throw c(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),wp=tf((e=>async function(t={}){const n=await e.post("key/list",{signal:t.signal,searchParams:sf(t),headers:t.headers});return((await n.json()).Keys||[]).map((e=>Af(e)))})),vp=tf((e=>async function(t,n,r={}){const s=await e.post("key/rename",{signal:r.signal,searchParams:sf({arg:[t,n],...r}),headers:r.headers});return Af(await s.json())})),Ep=tf((e=>async function(t,n={}){const r=await e.post("key/rm",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers});return Af((await r.json()).Keys[0])}));function _p(e){return{export:yp(e),gen:gp(e),import:mp(e),info:bp(e),list:wp(e),rename:vp(e),rm:Ep(e)}}const kp=tf((e=>async function(t,n,r={}){const s=await e.post("log/level",{signal:r.signal,searchParams:sf({arg:[t,n],...r}),headers:r.headers});return Af(await s.json())})),Sp=tf((e=>async function(t={}){const n=await e.post("log/ls",{signal:t.signal,searchParams:sf(t),headers:t.headers});return(await n.json()).Strings})),Tp=tf((e=>async function*(t={}){const n=await e.post("log/tail",{signal:t.signal,searchParams:sf(t),headers:t.headers});yield*n.ndjson()}));function Ap(e){return{level:kp(e),ls:Sp(e),tail:Tp(e)}}const Ip=tf((e=>async function(t,n={}){const r=await e.post("name/publish",{signal:n.signal,searchParams:sf({arg:`${t}`,...n}),headers:n.headers});return Af(await r.json())})),xp=tf((e=>async function*(t,n={}){const r=await e.post("name/resolve",{signal:n.signal,searchParams:sf({arg:t,stream:!0,...n}),headers:n.headers});for await(const e of r.ndjson())yield e.Path})),Op=tf((e=>async function(t,n={}){const r=await e.post("name/pubsub/cancel",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers});return Af(await r.json())})),Pp=tf((e=>async function(t={}){const n=await e.post("name/pubsub/state",{signal:t.signal,searchParams:sf(t),headers:t.headers});return Af(await n.json())})),Rp=tf((e=>async function(t={}){const n=await e.post("name/pubsub/subs",{signal:t.signal,searchParams:sf(t),headers:t.headers});return(await n.json()).Strings||[]}));function Np(e){return{cancel:Op(e),state:Pp(e),subs:Rp(e)}}function Dp(e){return{publish:Ip(e),resolve:xp(e),pubsub:Np(e)}}const Cp=tf((e=>async function(t,n={}){const r=await e.post("object/data",{signal:n.signal,searchParams:sf({arg:`${t instanceof Uint8Array?H.k0.decode(t):t}`,...n}),headers:n.headers}),s=await r.arrayBuffer();return new Uint8Array(s,0,s.byteLength)})),Lp=tf((e=>async function(t,n={}){const r=await e.post("object/get",{signal:n.signal,searchParams:sf({arg:`${t instanceof Uint8Array?H.k0.decode(t):t}`,dataEncoding:"base64",...n}),headers:n.headers}),s=await r.json();return{Data:(0,B.m)(s.Data,"base64pad"),Links:(s.Links||[]).map((e=>({Name:e.Name,Hash:H.k0.parse(e.Hash),Tsize:e.Size})))}})),Bp=tf((e=>async function(t,n={}){const r=await e.post("object/links",{signal:n.signal,searchParams:sf({arg:`${t instanceof Uint8Array?H.k0.decode(t):t}`,...n}),headers:n.headers});return((await r.json()).Links||[]).map((e=>({Name:e.Name,Tsize:e.Size,Hash:H.k0.parse(e.Hash)})))})),Mp=tf((e=>async function(t={}){const n=await e.post("object/new",{signal:t.signal,searchParams:sf({arg:t.template,...t}),headers:t.headers}),{Hash:r}=await n.json();return H.k0.parse(r)})),jp=(e,t)=>{const n=tf((n=>{const r=zf(e,t);return async function(e,t={}){return r(e,{...t,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}}));return n(t)},zp=tf((e=>async function(t,n={}){const r=await e.post("object/stat",{signal:n.signal,searchParams:sf({arg:`${t}`,...n}),headers:n.headers}),s=await r.json();return{...s,Hash:H.k0.parse(s.Hash)}})),Up=tf((e=>async function(t,n,r={}){const s=await e.post("object/patch/add-link",{signal:r.signal,searchParams:sf({arg:[`${t}`,n.Name||n.name||"",(n.Hash||n.cid||"").toString()||null],...r}),headers:r.headers}),{Hash:i}=await s.json();return H.k0.parse(i)})),Fp=tf((e=>async function(t,n,r={}){const s=new AbortController,i=pf(s.signal,r.signal),o=await e.post("object/patch/append-data",{signal:i,searchParams:sf({arg:`${t}`,...r}),...await(0,ff.x)([n],s,r.headers)}),{Hash:a}=await o.json();return H.k0.parse(a)})),$p=tf((e=>async function(t,n,r={}){const s=await e.post("object/patch/rm-link",{signal:r.signal,searchParams:sf({arg:[`${t}`,n.Name||n.name||null],...r}),headers:r.headers}),{Hash:i}=await s.json();return H.k0.parse(i)})),Hp=tf((e=>async function(t,n,r={}){const s=new AbortController,i=pf(s.signal,r.signal),o=await e.post("object/patch/set-data",{signal:i,searchParams:sf({arg:[`${t}`],...r}),...await(0,ff.x)([n],s,r.headers)}),{Hash:a}=await o.json();return H.k0.parse(a)}));function Vp(e){return{addLink:Up(e),appendData:Fp(e),rmLink:$p(e),setData:Hp(e)}}function Kp(e,t){return{data:Cp(t),get:Lp(t),links:Bp(t),new:Mp(t),put:jp(e,t),stat:zp(t),patch:Vp(t)}}const qp=tf((e=>async function*(t,n={}){for await(const{path:r,recursive:s,metadata:i}of(0,xe.f)(t)){const t=await e.post("pin/add",{signal:n.signal,searchParams:sf({...n,arg:r,recursive:s,metadata:i?JSON.stringify(i):void 0,stream:!0}),headers:n.headers});for await(const e of t.ndjson())if(e.Pins)for(const t of e.Pins)yield H.k0.parse(t);else yield H.k0.parse(e)}}));function Wp(e){const t=qp(e);return tf((()=>async function(e,n={}){return(0,Ie.Z)(t([{path:e,...n}],n))}))(e)}function Gp(e,t,n){const r={type:e,cid:H.k0.parse(t)};return n&&(r.metadata=n),r}const Jp=tf((e=>async function*(t={}){let n=[];t.paths&&(n=Array.isArray(t.paths)?t.paths:[t.paths]);const r=await e.post("pin/ls",{signal:t.signal,searchParams:sf({...t,arg:n.map((e=>`${e}`)),stream:!0}),headers:t.headers});for await(const e of r.ndjson()){if(e.Keys){for(const t of Object.keys(e.Keys))yield Gp(e.Keys[t].Type,t,e.Keys[t].Metadata);return}yield Gp(e.Type,e.Cid,e.Metadata)}})),Zp=tf((e=>async function*(t,n={}){for await(const{path:r,recursive:s}of(0,xe.f)(t)){const t=new URLSearchParams(n.searchParams);t.append("arg",`${r}`),null!=s&&t.set("recursive",String(s));const i=await e.post("pin/rm",{signal:n.signal,headers:n.headers,searchParams:sf({...n,arg:`${r}`,recursive:s})});for await(const e of i.ndjson())e.Pins?yield*e.Pins.map((e=>H.k0.parse(e))):yield H.k0.parse(e)}})),Yp=e=>{const t=Zp(e);return tf((()=>async function(e,n={}){return(0,Ie.Z)(t([{path:e,...n}],n))}))(e)},Xp=({Name:e,Status:t,Cid:n})=>({cid:H.k0.parse(n),name:e,status:t}),Qp=e=>{if("string"==typeof e&&""!==e)return e;throw new TypeError("service name must be passed")},ed=e=>{if(H.k0.asCID(e))return e.toString();throw new TypeError("CID instance expected instead of "+typeof e)},td=({service:e,cid:t,name:n,status:r,all:s})=>{const i=sf({service:Qp(e),name:n,force:!!s||void 0});if(t)for(const e of t)i.append("cid",ed(e));if(r)for(const e of r)i.append("status",e);return i},nd=({cid:e,service:t,background:n,name:r,origins:s})=>{const i=sf({arg:ed(e),service:Qp(t),name:r,background:!!n||void 0});if(s)for(const e of s)i.append("origin",e.toString());return i};function rd(e){return async function(t,{timeout:n,signal:r,headers:s,...i}){const o=await e.post("pin/remote/add",{timeout:n,signal:r,headers:s,searchParams:nd({cid:t,...i})});return Xp(await o.json())}}function sd(e){return async function*({timeout:t,signal:n,headers:r,...s}){const i=await e.post("pin/remote/ls",{timeout:t,signal:n,headers:r,searchParams:td(s)});for await(const e of i.ndjson())yield Xp(e)}}function id(e){return async function({timeout:t,signal:n,headers:r,...s}){await e.post("pin/remote/rm",{timeout:t,signal:n,headers:r,searchParams:td({...s,all:!1})})}}function od(e){return async function({timeout:t,signal:n,headers:r,...s}){await e.post("pin/remote/rm",{timeout:t,signal:n,headers:r,searchParams:td({...s,all:!0})})}}function ad(e){const t=String(e);if("undefined"===t)throw Error("endpoint is required");return"/"===t[t.length-1]?t.slice(0,-1):t}function cd(e){return{service:e.Service,endpoint:new URL(e.ApiEndpoint),...e.Stat&&{stat:ud(e.Stat)}}}function ud(e){switch(e.Status){case"valid":{const{Pinning:t,Pinned:n,Queued:r,Failed:s}=e.PinCount;return{status:"valid",pinCount:{queued:r,pinning:t,pinned:n,failed:s}}}case"invalid":return{status:"invalid"};default:return{status:e.Status}}}function ld(e){return async function(t,n){const{endpoint:r,key:s,headers:i,timeout:o,signal:a}=n;await e.post("pin/remote/service/add",{timeout:o,signal:a,searchParams:sf({arg:[t,ad(r),s]}),headers:i})}}function hd(e){return async function(t={}){const{stat:n,headers:r,timeout:s,signal:i}=t,o=await e.post("pin/remote/service/ls",{timeout:s,signal:i,headers:r,searchParams:!0===n?sf({stat:n}):void 0}),{RemoteServices:a}=await o.json();return a.map(cd)}}function fd(e){return async function(t,n={}){await e.post("pin/remote/service/rm",{signal:n.signal,headers:n.headers,searchParams:sf({arg:t})})}}function pd(e){const t=new ef(e);return{add:ld(t),ls:hd(t),rm:fd(t)}}function dd(e){const t=new ef(e);return{add:rd(t),ls:sd(t),rm:id(t),rmAll:od(t),service:pd(e)}}function yd(e){return{addAll:qp(e),add:Wp(e),ls:Jp(e),rmAll:Zp(e),rm:Yp(e),remote:dd(e)}}var gd=n(99382);const md=e=>(0,K.B)(bd(e)),bd=e=>gd.base64url.decode(e),wd=e=>BigInt(`0x${(0,K.B)(gd.base64url.decode(e),"base16")}`),vd=e=>gd.base64url.encode((0,B.m)(e)),Ed=tf((e=>async function(t={}){const{Strings:n}=await(await e.post("pubsub/ls",{signal:t.signal,searchParams:sf(t),headers:t.headers})).json();return r=n,(Array.isArray(r)?r.map(md):r)||[];var r})),_d=tf((e=>async function(t,n={}){const r=await e.post("pubsub/peers",{signal:n.signal,searchParams:sf({arg:vd(t),...n}),headers:n.headers}),{Strings:s}=await r.json();return s||[]})),kd=tf((e=>async function(t,n,r={}){const s=sf({arg:vd(t),...r}),i=new AbortController,o=pf(i.signal,r.signal),a=await e.post("pubsub/pub",{signal:o,searchParams:s,...await(0,ff.x)([n],i,r.headers)});await a.text()})),Sd=(0,a.kg)("ipfs-http-client:pubsub:subscribe"),Td=(e,t)=>tf((e=>async function(n,r,s={}){let i,o;s.signal=t.subscribe(n,r,s.signal);const a=new Promise(((e,t)=>{i=e,o=t})),c=setTimeout((()=>i()),1e3);return e.post("pubsub/sub",{signal:s.signal,searchParams:sf({arg:vd(n),...s}),headers:s.headers}).catch((e=>{t.unsubscribe(n,r),o(e)})).then((e=>{clearTimeout(c),e&&(!async function(e,{onMessage:t,onEnd:n,onError:r}){r=r||Sd;try{for await(const n of e.ndjson())try{if(!n.from)continue;null!=n.from&&null!=n.seqno?t({type:"signed",from:(0,Te.jE)(n.from),data:bd(n.data),sequenceNumber:wd(n.seqno),topic:md(n.topicIDs[0]),key:bd(n.key??"u"),signature:bd(n.signature??"u")}):t({type:"unsigned",data:bd(n.data),topic:md(n.topicIDs[0])})}catch(e){e.message=`Failed to parse pubsub message: ${e.message}`,r(e,!1,n)}}catch(e){Ad(e)||r(e,!0)}finally{n()}}(e,{onMessage:e=>{r&&("function"!=typeof r?"function"==typeof r.handleEvent&&r.handleEvent(e):r(e))},onEnd:()=>t.unsubscribe(n,r),onError:s.onError}),i())})),a}))(e);const Ad=e=>{switch(e.type){case"aborted":case"abort":return!0;default:return"AbortError"===e.name}},Id=(e,t)=>async function(e,n){t.unsubscribe(e,n)};class xd{constructor(){this._subs=new Map}subscribe(e,t,n){const r=this._subs.get(e)||[];if(r.find((e=>e.handler===t)))throw new Error(`Already subscribed to ${e} with this handler`);const s=new AbortController;return this._subs.set(e,[{handler:t,controller:s}].concat(r)),n&&n.addEventListener("abort",(()=>this.unsubscribe(e,t))),s.signal}unsubscribe(e,t){const n=this._subs.get(e)||[];let r;t?(this._subs.set(e,n.filter((e=>e.handler!==t))),r=n.filter((e=>e.handler===t))):(this._subs.set(e,[]),r=n),(this._subs.get(e)||[]).length||this._subs.delete(e),r.forEach((e=>e.controller.abort()))}}function Od(e){const t=new xd;return{ls:Ed(e),peers:_d(e),publish:kd(e),subscribe:Td(e,t),unsubscribe:Id(e,t)}}const Pd=tf((e=>async function*(t={}){const n=await e.post("refs/local",{signal:t.signal,transform:Af,searchParams:sf(t),headers:t.headers});yield*n.ndjson()})),Rd=tf(((e,t)=>Object.assign((async function*(t,n={}){const r=Array.isArray(t)?t:[t],s=await e.post("refs",{signal:n.signal,searchParams:sf({arg:r.map((e=>`${e instanceof Uint8Array?H.k0.decode(e):e}`)),...n}),headers:n.headers,transform:Af});yield*s.ndjson()}),{local:Pd(t)}))),Nd=tf((e=>async function*(t={}){const n=await e.post("repo/gc",{signal:t.signal,searchParams:sf(t),headers:t.headers,transform:e=>({err:e.Error?new Error(e.Error):null,cid:(e.Key||{})["/"]?H.k0.parse(e.Key["/"]):null})});yield*n.ndjson()})),Dd=tf((e=>async function(t={}){const n=await e.post("repo/stat",{signal:t.signal,searchParams:sf(t),headers:t.headers}),r=await n.json();return{numObjects:BigInt(r.NumObjects),repoSize:BigInt(r.RepoSize),repoPath:r.RepoPath,version:r.Version,storageMax:BigInt(r.StorageMax)}})),Cd=tf((e=>async function(t={}){return(await(await e.post("repo/version",{signal:t.signal,searchParams:sf(t),headers:t.headers})).json()).Version}));function Ld(e){return{gc:Nd(e),stat:Dd(e),version:Cd(e)}}const Bd=tf((e=>async function*(t={}){const n=await e.post("stats/bw",{signal:t.signal,searchParams:sf(t),headers:t.headers,transform:e=>({totalIn:BigInt(e.TotalIn),totalOut:BigInt(e.TotalOut),rateIn:parseFloat(e.RateIn),rateOut:parseFloat(e.RateOut)})});yield*n.ndjson()}));function Md(e){return{bitswap:cf(e),repo:Dd(e),bw:Bd(e)}}const jd=tf((e=>async function(t={}){const n=await e.post("swarm/addrs",{signal:t.signal,searchParams:sf(t),headers:t.headers}),{Addrs:r}=await n.json();return Object.keys(r).map((e=>({id:(0,Te.jE)(e),addrs:(r[e]||[]).map((e=>(0,F.HM)(e)))})))})),zd=tf((e=>async function(t,n={}){const r=await e.post("swarm/connect",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),{Strings:s}=await r.json();return s||[]})),Ud=tf((e=>async function(t,n={}){const r=await e.post("swarm/disconnect",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),{Strings:s}=await r.json();return s||[]})),Fd=tf((e=>async function(t={}){const n=await e.post("swarm/addrs/local",{signal:t.signal,searchParams:sf(t),headers:t.headers}),{Strings:r}=await n.json();return(r||[]).map((e=>(0,F.HM)(e)))})),$d=tf((e=>async function(t={}){const n=await e.post("swarm/peers",{signal:t.signal,searchParams:sf(t),headers:t.headers}),{Peers:r}=await n.json();return(r||[]).map((e=>({addr:(0,F.HM)(e.Addr),peer:(0,Te.jE)(e.Peer),muxer:e.Muxer,latency:e.Latency,streams:e.Streams,direction:null==e.Direction?void 0:0===e.Direction?"inbound":"outbound"})))}));function Hd(e){return{addrs:jd(e),connect:zd(e),disconnect:Ud(e),localAddrs:Fd(e),peers:$d(e)}}const Vd=tf((e=>async function*(t,n={}){const r=new AbortController,s=pf(r.signal,n.signal),{headers:i,body:o,total:a,parts:c}=await(0,ff.x)(t,r,n.headers),[u,l]="function"==typeof n.progress?Kd(a,c,n.progress):[void 0,void 0],h=await e.post("add",{searchParams:sf({"stream-channels":!0,...n,progress:Boolean(u)}),onUploadProgress:l,signal:s,headers:i,body:o});for await(let e of h.ndjson())e=Af(e),void 0!==e.hash?yield Wd(e):u&&u(e.bytes||0,e.name)})),Kd=(e,t,n)=>t?[void 0,qd(e,t,n)]:[n,void 0],qd=(e,t,n)=>{let r=0;const s=t.length;return({loaded:i,total:o})=>{const a=Math.floor(i/o*e);for(;r<s;){const{start:e,end:s,name:i}=t[r];if(a<s){n(a-e,i);break}n(s-e,i),r+=1}}};function Wd({name:e,hash:t,size:n,mode:r,mtime:s,mtimeNsecs:i}){const o={path:e,cid:H.k0.parse(t),size:parseInt(n)};return null!=r&&(o.mode=parseInt(r,8)),null!=s&&(o.mtime={secs:s,nsecs:i||0}),o}function Gd(e){const t=Vd(e);return tf((()=>async function(e,n={}){return await(0,Ie.Z)(t((0,Tn.f)(e),n))}))(e)}const Jd=tf((e=>async function*(t,n={}){const r=await e.post("cat",{signal:n.signal,searchParams:sf({arg:t.toString(),...n}),headers:n.headers});yield*r.iterator()})),Zd=tf((e=>async(t={})=>(await e.post("commands",{signal:t.signal,searchParams:sf(t),headers:t.headers})).json())),Yd=tf((e=>async(t,n={})=>{const r=await e.post("dns",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers});return(await r.json()).Path})),Xd=tf((e=>()=>{const t=new URL(e.opts.base||"");return{host:t.hostname,port:t.port,protocol:t.protocol,pathname:t.pathname,"api-path":t.pathname}})),Qd=tf((e=>async function*(t,n={}){const r={arg:`${t instanceof Uint8Array?H.k0.decode(t):t}`,...n};r.compressionLevel&&(r["compression-level"]=r.compressionLevel,delete r.compressionLevel);const s=await e.post("get",{signal:n.signal,searchParams:sf(r),headers:n.headers});yield*s.iterator()})),ey=tf((e=>async function(t={}){const n=await e.post("id",{signal:t.signal,searchParams:sf({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers}),r={...Af(await n.json())};return r.id=(0,Te.jE)(r.id),r.addresses&&(r.addresses=r.addresses.map((e=>(0,F.HM)(e)))),r})),ty=e=>{const t=ey(e);return async function(e={}){const n=await t(e);return Boolean(n&&n.addresses&&n.addresses.length)}},ny=tf(((e,t)=>async function*(n,r={}){const s=`${n instanceof Uint8Array?H.k0.decode(n):n}`;async function i(e){let n=e.Hash;if(n.includes("/")){const e=n.startsWith("/ipfs/")?n:`/ipfs/${n}`;n=(await hp(t)(e)).cid}else n=H.k0.parse(n);const r={name:e.Name,path:s+(e.Name?`/${e.Name}`:""),size:e.Size,cid:n,type:ry(e)};return e.Mode&&(r.mode=parseInt(e.Mode,8)),void 0!==e.Mtime&&null!==e.Mtime&&(r.mtime={secs:e.Mtime},void 0!==e.MtimeNsecs&&null!==e.MtimeNsecs&&(r.mtime.nsecs=e.MtimeNsecs)),r}const o=await e.post("ls",{signal:r.signal,searchParams:sf({arg:s,...r}),headers:r.headers});for await(let e of o.ndjson()){if(e=e.Objects,!e)throw new Error("expected .Objects in results");if(e=e[0],!e)throw new Error("expected one array in results.Objects");const t=e.Links;if(!Array.isArray(t))throw new Error("expected one array in results.Objects[0].Links");if(!t.length)return void(yield i(e));yield*t.map(i)}}));function ry(e){switch(e.Type){case 1:case 5:return"dir";default:return"file"}}const sy=tf((e=>async function(t={}){const n=await e.post("dns",{signal:t.signal,searchParams:sf(t),headers:t.headers});return Af(await n.json())})),iy=tf((e=>async function*(t,n={}){const r=await e.post("ping",{signal:n.signal,searchParams:sf({arg:`${t}`,...n}),headers:n.headers,transform:Af});yield*r.ndjson()})),oy=tf((e=>async function(t,n={}){const r=await e.post("resolve",{signal:n.signal,searchParams:sf({arg:t,...n}),headers:n.headers}),{Path:s}=await r.json();return s})),ay=tf((e=>async(e={})=>{throw c(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")})),cy=tf((e=>async function(t={}){const n=await e.post("shutdown",{signal:t.signal,searchParams:sf(t),headers:t.headers});await n.text()})),uy=tf((e=>async function(t={}){const n=await e.post("version",{signal:t.signal,searchParams:sf(t),headers:t.headers});return{...Af(await n.json()),"ipfs-http-client":"1.0.0"}}));n(63897),n(46953);var ly=n(1247);var hy=n(43028),fy=n(34843),py=n(9425),dy=n(24143),yy=n(85275),gy=n(14560);class my extends Error{constructor(e){super(e),this.name="TimeoutError"}}class by extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const wy=e=>void 0===globalThis.DOMException?new by(e):new DOMException(e),vy=e=>{const t=void 0===e.reason?wy("This operation was aborted."):e.reason;return t instanceof Error?t:wy(t)};const Ey=(0,a.kg)("libp2p:websockets:socket");function _y(e,t,n){const r={async sink(t){null!=n?.signal&&(t=(0,bh.wJ)(t,n.signal));try{await e.sink(t)}catch(e){"aborted"!==e.type&&Ey.error(e)}},source:null!=(n=n??{}).signal?(0,bh.wJ)(e.source,n.signal):e.source,remoteAddr:t,timeline:{open:Date.now()},async close(){const t=Date.now();try{await function(e,t){const{milliseconds:n,fallback:r,message:s,customTimers:i={setTimeout:setTimeout,clearTimeout:clearTimeout}}=t;let o;const a=new Promise(((a,c)=>{if("number"!=typeof n||1!==Math.sign(n))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(n===Number.POSITIVE_INFINITY)return void a(e);if(t.signal){const{signal:e}=t;e.aborted&&c(vy(e)),e.addEventListener("abort",(()=>{c(vy(e))}))}const u=new my;o=i.setTimeout.call(void 0,(()=>{if(r)try{a(r())}catch(e){c(e)}else"function"==typeof e.cancel&&e.cancel(),!1===s?a():s instanceof Error?c(s):(u.message=s??`Promise timed out after ${n} milliseconds`,c(u))}),n),(async()=>{try{a(await e)}catch(e){c(e)}finally{i.clearTimeout.call(void 0,o)}})()}));return a.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},a}(e.close(),{milliseconds:2e3})}catch(n){const{host:s,port:i}=r.remoteAddr.toOptions();Ey("timeout closing stream to %s:%s after %dms, destroying it manually",s,i,Date.now()-t),e.destroy()}finally{r.timeline.close=Date.now()}}};return e.socket.addEventListener("close",(()=>{null==r.timeline.close&&(r.timeline.close=Date.now())}),{once:!0}),r}var ky=n(49736);const Sy=ky.C,Ty=ky.aY,Ay=function(e){let t=0;if(e=e.toString().trim(),Sy(e)){const n=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{n[t++]=255&parseInt(e,10)})),n}if(Ty(e)){const n=e.split(":",8);let r;for(r=0;r<n.length;r++){let e;Sy(n[r])&&(e=Ay(n[r]),n[r]=(0,K.B)(e.slice(0,2),"base16")),null!=e&&++r<8&&n.splice(r,0,(0,K.B)(e.slice(2,4),"base16"))}if(""===n[0])for(;n.length<8;)n.unshift("0");else if(""===n[n.length-1])for(;n.length<8;)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);const e=[r,1];for(r=9-n.length;r>0;r--)e.push("0");n.splice.apply(n,e)}const s=new Uint8Array(t+16);for(r=0;r<n.length;r++){const e=parseInt(n[r],16);s[t++]=e>>8&255,s[t++]=255&e}return s}throw new Error("invalid ip address")},Iy=function(e,t=0,n){t=~~t,n=n??e.length-t;const r=new DataView(e.buffer);if(4===n){const r=[];for(let s=0;s<n;s++)r.push(e[t+s]);return r.join(".")}if(16===n){const e=[];for(let s=0;s<n;s+=2)e.push(r.getUint16(t+s).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},xy=-1,Oy={},Py={};function Ry(e){if("number"==typeof e){if(null!=Py[e])return Py[e];throw new Error(`no protocol with code: ${e}`)}if("string"==typeof e){if(null!=Oy[e])return Oy[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,xy,"ip6zone"],[43,8,"ipcidr"],[53,xy,"dns",!0],[54,xy,"dns4",!0],[55,xy,"dns6",!0],[56,xy,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,xy,"unix",!1,!0],[421,xy,"ipfs"],[421,xy,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,xy,"garlic64"],[448,0,"tls"],[449,xy,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,xy,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,xy,"memory"]].forEach((e=>{const t=function(e,t,n,r,s){return{code:e,size:t,name:n,resolvable:Boolean(r),path:Boolean(s)}}(...e);Py[t.code]=t,Oy[t.name]=t}));var Ny=n(26104);n(9839);Ry("ip4"),Ry("ip6"),Ry("ipcidr");function Dy(e,t){switch(Ry(e).code){case 4:case 41:return function(e){const t=Iy(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!ky.h6(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Fy(t);case 6:case 273:case 33:case 132:return zy(t).toString();case 421:return function(e){const t=Ny.decode(e),n=e.slice(Ny.decode.bytes);if(n.length!==t)throw new Error("inconsistent lengths");return(0,K.B)(n,"base58btc")}(t);case 444:case 445:return $y(t);case 466:return function(e){const t=Ny.decode(e),n=e.slice(Ny.decode.bytes);if(n.length!==t)throw new Error("inconsistent lengths");return"u"+(0,K.B)(n,"base64url")}(t);default:return(0,K.B)(t,"base16")}}function Cy(e,t){switch(Ry(e).code){case 4:case 41:return My(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Uy(t);case 6:case 273:case 33:case 132:return jy(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?U.Jx(j.base58btc.decode(`z${e}`)).bytes:H.k0.parse(e).multihash.bytes;const n=Uint8Array.from(Ny.encode(t.length));return(0,Ze.z)([n,t],n.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const n=z.base32.decode("b"+t[0]),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=jy(r);return(0,Ze.z)([n,s],n.length+s.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const n=z.base32.decode(`b${t[0]}`),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=jy(r);return(0,Ze.z)([n,s],n.length+s.length)}(t);case 466:return function(e){const t=By.decode(e),n=Uint8Array.from(Ny.encode(t.length));return(0,Ze.z)([n,t],n.length+t.length)}(t);default:return(0,B.m)(t,"base16")}}const Ly=Object.values(x.gh).map((e=>e.decoder)),By=function(){let e=Ly[0].or(Ly[1]);return Ly.slice(2).forEach((t=>e=e.or(t))),e}();function My(e){if(!ky.h6(e))throw new Error("invalid ip address");return Ay(e)}function jy(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function zy(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Uy(e){const t=(0,B.m)(e),n=Uint8Array.from(Ny.encode(t.length));return(0,Ze.z)([n,t],n.length+t.length)}function Fy(e){const t=Ny.decode(e);if((e=e.slice(Ny.decode.bytes)).length!==t)throw new Error("inconsistent lengths");return(0,K.B)(e)}function $y(e){const t=e.slice(0,e.length-2),n=e.slice(e.length-2);return`${(0,K.B)(t,"base32")}:${zy(n)}`}function Hy(e){return e.map((e=>{const t=Qy(e);return null!=e[1]?[t.code,Dy(t.code,e[1])]:[t.code]}))}function Vy(e){return Jy((0,Ze.z)(e.map((e=>{const t=Qy(e);let n=Uint8Array.from(Ny.encode(t.code));return e.length>1&&null!=e[1]&&(n=(0,Ze.z)([n,e[1]])),n}))))}function Ky(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;return Ny.decode(t)+(Ny.decode.bytes??0)}function qy(e){const t=[];let n=0;for(;n<e.length;){const r=Ny.decode(e,n),s=Ny.decode.bytes??0,i=Ky(Ry(r),e.slice(n+s));if(0===i){t.push([r]),n+=s;continue}const o=e.slice(n+s,n+s+i);if(n+=i+s,n>e.length)throw Xy("Invalid address Uint8Array: "+(0,K.B)(e,"base16"));t.push([r,o])}return t}function Wy(e){return function(e){const t=[];return e.map((e=>{const n=Qy(e);return t.push(n.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),Yy(t.join("/"))}(Hy(qy(e)))}function Gy(e){const t=function(e){const t=[],n=e.split("/").slice(1);if(1===n.length&&""===n[0])return[];for(let r=0;r<n.length;r++){const s=n[r],i=Ry(s);if(0!==i.size){if(r++,r>=n.length)throw Xy("invalid address: "+e);if(!0===i.path){t.push([s,Yy(n.slice(r).join("/"))]);break}t.push([s,n[r]])}else t.push([s])}return t}(e=Yy(e));return Vy(t.map((e=>{Array.isArray(e)||(e=[e]);const t=Qy(e);return e.length>1?[t.code,Cy(t.code,e[1])]:[t.code]})))}function Jy(e){const t=Zy(e);if(null!=t)throw t;return Uint8Array.from(e)}function Zy(e){try{qy(e)}catch(e){return e}}function Yy(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Xy(e){return new Error("Error parsing address: "+e)}function Qy(e){return Ry(e[0])}var eg,tg,ng,rg,sg=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},ig=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};const og=Symbol.for("nodejs.util.inspect.custom"),ag=[Ry("dns").code,Ry("dns4").code,Ry("dns6").code,Ry("dnsaddr").code],cg=new Map,ug=Symbol.for("@multiformats/js-multiaddr/multiaddr");function lg(e){return Boolean(e?.[ug])}class hg{constructor(e){if(eg.set(this,void 0),tg.set(this,void 0),ng.set(this,void 0),this[rg]=!0,null==e&&(e=""),e instanceof Uint8Array)this.bytes=Jy(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Gy(e)}else{if(!lg(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=Jy(e.bytes)}}toString(){return null==sg(this,eg,"f")&&ig(this,eg,Wy(this.bytes),"f"),sg(this,eg,"f")}toJSON(){return this.toString()}toOptions(){let e,t,n,r,s="";const i=Ry("tcp"),o=Ry("udp"),a=Ry("ip4"),c=Ry("ip6"),u=Ry("dns6"),l=Ry("ip6zone");for(const[h,f]of this.stringTuples())h===l.code&&(s=`%${f??""}`),ag.includes(h)&&(t=i.name,r=443,n=`${f??""}${s}`,e=h===u.code?6:4),h!==i.code&&h!==o.code||(t=Ry(h).name,r=parseInt(f??"")),h!==a.code&&h!==c.code||(t=Ry(h).name,n=`${f??""}${s}`,e=h===c.code?6:4);if(null==e||null==t||null==n||null==r)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:r}}protos(){return this.protoCodes().map((e=>Object.assign({},Ry(e))))}protoCodes(){const e=[],t=this.bytes;let n=0;for(;n<t.length;){const r=Ny.decode(t,n),s=Ny.decode.bytes??0;n+=Ky(Ry(r),t.slice(n+s))+s,e.push(r)}return e}protoNames(){return this.protos().map((e=>e.name))}tuples(){return null==sg(this,tg,"f")&&ig(this,tg,qy(this.bytes),"f"),sg(this,tg,"f")}stringTuples(){return null==sg(this,ng,"f")&&ig(this,ng,Hy(this.tuples()),"f"),sg(this,ng,"f")}encapsulate(e){return e=new hg(e),new hg(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),r=n.lastIndexOf(t);if(r<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new hg(n.slice(0,r))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new hg(Vy(t.slice(0,n)));return this}getPeerId(){try{const e=this.stringTuples().filter((e=>e[0]===Oy.ipfs.code)),t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?(0,K.B)(j.base58btc.decode(`z${e}`),"base58btc"):(0,K.B)(H.k0.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){let e=null;try{e=this.stringTuples().filter((e=>!0===Ry(e[0]).path))[0][1],null==e&&(e=null)}catch{e=null}return e}equals(e){return(0,Ce.f)(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const n=cg.get(t.name);if(null==n)throw c(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map((e=>new hg(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[(eg=new WeakMap,tg=new WeakMap,ng=new WeakMap,rg=ug,og)](){return`Multiaddr(${Wy(this.bytes)})`}}function fg(e){return new hg(e)}const pg=jg("dns4"),dg=jg("dns6"),yg=jg("dnsaddr"),gg=Mg(jg("dns"),yg,pg,dg),mg=Mg(jg("ip4"),jg("ip6")),bg=Mg(Bg(mg,jg("tcp")),Bg(gg,jg("tcp"))),wg=Bg(mg,jg("udp")),vg=Bg(wg,jg("utp")),Eg=Bg(wg,jg("quic")),_g=Mg(Bg(bg,jg("ws")),Bg(gg,jg("ws"))),kg=Mg(Bg(bg,jg("wss")),Bg(gg,jg("wss")),Bg(bg,jg("tls"),jg("ws")),Bg(gg,jg("tls"),jg("ws"))),Sg=Mg(Bg(bg,jg("http")),Bg(mg,jg("http")),Bg(gg,jg("http"))),Tg=Mg(Bg(bg,jg("https")),Bg(mg,jg("https")),Bg(gg,jg("https"))),Ag=Bg(wg,jg("webrtc-direct"),jg("certhash")),Ig=Mg(Bg(Ag,jg("p2p")),Ag),xg=Mg(Bg(_g,jg("p2p-webrtc-star"),jg("p2p")),Bg(kg,jg("p2p-webrtc-star"),jg("p2p")),Bg(_g,jg("p2p-webrtc-star")),Bg(kg,jg("p2p-webrtc-star"))),Og=(Mg(Bg(_g,jg("p2p-websocket-star"),jg("p2p")),Bg(kg,jg("p2p-websocket-star"),jg("p2p")),Bg(_g,jg("p2p-websocket-star")),Bg(kg,jg("p2p-websocket-star"))),Mg(Bg(Sg,jg("p2p-webrtc-direct"),jg("p2p")),Bg(Tg,jg("p2p-webrtc-direct"),jg("p2p")),Bg(Sg,jg("p2p-webrtc-direct")),Bg(Tg,jg("p2p-webrtc-direct")))),Pg=Mg(_g,kg,Sg,Tg,xg,Og,bg,vg,Eg,gg,Ig),Rg=(Mg(Bg(Pg,jg("p2p-stardust"),jg("p2p")),Bg(Pg,jg("p2p-stardust"))),Mg(Bg(Pg,jg("p2p")),xg,Og,Ig,jg("p2p"))),Ng=Mg(Bg(Rg,jg("p2p-circuit"),Rg),Bg(Rg,jg("p2p-circuit")),Bg(jg("p2p-circuit"),Rg),Bg(Pg,jg("p2p-circuit")),Bg(jg("p2p-circuit"),Pg),jg("p2p-circuit")),Dg=()=>Mg(Bg(Ng,Dg),Ng),Cg=Dg();Mg(Bg(Cg,Rg,Cg),Bg(Rg,Cg),Bg(Cg,Rg),Cg,Rg),Mg(Bg(Cg,jg("webrtc")),Bg(Pg,jg("webrtc")),jg("webrtc"));function Lg(e){return function(t){let n;try{n=fg(t)}catch(e){return!1}const r=e(n.protoNames());return null!==r&&(!0===r||!1===r?r:0===r.length)}}function Bg(...e){function t(t){if(t.length<e.length)return null;let n=t;return e.some((e=>(n="function"==typeof e?e().partialMatch(t):e.partialMatch(t),Array.isArray(n)&&(t=n),null===n))),n}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Lg(t),partialMatch:t}}function Mg(...e){function t(t){let n=null;return e.some((e=>{const r="function"==typeof e?e().partialMatch(t):e.partialMatch(t);return null!=r&&(n=r,!0)})),n}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Lg(t),partialMatch:t}}function jg(e){const t=e;return{toString:function(){return t},matches:function(e){let n;try{n=fg(e)}catch(e){return!1}const r=n.protoNames();return 1===r.length&&r[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}var zg=n(12348);const Ug=(0,a.kg)("libp2p:websockets");class Fg{constructor(e){this.init=e}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[zg.NA](){return!0}async dial(e,t){Ug("dialing %s",e),t=t??{};const n=_y(await this._connect(e,t),e);Ug("new outbound connection %s",n.remoteAddr);const r=await t.upgrader.upgradeOutbound(n);return Ug("outbound connection %s upgraded",n.remoteAddr),r}async _connect(e,t){if(!0===t?.signal?.aborted)throw new Ct._;const n=e.toOptions();Ug("dialing %s:%s",n.host,n.port);const r=(0,yy.Z)(),s=e=>{Ug.error("connection error:",e),r.reject(e)},i=(0,dy.$)((0,$i.k)(e),this.init);if(null!=i.socket.on?i.socket.on("error",s):i.socket.onerror=s,null==t.signal)return await Promise.race([i.connected(),r.promise]),Ug("connected %s",e),i;let o;const a=new Promise(((e,n)=>{o=()=>{n(new Ct._),i.close().catch((e=>{Ug.error("error closing raw socket",e)}))},!0!==t?.signal?.aborted?t?.signal?.addEventListener("abort",o):o()}));try{await Promise.race([a,r.promise,i.connected()])}finally{null!=o&&t?.signal?.removeEventListener("abort",o)}return Ug("connected %s",e),i}createListener(e){return function(){throw new Error("WebSocket Servers can not be created in the browser!")}(this.init)}filter(e){return e=Array.isArray(e)?e:[e],null!=this.init?.filter?this.init?.filter(e):gy.jU||gy.n2?function(e){return e.filter((e=>{if(e.protoCodes().includes(290))return!1;const t=e.decapsulateCode(421);return kg.matches(t)}))}(e):function(e){return e.filter((e=>{if(e.protoCodes().includes(290))return!1;const t=e.decapsulateCode(421);return _g.matches(t)||kg.matches(t)}))}(e)}}var $g=n(75306),Hg=n(51816);function Vg(e,t={}){const n=(0,Hg.Y)(e),r=wh.J.fromReader(n.reader,t),s={read:async e=>{const{value:t}=await n.reader.next(e);if(null==t)throw new Error("Value is null");return t},readLP:async()=>{const{value:e}=await r.next();if(null==e)throw new Error("Value is null");return e},readPB:async e=>{const t=await s.readLP();if(null==t)throw new Error("Value is null");const n=t instanceof Uint8Array?t:t.subarray();return e.decode(n)},write:e=>{e instanceof Uint8Array?n.writer.push(e):n.writer.push(e.subarray())},writeLP:e=>{s.write(wh.c.single(e,t))},writePB:(e,t)=>{s.writeLP(t.encode(e))},pb:e=>({read:async()=>await s.readPB(e),write:t=>{s.writePB(t,e)},unwrap:()=>s}),unwrap:()=>(n.rest(),e.source=n.stream.source,e.sink=n.stream.sink,e)};return s}function Kg(){const e=(0,yy.Z)();let t=!1;return{sink:async n=>{if(t)throw new Error("already piped");t=!0,e.resolve(n)},source:async function*(){const t=await e.promise;yield*t}()}}const qg=65535,Wg=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var Gg=n(512),Jg=n(57664),Zg=n(73294),Yg=n(15501);const Xg={hashSHA256:e=>(0,Zg.vp)(e),getHKDF(e,t){const n=new Gg.t(Zg.mE,t,e).expand(96);return[n.subarray(0,32),n.subarray(32,64),n.subarray(64,96)]},generateX25519KeyPair(){const e=Jg.Au();return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519KeyPairFromSeed(e){const t=Jg._w(e);return{publicKey:t.publicKey,privateKey:t.secretKey}},generateX25519SharedKey:(e,t)=>Jg.gi(e,t),chaCha20Poly1305Encrypt:(e,t,n,r)=>new Yg.OK(r).seal(t,e,n),chaCha20Poly1305Decrypt:(e,t,n,r,s)=>new Yg.OK(r).open(t,e,n,s)},Qg=e=>{const t=(n=2,globalThis.Buffer?globalThis.Buffer.allocUnsafe(n):new Uint8Array(n));var n;return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};Qg.bytes=2;const em=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};em.bytes=2;var tm,nm,rm=n(19859),sm=n(46888);async function im(e,t,n){const r=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");const n=await(0,Be.unmarshalPrivateKey)(e.privateKey);return await n.sign(t)}(e,cm(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,n){return nm.encode({identityKey:e,identitySig:t,extensions:n??{webtransportCerthashes:[]}}).subarray()}(e.publicKey,r,n)}async function om(e){return await(0,Te.y5)(e.identityKey)}function am(e){return nm.decode(e)}function cm(e){const t=(0,B.m)("noise-libp2p-static-key:");return(0,Ze.z)([t,e],t.length+e.length)}async function um(e,t,n){const r=await(0,Te.y5)(t.identityKey);if(!r.equals(n))throw new Error(`Payload identity key ${r.toString()} does not match expected remote peer ${n.toString()}`);const s=cm(e);if(null==r.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const i=(0,Be.unmarshalPublicKey)(r.publicKey);if(!await i.verify(s,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return r}function lm(e){return e instanceof Uint8Array&&32===e.length}!function(e){let t;e.codec=()=>(null==t&&(t=(0,sm.yw)(((e,t,n={})=>{if(!1!==n.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const n of e.webtransportCerthashes)t.uint32(10),t.bytes(n);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={webtransportCerthashes:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();if(t>>>3==1)n.webtransportCerthashes.push(e.bytes());else e.skipType(7&t)}return n}))),t),e.encode=t=>(0,sm.LE)(t,e.codec()),e.decode=t=>(0,sm.C6)(t,e.codec())}(tm||(tm={})),function(e){let t;e.codec=()=>(null==t&&(t=(0,sm.yw)(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.identityKey&&e.identityKey.byteLength>0)&&(t.uint32(10),t.bytes(e.identityKey??new Uint8Array(0))),(!0===n.writeDefaults||null!=e.identitySig&&e.identitySig.byteLength>0)&&(t.uint32(18),t.bytes(e.identitySig??new Uint8Array(0))),null!=e.extensions&&(t.uint32(34),tm.codec().encode(e.extensions,t,{writeDefaults:!1})),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=tm.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>(0,sm.LE)(t,e.codec()),e.decode=t=>(0,sm.C6)(t,e.codec())}(nm||(nm={}));var hm=n(738);const fm=(0,a.kg)("libp2p:noise");let pm;function dm(e){e?(pm(`LOCAL_PUBLIC_EPHEMERAL_KEY ${(0,K.B)(e.publicKey,"hex")}`),pm(`LOCAL_PRIVATE_EPHEMERAL_KEY ${(0,K.B)(e.privateKey,"hex")}`)):pm("Missing local ephemeral keys.")}function ym(e){pm(`REMOTE_EPHEMERAL_PUBLIC_KEY ${(0,K.B)(e,"hex")}`)}pm=Wg?fm:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});class gm{constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}class mm{constructor(e){this.crypto=e}encryptWithAd(e,t,n){const r=this.encrypt(e.k,e.n,t,n);return e.n.increment(),r}decryptWithAd(e,t,n,r){const{plaintext:s,valid:i}=this.decrypt(e.k,e.n,t,n,r);return i&&e.n.increment(),{plaintext:s,valid:i}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){const t=this.createEmptyKey();return(0,Ce.f)(t,e)}encrypt(e,t,n,r){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(r,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return n=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,n),n}decrypt(e,t,n,r,s){t.assertValue();const i=this.crypto.chaCha20Poly1305Decrypt(r,t.getBytes(),n,e,s);return i?{plaintext:i,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let n,r=!0;return this.hasKey(e.cs)?({plaintext:n,valid:r}=this.decryptWithAd(e.cs,e.h,t)):n=t,this.mixHash(e,t),{plaintext:n,valid:r}}dh(e,t){try{const n=this.crypto.generateX25519SharedKey(e,t);return 32===n.length?n:n.subarray(0,32)}catch(e){return fm(e.message),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256((0,Ze.z)([e,t],e.length+t.length))}mixKey(e,t){const[n,r]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(r),e.ck=n}initializeKey(e){return{k:e,n:new gm}}initializeSymmetric(e){const t=(0,hm.mL)(e,"utf-8"),n=this.hashProtocolName(t),r=n,s=this.createEmptyKey();return{cs:this.initializeKey(s),ck:r,h:n}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}return this.getHash(e,new Uint8Array(0))}split(e){const[t,n]=this.crypto.getHKDF(e.ck,new Uint8Array(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(n)}}writeMessageRegular(e,t){const n=this.encryptWithAd(e,new Uint8Array(0),t);return{ne:this.createEmptyKey(),ns:new Uint8Array(0),ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class bm extends mm{initializeInitiator(e,t,n,r){const s=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(s,e);return{ss:s,s:t,rs:n,psk:r,re:new Uint8Array(32)}}initializeResponder(e,t,n,r){const s=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(s,e);return{ss:s,s:t,rs:n,psk:r,re:new Uint8Array(32)}}writeMessageA(e,t,n){const r=new Uint8Array(0);e.e=void 0!==n?n:this.crypto.generateX25519KeyPair();const s=e.e.publicKey;this.mixHash(e.ss,s);return{ne:s,ns:r,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const r=e.s.publicKey,s=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));return{ne:n,ns:s,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const n=e.s.publicKey,r=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const s=this.encryptAndHash(e.ss,t),i={ne:this.createEmptyKey(),ns:r,ciphertext:s},{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:i,cs1:o,cs2:a}}readMessageA(e,t){return lm(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(lm(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);r&&lm(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:s,valid:r&&i}}readMessageC(e,t){const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);if(r&&lm(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:s,valid:r&&i,cs1:o,cs2:a}}initSession(e,t,n){const r=this.createEmptyKey(),s=new Uint8Array(32);let i;return i=e?this.initializeInitiator(t,n,s,r):this.initializeResponder(t,n,s,r),{hs:i,i:e,mc:0}}sendMessage(e,t,n){let r;if(0===e.mc)r=this.writeMessageA(e.hs,t,n);else if(1===e.mc)r=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:n,messageBuffer:s,cs1:i,cs2:o}=this.writeMessageC(e.hs,t);r=s,e.h=n,e.cs1=i,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(e.cs2,t)}}return e.mc++,r}recvMessage(e,t){let n=new Uint8Array(0),r=!1;if(0===e.mc)({plaintext:n,valid:r}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:n,valid:r}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:s,plaintext:i,valid:o,cs1:a,cs2:c}=this.readMessageC(e.hs,t);n=i,r=o,e.h=s,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:n,valid:r}}}class wm{constructor(e,t,n,r,s,i,o,a){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=n,this.staticKeypair=s,this.connection=i,o&&(this.remotePeer=o),this.xx=a??new bm(r),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){var e;if(e=this.session.hs.s,pm(`LOCAL_STATIC_PUBLIC_KEY ${(0,K.B)(e.publicKey,"hex")}`),pm(`LOCAL_STATIC_PRIVATE_KEY ${(0,K.B)(e.privateKey,"hex")}`),this.isInitiator){fm("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(function(e){return(0,Ze.z)([e.ne,e.ciphertext],e.ne.length+e.ciphertext.length)}(e)),fm("Stage 0 - Initiator finished sending first message."),dm(this.session.hs.e)}else{fm("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:new Uint8Array(0)}}((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new rm.kz("xx handshake stage 0 validation fail");fm("Stage 0 - Responder received first message."),ym(this.session.hs.re)}}async exchange(){if(this.isInitiator){fm("Stage 1 - Initiator waiting to receive first message from responder...");const t=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.readLP()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,t);if(!r)throw new rm.kz("xx handshake stage 1 validation fail");fm("Stage 1 - Initiator received the message."),ym(this.session.hs.re),e=this.session.hs.rs,pm(`REMOTE_STATIC_PUBLIC_KEY ${(0,K.B)(e,"hex")}`),fm("Initiator going to check remote's signature...");try{const e=am(n);this.remotePeer=this.remotePeer||await om(e),await um(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new rm.kT(`Error occurred while verifying signed payload: ${t.message}`)}fm("All good with the signature!")}else{fm("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(function(e){return(0,Ze.z)([e.ne,e.ns,e.ciphertext],e.ne.length+e.ns.length+e.ciphertext.length)}(e)),fm("Stage 1 - Responder sent the second handshake message with signed payload."),dm(this.session.hs.e)}var e}async finish(){if(this.isInitiator){fm("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(function(e){return(0,Ze.z)([e.ns,e.ciphertext],e.ns.length+e.ciphertext.length)}(e)),fm("Stage 2 - Initiator sent message with signed payload.")}else{fm("Stage 2 - Responder waiting for third handshake message...");const e=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new rm.kz("xx handshake stage 2 validation fail");fm("Stage 2 - Responder received the message, finished handshake.");try{const e=am(t);this.remotePeer=this.remotePeer||await om(e),await um(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new rm.kT(`Error occurred while verifying signed payload: ${t.message}`)}}var e;(e=this.session).cs1&&e.cs2?(pm(`CIPHER_STATE_1 ${e.cs1.n.getUint64()} ${(0,K.B)(e.cs1.k,"hex")}`),pm(`CIPHER_STATE_2 ${e.cs2.n.getUint64()} ${(0,K.B)(e.cs2.k,"hex")}`)):pm("Missing cipher state.")}encrypt(e,t){const n=this.getCS(t);return this.xx.encryptWithAd(n,new Uint8Array(0),e)}decrypt(e,t,n){const r=this.getCS(t,!1);return this.xx.decryptWithAd(r,new Uint8Array(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new rm.kz("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}class vm{constructor(e={}){this.protocol="/noise";const{staticNoiseKey:t,extensions:n,crypto:r,prologueBytes:s,metrics:i}=e;this.crypto=r??Xg,this.extensions=n,this.metrics=i?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(i):void 0,this.staticKeys=t?this.crypto.generateX25519KeyPairFromSeed(t):this.crypto.generateX25519KeyPair(),this.prologue=s??new Uint8Array(0)}async secureOutbound(e,t,n){const r=Vg(t,{lengthEncoder:Qg,lengthDecoder:em,maxDataLength:qg}),s=await this.performHandshake({connection:r,isInitiator:!0,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(r,s),remoteExtensions:s.remoteExtensions,remotePeer:s.remotePeer}}async secureInbound(e,t,n){const r=Vg(t,{lengthEncoder:Qg,lengthDecoder:em,maxDataLength:qg}),s=await this.performHandshake({connection:r,isInitiator:!1,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(r,s),remotePeer:s.remotePeer,remoteExtensions:s.remoteExtensions}}async performHandshake(e){const t=await im(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:n,remotePeer:r,connection:s}=e,i=new wm(n,t,this.prologue,this.crypto,this.staticKeys,s,r);try{await i.propose(),await i.exchange(),await i.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(e){if(this.metrics?.xxHandshakeErrors.increment(),e instanceof Error)throw e.message=`Error occurred during XX handshake: ${e.message}`,e}return i}async createSecureConnection(e,t){const[n,r]=function(){const e=Kg(),t=Kg();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),s=e.unwrap();return await(0,_n.zG)(n,function(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=65519){let s=n+65519;s>r.length&&(s=r.length);const i=e.encrypt(r.subarray(n,s),e.session);t?.encryptedPackets.increment(),yield Qg(i.byteLength),yield i}}}(t,this.metrics),s,(0,wh.J)({lengthDecoder:em}),function(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=qg){let s=n+qg;if(s>r.length&&(s=r.length),s-Yg.pg<n)throw new Error("Invalid chunk");const i=r.subarray(n,s),o=r.subarray(n,s-Yg.pg),{plaintext:a,valid:c}=e.decrypt(i,e.session,o);if(!c)throw t?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");t?.decryptedPackets.increment(),yield a}}}(t,this.metrics),n),r}}function Em(e={}){return()=>new vm(e)}const _m=i.Z.bind({ignoreUndefined:!0,concatArrays:!0});function km({options:e={},peerId:t,multiaddrs:n=[],repo:r,keychainConfig:s={},config:i={}}){const{datastore:o}=r,a=function({options:e,config:t,datastore:n,keychainConfig:r,peerId:s,multiaddrs:i}){const o=()=>{const e=Rt(t,"Pubsub.Router")||"gossipsub",n=jh();if(!n[e])throw c(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${e} router.`),"ERR_NOT_SUPPORTED");return n[e]},a={datastore:n,peerId:s},u={addresses:{listen:i.map((e=>e.toString())),announce:Rt(e,"addresses.announce",Rt(t,"Addresses.Announce",[])),noAnnounce:Rt(e,"addresses.noAnnounce",Rt(t,"Addresses.NoAnnounce",[]))},connectionManager:Rt(e,"connectionManager",{maxConnections:Rt(e,"config.Swarm.ConnMgr.HighWater",Rt(t,"Swarm.ConnMgr.HighWater")),minConnections:Rt(e,"config.Swarm.ConnMgr.LowWater",Rt(t,"Swarm.ConnMgr.LowWater"))}),keychain:r,identify:{host:{agentVersion:`js-ipfs/${Ys}`}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[(0,$g.R)({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[Em()],relay:{enabled:Rt(e,"relay.enabled",Rt(t,"relay.enabled",!0)),hop:{enabled:Rt(e,"relay.hop.enabled",Rt(t,"relay.hop.enabled",!1)),active:Rt(e,"relay.hop.active",Rt(t,"relay.hop.active",!1))}},nat:{enabled:!Rt(t,"Swarm.DisableNatPortMap",!1)}};Rt(e,"config.Pubsub.Enabled",Rt(t,"Pubsub.Enabled",!0))&&(u.pubsub=o());"none"!==Rt(t,"Routing.Type","dhtclient")&&(u.dht=(0,fy.p)({clientMode:"dhtserver"!==Rt(t,"Routing.Type","dht"),kBucketSize:Rt(e,"dht.kBucketSize",20),validators:{ipns:wt},selectors:{ipns:Nt}}));const l=Rt(e,"config.Bootstrap",Rt(t,"Bootstrap",[]));l.length>0&&u.peerDiscovery?.push((0,py.U)({list:l}));let h=Rt(e,"libp2p",void 0);"function"==typeof h&&(h=void 0);const f=_m(a,function(){const e=(0,ly.n)();return{transports:[e.transport],peerDiscovery:[e.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1}}}(),u,h),p=Rt(e,"config.Addresses.Delegates",Rt(t,"Addresses.Delegates",[]));if(p.length>0){const e=p[Math.floor(Math.random()*p.length)],t=(0,F.HM)(e).toOptions(),n=function(e={}){const t={name:I.identity.name,code:I.identity.code,encode:e=>e,decode:e=>e},n=Object.values(x.gh);(e.ipld&&e.ipld.bases?e.ipld.bases:[]).forEach((e=>n.push(e)));const r=new Fh.x({bases:n,loadBase:e.ipld&&e.ipld.loadBase}),s=Object.values(x.QB);[k,S,T,A,t].concat(e.ipld&&e.ipld.codecs||[]).forEach((e=>s.push(e)));const i=new $h.w({codecs:s,loadCodec:e.ipld&&e.ipld.loadCodec}),o=Object.values(x.kq);(e.ipld&&e.ipld.hashers?e.ipld.hashers:[]).forEach((e=>o.push(e)));const a=new Hh.d({hashers:o,loadHasher:e.ipld&&e.ipld.loadHasher});return{add:Gd(e),addAll:Vd(e),bitswap:lf(e),block:bf(e),bootstrap:Sf(e),cat:Jd(e),commands:Zd(e),config:Cf(e),dag:Ff(i,e),dht:Jf(e),diag:Qf(e),dns:Yd(e),files:dp(e),get:Qd(e),getEndpointConfig:Xd(e),id:ey(e),isOnline:ty(e),key:_p(e),log:Ap(e),ls:ny(e),mount:sy(e),name:Dp(e),object:Kp(i,e),pin:yd(e),ping:iy(e),pubsub:Od(e),refs:Rd(e),repo:Ld(e),resolve:oy(e),start:ay(e),stats:Md(e),stop:cy(e),swarm:Hd(e),version:uy(e),bases:r,codecs:i,hashers:a}}({host:t.host,protocol:443===parseInt(t.port)?"https":"http",port:t.port});f.contentRouters?.push((0,Uh.OP)(n)),f.peerRouters?.push((0,zh.e8)(n))}Rt(e,"config.Discovery.MDNS.Enabled",Rt(t,"Discovery.MDNS.Enabled",!0))||(f.peerDiscovery=f.peerDiscovery?.filter((e=>{try{if("function"==typeof e)return"@libp2p/mdns"!==e({})[Symbol.toStringTag]}catch{}return!0})));null==f.transports&&(f.transports=[]);null==f.transports.find((e=>{try{if("function"==typeof e)return"@libp2p/websockets"===e({})[Symbol.toStringTag]}catch{}return!1}))&&f.transports.push(function(e={}){return()=>new Fg(e)}());return f}({options:e,config:i,datastore:o,keychainConfig:s,peerId:t,multiaddrs:n});return"function"==typeof e.libp2p?e.libp2p({libp2pOptions:a,options:e,config:i,datastore:o,peerId:t}):(a.start=!1,(0,hy.N)(a))}var Sm=n(21017);const Tm=i.Z.bind({ignoreUndefined:!0}),Am=(0,a.kg)("ipfs:components:peer:storage");class Im{constructor(e,t,n,r,s){this.print=r,this.peerId=e,this.keychain=t,this.repo=n,this.print=r,this.isNew=s}static async start(e,t,n){const{repoAutoMigrate:r,repo:s,onMigrationProgress:i}=n,o="string"==typeof s||null==s?kl(e,t,{path:s,autoMigrate:r,onMigrationProgress:i}):s,{peerId:a,keychain:c,isNew:u}=await xm(e,o,n);return new Im(a,c,o,e,u)}}const xm=async(e,t,n)=>{if(!t.closed)return{...await Dm(t,n),isNew:!1};try{return await t.open(),{...await Dm(t,n),isNew:!1}}catch(r){if(r.code!==Ru)throw r;if(n.init&&!1===n.init.allowNew)throw new L("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await Om(e,t,n),isNew:!0}}},Om=async(e,t,n)=>{const r=n.init||{},s=await t.exists();if(Am("repo exists?",s),!0===s)throw new Error("repo already exists");const i=r.privateKey?await Pm(r.privateKey):await Rm(e,r),o=Nm(i);Am("peer identity: %s",o.PeerID);const a={...Tm(Lm(mn(),r.profiles),n.config),Identity:o};await t.init(a),await t.open(),Am("repo opened");const c={pass:n.pass};try{c.dek=await t.config.get("Keychain.DEK")}catch(e){if("ERR_NOT_FOUND"!==e.code)throw e}const u=await km({options:void 0,multiaddrs:void 0,peerId:i,repo:t,config:a,keychainConfig:c});return await t.datastore.has(new ne.s("/info/self"))||await u.keychain.importPeer("self",i),await t.config.set("Keychain",{DEK:u.keychain.init.dek}),{peerId:i,keychain:u.keychain}},Pm=async e=>{if(Am("using user-supplied private-key"),(0,Ne.I)(e))return e;const t=(0,B.m)(e,"base64pad"),n=await(0,Be.unmarshalPrivateKey)(t);return await(0,Te.y5)(n.public.bytes,n.bytes)},Rm=(e,{algorithm:t="Ed25519",bits:n=2048})=>{if(e("generating %s keypair...",t),"Ed25519"===t)return(0,Sm.n9)();if("RSA"===t)return(0,Sm.W$)({bits:n});throw c(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},Nm=e=>{if(null==e.privateKey)throw c(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:e.toString(),PrivKey:(0,K.B)(e.privateKey,"base64pad")}},Dm=async(e,t)=>{const n=t.config,r=t.init&&t.init.profiles||[],s=t.pass,i=await e.config.getAll(),o=Cm(Lm(i,r),n);if(i!==o&&await e.config.replace(o),!o.Identity||!o.Identity.PrivKey)throw new O("No private key was found in the config, please intialize the repo");const a=(0,B.m)(o.Identity.PrivKey,"base64pad"),c=await(0,Be.unmarshalPrivateKey)(a),u=await(0,Te.y5)(c.public.bytes,c.bytes);return{peerId:u,keychain:(await km({options:void 0,multiaddrs:void 0,peerId:u,repo:e,config:o,keychainConfig:{pass:s,...o.Keychain}})).keychain}},Cm=(e,t)=>t?Tm(e,t):e,Lm=(e,t)=>(t||[]).reduce(((e,t)=>{const n=ni[t];if(!n)throw new Error(`Could not find profile with name '${t}'`);return Am("applying profile %s",t),n.transform(e)}),e);var Bm=n(82838),Mm=n(77308);var jm=function(e){let t=new Uint8Array(e.reduce(((e,t)=>e+Mm.encodingLength(t)),0)),n=0;for(const r of e)t=Mm.encode(r,t,n),n+=Mm.encodingLength(r);return t};class zm{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(j.base58btc)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}}var Um=n(63655);const Fm=Um.Reader,$m=Um.Writer,Hm=Um.util,Vm=Um.roots["ipfs-bitswap"]||(Um.roots["ipfs-bitswap"]={}),Km=Vm.Message=(()=>{function e(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.wantlist=null,e.prototype.blocks=Hm.emptyArray,e.prototype.payload=Hm.emptyArray,e.prototype.blockPresences=Hm.emptyArray,e.prototype.pendingBytes=0,e.encode=function(e,t){if(t||(t=$m.create()),null!=e.wantlist&&Object.hasOwnProperty.call(e,"wantlist")&&Vm.Message.Wantlist.encode(e.wantlist,t.uint32(10).fork()).ldelim(),null!=e.blocks&&e.blocks.length)for(var n=0;n<e.blocks.length;++n)t.uint32(18).bytes(e.blocks[n]);if(null!=e.payload&&e.payload.length)for(n=0;n<e.payload.length;++n)Vm.Message.Block.encode(e.payload[n],t.uint32(26).fork()).ldelim();if(null!=e.blockPresences&&e.blockPresences.length)for(n=0;n<e.blockPresences.length;++n)Vm.Message.BlockPresence.encode(e.blockPresences[n],t.uint32(34).fork()).ldelim();return null!=e.pendingBytes&&Object.hasOwnProperty.call(e,"pendingBytes")&&t.uint32(40).int32(e.pendingBytes),t},e.decode=function(e,t){e instanceof Fm||(e=Fm.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Vm.Message;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.wantlist=Vm.Message.Wantlist.decode(e,e.uint32());break;case 2:r.blocks&&r.blocks.length||(r.blocks=[]),r.blocks.push(e.bytes());break;case 3:r.payload&&r.payload.length||(r.payload=[]),r.payload.push(Vm.Message.Block.decode(e,e.uint32()));break;case 4:r.blockPresences&&r.blockPresences.length||(r.blockPresences=[]),r.blockPresences.push(Vm.Message.BlockPresence.decode(e,e.uint32()));break;case 5:r.pendingBytes=e.int32();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Vm.Message)return e;var t=new Vm.Message;if(null!=e.wantlist){if("object"!=typeof e.wantlist)throw TypeError(".Message.wantlist: object expected");t.wantlist=Vm.Message.Wantlist.fromObject(e.wantlist)}if(e.blocks){if(!Array.isArray(e.blocks))throw TypeError(".Message.blocks: array expected");t.blocks=[];for(var n=0;n<e.blocks.length;++n)"string"==typeof e.blocks[n]?Hm.base64.decode(e.blocks[n],t.blocks[n]=Hm.newBuffer(Hm.base64.length(e.blocks[n])),0):e.blocks[n].length>=0&&(t.blocks[n]=e.blocks[n])}if(e.payload){if(!Array.isArray(e.payload))throw TypeError(".Message.payload: array expected");t.payload=[];for(n=0;n<e.payload.length;++n){if("object"!=typeof e.payload[n])throw TypeError(".Message.payload: object expected");t.payload[n]=Vm.Message.Block.fromObject(e.payload[n])}}if(e.blockPresences){if(!Array.isArray(e.blockPresences))throw TypeError(".Message.blockPresences: array expected");t.blockPresences=[];for(n=0;n<e.blockPresences.length;++n){if("object"!=typeof e.blockPresences[n])throw TypeError(".Message.blockPresences: object expected");t.blockPresences[n]=Vm.Message.BlockPresence.fromObject(e.blockPresences[n])}}return null!=e.pendingBytes&&(t.pendingBytes=0|e.pendingBytes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.blocks=[],n.payload=[],n.blockPresences=[]),t.defaults&&(n.wantlist=null,n.pendingBytes=0),null!=e.wantlist&&e.hasOwnProperty("wantlist")&&(n.wantlist=Vm.Message.Wantlist.toObject(e.wantlist,t)),e.blocks&&e.blocks.length){n.blocks=[];for(var r=0;r<e.blocks.length;++r)n.blocks[r]=t.bytes===String?Hm.base64.encode(e.blocks[r],0,e.blocks[r].length):t.bytes===Array?Array.prototype.slice.call(e.blocks[r]):e.blocks[r]}if(e.payload&&e.payload.length){n.payload=[];for(r=0;r<e.payload.length;++r)n.payload[r]=Vm.Message.Block.toObject(e.payload[r],t)}if(e.blockPresences&&e.blockPresences.length){n.blockPresences=[];for(r=0;r<e.blockPresences.length;++r)n.blockPresences[r]=Vm.Message.BlockPresence.toObject(e.blockPresences[r],t)}return null!=e.pendingBytes&&e.hasOwnProperty("pendingBytes")&&(n.pendingBytes=e.pendingBytes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Um.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message"},e.Wantlist=function(){function e(e){if(this.entries=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.entries=Hm.emptyArray,e.prototype.full=!1,e.encode=function(e,t){if(t||(t=$m.create()),null!=e.entries&&e.entries.length)for(var n=0;n<e.entries.length;++n)Vm.Message.Wantlist.Entry.encode(e.entries[n],t.uint32(10).fork()).ldelim();return null!=e.full&&Object.hasOwnProperty.call(e,"full")&&t.uint32(16).bool(e.full),t},e.decode=function(e,t){e instanceof Fm||(e=Fm.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Vm.Message.Wantlist;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.entries&&r.entries.length||(r.entries=[]),r.entries.push(Vm.Message.Wantlist.Entry.decode(e,e.uint32()));break;case 2:r.full=e.bool();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Vm.Message.Wantlist)return e;var t=new Vm.Message.Wantlist;if(e.entries){if(!Array.isArray(e.entries))throw TypeError(".Message.Wantlist.entries: array expected");t.entries=[];for(var n=0;n<e.entries.length;++n){if("object"!=typeof e.entries[n])throw TypeError(".Message.Wantlist.entries: object expected");t.entries[n]=Vm.Message.Wantlist.Entry.fromObject(e.entries[n])}}return null!=e.full&&(t.full=Boolean(e.full)),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.entries=[]),t.defaults&&(n.full=!1),e.entries&&e.entries.length){n.entries=[];for(var r=0;r<e.entries.length;++r)n.entries[r]=Vm.Message.Wantlist.Entry.toObject(e.entries[r],t)}return null!=e.full&&e.hasOwnProperty("full")&&(n.full=e.full),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Um.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Wantlist"},e.WantType=function(){const e={},t=Object.create(e);return t[e[0]="Block"]=0,t[e[1]="Have"]=1,t}(),e.Entry=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.block=Hm.newBuffer([]),e.prototype.priority=0,e.prototype.cancel=!1,e.prototype.wantType=0,e.prototype.sendDontHave=!1,e.encode=function(e,t){return t||(t=$m.create()),null!=e.block&&Object.hasOwnProperty.call(e,"block")&&t.uint32(10).bytes(e.block),null!=e.priority&&Object.hasOwnProperty.call(e,"priority")&&t.uint32(16).int32(e.priority),null!=e.cancel&&Object.hasOwnProperty.call(e,"cancel")&&t.uint32(24).bool(e.cancel),null!=e.wantType&&Object.hasOwnProperty.call(e,"wantType")&&t.uint32(32).int32(e.wantType),null!=e.sendDontHave&&Object.hasOwnProperty.call(e,"sendDontHave")&&t.uint32(40).bool(e.sendDontHave),t},e.decode=function(e,t){e instanceof Fm||(e=Fm.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Vm.Message.Wantlist.Entry;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.block=e.bytes();break;case 2:r.priority=e.int32();break;case 3:r.cancel=e.bool();break;case 4:r.wantType=e.int32();break;case 5:r.sendDontHave=e.bool();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Vm.Message.Wantlist.Entry)return e;var t=new Vm.Message.Wantlist.Entry;switch(null!=e.block&&("string"==typeof e.block?Hm.base64.decode(e.block,t.block=Hm.newBuffer(Hm.base64.length(e.block)),0):e.block.length>=0&&(t.block=e.block)),null!=e.priority&&(t.priority=0|e.priority),null!=e.cancel&&(t.cancel=Boolean(e.cancel)),e.wantType){case"Block":case 0:t.wantType=0;break;case"Have":case 1:t.wantType=1}return null!=e.sendDontHave&&(t.sendDontHave=Boolean(e.sendDontHave)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.block="":(n.block=[],t.bytes!==Array&&(n.block=Hm.newBuffer(n.block))),n.priority=0,n.cancel=!1,n.wantType=t.enums===String?"Block":0,n.sendDontHave=!1),null!=e.block&&e.hasOwnProperty("block")&&(n.block=t.bytes===String?Hm.base64.encode(e.block,0,e.block.length):t.bytes===Array?Array.prototype.slice.call(e.block):e.block),null!=e.priority&&e.hasOwnProperty("priority")&&(n.priority=e.priority),null!=e.cancel&&e.hasOwnProperty("cancel")&&(n.cancel=e.cancel),null!=e.wantType&&e.hasOwnProperty("wantType")&&(n.wantType=t.enums===String?Vm.Message.Wantlist.WantType[e.wantType]:e.wantType),null!=e.sendDontHave&&e.hasOwnProperty("sendDontHave")&&(n.sendDontHave=e.sendDontHave),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Um.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Wantlist.Entry"},e}(),e}(),e.Block=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.prefix=Hm.newBuffer([]),e.prototype.data=Hm.newBuffer([]),e.encode=function(e,t){return t||(t=$m.create()),null!=e.prefix&&Object.hasOwnProperty.call(e,"prefix")&&t.uint32(10).bytes(e.prefix),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,t){e instanceof Fm||(e=Fm.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Vm.Message.Block;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.prefix=e.bytes();break;case 2:r.data=e.bytes();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Vm.Message.Block)return e;var t=new Vm.Message.Block;return null!=e.prefix&&("string"==typeof e.prefix?Hm.base64.decode(e.prefix,t.prefix=Hm.newBuffer(Hm.base64.length(e.prefix)),0):e.prefix.length>=0&&(t.prefix=e.prefix)),null!=e.data&&("string"==typeof e.data?Hm.base64.decode(e.data,t.data=Hm.newBuffer(Hm.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.prefix="":(n.prefix=[],t.bytes!==Array&&(n.prefix=Hm.newBuffer(n.prefix))),t.bytes===String?n.data="":(n.data=[],t.bytes!==Array&&(n.data=Hm.newBuffer(n.data)))),null!=e.prefix&&e.hasOwnProperty("prefix")&&(n.prefix=t.bytes===String?Hm.base64.encode(e.prefix,0,e.prefix.length):t.bytes===Array?Array.prototype.slice.call(e.prefix):e.prefix),null!=e.data&&e.hasOwnProperty("data")&&(n.data=t.bytes===String?Hm.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Um.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Block"},e}(),e.BlockPresenceType=function(){const e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),e.BlockPresence=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.cid=Hm.newBuffer([]),e.prototype.type=0,e.encode=function(e,t){return t||(t=$m.create()),null!=e.cid&&Object.hasOwnProperty.call(e,"cid")&&t.uint32(10).bytes(e.cid),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(16).int32(e.type),t},e.decode=function(e,t){e instanceof Fm||(e=Fm.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new Vm.Message.BlockPresence;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:r.cid=e.bytes();break;case 2:r.type=e.int32();break;default:e.skipType(7&s)}}return r},e.fromObject=function(e){if(e instanceof Vm.Message.BlockPresence)return e;var t=new Vm.Message.BlockPresence;switch(null!=e.cid&&("string"==typeof e.cid?Hm.base64.decode(e.cid,t.cid=Hm.newBuffer(Hm.base64.length(e.cid)),0):e.cid.length>=0&&(t.cid=e.cid)),e.type){case"Have":case 0:t.type=0;break;case"DontHave":case 1:t.type=1}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.cid="":(n.cid=[],t.bytes!==Array&&(n.cid=Hm.newBuffer(n.cid))),n.type=t.enums===String?"Have":0),null!=e.cid&&e.hasOwnProperty("cid")&&(n.cid=t.bytes===String?Hm.base64.encode(e.cid,0,e.cid.length):t.bytes===Array?Array.prototype.slice.call(e.cid):e.cid),null!=e.type&&e.hasOwnProperty("type")&&(n.type=t.enums===String?Vm.Message.BlockPresenceType[e.type]:e.type),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Um.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.BlockPresence"},e}(),e})();var qm=n(20199);const Wm=Km.Wantlist.WantType.Block,Gm=Km.Wantlist.WantType.Have;class Jm{constructor(e,t){this.set=t?(0,qm.s)({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){const r=e.toString(j.base58btc),s=this.set.get(r);s?(s.inc(),s.priority=t,s.wantType===Gm&&n===Wm&&(s.wantType=n)):(this.set.set(r,new zm(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){const t=e.toString(j.base58btc),n=this.set.get(t);n&&(n.dec(),n.hasRefs()||(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map((e=e=>e[1].key,t=Array.from(this.set.entries()),Array.prototype.slice.call(t,0).sort(((t,n)=>{const r=e(t),s=e(n);return r<s?-1:r>s?1:0}))));var e,t}contains(e){const t=e.toString(j.base58btc);return this.set.has(t)}get(e){const t=e.toString(j.base58btc);return this.set.get(t)}}Jm.Entry=zm;const Zm=Jm.Entry;class Ym{constructor(e,t,n,r,s){this.entry=new Zm(e,t,n),this.cancel=Boolean(r),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(j.base58btc)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}}const Xm=(e,t)=>{const n=["bitswap"];return t&&n.push(t),e&&n.push(`${e.toString().slice(0,8)}`),(0,a.kg)(n.join(":"))},Qm=(e,t)=>{if(e.size!==t.size)return!1;for(const[n,r]of e){const e=t.get(n);if(void 0===e)return!1;if(r instanceof Uint8Array&&e instanceof Uint8Array&&!(0,Ce.f)(r,e))return!1;if(r instanceof Ym&&e instanceof Ym&&!r.equals(e))return!1}return!0};class eb{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}addEntry(e,t,n,r,s){null==n&&(n=eb.WantType.Block);const i=e.toString(j.base58btc),o=this.wantlist.get(i);o?(o.wantType===n&&(o.priority=t),r&&(o.cancel=Boolean(r)),s&&(o.sendDontHave=Boolean(s)),n===eb.WantType.Block&&o.wantType===eb.WantType.Have&&(o.wantType=n)):this.wantlist.set(i,new Ym(e,t,n,r,s))}addBlock(e,t){const n=e.toString(j.base58btc);this.blocks.set(n,t)}addHave(e){const t=e.toString(j.base58btc);this.blockPresences.has(t)||this.blockPresences.set(t,eb.BlockPresenceType.Have)}addDontHave(e){const t=e.toString(j.base58btc);this.blockPresences.has(t)||this.blockPresences.set(t,eb.BlockPresenceType.DontHave)}cancel(e){const t=e.toString(j.base58btc);this.wantlist.delete(t),this.addEntry(e,0,eb.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),cancel:Boolean(e.cancel)}))),full:!!this.full||void 0},blocks:Array.from(this.blocks.values())};return Km.encode(e).finish()}serializeToBitswap110(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),wantType:e.wantType,cancel:Boolean(e.cancel),sendDontHave:Boolean(e.sendDontHave)}))),full:!!this.full||void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(const[t,n]of this.blocks.entries()){const r=H.k0.parse(t),s=r.version,i=r.code,o=r.multihash.code,a=r.multihash.digest.length,c=jm([s,i,o,a]);e.payload.push(new Km.Block({prefix:c,data:n}))}for(const[t,n]of this.blockPresences)e.blockPresences.push(new Km.BlockPresence({cid:H.k0.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),Km.encode(e).finish()}equals(e){return!!(this.full===e.full&&this.pendingBytes===e.pendingBytes&&Qm(this.wantlist,e.wantlist)&&Qm(this.blocks,e.blocks)&&Qm(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){const e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}}eb.deserialize=async(e,t)=>{const n=Km.decode(e),r=n.wantlist&&n.wantlist.full||!1,s=new eb(r);return n.wantlist&&n.wantlist.entries&&n.wantlist.entries.forEach((e=>{if(!e.block)return;const t=H.k0.decode(e.block);s.addEntry(t,e.priority||0,e.wantType,Boolean(e.cancel),Boolean(e.sendDontHave))})),n.blockPresences&&n.blockPresences.forEach((e=>{if(!e.cid)return;const t=H.k0.decode(e.cid);e.type===eb.BlockPresenceType.Have?s.addHave(t):s.addDontHave(t)})),n.blocks.length>0?(await Promise.all(n.blocks.map((async e=>{const t=await xn.sha256.digest(e),n=H.k0.createV0(t);s.addBlock(n,e)}))),s):n.payload.length>0?(await Promise.all(n.payload.map((async e=>{if(!e.prefix||!e.data)return;const n=Bm(e.prefix),r=n[0],i=n[1],o=n[2],a=o===xn.sha256.code?xn.sha256:t&&await t.getHasher(o);if(!a)throw new Ct.s("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");const c=await a.digest(e.data),u=H.k0.create(r,i,c);s.addBlock(u,e.data)}))),s.setPendingBytes(n.pendingBytes),s):s},eb.blockPresenceSize=e=>e.bytes.length+1,eb.Entry=Ym,eb.WantType={Block:Km.Wantlist.WantType.Block,Have:Km.Wantlist.WantType.Have},eb.BlockPresenceType={Have:Km.BlockPresenceType.Have,DontHave:Km.BlockPresenceType.DontHave};const tb=Math.pow(2,31)-1;var nb=function(e,t,n){var r=null,s=null,i=function(){r&&(clearTimeout(r),s=null,r=null)},o=function(){if(!t)return e.apply(this,arguments);var o=this,a=arguments,c=n&&!r;return i(),s=function(){e.apply(o,a)},r=setTimeout((function(){if(r=null,!c){var e=s;return s=null,e()}}),t),c?s():void 0};return o.cancel=i,o.flush=function(){var e=s;i(),e&&e()},o};class rb{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=Xm(e,"msgqueue"),this.sendEntries=nb(this._sendEntries.bind(this),1)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;const e=new eb(!1);this._entries.forEach((t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)})),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(e){return void this._log.error("cant connect to peer %s: %s",this.peerId.toString(),e.message)}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,e).catch((e=>{this._log.error("send error: %s",e.message)}))}}class sb{constructor(e,t,n,r){this.peers=(0,qm.s)({name:"ipfs_bitswap_want_manager_peers",metrics:r.metrics}),this.wantlist=new Jm(n,r),this.network=t,this._stats=n,this._peerId=e,this._log=Xm(e,"want")}_addEntries(e,t,n){const r=e.map(((e,n)=>new eb.Entry(e,tb-n,eb.WantType.Block,t)));r.forEach((e=>{e.cancel?n?this.wantlist.removeForce(e.cid.toString(j.base58btc)):this.wantlist.remove(e.cid):(this._log("adding to wl"),this.wantlist.add(e.cid,e.priority))}));for(const e of this.peers.values())e.addEntries(r)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t)return void t.refcnt++;t=new rb(this._peerId,e,this.network);const n=new eb(!0);for(const e of this.wantlist.entries())n.addEntry(e[1].cid,e[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toString());t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",(()=>{this.cancelWants(e)}))}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach((e=>this.disconnected(e.peerId)))}}const ib="/ipfs/bitswap/1.0.0",ob="/ipfs/bitswap/1.1.0",ab="/ipfs/bitswap/1.2.0";class cb{constructor(e,t,n,r={}){this._log=Xm(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[ib],r.b100Only||(this._protocols.unshift(ob),this._protocols.unshift(ab)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=r.hashLoader,this._maxInboundStreams=r.maxInboundStreams??32,this._maxOutboundStreams=r.maxOutboundStreams??128,this._incomingStreamTimeout=r.incomingStreamTimeout??3e4}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});const e=(0,Tl.a)({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(const t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach((e=>{this._onPeerConnect(e.remotePeer)}))}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),null!=this._registrarIds){for(const e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection({stream:e,connection:t}){if(!this._running)return;const n=new M.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then((async()=>{this._log("incoming new bitswap %s connection from %p",e.stat.protocol,t.remotePeer),await(0,_n.zG)((0,bh.wJ)(e.source,n.signal),wh.J(),(async e=>{for await(const r of e){try{const e=await eb.deserialize(r.subarray(),this._hashLoader);await this._bitswap._receiveMessage(t.remotePeer,e)}catch(e){this._bitswap._receiveError(e);break}n.reset()}}))})).catch((t=>{this._log(t),e.abort(t)})).finally((()=>{n.clear(),e.close()}))}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){const n=[];let r=0;for await(const s of this.findProviders(e,t))if(this._log(`connecting to provider ${s.id}`),n.push(this.connectTo(s.id,t).catch((e=>{this._log.error(e)}))),r++,3===r)break;await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");const n=e.toString();this._log("sendMessage to %s",n,t);const r=await this._libp2p.dial(e),s=await r.newStream([ab,ob,ib]);await async function(e,t,n){try{let n;switch(e.stat.protocol){case ib:n=t.serializeToBitswap100();break;case ob:case ab:n=t.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+e.stat.protocol)}await(0,_n.zG)([n],wh.c(),e)}catch(e){n(e)}finally{e.close()}}(s,t,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){const n=e.toString();if(this._stats){for(const e of t.values())this._stats.push(n,"dataSent",e.length);this._stats.push(n,"blocksSent",t.size)}}}class ub{constructor(e){this.partner=e,this.wantlist=new Jm,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class lb extends Map{constructor(e,t){super(),this._cmp=t||this._defaultSort,this._keys=[];for(const[t,n]of e||[])this.set(t,n)}update(e){if(e<0||e>=this._keys.length)return;const t=this._keys[e];this._keys.splice(e,1);const n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){const t=this.indexOf(e);this._keys.splice(t,1)}super.set(e,t);const n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;const t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;const t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){const r=t+n>>>1,s=this._kCmp(this._keys[r],e);if(s<0)t=r+1;else{if(!(s>0))return r;n=r}}return t}*keys(){for(const e of this._keys)yield e}*values(){for(const e of this._keys)yield this.get(e)}*entries(){for(const e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(e)for(const n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}}const hb={hasNewInfo:()=>!1,merge(){}};class fb{constructor(e=hb){this._taskMerger=e,this._byPeer=new lb([],pb.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());n||(n=new pb(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){const t=this._head();if(void 0===t)return{tasks:[],pendingSize:0};const{tasks:n,pendingSize:r}=t.popTasks(e);if(0===n.length)return{tasks:n,pendingSize:r};const s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toString()):this._byPeer.update(0),{peerId:s,tasks:n,pendingSize:r}}_head(){if(0!==this._byPeer.size)for(const[,e]of this._byPeer)return e}remove(e,t){const n=this._byPeer.get(t.toString());n&&n.remove(e)}tasksDone(e,t){const n=this._byPeer.get(e.toString());if(!n)return;const r=this._byPeer.indexOf(e.toString());for(const e of t)n.taskDone(e);this._byPeer.update(r)}}class pb{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new db,this._active=new Set}pushTasks(e){for(const t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;const t=this._pending.get(e.topic);if(t)return e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),void this._taskMerger.merge(e,t);this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){const t=[];for(const n of this._active)n.topic===e.topic&&t.push(n);return 0===t.length||this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0;const n=[],r=this._pending.tasks();for(let s=0;s<r.length&&t<e;s++){const e=r[s];n.push(e),t+=e.size,this._pending.delete(e.topic),this._activeTotalSize+=e.size,this._active.add(e)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return 0===this._pending.length&&0===this._active.size}static compare(e,t){return 0===e[1]._pending.length?1:0===t[1]._pending.length?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}}class db{constructor(){this._tasks=new lb([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce(((e,t)=>e+t.task.size),0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map((e=>e.task))}updatePriority(e,t){const n=this._tasks.get(e);if(!n)return;const r=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(r)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}}const yb={hasNewInfo(e,t){let n=!1,r=!1;for(const e of t)e.data.haveBlock&&(n=!0),e.data.isWantBlock&&(r=!0);return!(r||!e.data.isWantBlock)||!(n||!e.data.haveBlock)},merge(e,t){const n=e.data,r=t.data;!r.haveBlock&&n.haveBlock&&(r.haveBlock=n.haveBlock,r.blockSize=n.blockSize),!r.isWantBlock&&n.isWantBlock&&(r.isWantBlock=!0,r.haveBlock&&!n.haveBlock||(r.haveBlock=n.haveBlock,t.size=e.size)),r.isWantBlock&&r.haveBlock&&(t.size=r.blockSize)}},gb=eb.WantType;class mb{constructor(e,t,n,r,s,i={}){this._log=Xm(e,"engine"),this.blockstore=t,this.network=n,this._stats=r,this._opts=this._processOpts(i),this.ledgerMap=(0,qm.s)({name:"ipfs_bitswap_ledger_map",metrics:s.metrics}),this._running=!1,this._requestQueue=new fb(yb)}_processOpts(e){return{maxSizeReplaceHasWithBlock:1024,targetMessageSize:16384,...e}}_scheduleProcessTasks(){setTimeout((()=>{this._processTasks()}))}async _processTasks(){if(!this._running)return;const{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(0===t.length)return;const r=new eb(!1);r.setPendingBytes(n);const s=[],i=new Map;for(const e of t){const t=H.k0.parse(e.topic);e.data.haveBlock?e.data.isWantBlock?(s.push(t),i.set(e.topic,e.data)):r.addHave(t):r.addDontHave(t)}const o=await this._getBlocks(s);for(const[e,t]of i){const n=H.k0.parse(e),s=o.get(e);s?r.addBlock(n,s):t.sendDontHave&&r.addDontHave(n)}if(r.empty)return e&&this._requestQueue.tasksDone(e,t),void this._scheduleProcessTasks();try{e&&await this.network.sendMessage(e,r);for(const[t,n]of o.entries())e&&this.messageSent(e,H.k0.parse(t),n)}catch(e){this._log.error(e)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map((e=>e.partner))}receivedBlocks(e){if(e.length){for(const t of this.ledgerMap.values())for(const n of e){const e=t.wantlistContains(n.cid);if(!e)continue;const r=n.data.length,s=this._sendAsBlock(e.wantType,r);let i=r;s||(i=eb.blockPresenceSize(e.cid)),this._requestQueue.pushTasks(t.partner,[{topic:e.cid.toString(j.base58btc),priority:e.priority,size:i,data:{blockSize:r,isWantBlock:s,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){const n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new Jm),this._updateBlockAccounting(t.blocks,n),0===t.wantlist.size)return void this._scheduleProcessTasks();const r=[],s=[];t.wantlist.forEach((e=>{e.cancel?(n.cancelWant(e.cid),r.push(e.cid)):(n.wants(e.cid,e.priority,e.wantType),s.push(e))})),this._cancelWants(e,r),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(const n of t)this._requestQueue.remove(n.toString(j.base58btc),e)}async _addWants(e,t){const n=await this._getBlockSizes(t.map((e=>e.cid))),r=[];for(const s of t){const t=s.cid.toString(j.base58btc),i=n.get(t);if(null==i)s.sendDontHave&&r.push({topic:t,priority:s.priority,size:eb.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===gb.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{const e=this._sendAsBlock(s.wantType,i);let n=i;e||(n=eb.blockPresenceSize(s.cid)),r.push({topic:t,priority:s.priority,size:n,data:{isWantBlock:e,blockSize:i,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,r)}}_sendAsBlock(e,t){return e===gb.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){const t=await this._getBlocks(e);return new Map([...t].map((([e,t])=>[e,t.length])))}async _getBlocks(e){const t=new Map;return await Promise.all(e.map((async e=>{try{const n=await this.blockstore.get(e);t.set(e.toString(j.base58btc),n)}catch(t){"ERR_NOT_FOUND"!==t.code&&this._log.error("failed to query blockstore for %s: %s",e,t)}}))),t}_updateBlockAccounting(e,t){for(const n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){const r=this._findOrCreate(e);r.sentBytes(n.length),r.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){const t=e.toString(),n=this.ledgerMap.get(t);if(n)return n;const r=new ub(e);return this.ledgerMap.set(t,r),this._stats&&this._stats.push(t,"peerCount",1),r}start(){this._running=!0}stop(){this._running=!1}}var bb=n(17187);const wb=e=>`unwant:${(0,K.B)(e.multihash.bytes,"base64")}`,vb=e=>`block:${(0,K.B)(e.multihash.bytes,"base64")}`;class Eb extends bb.EventEmitter{constructor(e){super(),this.setMaxListeners(1e3),this._log=Xm(e,"notif")}hasBlock(e,t){const n=vb(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");const n=vb(e),r=wb(e);return this._log(`wantBlock:${e}`),new Promise(((s,i)=>{const o=()=>{this.removeListener(n,a),i(new Error(`Block for ${e} unwanted`))},a=e=>{this.removeListener(r,o),s(e)};this.once(r,o),this.once(n,a),t&&t.signal&&t.signal.addEventListener("abort",(()=>{this.removeListener(n,a),this.removeListener(r,o),i(new Error(`Want for ${e} aborted`))}))}))}unwantBlock(e){const t=wb(e);this._log(t),this.emit(t)}}var _b=n(63573);class kb extends bb.EventEmitter{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach((e=>{this._stats[e]=BigInt(0),this._movingAverages[e]={},this._options.movingAverageIntervals.forEach((t=>{(this._movingAverages[e][t]=_b(t)).push(this._frequencyLastTime,0)}))})),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){const t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach((n=>{this._updateFrequencyFor(n,t,e)})),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){const r=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const s=r/t*1e3;let i=this._movingAverages[e];i||(i=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach((e=>{let t=i[e];t||(t=i[e]=_b(e)),t.push(n,s)}))}_applyOp(e){const t=e[0],n=e[1];if("number"!=typeof n)throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}}const Sb={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[6e4,3e5,9e5]};class Tb extends bb.EventEmitter{constructor(e,t=[],n=Sb){super();const r=Object.assign({},Sb,n);if("number"!=typeof r.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!=typeof r.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=r,this._enabled=this._options.enabled,this._global=new kb(t,r),this._global.on("update",(e=>this.emit("update",e))),this._peers=(0,qm.s)({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(const e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){const t="string"!=typeof e&&e.toString?e.toString():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let r=this._peers.get(e);r||(r=new kb(this._initialCounters,this._options),this._peers.set(e,r)),r.push(t,n)}}disconnected(e){const t=e.toString(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}}const Ab={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},Ib=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class xb extends bl{constructor(e,t,n={}){super(),this._libp2p=e,this._log=Xm(this.peerId),this._options=Object.assign({},Ab,n),this._stats=new Tb(e,Ib,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new cb(e,this,this._stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new mb(this.peerId,t,this.network,this._stats,e),this.wm=new sb(this.peerId,this.network,this._stats,e),this.notifications=new Eb(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(e){this._log("failed to receive message",t)}if(0===t.blocks.size)return;const n=[];for(const[e,r]of t.blocks.entries()){const t=H.k0.parse(e);n.push({wasWanted:this.wm.wantlist.contains(t),cid:t,data:r})}this.wm.cancelWants(n.filter((({wasWanted:e})=>e)).map((({cid:e})=>e))),await Promise.all(n.map((({cid:t,wasWanted:n,data:r})=>this._handleReceivedBlock(e,t,r,n))))}async _handleReceivedBlock(e,t,n,r){this._log("received block");const s=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,s),r&&await this.put(t,n)}_updateReceiveCounters(e,t,n,r){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),r&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){const n=(e,t)=>(this.wm.wantBlocks([e],t),this.notifications.wantBlock(e,t));let r=!1;const s=async(e,t)=>{try{return await this.blockstore.get(e,t)}catch(s){if("ERR_NOT_FOUND"!==s.code)throw s;return r||(r=!0,this.network.findAndConnect(e,t).catch((e=>this._log.error(e)))),n(e,t)}},i=new AbortController,o=t.signal?(0,re.anySignal)([t.signal,i.signal]):i.signal;try{return await Promise.race([this.notifications.wantBlock(e,{signal:o}),s(e,{signal:o})])}finally{i.abort()}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}unwant(e){const t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach((e=>this.notifications.unwantBlock(e)))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(const{key:n,value:r}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,r),yield{key:n,value:r}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch((e=>{this._log.error("Failed to provide: %s",e.message)}))}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}has(e){return this.blockstore.has(e)}}function Ob(e){return e=e||new Error("Not Found"),c(e,"ERR_NOT_FOUND")}function Pb(e){return e=e||new Error("Aborted"),c(e,"ERR_ABORTED")}class Rb extends bl{constructor(e,t){super(),this.child=e,this.bitswap=t}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(e,t,n={}){await this.has(e)||(this.bitswap.isStarted()?await this.bitswap.put(e,t,n):await this.child.put(e,t,n))}async*putMany(e,t={}){const n=(0,En.Z)(e,(async({key:e})=>!await this.has(e)));this.bitswap.isStarted()?yield*this.bitswap.putMany(n,t):yield*this.child.putMany(n,t)}async get(e,t={}){return!await this.has(e)&&this.bitswap.isStarted()?this.bitswap.get(e,t):this.child.get(e,t)}async*getMany(e,t={}){const n=(0,It.d)({objectMode:!0}),r=(0,It.d)({objectMode:!0});Promise.resolve().then((async()=>{for await(const t of e)!await this.has(t)&&this.bitswap.isStarted()?n.push(t):r.push(t);n.end(),r.end()})),yield*(0,rl.Z)(this.bitswap.getMany(n,t),this.child.getMany(r,t))}async delete(e,t){await this.child.delete(e,t)}async*deleteMany(e,t){yield*this.child.deleteMany(e,t)}async has(e,t={}){return this.child.has(e,t)}async*query(e,t={}){yield*this.child.query(e,t)}async*queryKeys(e,t={}){yield*this.child.queryKeys(e,t)}}class Nb{constructor(e,t,n,r,s){this.peerId=e,this.libp2p=t,this.bitswap=n,this.repo=r,this.blockstore=s}static async start({peerId:e,repo:t,print:n,hashers:r,options:s}){t.closed&&await t.open();const i=await t.config.getAll(),o=await km({options:s,repo:t,peerId:e,multiaddrs:Db(e,i),config:i,keychainConfig:void 0});await o.start();for(const e of o.getMultiaddrs())n(`Swarm listening on ${e.toString()}`);const a=((e,t,n={})=>new xb(e,t,n))(o,t.blocks,{statsEnabled:!0,hashLoader:r,maxInboundStreams:1024,maxOutboundStreams:1024});await a.start();const c=new Rb(t.blocks,a);return t.blocks=c,t.pins.blockstore=c,new Nb(e,o,a,t,c)}static async stop(e){e.repo.blocks=e.blockstore.unwrap(),e.repo.pins.blockstore=e.blockstore.unwrap(),await e.bitswap.stop(),await e.libp2p.stop()}}const Db=(e,t)=>{const n=e.toString(),r=[],s=t.Addresses&&t.Addresses.Swarm||[];for(const e of s){let t=(0,F.HM)(e);if(t.protoCodes().includes(Cb))throw c(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");const s=t.getPeerId();s&&s!==n&&(t=t.encapsulate(`/p2p/${n}`)),r.push(t)}return r},Cb=479;class Lb{constructor({network:e}){this.addrs=function({network:e}){return oe((async function(t={}){const n=[],{libp2p:r}=await e.use(t);return await r.peerStore.forEach((e=>{n.push({id:e.id,addrs:e.addresses.map((e=>e.multiaddr))})})),n}))}({network:e}),this.connect=function({network:e}){return oe((async function(t,n={}){const{libp2p:r}=await e.use(n);await r.dial(t,n)}))}({network:e}),this.disconnect=function({network:e}){return oe((async function(t,n={}){const{libp2p:r}=await e.use(n);await r.hangUp(t)}))}({network:e}),this.localAddrs=function({network:e}){return oe((async function(t={}){const{libp2p:n}=await e.use(t);return n.getMultiaddrs()}))}({network:e}),this.peers=function({network:e}){return oe((async function(t={}){const{libp2p:n}=await e.use(t);if(t.verbose){const e=[];for(const r of n.getConnections()){const n={addr:r.remoteAddr,peer:r.remotePeer};(t.verbose||t.direction)&&(n.direction=r.stat.direction),t.verbose&&(n.muxer=r.stat.multiplexer,n.latency="n/a",n.streams=[]),e.push(n)}return e}const r=new Map;for(const e of n.getConnections()){const t={addr:e.remoteAddr,peer:e.remotePeer};r.set(e.remotePeer.toString(),t)}return Array.from(r.values())}))}({network:e})}}const Bb={success:!0,time:0,text:""};const Mb="/ipns/";function jb(e){let t;if(e.startsWith(Mb)&&(e=e.substring(Mb.length)),"1"!==e[0]&&"Q"!==e[0]||(e=`z${e}`),"z"===e[0]&&(t=j.base58btc.decode(e)),"k"===e[0]&&(t=Xt.base36.decode(e)),!t)throw new Error("Could not parse string");if(1!==t[0]&&114!==t[1]&&(t=(0,Ze.z)([[1,114],t])),40!==t.length)throw new Error("Incorrect length "+t.length);return(0,Ze.z)([(0,B.m)(Mb),t.subarray(2)])}const zb=async(e,t,n)=>{const r=await e.use(n);if(null!=r.libp2p.dht)return r;{const e=async function*(){yield{from:t,name:"QUERY_ERROR",type:3,error:new L("dht not enabled")}};return{libp2p:{dht:{get:e,put:e,findProviders:e,findPeer:e,provide:e,getClosestPeers:e}}}}};const Ub=async()=>{throw new L("pubsub not enabled")};var Fb=n(25108);const $b=i.Z.bind({ignoreUndefined:!0}),Hb=(0,a.kg)("ipfs");class Vb{constructor({print:e,storage:t,codecs:n,options:r}){const{peerId:s,repo:i,keychain:o}=t,a=ge.create(Nb),u=Wi(r.preload),l=Se(),h=function({network:e}){return()=>{const t=e.try();return null!=t&&Boolean(t.libp2p.isStarted())}}({network:a}),f=new Gt(r),p=Object.values(x.kq);(r.ipld&&r.ipld.hashers?r.ipld.hashers:[]).forEach((e=>p.push(e))),this.hashers=new Hh.d({hashers:p,loadHasher:r.ipld&&r.ipld.loadHasher});const d=Object.values(x.gh);(r.ipld&&r.ipld.bases?r.ipld.bases:[]).forEach((e=>d.push(e))),this.bases=new Fh.x({bases:d,loadBase:r.ipld&&r.ipld.loadBase});const y=new Re({repo:i,codecs:n}),g=new Sn({codecs:n,hashers:this.hashers,preload:u,repo:i}),m=new on({dns:l,ipns:f,repo:i,codecs:n,peerId:s,isOnline:h,keychain:o,options:r}),b=Ae({repo:i,codecs:n,bases:this.bases,name:m}),w=new Fi({repo:i,codecs:n,hashers:this.hashers,preload:u}),v=Object.assign(un({repo:i,codecs:n,resolve:b,preload:u}),{local:pn({repo:t.repo})}),{add:E,addAll:_,cat:k,get:S,ls:T}=new Zs({preload:u,repo:i,options:r.EXPERIMENTAL,hashers:this.hashers}),A=Ca({repo:i,preload:u,hashers:this.hashers,options:r}),I=function({preload:e,files:t,options:n={}}){if(n.interval=n.interval||3e4,!n.enabled){Gi("MFS preload disabled");const e=async()=>{};return{start:e,stop:e}}let r,s="";const i=async()=>{try{const n=await t.stat("/"),r=n.cid.toString();s!==r&&(Gi(`preloading updated MFS root ${s} -> ${n.cid}`),await e(n.cid),s=r)}catch(e){Gi.error("failed to preload MFS root",e)}finally{r=setTimeout(i,n.interval)}};return{async start(){const e=await t.stat("/");s=e.cid.toString(),Gi(`monitoring MFS root ${e.cid}`),r=setTimeout(i,n.interval)},stop(){clearTimeout(r)}}}({files:A,preload:u,options:r.preload});this.preload=u,this.name=m,this.ipns=f,this.pin=y,this.resolve=b,this.block=g,this.refs=v,this.start=function({network:e,preload:t,peerId:n,keychain:r,repo:s,ipns:i,mfsPreload:o,print:a,hashers:c,options:u}){return async()=>{const{libp2p:l}=await ge.start(e,{peerId:n,repo:s,print:a,hashers:c,options:u});await Promise.all([i.startOnline({keychain:r,libp2p:l,peerId:n,repo:s}),t.start(),o.start()])}}({network:a,peerId:s,repo:i,preload:u,ipns:f,mfsPreload:I,print:e,keychain:o,hashers:this.hashers,options:r}),this.stop=function({network:e,preload:t,ipns:n,repo:r,mfsPreload:s}){return async()=>{await Promise.all([t.stop(),n.stop(),s.stop()]),await ge.stop(e),await r.close()}}({network:a,preload:u,mfsPreload:I,ipns:f,repo:i}),this.dht=function({network:e,repo:t,peerId:n}){const{get:r,put:s,findProvs:i,findPeer:o,provide:a,query:u}={async*get(t,r={}){const{libp2p:s}=await zb(e,n,r),i=t instanceof Uint8Array?t:jb(t);if(null==s.dht)throw c(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.get(i,r)},async*put(t,r,s){const{libp2p:i}=await zb(e,n,s),o=t instanceof Uint8Array?t:jb(t);if(null==i.dht)throw c(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.put(o,r,s)},async*findProvs(t,r={}){const{libp2p:s}=await zb(e,n,r);if(null==s.dht)throw c(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.findProviders(t,{signal:r.signal})},async*findPeer(t,r={}){const{libp2p:s}=await zb(e,n,r);if(null==s.dht)throw c(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.findPeer(t,{signal:r.signal})},async*provide(r,s={recursive:!1}){const{libp2p:i}=await zb(e,n,s);if(!await t.blocks.has(r))throw c(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(s.recursive)throw c(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(null==i.dht)throw c(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.provide(r)},async*query(t,r={}){const{libp2p:s}=await zb(e,n,r);let i;const o=H.k0.asCID(t);if(i=null!=o?o.multihash.bytes:(0,Te.jE)(t.toString()).toBytes(),null==s.dht)throw c(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.getClosestPeers(i,r)}};return{get:oe(r),put:oe(s),findProvs:oe(i),findPeer:oe(o),provide:oe(a),query:oe(u)}}({network:a,repo:i,peerId:s}),this.pubsub=function({network:e,config:t}){const n=Rt(t||{},"Pubsub.Enabled",!0),r={};let s;return{subscribe:n?oe((async function(t,n,i={}){const{libp2p:o}=await e.use(i);o.pubsub.subscribe(t),null==s&&(s=e=>{const t=e.detail;r[t.topic]&&r[t.topic].forEach((e=>{"function"!=typeof e?null!=e&&null!=e.handleEvent&&e.handleEvent(t):e(t)}))},o.pubsub.addEventListener("message",s)),null!=n&&(null==r[t]&&(r[t]=[]),r[t].push(n))})):Ub,unsubscribe:n?oe((async function(t,n,i={}){const{libp2p:o}=await e.use(i);null!=n&&null!=r[t]&&(r[t]=r[t].filter((e=>e!==n)),0===r[t].length&&delete r[t]),"function"!=typeof n&&delete r[t],null==r[t]&&o.pubsub.unsubscribe(t),0===Object.keys(r).length&&(o.pubsub.removeEventListener("message",s),s=void 0)})):Ub,publish:n?oe((async function(t,n,r={}){const{libp2p:s}=await e.use(r);if(!n)throw c(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await s.pubsub.publish(t,n)})):Ub,ls:n?oe((async function(t={}){const{libp2p:n}=await e.use(t);return n.pubsub.getTopics()})):Ub,peers:n?oe((async function(t,n={}){const{libp2p:r}=await e.use(n);return r.pubsub.getSubscribers(t)})):Ub}}({network:a,config:r.config}),this.dns=l,this.isOnline=h,this.id=Qs({network:a,peerId:s}),this.version=function({repo:e}){return oe((async function(t={}){const n=await e.version.get();return{version:Ys,commit:"",repo:`${n}`,"ipfs-core":Ys,"interface-ipfs-core":"^0.158.0"}}))}({repo:i}),this.bitswap=new yn({network:a}),this.bootstrap=new bn({repo:i}),this.config=function({repo:e}){return{getAll:oe((async function(t={}){return e.config.getAll(t)})),get:oe((async function(t,n){return t?e.config.get(t,n):Promise.reject(new Error("key argument is required"))})),set:oe((async function(t,n,r){return e.config.set(t,n,r)})),replace:oe((async function(t,n){return e.config.replace(t,n)})),profiles:{apply:oe((async function(t,n={dryRun:!1}){const{dryRun:r}=n,s=ni[t];if(!s)throw new Error(`No profile with name '${t}' exists`);try{const t=await e.config.getAll(n);let i=JSON.parse(JSON.stringify(t));return i=s.transform(i),r||await e.config.replace(i,n),delete t.Identity.PrivKey,delete i.Identity.PrivKey,{original:t,updated:i}}catch(e){throw ri(e),new Error(`Could not apply profile '${t}' to config: ${e.message}`)}})),list:oe(si)}}}({repo:i}),this.ping=function({network:e}){return oe((async function*(t,n={}){const{libp2p:r}=await e.use();n.count=n.count||10;const s=await r.peerStore.get(t);let i=s&&s.id;if(!i){yield{...Bb,text:`Looking up peer ${t}`};const e=await r.peerRouting.findPeer(t);i=e&&e.id}if(!i)throw new Error("Peer was not found");yield{...Bb,text:`PING ${i.toString()}`};let o=0,a=0;for(let e=0;e<n.count;e++)try{const e=await r.ping(i);a+=e,o++,yield{...Bb,time:e}}catch(e){yield{...Bb,success:!1,text:e.toString()}}if(o){const e=a/o;yield{...Bb,text:`Average latency: ${e}ms`}}}))}({network:a}),this.add=E,this.addAll=_,this.cat=k,this.get=S,this.ls=T,this.dag=w,this.files=A,this.key=new Ba({keychain:o}),this.object=new $a({preload:u,codecs:n,repo:i}),this.repo=new qa({repo:i,hashers:this.hashers}),this.stats=new Ga({repo:i,network:a}),this.swarm=new Lb({network:a}),Object.defineProperty(this,"libp2p",{get(){const e=a.try();return e?e.libp2p:void 0}});const O=()=>Promise.reject(c(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED"));this.commands=O,this.diag={cmds:O,net:O,sys:O},this.log={level:O,ls:O,tail:async function*(){throw c(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")}},this.mount=O,this.codecs=n}async init(){throw new R}}n(52596);const Kb=async function(e={}){const t=(e=$b({start:!0,EXPERIMENTAL:{},preload:{enabled:!o.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}},e)).init||{},n={name:I.identity.name,code:I.identity.code,encode:e=>e,decode:e=>e},r=Object.values(x.QB);[k,S,T,A,n].concat(e.ipld&&e.ipld.codecs||[]).forEach((e=>r.push(e)));const s=new $h.w({codecs:r,loadCodec:e.ipld&&e.ipld.loadCodec}),i=e.silent?Hb:Fb.log;Hb("creating repo");const a=await Im.start(i,s,e);Hb("getting repo config");const u=await a.repo.config.getAll(),l=new Vb({storage:a,print:i,codecs:s,options:{...e,config:u}});if(Hb("starting preload"),await l.preload.start(),Hb("starting storage"),l.ipns.startOffline(a),a.isNew&&!t.emptyRepo){const e=await(async e=>{const t=k.encode({Data:new _({type:"directory"}).marshal(),Links:[]}),n=await e.block.put(t,{mhtype:"sha2-256",format:"dag-pb"});return await e.pin.add(n),n})(l);if(Hb("adding default assets"),await void l.addAll,Hb("initializing IPNS keyspace"),null==a.peerId.publicKey)throw c(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");const t=new M.TimeoutController(3e4);try{await l.ipns.initializeKeyspace(a.peerId,(0,B.m)(`/ipfs/${e}`),{signal:t.signal})}finally{t.clear()}}return!1!==e.start&&(Hb("starting node"),await l.start()),l}},67031:function(e,t,n){"use strict";function r(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^::1$/.test(e)}n.d(t,{B:function(){return r}})},61063:function(e,t,n){"use strict";var r=n(62308),s=n(85275);const i=1048576,o=(e,t)=>{t.append(e)};t.Z=async function*(e,t={}){let n=new r.H,a=!1,c=(0,s.Z)(),u=Number(t.size??i);(isNaN(u)||0===u||u<0)&&(u=i);const l=t.yieldAfter??0,h=t.serialize??o;for(Promise.resolve().then((async()=>{try{let t;for await(const r of e)h(r,n),n.byteLength>=u?(clearTimeout(t),c.resolve()):t=setTimeout((()=>{c.resolve()}),l);clearTimeout(t),c.resolve()}catch(e){c.reject(e)}finally{a=!0}}));!a;)if(await c.promise,c=(0,s.Z)(),n.byteLength>0){const e=n;n=new r.H,yield e.subarray()}}},93361:function(e,t,n){"use strict";async function r(e){for await(const t of e);}n.d(t,{Z:function(){return r}})},44752:function(e,t,n){"use strict";async function*r(e,t){for await(const n of e)await t(n)&&(yield n)}n.d(t,{Z:function(){return r}})},91486:function(e,t,n){"use strict";async function r(e){for await(const t of e)return t}n.d(t,{Z:function(){return r}})},51816:function(e,t,n){"use strict";n.d(t,{Y:function(){return o}});var r=n(93489),s=n(37430),i=n(85275);function o(e){const t=(0,s.d)(),n=(0,r.r)(e.source),o=(0,i.Z)();let a;const c=e.sink(async function*(){yield*t;const e=await o.promise;yield*e}());c.catch((e=>{a=e}));return{reader:n,writer:t,stream:{sink:async e=>null!=a?await Promise.reject(a):(o.resolve(e),await c),source:n},rest:()=>t.end(),write:t.push,read:async()=>{const e=await n.next();if(null!=e.value)return e.value}}}},68883:function(e,t,n){"use strict";async function r(e){let t;for await(const n of e)t=n;return t}n.d(t,{Z:function(){return r}})},55150:function(e,t,n){"use strict";n.d(t,{J:function(){return f},c:function(){return o}});var r=n(62308),s=n(94565);const i=e=>{const t=s.hG.encodingLength(e),n=(r=t,null!=globalThis?.Buffer?.allocUnsafe?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r));var r;return s.hG.encode(e,n),i.bytes=t,n};function o(e){const t=(e=e??{}).lengthEncoder??i;return async function*(e){for await(const n of e){const e=t(n.byteLength);e instanceof Uint8Array?yield e:yield*e,n instanceof Uint8Array?yield n:yield*n}}}i.bytes=0,o.single=(e,t)=>{const n=(t=t??{}).lengthEncoder??i;return new r.H(n(e.byteLength),e)};var a=n(32114);const c=8,u=4194304;var l;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(l||(l={}));const h=e=>{const t=s.hG.decode(e);return h.bytes=s.hG.encodingLength(t),t};function f(e){return async function*(t){const n=new r.H;let s=l.LENGTH,i=-1;const o=e?.lengthDecoder??h,f=e?.maxLengthLength??c,p=e?.maxDataLength??u;for await(const r of t)for(n.append(r);n.byteLength>0;){if(s===l.LENGTH)try{if(i=o(n),i<0)throw a(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>p)throw a(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const t=o.bytes;n.consume(t),null!=e?.onLength&&e.onLength(i),s=l.DATA}catch(e){if(e instanceof RangeError){if(n.byteLength>f)throw a(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw e}if(s===l.DATA){if(n.byteLength<i)break;const t=n.sublist(0,i);n.consume(i),null!=e?.onData&&e.onData(t),yield t,s=l.LENGTH}}if(n.byteLength>0)throw a(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}h.bytes=0,f.fromReader=(e,t)=>{let n=1;const r=async function*(){for(;;)try{const{done:t,value:r}=await e.next(n);if(!0===t)return;null!=r&&(yield r)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{n=1}}();return f({...t??{},onLength:e=>{n=e}})(r)}},95918:function(e,t,n){"use strict";async function r(e){let t=0;for await(const n of e)t++;return t}n.d(t,{Z:function(){return r}})},21007:function(e,t,n){"use strict";async function*r(e,t){for await(const n of e)yield t(n)}n.d(t,{Z:function(){return r}})},52019:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(37430);async function*s(...e){const t=(0,r.d)({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const n of e)t.push(n)}))),t.end()}catch(e){t.end(e)}})),yield*t}},69849:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(85275);const s=globalThis.CustomEvent??Event;async function*i(e,t={}){let n=t.concurrency??1/0;n<1&&(n=1/0);const i=null!=t.ordered&&t.ordered,o=new EventTarget,a=[];let c,u=(0,r.Z)(),l=(0,r.Z)(),h=!1,f=!1;function p(){return i?a[0]?.done:Boolean(a.find((e=>e.done)))}function*d(){for(;a.length>0&&a[0].done;){const e=a[0];if(a.shift(),!e.ok)throw f=!0,u.resolve(),e.err;yield e.value,u.resolve()}}function*y(){for(;p();)for(let e=0;e<a.length;e++)if(a[e].done){const t=a[e];if(a.splice(e,1),e--,!t.ok)throw f=!0,u.resolve(),t.err;yield t.value,u.resolve()}}for(o.addEventListener("task-complete",(()=>{l.resolve()})),Promise.resolve().then((async()=>{try{for await(const t of e){if(a.length===n&&(u=(0,r.Z)(),await u.promise),f)break;const e={done:!1};a.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,o.dispatchEvent(new s("task-complete"))}),(t=>{e.done=!0,e.err=t,o.dispatchEvent(new s("task-complete"))}))}h=!0,o.dispatchEvent(new s("task-complete"))}catch(e){c=e,o.dispatchEvent(new s("task-complete"))}}));;){if(p()||(l=(0,r.Z)(),await l.promise),null!=c)throw c;if(i?yield*d():yield*y(),h&&0===a.length)break}}},75671:function(e,t,n){"use strict";function r(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}}n.d(t,{Z:function(){return r}})},88211:function(e,t,n){"use strict";n.d(t,{zG:function(){return u}});var r=n(37430),s=n(52019);const i=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},o=e=>null!=e&&("function"==typeof e[Symbol.asyncIterator]||"function"==typeof e[Symbol.iterator]||"function"==typeof e.next),a=e=>null!=e&&"function"==typeof e.sink&&o(e.source),c=e=>t=>{const n=e.sink(t);if(null!=n.then){const t=(0,r.d)({objectMode:!0});n.then((()=>{t.end()}),(e=>{t.end(e)}));const i=async function*(){yield*e.source,t.end()};return(0,s.Z)(t,i())}return e.source};function u(e,...t){if(a(e)){const t=e;e=()=>t.source}else if(o(e)){const t=e;e=()=>t}const n=[e,...t];if(n.length>1&&a(n[n.length-1])&&(n[n.length-1]=n[n.length-1].sink),n.length>2)for(let e=1;e<n.length-1;e++)a(n[e])&&(n[e]=c(n[e]));return i(...n)}},37430:function(e,t,n){"use strict";n.d(t,{d:function(){return i},e:function(){return o}});class r{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class s{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new r(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new r(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}function i(e={}){return a((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function o(e={}){return a((e=>{let t;const n=[];for(;!e.isEmpty()&&(t=e.shift(),null!=t);){if(null!=t.error)throw t.error;!1===t.done&&n.push(t.value)}return null==t?{done:!0}:{done:!0===t.done,value:n}}),e)}function a(e,t){let n,r,i,o=(t=t??{}).onEnd,a=new s;const c=e=>null!=r?r(e):(a.push(e),n),u=e=>{if(i)return n;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},l=e=>i?n:(i=!0,null!=e?(e=>(a=new s,null!=r?r({error:e}):(a.push({error:e}),n)))(e):c({done:!0}));if(n={[Symbol.asyncIterator](){return this},next:async()=>a.isEmpty()?i?{done:!0}:await new Promise(((t,s)=>{r=i=>{r=null,a.push(i);try{t(e(a))}catch(e){s(e)}return n}})):e(a),return:()=>(a=new s,l(),{done:!0}),throw:e=>(l(e),{done:!0}),push:u,end:l,get readableLength(){return a.size}},null==o)return n;const h=n;return n={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:e=>(h.throw(e),null!=o&&(o(e),o=void 0),{done:!0}),return:()=>(h.return(),null!=o&&(o(),o=void 0),{done:!0}),push:u,end:e=>(h.end(e),null!=o&&(o(e),o=void 0),n),get readableLength(){return h.readableLength}},n}},93489:function(e,t,n){"use strict";n.d(t,{r:function(){return s}});var r=n(62308);function s(e){const t=async function*(){let t=yield,n=new r.H;for await(const s of e)if(null!=t)for(n.append(s);n.length>=t;){const e=n.sublist(0,t);if(n.consume(t),t=yield e,null==t){n.length>0&&(t=yield n,n=new r.H);break}}else n.append(s),t=yield n,n=new r.H;if(null!=t)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return t.next(),t}},34751:function(e,t,n){"use strict";async function*r(e,t){const n=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(e);yield*n.sort(t)}n.d(t,{Z:function(){return r}})},56635:function(e,t,n){"use strict";async function*r(e,t){let n=0;if(!(t<1))for await(const r of e)if(yield r,n++,n===t)return}n.d(t,{Z:function(){return r}})},24143:function(e,t,n){"use strict";n.d(t,{$:function(){return p}});var r=WebSocket,s=n(90507),i=n(77408);function o(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name&&"number"==typeof e?.byteLength}var a=e=>{if(e.readyState>=2)throw new Error("socket closed");if(1!==e.readyState)return new Promise(((t,n)=>{function r(){e.removeEventListener("open",s),e.removeEventListener("error",i)}function s(){r(),t()}function i(t){r(),n(t.error??new Error(`connect ECONNREFUSED ${e.url}`))}e.addEventListener("open",s),e.addEventListener("error",i)}))},c=(e,t)=>{(t=t??{}).closeOnEnd=!1!==t.closeOnEnd;return async n=>{for await(const t of n){try{await a(e)}catch(e){if("socket closed"===e.message)break;throw e}e.send(t)}if(null!=t.closeOnEnd&&e.readyState<=1)return await new Promise(((t,n)=>{e.addEventListener("close",(e=>{if(e.wasClean||1006===e.code)t();else{const t=Object.assign(new Error("ws error"),{event:e});n(t)}})),setTimeout((()=>e.close()))}))}},u=(e,t)=>{t=t??{};const n=(e=>{e.binaryType="arraybuffer";const t=async()=>await new Promise(((t,n)=>{if(a)return t();if(null!=r)return n(r);const s=t=>{e.removeEventListener("open",i),e.removeEventListener("error",o),t()},i=()=>s(t),o=t=>{s((()=>n(t.error??new Error(`connect ECONNREFUSED ${e.url}`))))};e.addEventListener("open",i),e.addEventListener("error",o)})),n=async function*(){const n=new s.zN((({push:t,stop:n,fail:r})=>{const s=e=>{let n=null;"string"==typeof e.data&&(n=(0,i.m)(e.data)),o(e.data)&&(n=new Uint8Array(e.data)),e.data instanceof Uint8Array&&(n=e.data),null!=n&&t(n)},a=e=>r(e.error??new Error("Socket error"));return e.addEventListener("message",s),e.addEventListener("error",a),e.addEventListener("close",n),()=>{e.removeEventListener("message",s),e.removeEventListener("error",a),e.removeEventListener("close",n)}}),{highWaterMark:1/0});await t();for await(const e of n)yield o(e)?new Uint8Array(e):e}();let r,a=1===e.readyState;return e.addEventListener("open",(()=>{a=!0,r=null})),e.addEventListener("close",(()=>{a=!1,r=null})),e.addEventListener("error",(t=>{a||(r=t.error??new Error(`connect ECONNREFUSED ${e.url}`))})),Object.assign(n,{connected:t})})(e);let r=t.remoteAddress,a=t.remotePort;if(null!=e.url)try{const t=new URL(e.url);r=t.hostname,a=parseInt(t.port,10)}catch{}if(null==r||null==a)throw new Error("Remote connection did not have address and/or port");return{sink:c(e,t),source:n,connected:async()=>await n.connected(),close:async()=>{e.readyState!==e.CONNECTING&&e.readyState!==e.OPEN||await new Promise((t=>{e.addEventListener("close",(()=>{t()})),e.close()}))},destroy:()=>{null!=e.terminate?e.terminate():e.close()},remoteAddress:r,remotePort:a,socket:e}},l=n(17745);const h={http:"ws",https:"wss"};var f=(e,t)=>(0,l.relative)(e,t,h,"ws");function p(e,t){const n="undefined"==typeof window?"":window.location;t=t??{};const s=f(e,n.toString()),i=new r(s,t.websocket);return u(i,t)}}}]);
//# sourceMappingURL=525.935d59c0.js.map